function $CombineDelegates(n,t){var r,i;if(n==null)return t;if(t==null)return n;if(r=$CreateMulticastDelegateFunction(),r.delegates=[],n.isMulticastDelegate)for(i=0;i<n.delegates.length;i++)r.delegates.push(n.delegates[i]);else r.delegates.push(n);if(t.isMulticastDelegate)for(i=0;i<t.delegates.length;i++)r.delegates.push(t.delegates[i]);else r.delegates.push(t);return r}function $CreateMulticastDelegateFunction(){var n=null,t=function(){for(var r,i=undefined,t=0;t<n.delegates.length;t++)r=n.delegates[t],i=r.apply(null,arguments);return i};return t.isMulticastDelegate=!0,n=t,t}function $RemoveDelegate(n,t){var i,r,u;if(t==null||n==null)return n;if(n.isMulticastDelegate){if(t.isMulticastDelegate)throw new Error("Multicast to multicast delegate removal is not implemented yet");for(i=$CreateMulticastDelegateFunction(),r=0;r<n.delegates.length;r++)u=n.delegates[r],u!=t&&(i.delegates==null&&(i.delegates=[]),i.delegates.push(u));return i.delegates==null?null:i.delegates.length==1?i.delegates[0]:i}if(t.isMulticastDelegate)throw new Error("single to multicast delegate removal is not supported");return n==t?null:n}var $CreateException,$CreateAnonymousDelegate,$iKey,$pKey,$CreateDelegate,Int32Array,Float64Array,Uint8Array,Float32Array,$CreateAnonymousObject,JsTypes,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$GTreeOverlapRemoval,Microsoft$Msagl$GraphmapsWithMesh$Angle,Microsoft$Msagl$GraphmapsWithMesh$ComponentCollection,Microsoft$Msagl$GraphmapsWithMesh$DijkstraAlgo,Microsoft$Msagl$GraphmapsWithMesh$VertexNeighbor,Microsoft$Msagl$GraphmapsWithMesh$LocalModifications,Microsoft$Msagl$GraphmapsWithMesh$MeshCreator,Microsoft$Msagl$GraphmapsWithMesh$OrthogonalEdge,Microsoft$Msagl$GraphmapsWithMesh$yCoordinateComparator,Microsoft$Msagl$GraphmapsWithMesh$xCoordinateComparator,Microsoft$Msagl$GraphmapsWithMesh$MeshGraph,Microsoft$Msagl$GraphmapsWithMesh$MsaglUtilities,Microsoft$Msagl$GraphmapsWithMesh$Network,Microsoft$Msagl$GraphmapsWithMesh$PlanarGraphUtilities,Microsoft$Msagl$GraphmapsWithMesh$PointSet,Microsoft$Msagl$GraphmapsWithMesh$WeightedPoint,Microsoft$Msagl$GraphmapsWithMesh$PointToSegmentDistance,Microsoft$Msagl$GraphmapsWithMesh$SteinerTree,Microsoft$Msagl$GraphmapsWithMesh$Component,Microsoft$Msagl$GraphmapsWithMesh$Twin,Microsoft$Msagl$GraphmapsWithMesh$Tuple,Microsoft$Msagl$GraphmapsWithMesh$Tiling,Microsoft$Msagl$GraphmapsWithMesh$Vertex,Microsoft$Msagl$GraphmapsWithMesh$Ray,Microsoft$Msagl$GraphmapsWithMesh$Edge,Microsoft$Msagl$GraphmapsWithMesh$ShortestPathEdgeList,System$ExtensionsForSharpKit,SharpKitExtensions$Regex_SharpKit,SharpKitExtensions$Match_SharpKit,SharpKitExtensions$StringWriter_SharpKit,Test$Test,Microsoft$Msagl$Core$AlgorithmBase,Microsoft$Msagl$Core$DataStructures$CollectionUtilities,Microsoft$Msagl$Core$DataStructures$GenericBinaryHeapPriorityQueueWithTimestamp$1,Microsoft$Msagl$Core$DataStructures$GenericHeapElementWithTimestamp$1,Microsoft$Msagl$Core$DataStructures$Size,Microsoft$Msagl$Core$DataStructures$SymmetricTuple$1,Microsoft$Msagl$Core$Geometry$ApproximateComparer,Microsoft$Msagl$Core$Geometry$ConvexHull,Microsoft$Msagl$Core$Geometry$HullPoint,Microsoft$Msagl$Core$Geometry$HullPointComparer,Microsoft$Msagl$Core$Geometry$HullStack,Microsoft$Msagl$Core$Geometry$Curves$RoundedRect,Microsoft$Msagl$Core$Geometry$ColumnPacking$1,Microsoft$Msagl$Core$Geometry$OptimalColumnPacking$1,Microsoft$Msagl$Core$Geometry$OptimalPacking$1,Microsoft$Msagl$Core$Geometry$OptimalRectanglePacking$1,Microsoft$Msagl$Core$Geometry$BorderInfo,Microsoft$Msagl$Core$Geometry$PointNodesList,Microsoft$Msagl$Core$Geometry$PointPair,Microsoft$Msagl$Core$Geometry$Packing,Microsoft$Msagl$Core$Geometry$PackingConstants,Microsoft$Msagl$Core$Geometry$RectangleToPack$1,Microsoft$Msagl$Core$Geometry$RectanglePacking$1,Microsoft$Msagl$Core$Geometry$IntervalNode$1,Microsoft$Msagl$Core$Geometry$IntervalNodeUtils,Microsoft$Msagl$Core$Geometry$IntervalRTree$1,Microsoft$Msagl$Core$Geometry$RectangleNodeUtils,Microsoft$Msagl$Core$Geometry$Site,Microsoft$Msagl$Core$GraphAlgorithms$MinimumSpanningTreeByPrim,Microsoft$Msagl$Core$Layout$Arrowhead,Microsoft$Msagl$Core$Layout$Arrowheads,Microsoft$Msagl$Core$Layout$CurvePort,Microsoft$Msagl$Core$Layout$EdgeCollection,Microsoft$Msagl$Core$Layout$EdgeLabelPlacement,Microsoft$Msagl$Core$Layout$HookUpAnywhereFromInsidePort,Microsoft$Msagl$Core$Layout$IdealEdgeLengthSettings,Microsoft$Msagl$Core$Layout$IObstacle,Microsoft$Msagl$Core$Layout$IsOpenChangeEventArgs,Microsoft$Msagl$Core$Layout$LabelPlacementResult,Microsoft$Msagl$Core$Layout$LgInfoBase,Microsoft$Msagl$Core$Layout$LgNodeInfo,Microsoft$Msagl$Core$Layout$LayoutAlgorithmHelpers,Microsoft$Msagl$Core$Layout$LayoutChangeEventArgs,Microsoft$Msagl$Core$Layout$LgNodeInfoKind,Microsoft$Msagl$Core$Layout$NodeCollection,Microsoft$Msagl$Core$Layout$PackingMethod,Microsoft$Msagl$Core$Layout$PortObstacle,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ConjugateGradient$SparseMatrix,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ConjugateGradient$LinearSystemSolver,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ConjugateGradient$Vector,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$IOverlapRemoval,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$MstLineSweeper,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$OverlapRemovalSettings,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ProximityOverlapRemoval,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$MstOnDelaunayTriangulation,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$ExampleStressMajorization,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$MaxIterationMethod,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$NodeVoting,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$StressMajorizationSettings,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$SolvingMethod,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$StressMajorization,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$UpdateMethod,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$Vote,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$VoteBlock,Microsoft$Msagl$Core$Layout$RectangleObstacle,Microsoft$Msagl$Core$Layout$SimpleIntEdge,Microsoft$Msagl$Core$ProjectionSolver$SolverAlgorithm,Microsoft$Msagl$Core$Routing$BundlingSettings,Microsoft$Msagl$DebugHelpers$Persistence$CharStreamElement,Microsoft$Msagl$DebugHelpers$Persistence$GeometryGraphReader,Microsoft$Msagl$DebugHelpers$Persistence$GeometryGraphWriter,Microsoft$Msagl$DebugHelpers$CurveStream,Microsoft$Msagl$DebugHelpers$CurveStreamElement,Microsoft$Msagl$DebugHelpers$DoubleStreamElement,Microsoft$Msagl$Layout$Initial$Relayout,Microsoft$Msagl$Layout$Initial$InitialLayoutByCluster,Microsoft$Msagl$Layout$Initial$InitialLayoutHelpers,Microsoft$Msagl$Layout$LargeGraphLayout$DeviceIndependendZoomCalculatorForNodes,Microsoft$Msagl$Layout$LargeGraphLayout$EdgePicker,Microsoft$Msagl$Layout$LargeGraphLayout$IZoomLevelCalculator,Microsoft$Msagl$Layout$LargeGraphLayout$LgCellInfo,Microsoft$Msagl$Layout$LargeGraphLayout$LgData,Microsoft$Msagl$Layout$LargeGraphLayout$LgEdgeInfo,Microsoft$Msagl$Layout$LargeGraphLayout$LgInteractor,Microsoft$Msagl$Layout$LargeGraphLayout$LgLayoutSettings,Microsoft$Msagl$Layout$LargeGraphLayout$LevelCalculator,Microsoft$Msagl$Layout$LargeGraphLayout$LgLevel,Microsoft$Msagl$Layout$LargeGraphLayout$LgNodeCollection,Microsoft$Msagl$Layout$LargeGraphLayout$LgSkeletonLevel,Microsoft$Msagl$Layout$LargeGraphLayout$NodeRailLevelCalculator$GreedyNodeRailLevelCalculator,Microsoft$Msagl$Layout$LargeGraphLayout$Rail,Microsoft$Msagl$Layout$LargeGraphLayout$RailGraph,Microsoft$Msagl$Layout$LargeGraphLayout$Interval,Microsoft$Msagl$Layout$LargeGraphLayout$RouteSimplifier,Microsoft$Msagl$Layout$LargeGraphLayout$ShortestPartRouterForLg,Microsoft$Msagl$Layout$LargeGraphLayout$SimpleEdgeCollection,Microsoft$Msagl$Layout$LargeGraphLayout$SimpleNodeCollection,Microsoft$Msagl$Layout$Layered$LayeredLayoutEngine,Microsoft$Msagl$Layout$Layered$RecoveryLayerCalculator,Microsoft$Msagl$Layout$Layered$RecoveryLayeredLayoutEngine,Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$OverlapRemovalMethod,Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$FakeBitmap,Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsBitmap,Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$SiteType,Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst,PixelPoint,Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$RectSegIntersection,Microsoft$Msagl$Miscellaneous$ConstrainedSkeleton$SteinerCdt,Microsoft$Msagl$Prototype$Constraints$AlignmentConstraint,Microsoft$Msagl$Miscellaneous$LayoutEditing$BumperPusher,Microsoft$Msagl$Miscellaneous$LayoutEditing$IncrementalDragger,Microsoft$Msagl$Miscellaneous$LayoutEditing$LabelFixture,Microsoft$Msagl$Miscellaneous$LayoutHelpers,Microsoft$Msagl$Prototype$LayoutEditing$EdgeRestoreData,Microsoft$Msagl$Prototype$LayoutEditing$GraphRestoreData,Microsoft$Msagl$Prototype$LayoutEditing$LabelRestoreData,Microsoft$Msagl$Prototype$LayoutEditing$NodeRestoreData,Microsoft$Msagl$Prototype$LayoutEditing$ObstacleCalculator,Microsoft$Msagl$Prototype$LayoutEditing$RestoreData,Microsoft$Msagl$Prototype$LayoutEditing$RestoreHelper,Microsoft$Msagl$Prototype$LayoutEditing$RouterBetweenTwoNodes,Microsoft$Msagl$Prototype$LayoutEditing$WeightedEdge,Microsoft$Msagl$Prototype$MultiScale$MultiScaleLayout,Microsoft$Msagl$Prototype$NonOverlappingBoundaries$CvxHull,Microsoft$Msagl$Prototype$NonOverlappingBoundaries$RCHull,Microsoft$Msagl$Prototype$NonOverlappingBoundaries$ClusterConvexHull,Microsoft$Msagl$Prototype$NonOverlappingBoundaries$AllPairsNonOverlappingBoundaries,Microsoft$Msagl$Prototype$NonOverlappingBoundaries$IHull,Microsoft$Msagl$Prototype$NonOverlappingBoundaries$ProximityQuery,Microsoft$Msagl$Prototype$Phylo$PhyloEdge,Microsoft$Msagl$Prototype$Phylo$PhyloTree,Microsoft$Msagl$Prototype$Phylo$PhyloTreeLayoutCalclulation,Microsoft$Msagl$Prototype$Ranking$Centrality,Microsoft$Msagl$Prototype$Ranking$RankingLayout,Microsoft$Msagl$Prototype$Ranking$RankingLayoutSettings,Microsoft$Msagl$Miscellaneous$RegularGrid$GridTraversal,Microsoft$Msagl$Layout$LargeGraphLayout$LgPathRouter,Microsoft$Msagl$Miscellaneous$Routing$ShortestPathTree,Microsoft$Msagl$Routing$ClusterBoundaryPort,Microsoft$Msagl$Routing$CdtEdge,Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtFront,Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtFrontElement,Microsoft$Msagl$Routing$CdtSite,Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtSweeper,Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$Cdt,Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtTriangle,Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$EdgeInserter,Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$EdgeTracer,Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$PerimeterEdge,Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$ThreeArray$1,Microsoft$Msagl$Routing$Corner,Microsoft$Msagl$Routing$MultiEdgeRouter,Microsoft$Msagl$Routing$MultipleSourceMultipleTargetsShortestPathOnVisibilityGraph,Microsoft$Msagl$Routing$PreGraph,Microsoft$Msagl$Routing$Rectilinear$AxisCoordinateEvent,Microsoft$Msagl$Routing$Rectilinear$Clump,Microsoft$Msagl$Routing$Rectilinear$EnumeratorWrapper$1,Microsoft$Msagl$Routing$Rectilinear$FullVisibilityGraphGenerator,Microsoft$Msagl$Routing$Rectilinear$VisibilityGraphGenerator,Microsoft$Msagl$Routing$Rectilinear$OverlapConvexHull,Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator,Microsoft$Msagl$Routing$Rectilinear$VertexEntry,Microsoft$Msagl$Routing$Rectilinear$VisibilityVertexRectilinear,Microsoft$Msagl$Routing$ShapeCreator,Microsoft$Msagl$Routing$ShapeCreatorForRoutingToParents,Microsoft$Msagl$Routing$ShapeObstacleCalculator,Microsoft$Msagl$Routing$Spline$Bundling$CdtThreader,Microsoft$Msagl$Routing$Spline$Bundling$SdBoneEdge,Microsoft$Msagl$Routing$Spline$Bundling$SdVertex,Microsoft$Msagl$Routing$Spline$Bundling$SdShortestPath,Microsoft$Msagl$Routing$SingleSourceMultipleTargetsShortestPathOnVisibilityGraph,Microsoft$Msagl$Routing$Spline$Bundling$BundleBase,Microsoft$Msagl$Routing$Spline$Bundling$BundleBasesCalculator,Microsoft$Msagl$Routing$Spline$Bundling$BundleInfo,Microsoft$Msagl$Routing$Spline$Bundling$BundleRouter,Microsoft$Msagl$Routing$Spline$Bundling$BundlingStatus,Microsoft$Msagl$Routing$Spline$Bundling$CdtIntersections,Microsoft$Msagl$Routing$Spline$Bundling$ChannelFlag,Microsoft$Msagl$Routing$Spline$Bundling$EdgeNudger,Microsoft$Msagl$Routing$Spline$Bundling$FlipCollapser,Microsoft$Msagl$Routing$Spline$Bundling$FlipSwitcher,Microsoft$Msagl$Routing$Spline$Bundling$GeneralMetroMapOrdering,Microsoft$Msagl$Routing$Spline$Bundling$HubDebugger,Microsoft$Msagl$Routing$Spline$Bundling$HubRadiiCalculator,Microsoft$Msagl$Routing$Spline$Bundling$IMetroMapOrderingAlgorithm,Microsoft$Msagl$Routing$Spline$Bundling$CostCalculator,Microsoft$Msagl$Routing$Spline$Bundling$IntersectionCache,Microsoft$Msagl$Routing$Spline$Bundling$Intersections,Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering,Microsoft$Msagl$Routing$Spline$Bundling$MetroGraphData,Microsoft$Msagl$Routing$Spline$Bundling$Metroline,Microsoft$Msagl$Routing$Spline$Bundling$MetroNodeInfo,Microsoft$Msagl$Routing$Spline$Bundling$NodePositionsAdjuster,Microsoft$Msagl$Routing$Spline$Bundling$OrientedHubSegment,Microsoft$Msagl$Routing$Spline$Bundling$PathFixer,Microsoft$Msagl$Routing$Spline$Bundling$PointPairOrder,Microsoft$Msagl$Routing$Spline$Bundling$SimulatedAnnealing,Microsoft$Msagl$Routing$Spline$Bundling$Station,Microsoft$Msagl$Routing$Spline$Bundling$StationEdgeInfo,Microsoft$Msagl$Routing$Spline$Bundling$TimeMeasurer,Microsoft$Msagl$Routing$TightLooseCouple,Microsoft$Msagl$Routing$StraightLineEdges,Microsoft$Msagl$Core$GraphAlgorithms$ConnectedComponentCalculator$1,Microsoft$Msagl$Core$GraphAlgorithms$CycleRemoval$1,Microsoft$Msagl$Core$GraphAlgorithms$CycleRemovalWithConstraints$1,Microsoft$Msagl$Core$GraphAlgorithms$GraphForCycleRemoval,Microsoft$Msagl$Core$GraphAlgorithms$NodeInfo,Microsoft$Msagl$Layout$Layered$LayeredLayout,Microsoft$Msagl$Layout$MDS$AllPairsDistances,Microsoft$Msagl$Layout$MDS$PivotDistances,Microsoft$Msagl$Layout$Incremental$AxisSolver,Microsoft$Msagl$Core$Geometry$Disc,Microsoft$Msagl$Layout$MDS$PivotMDS,Microsoft$Msagl$Core$Layout$Cluster,Microsoft$Msagl$Layout$Incremental$Feasibility,Microsoft$Msagl$Layout$Incremental$TNode,Microsoft$Msagl$Layout$Incremental$EdgeConstraintGenerator,Microsoft$Msagl$Layout$Incremental$FastIncrementalLayout,Microsoft$Msagl$Layout$Incremental$FiEdge,Microsoft$Msagl$Layout$Incremental$FiNode,Microsoft$Msagl$Layout$Incremental$HorizontalSeparationConstraint,Microsoft$Msagl$Layout$Incremental$IConstraint,Microsoft$Msagl$Layout$Incremental$LockPosition,Microsoft$Msagl$Layout$Incremental$MaxSeparationConstraint,Microsoft$Msagl$Layout$Incremental$MinSeparationConstraint,Microsoft$Msagl$Layout$Incremental$KDTree,Microsoft$Msagl$Layout$Incremental$FastIncrementalLayoutSettings,Microsoft$Msagl$Core$Geometry$MoveToFront,Microsoft$Msagl$Core$Geometry$MinimumEnclosingDisc,Microsoft$Msagl$Layout$Incremental$MultipoleCoefficients,Microsoft$Msagl$Layout$Incremental$ProcrustesCircleConstraint,Microsoft$Msagl$Core$Geometry$RectangularClusterBoundary,Microsoft$Msagl$Layout$Initial$InitialLayout,Microsoft$Msagl$Layout$Incremental$StickConstraint,Microsoft$Msagl$Layout$Incremental$VerticalSeparationConstraint,Microsoft$Msagl$Core$DataStructures$BinaryHeapPriorityQueue,Microsoft$Msagl$Core$DataStructures$BinaryHeapWithComparer$1,Microsoft$Msagl$Core$Layout$GraphConnectedComponents,Microsoft$Msagl$Core$Layout$PortEntryOnCurve,Microsoft$Msagl$Core$ProgressChangedEventArgs,Microsoft$Msagl$Core$Routing$EdgeRoutingSettings,Microsoft$Msagl$Core$Geometry$RTree$1,Microsoft$Msagl$Core$CancelToken,Microsoft$Msagl$Core$Routing$EdgeRoutingMode,Microsoft$Msagl$DebugHelpers$DebugShape,Microsoft$Msagl$DebugHelpers$DebugEllipse,Microsoft$Msagl$Core$Layout$EdgeGeometry,Microsoft$Msagl$Core$Layout$FloatingPort,Microsoft$Msagl$Core$Layout$GeometryGraph,Microsoft$Msagl$Core$Layout$GeometryObject,Microsoft$Msagl$Core$DataStructures$GenericHeapElement$1,Microsoft$Msagl$Layout$Layered$HorizontalConstraintsForSugiyama,Microsoft$Msagl$Core$GraphAlgorithms$IEdge,Microsoft$Msagl$Core$Layout$ILabeledObject,Microsoft$Msagl$Core$DataStructures$GenericBinaryHeapPriorityQueue$1,Microsoft$Msagl$Core$Layout$Label,Microsoft$Msagl$Core$Layout$MultiLocationFloatingPort,Microsoft$Msagl$Layout$Layered$NetworkEdge,Microsoft$Msagl$Layout$Layered$NetworkSimplexForGeneralGraph,Microsoft$Msagl$Core$Geometry$Point,Microsoft$Msagl$Core$Layout$Port,Microsoft$Msagl$Core$Layout$IPortEntry,Microsoft$Msagl$Core$DataStructures$DefaultComperer$1,Microsoft$Msagl$Core$DataStructures$RBColor,Microsoft$Msagl$Core$DataStructures$RBNode$1,Microsoft$Msagl$Core$DataStructures$RbTree$1,Microsoft$Msagl$Core$DataStructures$RBTreeEnumerator$1,Microsoft$Msagl$Core$DataStructures$RealNumberSpan,Microsoft$Msagl$Core$Layout$RelativeFloatingPort,Microsoft$Msagl$Core$Geometry$SmoothedPolyline,Microsoft$Msagl$Core$Geometry$TriangleOrientation,Microsoft$Msagl$Layout$Layered$VerticalConstraintsForSugiyama,Microsoft$Msagl$Layout$MDS$MdsLayoutSettings,Microsoft$Msagl$Core$Geometry$MultidimensionalScaling,Microsoft$Msagl$Layout$MDS$SingleSourceDistances,Microsoft$Msagl$Layout$MDS$MdsGraphLayout,Microsoft$Msagl$Layout$MDS$Transform,Microsoft$Msagl$Layout$Layered$AdjacentSwapsWithConstraints,Microsoft$Msagl$Layout$Layered$ConstrainedOrdering,Microsoft$Msagl$Layout$Layered$ConstrainedOrderMeasure,Microsoft$Msagl$Layout$Layered$MetroMapOrdering,Microsoft$Msagl$Layout$Layered$EdgeComparerBySource,Microsoft$Msagl$Layout$Layered$EdgeComparerByTarget,Microsoft$Msagl$Core$ProjectionSolver$ISolverShell,Microsoft$Msagl$Layout$Layered$LayerInfo,Microsoft$Msagl$Core$ProjectionSolver$SolverShell,Microsoft$Msagl$Layout$Layered$SweepMode,Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster,Microsoft$Msagl$Core$Geometry$OverlapRemovalGlobalConfiguration,Microsoft$Msagl$Core$Geometry$OverlapRemovalParameters,Microsoft$Msagl$DebugHelpers$ClusterWithChildLists,Microsoft$Msagl$DebugHelpers$GeometryToken,Microsoft$Msagl$Layout$Layered$ProperLayeredGraph,Microsoft$Msagl$Layout$Layered$LayerCalculator,Microsoft$Msagl$Core$GraphAlgorithms$TopologicalSort,Microsoft$Msagl$Layout$Layered$LongestPathLayering,Microsoft$Msagl$Layout$Layered$NetworkSimplex,Microsoft$Msagl$Layout$Layered$Ordering,Microsoft$Msagl$Layout$Layered$EdgePathsInserter,Microsoft$Msagl$Layout$Layered$LayerInserter,Microsoft$Msagl$Layout$Layered$Balancing,Microsoft$Msagl$Core$GraphAlgorithms$BasicGraph$2,Microsoft$Msagl$Core$GraphAlgorithms$BasicGraph$1,Microsoft$Msagl$Layout$Layered$Database,Microsoft$Msagl$Core$Layout$Edge,Microsoft$Msagl$Layout$Layered$IntEdge,Microsoft$Msagl$Core$GraphAlgorithms$IntPair,Microsoft$Msagl$Layout$Layered$LayerArrays,Microsoft$Msagl$Layout$Layered$SnapToGridByY,Microsoft$Msagl$Layout$Layered$SugiyamaLayoutSettings,Microsoft$Msagl$Core$Layout$LayoutAlgorithmSettings,Microsoft$Msagl$Core$Layout$Node,Microsoft$Msagl$Layout$Layered$Anchor,Microsoft$Msagl$Core$DataStructures$Set$1,Microsoft$Msagl$Layout$Layered$LayerEdge,Microsoft$Msagl$Layout$Layered$SuccEnumerator,Microsoft$Msagl$Layout$Layered$PredEnumerator,Microsoft$Msagl$Layout$Layered$EmptyEnumerator,Microsoft$Msagl$Layout$Layered$Pred,Microsoft$Msagl$Layout$Layered$Succ,Microsoft$Msagl$Layout$Layered$XLayoutGraph,Microsoft$Msagl$Layout$Layered$OrderingMeasure,Microsoft$Msagl$Core$ProjectionSolver$Block,Microsoft$Msagl$Core$ProjectionSolver$BlockVector,Microsoft$Msagl$Core$ProjectionSolver$Constraint,Microsoft$Msagl$Core$ProjectionSolver$ConstraintVector,Microsoft$Msagl$Core$ProjectionSolver$DfDvNode,Microsoft$Msagl$Core$ProjectionSolver$GlobalConfiguration,Microsoft$Msagl$Core$ProjectionSolver$Parameters,Microsoft$Msagl$Core$ProjectionSolver$AdvancedParameters,Microsoft$Msagl$Core$ProjectionSolver$Qpsc,Microsoft$Msagl$Core$ProjectionSolver$Solution,Microsoft$Msagl$Core$ProjectionSolver$Solver,Microsoft$Msagl$Core$ProjectionSolver$Variable,Microsoft$Msagl$Core$ProjectionSolver$ViolationCache,Microsoft$Msagl$Core$Geometry$ConstraintGenerator,Microsoft$Msagl$Core$Geometry$OverlapRemovalNode,Microsoft$Msagl$Core$Geometry$NodeComparer,Microsoft$Msagl$Routing$Rectilinear$Nudging$SegWithIndex,Microsoft$Msagl$Routing$Rectilinear$Nudging$StaircaseRemover,Microsoft$Msagl$Routing$Rectilinear$GroupBoundaryCrossing,Microsoft$Msagl$Routing$Rectilinear$GroupBoundaryCrossingMap,Microsoft$Msagl$Routing$Rectilinear$PointAndCrossings,Microsoft$Msagl$Routing$Rectilinear$PointAndCrossingsList,Microsoft$Msagl$Routing$Rectilinear$ObstacleTree,Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSpannerForPortLocations,Microsoft$Msagl$Layout$Layered$FlatEdgeRouter,Microsoft$Msagl$Core$Geometry$HitTestBehavior,Microsoft$Msagl$Routing$InteractiveEdgeRouter,Microsoft$Msagl$Routing$InteractiveObstacleCalculator,Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdge,Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdgesContainer,Microsoft$Msagl$Routing$Rectilinear$Nudging$CombinatorialNudger,Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdgeHighPointEvent,Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdgeLowPointEvent,Microsoft$Msagl$Core$DataStructures$ComparerOnDelegate$1,Microsoft$Msagl$Routing$Rectilinear$Nudging$FreeSpaceFinder,Microsoft$Msagl$Routing$Rectilinear$Nudging$LinkedPointSplitter,Microsoft$Msagl$Routing$Rectilinear$Nudging$Nudger,Microsoft$Msagl$Routing$Rectilinear$Nudging$PointProjection,Microsoft$Msagl$Core$ProjectionSolver$UniformOneDimensionalSolver,Microsoft$Msagl$Routing$Rectilinear$Nudging$LinkedPoint,Microsoft$Msagl$Routing$Rectilinear$Nudging$PathRefiner,Microsoft$Msagl$Routing$Rectilinear$Nudging$PointByDelegateComparer,Microsoft$Msagl$Core$ProjectionSolver$UniformSolverVar,Microsoft$Msagl$Routing$Rectilinear$Nudging$SpaceCalculationEvent,Microsoft$Msagl$Routing$Rectilinear$Nudging$PathEdge,Microsoft$Msagl$Routing$Rectilinear$Nudging$LongestNudgedSegment,Microsoft$Msagl$Routing$Rectilinear$Nudging$Path,Microsoft$Msagl$Core$Geometry$RectangleNode$1,Microsoft$Msagl$Routing$Rectilinear$BasicObstacleSide,Microsoft$Msagl$Routing$Rectilinear$BasicReflectionEvent,Microsoft$Msagl$Routing$Rectilinear$BasicVertexEvent,Microsoft$Msagl$Routing$Rectilinear$OpenVertexEvent,Microsoft$Msagl$Core$Geometry$Directions,Microsoft$Msagl$Core$Geometry$CompassVector,Microsoft$Msagl$Routing$Rectilinear$HighBendVertexEvent,Microsoft$Msagl$Routing$Rectilinear$LowBendVertexEvent,Microsoft$Msagl$Routing$Rectilinear$ScanSegmentTree,Microsoft$Msagl$Routing$Rectilinear$StaticGraphUtility,Microsoft$Msagl$Routing$Rectilinear$CloseVertexEvent,Microsoft$Msagl$Routing$Rectilinear$TransientGraphUtility,Microsoft$Msagl$Routing$Visibility$PortObstacleEvent,Microsoft$Msagl$Routing$Visibility$TollFreeVisibilityEdge,Microsoft$Msagl$Routing$Rectilinear$EventQueue,Microsoft$Msagl$Routing$Rectilinear$FreePoint,Microsoft$Msagl$Routing$Rectilinear$HighObstacleSide,Microsoft$Msagl$Routing$Rectilinear$LowReflectionEvent,Microsoft$Msagl$Routing$Rectilinear$LookaheadScan,Microsoft$Msagl$Routing$Rectilinear$LowObstacleSide,Microsoft$Msagl$Routing$Rectilinear$MsmtRectilinearPath,Microsoft$Msagl$Routing$Rectilinear$Obstacle,Microsoft$Msagl$Routing$Rectilinear$ObstaclePort,Microsoft$Msagl$Routing$Rectilinear$ObstaclePortEntrance,Microsoft$Msagl$Routing$Rectilinear$PortManager,Microsoft$Msagl$Routing$Rectilinear$RectilinearInteractiveEditor,Microsoft$Msagl$Routing$RelativeShape,Microsoft$Msagl$Routing$Shape,Microsoft$Msagl$Routing$Rectilinear$Nudging$PathMerger,Microsoft$Msagl$Routing$Rectilinear$SpliceUtility,Microsoft$Msagl$Routing$Rectilinear$SsstRectilinearPath,Microsoft$Msagl$Routing$Rectilinear$RectilinearEdgeRouter,Microsoft$Msagl$Routing$Rectilinear$HighReflectionEvent,Microsoft$Msagl$Routing$Rectilinear$ScanDirection,Microsoft$Msagl$Routing$Rectilinear$RectilinearScanLine,Microsoft$Msagl$Routing$Rectilinear$ScanSegment,Microsoft$Msagl$Routing$Rectilinear$SegmentIntersector,Microsoft$Msagl$Routing$Rectilinear$WaypointPort,Microsoft$Msagl$Routing$RelaxedPolylinePoint,Microsoft$Msagl$Layout$Layered$HierarchyCalculator,Microsoft$Msagl$Routing$NodeKind,Microsoft$Msagl$Layout$Layered$Points,Microsoft$Msagl$Layout$Layered$RefinerBetweenTwoLayers,Microsoft$Msagl$Layout$Layered$Routing,Microsoft$Msagl$Routing$SplineRouter,Microsoft$Msagl$Routing$SingleSourceSingleTargetShortestPathOnVisibilityGraph,Microsoft$Msagl$Layout$Layered$SmoothedPolylineCalculator,Microsoft$Msagl$Layout$Layered$TwoLayerFlatEdgeRouter,Microsoft$Msagl$DebugHelpers$DevTrace,Microsoft$Msagl$Routing$Spline$ConeSpanner$Cone,Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeClosureEvent,Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeLeftSide,Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeRightSide,Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSpanner,Microsoft$Msagl$Core$Geometry$Curves$ClosestPointOnCurve,Microsoft$Msagl$Core$Geometry$Curves$CubicBezierSegment,Microsoft$Msagl$Core$Geometry$Curves$CurvatureDerivative,Microsoft$Msagl$Core$Geometry$Curves$Curve,Microsoft$Msagl$Core$Geometry$Curves$CurveFactory,Microsoft$Msagl$Core$Geometry$Curves$CurveTangent,Microsoft$Msagl$Core$Geometry$Curves$Ellipse,Microsoft$Msagl$Core$Geometry$Curves$ICurve,Microsoft$Msagl$Core$Geometry$Curves$IFunction,Microsoft$Msagl$Core$Geometry$Curves$IntersectionInfo,Microsoft$Msagl$Core$Geometry$Curves$LinearSystem2,Microsoft$Msagl$Core$Geometry$Curves$LineSegment,Microsoft$Msagl$Core$Geometry$Curves$MinDistCurveCurve,Microsoft$Msagl$Core$Geometry$Curves$VertexId,Microsoft$Msagl$Core$Geometry$Curves$Parallelogram,Microsoft$Msagl$Core$Geometry$Curves$ParallelogramBinaryTreeNode,Microsoft$Msagl$Core$Geometry$Curves$ParallelogramInternalTreeNode,Microsoft$Msagl$Core$Geometry$Curves$ParallelogramLeaf,Microsoft$Msagl$Core$Geometry$Curves$ParallelogramNode,Microsoft$Msagl$Core$Geometry$Curves$ParallelogramNodeOverICurve,Microsoft$Msagl$Core$Geometry$Curves$PenetrationDepth,Microsoft$Msagl$Core$Geometry$Curves$PlaneTransformation,Microsoft$Msagl$Core$Geometry$Curves$PolylinePoint,Microsoft$Msagl$Core$Geometry$Curves$PointLocation,Microsoft$Msagl$Core$Geometry$Curves$Polyline,Microsoft$Msagl$Core$Geometry$Curves$PolylineIterator,Microsoft$Msagl$Core$Geometry$Rectangle,Microsoft$Msagl$Core$Geometry$Curves$RootFinder,Microsoft$Msagl$Routing$Visibility$ActiveDiagonalComparerWithRay,Microsoft$Msagl$Routing$Visibility$ActiveEdgeComparerWithRay,Microsoft$Msagl$Routing$Visibility$BimodalSequence,Microsoft$Msagl$Routing$Spline$ConeSpanner$IConeSweeper,Microsoft$Msagl$Routing$Spline$ConeSpanner$LeftIntersectionEvent,Microsoft$Msagl$Routing$Spline$ConeSpanner$LeftObstacleSide,Microsoft$Msagl$Routing$Spline$ConeSpanner$LineSweeperForPortLocations,Microsoft$Msagl$Routing$Spline$ConeSpanner$PortLocationEvent,Microsoft$Msagl$Routing$Visibility$LineSweeperBase,Microsoft$Msagl$Routing$Spline$ConeSpanner$LowestVertexEvent,Microsoft$Msagl$Routing$Spline$ConeSpanner$ObstacleSide,Microsoft$Msagl$Routing$Visibility$ObstacleSideComparer,Microsoft$Msagl$Routing$Spline$ConeSpanner$RightIntersectionEvent,Microsoft$Msagl$Routing$Spline$ConeSpanner$LeftVertexEvent,Microsoft$Msagl$Routing$Spline$ConeSpanner$LineSweeper,Microsoft$Msagl$Routing$Spline$ConeSpanner$SweepEvent,Microsoft$Msagl$Routing$Spline$ConeSpanner$BrokenConeSide,Microsoft$Msagl$Routing$Spline$ConeSpanner$RightObstacleSide,Microsoft$Msagl$Routing$Spline$ConeSpanner$RightVertexEvent,Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSide,Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSideComparer,Microsoft$Msagl$Routing$Spline$ConeSpanner$VertexEvent,Microsoft$Msagl$Routing$Visibility$Diagonal,Microsoft$Msagl$Routing$Visibility$InteractiveTangentVisibilityGraphCalculator,Microsoft$Msagl$Routing$Rectilinear$PointComparer,Microsoft$Msagl$Routing$Visibility$PointVisibilityCalculator,Microsoft$Msagl$Routing$Visibility$Polygon,Microsoft$Msagl$Routing$Visibility$SegmentBase,Microsoft$Msagl$Routing$Visibility$StemStartPointComparer,Microsoft$Msagl$Routing$Visibility$UnimodalSequence,Microsoft$Msagl$Routing$Visibility$VisibilityKind,Microsoft$Msagl$Routing$Visibility$VisibilityEdge,Microsoft$Msagl$Routing$Visibility$VisibilityGraph,Microsoft$Msagl$Routing$Visibility$VisibilityVertex,Microsoft$Msagl$Routing$Visibility$Stem,Microsoft$Msagl$Routing$Visibility$Tangent,Microsoft$Msagl$Routing$Visibility$TangentPair,Microsoft$Msagl$Routing$Visibility$TangentVisibilityGraphCalculator,Microsoft$Msagl$Layout$Layered$XCoordsWithAlignment,Microsoft$Msagl$Core$ValidateArg,Microsoft$Msagl$GraphmapsWithMesh$PlanarGraphUtilities$Face,Test$Test$TestEnum,Test$Test$TestInner,Test$Test$TestInner$TestInnerEnum,Microsoft$Msagl$Core$Geometry$OptimalPacking$PackingFactory$1,Microsoft$Msagl$Core$Layout$EdgeLabelPlacement$PointSet,Microsoft$Msagl$Core$Layout$EdgeLabelPlacement$PointSetList,Microsoft$Msagl$Core$Layout$EdgeLabelPlacement$PointComparer,Microsoft$Msagl$Core$Layout$LgNodeInfo$LabelPlacement,Microsoft$Msagl$Layout$LargeGraphLayout$LgInteractor$RankComparer,Microsoft$Msagl$Layout$LargeGraphLayout$LgLayoutSettings$LgLayoutEvent,Microsoft$Msagl$Layout$LargeGraphLayout$LgLevel$TileStatistic,Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst$Segment,Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst$SiteType,Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst$TreeNode,Microsoft$Msagl$Prototype$LayoutEditing$ObstacleCalculator$Visitor,Microsoft$Msagl$Prototype$LayoutEditing$ObstacleCalculator$PolylineGraph,Microsoft$Msagl$Routing$Rectilinear$EnumeratorWrapper$MoveNextState$1,Microsoft$Msagl$Routing$Rectilinear$VisibilityGraphGenerator$NeighborSides,Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$ScanSegmentVectorItem,Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$ScanSegmentVector,Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$HorizontalPointComparer,Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$VerticalPointComparer,Microsoft$Msagl$Routing$SingleSourceMultipleTargetsShortestPathOnVisibilityGraph$ddType,Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering$MetroEdge,Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering$PathList,Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering$PathOnEdge,Microsoft$Msagl$Routing$Spline$Bundling$TimeMeasurer$Task,Microsoft$Msagl$Core$GraphAlgorithms$CycleRemoval$VertStatus$1,Microsoft$Msagl$Layout$Incremental$AxisSolver$InitialCenterDelegateType,Microsoft$Msagl$Layout$MDS$PivotMDS$PivotMDSNodeWrap,Microsoft$Msagl$Layout$Incremental$EdgeConstraintGenerator$AddConstraint,Microsoft$Msagl$Layout$Incremental$KDTree$Particle,Microsoft$Msagl$Layout$Incremental$KDTree$KdNode,Microsoft$Msagl$Layout$Incremental$KDTree$LeafKdNode,Microsoft$Msagl$Layout$Incremental$KDTree$InternalKdNode,Microsoft$Msagl$Layout$Incremental$KDTree$SplitQueue,Microsoft$Msagl$Layout$Incremental$KDTree$Particle$Dim,Microsoft$Msagl$Core$Geometry$MoveToFront$MinDisc,Microsoft$Msagl$Layout$Incremental$MultipoleCoefficients$Complex,Microsoft$Msagl$Core$Geometry$RectangularClusterBoundary$Margin,Microsoft$Msagl$Core$Layout$GraphConnectedComponents$AlgorithmDataNodeWrap,Microsoft$Msagl$Core$Layout$GraphConnectedComponents$AlgorithmDataEdgeWrap,Microsoft$Msagl$Core$Layout$Label$PlacementSide,Microsoft$Msagl$Core$Layout$Label$PlacementStrategy,Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$ClusterItem,Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$ClusterDelegate,Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$Event,Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$ScanLine,Microsoft$Msagl$Layout$Layered$NetworkSimplex$StackStruct,Microsoft$Msagl$Layout$Layered$NetworkSimplex$IncEdges,Microsoft$Msagl$Layout$Layered$NetworkSimplex$IncEdgeEnumerator,Microsoft$Msagl$Core$ProjectionSolver$Block$ConstraintDirectionPair,Microsoft$Msagl$Core$ProjectionSolver$Qpsc$MatrixCell,Microsoft$Msagl$Core$ProjectionSolver$Qpsc$QpscVar,Microsoft$Msagl$Core$ProjectionSolver$Solver$ConstraintListForVariable,Microsoft$Msagl$Core$ProjectionSolver$Variable$NeighborAndWeight,Microsoft$Msagl$Routing$Rectilinear$Nudging$FreeSpaceFinder$FreeSpaceFinderComparer,Microsoft$Msagl$Routing$Rectilinear$MsmtRectilinearPath$WaypointEntry,Microsoft$Msagl$Routing$Rectilinear$SsstRectilinearPath$NextNeighbor,Microsoft$Msagl$Routing$Rectilinear$SegmentIntersector$SegEvent,Microsoft$Msagl$Routing$Rectilinear$SegmentIntersector$SegEventType,Microsoft$Msagl$Core$Geometry$Curves$ParallelogramNodeOverICurve$B,Microsoft$Msagl$Routing$Visibility$InteractiveTangentVisibilityGraphCalculator$FilterVisibleEdgesDelegate,Microsoft$Msagl$Routing$Visibility$UnimodalSequence$Behavior,Microsoft$Msagl$Routing$Visibility$TangentVisibilityGraphCalculator$FilterVisibleEdgesDelegate,Microsoft$Msagl$Core$ValidateArg$ValidatedNotNullAttribute;typeof $CreateException=="undefined"&&($CreateException=function(n,t){t==null&&(t=new Error);n==null&&(n=new System.Exception.ctor);t.message=n.message;for(var i in n)t[i]=n[i];return t});typeof $CreateAnonymousDelegate=="undefined"&&($CreateAnonymousDelegate=function(n,t){if(n==null||t==null)return t;var i=function(){return t.apply(n,arguments)};return i.func=t,i.target=n,i.isDelegate=!0,i});typeof $CreateDelegate=="undefined"&&(typeof $iKey=="undefined"&&($iKey=0),typeof $pKey=="undefined"&&($pKey=String.fromCharCode(1)),$CreateDelegate=function(n,t){if(n==null||t==null||t.target==n&&t.func==t)return t;n.$delegateCache==null&&(n.$delegateCache={});t.$key==null&&(t.$key=$pKey+String(++$iKey));var i;return n.$delegateCache!=null&&(i=n.$delegateCache[t.$key]),i==null&&(i=function(){return t.apply(n,arguments)},i.func=t,i.target=n,i.isDelegate=!0,n.$delegateCache!=null&&(n.$delegateCache[t.$key]=i)),i});typeof Int32Array=="undefined"&&(Int32Array=Array);typeof Float64Array=="undefined"&&(Float64Array=Array);typeof Uint8Array=="undefined"&&(Uint8Array=Array);typeof Float32Array=="undefined"&&(Float32Array=Array);typeof $CreateAnonymousObject=="undefined"&&($CreateAnonymousObject=function(n){var t=new System.Object.ctor,i;t.d=n;for(i in n)t["get_"+i]=new Function("return this.d."+i+";");return t});typeof JsTypes=="undefined"&&(JsTypes=[]);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$GTreeOverlapRemoval={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval",baseTypeName:"System.Object",staticDefinition:{RemoveOverlaps$$Node$Array$$Double:function(n,t){var i=function(){var n=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.OverlapRemovalSettings.ctor;return n.set_RandomizeAllPointsOnStart(!0),n.set_NodeSeparation(t),n}(),r=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.ctor$$OverlapRemovalSettings$$Node$Array(i,n);r.RemoveOverlaps()},AvgEdgeLength:function(n){for(var t=0,i=0,r=System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Edge.ctor,n,function(n){return n.get_OutEdges()}).GetEnumerator();r.MoveNext();){var u=r.get_Current(),f=u.get_Source().get_Center(),e=u.get_Target().get_Center(),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,e).get_Length();i+=o;t++}return t==0?1:i/t},GetIdealEdgeLength$$Int32$$Int32$$Point$$Point$$Size$Array$$Boolean:function(n,t,i,r,u,f){var e,a=function(){var f={Value:e},o=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.GetIdealEdgeLength$$Int32$$Int32$$Point$$Point$$Size$Array$$Double(n,t,i,r,u,f);return e=f.Value,o}(),p=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r).get_Length(),o,s,h,v,y,c,l;return f?(h=System.Math.Max$$Int32$$Int32(n,t),o=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Size$$Point(u[h],i),s=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Size$$Point(u[h],r)):(o=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Size$$Point(u[n],i),s=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Size$$Point(u[t],r)),v=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.GetDistanceRects(o,s),y=e>1?-(a-p):v,c=n,l=t,n>t&&(c=t,l=n),System.Tuple.Create$5$$T1$$T2$$T3$$T4$$T5(System.Int32.ctor,System.Int32.ctor,System.Double.ctor,System.Double.ctor,System.Double.ctor,c,l,e,a,y)},GetIdealEdgeLength$$Int32$$Int32$$Point$$Point$$Size$Array$$Double:function(n,t,i,r,u,f){if(u==null)throw $CreateException(new System.ArgumentNullException.ctor$$String("nodeBoxes"),new Error);var l=1e-16,a=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r).get_Length(),o=System.Math.Abs$$Double(i.get_X()-r.get_X()),s=System.Math.Abs$$Double(i.get_Y()-r.get_Y()),h=u[n].get_Width()/2+u[t].get_Width()/2,c=u[n].get_Height()/2+u[t].get_Height()/2,e;return e=o<l*h?c/s:s<l*c?h/o:System.Math.Min$$Double$$Double(h/o,c/s),e>1&&(e=System.Math.Max$$Double$$Double(e,1.001)),e=System.Math.Min$$Double$$Double(1.5,e),e=System.Math.Max$$Double$$Double(1,e),f.Value=e,e*a},GetDistanceRects:function(n,t){var i,r;return n.Intersects(t)?0:(i=0,r=0,n.get_Right()<t.get_Left()?i=n.get_Left()-t.get_Right():t.get_Right()<n.get_Left()&&(i=n.get_Left()-t.get_Right()),n.get_Top()<t.get_Bottom()?r=t.get_Bottom()-n.get_Top():t.get_Top()<n.get_Bottom()&&(r=n.get_Bottom()-t.get_Top()),System.Math.Sqrt(i*i+r*r))},MoveNodePositions:function(n,t,i){var e=t.Clone()instanceof Array||t.Clone()==null?t.Clone():function(){throw new Error("InvalidCastException");}(),r=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor),f,u;for(r.Insert(i),f=0;f<n.get_Count();f++)u=n.get_Item$$Int32(f),r.Contains$$T(u.get_Item1())?Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.MoveUpperSite(u,t,e,r):(System.Diagnostics.Debug.Assert$$Boolean(r.Contains$$T(u.get_Item2())),Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.MoveLowerSite(u,t,e,r))},MoveUpperSite:function(n,t,i,r){var o=n.get_Item4(),u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i[n.get_Item2()],i[n.get_Item1()]),s=u.get_Length(),e,f;u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(u,o/s+.01);e=n.get_Item1();f=n.get_Item2();t[f]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t[e],u);r.Insert(f)},MoveLowerSite:function(n,t,i,r){var o=n.get_Item4(),u=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(i[n.get_Item2()]),i[n.get_Item1()]),s=u.get_Length(),e,f;u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(u,o/s+.01);e=n.get_Item2();f=n.get_Item1();t[f]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t[e],u);r.Insert(f)},RemoveOverlapsForLayers:function(n,t){var i=function(){var n=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.OverlapRemovalSettings.ctor;return n.set_RandomizeAllPointsOnStart(!0),n}(),r=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.ctor$$OverlapRemovalSettings$$Node$Array$$Size$Array(i,n,t);r.RemoveOverlaps()}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.IOverlapRemoval"],Kind:"Class",definition:{ctor$$OverlapRemovalSettings$$Node$Array:function(n,t){this._settings=null;this._sizes=null;this._overlapForLayers=!1;this.lastRunNumberIterations=0;this._nodes=null;System.Object.ctor.call(this);this._settings=n;this._nodes=t},ctor$$OverlapRemovalSettings$$Node$Array$$Size$Array:function(n,t,i){this._settings=null;this._sizes=null;this._overlapForLayers=!1;this.lastRunNumberIterations=0;this._nodes=null;System.Object.ctor.call(this);this._overlapForLayers=!0;this._settings=n;this._sizes=i;this._nodes=t},RemoveOverlaps:function(){var n,t,i;if(this._nodes.length<3){this.RemoveOverlapsOnTinyGraph();return}for(function(){var i={Value:n},r={Value:t},u=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.InitNodePositionsAndBoxes(this._settings,this._nodes,i,r);return n=i.Value,t=r.Value,u}.call(this),this._overlapForLayers&&(t=this._sizes),this.lastRunNumberIterations=0;this.OneIteration(n,t,!1);)this.lastRunNumberIterations++;while(this.OneIteration(n,t,!0))this.lastRunNumberIterations++;for(System.Console.WriteLine(),i=0;i<this._nodes.length;i++)this._nodes[i].set_Center(n[i])},RemoveOverlapsOnTinyGraph:function(){if(this._nodes.length!=1&&this._nodes.length==2){var r=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,this._nodes),t=r[0],n=r[1];Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(t.get_Center(),n.get_Center())&&n.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Center(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(.001,0)));var f=this.GetIdealDistanceBetweenTwoNodes(t,n),u=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Center(),n.get_Center()),2),i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Center(),n.get_Center()),e=i.get_Length();i=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(i,.5*f/e);t.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(u,i));n.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u,i))}},GetIdealDistanceBetweenTwoNodes:function(n,t){var i=n.get_BoundingBox().Clone(),r=t.get_BoundingBox().Clone();i.Pad$$Double(this._settings.get_NodeSeparation()/2);r.Pad$$Double(this._settings.get_NodeSeparation()/2);var l=i.get_Center(),a=r.get_Center(),u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(l,a),f=System.Math.Abs$$Double(u.get_X()),e=System.Math.Abs$$Double(u.get_Y()),o=i.get_Width()/2+r.get_Width()/2,s=i.get_Height()/2+r.get_Height()/2,h=1e-16,c;return c=f<h*o?s/e:e<h*s?o/f:System.Math.Min$$Double$$Double(o/f,s/e),c*u.get_Length()},OneIteration:function(n,t,i){for(var u,f,y,h,c,d,l,g,a=new Array(n.length),r=0;r<n.length;r++)a[r]=System.Tuple.Create$2$$T1$$T2(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Object.ctor,n[r],r);for(u=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.ctor$$IEnumerable$1(a),u.Run(),f=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.CdtSite.ctor,System.Int32.ctor),r=0;r<n.length;r++)f.set_Item$$TKey(u.PointsToSites.get_Item$$TKey(n[r]),r);for(var e=0,s=new System.Collections.Generic.List$1.ctor(System.Tuple$5.ctor),v=u.PointsToSites.get_Values().GetEnumerator();v.MoveNext();)for(y=v.get_Current(),h=y.Edges.GetEnumerator();h.MoveNext();){var o=h.get_Current(),p=o.upperSite.Point,w=o.lowerSite.Point,b=f.get_Item$$TKey(o.upperSite),k=f.get_Item$$TKey(o.lowerSite);System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(p,n[b]));System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(w,n[k]));c=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.GetIdealEdgeLength$$Int32$$Int32$$Point$$Point$$Size$Array$$Boolean(b,k,p,w,t,this._overlapForLayers);s.Add(c);c.get_Item3()>1&&e++}return(e==0||i)&&((d=this.FindProximityEdgesWithSweepLine(s,t,n),e==0&&d==0)||e==0&&!i)?!1:(l=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.MstOnDelaunayTriangulation.GetMstOnTuple(s,n.length),g=System.Linq.Enumerable.First$1$$IEnumerable$1(System.Tuple$5.ctor,l).get_Item1(),Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.MoveNodePositions(l,n,g),!0)},FindProximityEdgesWithSweepLine:function(n,t,i){var r=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.MstLineSweeper.ctor(n,t,i,this._overlapForLayers);return r.Run()},GetLastRunIterations:function(){return this.lastRunNumberIterations}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$GTreeOverlapRemoval);Microsoft$Msagl$GraphmapsWithMesh$Angle={fullname:"Microsoft.Msagl.GraphmapsWithMesh.Angle",baseTypeName:"System.Object",staticDefinition:{getAngleIfSmallerThanPIby2:function(n,t,i){var r=n.XLoc-t.XLoc,u=n.YLoc-t.YLoc,f=n.XLoc-i.XLoc,e=n.YLoc-i.YLoc;return t.XLoc>=n.XLoc&&i.XLoc>=n.XLoc&&t.YLoc>=n.YLoc&&i.YLoc>=n.YLoc?System.Math.Abs$$Double(System.Math.Atan2(u,r)-System.Math.Atan2(e,f)):t.XLoc>=n.XLoc&&i.XLoc<=n.XLoc&&t.YLoc>=n.YLoc&&i.YLoc<=n.YLoc?System.Math.Abs$$Double(System.Math.Atan2(u,r)-System.Math.Atan2(e,f)):t.XLoc<=n.XLoc&&i.XLoc>=n.XLoc&&t.YLoc<=n.YLoc&&i.YLoc>=n.YLoc?System.Math.Abs$$Double(System.Math.Atan2(u,r)-System.Math.Atan2(e,f)):t.XLoc<=n.XLoc&&i.XLoc<=n.XLoc&&t.YLoc<=n.YLoc&&i.YLoc<=n.YLoc?System.Math.Abs$$Double(System.Math.Atan2(u,r)-System.Math.Atan2(e,f)):1.5707963267949},getClockwiseAngle:function(n,t,i){var u=n.XLoc-t.XLoc,f=n.YLoc-t.YLoc,e=n.XLoc-i.XLoc,o=n.YLoc-i.YLoc,s=u*e+f*o,h=u*o-f*e,r=System.Math.Atan2(h,s);return r<0&&(r=6.28318530717959+r),System.Math.Abs$$Double(r)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$Angle);Microsoft$Msagl$GraphmapsWithMesh$ComponentCollection={fullname:"Microsoft.Msagl.GraphmapsWithMesh.ComponentCollection",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){var u,f,e,o;for(this.NumOfComponents=0,this.NumOfAliveComponents=0,this.C=null,System.Object.ctor.call(this),u=0,this.C=new Array(t+1),f=1;f<=t;f++)(n[f].CId=0,n[f].Weight!=0&&n[f].ZoomLevel==r)&&(i!=null&&i.V.Contains(n[f])||(u++,this.C[u]=function(){var n=new Microsoft.Msagl.GraphmapsWithMesh.Component.ctor;return n.CId=u,n}.call(this),this.C[u].V.Add(n[f]),this.C[u].Dead=!1,n[f].CId=this.C[u].CId,this.NumOfComponents++));if(i!=null){for(u++,this.C[u]=i,this.C[u].CId=u,this.C[u].Dist=0,this.C[u].Dead=!1,e=this.C[u].V.GetEnumerator();e.MoveNext();)o=e.get_Current(),o.CId=this.C[u].CId;this.NumOfComponents++}this.NumOfAliveComponents=this.NumOfComponents;System.Console.WriteLine$$String(" Number of components:"+this.NumOfAliveComponents)}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$ComponentCollection);Microsoft$Msagl$GraphmapsWithMesh$DijkstraAlgo={fullname:"Microsoft.Msagl.GraphmapsWithMesh.DijkstraAlgo",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.Edgelist=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.VertexNeighbor.ctor);this.ShortestPath=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);this.Distance=0;this.PathExists=!0;System.Object.ctor.call(this)},getMin:function(n){for(var u=1.79769313486232E+308,i=null,f=n.GetEnumerator(),r,t;f.MoveNext();)t=f.get_Current(),u>t.Dist&&(u=t.Dist,i=t);if(i==null)return System.Console.WriteLine$$String("Graph is disconnected"),null;for(r=n.GetEnumerator();r.MoveNext();)if(t=r.get_Current(),t.Id==i.Id){n.Remove(i);break}return i},SelectShortestPath:function(n,t,i,r,u,f){var c=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor),h,s,l,a,v,e,o;for(n[r].Dist=0,c.Add(n[r]),h=1;h<=f;h++)n[h].Id!=n[r].Id&&(n[h].Dist=1.79769313486232E+308,c.Add(n[h])),n[h].Parent=null,n[h].Visited=!1;for(this.Edgelist.Clear(),this.Distance=0;c.get_Count()>0;){if(s=this.getMin(c),s.Visited)continue;else s.Visited=!0;for(o=1;o<=i[s.Id];o++)(l=t[(s.Id,o)].NodeId,a=0,t[(s.Id,o)].Selected==0&&(a=1e3),n[t[(s.Id,o)].NodeId].Weight>0&&t[(s.Id,o)].NodeId!=n[u].Id)||(v=s.Dist+t[(s.Id,o)].GetEDist(n,s.Id,t[(s.Id,o)].NodeId)+a,v<n[l].Dist&&(n[l].Dist=v,n[l].Parent=s));if(s.Id==n[u].Id)break}for(e=n[u];e.Parent!=null;){for(o=1;o<=i[e.Id];o++)if(t[(e.Id,o)].NodeId==e.Parent.Id){this.Edgelist.Add(new Microsoft.Msagl.GraphmapsWithMesh.VertexNeighbor.ctor(e.Id,o));this.Distance+=System.Math.Sqrt((e.XLoc-e.Parent.XLoc)*(e.XLoc-e.Parent.XLoc)+(e.YLoc-e.Parent.YLoc)*(e.YLoc-e.Parent.YLoc));break}for(o=1;o<=i[e.Parent.Id];o++)if(t[(e.Parent.Id,o)].NodeId==e.Id){this.Edgelist.Add(new Microsoft.Msagl.GraphmapsWithMesh.VertexNeighbor.ctor(e.Parent.Id,o));break}e=e.Parent}e.Id!=n[r].Id&&System.Console.WriteLine$$String("path not found")},MSAGLAstarShortestPath:function(n,t,i,r,u,f){var l=new Microsoft.Msagl.Core.DataStructures.BinaryHeapPriorityQueue.ctor(f),c,v,o,y,a,w,e,b,h;for(n[r].Dist=0,n[r].Weight=n[r].Dist+Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.EucledianDistance(n[r].XLoc,n[r].YLoc,n[u].XLoc,n[u].YLoc),l.Enqueue(r,n[r].Weight),c=0;c<f;c++)n[c].Id!=r&&(n[c].Dist=1.79769313486232E+308,n[c].Weight=1.79769313486232E+308,l.Enqueue(c,n[c].Weight)),n[c].Parent=null,n[c].Visited=!1;for(this.Edgelist.Clear(),this.ShortestPath.Clear(),this.Distance=0;l.get_Count()>0;){if(v=l.Dequeue(),o=n[v],o.Visited=!0,o==null||o.Invalid)return new System.Collections.Generic.List$1.ctor(System.Int32.ctor);for(h=0;h<i[o.Id];h++){y=t[(o.Id,h)].NodeId;a=0;t[(o.Id,h)].Selected==1&&(a=1e3);(t[(o.Id,h)].NodeId==r||t[(o.Id,h)].NodeId==u)&&(a=0);(o.Id==r||o.Id==u)&&(a=0);var s=n[y],k=Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.EucledianDistance(o.XLoc,o.YLoc,s.XLoc,s.YLoc),p=o.Dist+k+a;p>=s.Dist||(s.Dist=p,w=s.Dist+Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.EucledianDistance(n[u].XLoc,n[u].YLoc,s.XLoc,s.YLoc),s.Weight=w,s.Parent=o,s.Visited?(s.Visited=!1,l.Enqueue(s.Id,s.Weight)):l.DecreasePriority(s.Id,s.Weight))}if(o.Id==u)break}for(e=n[u],b=System.Math.Max$$Int32$$Int32(n[r].ZoomLevel,n[u].ZoomLevel);e.Parent!=null;){for(this.ShortestPath.Add(e.Id),h=0;h<i[e.Id];h++)if(t[(e.Id,h)].NodeId==e.Parent.Id){this.SetUsed(n,t,i,e.Id,t[(e.Id,h)].NodeId,b);this.Edgelist.Add(new Microsoft.Msagl.GraphmapsWithMesh.VertexNeighbor.ctor(e.Id,h));this.Distance+=System.Math.Sqrt((e.XLoc-e.Parent.XLoc)*(e.XLoc-e.Parent.XLoc)+(e.YLoc-e.Parent.YLoc)*(e.YLoc-e.Parent.YLoc));break}e=e.Parent}return this.ShortestPath.Add(e.Id),e.Id!=r&&System.Console.WriteLine$$String("path not found"),this.ShortestPath},MSAGLGreedy:function(n,t,i,r,u,f){for(var s,c,a,v,y,l,e,p,o,h=0;h<f;h++)n[h].Parent=null,n[h].Visited=!1;for(this.Edgelist.Clear(),this.ShortestPath.Clear(),this.Distance=0,s=n[r],y=0;;){if(s==null||s.Invalid)return;for(s.Visited=!0,a=1.79769313486232E+308,c=-1,o=0;o<i[s.Id];o++)(l=t[(s.Id,o)].NodeId,n[l].Visited)||(y=t[(s.Id,o)].Selected==1?1e3:0,v=Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.EucledianDistance(n[l].XLoc,n[l].YLoc,n[u].XLoc,n[u].YLoc)+y,v<a&&(a=v,c=l));if(s.Id==u)break;if(c==-1){this.MSAGLAstarShortestPath(n,t,i,r,u,f);return}n[c].Parent=s;s=n[c]}for(e=n[u],p=System.Math.Max$$Int32$$Int32(n[r].ZoomLevel,n[u].ZoomLevel);e.Parent!=null;){for(this.ShortestPath.Add(e.Id),o=0;o<i[e.Id];o++)if(t[(e.Id,o)].NodeId==e.Parent.Id){this.SetUsed(n,t,i,e.Id,t[(e.Id,o)].NodeId,p);this.Edgelist.Add(new Microsoft.Msagl.GraphmapsWithMesh.VertexNeighbor.ctor(e.Id,o));break}e=e.Parent}this.ShortestPath.Add(e.Id);e.Id!=r&&System.Console.WriteLine$$String("path not found");return},MSAGLAstarSSSP:function(n,t,i,r,u,f,e,o,s,h){var w=new Microsoft.Msagl.Core.DataStructures.BinaryHeapPriorityQueue.ctor(o),y,nt,c,tt,k,d,rt,b,l,ut,v,g,p;for(n[r].Dist=0,w.Enqueue(r,n[r].Dist),y=0;y<o;y++)n[y].Id!=r&&(n[y].Dist=1.79769313486232E+308,w.Enqueue(y,n[y].Dist)),n[y].Parent=null,n[y].Visited=!1;for(this.Distance=0;w.get_Count()>0;){if(nt=w.Dequeue(),c=n[nt],c.Visited=!0,c==null||c.Invalid)return;for(v=0;v<i[c.Id];v++){tt=t[(c.Id,v)].NodeId;k=0;c.Id<e&&c.Id!=r&&(k=1e3);var a=n[tt],ft=Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.EucledianDistance(c.XLoc,c.YLoc,a.XLoc,a.YLoc),it=c.Dist+ft+k;it>=a.Dist||(a.Dist=it,a.Parent=c,a.Visited?(a.Visited=!1,w.Enqueue(a.Id,a.Dist)):w.DecreasePriority(a.Id,a.Dist))}}for(d=f.get_Nodes().GetEnumerator();d.MoveNext();)if(rt=d.get_Current(),b=u.get_Item$$TKey(rt),b!=r){for(l=n[b],ut=System.Math.Max$$Int32$$Int32(n[r].ZoomLevel,n[b].ZoomLevel),this.Edgelist.Clear();l.Parent!=null;){for(this.ShortestPath.Add(l.Id),v=0;v<i[l.Id];v++)if(t[(l.Id,v)].NodeId==l.Parent.Id){this.SetUsed(n,t,i,l.Id,t[(l.Id,v)].NodeId,ut);this.Edgelist.Add(new Microsoft.Msagl.GraphmapsWithMesh.VertexNeighbor.ctor(l.Id,v));break}l=l.Parent}for(l.Id!=r&&System.Console.WriteLine$$String("path not found"),g=this.Edgelist.GetEnumerator();g.MoveNext();)p=g.get_Current(),h.AddEdge$$Int32$$Int32$$Int32$$Int32(p.A,s.EList[(p.A,p.Neighbor)].NodeId,s.EList[(p.A,p.Neighbor)].Selected,s.EList[(p.A,p.Neighbor)].Used)}return},MSAGLSelectShortestPath:function(n,t,i,r,u,f){var a=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor),h,o,c,l,v,e,s;for(n[r].Dist=0,a.Add(n[r]),h=0;h<f;h++)n[h].Id!=r&&(n[h].Dist=1.79769313486232E+308,a.Add(n[h])),n[h].Parent=null,n[h].Visited=!1;for(this.Edgelist.Clear(),this.Distance=0;a.get_Count()>0;){if(o=this.getMin(a),o==null)return;if(o.Visited)continue;else o.Visited=!0;for(s=0;s<i[o.Id];s++)(c=t[(o.Id,s)].NodeId,n[c].Visited)||(l=0,t[(o.Id,s)].Selected==1&&(l=1e3),(t[(o.Id,s)].NodeId==r||t[(o.Id,s)].NodeId==u)&&(l=0),(o.Id==r||o.Id==u)&&(l=0),v=o.Dist+t[(o.Id,s)].GetEDist(n,o.Id,t[(o.Id,s)].NodeId)+l,v<n[c].Dist&&(n[c].Dist=v,n[c].Parent=o));if(o.Id==u)break}for(e=n[u];e.Parent!=null;){for(s=0;s<i[e.Id];s++)if(t[(e.Id,s)].NodeId==e.Parent.Id){this.SetUsed(n,t,i,e.Id,t[(e.Id,s)].NodeId,1);this.Edgelist.Add(new Microsoft.Msagl.GraphmapsWithMesh.VertexNeighbor.ctor(e.Id,s));this.Distance+=System.Math.Sqrt((e.XLoc-e.Parent.XLoc)*(e.XLoc-e.Parent.XLoc)+(e.YLoc-e.Parent.YLoc)*(e.YLoc-e.Parent.YLoc));break}e=e.Parent}e.Id!=r&&System.Console.WriteLine$$String("path not found")},SetUsed:function(n,t,i,r,u,f){for(var e=0;e<i[r];e++)if(t[(r,e)].NodeId==u){if(t[(r,e)].Used>0)return;t[(r,e)].Used=f}for(e=0;e<i[u];e++)if(t[(u,e)].NodeId==r){if(t[(u,e)].Used>0)return;t[(u,e)].Used=f}}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$DijkstraAlgo);Microsoft$Msagl$GraphmapsWithMesh$VertexNeighbor={fullname:"Microsoft.Msagl.GraphmapsWithMesh.VertexNeighbor",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.A=0;this.Neighbor=0;System.Object.ctor.call(this);this.A=n;this.Neighbor=t}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$VertexNeighbor);Microsoft$Msagl$GraphmapsWithMesh$LocalModifications={fullname:"Microsoft.Msagl.GraphmapsWithMesh.LocalModifications",baseTypeName:"System.Object",staticDefinition:{MsaglShortcutShortEdges:function(n,t,i){var l=i.get_NodeSeparation()|0,a=1,v=10,o,r,s,u,k,f,h,y,c,p,w,b,e;for(i.hugeGraph&&(v=1,l*=5);a>0&&v>0;){for(v--,o=n.N;o<n.NumOfnodesBeforeDetour;o++)for(r=n.VList[o],s=0;s<n.DegList[r.Id];s++)if((u=n.VList[n.EList[(r.Id,s)].NodeId],!(u.Id<n.N))&&(k=n.GetEucledianDist(r.Id,u.Id),k<l)){for(f=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),h=0;h<n.DegList[u.Id];h++)y=n.EList[(u.Id,h)].NodeId,y!=r.Id&&f.Add(y);if(c=!0,n.DegList[r.Id]+f.get_Count()>=n.maxDeg)continue;for(p=f.GetEnumerator();p.MoveNext();)e=p.get_Current(),n.DegList[e]+1>=n.maxDeg&&(c=!1);for(w=f.GetEnumerator();w.MoveNext();)e=w.get_Current(),n.Crossings(r.Id,e)&&(c=!1);if(!c)continue;for(b=f.GetEnumerator();b.MoveNext();)e=b.get_Current(),n.AddEdge$$Int32$$Int32(r.Id,e);n.RemoveEdge(r.Id,u.Id);a++}l*=2}System.Console.WriteLine$$String("Shortcut made for "+a+" edges")},MsaglMoveToMedian:function(n){var t,i,r;n.buildCrossingCandidates();t=null;throw $CreateException(new System.InvalidOperationException.ctor,new Error);},MsaglStretchAccordingToZoomLevel:function(){throw $CreateException(new System.InvalidOperationException.ctor,new Error);},PolygonalChainSimplification:function(n,t,i,r){for(var f=0,e=0,o=0,u=t+1;u<=i-1;u++)e=Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.GetDistance$$Point$$Point$$Point(n[t],n[i],n[u]),e>f&&(o=u,f=e);if(f>r)Microsoft.Msagl.GraphmapsWithMesh.LocalModifications.PolygonalChainSimplification(n,t,o,r),Microsoft.Msagl.GraphmapsWithMesh.LocalModifications.PolygonalChainSimplification(n,o,i,r);else for(u=t+1;u<=i-1;u++)n[u]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-1,-1)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$LocalModifications);Microsoft$Msagl$GraphmapsWithMesh$MeshCreator={fullname:"Microsoft.Msagl.GraphmapsWithMesh.MeshCreator",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges=null;Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges=null},CreateFourRaysPerVertex:function(n,t,i){for(var s,f=0;f<n.N;f++){var e=n.VList[f].XLoc,o=n.VList[f].YLoc,r,u=e+1;r=o;u>=0&&u<=t&&r>=0&&r<=i&&(s=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,o),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,r)),n.VList[f].SegmentList.Add(s,!0));u=e;r=o+1;u>=0&&u<=t&&r>=0&&r<=i&&(s=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,o),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,r)),n.VList[f].SegmentList.Add(s,!0));u=e-1;r=o;u>=0&&u<=t&&r>=0&&r<=i&&(s=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,o),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,r)),n.VList[f].SegmentList.Add(s,!0));u=e;r=o-1;u>=0&&u<=t&&r>=0&&r<=i&&(s=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,o),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,r)),n.VList[f].SegmentList.Add(s,!0))}},GrowOneUnit:function(n,t,i){var r=0,u=0;return(n.get_Start().get_X()|0==n.get_End().get_X()|0&&n.get_Start().get_Y()|0<n.get_End().get_Y()|0&&(r=n.get_End().get_X()|0,u=n.get_End().get_Y()|1),n.get_Start().get_X()|0==n.get_End().get_X()|0&&n.get_Start().get_Y()|0>n.get_End().get_Y()|0&&(r=n.get_End().get_X()|0,u=n.get_End().get_Y()|-1),n.get_Start().get_Y()|0==n.get_End().get_Y()|0&&n.get_Start().get_X()|0<n.get_End().get_X()|0&&(r=n.get_End().get_X()|1,u=n.get_End().get_Y()|0),n.get_Start().get_Y()|0==n.get_End().get_Y()|0&&n.get_Start().get_X()|0>n.get_End().get_X()|0&&(r=n.get_End().get_X()|-1,u=n.get_End().get_Y()|0),!(r>=0&&r<=t&&u>=0&&u<=i))?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-1,-1):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r,u)},FindVertexClosestToSegmentEnd:function(n,t){var r=1.79769313486232E+308,u=-1,i;if(t.get_Start().get_X()|0==t.get_End().get_X()|0)for(i=0;i<n.NumOfnodes;i++)n.VList[i].XLoc!=t.get_Start().get_X()|0||(t.get_Start().get_Y()<t.get_End().get_Y()&&n.VList[i].YLoc>=t.get_Start().get_Y()&&n.VList[i].YLoc<t.get_End().get_Y()&&r>t.get_End().get_Y()-n.VList[i].YLoc&&(r=t.get_End().get_Y()-n.VList[i].YLoc,u=i),t.get_Start().get_Y()>t.get_End().get_Y()&&n.VList[i].YLoc<=t.get_Start().get_Y()&&n.VList[i].YLoc>t.get_End().get_Y()&&r>n.VList[i].YLoc-t.get_End().get_Y()&&(r=n.VList[i].YLoc-t.get_End().get_Y(),u=i));if(t.get_Start().get_Y()|0==t.get_End().get_Y()|0)for(i=0;i<n.NumOfnodes;i++)n.VList[i].YLoc!=t.get_Start().get_Y()|0||(t.get_Start().get_X()<t.get_End().get_X()&&n.VList[i].XLoc>=t.get_Start().get_X()&&n.VList[i].XLoc<t.get_End().get_X()&&r>t.get_End().get_X()-n.VList[i].XLoc&&(r=t.get_End().get_X()-n.VList[i].XLoc,u=i),t.get_Start().get_X()>t.get_End().get_X()&&n.VList[i].XLoc<=t.get_Start().get_X()&&n.VList[i].XLoc>t.get_End().get_X()&&r>n.VList[i].XLoc-t.get_End().get_X()&&(r=n.VList[i].XLoc-t.get_End().get_X(),u=i));return r==1.79769313486232E+308&&System.Console.WriteLine$$String("No vertex Found Error"),u},FindClosestVertexWhileWalkingToStart:function(n,t,i){var u=1.79769313486232E+308,f=-1,r;if(t.get_Start().get_X()|0==t.get_End().get_X()|0)for(r=0;r<n.NumOfnodes;r++)n.VList[r].XLoc!=t.get_Start().get_X()|0||(t.get_Start().get_Y()<=i.get_Y()&&n.VList[r].YLoc>=t.get_Start().get_Y()&&n.VList[r].YLoc<=i.get_Y()&&u>i.get_Y()-n.VList[r].YLoc&&(u=i.get_Y()-n.VList[r].YLoc,f=r),t.get_Start().get_Y()>=i.get_Y()&&n.VList[r].YLoc<=t.get_Start().get_Y()&&n.VList[r].YLoc>=i.get_Y()&&u>n.VList[r].YLoc-i.get_Y()&&(u=n.VList[r].YLoc-i.get_Y(),f=r));if(t.get_Start().get_Y()|0==t.get_End().get_Y()|0)for(r=0;r<n.NumOfnodes;r++)n.VList[r].YLoc!=t.get_Start().get_Y()|0||(t.get_Start().get_X()<=i.get_X()&&n.VList[r].XLoc>=t.get_Start().get_X()&&n.VList[r].XLoc<=i.get_X()&&u>i.get_X()-n.VList[r].XLoc&&(u=i.get_X()-n.VList[r].XLoc,f=r),t.get_Start().get_X()>=i.get_X()&&n.VList[r].XLoc<=t.get_Start().get_X()&&n.VList[r].XLoc>=i.get_X()&&u>n.VList[r].XLoc-i.get_X()&&(u=n.VList[r].XLoc-i.get_X(),f=r));return u==1.79769313486232E+308&&System.Console.WriteLine$$String("No vertex Found Error"),f},FindClosestVertexWhileWalkingToEnd:function(n,t,i){var u=1.79769313486232E+308,f=-1,r;if(t.get_Start().get_X()|0==t.get_End().get_X()|0)for(r=0;r<n.NumOfnodes;r++)n.VList[r].XLoc!=t.get_Start().get_X()|0||(i.get_Y()<=t.get_End().get_Y()&&n.VList[r].YLoc>=i.get_Y()&&n.VList[r].YLoc<=t.get_End().get_Y()&&u>n.VList[r].YLoc-i.get_Y()&&(u=n.VList[r].YLoc-i.get_Y(),f=r),i.get_Y()>=t.get_End().get_Y()&&n.VList[r].YLoc<=i.get_Y()&&n.VList[r].YLoc>=t.get_End().get_Y()&&u>i.get_Y()-n.VList[r].YLoc&&(u=i.get_Y()-n.VList[r].YLoc,f=r));if(t.get_Start().get_Y()|0==t.get_End().get_Y()|0)for(r=0;r<n.NumOfnodes;r++)n.VList[r].YLoc!=t.get_Start().get_Y()|0||(i.get_X()<=t.get_End().get_X()&&n.VList[r].XLoc>=i.get_X()&&n.VList[r].XLoc<=t.get_End().get_X()&&u>n.VList[r].XLoc-i.get_X()&&(u=n.VList[r].XLoc-i.get_X(),f=r),i.get_X()>=t.get_End().get_X()&&n.VList[r].XLoc<=i.get_X()&&n.VList[r].XLoc>=t.get_End().get_X()&&u>i.get_X()-n.VList[r].XLoc&&(u=i.get_X()-n.VList[r].XLoc,f=r));return f},CreateCompetitionMesh:function(n,t,i,r){var o,s,b,c,k,u,a,d,e,y,l,h,g,nt,v,tt,p,it,rt,ut,ft,f;for(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.CreateFourRaysPerVertex(n,i,r),System.Console.WriteLine$$String("Creating Mesh of size "+System.Math.Max$$Int32$$Int32(i,r)),o=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor,System.Int32.ctor),s=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor,System.Int32.ctor),b=0;b<=System.Math.Max$$Int32$$Int32(i,r);b++){for(c=0;c<n.N;c++)for(k=n.VList[c].SegmentList.get_Keys().GetEnumerator();k.MoveNext();)if(u=k.get_Current(),n.VList[c].SegmentList.get_Item$$TKey(u)!=!1)for(a=0;a<n.N;a++)if(c!=a)for(d=n.VList[a].SegmentList.get_Keys().GetEnumerator();d.MoveNext();)if(e=d.get_Current(),Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.PointIsOnAxisAlignedSegment(e,u.get_End()))if(u.get_Start().get_X()|0==u.get_End().get_X()|0&&e.get_Start().get_X()|0==e.get_End().get_X()|0||u.get_Start().get_Y()|0==u.get_End().get_Y()|0&&e.get_Start().get_Y()|0==e.get_End().get_Y()|0){if(u.get_End().get_X()|0==e.get_Start().get_X()|0&&u.get_End().get_Y()|0==e.get_Start().get_Y()|0)continue;l=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindVertexClosestToSegmentEnd(n,u);h=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindVertexClosestToSegmentEnd(n,e);l==h&&System.Console.WriteLine$$String("degenerate parallel collision");n.AddEdge$$Int32$$Int32(l,h)&&(y=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u.get_Start(),e.get_Start()),s.ContainsKey(y)||s.Add(y,-1),y=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(e.get_Start(),u.get_Start()),s.ContainsKey(y)||s.Add(y,-1),o.ContainsKey(u)||o.Add(u,c),o.ContainsKey(e)||o.Add(e,a))}else{if(Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.PointIsOnAxisAlignedSegment(e,u.get_End())&&Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.PointIsOnAxisAlignedSegment(u,e.get_End())&&c>a)continue;if(n.GetNode(u.get_End().get_X()|0,u.get_End().get_Y()|0)==-1){var l=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindClosestVertexWhileWalkingToStart(n,e,u.get_End()),h=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindClosestVertexWhileWalkingToEnd(n,e,u.get_End()),et=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindVertexClosestToSegmentEnd(n,u),w=n.NumOfnodes;n.VList[w]=function(){var n=new Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor(u.get_End().get_X()|0,u.get_End().get_Y()|0);return n.Id=w,n}();n.NumOfnodes++;l>=0&&n.AddEdge$$Int32$$Int32(l,w);h>=0&&n.AddEdge$$Int32$$Int32(h,w);et>=0&&n.AddEdge$$Int32$$Int32(et,w);l==h&&System.Console.WriteLine$$String("degenerate orthogonal collision");l>=0&&h>=0&&n.RemoveEdge(l,h);o.ContainsKey(u)||(o.Add(u,c),s.ContainsKey(u)||s.Add(u,-1))}else l=n.GetNode(u.get_End().get_X()|0,u.get_End().get_Y()|0),h=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindVertexClosestToSegmentEnd(n,u),h==-1&&System.Console.WriteLine$$String("vertex not found error"),n.AddEdge$$Int32$$Int32(l,h),o.ContainsKey(u)||(o.Add(u,c),s.ContainsKey(u)||s.Add(u,-1))}for(g=o.GetEnumerator();g.MoveNext();)f=g.get_Current(),n.VList[f.get_Value()].SegmentList.Remove(f.get_Key());for(o.Clear(),nt=s.GetEnumerator();nt.MoveNext();)f=nt.get_Current(),f.get_Value()>=0?n.VList[f.get_Value()].SegmentList.Add(f.get_Key(),!0):n.VList[n.GetNode(f.get_Key().get_Start().get_X()|0,f.get_Key().get_Start().get_Y()|0)].SegmentList.Add(f.get_Key(),!1);for(s.Clear(),v=0;v<n.N;v++)for(tt=n.VList[v].SegmentList.get_Keys().GetEnumerator();tt.MoveNext();)(p=tt.get_Current(),n.VList[v].SegmentList.get_Item$$TKey(p)!=!1)&&(it=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.GrowOneUnit(p,i+1,r+1),it.get_X()>=0&&(rt=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(p.get_Start(),it),s.ContainsKey(rt)||s.Add(rt,v),o.ContainsKey(p)||o.Add(p,v)));for(ut=o.GetEnumerator();ut.MoveNext();)f=ut.get_Current(),n.VList[f.get_Value()].SegmentList.Remove(f.get_Key());for(o.Clear(),ft=s.GetEnumerator();ft.MoveNext();)f=ft.get_Current(),f.get_Value()>=0?n.VList[f.get_Value()].SegmentList.Add(f.get_Key(),!0):n.VList[n.GetNode(f.get_Key().get_Start().get_X()|0,f.get_Key().get_Start().get_Y()|0)].SegmentList.Add(f.get_Key(),!1);s.Clear()}Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FixMesh(n);System.Console.WriteLine$$String("Mesh Created")},FastCompetitionMesh:function(n,t,i,r,u){var f,y,v;Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges=new System.Collections.Generic.Dictionary$2.ctor(System.Double.ctor,System.Collections.Generic.List$1.ctor);Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges=new System.Collections.Generic.Dictionary$2.ctor(System.Double.ctor,System.Collections.Generic.List$1.ctor);var e=new Float64Array(n.N),o=new Float64Array(n.N),s=new Int32Array(n.N),p=new Float64Array(n.N);for(f=0;f<n.N;f++)e[f]=n.VList[f].XLoc,o[f]=n.VList[f].YLoc,s[f]=f,p[f]=n.VList[f].YLoc;Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.iterativeMergesort(p,e,o,s);var d=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.ManhattanNearestNeighbor(e,o,s,1,i,r),g=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.ManhattanNearestNeighbor(e,o,s,8,i,r),nt=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.ManhattanNearestNeighbor(e,o,s,4,i,r),tt=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.ManhattanNearestNeighbor(e,o,s,5,i,r),h=n.InsertVertexWithDuplicateCheck(0,0,u),c=n.InsertVertexWithDuplicateCheck(0,r,u),l=n.InsertVertexWithDuplicateCheck(i,r,u),a=n.InsertVertexWithDuplicateCheck(i,0,u);n.AddEdge$$Int32$$Int32(h,c);n.AddEdge$$Int32$$Int32(c,l);n.AddEdge$$Int32$$Int32(l,a);n.AddEdge$$Int32$$Int32(a,h);Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.set_Item$$TKey(0,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor));Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.set_Item$$TKey(i,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor));Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(0,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor));Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(r,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor));Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(0).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(n.VList[h],n.VList[c]));Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(i).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(n.VList[l],n.VList[a]));Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(0).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(n.VList[h],n.VList[a]));Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(r).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(n.VList[c],n.VList[l]));Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.ProcessLeftRays(n,nt,tt,i,r,u);Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.ProcessRightRays(n,d,g,i,r,u);Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.ProcessUpwardRays(n,i,r,u);Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.ProcessDownwardRays(n,i,r,u);for(var w=0,b=0,k=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Keys().GetEnumerator();k.MoveNext();)v=k.get_Current(),w+=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(v).get_Count();for(y=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Keys().GetEnumerator();y.MoveNext();)v=y.get_Current(),b+=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(v).get_Count();System.Console.WriteLine$$String("Number of Vertical Edges: "+w);System.Console.WriteLine$$String("Number of Horizontal Edges: "+b)},ProcessLeftRays:function(n,t,i,r,u,f){for(var e,w,v,b,d,l,h,g,s,c,a=0;a<n.N;a++)if(e=n.VList[a],e.leftRay==null){var o=null,y=null,p=null,k=1.79769313486232E+308;if(t.ContainsKey(n.VList[a].Id)&&(y=n.VList[t.get_Item$$TKey(n.VList[a].Id)],k=System.Math.Abs$$Int32(y.XLoc-e.XLoc)+System.Math.Abs$$Int32(y.YLoc-e.YLoc)),w=1.79769313486232E+308,i.ContainsKey(n.VList[a].Id)&&(p=n.VList[i.get_Item$$TKey(n.VList[a].Id)],w=System.Math.Abs$$Int32(p.XLoc-e.XLoc)+System.Math.Abs$$Int32(p.YLoc-e.YLoc)),o=k==1.79769313486232E+308&&w==1.79769313486232E+308?n.VList[n.N+1]:k<w?y:p,e.YLoc==o.YLoc){do for(v=o,b=0;b<n.DegList[o.Id];b++)if(d=n.VList[n.EList[(o.Id,b)].NodeId],d.YLoc>o.YLoc){o=d;break}while(v.Id!=o.Id);if(v.XLoc>=e.XLoc)continue;n.AddEdge$$Int32$$Int32(e.Id,v.Id);Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(e.YLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(e.YLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor));Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(e.YLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(e,v))}else{if(l=null,h=o,Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.ContainsKey(o.XLoc))for(g=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(o.XLoc).GetEnumerator();g.MoveNext();){if(s=g.get_Current(),s.a.YLoc<=e.YLoc&&s.b.YLoc>=e.YLoc){l=s;break}o.YLoc>e.YLoc&&o.YLoc>=s.a.YLoc&&s.a.YLoc>=e.YLoc&&o.YLoc>=s.b.YLoc&&s.b.YLoc>=e.YLoc?(System.Math.Abs$$Int32(s.a.YLoc-e.YLoc)<System.Math.Abs$$Int32(h.YLoc-e.YLoc)&&(h=s.a),System.Math.Abs$$Int32(s.b.YLoc-e.YLoc)<System.Math.Abs$$Int32(h.YLoc-e.YLoc)&&(h=s.b)):o.YLoc<e.YLoc&&o.YLoc<=s.a.YLoc&&s.a.YLoc<=e.YLoc&&o.YLoc<=s.b.YLoc&&s.b.YLoc<=e.YLoc&&(System.Math.Abs$$Int32(s.a.YLoc-e.YLoc)<System.Math.Abs$$Int32(h.YLoc-e.YLoc)&&(h=s.a),System.Math.Abs$$Int32(s.b.YLoc-e.YLoc)<System.Math.Abs$$Int32(h.YLoc-e.YLoc)&&(h=s.b))}l!=null?(c=n.InsertVertexWithDuplicateCheck(o.XLoc,e.YLoc,f),n.RemoveEdge(l.a.Id,l.b.Id),n.AddEdge$$Int32$$Int32(l.a.Id,c),n.AddEdge$$Int32$$Int32(l.b.Id,c),n.AddEdge$$Int32$$Int32(e.Id,c),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.ContainsKey(o.XLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.set_Item$$TKey(o.XLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(e.YLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(e.YLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(o.XLoc).Remove(l),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(o.XLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(l.a,n.VList[c])),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(o.XLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(l.b,n.VList[c])),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(e.YLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(e,n.VList[c]))):(c=n.InsertVertexWithDuplicateCheck(h.XLoc,e.YLoc,f),n.AddEdge$$Int32$$Int32(e.Id,c),n.AddEdge$$Int32$$Int32(h.Id,c),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.ContainsKey(o.XLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.set_Item$$TKey(o.XLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(e.YLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(e.YLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(e.YLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(e,n.VList[c])),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(h.XLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(h,n.VList[c])))}}},ProcessUpwardRays:function(n,t,i,r){for(var w,et=new System.Collections.Generic.List$1.ctor(System.Double.ctor),ot=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor),st=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Values().GetEnumerator(),ht,nt,b,ct,k,tt,a,v,u,d,e,s,h,c,y,l,o,g,rt,ut,f,wt,bt,ft,p;st.MoveNext();)for(ht=st.get_Current(),nt=ht.GetEnumerator();nt.MoveNext();)(b=nt.get_Current(),b.a!=null)&&(ot.Add(b),et.Add(b.a.YLoc));for(ct=et.ToArray(),k=ot.ToArray(),System.Array.Sort$2$$TKey$Array$$TValue$Array(System.Double.ctor,Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor,ct,k),tt=new Float64Array(n.N),a=new Int32Array(n.N),e=0;e<n.N;e++)tt[e]=n.VList[e].YLoc,a[e]=e;for(System.Array.Sort$2$$TKey$Array$$TValue$Array(System.Double.ctor,System.Int32.ctor,tt,a),v=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor,new Microsoft.Msagl.GraphmapsWithMesh.xCoordinateComparator.ctor),d=0,e=0;e<k.length;e++){u=k[e];for(var it=u.a.YLoc,lt=u.a.XLoc,at=u.b.XLoc;d<a.length&&n.VList[a[d]].YLoc<it;)v.Insert(n.VList[a[d++]]);if(s=v.FindLast$$Func$2(function(n){return n.XLoc>=lt}),h=v.FindFirst$$Func$2(function(n){return n.XLoc<=at}),s!=null&&s.Item.XLoc>at&&(s=null),h!=null&&h.Item.XLoc<lt&&(h=null),s!=null&&h!=null){if(c=h,y=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor),s.Item.Id==h.Item.Id)y.Add(c.Item);else{while(c.Item.Id!=s.Item.Id)y.Add(c.Item),c=v.Next(c);y.Add(c.Item)}for(var vt=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor),yt=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor),pt=y.GetEnumerator();pt.MoveNext();){p=pt.get_Current();l=p.Id;do for(o=l,g=0;g<n.DegList[l];g++)if(rt=n.VList[n.EList[(l,g)].NodeId],rt.YLoc>n.VList[l].YLoc){l=rt.Id;break}while(o!=l);n.VList[o].YLoc>=it||(w=n.InsertVertexWithDuplicateCheck(n.VList[o].XLoc,it,r),vt.Add(n.VList[w]),n.AddEdge$$Int32$$Int32(o,w),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.ContainsKey(n.VList[o].XLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.set_Item$$TKey(n.VList[o].XLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(n.VList[o].XLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(n.VList[o],n.VList[w])),yt.Add(p))}for(ut=vt.GetEnumerator();ut.MoveNext();)f=ut.get_Current(),wt=n.AddEdge$$Int32$$Int32(u.a.Id,f.Id),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(f.YLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(f.YLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(f.YLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(u.a,f)),bt=n.AddEdge$$Int32$$Int32(u.b.Id,f.Id),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(f.YLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(f.YLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(f.YLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(u.b,f)),wt&&bt&&(n.RemoveEdge(u.a.Id,u.b.Id),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(u.b.YLoc)&&Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(u.b.YLoc).Remove(u)),u=new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(f,u.a);for(ft=yt.GetEnumerator();ft.MoveNext();)p=ft.get_Current(),v.Remove(p)}}},ProcessDownwardRays:function(n,t,i,r){for(var w,et=new System.Collections.Generic.List$1.ctor(System.Double.ctor),ot=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor),st=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Values().GetEnumerator(),ht,nt,b,ct,k,tt,a,v,u,d,e,s,h,c,y,l,o,g,rt,ut,f,wt,bt,ft,p;st.MoveNext();)for(ht=st.get_Current(),nt=ht.GetEnumerator();nt.MoveNext();)(b=nt.get_Current(),b.a!=null)&&(ot.Add(b),et.Add(-b.a.YLoc));for(ct=et.ToArray(),k=ot.ToArray(),System.Array.Sort$2$$TKey$Array$$TValue$Array(System.Double.ctor,Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor,ct,k),tt=new Float64Array(n.N),a=new Int32Array(n.N),e=0;e<n.N;e++)tt[e]=-n.VList[e].YLoc,a[e]=e;for(System.Array.Sort$2$$TKey$Array$$TValue$Array(System.Double.ctor,System.Int32.ctor,tt,a),v=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor,new Microsoft.Msagl.GraphmapsWithMesh.xCoordinateComparator.ctor),d=0,e=0;e<k.length;e++){u=k[e];for(var it=u.a.YLoc,lt=u.a.XLoc,at=u.b.XLoc;d<a.length&&n.VList[a[d]].YLoc>it;)v.Insert(n.VList[a[d++]]);if(s=v.FindLast$$Func$2(function(n){return n.XLoc>=lt}),h=v.FindFirst$$Func$2(function(n){return n.XLoc<=at}),s!=null&&s.Item.XLoc>at&&(s=null),h!=null&&h.Item.XLoc<lt&&(h=null),s!=null&&h!=null){if(c=h,y=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor),s.Item.Id==h.Item.Id)y.Add(c.Item);else{while(c.Item.Id!=s.Item.Id)y.Add(c.Item),c=v.Next(c);y.Add(c.Item)}for(var vt=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor),yt=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor),pt=y.GetEnumerator();pt.MoveNext();){p=pt.get_Current();l=p;do for(o=l,g=0;g<n.DegList[l.Id];g++)if(rt=n.VList[n.EList[(l.Id,g)].NodeId],rt.YLoc<l.YLoc){l=rt;break}while(o.Id!=l.Id);o.YLoc<=it||(w=n.InsertVertexWithDuplicateCheck(o.XLoc,it,r),vt.Add(n.VList[w]),n.AddEdge$$Int32$$Int32(o.Id,w),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.ContainsKey(o.XLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.set_Item$$TKey(o.XLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(o.XLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(o,n.VList[w])),yt.Add(p))}for(ut=vt.GetEnumerator();ut.MoveNext();)f=ut.get_Current(),wt=n.AddEdge$$Int32$$Int32(u.a.Id,f.Id),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(f.YLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(f.YLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(f.YLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(u.a,f)),bt=n.AddEdge$$Int32$$Int32(u.b.Id,f.Id),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(f.YLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(f.YLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(f.YLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(u.b,f)),wt&&bt&&(n.RemoveEdge(u.a.Id,u.b.Id),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(u.b.YLoc)&&Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(u.b.YLoc).Remove(u)),u=new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(f,u.a);for(ft=yt.GetEnumerator();ft.MoveNext();)p=ft.get_Current(),v.Remove(p)}}},ProcessRightRays:function(n,t,i,r,u,f){for(var e,p,k,w,d,l,h,g,s,c,a=0;a<n.N;a++)if(e=n.VList[a],e.leftRay==null){var o=null,v=null,y=null,b=1.79769313486232E+308;if(t.ContainsKey(n.VList[a].Id)&&(v=n.VList[t.get_Item$$TKey(n.VList[a].Id)],b=System.Math.Abs$$Int32(v.XLoc-e.XLoc)+System.Math.Abs$$Int32(v.YLoc-e.YLoc)),p=1.79769313486232E+308,i.ContainsKey(n.VList[a].Id)&&(y=n.VList[i.get_Item$$TKey(n.VList[a].Id)],p=System.Math.Abs$$Int32(y.XLoc-e.XLoc)+System.Math.Abs$$Int32(y.YLoc-e.YLoc)),o=b==1.79769313486232E+308&&p==1.79769313486232E+308?n.VList[n.N+2]:b<p?v:y,e.YLoc==o.YLoc){do for(k=o,w=0;w<n.DegList[o.Id];w++)if(d=n.VList[n.EList[(o.Id,w)].NodeId],d.XLoc<o.XLoc){o=d;break}while(k.Id!=o.Id);if(k.XLoc<=e.XLoc)continue;n.AddEdge$$Int32$$Int32(e.Id,o.Id);Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(e.YLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(e.YLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor));Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(e.YLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(e,o))}else{if(l=null,h=o,Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.ContainsKey(o.XLoc))for(g=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(o.XLoc).GetEnumerator();g.MoveNext();){if(s=g.get_Current(),s.a.YLoc<=e.YLoc&&s.b.YLoc>=e.YLoc){l=s;break}o.YLoc>e.YLoc&&o.YLoc>=s.a.YLoc&&s.a.YLoc>=e.YLoc&&o.YLoc>=s.b.YLoc&&s.b.YLoc>=e.YLoc?(System.Math.Abs$$Int32(s.a.YLoc-e.YLoc)<System.Math.Abs$$Int32(h.YLoc-e.YLoc)&&(h=s.a),System.Math.Abs$$Int32(s.b.YLoc-e.YLoc)<System.Math.Abs$$Int32(h.YLoc-e.YLoc)&&(h=s.b)):o.YLoc<e.YLoc&&o.YLoc<=s.a.YLoc&&s.a.YLoc<=e.YLoc&&o.YLoc<=s.b.YLoc&&s.b.YLoc<=e.YLoc&&(System.Math.Abs$$Int32(s.a.YLoc-e.YLoc)<System.Math.Abs$$Int32(h.YLoc-e.YLoc)&&(h=s.a),System.Math.Abs$$Int32(s.b.YLoc-e.YLoc)<System.Math.Abs$$Int32(h.YLoc-e.YLoc)&&(h=s.b))}l!=null?(c=n.InsertVertexWithDuplicateCheck(o.XLoc,e.YLoc,f),n.RemoveEdge(l.a.Id,l.b.Id),n.AddEdge$$Int32$$Int32(l.a.Id,c),n.AddEdge$$Int32$$Int32(l.b.Id,c),n.AddEdge$$Int32$$Int32(e.Id,c),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.ContainsKey(o.XLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.set_Item$$TKey(o.XLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(e.YLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(e.YLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(o.XLoc).Remove(l),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(o.XLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(l.a,n.VList[c])),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(o.XLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(l.b,n.VList[c])),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(e.YLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(e,n.VList[c]))):(c=n.InsertVertexWithDuplicateCheck(h.XLoc,e.YLoc,f),n.AddEdge$$Int32$$Int32(e.Id,c),n.AddEdge$$Int32$$Int32(h.Id,c),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.ContainsKey(o.XLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.set_Item$$TKey(o.XLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.ContainsKey(e.YLoc)||Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.set_Item$$TKey(e.YLoc,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor)),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.VHEdges.get_Item$$TKey(e.YLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(e,n.VList[c])),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.HVEdges.get_Item$$TKey(h.XLoc).Add(new Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge.ctor(h,n.VList[c])))}}},ManhattanNearestNeighbor:function(n,t,i,r,u,f){for(var y,p,o,l,a,s=new Float64Array(i.length),h=new Float64Array(i.length),c=new Float64Array(i.length),v=new Int32Array(i.length),e=0;e<i.length;e++)r==4&&(h[e]=n[e],c[e]=t[e]),r==1&&(h[e]=-n[e]+u,c[e]=t[e]),r==8&&(h[e]=-n[e]+u,c[e]=-t[e]+f),r==5&&(h[e]=n[e],c[e]=-t[e]+f),v[e]=i[e],s[e]=h[e]+c[e];var w=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor),k=s,d=new Float64Array(s.length),g=new Int32Array(s.length),nt=new Float64Array(s.length),tt=new Float64Array(s.length),b=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Double.ctor);for(o=0;o<s.length;o++)b.Add(v[o],h[o]);for(y=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Double.ctor),o=0;o<s.length;o++)y.Add(v[o],c[o]);for(p=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor),o=0;o<s.length;o++)p.Add(o,v[o]);for(l=1;l<s.length;l*=2)for(a=0;a<s.length;a+=2*l)Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindNeighbor(k,d,a,a+l,a+2*l,h,c,v,nt,tt,g,w,b,y,p);return w},FindNeighbor:function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){var b,k,g,d,w,nt,tt,p;for(r>n.length&&(r=n.length),u>n.length&&(u=n.length),b=i,k=r,p=i;p<u;p++)b==r?(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(p,k,n,t,f,e,o,s,h,c),k++):k==u?(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(p,b,n,t,f,e,o,s,h,c),b++):n[k]<n[b]?(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(p,k,n,t,f,e,o,s,h,c),k++):n[b]==n[k]&&f[b]<f[k]?(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(p,b,n,t,f,e,o,s,h,c),b++):n[b]==n[k]&&f[b]>=f[k]?(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(p,k,n,t,f,e,o,s,h,c),k++):(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(p,b,n,t,f,e,o,s,h,c),b++);for(g=-1.79769313486232E+308,d=-1,p=i;p<u;p++)w=c[p],w!=d&&d>=0&&(l.ContainsKey(w)?(nt=l.get_Item$$TKey(w),tt=a.get_Item$$TKey(nt)-v.get_Item$$TKey(nt),tt<g&&v.get_Item$$TKey(d)>=v.get_Item$$TKey(w)&&l.set_Item$$TKey(w,d)):v.get_Item$$TKey(d)>=v.get_Item$$TKey(w)&&l.Add(w,d)),r==n.length&&--r,v.get_Item$$TKey(w)>=v.get_Item$$TKey(y.get_Item$$TKey(r))&&a.get_Item$$TKey(w)-v.get_Item$$TKey(w)>=g&&(g=a.get_Item$$TKey(w)-v.get_Item$$TKey(w),d=w);for(p=i;p<u;p++)Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(p,p,t,n,s,h,c,f,e,o)},Assign:function(n,t,i,r,u,f,e,o,s,h){r[n]=i[t];h[n]=e[t];o[n]=u[t];s[n]=f[t]},iterativeMergesort:function(n,t,i,r){for(var u,e,o=n,s=new Float64Array(n.length),h=new Int32Array(n.length),c=new Float64Array(n.length),l=new Float64Array(n.length),f=1;f<n.length;f*=2)for(u=0;u<n.length;u+=2*f)Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.merge(o,s,u,u+f,u+2*f,t,i,r,c,l,h);for(e=0;e<n.length;e++)n[e]=o[e]},merge:function(n,t,i,r,u,f,e,o,s,h,c){var a,v,l;for(r>n.length&&(r=n.length),u>n.length&&(u=n.length),a=i,v=r,l=i;l<u;l++)a==r?(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(l,v,n,t,f,e,o,s,h,c),v++):v==u?(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(l,a,n,t,f,e,o,s,h,c),a++):n[v]<n[a]?(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(l,v,n,t,f,e,o,s,h,c),v++):n[a]==n[v]&&f[a]<f[v]?(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(l,a,n,t,f,e,o,s,h,c),a++):n[a]==n[v]&&f[a]>=f[v]?(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(l,v,n,t,f,e,o,s,h,c),v++):(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(l,a,n,t,f,e,o,s,h,c),a++);for(l=i;l<u;l++)Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.Assign(l,l,t,n,s,h,c,f,e,o)},FixMesh:function(n){var w,y,b,p,l,a,u,i,t,h,c,r,f,e,o,s,nt;for(System.Console.WriteLine$$String("Fixing the mesh"),t=0;t<n.NumOfnodes;t++)if(n.DegList[t]!=0)for(i=n.N;i<n.NumOfnodes;i++)if(t!=i&&n.VList[t].XLoc==n.VList[i].XLoc&&n.VList[t].YLoc==n.VList[i].YLoc){for(f=0;f<n.DegList[i];f++)n.DegList[n.EList[(i,f)].NodeId]!=0&&n.AddEdge$$Int32$$Int32(t,n.EList[(i,f)].NodeId);n.DegList[i]=0;n.VList[i].Invalid=!0}for(r=0;r<n.N;r++)for(w=n.VList[r].SegmentList.get_Keys().GetEnumerator();w.MoveNext();)for(y=w.get_Current(),e=r+1;e<n.N;e++)for(b=n.VList[e].SegmentList.get_Keys().GetEnumerator();b.MoveNext();)if(p=b.get_Current(),y.get_Start().Equals$$Object(p.get_End())&&p.get_Start().Equals$$Object(y.get_End())){for(l=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),a=0;a<n.N;a++)s=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.VList[a].XLoc,n.VList[a].YLoc),(Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.PointIsOnAxisAlignedSegment(y,s)||Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.PointIsOnAxisAlignedSegment(p,s))&&l.Add(s);if(l.get_Count()>2){for(l.Sort(),u=l.ToArray(),t=0;t<u.length;t++)for(i=t+1;i<u.length;i++)n.RemoveEdge(n.GetNode(u[t].get_X()|0,u[t].get_Y()|0),n.GetNode(u[i].get_X()|0,u[i].get_Y()|0));for(t=0;t<u.length-1;t++)n.AddEdge$$Int32$$Int32(n.GetNode(u[t].get_X()|0,u[t].get_Y()|0),n.GetNode(u[t+1].get_X()|0,u[t+1].get_Y()|0))}}for(h=0;h<n.NumOfnodes;h++)n.nodeTree.Add$$Rectangle$$TData(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.VList[h].XLoc,n.VList[h].YLoc)),h);for(c=!0;c;)for(c=!1,r=0;r<n.NumOfnodes;r++){for(f=0;f<n.DegList[r];f++){var v=n.EList[(r,f)].NodeId,k=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.VList[r].XLoc,n.VList[r].YLoc),d=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.VList[v].XLoc,n.VList[v].YLoc),g=n.nodeTree.GetAllIntersecting(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(k,d));for(e=0;e<g.length;e++)if((o=g[e],!n.VList[o].Invalid)&&o!=r&&o!=v&&(s=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.VList[o].XLoc,n.VList[o].YLoc),nt=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(k,d),Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.PointIsOnSegment(nt,s))){n.RemoveEdge(r,v);n.AddEdge$$Int32$$Int32(r,o);n.AddEdge$$Int32$$Int32(o,v);c=!0;break}if(c)break}if(c)break}},CreateCompetitionMeshWithLeftPriority:function(n,t,i,r){var o,s,b,c,k,u,a,d,e,y,l,h,g,nt,v,tt,p,it,rt,ut,ft,f;for(Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.CreateFourRaysPerVertex(n,i,r),System.Console.WriteLine$$String("Creating Mesh of size "+System.Math.Max$$Int32$$Int32(i,r)),o=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor,System.Int32.ctor),s=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor,System.Int32.ctor),b=0;b<=System.Math.Max$$Int32$$Int32(i,r);b++){for(c=0;c<n.N;c++)for(k=n.VList[c].SegmentList.get_Keys().GetEnumerator();k.MoveNext();)if(u=k.get_Current(),n.VList[c].SegmentList.get_Item$$TKey(u)!=!1)for(a=0;a<n.N;a++)if(c!=a)for(d=n.VList[a].SegmentList.get_Keys().GetEnumerator();d.MoveNext();)if(e=d.get_Current(),Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.PointIsOnAxisAlignedSegment(e,u.get_End()))if(u.get_Start().get_X()|0==u.get_End().get_X()|0&&e.get_Start().get_X()|0==e.get_End().get_X()|0||u.get_Start().get_Y()|0==u.get_End().get_Y()|0&&e.get_Start().get_Y()|0==e.get_End().get_Y()|0){if(u.get_End().get_X()|0==e.get_Start().get_X()|0&&u.get_End().get_Y()|0==e.get_Start().get_Y()|0)continue;l=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindVertexClosestToSegmentEnd(n,u);h=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindVertexClosestToSegmentEnd(n,e);l==h&&System.Console.WriteLine$$String("degenerate parallel collision");n.AddEdge$$Int32$$Int32(l,h)&&(y=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u.get_Start(),e.get_Start()),s.ContainsKey(y)||s.Add(y,-1),y=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(e.get_Start(),u.get_Start()),s.ContainsKey(y)||s.Add(y,-1),o.ContainsKey(u)||o.Add(u,c),o.ContainsKey(e)||o.Add(e,a))}else{if(Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.PointIsOnAxisAlignedSegment(e,u.get_End())&&Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.PointIsOnAxisAlignedSegment(u,e.get_End())&&c>a)continue;if(n.GetNode(u.get_End().get_X()|0,u.get_End().get_Y()|0)==-1){var l=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindClosestVertexWhileWalkingToStart(n,e,u.get_End()),h=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindClosestVertexWhileWalkingToEnd(n,e,u.get_End()),et=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindVertexClosestToSegmentEnd(n,u),w=n.NumOfnodes;n.VList[w]=function(){var n=new Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor(u.get_End().get_X()|0,u.get_End().get_Y()|0);return n.Id=w,n}();n.NumOfnodes++;l>=0&&n.AddEdge$$Int32$$Int32(l,w);h>=0&&n.AddEdge$$Int32$$Int32(h,w);et>=0&&n.AddEdge$$Int32$$Int32(et,w);l==h&&System.Console.WriteLine$$String("degenerate");l>=0&&h>=0&&n.RemoveEdge(l,h);!o.ContainsKey(u)&&Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.HittedSegmentComesFromLeft(e,u)&&(o.Add(u,c),s.ContainsKey(u)||s.Add(u,-1))}else l=n.GetNode(u.get_End().get_X()|0,u.get_End().get_Y()|0),h=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FindVertexClosestToSegmentEnd(n,u),h==-1&&System.Console.WriteLine$$String("vertex not found error"),n.AddEdge$$Int32$$Int32(l,h),!o.ContainsKey(u)&&Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities.HittedSegmentComesFromLeft(e,u)&&(o.Add(u,c),s.ContainsKey(u)||s.Add(u,-1))}for(g=o.GetEnumerator();g.MoveNext();)f=g.get_Current(),n.VList[f.get_Value()].SegmentList.Remove(f.get_Key());for(o.Clear(),nt=s.GetEnumerator();nt.MoveNext();)f=nt.get_Current(),f.get_Value()>=0?n.VList[f.get_Value()].SegmentList.Add(f.get_Key(),!0):n.VList[n.GetNode(f.get_Key().get_Start().get_X()|0,f.get_Key().get_Start().get_Y()|0)].SegmentList.Add(f.get_Key(),!1);for(s.Clear(),v=0;v<n.N;v++)for(tt=n.VList[v].SegmentList.get_Keys().GetEnumerator();tt.MoveNext();)(p=tt.get_Current(),n.VList[v].SegmentList.get_Item$$TKey(p)!=!1)&&(it=Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.GrowOneUnit(p,i+1,r+1),it.get_X()>=0&&(rt=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(p.get_Start(),it),s.ContainsKey(rt)||s.Add(rt,v),o.ContainsKey(p)||o.Add(p,v)));for(ut=o.GetEnumerator();ut.MoveNext();)f=ut.get_Current(),n.VList[f.get_Value()].SegmentList.Remove(f.get_Key());for(o.Clear(),ft=s.GetEnumerator();ft.MoveNext();)f=ft.get_Current(),f.get_Value()>=0?n.VList[f.get_Value()].SegmentList.Add(f.get_Key(),!0):n.VList[n.GetNode(f.get_Key().get_Start().get_X()|0,f.get_Key().get_Start().get_Y()|0)].SegmentList.Add(f.get_Key(),!1);s.Clear()}Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FixMesh(n);System.Console.WriteLine$$String("Mesh Created")}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$MeshCreator);Microsoft$Msagl$GraphmapsWithMesh$OrthogonalEdge={fullname:"Microsoft.Msagl.GraphmapsWithMesh.OrthogonalEdge",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.a=null;this.b=null;System.Object.ctor.call(this);n.XLoc==t.XLoc&&(n.YLoc<=t.YLoc?(this.a=n,this.b=t):(this.a=t,this.b=n));n.YLoc==t.YLoc&&(n.XLoc<=t.XLoc?(this.a=n,this.b=t):(this.a=t,this.b=n))}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$OrthogonalEdge);Microsoft$Msagl$GraphmapsWithMesh$yCoordinateComparator={fullname:"Microsoft.Msagl.GraphmapsWithMesh.yCoordinateComparator",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)},Compare:function(n,t){return n.YLoc<t.YLoc?1:n.YLoc==t.YLoc?0:-1}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$yCoordinateComparator);Microsoft$Msagl$GraphmapsWithMesh$xCoordinateComparator={fullname:"Microsoft.Msagl.GraphmapsWithMesh.xCoordinateComparator",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)},Compare:function(n,t){return n.XLoc<t.XLoc?1:n.XLoc==t.XLoc?0:-1}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$xCoordinateComparator);Microsoft$Msagl$GraphmapsWithMesh$MeshGraph={fullname:"Microsoft.Msagl.GraphmapsWithMesh.MeshGraph",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$MeshGraph);Microsoft$Msagl$GraphmapsWithMesh$MsaglUtilities={fullname:"Microsoft.Msagl.GraphmapsWithMesh.MsaglUtilities",baseTypeName:"System.Object",staticDefinition:{HittedSegmentComesFromLeft:function(n,t){return t.get_Start().get_X()==t.get_End().get_X()&&t.get_Start().get_Y()<=t.get_End().get_Y()&&n.get_End().get_X()<=n.get_Start().get_X()?!0:t.get_Start().get_Y()==t.get_End().get_Y()&&t.get_Start().get_X()>=t.get_End().get_X()&&n.get_End().get_Y()<=n.get_Start().get_Y()?!0:t.get_Start().get_X()==t.get_End().get_X()&&t.get_Start().get_Y()>=t.get_End().get_Y()&&n.get_End().get_X()>=n.get_Start().get_X()?!0:t.get_Start().get_Y()==t.get_End().get_Y()&&t.get_Start().get_X()<=t.get_End().get_X()&&n.get_End().get_Y()>=n.get_Start().get_Y()?!0:!1},PointIsOnAxisAlignedSegment:function(n,t){return n.get_Start().get_X()|0==n.get_End().get_X()|0&&n.get_Start().get_X()|0==t.get_X()|0&&(n.get_Start().get_Y()<n.get_End().get_Y()&&n.get_Start().get_Y()<=t.get_Y()&&t.get_Y()<=n.get_End().get_Y()||n.get_Start().get_Y()>n.get_End().get_Y()&&n.get_Start().get_Y()>=t.get_Y()&&t.get_Y()>=n.get_End().get_Y())?!0:n.get_Start().get_Y()|0==n.get_End().get_Y()|0&&n.get_Start().get_Y()|0==t.get_Y()|0&&(n.get_Start().get_X()<n.get_End().get_X()&&n.get_Start().get_X()<=t.get_X()&&t.get_X()<=n.get_End().get_X()||n.get_Start().get_X()>n.get_End().get_X()&&n.get_Start().get_X()>=t.get_X()&&t.get_X()>=n.get_End().get_X())?!0:!1},PointIsOnSegment:function(n,t){var i=System.Math.Sqrt((n.get_Start().get_X()-n.get_End().get_X())*(n.get_Start().get_X()-n.get_End().get_X())+(n.get_Start().get_Y()-n.get_End().get_Y())*(n.get_Start().get_Y()-n.get_End().get_Y())),r=System.Math.Sqrt((n.get_Start().get_X()-t.get_X())*(n.get_Start().get_X()-t.get_X())+(n.get_Start().get_Y()-t.get_Y())*(n.get_Start().get_Y()-t.get_Y())),u=System.Math.Sqrt((t.get_X()-n.get_End().get_X())*(t.get_X()-n.get_End().get_X())+(t.get_Y()-n.get_End().get_Y())*(t.get_Y()-n.get_End().get_Y()));return i<r+u+.0001&&r+u-.0001<i?!0:!1},EucledianDistance:function(n,t,i,r){return System.Math.Sqrt((n-i)*(n-i)+(t-r)*(t-r))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$MsaglUtilities);Microsoft$Msagl$GraphmapsWithMesh$Network={fullname:"Microsoft.Msagl.GraphmapsWithMesh.Network",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Int32$$Int32$$Boolean:function(n,t){this.Edges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Twin.ctor);this.N=0;this.E=0;this.M=null;System.Object.ctor.call(this);this.N=n;this.E=t;throw $CreateException(new System.InvalidOperationException.ctor,new Error);},ctor$$Int32$$Int32:function(n){var t,i;this.Edges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Twin.ctor);this.N=0;this.E=0;this.M=null;System.Object.ctor.call(this);this.N=n;throw $CreateException(new System.InvalidOperationException.ctor,new Error);}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$Network);Microsoft$Msagl$GraphmapsWithMesh$PlanarGraphUtilities={fullname:"Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities",baseTypeName:"System.Object",staticDefinition:{TransformToGeometricPlanarGraph:function(n){var r,f,t,i,e,o,u;for(System.Console.WriteLine$$String("Transforming into a planar graph."),t=0;t<n.NumOfnodes;t++){for(r=new Array(n.DegList[t]),f=new Float64Array(n.DegList[t]),i=0;i<n.DegList[t];i++){r[i]=n.EList[(t,i)];var s=n.VList[t],h=n.VList[n.EList[(t,0)].NodeId],c=n.VList[n.EList[(t,i)].NodeId];f[i]=Microsoft.Msagl.GraphmapsWithMesh.Angle.getClockwiseAngle(s,h,c)}for(System.Array.Sort$2$$TKey$Array$$TValue$Array(System.Double.ctor,Microsoft.Msagl.GraphmapsWithMesh.Edge.ctor,f,r),i=0;i<n.DegList[t];i++)n.EList[(t,i)]=r[i]}for(n.isPlanar=!0,t=0;t<n.NumOfnodes;t++)for(i=0;i<n.DegList[t];i++){for(e=n.EList[(t,i)].NodeId,o=!1,u=0;u<n.DegList[e];u++)n.EList[(e,u)].NodeId==t&&(o=!0);o||System.Console.WriteLine$$String("Beware! Graph is Not Consistent!")}},GetAnticlockwiseNextNeighbor:function(n,t,i){var u=-1,r;if(n.isPlanar)for(r=0;r<n.DegList[t];r++)if(n.EList[(t,r)].NodeId==i){u=r+1<n.DegList[t]?n.EList[(t,r+1)].NodeId:n.EList[(t,0)].NodeId;break}return u},GetRightIncidentFace:function(n,t,i,r){var o;r.Value=!1;var f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor),u=i,e=t;do{if(o=Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities.GetAnticlockwiseNextNeighbor(n,u.Id,e.Id),e=u,u=n.VList[o],f.Contains(u)){r.Value=!0;break}f.Add(u)}while(!(t.Id==e.Id&&i.Id==u.Id));return f},RemoveLongEdgesFromThinFaces:function(n){var u,t,i,e,r;for(System.Console.WriteLine$$String("Removing Thin Faces"),u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities.Face.ctor),t=0;t<n.NumOfnodes;t++)for(i=0;i<n.DegList[t];i++){var f,s=n.VList[t],h=n.VList[n.EList[(t,i)].NodeId],o=function(){var t={Value:f},i=Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities.GetRightIncidentFace(n,s,h,t);return f=t.Value,i}();f||Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities.AllBoundaryVerticesAreJunctions(n,o)!=!1&&u.Add(new Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities.Face.ctor(o))}for(e=u.GetEnumerator();e.MoveNext();)(r=e.get_Current(),Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities.FaceIsStillValid(n,r.boundary))&&(Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities.GetFacewidth(r.boundary)>n.thinness||Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities.RemoveLongestEdge(n,r.boundary))},FaceIsStillValid:function(n,t){for(var i=t.ToArray(),r=0;r<i.length;r++){if(r+1==i.length){if(n.IsAnEdge(i[r].Id,i[0].Id)==!1)return!1;continue}if(n.IsAnEdge(i[r].Id,i[r+1].Id)==!1)return!1}return!0},AllBoundaryVerticesAreJunctions:function(n,t){for(var i=t.GetEnumerator(),r;i.MoveNext();)if(r=i.get_Current(),r.Id<n.N)return!1;return!0},GetFacewidth:function(n){var t=new Array(n.get_Count());throw $CreateException(new System.InvalidOperationException.ctor,new Error);},RemoveLongestEdge:function(n,t){for(var f=-1,r,e=null,i=null,o=null,s=null,h=t.GetEnumerator(),u;h.MoveNext();){if(u=h.get_Current(),i==null){e=i=u;continue}r=n.GetEucledianDist(u.Id,i.Id);f<r&&(o=i,s=u,f=r);i=u}return r=n.GetEucledianDist(i.Id,e.Id),f<r&&(o=e,s=i,f=r),n.RemoveEdge(o.Id,s.Id)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$PlanarGraphUtilities);Microsoft$Msagl$GraphmapsWithMesh$PointSet={fullname:"Microsoft.Msagl.GraphmapsWithMesh.PointSet",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Int32:function(n){var i,r,u,t;for(this.NumPoints=0,this.Pt=null,this.NumOfLevels=0,this._selected=null,this.pointMap=null,System.Object.ctor.call(this),this.NumPoints=n,this.Pt=new Array(n),i=new System.Random.ctor$$Int32(2);n>0;)(r=i.Next$$Int32(100),u=i.Next$$Int32(100),this.exists(r,u,n))||(n--,this.Pt[n]=new Microsoft.Msagl.GraphmapsWithMesh.WeightedPoint.ctor$$Int32$$Int32$$Int32(r,u,0));for(t=0;t<this.NumPoints;t++)this.Pt[t].X*=3,this.Pt[t].Y*=3},isVeryClose:function(n,t,i){for(var u,r=this.NumPoints-1;r>i;r--)if(u=System.Math.Sqrt((this.Pt[r].X-n)*(this.Pt[r].X-n)+(this.Pt[r].Y-t)*(this.Pt[r].Y-t)),u<=3)return!0;return!1},exists:function(n,t,i){for(var r=this.NumPoints-1;r>i;r--)if(this.Pt[r].X==n&&this.Pt[r].Y==t)return!0;return!1},ctor$$Int32$$Tiling$$Int32:function(n){this.NumPoints=0;this.Pt=null;this.NumOfLevels=0;this._selected=null;this.pointMap=null;System.Object.ctor.call(this);this.NumPoints=n;this.Pt=new Array(n+1);throw $CreateException(new System.InvalidOperationException.ctor,new Error);},AssignWeight:function(n,t,i){for(var u,o,f,e,r=1;r<=t;r++)for(n[r].Weight++,u=r+1;u<=t;u++)o=System.Math.Sqrt((n[r].X-n[u].X)*(n[r].X-n[u].X)+(n[r].Y-n[u].Y)*(n[r].Y-n[u].Y)),o<i&&(n[r].Weight++,n[u].Weight++);for(f=t,e=0,r=1;r<=t;r++)e<n[r].Weight&&(e=n[r].Weight),f>n[r].Weight&&(f=n[r].Weight);for(r=1;r<=t;r++)n[r].Weight=50+(n[r].Weight-f)*200/(e-f)|0}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$PointSet);Microsoft$Msagl$GraphmapsWithMesh$WeightedPoint={fullname:"Microsoft.Msagl.GraphmapsWithMesh.WeightedPoint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.X=0;this.Y=0;this.Weight=0;this.GridPoint=0;this.ZoomLevel=0;System.Object.ctor.call(this)},ctor$$Int32$$Int32$$Int32:function(n,t,i){this.X=0;this.Y=0;this.Weight=0;this.GridPoint=0;this.ZoomLevel=0;System.Object.ctor.call(this);this.X=n;this.Y=t;this.Weight=i}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$WeightedPoint);Microsoft$Msagl$GraphmapsWithMesh$PointToSegmentDistance={fullname:"Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance",baseTypeName:"System.Object",staticDefinition:{GetDistance$$Point$$Point$$Point:function(n,t,i){return Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.GetDistance$$Vertex$$Vertex$$Vertex(new Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor(n.get_X()|0,n.get_Y()|0),new Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor(t.get_X()|0,t.get_Y()|0),new Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor(i.get_X()|0,i.get_Y()|0))},getClosestPoint:function(n,t,i){var f=new Float64Array(2),r,e,o;f[0]=i.XLoc-n.XLoc;f[1]=i.YLoc-n.YLoc;r=new Float64Array(2);r[0]=t.XLoc-n.XLoc;r[1]=t.YLoc-n.YLoc;var s=r[0]*r[0]+r[1]*r[1],h=f[0]*r[0]+f[1]*r[1],u=h/s;return u<0&&(u=0),u>1&&(u=1),e=n.XLoc+r[0]*u,o=n.YLoc+r[1]*u,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,o)},GetDistance$$Vertex$$Vertex$$Vertex:function(n,t,i){var u=Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.CrossProduct(n,t,i)/Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.Distance(n,t),f=Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.DotProduct(n,t,i),r;return f>0?Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.Distance(t,i):(r=Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.DotProduct(t,n,i),r>0)?Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.Distance(n,i):System.Math.Abs$$Double(u)},DotProduct:function(n,t,i){var r=new Float64Array(2),u=new Float64Array(2);return r[0]=t.XLoc-n.XLoc,r[1]=t.YLoc-n.YLoc,u[0]=i.XLoc-t.XLoc,u[1]=i.YLoc-t.YLoc,r[0]*u[0]+r[1]*u[1]},CrossProduct:function(n,t,i){var r=new Float64Array(2),u=new Float64Array(2);return r[0]=t.XLoc-n.XLoc,r[1]=t.YLoc-n.YLoc,u[0]=i.XLoc-n.XLoc,u[1]=i.YLoc-n.YLoc,r[0]*u[1]-r[1]*u[0]},Distance:function(n,t){var i=n.XLoc-t.XLoc,r=n.YLoc-t.YLoc;return System.Math.Sqrt(i*i+r*r)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$PointToSegmentDistance);Microsoft$Msagl$GraphmapsWithMesh$SteinerTree={fullname:"Microsoft.Msagl.GraphmapsWithMesh.SteinerTree",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.Edgelist=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Tuple.ctor);this.SpanningTree=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Twin.ctor);System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$SteinerTree);Microsoft$Msagl$GraphmapsWithMesh$Component={fullname:"Microsoft.Msagl.GraphmapsWithMesh.Component",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.CId=0;this.Dist=0;this.Dead=!0;this.V=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor);this.Segments=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.VertexNeighbor.ctor);System.Object.ctor.call(this)},AddVertex:function(n){for(var t=this.V.GetEnumerator(),i;t.MoveNext();)if(i=t.get_Current(),n.Id==i.Id)return;this.V.Add(n)}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$Component);Microsoft$Msagl$GraphmapsWithMesh$Twin={fullname:"Microsoft.Msagl.GraphmapsWithMesh.Twin",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.A=0;this.B=0;System.Object.ctor.call(this);this.A=n;this.B=t}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$Twin);Microsoft$Msagl$GraphmapsWithMesh$Tuple={fullname:"Microsoft.Msagl.GraphmapsWithMesh.Tuple",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.A=null;this.B=null;this.Value=0;System.Object.ctor.call(this);this.A=n;this.B=t;this.Value=i}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$Tuple);Microsoft$Msagl$GraphmapsWithMesh$Tiling={fullname:"Microsoft.Msagl.GraphmapsWithMesh.Tiling",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Int32$$Boolean:function(n){this.NumOfnodes=0;this.NumOfnodesBeforeDetour=0;this.maxTheoreticalZoomLevel=0;this.pathList=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Collections.Generic.List$1.ctor);this.JunctionToEdgeList=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.List$1.ctor);this.nodeToLoc=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor);this.NodeMap=null;this.DegList=null;this.VList=null;this.EList=null;this.Maxweight=0;this.maxDeg=0;this.N=0;this._sNet=null;this._edgeNodeSeparation=null;this._angularResolution=0;this.isPlanar=!1;this.thinness=0;this.nodeTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(System.Int32.ctor);this.edgeTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(System.Int32.ctor);this.allcandidates=null;System.Object.ctor.call(this);this.thinness=2;this._angularResolution=.3;this.NumOfnodes=this.N=n;this.maxDeg=15;throw $CreateException(new System.InvalidOperationException.ctor,new Error);},ctor$$Int32:function(n){this.NumOfnodes=0;this.NumOfnodesBeforeDetour=0;this.maxTheoreticalZoomLevel=0;this.pathList=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Collections.Generic.List$1.ctor);this.JunctionToEdgeList=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.List$1.ctor);this.nodeToLoc=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor);this.NodeMap=null;this.DegList=null;this.VList=null;this.EList=null;this.Maxweight=0;this.maxDeg=0;this.N=0;this._sNet=null;this._edgeNodeSeparation=null;this._angularResolution=0;this.isPlanar=!1;this.thinness=0;this.nodeTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(System.Int32.ctor);this.edgeTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(System.Int32.ctor);this.allcandidates=null;System.Object.ctor.call(this);this.N=n;this._angularResolution=.3;throw $CreateException(new System.InvalidOperationException.ctor,new Error);},InsertVertex:function(n,t){var i=this.NumOfnodes;return this.VList[i]=function(){var r=new Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor(n,t);return r.Id=i,r}.call(this),this.NumOfnodes++,i},InsertVertexWithDuplicateCheck:function(n,t,i){var u=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,t),r;return i.ContainsKey(u)?i.get_Item$$TKey(u):(r=this.NumOfnodes,this.VList[r]=function(){var i=new Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor(n,t);return i.Id=r,i}.call(this),i.Add(u,r),this.NumOfnodes++,r)},ComputeGridEdgeWeights:function(){for(var n,i,r,e,f,o,t=new System.Collections.Queue.ctor,u=1;u<=this.NumOfnodes;u++)if(this.VList[u].Weight!=0){for(t.Enqueue(u);t.get_Count()>0;){if(n=t.Dequeue(),this.VList[n].Visited)continue;else this.VList[n].Visited=!0;for(i=1;i<=this.DegList[n];i++)if(r=this.EList[(n,i)].NodeId,this.VList[r].Visited==!1){if(t.Enqueue(r),e=this.GetWeight(u,n,r,this.VList[u].Weight|0),e<0||t.get_Count()>200){t.Clear();break}for(this.EList[(n,i)].Weight+=e,this.Maxweight<this.EList[(n,i)].Weight&&(this.Maxweight=this.EList[(n,i)].Weight),f=1;f<=this.DegList[r];f++)this.EList[(r,f)].NodeId==n&&(this.EList[(r,f)].Weight+=e)}}for(t.Clear(),o=1;o<=this.NumOfnodes;o++)this.VList[o].Visited=!1}},GetWeight:function(n,t,i,r){var f=System.Math.Sqrt((this.VList[n].XLoc-this.VList[t].XLoc)*(this.VList[n].XLoc-this.VList[t].XLoc)+(this.VList[n].YLoc-this.VList[t].YLoc)*(this.VList[n].YLoc-this.VList[t].YLoc)),e=System.Math.Sqrt((this.VList[n].XLoc-this.VList[i].XLoc)*(this.VList[n].XLoc-this.VList[i].XLoc)+(this.VList[n].YLoc-this.VList[i].YLoc)*(this.VList[n].YLoc-this.VList[i].YLoc)),u,o,s;return this.VList[n].Id==this.VList[t].Id?1e3:(u=15,r=50,o=r*(System.Math.Exp(-(f*f/(2*u*u)))/(u*System.Math.Sqrt(6.28318530717959))),s=r*(System.Math.Exp(-(e*e/(2*u*u)))/(u*System.Math.Sqrt(6.28318530717959))),(o+s)/2+.0001)},GetEucledianDist:function(n,t){return System.Math.Sqrt((this.VList[n].XLoc-this.VList[t].XLoc)*(this.VList[n].XLoc-this.VList[t].XLoc)+(this.VList[n].YLoc-this.VList[t].YLoc)*(this.VList[n].YLoc-this.VList[t].YLoc))},buildCrossingCandidates:function(){var n;for(this.allcandidates=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,Int32Array),n=this.N;n<this.NumOfnodesBeforeDetour;n++){var t=this.VList[n],i=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.XLoc-15,t.YLoc-15),r=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.XLoc+15,t.YLoc+15),u=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(i,r),f=this.nodeTree.GetAllIntersecting(u);this.allcandidates.Add(n,f)}},MsaglMoveToMaximizeMinimumAngle:function(){throw $CreateException(new System.InvalidOperationException.ctor,new Error);},noCrossingsHeuristics:function(n,t){var r,u,i,f,o,h;if(function(){var n={Value:r},i=this.allcandidates.TryGetValue(t,n);return r=n.Value,i}.call(this),r.length==0)return!0;for(u=0;u<r.length;u++)for(i=r[u],f=0;f<this.DegList[i];f++){var e=this.EList[(i,f)].NodeId,c=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[i].XLoc,this.VList[i].YLoc),l=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[e].XLoc,this.VList[e].YLoc);for(o=0;o<this.DegList[n.Id];o++){var s=this.EList[(n.Id,o)].NodeId,a=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.XLoc,n.YLoc),v=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[s].XLoc,this.VList[s].YLoc);if(n.Id!=i&&s!=i&&n.Id!=e&&s!=e&&function(){var n={Value:h},t=Microsoft.Msagl.Core.Geometry.Point.SegmentSegmentIntersection(c,l,a,v,n);return h=n.Value,t}.call(this))return!1}}return!0},noCrossings$$Vertex:function(n){for(var i,u,e,t=0;t<this.NumOfnodes;t++)for(i=0;i<this.DegList[t];i++){var r=this.EList[(t,i)].NodeId,o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[t].XLoc,this.VList[t].YLoc),s=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[r].XLoc,this.VList[r].YLoc);for(u=0;u<this.DegList[n.Id];u++){var f=this.EList[(n.Id,u)].NodeId,h=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.XLoc,n.YLoc),c=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[f].XLoc,this.VList[f].YLoc);if(n.Id!=t&&f!=t&&n.Id!=r&&f!=r&&function(){var n={Value:e},t=Microsoft.Msagl.Core.Geometry.Point.SegmentSegmentIntersection(o,s,h,c,n);return e=n.Value,t}.call(this))return!1}}return!0},noCrossings$$Vertex$$Vertex$$Vertex:function(n,t,i){var w=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.XLoc,t.YLoc),b=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i.XLoc,i.YLoc),s,h,c,l,f=5,e,r,o,u,v,y,p;s=System.Math.Min$$Int32$$Int32(t.XLoc,i.XLoc);c=System.Math.Max$$Int32$$Int32(t.XLoc,i.XLoc);h=System.Math.Min$$Int32$$Int32(t.YLoc,i.YLoc);l=System.Math.Max$$Int32$$Int32(t.YLoc,i.YLoc);var k=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(s-f,h-f),d=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(c+f,l+f),g=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(k,d),a=this.nodeTree.GetAllIntersecting(g);for(e=0;e<a.length;e++)if(r=a[e],n.Id!=r&&t.Id!=r&&i.Id!=r)for(o=0;o<this.DegList[r];o++)if((u=this.EList[(r,o)].NodeId,t.Id!=u&&i.Id!=u)&&(v=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[r].XLoc,this.VList[r].YLoc),y=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[u].XLoc,this.VList[u].YLoc),function(){var n={Value:p},t=Microsoft.Msagl.Core.Geometry.Point.SegmentSegmentIntersection(v,y,w,b,n);return p=n.Value,t}.call(this)))return!1;return!0},noCrossings$$Int32$Array$$Int32$$Int32:function(n,t,i){for(var u,r,s,f,v,y,p,e=this.VList[t],o=this.VList[i],c=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e.XLoc,e.YLoc),l=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(o.XLoc,o.YLoc),w=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(c,l),a=this.nodeTree.GetAllIntersecting(w),h=0;h<a.length;h++){for(u=a[h],r=0;r<n.length;r++)if(n[r]==u)break;if(!(r<n.length)&&e.Id!=u&&o.Id!=u)for(s=0;s<this.DegList[u];s++){for(f=this.EList[(u,s)].NodeId,r=0;r<n.length;r++)if(n[r]==f)break;if(!(r<n.length)&&e.Id!=f&&o.Id!=f&&(v=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[u].XLoc,this.VList[u].YLoc),y=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[f].XLoc,this.VList[f].YLoc),function(){var n={Value:p},t=Microsoft.Msagl.Core.Geometry.Point.SegmentSegmentIntersection(v,y,c,l,n);return p=n.Value,t}.call(this)))return!1}}return!0},Crossings:function(n,t){for(var i,u,r,l,a,v,e=this.VList[n],o=this.VList[t],s=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e.XLoc,e.YLoc),h=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(o.XLoc,o.YLoc),y=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(s,h),c=this.nodeTree.GetAllIntersecting(y),f=0;f<c.length;f++)if(i=c[f],i!=n&&i!=t)for(u=0;u<this.DegList[i];u++)if((r=this.EList[(i,u)].NodeId,n!=r&&t!=r)&&(l=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[i].XLoc,this.VList[i].YLoc),a=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[r].XLoc,this.VList[r].YLoc),function(){var n={Value:v},t=Microsoft.Msagl.Core.Geometry.Point.SegmentSegmentIntersection(l,a,s,h,n);return v=n.Value,t}.call(this)))return!0;return!1},MsaglGoodResolution:function(n,t,i,r){for(var f,e,o,u=1;u<i;u++){for(f=u+1;f<=i;f++)if(Microsoft.Msagl.GraphmapsWithMesh.Angle.getAngleIfSmallerThanPIby2(n,this.VList[t[(u,1)]],this.VList[t[(f,1)]])<this._angularResolution)return!1;var h=System.Math.Min$$Int32$$Int32(n.XLoc,this.VList[t[(u,1)]].XLoc)-r,c=System.Math.Min$$Int32$$Int32(n.YLoc,this.VList[t[(u,1)]].YLoc)-r,l=System.Math.Max$$Int32$$Int32(n.XLoc,this.VList[t[(u,1)]].XLoc)+r,a=System.Math.Max$$Int32$$Int32(n.YLoc,this.VList[t[(u,1)]].YLoc)+r,v=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(h,c),y=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(l,a),p=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(v,y),s=this.nodeTree.GetAllIntersecting(p);for(e=0;e<s.length;e++)if((o=this.VList[s[e]],o.Id!=n.Id&&o.Id!=this.VList[t[(u,1)]].Id)&&Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.GetDistance$$Vertex$$Vertex$$Vertex(n,this.VList[t[(u,1)]],o)<this._edgeNodeSeparation[0])return!1}return!0},GoodResolution:function(n,t,i){for(var f,e,u,r=1;r<=i;r++){for(f=r+1;f<=i;f++)if(Microsoft.Msagl.GraphmapsWithMesh.Angle.getAngleIfSmallerThanPIby2(n,this.VList[t[1]],this.VList[t[1]])<.5)return!1;for(e=this._sNet.V.GetEnumerator();e.MoveNext();)if((u=e.get_Current(),u.Id!=n.Id&&u.Id!=this.VList[t[(r,1)]].Id&&!u.Invalid)&&Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.GetDistance$$Vertex$$Vertex$$Vertex(n,this.VList[t[(r,1)]],u)<this._edgeNodeSeparation[this.EList[(n.Id,t[(r,2)])].Selected])return!1}return!0},IsWellSeperated:function(n,t,i,r,u){for(var o,f,e=1;e<=u;e++)if(!this.VList[r[e].GridPoint].Invalid&&(r[e].X!=this.VList[t].XLoc||r[e].Y!=this.VList[t].YLoc)&&(r[e].X!=this.VList[i].XLoc||r[e].Y!=this.VList[i].YLoc)){for(o=0,f=1;f<=this.DegList[n.Id];f++)if(this.EList[(n.Id,f)].NodeId==t){o=f;break}if(Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.GetDistance$$Vertex$$Vertex$$Vertex(this.VList[t],this.VList[i],this.VList[r[e].GridPoint])<this._edgeNodeSeparation[this.EList[(n.Id,o)].Selected])return!1}for(f=1;f<=this.DegList[t];f++)if(this.EList[(t,f)].Used!=0&&this.EList[(t,f)].NodeId!=n.Id&&this.EList[(t,f)].NodeId!=i&&Microsoft.Msagl.GraphmapsWithMesh.Angle.getAngleIfSmallerThanPIby2(n,this.VList[t],this.VList[i])<this._angularResolution)return!1;for(f=1;f<=this.DegList[i];f++)if(this.EList[(i,f)].Used!=0&&this.EList[(i,f)].NodeId!=n.Id&&this.EList[(i,f)].NodeId!=t){var s=this.VList[i].XLoc-this.VList[t].XLoc,h=this.VList[i].YLoc-this.VList[t].YLoc,c=this.VList[i].XLoc-this.VList[this.EList[(i,f)].NodeId].XLoc,l=this.VList[i].YLoc-this.VList[this.EList[(i,f)].NodeId].YLoc;if(System.Math.Abs$$Double(System.Math.Atan2(h,s)-System.Math.Atan2(l,c))<this._angularResolution)return!1}return!0},MsaglIsWellSeperated:function(n,t,i){for(var u,r,o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[t].XLoc,this.VList[t].YLoc),s=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[i].XLoc,this.VList[i].YLoc),h=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(o,s),e=this.nodeTree.GetAllIntersecting(h),f=0;f<e.length;f++)if((u=e[f],!this.VList[u].Invalid&&this.DegList[u]!=0&&this.VList[u].Id!=t&&this.VList[u].Id!=i&&this.VList[u].Id!=n.Id)&&Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.GetDistance$$Vertex$$Vertex$$Vertex(this.VList[t],this.VList[i],this.VList[u])<this._edgeNodeSeparation[0])return!1;for(r=0;r<this.DegList[t];r++)if(this.EList[(t,r)].NodeId!=n.Id&&this.EList[(t,r)].NodeId!=i&&Microsoft.Msagl.GraphmapsWithMesh.Angle.getAngleIfSmallerThanPIby2(this.VList[t],this.VList[i],this.VList[this.EList[(t,r)].NodeId])<this._angularResolution)return!1;for(r=0;r<this.DegList[i];r++)if(this.EList[(i,r)].NodeId!=n.Id&&this.EList[(i,r)].NodeId!=t&&Microsoft.Msagl.GraphmapsWithMesh.Angle.getAngleIfSmallerThanPIby2(this.VList[i],this.VList[t],this.VList[this.EList[(i,r)].NodeId])<this._angularResolution)return!1;return!0},MsaglRemoveDeg2:function(){throw $CreateException(new System.InvalidOperationException.ctor,new Error);},RemoveDeg2:function(){throw $CreateException(new System.InvalidOperationException.ctor,new Error);},MsaglDetour:function(n,t){var i;if(this.NumOfnodesBeforeDetour=this.NumOfnodes,!t)for(i=0;i<this.N;i++){var r=this.VList[i],u=new Array(10);throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},CreateNodeTreeEdgeTree:function(){this.nodeTree.Clear();for(var n=0;n<this.NumOfnodes;n++)this.DegList[n]>0&&this.nodeTree.Add$$Rectangle$$TData(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.VList[n].XLoc,this.VList[n].YLoc)),n);this.edgeTree.Clear()},ComputeDetourAroundVertex:function(n,t){for(var i,r,u,f=t;f>=1;f--){if(i=n[f].X,r=n[f].Y,i+1<this.N&&r+1<this.N&&this.NodeMap[(i+1,r+1)]>0&&i+2<this.N&&r<this.N&&this.NodeMap[(i+2,r)]>0)for(u=1;u<=this.DegList[this.NodeMap[(i+1,r+1)]];u++)if(this.EList[(this.NodeMap[(i+1,r+1)],u)].NodeId==this.VList[this.NodeMap[(i+2,r)]].Id){this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i+1,r+1)]],this.VList[this.EList[(this.NodeMap[(i+1,r+1)],u)].NodeId],6);break}if(i+1>0&&r-1>0&&this.NodeMap[(i+1,r-1)]>0&&i+2<this.N&&r<this.N&&this.NodeMap[(i+2,r)]>0)for(u=1;u<=this.DegList[this.NodeMap[(i+1,r-1)]];u++)if(this.EList[(this.NodeMap[(i+1,r-1)],u)].NodeId==this.VList[this.NodeMap[(i+2,r)]].Id){this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i+1,r-1)]],this.VList[this.EList[(this.NodeMap[(i+1,r-1)],u)].NodeId],6);break}if(i-1>0&&r-1>0&&this.NodeMap[(i-1,r-1)]>0&&i-2>0&&r>0&&this.NodeMap[(i-2,r)]>0)for(u=1;u<=this.DegList[this.NodeMap[(i-1,r-1)]];u++)if(this.EList[(this.NodeMap[(i-1,r-1)],u)].NodeId==this.VList[this.NodeMap[(i-2,r)]].Id){this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i-1,r-1)]],this.VList[this.EList[(this.NodeMap[(i-1,r-1)],u)].NodeId],6);break}if(i-1>0&&r+1<this.N&&this.NodeMap[(i-1,r+1)]>0&&i-2>0&&r>0&&this.NodeMap[(i-2,r)]>0)for(u=1;u<=this.DegList[this.NodeMap[(i-1,r+1)]];u++)if(this.EList[(this.NodeMap[(i-1,r+1)],u)].NodeId==this.VList[this.NodeMap[(i-2,r)]].Id){this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i-1,r+1)]],this.VList[this.EList[(this.NodeMap[(i-1,r+1)],u)].NodeId],6);break}if(i-1>0&&r+1<this.N&&this.NodeMap[(i-1,r+1)]>0&&i+1<this.N&&r+1<this.N&&this.NodeMap[(i+1,r+1)]>0)for(u=1;u<=this.DegList[this.NodeMap[(i-1,r+1)]];u++)if(this.EList[(this.NodeMap[(i-1,r+1)],u)].NodeId==this.VList[this.NodeMap[(i+1,r+1)]].Id){this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i-1,r+1)]],this.VList[this.EList[(this.NodeMap[(i-1,r+1)],u)].NodeId],6);break}}},ComputeShortcutMesh:function(n,t){for(var i,r,u,f=t;f>=1;f--){for(i=n[f].X,r=n[f].Y;i+1<this.N&&r+1<this.N&&this.NodeMap[(i+1,r+1)]>0;){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i+1,r+1)]].Id)break;if(this.EList[(this.NodeMap[(i,r)],u)].Selected==0)break;i=i+1;r=r+1}while(i+1<this.N&&r+1<this.N&&this.NodeMap[(i+1,r+1)]>0&&this.VList[this.NodeMap[(i+1,r+1)]].CId==0){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i+1,r+1)]].Id)break;this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i,r)]],this.VList[this.EList[(this.NodeMap[(i,r)],u)].NodeId],6);i=i+1;r=r+1;this.VList[this.NodeMap[(i,r)]].CId=1;this._sNet.V.Add(this.VList[this.NodeMap[(i,r)]])}if(i+1<this.N&&r+1<this.N&&this.NodeMap[(i+1,r+1)]>0&&this.VList[this.NodeMap[(i+1,r+1)]].CId>0){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i+1,r+1)]].Id)break;this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i,r)]],this.VList[this.EList[(this.NodeMap[(i,r)],u)].NodeId],6);i=i+1;r=r+1;this.VList[this.NodeMap[(i,r)]].CId=1;this._sNet.AddVertex(this.VList[this.NodeMap[(i,r)]])}for(i=n[f].X,r=n[f].Y;i-1>0&&r+1<this.N&&this.NodeMap[(i-1,r+1)]>0;){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i-1,r+1)]].Id)break;if(this.EList[(this.NodeMap[(i,r)],u)].Selected==0)break;i=i-1;r=r+1}while(i-1>0&&r+1<this.N&&this.NodeMap[(i-1,r+1)]>0&&this.VList[this.NodeMap[(i-1,r+1)]].CId==0){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i-1,r+1)]].Id)break;this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i,r)]],this.VList[this.EList[(this.NodeMap[(i,r)],u)].NodeId],6);i=i-1;r=r+1;this.VList[this.NodeMap[(i,r)]].CId=1;this._sNet.AddVertex(this.VList[this.NodeMap[(i,r)]])}if(i-1>0&&r+1<this.N&&this.NodeMap[(i-1,r+1)]>0&&this.VList[this.NodeMap[(i-1,r+1)]].CId>0){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i-1,r+1)]].Id)break;this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i,r)]],this.VList[this.EList[(this.NodeMap[(i,r)],u)].NodeId],6);i=i-1;r=r+1;this.VList[this.NodeMap[(i,r)]].CId=1;this._sNet.AddVertex(this.VList[this.NodeMap[(i,r)]])}for(i=n[f].X,r=n[f].Y;i+1<this.N&&r-1>0&&this.NodeMap[(i+1,r-1)]>0;){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i+1,r-1)]].Id)break;if(this.EList[(this.NodeMap[(i,r)],u)].Selected==0)break;i=i+1;r=r-1}while(i+1<this.N&&r-1>0&&this.NodeMap[(i+1,r-1)]>0&&this.VList[this.NodeMap[(i+1,r-1)]].CId==0){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i+1,r-1)]].Id)break;this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i,r)]],this.VList[this.EList[(this.NodeMap[(i,r)],u)].NodeId],6);i=i+1;r=r-1;this.VList[this.NodeMap[(i,r)]].CId=1;this._sNet.AddVertex(this.VList[this.NodeMap[(i,r)]])}if(i+1<this.N&&r-1>0&&this.NodeMap[(i+1,r-1)]>0&&this.VList[this.NodeMap[(i+1,r-1)]].CId>0){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i+1,r-1)]].Id)break;this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i,r)]],this.VList[this.EList[(this.NodeMap[(i,r)],u)].NodeId],6);i=i+1;r=r-1;this.VList[this.NodeMap[(i,r)]].CId=1;this._sNet.AddVertex(this.VList[this.NodeMap[(i,r)]])}for(i=n[f].X,r=n[f].Y;i-1>0&&r-1>0&&this.NodeMap[(i-1,r-1)]>0;){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i-1,r-1)]].Id)break;if(this.EList[(this.NodeMap[(i,r)],u)].Selected==0)break;i=i-1;r=r-1}while(i-1>0&&r-1>0&&this.NodeMap[(i-1,r-1)]>0&&this.VList[this.NodeMap[(i-1,r-1)]].CId==0){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i-1,r-1)]].Id)break;this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i,r)]],this.VList[this.EList[(this.NodeMap[(i,r)],u)].NodeId],6);i=i-1;r=r-1;this.VList[this.NodeMap[(i,r)]].CId=1;this._sNet.AddVertex(this.VList[this.NodeMap[(i,r)]])}if(i-1>0&&r-1>0&&this.NodeMap[(i-1,r-1)]>0&&this.VList[this.NodeMap[(i-1,r-1)]].CId>0){for(u=1;u<=this.DegList[this.NodeMap[(i,r)]];u++)if(this.EList[(this.NodeMap[(i,r)],u)].NodeId==this.VList[this.NodeMap[(i-1,r-1)]].Id)break;this.SelectEdge(this.EList,this.DegList,this.VList[this.NodeMap[(i,r)]],this.VList[this.EList[(this.NodeMap[(i,r)],u)].NodeId],6);i=i-1;r=r-1;this.VList[this.NodeMap[(i,r)]].CId=1;this._sNet.AddVertex(this.VList[this.NodeMap[(i,r)]])}}},SelectEdge:function(n,t,i,r,u){for(var e=u,f=1;f<=t[i.Id];f++)if(n[(i.Id,f)].NodeId==r.Id){n[(i.Id,f)].Selected==0?n[(i.Id,f)].Selected=u:e=n[(i.Id,f)].Selected;break}for(f=1;f<=t[r.Id];f++)if(n[(r.Id,f)].NodeId==i.Id){n[(r.Id,f)].Selected==0?n[(r.Id,f)].Selected=u:e=n[(r.Id,f)].Selected;break}return e},AddEdge$$Int32$$Int32:function(n,t){for(var i=0;i<this.DegList[n];i++)if(this.EList[(n,i)].NodeId==t)return!1;for(i=0;i<this.DegList[t];i++)if(this.EList[(t,i)].NodeId==n)return!1;return this.EList[(n,this.DegList[n])]=new Microsoft.Msagl.GraphmapsWithMesh.Edge.ctor(t),this.DegList[n]++,this.EList[(t,this.DegList[t])]=new Microsoft.Msagl.GraphmapsWithMesh.Edge.ctor(n),this.DegList[t]++,!0},IsAnEdge:function(n,t){for(var i=0;i<this.DegList[n];i++)if(this.EList[(n,i)].NodeId==t)return!0;return!1},AddEdge$$Int32$$Int32$$Int32$$Int32:function(n,t,i,r){for(var u=0;u<this.DegList[n];u++)if(this.EList[(n,u)].NodeId==t)return!1;for(u=0;u<this.DegList[t];u++)if(this.EList[(t,u)].NodeId==n)return!1;return this.EList[(n,this.DegList[n])]=function(){var n=new Microsoft.Msagl.GraphmapsWithMesh.Edge.ctor(t);return n.Selected=i,n.Used=r,n}.call(this),this.DegList[n]++,this.EList[(t,this.DegList[t])]=function(){var t=new Microsoft.Msagl.GraphmapsWithMesh.Edge.ctor(n);return t.Selected=i,t.Used=r,t}.call(this),this.DegList[t]++,!0},GetNode:function(n,t){for(var i=0;i<this.NumOfnodes;i++)if(n==this.VList[i].XLoc&&t==this.VList[i].YLoc&&this.VList[i].Invalid==!1)return i;return-1},GetNodeOtherthanThis:function(n,t,i){for(var r=0;r<this.NumOfnodes;r++)if(t==this.VList[r].XLoc&&i==this.VList[r].YLoc&&this.VList[r].Invalid==!1&&r!=n)return r;return-1},GetNodeExceptTheGivenNode:function(n,t,i,r){for(var u,o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t-r,i-r),s=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t+r,i+r),h=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(o,s),e=this.nodeTree.GetAllIntersecting(h),f=0;f<e.length;f++)if(u=e[f],n.Id!=u&&t==this.VList[u].XLoc&&i==this.VList[u].YLoc&&this.VList[u].Invalid==!1)return u;return-1},RemoveEdge:function(n,t){for(var r=0,i=0;i<this.DegList[n];i++)if(this.EList[(n,i)].NodeId==t)for(this.DegList[n]--,r++;i<this.DegList[n];i++)this.EList[(n,i)]=this.EList[(n,i+1)];for(i=0;i<this.DegList[t];i++)if(this.EList[(t,i)].NodeId==n)for(this.DegList[t]--,r++;i<this.DegList[t];i++)this.EList[(t,i)]=this.EList[(t,i+1)];return r==2}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$Tiling);Microsoft$Msagl$GraphmapsWithMesh$Vertex={fullname:"Microsoft.Msagl.GraphmapsWithMesh.Vertex",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.Id=0;this.CId=0;this.XLoc=0;this.YLoc=0;this.PreciseX=0;this.PreciseY=0;this.TargetX=0;this.TargetY=0;this.LeftX=0;this.LeftY=0;this.RightX=0;this.RightY=0;this.Dist=0;this.Weight=0;this.ZoomLevel=0;this.Parent=null;this.Visited=!1;this.Invalid=!1;this.topRay=null;this.bottomRay=null;this.leftRay=null;this.rightRay=null;this.SegmentList=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor,System.Boolean.ctor);System.Object.ctor.call(this);this.XLoc=n;this.YLoc=t}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$Vertex);Microsoft$Msagl$GraphmapsWithMesh$Ray={fullname:"Microsoft.Msagl.GraphmapsWithMesh.Ray",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.L=null;this.dead=!1;System.Object.ctor.call(this);this.L=n}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$Ray);Microsoft$Msagl$GraphmapsWithMesh$Edge={fullname:"Microsoft.Msagl.GraphmapsWithMesh.Edge",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.Weight=1;this.EdgeId=0;this.Cost=0;this.NodeId=0;this.Selected=0;this.Used=0;System.Object.ctor.call(this);this.NodeId=n},GetEDist:function(n,t,i){return System.Math.Sqrt((n[t].XLoc-n[i].XLoc)*(n[t].XLoc-n[i].XLoc)+(n[t].YLoc-n[i].YLoc)*(n[t].YLoc-n[i].YLoc))}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$Edge);Microsoft$Msagl$GraphmapsWithMesh$ShortestPathEdgeList={fullname:"Microsoft.Msagl.GraphmapsWithMesh.ShortestPathEdgeList",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.Edgelist=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.VertexNeighbor.ctor);System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$ShortestPathEdgeList);System$ExtensionsForSharpKit={fullname:"System.ExtensionsForSharpKit",baseTypeName:"System.Object",staticDefinition:{Trim_SharpKit:function(n,t){for(var u=0,f=n.length-1,i,r;u<n.length;u++){for(i=!1,r=0;r<t.length&&!i;r++)n.charAt(u)==t[r]&&(i=!0);if(!i)break}for(;f>=0;f--){for(i=!1,r=0;r<t.length&&!i;r++)n.charAt(f)==t[r]&&(i=!0);if(!i)break}return n.substr(u,f-u+1)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(System$ExtensionsForSharpKit);SharpKitExtensions$Regex_SharpKit={fullname:"SharpKitExtensions.Regex_SharpKit",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.m_JSRegex=null;System.Object.ctor.call(this);this.m_JSRegex=new RegExp(n)},Match:function(n,t){n=n.substr(t);var i=this.m_JSRegex.exec(n);return new SharpKitExtensions.Match_SharpKit.ctor(i)}}};JsTypes.push(SharpKitExtensions$Regex_SharpKit);SharpKitExtensions$Match_SharpKit={fullname:"SharpKitExtensions.Match_SharpKit",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.m_JSResult=null;System.Object.ctor.call(this);this.m_JSResult=n},Success$$:"System.Boolean",get_Success:function(){return this.m_JSResult!=null},Value$$:"System.String",get_Value:function(){return this.m_JSResult[0]},Length$$:"System.Int32",get_Length:function(){return this.m_JSResult[0].length}}};JsTypes.push(SharpKitExtensions$Match_SharpKit);SharpKitExtensions$StringWriter_SharpKit={fullname:"SharpKitExtensions.StringWriter_SharpKit",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.m_SB=null;System.Object.ctor.call(this);this.m_SB=new System.Text.StringBuilder.ctor},WriteLine:function(n){this.m_SB.Append$$String(n);this.m_SB.Append$$String("\n")},Flush:function(){},Close:function(){},Write:function(n){this.m_SB.Append$$String(n)},toString:function(){return this.m_SB.toString()}}};JsTypes.push(SharpKitExtensions$StringWriter_SharpKit);Test$Test={fullname:"Test.Test",baseTypeName:"System.Object",staticDefinition:{RunTest:function(){System.Console.Write$$Object(Test.Test.TestInner.TestInnerEnum.A)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Test$Test);Microsoft$Msagl$Core$AlgorithmBase={fullname:"Microsoft.Msagl.Core.AlgorithmBase",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.AlgorithmBase.threadStaticCancelToken=null;Microsoft.Msagl.Core.AlgorithmBase.LocalProgressStepSizeDefault=.05}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.cancelToken=null;this.progressRatio=0;this.localProgressStepSize=.05;this.localProgressSpecified=!1;this.localStepCount=0;this.stageStartRatio=0;this.stageEndRatio=1;this.ProgressChanged=null;System.Object.ctor.call(this)},Run:function(){this.progressRatio=0;this.localStepCount=0;this.cancelToken=Microsoft.Msagl.Core.AlgorithmBase.threadStaticCancelToken;this.ThrowIfCanceled();this.ProgressSteps(0);this.RunInternal();this.get_IsCanceled()||this.ProgressComplete()},Run$$CancelToken:function(n){this.progressRatio=0;this.localStepCount=0;var t=this.SetCancelToken(n);try{this.ProgressSteps(0);this.RunInternal();this.get_IsCanceled()||this.ProgressComplete()}finally{Microsoft.Msagl.Core.AlgorithmBase.threadStaticCancelToken=t}},SetCancelToken:function(n){this.cancelToken=n;this.ThrowIfCanceled();var t=Microsoft.Msagl.Core.AlgorithmBase.threadStaticCancelToken;return Microsoft.Msagl.Core.AlgorithmBase.threadStaticCancelToken=n,t},Cancel:function(){this.cancelToken!=null&&this.cancelToken.set_Canceled(!0)},IsCanceled$$:"System.Boolean",get_IsCanceled:function(){return this.cancelToken!=null&&this.cancelToken.get_Canceled()},ThrowIfCanceled:function(){this.cancelToken!=null&&this.cancelToken.ThrowIfCanceled()},CancelToken$$:"Microsoft.Msagl.Core.CancelToken",get_CancelToken:function(){return this.cancelToken},add_ProgressChanged:function(n){this.ProgressChanged=$CombineDelegates(this.ProgressChanged,n)},remove_ProgressChanged:function(n){this.ProgressChanged=$RemoveDelegate(this.ProgressChanged,n)},StartListenToLocalProgress:function(n,t){this.localProgressStepSize=t/System.Math.Max$$Int32$$Int32(1,n);this.localProgressSpecified=!0;this.localStepCount=0;this.stageStartRatio=0;this.stageEndRatio=1},StartListenToProgress:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"childAlgorithm");n.add_ProgressChanged($CreateDelegate(this,this.NotifyProgressChanged));this.stageStartRatio=this.progressRatio;this.stageEndRatio=this.progressRatio+t},StopListenToProgress:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"childAlgorithm");n.remove_ProgressChanged($CreateDelegate(this,this.NotifyProgressChanged));this.progressRatio=this.stageEndRatio;this.stageStartRatio=0;this.stageEndRatio=1},RunChildAlgorithm:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"childAlgorithm");try{this.StartListenToProgress(n,t);n.Run()}finally{this.StopListenToProgress(n)}},ProgressComplete:function(){this.ThrowIfCanceled();this.progressRatio!=1&&(this.progressRatio=1,this.NotifyProgressChanged(this,new Microsoft.Msagl.Core.ProgressChangedEventArgs.ctor$$Double(this.progressRatio)))},ProgressStep:function(){this.ProgressSteps(1)},ProgressSteps:function(n){if(this.ThrowIfCanceled(),this.localStepCount+=n,this.localProgressSpecified)this.progressRatio=this.progressRatio+this.localProgressStepSize*n;else this.progressRatio=.85-42.5/(50+this.localStepCount);System.Math.Round$$Double$$Int32(this.progressRatio,6)==1&&(this.progressRatio=1);this.NotifyProgressChanged(this,new Microsoft.Msagl.Core.ProgressChangedEventArgs.ctor$$Double(this.progressRatio))},NotifyProgressChanged:function(n,t){if(this.ProgressChanged!=null){var i=this.stageEndRatio-this.stageStartRatio,r=i*t.get_RatioComplete();this.ProgressChanged(this,new Microsoft.Msagl.Core.ProgressChangedEventArgs.ctor$$Double(this.stageStartRatio+r))}}}};JsTypes.push(Microsoft$Msagl$Core$AlgorithmBase);Microsoft$Msagl$Core$DataStructures$CollectionUtilities={fullname:"Microsoft.Msagl.Core.DataStructures.CollectionUtilities",baseTypeName:"System.Object",staticDefinition:{AddToMap$3:function(n,t,i,r,u,f){var e;(function(){var n={Value:e},t=r.TryGetValue(u,n);return e=n.Value,t})()||r.set_Item$$TKey(u,e=new i);e.Add(f)},RemoveFromMap$3:function(n,t,i,r,u,f){var e=r.get_Item$$TKey(u);e.Remove(f);e.get_Count()==0&&r.Remove(u)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$CollectionUtilities);Microsoft$Msagl$Core$DataStructures$GenericBinaryHeapPriorityQueueWithTimestamp$1={fullname:"Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueueWithTimestamp$1",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueueWithTimestamp$1.InitialHeapCapacity=16},Test:function(){var n=new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.ctor(System.Int32.ctor);for(n.Enqueue(2,2),n.Enqueue(1,1),n.Enqueue(9,9),n.Enqueue(8,8),n.Enqueue(5,5),n.Enqueue(3,3),n.Enqueue(4,4),n.Enqueue(7,7),n.Enqueue(6,6),n.Enqueue(0,0),n.DecreasePriority(4,2.5);n.IsEmpty()==!1;)System.Console.WriteLine$$Int32(n.Dequeue())}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor:function(n){this.T=n;this.A=null;this.timestamp=0;this.cache=null;this.heapSize=0;System.Object.ctor.call(this);this.cache=new System.Collections.Generic.Dictionary$2.ctor(this.T,Microsoft.Msagl.Core.DataStructures.GenericHeapElementWithTimestamp$1.ctor);this.A=new Array(17)},NextTimestamp$$:"System.UInt64",get_NextTimestamp:function(){return++this.timestamp},Count$$:"System.Int32",get_Count:function(){return this.heapSize},SwapWithParent:function(n){var t=this.A[n>>1];this.PutAtI(n>>1,this.A[n]);this.PutAtI(n,t)},Enqueue:function(n,t){var r,i,u;for(this.heapSize==this.A.length-1&&(r=new Array(this.A.length*2),System.Array.Copy(this.A,1,r,1,this.heapSize),this.A=r),this.heapSize++,i=this.heapSize,this.A[i]=function(t){return this.cache.set_Item$$TKey(n,t),t}.call(this,u=new Microsoft.Msagl.Core.DataStructures.GenericHeapElementWithTimestamp$1.ctor(this.T,i,t,n,this.get_NextTimestamp()));i>1&&this.A[i>>1].ComparePriority(this.A[i])>0;)this.SwapWithParent(i),i>>=1;System.Diagnostics.Debug.Assert$$Boolean(this.A[i]==u);this.A[i]=u},PutAtI:function(n,t){this.A[n]=t;t.indexToA=n},Dequeue:function(){if(this.heapSize==0)throw $CreateException(new System.InvalidOperationException.ctor,new Error);var n=this.A[1].v;return this.MoveQueueOneStepForward(n),n},MoveQueueOneStepForward:function(n){var i,t,r,u;for(this.cache.Remove(n),this.PutAtI(1,this.A[this.heapSize]),i=1;;){if(t=i,r=i<<1,r<=this.heapSize&&this.A[r].ComparePriority(this.A[i])<0&&(t=r),u=r+1,u<=this.heapSize&&this.A[u].ComparePriority(this.A[t])<0&&(t=u),t!=i)this.SwapWithParent(t);else break;i=t}this.heapSize--},DecreasePriority:function(n,t){var r,i;if(function(){var t={Value:r},i=this.cache.TryGetValue(n,t);return r=t.Value,i}.call(this))for(r.priority=t,i=r.indexToA;i>1;){if(this.A[i].ComparePriority(this.A[i>>1])<0)this.SwapWithParent(i);else break;i>>=1}},GetEnumerator:function(){for(var t=[],n=1;n<=this.heapSize;n++)t.push(this.A[n].v);return t.GetEnumerator()}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$GenericBinaryHeapPriorityQueueWithTimestamp$1);Microsoft$Msagl$Core$DataStructures$GenericHeapElementWithTimestamp$1={fullname:"Microsoft.Msagl.Core.DataStructures.GenericHeapElementWithTimestamp$1",baseTypeName:"Microsoft.Msagl.Core.DataStructures.GenericHeapElement$1",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this.T=n;this._Timestamp=0;Microsoft.Msagl.Core.DataStructures.GenericHeapElement$1.ctor.call(this,this.T,t,i,r);this.set_Timestamp(u)},Timestamp$$:"System.UInt64",get_Timestamp:function(){return this._Timestamp},set_Timestamp:function(n){this._Timestamp=n},ComparePriority:function(n){var t=this.priority.CompareTo$$Double(n.priority);return t!=0?t:n.get_Timestamp().CompareTo$$UInt64(this.get_Timestamp())}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$GenericHeapElementWithTimestamp$1);Microsoft$Msagl$Core$DataStructures$Size={fullname:"Microsoft.Msagl.Core.DataStructures.Size",baseTypeName:"System.ValueType",staticDefinition:{op_Division:function(n,t){return new Microsoft.Msagl.Core.DataStructures.Size.ctor$$Double$$Double(n.get_Width()/t,n.get_Height()/t)},op_Multiply:function(n,t){return new Microsoft.Msagl.Core.DataStructures.Size.ctor$$Double$$Double(n.get_Width()*t,n.get_Height()*t)}},assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Double$$Double:function(n,t){this.width=0;this.height=0;System.ValueType.ctor.call(this);this.width=n;this.height=t},Width$$:"System.Double",get_Width:function(){return this.width},set_Width:function(n){this.width=n},Height$$:"System.Double",get_Height:function(){return this.height},set_Height:function(n){this.height=n},Pad:function(n){this.width+=2*n;this.height+=2*n},ctor:function(){this.width=0;this.height=0;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$Size);Microsoft$Msagl$Core$DataStructures$SymmetricTuple$1={fullname:"Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.T=n;this._A=null;this._B=null;System.Object.ctor.call(this);this.set_A(t);this.set_B(i)},Equals$$SymmetricTuple$1:function(n){return this.get_A().Equals$$Object(n.get_A())&&this.get_B().Equals$$Object(n.get_B())||this.get_A().Equals$$Object(n.get_B())&&this.get_B().Equals$$Object(n.get_A())},GetHashCode:function(){return this.get_A().GetHashCode()^this.get_B().GetHashCode()},A$$:"`0",get_A:function(){return this._A},set_A:function(n){this._A=n},B$$:"`0",get_B:function(){return this._B},set_B:function(n){this._B=n},Equals$$Object:function(n){return System.Object.ReferenceEquals(null,n)?!1:System.Object.ReferenceEquals(this,n)?!0:n.GetType()!=this.GetType()?!1:this.Equals$$SymmetricTuple$1(Cast(n,Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor))},toString:function(){return System.String.Format$$String$$Object$$Object("({0},{1})",this.get_A(),this.get_B())}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$SymmetricTuple$1);Microsoft$Msagl$Core$Geometry$ApproximateComparer={fullname:"Microsoft.Msagl.Core.Geometry.ApproximateComparer",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Geometry.ApproximateComparer.squareOfDistanceEpsilon=System.Math.Pow(10,-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_DistanceEpsilonPrecision()*2);Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon=System.Math.Pow(10,-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_DistanceEpsilonPrecision());Microsoft.Msagl.Core.Geometry.ApproximateComparer.distXEps=.0001;Microsoft.Msagl.Core.Geometry.ApproximateComparer.tolerance=1e-8;Microsoft.Msagl.Core.Geometry.ApproximateComparer.userDefinedTolerance=Microsoft.Msagl.Core.Geometry.ApproximateComparer.tolerance},Close$$Point$$Point$$Double:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t).get_Length()<=i},Close$$Point$$Point:function(n,t){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point$$Double(n,t,Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)},Close$$Double$$Double:function(n,t){return System.Math.Abs$$Double(n-t)<=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon},Close$$Rectangle$$Rectangle$$Double:function(n,t,i){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point$$Double(n.get_LeftBottom(),t.get_LeftBottom(),i)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point$$Double(n.get_RightTop(),t.get_RightTop(),i)},Close$$Rectangle$$Rectangle:function(n,t){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Rectangle$$Rectangle$$Double(n,t,Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)},Compare:function(n,t){var i=n-t;return i<=-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?-1:i>=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?1:0},Greater:function(n,t){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Compare(n,t)>0},GreaterOrEqual:function(n,t){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Compare(n,t)>=0},Less:function(n,t){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Compare(n,t)<0},LessOrEqual:function(n,t){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Compare(n,t)<=0},CloseIntersections:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t);return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(i,i)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()*Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()},Sign:function(n){return n>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?1:n<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?-1:0},SquareOfDistanceEpsilon$$:"System.Double",get_SquareOfDistanceEpsilon:function(){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.squareOfDistanceEpsilon},DistanceEpsilonPrecision$$:"System.Int32",get_DistanceEpsilonPrecision:function(){return 6},IntersectionEpsilon$$:"System.Double",get_IntersectionEpsilon:function(){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.distXEps},set_IntersectionEpsilon:function(n){Microsoft.Msagl.Core.Geometry.ApproximateComparer.distXEps=n},Tolerance$$:"System.Double",get_Tolerance:function(){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.tolerance},set_Tolerance:function(n){Microsoft.Msagl.Core.Geometry.ApproximateComparer.tolerance=n},UserDefinedTolerance$$:"System.Double",get_UserDefinedTolerance:function(){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.userDefinedTolerance},set_UserDefinedTolerance:function(n){Microsoft.Msagl.Core.Geometry.ApproximateComparer.userDefinedTolerance=n},NumberOfDigitsToRound$$:"System.Int32",get_NumberOfDigitsToRound:function(){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_DistanceEpsilonPrecision()},Round$$Point:function(n){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Double(n.get_X()),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Double(n.get_Y()))},Round$$Point$$Int32:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Round$$Double$$Int32(n.get_X(),t),System.Math.Round$$Double$$Int32(n.get_Y(),t))},Round$$Double:function(n){return System.Math.Round$$Double$$Int32(n,Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_NumberOfDigitsToRound())}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$ApproximateComparer);Microsoft$Msagl$Core$Geometry$ConvexHull={fullname:"Microsoft.Msagl.Core.Geometry.ConvexHull",baseTypeName:"System.Object",staticDefinition:{CalculateConvexHull:function(n){var t=new Microsoft.Msagl.Core.Geometry.ConvexHull.ctor(n);return t.Calculate()},CreateConvexHullAsClosedPolyline:function(n){return function(){var t=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(Microsoft.Msagl.Core.Geometry.ConvexHull.CalculateConvexHull(n));return t.set_Closed(!0),t}()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.hullPoints=null;this.pivot=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.stack=null;this.comparer=null;System.Object.ctor.call(this);this.SetPivotAndAllocateHullPointsArray(n)},SetPivotAndAllocateHullPointsArray:function(n){var u,i;this.pivot=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,1.79769313486232E+308);for(var r=-1,t=0,f=n.GetEnumerator();f.MoveNext();)i=f.get_Current(),i.get_Y()<this.pivot.get_Y()?(this.pivot=i,r=t):i.get_Y()==this.pivot.get_Y()&&i.get_X()>this.pivot.get_X()&&(this.pivot=i,r=t),t++;if(t>=1)for(this.hullPoints=new Array(t-1),t=0,u=n.GetEnumerator();u.MoveNext();)i=u.get_Current(),t!=r?this.hullPoints[t++]=new Microsoft.Msagl.Core.Geometry.HullPoint.ctor(i):r=-1},StackTopPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_StackTopPoint:function(){return this.stack.get_Point()},StackSecondPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_StackSecondPoint:function(){return this.stack.get_Next().get_Point()},Calculate:function(){return this.pivot.get_Y()==1.79769313486232E+308?new Array(0):this.hullPoints.length==0?[this.pivot]:(this.SortAllPointsWithoutPivot(),this.Scan(),this.EnumerateStack())},EnumerateStack:function(){for(var t=[],n=this.stack;n!=null;)t.push(n.get_Point()),n=n.get_Next();return t},Scan:function(){for(var n=0;this.hullPoints[n].get_Deleted();)n++;for(this.stack=new Microsoft.Msagl.Core.Geometry.HullStack.ctor(this.pivot),this.Push(n++),n<this.hullPoints.length&&(this.hullPoints[n].get_Deleted()?n++:this.Push(n++));n<this.hullPoints.length;)this.hullPoints[n].get_Deleted()?n++:this.LeftTurn(n)?this.Push(n++):this.Pop();while(this.StackHasMoreThanTwoPoints()&&!this.LeftTurnToPivot())this.Pop()},LeftTurnToPivot:function(){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.get_StackSecondPoint(),this.get_StackTopPoint(),this.pivot)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise},StackHasMoreThanTwoPoints:function(){return this.stack.get_Next()!=null&&this.stack.get_Next().get_Next()!=null},Pop:function(){this.stack=this.stack.get_Next()},LeftTurn:function(n){if(this.stack.get_Next()==null)return!0;var t=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithIntersectionEpsilon(this.get_StackSecondPoint(),this.get_StackTopPoint(),this.hullPoints[n].get_Point());return t==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise?!0:t==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise?!1:this.BackSwitchOverPivot(this.hullPoints[n].get_Point())},BackSwitchOverPivot:function(n){return this.stack.get_Next().get_Next()!=null?!1:(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.get_StackSecondPoint(),this.pivot)),this.get_StackTopPoint().get_X()>this.pivot.get_X()+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&n.get_X()<this.pivot.get_X()-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)},Push:function(n){var t=function(){var t=new Microsoft.Msagl.Core.Geometry.HullStack.ctor(this.hullPoints[n].get_Point());return t.set_Next(this.stack),t}.call(this);this.stack=t},SortAllPointsWithoutPivot:function(){this.comparer=new Microsoft.Msagl.Core.Geometry.HullPointComparer.ctor(this.pivot);System.Array.Sort$1$$T$Array$$IComparer$1(Microsoft.Msagl.Core.Geometry.HullPoint.ctor,this.hullPoints,this.comparer)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$ConvexHull);Microsoft$Msagl$Core$Geometry$HullPoint={fullname:"Microsoft.Msagl.Core.Geometry.HullPoint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.point=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.deleted=!1;System.Object.ctor.call(this);this.set_Point(n)},Point$$:"Microsoft.Msagl.Core.Geometry.Point",get_Point:function(){return this.point},set_Point:function(n){this.point=n},Deleted$$:"System.Boolean",get_Deleted:function(){return this.deleted},set_Deleted:function(n){this.deleted=n},toString:function(){return this.point+(this.get_Deleted()?"X":"")}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$HullPoint);Microsoft$Msagl$Core$Geometry$HullPointComparer={fullname:"Microsoft.Msagl.Core.Geometry.HullPointComparer",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.pivot=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.pivot=n},Compare:function(n,t){var i,r;if(n==t)return 0;if(n==null)return-1;if(t==null)return 1;switch(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithIntersectionEpsilon(this.pivot,n.get_Point(),t.get_Point())){case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise:return-1;case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise:return 1;case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear:if(i=n.get_Point().get_X()-this.pivot.get_X(),r=t.get_Point().get_X()-this.pivot.get_X(),i>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&r<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return-1;if(i<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&r>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return 1;var f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Point(),this.pivot),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),this.pivot),u=f.get_L1()-e.get_L1();return u<0?(n.set_Deleted(!0),-1):u>0?(t.set_Deleted(!0),1):(n.GetHashCode()<t.GetHashCode()?n.set_Deleted(!0):t.set_Deleted(!0),0)}throw $CreateException(new System.InvalidOperationException.ctor,new Error);}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$HullPointComparer);Microsoft$Msagl$Core$Geometry$HullStack={fullname:"Microsoft.Msagl.Core.Geometry.HullStack",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.hullPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.next=null;System.Object.ctor.call(this);this.set_Point(n)},Point$$:"Microsoft.Msagl.Core.Geometry.Point",get_Point:function(){return this.hullPoint},set_Point:function(n){this.hullPoint=n},Next$$:"Microsoft.Msagl.Core.Geometry.HullStack",get_Next:function(){return this.next},set_Next:function(n){this.next=n},toString:function(){return this.hullPoint.toString()}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$HullStack);Microsoft$Msagl$Core$Geometry$Curves$RoundedRect={fullname:"Microsoft.Msagl.Core.Geometry.Curves.RoundedRect",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Geometry.Curves.ICurve"],Kind:"Class",definition:{ctor:function(){this.curve=null;this.dirtyBounds=!0;this.cachedBounds=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._RadiusX=0;this._RadiusY=0;System.Object.ctor.call(this)},Curve$$:"Microsoft.Msagl.Core.Geometry.Curves.Curve",get_Curve:function(){return this.curve},RadiusX$$:"System.Double",get_RadiusX:function(){return this._RadiusX},set_RadiusX:function(n){this._RadiusX=n},RadiusY$$:"System.Double",get_RadiusY:function(){return this._RadiusY},set_RadiusY:function(n){this._RadiusY=n},ctor$$Rectangle$$Double$$Double:function(n,t,i){this.curve=null;this.dirtyBounds=!0;this.cachedBounds=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._RadiusX=0;this._RadiusY=0;System.Object.ctor.call(this);this.set_RadiusX(t);this.set_RadiusY(i);this.curve=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$Int32(8);Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRectangleWithRoundedCorners$$Curve$$Double$$Double$$Double$$Double$$Point(this.curve,n.get_Width(),n.get_Height(),t,i,n.get_Center())},FitTo:function(n){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Rectangle$$Rectangle$$Double(n,this.get_BoundingBox(),Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_UserDefinedTolerance())?this.Clone():new Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor$$Rectangle$$Double$$Double(n,this.get_RadiusX(),this.get_RadiusY())},Item$$:"Microsoft.Msagl.Core.Geometry.Point",get_Item$$Double:function(n){return this.curve.get_Item$$Double(n)},Derivative:function(n){return this.curve.Derivative(n)},SecondDerivative:function(n){return this.curve.SecondDerivative(n)},ThirdDerivative:function(n){return this.curve.ThirdDerivative(n)},ParallelogramNodeOverICurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve",get_ParallelogramNodeOverICurve:function(){return this.curve.get_ParallelogramNodeOverICurve()},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){return this.dirtyBounds&&(this.cachedBounds=this.curve.get_BoundingBox(),this.dirtyBounds=!1),this.cachedBounds},ParStart$$:"System.Double",get_ParStart:function(){return this.curve.get_ParStart()},ParEnd$$:"System.Double",get_ParEnd:function(){return this.curve.get_ParEnd()},Trim:function(n,t){return this.curve.Trim(n,t)},TrimWithWrap:function(n,t){return this.curve.TrimWithWrap(n,t)},Translate:function(n){this.curve.Translate(n);this.dirtyBounds=!0},ScaleFromOrigin:function(n,t){var i=this.curve.get_BoundingBox(),r=Microsoft.Msagl.Core.Geometry.Point.Scale(n,t,i.get_LeftTop()),u=Microsoft.Msagl.Core.Geometry.Point.Scale(n,t,i.get_RightBottom());return new Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor$$Rectangle$$Double$$Double(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(r,u),this.get_RadiusX(),this.get_RadiusY())},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.curve.get_Start()},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.curve.get_End()},Reverse:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},OffsetCurve:function(n,t){return this.curve.OffsetCurve(n,t)},LengthPartial:function(n,t){return this.curve.LengthPartial(n,t)},Length$$:"System.Double",get_Length:function(){return this.curve.get_Length()},GetParameterAtLength:function(n){return this.curve.GetParameterAtLength(n)},Transform:function(n){var t=this.curve.get_BoundingBox(),i=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,t.get_LeftTop()),r=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,t.get_RightBottom()),u=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(i,r);return new Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor$$Rectangle$$Double$$Double(u,this.get_RadiusX(),this.get_RadiusY())},ClosestParameterWithinBounds:function(n,t,i){return this.get_Curve().ClosestParameterWithinBounds(n,t,i)},ClosestParameter:function(n){return this.curve.ClosestParameter(n)},Clone:function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor;return n.set_RadiusX(this.get_RadiusX()),n.set_RadiusY(this.get_RadiusY()),n.curve=Cast(this.curve.Clone(),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),n},LeftDerivative:function(n){return this.curve.LeftDerivative(n)},RightDerivative:function(n){return this.curve.RightDerivative(n)},Curvature:function(n){return this.curve.Curvature(n)},CurvatureDerivative:function(n){return this.curve.CurvatureDerivative(n)},CurvatureSecondDerivative:function(n){return this.curve.CurvatureSecondDerivative(n)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$RoundedRect);Microsoft$Msagl$Core$Geometry$ColumnPacking$1={fullname:"Microsoft.Msagl.Core.Geometry.ColumnPacking$1",baseTypeName:"Microsoft.Msagl.Core.Geometry.Packing",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.TData=n;this.orderedRectangles=null;this.maxHeight=0;Microsoft.Msagl.Core.Geometry.Packing.ctor.call(this);this.orderedRectangles=t;this.maxHeight=i},RunInternal:function(){var r,n;this.set_PackedHeight(function(n){return this.set_PackedWidth(n),n}.call(this,0));for(var i=0,t=0,u=this.orderedRectangles.GetEnumerator();u.MoveNext();)r=u.get_Current(),n=r.get_Rectangle(),t+n.get_Height()>this.maxHeight&&(i=this.get_PackedWidth(),t=0),n=function(n){return r.set_Rectangle(n),n}.call(this,new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Point(i,t,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_Width(),n.get_Height()))),this.set_PackedWidth(System.Math.Max$$Double$$Double(this.get_PackedWidth(),i+n.get_Width())),t+=n.get_Height(),this.set_PackedHeight(System.Math.Max$$Double$$Double(this.get_PackedHeight(),t))}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$ColumnPacking$1);Microsoft$Msagl$Core$Geometry$OptimalColumnPacking$1={fullname:"Microsoft.Msagl.Core.Geometry.OptimalColumnPacking$1",baseTypeName:"Microsoft.Msagl.Core.Geometry.OptimalPacking$1",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.TData=n;Microsoft.Msagl.Core.Geometry.OptimalPacking$1.ctor.call(this,this.TData,System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Geometry.RectangleToPack$1.ctor,t),i);Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"rectangles");System.Diagnostics.Debug.Assert$$Boolean$$String(System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.RectangleToPack$1.ctor,t),"Expected more than one rectangle in rectangles");System.Diagnostics.Debug.Assert$$Boolean$$String(i>0,"aspect ratio should be greater than 0");this.createPacking=$CreateAnonymousDelegate(this,function(n,t){return new Microsoft.Msagl.Core.Geometry.ColumnPacking$1.ctor(this.TData,n,t)})},RunInternal:function(){for(var t=1.79769313486232E+308,i=0,r=0,u=this.rectangles.GetEnumerator(),f,n;u.MoveNext();)f=u.get_Current(),n=f.get_Rectangle(),System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_Width()>0,"Width must be greater than 0"),System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_Height()>0,"Height must be greater than 0"),r+=n.get_Height(),t=System.Math.Min$$Double$$Double(t,n.get_Height()),i=System.Math.Max$$Double$$Double(i,n.get_Height());this.Pack$$Double$$Double$$Double(i,r,t)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OptimalColumnPacking$1);Microsoft$Msagl$Core$Geometry$OptimalPacking$1={fullname:"Microsoft.Msagl.Core.Geometry.OptimalPacking$1",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Geometry.OptimalPacking$1.MaxSteps=1e3},GoldenSectionSearch:function(n,t,i,r,u){var e,o;if(System.Diagnostics.Debug.Assert$$Boolean$$String((System.Math.Abs$$Double(r-t)-u)/u<=1000.1,"precision would violate the limit imposed by MaxSteps"),System.Math.Abs$$Double(t-r)<u)return n(t)<n(r)?t:r;System.Diagnostics.Debug.Assert$$Boolean$$String(t<i&&i<r||r<i&&i<t,"x2 not bounded by x1 and x3");var f=Microsoft.Msagl.Core.Geometry.OptimalPacking$1.GetGoldenSectionStep(i,r),s=n(i),h=n(f),c=function(){return Microsoft.Msagl.Core.Geometry.OptimalPacking$1.GoldenSectionSearch(n,f,i,t,u)},l=function(){return Microsoft.Msagl.Core.Geometry.OptimalPacking$1.GoldenSectionSearch(n,i,f,r,u)};return h<s?(System.Diagnostics.Debug.Assert$$Boolean$$String(System.Math.Abs$$Double(i-r)<System.Math.Abs$$Double(t-r),"Search region not narrowing!"),l()):h>s?(System.Diagnostics.Debug.Assert$$Boolean$$String(System.Math.Abs$$Double(f-t)<System.Math.Abs$$Double(t-r),"Search region not narrowing!"),c()):(e=l(),o=c(),n(o)<n(e)?o:e)},GetGoldenSectionStep:function(n,t){return n<t?n+Microsoft.Msagl.Core.Geometry.PackingConstants.GoldenRatioRemainder*(t-n):n-Microsoft.Msagl.Core.Geometry.PackingConstants.GoldenRatioRemainder*(n-t)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.TData=n;this.desiredAspectRatio=1.2;this.bestPackingCost=0;this.bestPacking=null;this.rectangles=null;this.cachedCosts=new System.Collections.Generic.Dictionary$2.ctor(System.Double.ctor,System.Double.ctor);this.createPacking=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.rectangles=t;this.desiredAspectRatio=i},PackedWidth$$:"System.Double",get_PackedWidth:function(){return this.bestPacking!=null?this.bestPacking.get_PackedWidth():0},PackedHeight$$:"System.Double",get_PackedHeight:function(){return this.bestPacking!=null?this.bestPacking.get_PackedHeight():0},Pack$$Double$$Double$$Double:function(n,t,i){var u=Microsoft.Msagl.Core.Geometry.OptimalPacking$1.GetGoldenSectionStep(n,t),r=System.Math.Max$$Double$$Double(i/10,(t-n)/1e3);t+=r;this.bestPackingCost=1.79769313486232E+308;this.rectangles.get_Count()==1?this.Pack$$Double(n):this.rectangles.get_Count()==2?(this.Pack$$Double(n),this.Pack$$Double(t)):this.rectangles.get_Count()>2&&Microsoft.Msagl.Core.Geometry.OptimalPacking$1.GoldenSectionSearch($CreateDelegate(this,this.Pack$$Double),n,u,t,r);this.bestPacking.Run()},Pack$$Double:function(n){var t,i;return function(){var i={Value:t},r=this.cachedCosts.TryGetValue(n,i);return t=i.Value,r}.call(this)||(i=this.createPacking(this.rectangles,n),i.Run(),this.cachedCosts.set_Item$$TKey(n,t=System.Math.Abs$$Double(i.get_PackedAspectRatio()-this.desiredAspectRatio)),t<this.bestPackingCost&&(this.bestPackingCost=t,this.bestPacking=i)),t}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OptimalPacking$1);Microsoft$Msagl$Core$Geometry$OptimalRectanglePacking$1={fullname:"Microsoft.Msagl.Core.Geometry.OptimalRectanglePacking$1",baseTypeName:"Microsoft.Msagl.Core.Geometry.OptimalPacking$1",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.TData=n;Microsoft.Msagl.Core.Geometry.OptimalPacking$1.ctor.call(this,this.TData,System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Geometry.RectangleToPack$1.ctor,Microsoft.Msagl.Core.Geometry.RectanglePacking$1.SortRectangles(t)),i);Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"rectangles");System.Diagnostics.Debug.Assert$$Boolean$$String(System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.RectangleToPack$1.ctor,t),"Expected more than one rectangle in rectangles");System.Diagnostics.Debug.Assert$$Boolean$$String(i>0,"aspect ratio should be greater than 0");this.createPacking=$CreateAnonymousDelegate(this,function(n,t){return new Microsoft.Msagl.Core.Geometry.RectanglePacking$1.ctor(this.TData,n,t,!0)})},RunInternal:function(){for(var i=1.79769313486232E+308,r=0,u=0,f=this.rectangles.GetEnumerator(),n,t;f.MoveNext();)n=f.get_Current(),System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_Rectangle().get_Width()>0,"Width must be greater than 0"),System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_Rectangle().get_Height()>0,"Height must be greater than 0"),t=n.get_Rectangle().get_Width(),u+=t,i=System.Math.Min$$Double$$Double(i,t),r=System.Math.Max$$Double$$Double(r,t);this.Pack$$Double$$Double$$Double(r,u,i)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OptimalRectanglePacking$1);Microsoft$Msagl$Core$Geometry$BorderInfo={fullname:"Microsoft.Msagl.Core.Geometry.BorderInfo",baseTypeName:"System.ValueType",staticDefinition:{DefaultFreeWeight$$:"System.Double",get_DefaultFreeWeight:function(){return 1e-6},DefaultFixedWeight$$:"System.Double",get_DefaultFixedWeight:function(){return 1e8},NoFixedPosition$$:"System.Double",get_NoFixedPosition:function(){return NaN},op_Equality:function(n,t){return n.Equals$$Object(t)},op_Inequality:function(n,t){return!Microsoft.Msagl.Core.Geometry.BorderInfo.op_Equality(n,t)},op_LessThan:function(n,t){return n.get_FixedPosition()<t.get_FixedPosition()?!0:n.get_FixedPosition()>t.get_FixedPosition()?!1:n.get_Weight()<t.get_Weight()?!0:n.get_Weight()>t.get_Weight()?!1:n.get_InnerMargin()<t.get_InnerMargin()},op_GreaterThan:function(n,t){return Microsoft.Msagl.Core.Geometry.BorderInfo.op_LessThan(t,n)}},assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Double:function(n){this.borderWeight=0;this._InnerMargin=0;this._FixedPosition=0;Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double.call(this,n,Microsoft.Msagl.Core.Geometry.BorderInfo.get_NoFixedPosition(),Microsoft.Msagl.Core.Geometry.BorderInfo.get_DefaultFreeWeight())},InnerMargin$$:"System.Double",get_InnerMargin:function(){return this._InnerMargin},set_InnerMargin:function(n){this._InnerMargin=n},FixedPosition$$:"System.Double",get_FixedPosition:function(){return this._FixedPosition},set_FixedPosition:function(n){this._FixedPosition=n},Weight$$:"System.Double",get_Weight:function(){return this.borderWeight},set_Weight:function(n){if(n<=0)throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String("value","Weight must be greater than zero"),new Error);this.borderWeight=n},IsFixedPosition$$:"System.Boolean",get_IsFixedPosition:function(){return!System.Double.IsNaN(this.get_FixedPosition())&&this.get_Weight()>0},SetFixed:function(n,t){this.set_FixedPosition(n);this.set_Weight(t)},SetUnfixed:function(){this.set_FixedPosition(Microsoft.Msagl.Core.Geometry.BorderInfo.get_NoFixedPosition());this.set_Weight(Microsoft.Msagl.Core.Geometry.BorderInfo.get_DefaultFreeWeight())},ctor$$Double$$Double$$Double:function(n,t,i){this.borderWeight=0;this._InnerMargin=0;this._FixedPosition=0;Microsoft.Msagl.Core.Geometry.BorderInfo.ctor.call(this);this.set_InnerMargin(n);this.set_FixedPosition(t);this.set_Weight(i)},EnsureWeight:function(){System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_Weight()>0,"BorderInfo.Weight must be > 0.0; use DefaultFreeWeight or DefaultFixedWeight or a parameterized ctor");0==this.get_Weight()&&(this.set_Weight(Microsoft.Msagl.Core.Geometry.BorderInfo.get_DefaultFreeWeight()),0==this.get_FixedPosition()&&this.set_FixedPosition(Microsoft.Msagl.Core.Geometry.BorderInfo.get_NoFixedPosition()))},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"m {0:F5} p {1:F5} w {2:F5}",[this.get_InnerMargin(),this.get_FixedPosition(),this.get_Weight()])},GetHashCode:function(){return this.get_InnerMargin().GetHashCode()^this.get_FixedPosition().GetHashCode()^this.get_Weight().GetHashCode()},Equals$$Object:function(n){if(!Is(n,Microsoft.Msagl.Core.Geometry.BorderInfo.ctor))return!1;var t=Cast(n,Microsoft.Msagl.Core.Geometry.BorderInfo.ctor);return t.get_FixedPosition()==this.get_FixedPosition()&&t.get_Weight()==this.get_Weight()&&t.get_InnerMargin()==this.get_InnerMargin()},ctor:function(){this.borderWeight=0;this._InnerMargin=0;this._FixedPosition=0;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$BorderInfo);Microsoft$Msagl$Core$Geometry$PointNodesList={fullname:"Microsoft.Msagl.Core.Geometry.PointNodesList",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerator$1","System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor$$Site:function(n){this.current=null;this.head=null;System.Object.ctor.call(this);this.head=n},Head$$:"Microsoft.Msagl.Core.Geometry.Site",get_Head:function(){return this.head},ctor:function(){this.current=null;this.head=null;System.Object.ctor.call(this)},Current$$:"Microsoft.Msagl.Core.Geometry.Point",get_Current:function(){return this.current.get_Point()},Dispose:function(){System.GC.SuppressFinalize(this)},MoveNext:function(){return this.current!=null?this.current.get_Next()!=null?(this.current=this.current.get_Next(),!0):!1:(this.current=this.get_Head(),!0)},Reset:function(){this.current=null},GetEnumerator:function(){return this}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$PointNodesList);Microsoft$Msagl$Core$Geometry$PointPair={fullname:"Microsoft.Msagl.Core.Geometry.PointPair",baseTypeName:"System.Object",staticDefinition:{IsLess:function(n,t){return n.get_Y()<t.get_Y()?!0:n.get_Y()>t.get_Y()?!1:n.get_X()<t.get_X()},op_Equality:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.first,t.first)&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.second,t.second)},op_Inequality:function(n,t){return!Microsoft.Msagl.Core.Geometry.PointPair.op_Equality(n,t)}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.IComparable$1"],Kind:"Class",definition:{ctor:function(n,t){this.first=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.second=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._hashKey=null;System.Object.ctor.call(this);Microsoft.Msagl.Core.Geometry.PointPair.IsLess(n,t)?(this.first=n,this.second=t):(this.first=t,this.second=n);this._hashKey=this.first.get_X()+","+this.first.get_Y()+";"+this.second.get_X()+","+this.second.get_Y()},First$$:"Microsoft.Msagl.Core.Geometry.Point",get_First:function(){return this.first},Second$$:"Microsoft.Msagl.Core.Geometry.Point",get_Second:function(){return this.second},Length$$:"System.Double",get_Length:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.first,this.second).get_Length()},CompareTo:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"other");var t=this.first.CompareTo(n.first);return t!=0?t:this.second.CompareTo(n.second)},GetHashCode:function(){var n=this.first.GetHashCode()|0;return(n<<5|n>>27)+this.second.GetHashCode()|0},Equals$$Object:function(n){var t=As(n,Microsoft.Msagl.Core.Geometry.PointPair.ctor);return System.Object.ReferenceEquals(t,null)?!1:Microsoft.Msagl.Core.Geometry.PointPair.op_Equality(t,this)},toString:function(){return this.first+" "+this.second}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$PointPair);Microsoft$Msagl$Core$Geometry$Packing={fullname:"Microsoft.Msagl.Core.Geometry.Packing",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._PackedWidth=0;this._PackedHeight=0;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this)},PackedWidth$$:"System.Double",get_PackedWidth:function(){return this._PackedWidth},set_PackedWidth:function(n){this._PackedWidth=n},PackedHeight$$:"System.Double",get_PackedHeight:function(){return this._PackedHeight},set_PackedHeight:function(n){this._PackedHeight=n},PackedAspectRatio$$:"System.Double",get_PackedAspectRatio:function(){return this.get_PackedWidth()/this.get_PackedHeight()}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Packing);Microsoft$Msagl$Core$Geometry$PackingConstants={fullname:"Microsoft.Msagl.Core.Geometry.PackingConstants",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Geometry.PackingConstants.GoldenRatio=(1+System.Math.Sqrt(5))/2;Microsoft.Msagl.Core.Geometry.PackingConstants.GoldenRatioRemainder=2-Microsoft.Msagl.Core.Geometry.PackingConstants.GoldenRatio}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$PackingConstants);Microsoft$Msagl$Core$Geometry$RectangleToPack$1={fullname:"Microsoft.Msagl.Core.Geometry.RectangleToPack$1",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.TData=n;this._Rectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._Data=null;System.Object.ctor.call(this);this.set_Rectangle(t);this.set_Data(i)},Rectangle$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_Rectangle:function(){return this._Rectangle},set_Rectangle:function(n){this._Rectangle=n},Data$$:"`0",get_Data:function(){return this._Data},set_Data:function(n){this._Data=n}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$RectangleToPack$1);Microsoft$Msagl$Core$Geometry$RectanglePacking$1={fullname:"Microsoft.Msagl.Core.Geometry.RectanglePacking$1",baseTypeName:"Microsoft.Msagl.Core.Geometry.Packing",staticDefinition:{cctor:function(){},SortRectangles:function(n){return System.Linq.Enumerable.ThenBy$2$$IOrderedEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.RectangleToPack$1.ctor,System.Double.ctor,System.Linq.Enumerable.OrderByDescending$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.RectangleToPack$1.ctor,System.Double.ctor,n,function(n){return n.get_Rectangle().get_Height()}),function(n){return n.get_Rectangle().get_Width()})}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.TData=n;this.rectanglesByDescendingHeight=null;this.wrapWidth=0;Microsoft.Msagl.Core.Geometry.Packing.ctor.call(this);this.rectanglesByDescendingHeight=r?t:Microsoft.Msagl.Core.Geometry.RectanglePacking$1.SortRectangles(t);this.wrapWidth=i},RunInternal:function(){this.Pack(this.rectanglesByDescendingHeight.GetEnumerator())},Pack:function(n){this.set_PackedHeight(function(n){return this.set_PackedWidth(n),n}.call(this,0));for(var r=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Geometry.RectangleToPack$1.ctor),u=!1,f=0,e=0,o=0;u||n.MoveNext();){var s=n.get_Current(),i=r.get_Count()>0?r.Peek():null,t=s.get_Rectangle();i==null||i.get_Rectangle().get_Right()+t.get_Width()<=this.wrapWidth&&f+t.get_Height()<=i.get_Rectangle().get_Top()?(t=function(n){return s.set_Rectangle(n),n}.call(this,new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Point(i==null?0:i.get_Rectangle().get_Right(),f,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_Width(),t.get_Height()))),e=System.Math.Max$$Double$$Double(e,t.get_Right()),o=System.Math.Max$$Double$$Double(o,t.get_Top()),r.Push(s),u=!1):(f=i.get_Rectangle().get_Top(),r.Pop(),u=!0)}this.set_PackedWidth(e);this.set_PackedHeight(o)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$RectanglePacking$1);Microsoft$Msagl$Core$Geometry$IntervalNode$1={fullname:"Microsoft.Msagl.Core.Geometry.IntervalNode$1",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Geometry.IntervalNode$1.GroupSplitThreshold=2},VisitTreeStatic:function(n,t,i){return n.get_Interval().Intersects(i)?t(n.get_UserData())==Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue?n.get_Left()!=null?Microsoft.Msagl.Core.Geometry.IntervalNode$1.VisitTreeStatic(n.get_Left(),t,i)==Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue&&Microsoft.Msagl.Core.Geometry.IntervalNode$1.VisitTreeStatic(n.get_Right(),t,i)==Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue?Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue},CreateIntervalNodeOnEnumeration:function(n){if(n==null)return null;var t=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor,n);return Microsoft.Msagl.Core.Geometry.IntervalNode$1.CreateIntervalNodeOnListOfNodes(t)},CreateIntervalNodeOnData:function(n,t){if(n==null||t==null)return null;var i=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(this.TData,Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor,n,function(n){return new Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor$$TData$$Interval(this.TData,n,t(n))}));return Microsoft.Msagl.Core.Geometry.IntervalNode$1.CreateIntervalNodeOnListOfNodes(i)},CreateIntervalNodeOnListOfNodes:function(n){var i,r;if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"nodes"),n.get_Count()==0)return null;if(n.get_Count()==1)return n.get_Item$$Int32(0);var o=n.get_Item$$Int32(0).get_Interval(),t=1,u=function(){var i={Value:o},r={Value:t},u=Microsoft.Msagl.Core.Geometry.IntervalNode$1.ChooseSeeds(n,i,r);return o=i.Value,t=r.Value,u}(),f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor),e=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor);return f.Add(n.get_Item$$Int32(t)),e.Add(n.get_Item$$Int32(u)),i=n.get_Item$$Int32(t).get_Interval(),r=n.get_Item$$Int32(u).get_Interval(),function(){var o={Value:i},s={Value:r},h=Microsoft.Msagl.Core.Geometry.IntervalNode$1.DivideNodes(n,t,u,f,e,o,s,2);return i=o.Value,r=s.Value,h}(),function(){var t=new Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor$$Int32(this.TData,n.get_Count());return t.set_Interval(new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(i,r)),t.set_Left(Microsoft.Msagl.Core.Geometry.IntervalNode$1.CreateIntervalNodeOnListOfNodes(f)),t.set_Right(Microsoft.Msagl.Core.Geometry.IntervalNode$1.CreateIntervalNodeOnListOfNodes(e)),t}()},ChooseSeeds:function(n,t,i){for(var e,f,o,u=new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(t.Value,n.get_Item$$Int32(i.Value).get_Interval()).get_Length(),r=2;r<n.get_Count();r++)e=new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(t.Value,n.get_Item$$Int32(r).get_Interval()).get_Length(),e>u&&(i.Value=r,u=e);for(f=0,r=0;r<n.get_Count();r++)if(r!=i.Value){f=r;break}for(u=new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(n.get_Item$$Int32(i.Value).get_Interval(),n.get_Item$$Int32(f).get_Interval()).get_Length(),r=0;r<n.get_Count();r++)r!=i.Value&&(o=new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(n.get_Item$$Int32(i.Value).get_Interval(),n.get_Item$$Int32(r).get_Interval()).get_Length(),o>u&&(f=r,u=o));return f},DivideNodes:function(n,t,i,r,u,f,e,o){for(var s=0;s<n.get_Count();s++)if(s!=t&&s!=i){var h=new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(f.Value,n.get_Item$$Int32(s).get_Interval()),l=h.get_Length()-f.Value.get_Length(),c=new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(e.Value,n.get_Item$$Int32(s).get_Interval()),a=c.get_Length()-e.Value.get_Length();r.get_Count()*o<u.get_Count()?(r.Add(n.get_Item$$Int32(s)),f.Value=h):u.get_Count()*o<r.get_Count()?(u.Add(n.get_Item$$Int32(s)),e.Value=c):l<a?(r.Add(n.get_Item$$Int32(s)),f.Value=h):a<l?(u.Add(n.get_Item$$Int32(s)),e.Value=c):f.Value.get_Length()<e.Value.get_Length()?(r.Add(n.get_Item$$Int32(s)),f.Value=h):(u.Add(n.get_Item$$Int32(s)),e.Value=c)}},TraverseHierarchy:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"node");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"visitor");t(n);n.get_Left()!=null&&Microsoft.Msagl.Core.Geometry.IntervalNode$1.TraverseHierarchy(n.get_Left(),t);n.get_Right()!=null&&Microsoft.Msagl.Core.Geometry.IntervalNode$1.TraverseHierarchy(n.get_Right(),t)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.TData=n;this.left=null;this.right=null;this.interval=null;this._Count=0;this._UserData=null;this._Parent=null;System.Object.ctor.call(this)},Count$$:"System.Int32",get_Count:function(){return this._Count},set_Count:function(n){this._Count=n},ctor$$TData$$Interval:function(n,t,i){this.TData=n;this.left=null;this.right=null;this.interval=null;this._Count=0;this._UserData=null;this._Parent=null;System.Object.ctor.call(this);this.set_UserData(t);this.set_Interval(i);this.set_Count(1)},ctor$$Int32:function(n,t){this.TData=n;this.left=null;this.right=null;this.interval=null;this._Count=0;this._UserData=null;this._Parent=null;System.Object.ctor.call(this);this.set_Count(t)},Interval$$:"Microsoft.Msagl.Layout.LargeGraphLayout.Interval",get_Interval:function(){return this.interval},set_Interval:function(n){this.interval=n},IsLeaf$$:"System.Boolean",get_IsLeaf:function(){return this.left==null},Left$$:"Microsoft.Msagl.Core.Geometry.IntervalNode`1[[`0]]",get_Left:function(){return this.left},set_Left:function(n){this.left!=null&&this.left.get_Parent()==this&&this.left.set_Parent(null);this.left=n;this.left!=null&&this.left.set_Parent(this)},Right$$:"Microsoft.Msagl.Core.Geometry.IntervalNode`1[[`0]]",get_Right:function(){return this.right},set_Right:function(n){this.right!=null&&this.right.get_Parent()==this&&this.right.set_Parent(null);this.right=n;this.right!=null&&this.right.set_Parent(this)},UserData$$:"`0",get_UserData:function(){return this._UserData},set_UserData:function(n){this._UserData=n},Parent$$:"Microsoft.Msagl.Core.Geometry.IntervalNode`1[[`0]]",get_Parent:function(){return this._Parent},set_Parent:function(n){this._Parent=n},IsLeftChild$$:"System.Boolean",get_IsLeftChild:function(){return System.Diagnostics.Debug.Assert$$Boolean(this.get_Parent()!=null),this.Equals$$Object(this.get_Parent().get_Left())},FirstHitNode$$Double$$Func$3:function(n,t){return this.interval.Contains(n)?this.get_IsLeaf()?t!=null?t(n,this.get_UserData())==Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop?this:null:this:this.get_Left().FirstHitNode$$Double$$Func$3(n,t)!=null?this.get_Left().FirstHitNode$$Double$$Func$3(n,t):this.get_Right().FirstHitNode$$Double$$Func$3(n,t):null},FirstIntersectedNode:function(n){return n.Intersects(this.interval)?this.get_IsLeaf()?this:this.get_Left().FirstIntersectedNode(n)!=null?this.get_Left().FirstIntersectedNode(n):this.get_Right().FirstIntersectedNode(n):null},FirstHitNode$$Double:function(n){return this.interval.Contains(n)?this.get_IsLeaf()?this:this.get_Left().FirstHitNode$$Double(n)!=null?this.get_Left().FirstHitNode$$Double(n):this.get_Right().FirstHitNode$$Double(n):null},AllHitItems$$Interval$$Func$2:function(n,t){var u=[],r=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor),i;for(r.Push(this);r.get_Count()>0;)i=r.Pop(),i.get_Interval().Intersects(n)&&(i.get_IsLeaf()?(null==t||t(i.get_UserData()))&&u.push(i.get_UserData()):(r.Push(i.left),r.Push(i.right)));return u},AllHitItems$$Double:function(n){var r=[],i=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor),t;for(i.Push(this);i.get_Count()>0;)t=i.Pop(),t.get_Interval().Contains(n)&&(t.get_IsLeaf()?r.push(t.get_UserData()):(i.Push(t.left),i.Push(t.right)));return r},Clone:function(){var n=function(){var n=new Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor$$Int32(this.TData,this.get_Count());return n.set_UserData(this.get_UserData()),n.set_Interval(this.get_Interval()),n}.call(this);return this.get_Left()!=null&&n.set_Left(this.get_Left().Clone()),this.get_Right()!=null&&n.set_Right(this.get_Right().Clone()),n},GetNodeItemsIntersectingInterval:function(n){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor,this.TData,this.GetLeafIntervalNodesIntersectingInterval(n),$CreateAnonymousDelegate(this,function(n){return n.get_UserData()}))},GetLeafIntervalNodesIntersectingInterval:function(n){var r=[],i=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor),t;for(i.Push(this);i.get_Count()>0;)t=i.Pop(),t.get_Interval().Intersects(n)&&(t.get_IsLeaf()?r.push(t):(i.Push(t.left),i.Push(t.right)));return r},GetAllLeaves:function(){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor,this.TData,this.GetAllLeafNodes(),$CreateAnonymousDelegate(this,function(n){return n.get_UserData()}))},GetAllLeafNodes:function(){return this.EnumIntervalNodes(!0)},EnumIntervalNodes:function(n){var r=[],i=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor),t;for(i.Push(this);i.get_Count()>0;)t=i.Pop(),(t.get_IsLeaf()||!n)&&r.push(t),t.get_IsLeaf()||(i.Push(t.left),i.Push(t.right));return r}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$IntervalNode$1);Microsoft$Msagl$Core$Geometry$IntervalNodeUtils={fullname:"Microsoft.Msagl.Core.Geometry.IntervalNodeUtils",baseTypeName:"System.Object",staticDefinition:{CrossIntervalNodes$2$$IntervalNode$1$$IntervalNode$1$$Action$2:function(n,t,i,r,u){i.interval.Intersects(r.interval)&&(i.get_Left()==null?r.get_Left()==null?u(i.get_UserData(),r.get_UserData()):(Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$2$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t,i,r.get_Left(),u),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$2$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t,i,r.get_Right(),u)):r.get_Left()!=null?(Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$2$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t,i.get_Left(),r.get_Left(),u),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$2$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t,i.get_Left(),r.get_Right(),u),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$2$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t,i.get_Right(),r.get_Left(),u),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$2$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t,i.get_Right(),r.get_Right(),u)):(Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$2$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t,i.get_Left(),r,u),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$2$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t,i.get_Right(),r,u)))},CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2:function(n,t,i,r){t.interval.Intersects(i.interval)&&(System.Object.Equals$$Object$$Object(t,i)?Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.HandleEquality$1(n,t,r):t.get_Left()==null?i.get_Left()==null?r(t.get_UserData(),i.get_UserData()):(Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t,i.get_Left(),r),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t,i.get_Right(),r)):i.get_Left()!=null?(Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t.get_Left(),i.get_Left(),r),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t.get_Left(),i.get_Right(),r),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t.get_Right(),i.get_Left(),r),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t.get_Right(),i.get_Right(),r)):(Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t.get_Left(),i,r),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t.get_Right(),i,r)))},FindIntersectionWithProperty$1:function(n,t,i,r){if(!t.interval.Intersects(i.interval))return!1;if(System.Object.Equals$$Object$$Object(t,i))return Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.HandleEqualityCheck$1(n,t,r);if(t.get_Left()==null){if(i.get_Left()==null)return r(t.get_UserData(),i.get_UserData());if(Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.FindIntersectionWithProperty$1(n,t,i.get_Left(),r)||Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.FindIntersectionWithProperty$1(n,t,i.get_Right(),r))return!0}else if(i.get_Left()!=null){if(Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.FindIntersectionWithProperty$1(n,t.get_Left(),i.get_Left(),r)||Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.FindIntersectionWithProperty$1(n,t.get_Left(),i.get_Right(),r)||Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.FindIntersectionWithProperty$1(n,t.get_Right(),i.get_Left(),r)||Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.FindIntersectionWithProperty$1(n,t.get_Right(),i.get_Right(),r))return!0}else if(Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.FindIntersectionWithProperty$1(n,t.get_Left(),i,r)||Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.FindIntersectionWithProperty$1(n,t.get_Right(),i,r))return!0;return!1},HandleEqualityCheck$1:function(n,t,i){return t.get_Left()==null?!1:Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.FindIntersectionWithProperty$1(n,t.get_Left(),t.get_Left(),i)||Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.FindIntersectionWithProperty$1(n,t.get_Left(),t.get_Right(),i)||Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.FindIntersectionWithProperty$1(n,t.get_Right(),t.get_Right(),i)},HandleEquality$1:function(n,t,i){t.get_Left()!=null&&(Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t.get_Left(),t.get_Left(),i),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t.get_Left(),t.get_Right(),i),Microsoft.Msagl.Core.Geometry.IntervalNodeUtils.CrossIntervalNodes$1$$IntervalNode$1$$IntervalNode$1$$Action$2(n,t.get_Right(),t.get_Right(),i))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$IntervalNodeUtils);Microsoft$Msagl$Core$Geometry$IntervalRTree$1={fullname:"Microsoft.Msagl.Core.Geometry.IntervalRTree$1",baseTypeName:"System.Object",staticDefinition:{GetNodeRects:function(n){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor,n,function(n){return new Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor$$TData$$Interval(this.TData,n.get_Value(),n.get_Key())})},AddNodeToTreeRecursive:function(n,t){var i,r,u,f;t.get_IsLeaf()?(t.set_Left(new Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor$$TData$$Interval(this.TData,t.get_UserData(),t.get_Interval())),t.set_Right(n),t.set_Count(2),t.set_UserData(Default(this.TData))):(t.set_Count(t.get_Count()+1),2*t.get_Left().get_Count()<t.get_Right().get_Count()?(Microsoft.Msagl.Core.Geometry.IntervalRTree$1.AddNodeToTreeRecursive(n,t.get_Left()),t.get_Left().set_Interval(new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(t.get_Left().get_Interval(),n.get_Interval()))):2*t.get_Right().get_Count()<t.get_Left().get_Count()?(Microsoft.Msagl.Core.Geometry.IntervalRTree$1.AddNodeToTreeRecursive(n,t.get_Right()),t.get_Right().set_Interval(new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(t.get_Right().get_Interval(),n.get_Interval()))):(i=new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(t.get_Left().get_Interval(),n.get_Interval()),u=i.get_Length()-t.get_Left().get_Interval().get_Length(),r=new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(t.get_Right().get_Interval(),n.get_Interval()),f=r.get_Length()-t.get_Right().get_Interval().get_Length(),u<f?(Microsoft.Msagl.Core.Geometry.IntervalRTree$1.AddNodeToTreeRecursive(n,t.get_Left()),t.get_Left().set_Interval(i)):u>f?(Microsoft.Msagl.Core.Geometry.IntervalRTree$1.AddNodeToTreeRecursive(n,t.get_Right()),t.get_Right().set_Interval(r)):i.get_Length()<r.get_Length()?(Microsoft.Msagl.Core.Geometry.IntervalRTree$1.AddNodeToTreeRecursive(n,t.get_Left()),t.get_Left().set_Interval(i)):(Microsoft.Msagl.Core.Geometry.IntervalRTree$1.AddNodeToTreeRecursive(n,t.get_Right()),t.get_Right().set_Interval(r))));t.set_Interval(new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(t.get_Left().get_Interval(),t.get_Right().get_Interval()))},TreeIsCorrect:function(n){if(n==null)return!0;var t=n.get_Left()!=null&&n.get_Right()!=null||n.get_Left()==null&&n.get_Right()==null;return t?Microsoft.Msagl.Core.Geometry.IntervalRTree$1.TreeIsCorrect(n.get_Left())&&Microsoft.Msagl.Core.Geometry.IntervalRTree$1.TreeIsCorrect(n.get_Right()):!1},UpdateParent:function(n){for(var t=n.get_Parent();t!=null;t=t.get_Parent())t.set_Count(t.get_Count()-1),t.set_Interval(new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(t.get_Left().get_Interval(),t.get_Right().get_Interval()))},TransferFromSibling:function(n,t){n.set_UserData(t.get_UserData());n.set_Left(t.get_Left());n.set_Right(t.get_Right());n.set_Count(n.get_Count()-1);n.set_Interval(t.get_Interval())},RebuildUnderNodeWithoutLeaf:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(t.get_IsLeaf());System.Diagnostics.Debug.Assert$$Boolean(!n.get_IsLeaf());var i=Microsoft.Msagl.Core.Geometry.IntervalNode$1.CreateIntervalNodeOnEnumeration(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor,n.GetAllLeafNodes(),function(n){return!n.Equals$$Object(t)}));n.set_Count(i.get_Count());n.set_Left(i.get_Left());n.set_Right(i.get_Right());n.set_Interval(new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Interval$$Interval(i.get_Left().interval,i.get_Right().interval))},FindTopUnbalancedNode:function(n){for(var t=n.get_Parent();t!=null;t=t.get_Parent())if(!Microsoft.Msagl.Core.Geometry.IntervalRTree$1.Balanced(t))return t;return null},Balanced:function(n){return 2*n.get_Left().get_Count()>=n.get_Right().get_Count()&&2*n.get_Right().get_Count()>=n.get_Left().get_Count()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$IEnumerable$1:function(n,t){this.TData=n;this.rootNode=null;System.Object.ctor.call(this);this.rootNode=Microsoft.Msagl.Core.Geometry.IntervalNode$1.CreateIntervalNodeOnEnumeration(Microsoft.Msagl.Core.Geometry.IntervalRTree$1.GetNodeRects(t))},RootNode$$:"Microsoft.Msagl.Core.Geometry.IntervalNode`1[[`0]]",get_RootNode:function(){return this.rootNode},set_RootNode:function(n){this.rootNode=n},ctor$$IntervalNode$1:function(n,t){this.TData=n;this.rootNode=null;System.Object.ctor.call(this);this.rootNode=t},ctor:function(n){this.TData=n;this.rootNode=null;System.Object.ctor.call(this)},Count$$:"System.Int32",get_Count:function(){return this.rootNode==null?0:this.rootNode.get_Count()},Add$$Interval$$TData:function(n,t){this.Add$$IntervalNode$1(new Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor$$TData$$Interval(this.TData,t,n))},Add$$IntervalNode$1:function(n){this.rootNode==null?this.rootNode=n:this.get_Count()<=2?this.rootNode=Microsoft.Msagl.Core.Geometry.IntervalNode$1.CreateIntervalNodeOnEnumeration(System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor,this.rootNode.GetAllLeafNodes(),[n])):Microsoft.Msagl.Core.Geometry.IntervalRTree$1.AddNodeToTreeRecursive(n,this.rootNode)},Rebuild:function(){this.rootNode=Microsoft.Msagl.Core.Geometry.IntervalNode$1.CreateIntervalNodeOnEnumeration(this.rootNode.GetAllLeafNodes())},GetAllLeaves:function(){return this.rootNode!=null&&this.get_Count()>0?this.rootNode.GetAllLeaves():new Array(0)},GetAllIntersecting:function(n){return this.rootNode==null||this.get_Count()==0?new Array(0):this.rootNode.GetNodeItemsIntersectingInterval(n)},IsIntersecting:function(n){return System.Linq.Enumerable.Any$1$$IEnumerable$1(this.TData,this.GetAllIntersecting(n))},Contains:function(n,t){return this.rootNode==null?!1:System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor,this.rootNode.GetLeafIntervalNodesIntersectingInterval(n),$CreateAnonymousDelegate(this,function(n){return n.get_UserData().Equals$$Object(t)}))},Remove:function(n,t){if(this.rootNode==null)return Default(this.TData);var i=System.Linq.Enumerable.FirstOrDefault$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor,this.rootNode.GetLeafIntervalNodesIntersectingInterval(n),$CreateAnonymousDelegate(this,function(n){return n.get_UserData().Equals$$Object(t)}));return i==null?Default(this.TData):(this.get_RootNode().get_Count()==1?this.set_RootNode(null):this.RemoveLeaf(i),i.get_UserData())},RemoveLeaf:function(n){var i,t;System.Diagnostics.Debug.Assert$$Boolean(n.get_IsLeaf());i=Microsoft.Msagl.Core.Geometry.IntervalRTree$1.FindTopUnbalancedNode(n);i!=null?(Microsoft.Msagl.Core.Geometry.IntervalRTree$1.RebuildUnderNodeWithoutLeaf(i,n),Microsoft.Msagl.Core.Geometry.IntervalRTree$1.UpdateParent(i)):(t=n.get_Parent(),t==null?(System.Diagnostics.Debug.Assert$$Boolean(this.rootNode==n),this.rootNode=new Microsoft.Msagl.Core.Geometry.IntervalNode$1.ctor(this.TData)):(Microsoft.Msagl.Core.Geometry.IntervalRTree$1.TransferFromSibling(t,n.get_IsLeftChild()?t.get_Right():t.get_Left()),Microsoft.Msagl.Core.Geometry.IntervalRTree$1.UpdateParent(t)));System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.IntervalRTree$1.TreeIsCorrect(this.get_RootNode()))},Clean:function(){this.set_RootNode(null)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$IntervalRTree$1);Microsoft$Msagl$Core$Geometry$RectangleNodeUtils={fullname:"Microsoft.Msagl.Core.Geometry.RectangleNodeUtils",baseTypeName:"System.Object",staticDefinition:{CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2:function(n,t,i,r,u){i.rectangle.Intersects(r.rectangle)&&(i.get_Left()==null?r.get_Left()==null?u(i.get_UserData(),r.get_UserData()):(Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t,i,r.get_Left(),u),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t,i,r.get_Right(),u)):r.get_Left()!=null?(Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t,i.get_Left(),r.get_Left(),u),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t,i.get_Left(),r.get_Right(),u),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t,i.get_Right(),r.get_Left(),u),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t,i.get_Right(),r.get_Right(),u)):(Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t,i.get_Left(),r,u),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t,i.get_Right(),r,u)))},CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2:function(n,t,i,r){t.rectangle.Intersects(i.rectangle)&&(System.Object.Equals$$Object$$Object(t,i)?Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.HandleEquality$1(n,t,r):t.get_Left()==null?i.get_Left()==null?r(t.get_UserData(),i.get_UserData()):(Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t,i.get_Left(),r),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t,i.get_Right(),r)):i.get_Left()!=null?(Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t.get_Left(),i.get_Left(),r),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t.get_Left(),i.get_Right(),r),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t.get_Right(),i.get_Left(),r),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t.get_Right(),i.get_Right(),r)):(Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t.get_Left(),i,r),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t.get_Right(),i,r)))},FindIntersectionWithProperty$1:function(n,t,i,r){if(!t.rectangle.Intersects(i.rectangle))return!1;if(System.Object.Equals$$Object$$Object(t,i))return Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.HandleEqualityCheck$1(n,t,r);if(t.get_Left()==null){if(i.get_Left()==null)return r(t.get_UserData(),i.get_UserData());if(Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(n,t,i.get_Left(),r)||Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(n,t,i.get_Right(),r))return!0}else if(i.get_Left()!=null){if(Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(n,t.get_Left(),i.get_Left(),r)||Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(n,t.get_Left(),i.get_Right(),r)||Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(n,t.get_Right(),i.get_Left(),r)||Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(n,t.get_Right(),i.get_Right(),r))return!0}else if(Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(n,t.get_Left(),i,r)||Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(n,t.get_Right(),i,r))return!0;return!1},HandleEqualityCheck$1:function(n,t,i){return t.get_Left()==null?!1:Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(n,t.get_Left(),t.get_Left(),i)||Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(n,t.get_Left(),t.get_Right(),i)||Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(n,t.get_Right(),t.get_Right(),i)},HandleEquality$1:function(n,t,i){t.get_Left()!=null&&(Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t.get_Left(),t.get_Left(),i),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t.get_Left(),t.get_Right(),i),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(n,t.get_Right(),t.get_Right(),i))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$RectangleNodeUtils);Microsoft$Msagl$Core$Geometry$Site={fullname:"Microsoft.Msagl.Core.Geometry.Site",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.previouisBezierCoefficient=.5;this.nextBezierCoefficient=.5;this.previousTangentCoefficient=.333333333333333;this.nextTangentCoefficient=.333333333333333;this.point=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.prev=null;this.next=null;System.Object.ctor.call(this)},PreviousBezierSegmentFitCoefficient$$:"System.Double",get_PreviousBezierSegmentFitCoefficient:function(){return this.previouisBezierCoefficient},set_PreviousBezierSegmentFitCoefficient:function(n){this.previouisBezierCoefficient=n},NextBezierSegmentFitCoefficient$$:"System.Double",get_NextBezierSegmentFitCoefficient:function(){return this.nextBezierCoefficient},set_NextBezierSegmentFitCoefficient:function(n){this.nextBezierCoefficient=n},PreviousTangentCoefficient$$:"System.Double",get_PreviousTangentCoefficient:function(){return this.previousTangentCoefficient},set_PreviousTangentCoefficient:function(n){this.previousTangentCoefficient=n},NextTangentCoefficient$$:"System.Double",get_NextTangentCoefficient:function(){return this.nextTangentCoefficient},set_NextTangentCoefficient:function(n){this.nextTangentCoefficient=n},Point$$:"Microsoft.Msagl.Core.Geometry.Point",get_Point:function(){return this.point},set_Point:function(n){this.point=n},Previous$$:"Microsoft.Msagl.Core.Geometry.Site",get_Previous:function(){return this.prev},set_Previous:function(n){this.prev=n},Next$$:"Microsoft.Msagl.Core.Geometry.Site",get_Next:function(){return this.next},set_Next:function(n){this.next=n},ctor$$Point:function(n){this.previouisBezierCoefficient=.5;this.nextBezierCoefficient=.5;this.previousTangentCoefficient=.333333333333333;this.nextTangentCoefficient=.333333333333333;this.point=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.prev=null;this.next=null;System.Object.ctor.call(this);this.point=n},ctor$$Site$$Point:function(n,t){this.previouisBezierCoefficient=.5;this.nextBezierCoefficient=.5;this.previousTangentCoefficient=.333333333333333;this.nextTangentCoefficient=.333333333333333;this.point=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.prev=null;this.next=null;System.Object.ctor.call(this);Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"pr");this.point=t;this.prev=n;n.next=this},ctor$$Site$$Point$$Site:function(n,t,i){this.previouisBezierCoefficient=.5;this.nextBezierCoefficient=.5;this.previousTangentCoefficient=.333333333333333;this.nextTangentCoefficient=.333333333333333;this.point=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.prev=null;this.next=null;System.Object.ctor.call(this);Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"pr");Microsoft.Msagl.Core.ValidateArg.IsNotNull(i,"ne");this.prev=n;this.point=t;this.next=i;n.next=this;this.next.prev=this},Turn$$:"System.Double",get_Turn:function(){return this.get_Next()==null||this.get_Previous()==null?0:Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(this.get_Previous().get_Point(),this.get_Point(),this.get_Next().get_Point())},Clone:function(){var n=new Microsoft.Msagl.Core.Geometry.Site.ctor;return n.set_PreviousBezierSegmentFitCoefficient(this.get_PreviousBezierSegmentFitCoefficient()),n.set_Point(this.get_Point()),n},toString:function(){return this.get_Point().toString()}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Site);Microsoft$Msagl$Core$GraphAlgorithms$MinimumSpanningTreeByPrim={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.MinimumSpanningTreeByPrim",baseTypeName:"System.Object",staticDefinition:{Test:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.graph=null;this.weight=null;this.root=0;this.q=null;this.treeNodes=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor);this.hedgehog=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IEdge.ctor);System.Object.ctor.call(this);this.graph=n;this.weight=t;this.root=i;this.q=new Microsoft.Msagl.Core.DataStructures.BinaryHeapPriorityQueue.ctor(n.get_NodeCount())},NodeIsInTree:function(n){return this.treeNodes.Contains$$T(n)},GetTreeEdges:function(){var n=new System.Collections.Generic.List$1.ctor$$Int32(Microsoft.Msagl.Core.GraphAlgorithms.IEdge.ctor,this.graph.get_NodeCount()-1);for(this.Init();n.get_Count()<this.graph.get_NodeCount()-1&&this.q.get_Count()>0;)this.AddEdgeToTree(n);return n},AddEdgeToTree:function(n){var t=this.q.Dequeue(),i=this.hedgehog.get_Item$$TKey(t);this.treeNodes.Insert(t);n.Add(i);this.UpdateOutEdgesOfV(t);this.UpdateInEdgesOfV(t)},UpdateOutEdgesOfV:function(n){for(var f=this.graph.OutEdges(n).GetEnumerator(),i,t,r,e,u;f.MoveNext();)(i=f.get_Current(),t=i.get_Target(),this.NodeIsInTree(t))||(function(){var n={Value:r},i=this.hedgehog.TryGetValue(t,n);return r=n.Value,i}.call(this)?(e=this.weight(r),u=this.weight(i),u<e&&(this.q.DecreasePriority(t,u),this.hedgehog.set_Item$$TKey(t,i))):(this.q.Enqueue(t,this.weight(i)),this.hedgehog.set_Item$$TKey(t,i)))},UpdateInEdgesOfV:function(n){for(var f=this.graph.InEdges(n).GetEnumerator(),i,t,r,e,u;f.MoveNext();)(i=f.get_Current(),t=i.get_Source(),this.NodeIsInTree(t))||(function(){var n={Value:r},i=this.hedgehog.TryGetValue(t,n);return r=n.Value,i}.call(this)?(e=this.weight(r),u=this.weight(i),u<e&&(this.q.DecreasePriority(t,u),this.hedgehog.set_Item$$TKey(t,i))):(this.q.Enqueue(t,this.weight(i)),this.hedgehog.set_Item$$TKey(t,i)))},Init:function(){var r,n,u,t,i;for(this.treeNodes.Insert(this.root),r=this.graph.OutEdges(this.root).GetEnumerator();r.MoveNext();)n=r.get_Current(),i=this.weight(n),this.q.Enqueue(n.get_Target(),i),this.hedgehog.set_Item$$TKey(n.get_Target(),n);for(u=this.graph.InEdges(this.root).GetEnumerator();u.MoveNext();)t=u.get_Current(),i=this.weight(t),this.q.Enqueue(t.get_Source(),i),this.hedgehog.set_Item$$TKey(t.get_Source(),t)}}};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$MinimumSpanningTreeByPrim);Microsoft$Msagl$Core$Layout$Arrowhead={fullname:"Microsoft.Msagl.Core.Layout.Arrowhead",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Layout.Arrowhead.DefaultArrowheadLength=10}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.length=10;this._Width=0;this._TipPosition=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._Offset=0;System.Object.ctor.call(this)},Length$$:"System.Double",get_Length:function(){return this.length},set_Length:function(n){this.length=n},Width$$:"System.Double",get_Width:function(){return this._Width},set_Width:function(n){this._Width=n},TipPosition$$:"Microsoft.Msagl.Core.Geometry.Point",get_TipPosition:function(){return this._TipPosition},set_TipPosition:function(n){this._TipPosition=n},Offset$$:"System.Double",get_Offset:function(){return this._Offset},set_Offset:function(n){this._Offset=n},Clone:function(){return function(){var n=new Microsoft.Msagl.Core.Layout.Arrowhead.ctor;return n.set_Length(this.length),n.set_Width(this.get_Width()),n.set_TipPosition(this.get_TipPosition()),n.set_Offset(this.get_Offset()),n}.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$Arrowhead);Microsoft$Msagl$Core$Layout$Arrowheads={fullname:"Microsoft.Msagl.Core.Layout.Arrowheads",baseTypeName:"System.Object",staticDefinition:{CalculateArrowheads:function(n){var t,i,r;return(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edgeGeometry"),n.get_SourceArrowhead()==null&&n.get_TargetArrowhead()==null)?!0:function(){var i={Value:t},r=Microsoft.Msagl.Core.Layout.Arrowheads.FindTrimStartForArrowheadAtSource(n,i);return t=i.Value,r}()?function(){var t={Value:i},r=Microsoft.Msagl.Core.Layout.Arrowheads.FindTrimEndForArrowheadAtTarget(n,t);return i=t.Value,r}()?t>i-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()||Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(n.get_Curve().get_Item$$Double(t),n.get_Curve().get_Item$$Double(i))?!1:(r=n.get_Curve().Trim(t,i),r==null)?!1:(n.get_SourceArrowhead()!=null&&n.get_SourceArrowhead().set_TipPosition(Microsoft.Msagl.Core.Layout.Arrowheads.PlaceTip(r.get_Start(),n.get_Curve().get_Start(),n.get_SourceArrowhead().get_Offset())),n.get_TargetArrowhead()!=null&&n.get_TargetArrowhead().set_TipPosition(Microsoft.Msagl.Core.Layout.Arrowheads.PlaceTip(r.get_End(),n.get_Curve().get_End(),n.get_TargetArrowhead().get_Offset())),n.set_Curve(r),!0):!1:!1},GetIntersectionsWithArrowheadCircle:function(n,t,i){System.Diagnostics.Debug.Assert$$Boolean(t>0);var r=new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point(t,t,i);return Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(r,n,!0)},FindTrimEndForArrowheadAtTarget:function(n,t){var o=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon*Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon;if(t.Value=n.get_Curve().get_ParEnd(),n.get_TargetArrowhead()==null||n.get_TargetArrowhead().get_Length()<=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return!0;var i=n.get_Curve(),u=n.get_TargetArrowhead().get_Length(),f,r,e=10;do{if(e--,e==0)return!1;r=Microsoft.Msagl.Core.Layout.Arrowheads.GetIntersectionsWithArrowheadCircle(i,u,i.get_End());t.Value=r.get_Count()!=0?System.Linq.Enumerable.Max$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor,r,function(n){return n.get_Par1()}):i.get_ParEnd();f=n.get_Curve().get_Item$$Double(t.Value);u/=2}while(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,i.get_Start()).get_LengthSquared()<o||r.get_Count()==0);return!0},FindTrimStartForArrowheadAtSource:function(n,t){var u;if(t.Value=0,n.get_SourceArrowhead()==null||n.get_SourceArrowhead().get_Length()<=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return!0;u=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon*Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon;System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Curve().get_End(),n.get_Curve().get_Start()).get_LengthSquared()>u);var f=n.get_SourceArrowhead().get_Length(),e,i=n.get_Curve(),r,o=10;do{if(o--,o==0)return!1;r=Microsoft.Msagl.Core.Layout.Arrowheads.GetIntersectionsWithArrowheadCircle(i,f,i.get_Start());t.Value=r.get_Count()!=0?System.Linq.Enumerable.Min$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor,r,function(n){return n.get_Par1()}):i.get_ParStart();e=i.get_Item$$Double(t.Value);f/=2}while(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,i.get_End()).get_LengthSquared()<u||r.get_Count()==0);return!0},PlaceTip:function(n,t,i){if(System.Math.Abs$$Double(i)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())return t;var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t),u=r.get_Length();return u<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?t:Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(r,u)))},TrimSplineAndCalculateArrowheads$$Edge$$ICurve$$Boolean$$Boolean:function(n,t,i,r){return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edge"),Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(n.get_EdgeGeometry(),n.get_Source().get_BoundaryCurve(),n.get_Target().get_BoundaryCurve(),t,i,r)},TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean:function(n,t,i,r,u){var e;if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(r,"spline"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edgeGeometry"),n.set_Curve(Microsoft.Msagl.Core.Geometry.Curves.Curve.TrimEdgeSplineWithNodeBoundaries(t,i,r,u)),n.get_Curve()==null)return!1;if((n.get_SourceArrowhead()==null||n.get_SourceArrowhead().get_Length()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)&&(n.get_TargetArrowhead()==null||n.get_TargetArrowhead().get_Length()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon))return!0;var f=!1,o=n.get_SourceArrowhead()!=null?n.get_SourceArrowhead().get_Length():0,s=n.get_TargetArrowhead()!=null?n.get_TargetArrowhead().get_Length():0,h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Curve().get_End(),n.get_Curve().get_Start()).get_Length();for(n.get_SourceArrowhead()!=null&&n.get_SourceArrowhead().set_Length(System.Math.Min$$Double$$Double(h,o)),n.get_TargetArrowhead()!=null&&n.get_TargetArrowhead().set_Length(System.Math.Min$$Double$$Double(h,s)),e=10;(n.get_SourceArrowhead()!=null&&n.get_SourceArrowhead().get_Length()>Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()||n.get_TargetArrowhead()!=null&&n.get_TargetArrowhead().get_Length()>Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon())&&!f;)if(f=Microsoft.Msagl.Core.Layout.Arrowheads.CalculateArrowheads(n),f||(n.get_SourceArrowhead()!=null&&n.get_SourceArrowhead().set_Length(n.get_SourceArrowhead().get_Length()*.5),n.get_TargetArrowhead()!=null&&n.get_TargetArrowhead().set_Length(n.get_TargetArrowhead().get_Length()*.5)),e--,e==0)break;return f||(n.get_SourceArrowhead()!=null&&n.get_SourceArrowhead().set_TipPosition(r.get_Start()),n.get_TargetArrowhead()!=null&&n.get_TargetArrowhead().set_TipPosition(r.get_End())),n.get_SourceArrowhead()!=null&&n.get_SourceArrowhead().set_Length(o),n.get_TargetArrowhead()!=null&&n.get_TargetArrowhead().set_Length(s),f},CreateBigEnoughSpline:function(n){var u,f,o,s;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edge");var i=n.get_Source().get_Center(),r=n.get_Target().get_Center(),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,i),h=e.get_Length(),t;h<.001?(t=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1,0),r=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,t.Rotate(1.5707963267949))):t=e.Rotate(1.5707963267949);u=1;n.get_EdgeGeometry().get_SourceArrowhead()!=null&&(u+=n.get_EdgeGeometry().get_SourceArrowhead().get_Length());n.get_EdgeGeometry().get_TargetArrowhead()!=null&&(u+=n.get_EdgeGeometry().get_TargetArrowhead().get_Length());t=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t.Normalize(),1.5),u);f=1;do{if(o=Microsoft.Msagl.Core.Geometry.Curves.Curve.CreateBezierSeg$$Point$$Point$$Point$$Int32(i,r,t,f),Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(n.get_EdgeGeometry(),n.get_Source().get_BoundaryCurve(),n.get_Target().get_BoundaryCurve(),o,!1,!1))break;if(f*=2,s=1e4,f>=s){Microsoft.Msagl.Core.Layout.Arrowheads.CreateEdgeCurveWithNoTrimming(n,i,r);return}}while(1)},CreateEdgeCurveWithNoTrimming:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t),u;r=r.Normalize();var e=t,o=i,f=n.get_EdgeGeometry().get_TargetArrowhead();f!=null&&(f.set_TipPosition(i),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,f.get_Length())));u=n.get_EdgeGeometry().get_SourceArrowhead();u!=null&&(u.set_TipPosition(t),e=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,u.get_Length())));n.set_Curve(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(e,o))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$Arrowheads);Microsoft$Msagl$Core$Layout$CurvePort={fullname:"Microsoft.Msagl.Core.Layout.CurvePort",baseTypeName:"Microsoft.Msagl.Core.Layout.Port",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$ICurve$$Double:function(n,t){this.parameter=0;this.curve=null;Microsoft.Msagl.Core.Layout.Port.ctor.call(this);this.curve=n;this.parameter=t},ctor:function(){this.parameter=0;this.curve=null;Microsoft.Msagl.Core.Layout.Port.ctor.call(this)},Parameter$$:"System.Double",get_Parameter:function(){return this.parameter},set_Parameter:function(n){this.parameter=n},Curve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Curve:function(){return this.curve},set_Curve:function(n){this.curve=n},Location$$:"Microsoft.Msagl.Core.Geometry.Point",get_Location:function(){return this.get_Curve().get_Item$$Double(this.parameter).Clone()}}};JsTypes.push(Microsoft$Msagl$Core$Layout$CurvePort);Microsoft$Msagl$Core$Layout$EdgeCollection={fullname:"Microsoft.Msagl.Core.Layout.EdgeCollection",baseTypeName:"System.Object",staticDefinition:{AddEdgeToNodes:function(n){n.get_Source()!=n.get_Target()?(n.get_Source().AddOutEdge(n),n.get_Target().AddInEdge(n)):n.get_Target().AddSelfEdge(n)},DetouchEdge:function(n){var t=n.get_Source(),i=n.get_Target();t!=i?(t.RemoveOutEdge(n),i.RemoveInEdge(n)):t.RemoveSelfEdge(n);n.set_GeometryParent(null)}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor:function(n){this.edges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.graph=null;System.Object.ctor.call(this);this.graph=n},Add:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"item");n.set_GeometryParent(this.graph);this.edges.Add(n);Microsoft.Msagl.Core.Layout.EdgeCollection.AddEdgeToNodes(n)},Clear:function(){var t,n;for(this.edges.Clear(),t=this.graph.get_Nodes().GetEnumerator();t.MoveNext();)n=t.get_Current(),Cast(n.get_OutEdges(),Microsoft.Msagl.Core.DataStructures.Set$1.ctor).Clear(),Cast(n.get_InEdges(),Microsoft.Msagl.Core.DataStructures.Set$1.ctor).Clear(),Cast(n.get_SelfEdges(),Microsoft.Msagl.Core.DataStructures.Set$1.ctor).Clear()},Contains:function(n){return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"item"),this.edges.Contains(n)},CopyTo:function(n,t){this.edges.CopyTo(n,t)},Count$$:"System.Int32",get_Count:function(){return this.edges.get_Count()},IsReadOnly$$:"System.Boolean",get_IsReadOnly:function(){return!1},Remove:function(n){return n==null||!this.edges.Contains(n)?!1:(Microsoft.Msagl.Core.Layout.EdgeCollection.DetouchEdge(n),this.edges.Remove(n))},GetEnumerator:function(){return this.edges.GetEnumerator()}}};JsTypes.push(Microsoft$Msagl$Core$Layout$EdgeCollection);Microsoft$Msagl$Core$Layout$EdgeLabelPlacement={fullname:"Microsoft.Msagl.Core.Layout.EdgeLabelPlacement",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.MinGranularity=5;Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.MaxGranularity=50;Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.LowerEdgeBound=500;Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.UpperEdgeBound=3e3},StartIndex:function(n,t){return System.Math.Min$$Int32$$Int32(t.get_Count()-1,System.Math.Max$$Int32$$Int32(0,System.Math.Floor$$Double(t.get_Count()*n.get_PlacementOffset())|0))},CalculateCenterNotSure:function(n){for(var t=new Microsoft.Msagl.Core.Geometry.Point.ctor,u=n.get_InnerPoints().GetEnumerator(),r,i;u.MoveNext();)i=u.get_Current(),t=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,i);for(r=n.get_OuterPoints().GetEnumerator();r.MoveNext();)i=r.get_Current(),t=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,i);n.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(t,n.get_InnerPoints().get_Count()+n.get_OuterPoints().get_Count()))},GetLabelBounds:function(n,t,i,r){var u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t.Rotate(1.5707963267949).Normalize(),r),2),f=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,u),e=u.get_X()>0?f.get_X():f.get_X()-i.get_X(),o=u.get_Y()>0?f.get_Y():f.get_Y()-i.get_Y();if(System.Math.Abs$$Double(u.get_X())<.75){var s=System.Math.Acos(System.Math.Abs$$Double(u.get_Y())/u.get_Length()),h=u.get_Length()/System.Math.Sin(s),c=u.get_Length()/System.Math.Cos(s);e+=(u.get_X()>0?-1:1)*System.Math.Min$$Double$$Double(h,i.get_X()/2);o+=(u.get_Y()>0?1:-1)*c}else if(System.Math.Abs$$Double(u.get_Y())<.75){var l=System.Math.Acos(System.Math.Abs$$Double(u.get_X())/u.get_Length()),c=u.get_Length()/System.Math.Sin(l),h=u.get_Length()/System.Math.Cos(l);e+=(u.get_X()>0?1:-1)*h;o+=(u.get_Y()>0?-1:1)*System.Math.Min$$Double$$Double(c,i.get_Y()/2)}return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Point(e,o,i)},SetLabelBounds:function(n,t){var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);i.Add(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_LeftTop().get_X(),t.get_LeftTop().get_Y()));i.Add(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_RightTop().get_X(),t.get_RightTop().get_Y()));r.Add(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_LeftBottom().get_X(),t.get_LeftBottom().get_Y()));r.Add(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_RightBottom().get_X(),t.get_RightBottom().get_Y()));n.set_InnerPoints(i);n.set_OuterPoints(r)},GetPossibleSides:function(n,t){t.get_Length()==0&&(n=Microsoft.Msagl.Core.Layout.Label.PlacementSide.Any);switch(n){case Microsoft.Msagl.Core.Layout.Label.PlacementSide.Port:return new Float64Array([-1]);case Microsoft.Msagl.Core.Layout.Label.PlacementSide.Starboard:return new Float64Array([1]);case Microsoft.Msagl.Core.Layout.Label.PlacementSide.Top:return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(t.get_X(),0)?Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.GetPossibleSides(Microsoft.Msagl.Core.Layout.Label.PlacementSide.Left,t):new Float64Array([t.get_X()<0?1:-1]);case Microsoft.Msagl.Core.Layout.Label.PlacementSide.Bottom:return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(t.get_X(),0)?Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.GetPossibleSides(Microsoft.Msagl.Core.Layout.Label.PlacementSide.Right,t):new Float64Array([t.get_X()<0?-1:1]);case Microsoft.Msagl.Core.Layout.Label.PlacementSide.Left:return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(t.get_Y(),0)?Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.GetPossibleSides(Microsoft.Msagl.Core.Layout.Label.PlacementSide.Top,t):new Float64Array([t.get_Y()<0?-1:1]);case Microsoft.Msagl.Core.Layout.Label.PlacementSide.Right:return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(t.get_Y(),0)?Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.GetPossibleSides(Microsoft.Msagl.Core.Layout.Label.PlacementSide.Bottom,t):new Float64Array([t.get_Y()<0?1:-1]);default:return new Float64Array([-1,1])}},ExpandingSearch:function(n,t,i){var f=[],r,u;for(System.Diagnostics.Debug.Assert$$Boolean(n>=t),System.Diagnostics.Debug.Assert$$Boolean(n<i),System.Diagnostics.Debug.Assert$$Boolean(t<i),u=r=n+1;u>t||r<i;)u>t&&f.push(--u),r<i&&f.push(r++);return f},PointSetLength:function(n){for(var r=0,t=null,u=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.PointSet.ctor,System.Double.ctor,n,function(n){return n.Key}).GetEnumerator(),i;u.MoveNext();)i=u.get_Current(),Microsoft.Msagl.Core.Geometry.Point.op_Inequality(t,null)&&(r+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Cast(t,Microsoft.Msagl.Core.Geometry.Point.ctor),i.Center).get_Length()),t=i.Center;return r},GetSidesAndEdgeCurve:function(n,t,i,r,u){var f=t.get_Curve()!=null?t.get_Curve():new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.get_Source().get_Center(),t.get_Target().get_Center()),e=f.Derivative(i.get_Item$$Int32(r).get_Key());return u.Value=Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.GetPossibleSides(n.get_Side(),e),f},SubdivideCurveSegment:function(n,t,i,r,u){var f,o,e;n.get_Count()>64||(f=t.get_Item$$Double(r),o=t.get_Item$$Double(u),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,o).get_LengthSquared()>i?(e=(r+u)/2,Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.SubdivideCurveSegment(n,t,i,r,e),Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.SubdivideCurveSegment(n,t,i,e,u)):n.Add(new System.Collections.Generic.KeyValuePair$2.ctor$$TKey$$TValue(System.Double.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,r,f)))},CurvePoints:function(n,t){var i=new System.Collections.Generic.List$1.ctor(System.Collections.Generic.KeyValuePair$2.ctor),r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_End(),n.get_Start()).get_LengthSquared()/(t*t);return Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.SubdivideCurveSegment(i,n,r,n.get_ParStart(),n.get_ParEnd()),i.Sort$$IComparer$1(new Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.PointComparer.ctor),System.Linq.Enumerable.Last$1$$IEnumerable$1(System.Collections.Generic.KeyValuePair$2.ctor,i).get_Key()<n.get_ParEnd()&&i.Add(new System.Collections.Generic.KeyValuePair$2.ctor$$TKey$$TValue(System.Double.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_ParEnd(),n.get_End())),i}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$GeometryGraph:function(n){this.labels=null;this.obstacleMaps=new Array(3);this.labelObstacleMap=null;this.edgePoints=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Collections.Generic.List$1.ctor);this.granularity=5;this._ScaleCollisionGranularity=!1;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.InitObstacles(n);this.labels=n.CollectAllLabels()},CollisionGranularity$$:"System.Int32",get_CollisionGranularity:function(){return this.granularity},set_CollisionGranularity:function(n){this.granularity=n},ScaleCollisionGranularity$$:"System.Boolean",get_ScaleCollisionGranularity:function(){return this._ScaleCollisionGranularity},set_ScaleCollisionGranularity:function(n){this._ScaleCollisionGranularity=n},InitObstacles:function(n){var t=n.get_RootCluster().AllClustersDepthFirst();this.InitializeObstacles(System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes(),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,t,$CreateAnonymousDelegate(this,function(n){return n}))),n.get_Edges())},ctor$$GeometryGraph$$ICollection$1$Label:function(n,t){this.labels=null;this.obstacleMaps=new Array(3);this.labelObstacleMap=null;this.edgePoints=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Collections.Generic.List$1.ctor);this.granularity=5;this._ScaleCollisionGranularity=!1;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.InitObstacles(n);this.labels=t},ctor$$IEnumerable$1$Node$$IEnumerable$1$Edge:function(n,t){this.labels=null;this.obstacleMaps=new Array(3);this.labelObstacleMap=null;this.edgePoints=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Collections.Generic.List$1.ctor);this.granularity=5;this._ScaleCollisionGranularity=!1;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.InitializeObstacles(n,t);this.labels=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Label.ctor,System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.Layout.Label.ctor,t,$CreateAnonymousDelegate(this,function(n){return n.get_Labels()})))},InitializeObstacles:function(n,t){for(var e=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,t),o=this.GetModifiedGranularity(e),s=this.GetEdgeObstacles(t,o),h=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.IObstacle.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.IObstacle.ctor,System.Collections.Generic.KeyValuePair$2.ctor,s,$CreateAnonymousDelegate(this,function(n){return new System.Collections.Generic.KeyValuePair$2.ctor$$TKey$$TValue(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,Microsoft.Msagl.Core.Layout.IObstacle.ctor,n.get_Rectangle(),n)}))),r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.IObstacle.ctor),u=n.GetEnumerator(),i,f;u.MoveNext();)i=u.get_Current(),r.Add(new Microsoft.Msagl.Core.Layout.RectangleObstacle.ctor$$Rectangle$$Object(i.get_BoundingBox(),i));f=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.IObstacle.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.IObstacle.ctor,System.Collections.Generic.KeyValuePair$2.ctor,r,$CreateAnonymousDelegate(this,function(n){return new System.Collections.Generic.KeyValuePair$2.ctor$$TKey$$TValue(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,Microsoft.Msagl.Core.Layout.IObstacle.ctor,n.get_Rectangle(),n)})));this.obstacleMaps[1]=f;this.obstacleMaps[2]=h},GetEdgeObstacles:function(n,t){for(var f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.IObstacle.ctor),e=n.GetEnumerator(),i,r,u,o;e.MoveNext();){for(i=e.get_Current(),r=Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.CurvePoints(i.get_Curve()!=null?i.get_Curve():new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(i.get_Source().get_Center(),i.get_Target().get_Center()),t),this.edgePoints.set_Item$$TKey(i,r),u=r.GetEnumerator();u.MoveNext();)o=u.get_Current(),f.Add(new Microsoft.Msagl.Core.Layout.PortObstacle.ctor$$Point(o.get_Value()));this.ProgressStep()}return f},GetModifiedGranularity:function(n){var t=this.get_CollisionGranularity();return this.get_ScaleCollisionGranularity()&&(t=Microsoft.Msagl.Core.Layout.LayoutAlgorithmHelpers.LinearInterpolation(n.get_Count(),500,3e3,this.get_CollisionGranularity(),50)),t},AddLabelObstacle:function(n){this.labelObstacleMap==null?(this.labelObstacleMap=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.IObstacle.ctor,[new System.Collections.Generic.KeyValuePair$2.ctor$$TKey$$TValue(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,Microsoft.Msagl.Core.Layout.IObstacle.ctor,n.get_Rectangle(),n)]),this.obstacleMaps[0]=this.labelObstacleMap):this.labelObstacleMap.Add$$Rectangle$$TData(n.get_Rectangle(),n)},RunInternal:function(){var t=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Label.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Label.ctor,this.labels,$CreateAnonymousDelegate(this,function(n){return n!=null}))),i,n,r;for(this.StartListenToLocalProgress(t.length,1),i=System.Linq.Enumerable.ThenBy$2$$IOrderedEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Label.ctor,System.Int32.ctor,System.Linq.Enumerable.OrderByDescending$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Label.ctor,System.Double.ctor,t,$CreateAnonymousDelegate(this,function(n){return System.Math.Abs$$Double(.5-n.get_PlacementOffset())})),$CreateAnonymousDelegate(this,function(n){return this.edgePoints.get_Item$$TKey(Cast(n.get_GeometryParent(),Microsoft.Msagl.Core.Layout.Edge.ctor)).get_Count()})),n=i.GetEnumerator();n.MoveNext();)r=n.get_Current(),this.PlaceLabel(r),this.ProgressStep()},PlaceLabel:function(n){var t=!1,i,r;if(n.get_PlacementStrategyPriority()!=null)for(i=n.get_PlacementStrategyPriority().GetEnumerator();i.MoveNext();)if(r=i.get_Current(),t=r==Microsoft.Msagl.Core.Layout.Label.PlacementStrategy.AlongCurve&&this.PlaceEdgeLabelOnCurve(n)||r==Microsoft.Msagl.Core.Layout.Label.PlacementStrategy.Horizontal&&this.PlaceEdgeLabelHorizontally(n),t)break;t?Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.CalculateCenterNotSure(n):this.PlaceLabelAtFirstPosition(n)},PlaceLabelAtFirstPosition:function(n){var t=Cast(n.get_GeometryParent(),Microsoft.Msagl.Core.Layout.Edge.ctor),f=t.get_Curve()!=null?t.get_Curve():new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.get_Source().get_Center(),t.get_Target().get_Center()),r=this.edgePoints.get_Item$$TKey(t),u=Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.StartIndex(n,r),e=r.get_Item$$Int32(u).get_Value(),i=f.Derivative(r.get_Item$$Int32(u).get_Key());i.get_Length()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()&&(i=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1,1));var o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_Width(),n.get_Height()),s=System.Linq.Enumerable.First$1$$IEnumerable$1(System.Double.ctor,Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.GetPossibleSides(n.get_Side(),i)),h=Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.GetLabelBounds(e,i,o,s);Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.SetLabelBounds(n,h)},PlaceEdgeLabelHorizontally:function(n){var i,s,h,v;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"label");i=Cast(n.get_GeometryParent(),Microsoft.Msagl.Core.Layout.Edge.ctor);n.set_InnerPoints(null);for(var u=this.edgePoints.get_Item$$TKey(i),y=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_Width(),n.get_Height()),t=-1,f=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor,c=Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.ExpandingSearch(Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.StartIndex(n,u),0,u.get_Count()).GetEnumerator();c.MoveNext();){var p=c.get_Current(),l=u.get_Item$$Int32(p),w=i.get_Curve()!=null?i.get_Curve():new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(i.get_Source().get_Center(),i.get_Target().get_Center()),e=w.Derivative(l.get_Key());if(!(e.get_LengthSquared()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)){for(var r=0,o=Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.GetPossibleSides(n.get_Side(),e),b=o.length,a=o[r];r<b;r++,a=o[r])if(s=Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.GetLabelBounds(l.get_Value(),e,y,a),h=this.ConflictIndex$$Rectangle$$Label(s,n),h>t&&(t=h,f=s,t==2147483647))break;if(t==2147483647)break}}return t>=0?(Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.SetLabelBounds(n,f),v=new Microsoft.Msagl.Core.Layout.RectangleObstacle.ctor$$Rectangle(f),this.AddLabelObstacle(v),t==0?n.set_PlacementResult(Microsoft.Msagl.Core.Layout.LabelPlacementResult.OverlapsOtherLabels):t==1?n.set_PlacementResult(Microsoft.Msagl.Core.Layout.LabelPlacementResult.OverlapsNodes):t==2?n.set_PlacementResult(Microsoft.Msagl.Core.Layout.LabelPlacementResult.OverlapsEdges):n.set_PlacementResult(Microsoft.Msagl.Core.Layout.LabelPlacementResult.OverlapsNothing),!0):!1},PlaceEdgeLabelOnCurve:function(n){var f,s,t,a,h,i;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"label");f=Cast(n.get_GeometryParent(),Microsoft.Msagl.Core.Layout.Edge.ctor);n.set_InnerPoints(null);for(var r=this.edgePoints.get_Item$$TKey(f),y=3,e=n.get_Height()/2,c=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,e),o=n.get_Width(),l=Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.ExpandingSearch(Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.StartIndex(n,r),0,r.get_Count()).GetEnumerator();l.MoveNext();){s=l.get_Current();a=function(){var i={Value:t},u=Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.GetSidesAndEdgeCurve(n,f,r,s,i);return t=i.Value,u}.call(this);for(var u=0,p=t.length,v=t[u];u<p;u++,v=t[u])if(h=new Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.PointSetList.ctor,i=0,function(){var n={Value:i},t=this.ProcessExpandingSearchOnSide(s,r,a,v,e,y,c,n,h,o);return i=n.Value,t}.call(this),i>=o)return this.CaseOfCoveredLengthGreaterThanLabelLength(n,h,i,o,c),!0}return!1},CaseOfCoveredLengthGreaterThanLabelLength:function(n,t,i,r,u){var a=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),v=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),f=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.PointSet.ctor,t.Points),h=i-r,c,y;if(h>0){var e=f.get_Item$$Int32(f.get_Count()-1),o=f.get_Item$$Int32(f.get_Count()-2),l=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e.Center,o.Center),s=l.get_Length();h>s&&(e=f.get_Item$$Int32(0),o=f.get_Item$$Int32(1),l=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e.Center,o.Center),s=l.get_Length());System.Diagnostics.Debug.Assert$$Boolean(s>h);c=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(l,(s-h)/s);System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Double(s-c.get_Length()-h)<.01);e.Center=Microsoft.Msagl.Core.Geometry.Point.op_Addition(o.Center,c);e.Inner=Microsoft.Msagl.Core.Geometry.Point.op_Addition(o.Inner,c);e.Outer=Microsoft.Msagl.Core.Geometry.Point.op_Addition(o.Outer,c)}y=Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.PointSetLength(f);System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Double(y-r)<.01);this.GoOverOrderedPointsAndAddLabelObstacels(f,a,v,u);n.set_InnerPoints(a);n.set_OuterPoints(v)},GoOverOrderedPointsAndAddLabelObstacels:function(n,t,i,r){for(var e=n.GetEnumerator(),u,f,o;e.MoveNext();)u=e.get_Current(),f=u.Center,t.Add(u.Inner),i.Add(u.Outer),o=new Microsoft.Msagl.Core.Layout.RectangleObstacle.ctor$$Rectangle(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(f,r),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,r))),this.AddLabelObstacle(o)},ProcessExpandingSearchOnSide:function(n,t,i,r,u,f,e,o,s,h){for(var y=Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.ExpandingSearch(n,0,t.get_Count()).GetEnumerator(),l,a,v;y.MoveNext();){var p=y.get_Current(),c=t.get_Item$$Int32(p),w=i.Derivative(c.get_Key());if(!(w.get_LengthSquared()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon))if(l=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(w.Rotate(1.5707963267949).Normalize(),r),a=Microsoft.Msagl.Core.Geometry.Point.op_Addition(c.get_Value(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(u+f,l)),this.Conflict(a,u,e))break;else if(v=function(){var n=new Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.PointSet.ctor;return n.Key=c.get_Key(),n.Center=a,n.Inner=Microsoft.Msagl.Core.Geometry.Point.op_Addition(c.get_Value(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(f,l)),n.Outer=Microsoft.Msagl.Core.Geometry.Point.op_Addition(c.get_Value(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(2*u+f,l)),n}.call(this),o.Value=p<=n?s.AddFirst(v):s.AddLast(v),System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Double(Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.PointSetLength(s.Points)-o.Value)<.01),o.Value>=h)break}},Conflict:function(n,t,i){return this.ConflictIndex$$Point$$Double$$Point(n,t,i)!=2147483647},ConflictIndex$$Point$$Double$$Point:function(n,t,i){for(var o=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,i),Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,i)),s=t*t,r=0;r<this.obstacleMaps.length;r++)if(this.obstacleMaps[r]!=null)for(var u=0,f=this.obstacleMaps[r].GetAllIntersecting(o),h=f.length,e=f[u];u<h;u++,e=f[u])if(Is(e,Microsoft.Msagl.Core.Layout.PortObstacle.ctor)){if(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,Cast(e,Microsoft.Msagl.Core.Layout.PortObstacle.ctor).Location).get_LengthSquared()<s)return r}else return r;return 2147483647},ConflictIndex$$Rectangle$$Label:function(n,t){for(var e,u,o=Cast(t.get_GeometryParent(),Microsoft.Msagl.Core.Layout.Edge.ctor),h=o.get_Source(),c=o.get_Target(),i=0;i<this.obstacleMaps.length;i++)if(this.obstacleMaps[i]!=null)for(var r=0,f=this.obstacleMaps[i].GetAllIntersecting(n),l=f.length,s=f[r];r<l;r++,s=f[r])if(i!=1||(e=As(s,Microsoft.Msagl.Core.Layout.RectangleObstacle.ctor),e==null||(u=As(e.get_Data(),Microsoft.Msagl.Core.Layout.Cluster.ctor),u==null||!(h.IsDescendantOf(u)||c.IsDescendantOf(u)))))return i;return 2147483647}}};JsTypes.push(Microsoft$Msagl$Core$Layout$EdgeLabelPlacement);Microsoft$Msagl$Core$Layout$HookUpAnywhereFromInsidePort={fullname:"Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort",baseTypeName:"Microsoft.Msagl.Core.Layout.Port",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Func$1$ICurve$$Double:function(n,t){this.curve=null;this.adjustmentAngle=.314159265358979;this.location=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.hookSize=9;this._LoosePolyline=null;Microsoft.Msagl.Core.Layout.Port.ctor.call(this);this.curve=n;this.set_HookSize(t)},ctor$$Func$1$ICurve:function(n){this.curve=null;this.adjustmentAngle=.314159265358979;this.location=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.hookSize=9;this._LoosePolyline=null;Microsoft.Msagl.Core.Layout.Port.ctor.call(this);Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"boundaryCurve");this.curve=n;this.location=this.curve().get_Start()},Location$$:"Microsoft.Msagl.Core.Geometry.Point",get_Location:function(){return this.location},Curve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Curve:function(){return this.curve()},set_Curve:function(){throw $CreateException(new System.InvalidCastException.ctor,new Error);},SetLocation:function(n){this.location=n.Clone()},LoosePolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_LoosePolyline:function(){return this._LoosePolyline},set_LoosePolyline:function(n){this._LoosePolyline=n},AdjustmentAngle$$:"System.Double",get_AdjustmentAngle:function(){return this.adjustmentAngle},set_AdjustmentAngle:function(n){this.adjustmentAngle=n},HookSize$$:"System.Double",get_HookSize:function(){return this.hookSize},set_HookSize:function(n){this.hookSize=n}}};JsTypes.push(Microsoft$Msagl$Core$Layout$HookUpAnywhereFromInsidePort);Microsoft$Msagl$Core$Layout$IdealEdgeLengthSettings={fullname:"Microsoft.Msagl.Core.Layout.IdealEdgeLengthSettings",baseTypeName:"System.ValueType",assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor:function(){this.constrainedEdgeSeparation=0;this._DefaultLength=0;this._ProportionalToSymmetricDifference=!1;this._ProportionalEdgeLengthAdjustment=0;this._ProportionalEdgeLengthOffset=0;this._EdgeDirectionConstraints=Microsoft.Msagl.Core.Geometry.Directions.None;System.ValueType.ctor.call(this)},DefaultLength$$:"System.Double",get_DefaultLength:function(){return this._DefaultLength},set_DefaultLength:function(n){this._DefaultLength=n},ProportionalToSymmetricDifference$$:"System.Boolean",get_ProportionalToSymmetricDifference:function(){return this._ProportionalToSymmetricDifference},set_ProportionalToSymmetricDifference:function(n){this._ProportionalToSymmetricDifference=n},ProportionalEdgeLengthAdjustment$$:"System.Double",get_ProportionalEdgeLengthAdjustment:function(){return this._ProportionalEdgeLengthAdjustment},set_ProportionalEdgeLengthAdjustment:function(n){this._ProportionalEdgeLengthAdjustment=n},ProportionalEdgeLengthOffset$$:"System.Double",get_ProportionalEdgeLengthOffset:function(){return this._ProportionalEdgeLengthOffset},set_ProportionalEdgeLengthOffset:function(n){this._ProportionalEdgeLengthOffset=n},EdgeDirectionConstraints$$:"Microsoft.Msagl.Core.Geometry.Directions",get_EdgeDirectionConstraints:function(){return this._EdgeDirectionConstraints},set_EdgeDirectionConstraints:function(n){this._EdgeDirectionConstraints=n},ConstrainedEdgeSeparation$$:"System.Double",get_ConstrainedEdgeSeparation:function(){return this.constrainedEdgeSeparation},set_ConstrainedEdgeSeparation:function(n){this.constrainedEdgeSeparation=n}}};JsTypes.push(Microsoft$Msagl$Core$Layout$IdealEdgeLengthSettings);Microsoft$Msagl$Core$Layout$IObstacle={fullname:"Microsoft.Msagl.Core.Layout.IObstacle",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Core$Layout$IObstacle);Microsoft$Msagl$Core$Layout$IsOpenChangeEventArgs={fullname:"Microsoft.Msagl.Core.Layout.IsOpenChangeEventArgs",baseTypeName:"System.EventArgs",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.PreviousValue=!1;System.EventArgs.ctor.call(this);this.PreviousValue=n}}};JsTypes.push(Microsoft$Msagl$Core$Layout$IsOpenChangeEventArgs);Microsoft$Msagl$Core$Layout$LabelPlacementResult={fullname:"Microsoft.Msagl.Core.Layout.LabelPlacementResult",staticDefinition:{OverlapsOtherLabels:0,OverlapsNodes:1,OverlapsEdges:2,OverlapsNothing:2147483647},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Layout$LabelPlacementResult);Microsoft$Msagl$Core$Layout$LgInfoBase={fullname:"Microsoft.Msagl.Core.Layout.LgInfoBase",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._slidingZoomLevel=Infinity;this._zoomLevel=Infinity;this._rank=0;System.Object.ctor.call(this)},SlidingZoomLevel$$:"System.Double",get_SlidingZoomLevel:function(){return this._slidingZoomLevel},set_SlidingZoomLevel:function(n){this._slidingZoomLevel=n},ZoomLevel$$:"System.Double",get_ZoomLevel:function(){return System.Math.Min$$Double$$Double(this._zoomLevel,this.get_SlidingZoomLevel())},set_ZoomLevel:function(n){this._zoomLevel=n},Rank$$:"System.Double",get_Rank:function(){return this._rank},set_Rank:function(n){this._rank=n},ZoomLevelIsNotSet$$:"System.Boolean",get_ZoomLevelIsNotSet:function(){return this.get_ZoomLevel()==Infinity}}};JsTypes.push(Microsoft$Msagl$Core$Layout$LgInfoBase);Microsoft$Msagl$Core$Layout$LgNodeInfo={fullname:"Microsoft.Msagl.Core.Layout.LgNodeInfo",baseTypeName:"Microsoft.Msagl.Core.Layout.LgInfoBase",staticDefinition:{GetLabelOffset:function(n){switch(n){case Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Top:return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,.5);case Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Bottom:return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,-.5);case Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Left:return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-.5,0);default:return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(.5,0)}}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.Processed=!1;this.PartiteSet=0;this.Selected=!1;this.SelectedNeighbor=0;this.LabelVisibleFromScale=0;this.LabelWidthToHeightRatio=1;this.LabelPosition=Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Top;this.Color=null;this._GeometryNode=null;this._BoundaryOnLayer=null;Microsoft.Msagl.Core.Layout.LgInfoBase.ctor.call(this);this.set_GeometryNode(n)},GeometryNode$$:"Microsoft.Msagl.Core.Layout.Node",get_GeometryNode:function(){return this._GeometryNode},set_GeometryNode:function(n){this._GeometryNode=n},BoundaryCurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_BoundaryCurve:function(){return this.get_BoundaryOnLayer()},Center$$:"Microsoft.Msagl.Core.Geometry.Point",get_Center:function(){return this.get_GeometryNode().get_Center()},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){return this.get_BoundaryOnLayer().get_BoundingBox()},toString:function(){return this.get_GeometryNode().toString()},LabelOffset$$:"Microsoft.Msagl.Core.Geometry.Point",get_LabelOffset:function(){switch(this.LabelPosition){case Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Top:return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,.5);case Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Bottom:return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,-.5);case Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Left:return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-.5,0);default:return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(.5,0)}},set_LabelOffset:function(n){this.LabelPosition=System.Math.Abs$$Double(n.get_X())<.1&&n.get_Y()>.4?Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Top:System.Math.Abs$$Double(n.get_X())<.1&&n.get_Y()<-.4?Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Bottom:System.Math.Abs$$Double(n.get_Y())<.1&&n.get_X()>.4?Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Right:Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Left},BoundaryOnLayer$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_BoundaryOnLayer:function(){return this._BoundaryOnLayer},set_BoundaryOnLayer:function(n){this._BoundaryOnLayer=n},Translate:function(n){this.get_GeometryNode().set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_GeometryNode().get_Center(),n));this.get_BoundaryOnLayer().Translate(n)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$LgNodeInfo);Microsoft$Msagl$Core$Layout$LayoutAlgorithmHelpers={fullname:"Microsoft.Msagl.Core.Layout.LayoutAlgorithmHelpers",baseTypeName:"System.Object",staticDefinition:{LinearInterpolation:function(n,t,i,r,u){if(n<t)return r;if(n>i)return u;var f=(n-t)/(i-t);return r+f*(u-r)|0},NegativeLinearInterpolation:function(n,t,i,r,u){if(n<t)return u;if(n>i)return r;var f=(n-t)/(i-t);return r+(1-f)*(u-r)|0},ComputeDesiredEdgeLengths:function(n,t){var r,i;if(t!=null){for(r=t.get_Edges().GetEnumerator();r.MoveNext();)i=r.get_Current(),i.set_SourcePort(null),i.set_TargetPort(null),i.set_Length(System.Math.Max$$Double$$Double(n.get_DefaultLength(),System.Math.Sqrt(2*System.Math.Min$$Double$$Double(i.get_Source().get_BoundingBox().get_Width()*i.get_Source().get_BoundingBox().get_Height(),i.get_Target().get_BoundingBox().get_Width()*i.get_Target().get_BoundingBox().get_Height()))));n.get_ProportionalToSymmetricDifference()&&Microsoft.Msagl.Core.Layout.LayoutAlgorithmHelpers.SetEdgeLengthsProportionalToSymmetricDifference(t,n.get_ProportionalEdgeLengthOffset(),n.get_ProportionalEdgeLengthAdjustment())}},SetEdgeLengthsProportionalToSymmetricDifference:function(n,t,i){var f,e,o,s,r;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"graph"),f=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor),e=n.get_Nodes().GetEnumerator();e.MoveNext();){for(var u=e.get_Current(),c=function(n){return f.set_Item$$TKey(u,n),n}(new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor)),l=u.get_OutEdges().GetEnumerator();l.MoveNext();)r=l.get_Current(),Is(r.get_Target(),Microsoft.Msagl.Core.Layout.Cluster.ctor)||c.Insert(r.get_Target());for(o=u.get_InEdges().GetEnumerator();o.MoveNext();)r=o.get_Current(),Is(r.get_Source(),Microsoft.Msagl.Core.Layout.Cluster.ctor)||c.Insert(r.get_Source())}for(s=n.get_Edges().GetEnumerator();s.MoveNext();)if(r=s.get_Current(),!(Is(r.get_Source(),Microsoft.Msagl.Core.Layout.Cluster.ctor)||Is(r.get_Target(),Microsoft.Msagl.Core.Layout.Cluster.ctor))){var u=f.get_Item$$TKey(r.get_Source()),a=f.get_Item$$TKey(r.get_Target()),h=System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,System.Linq.Enumerable.Union$1$$IEnumerable$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,u,a))-System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,System.Linq.Enumerable.Intersect$1$$IEnumerable$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,u,a));h=System.Math.Min$$Double$$Double(30,h);r.set_Length(r.get_Length()*t+h*i)}}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$LayoutAlgorithmHelpers);Microsoft$Msagl$Core$Layout$LayoutChangeEventArgs={fullname:"Microsoft.Msagl.Core.Layout.LayoutChangeEventArgs",baseTypeName:"System.EventArgs",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.DataBeforeChange=null;this.DataAfterChange=null;System.EventArgs.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$LayoutChangeEventArgs);Microsoft$Msagl$Core$Layout$LgNodeInfoKind={fullname:"Microsoft.Msagl.Core.Layout.LgNodeInfoKind",staticDefinition:{OutOfView:0,FullyVisible:1,Satellite:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Layout$LgNodeInfoKind);Microsoft$Msagl$Core$Layout$NodeCollection={fullname:"Microsoft.Msagl.Core.Layout.NodeCollection",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IList$1"],Kind:"Class",definition:{ctor:function(n){this.nodes=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor);this.graph=null;System.Object.ctor.call(this);this.graph=n},Add:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"node");this.nodes.Add(n);n.set_GeometryParent(this.graph)},Clear:function(){this.nodes.Clear()},Contains:function(n){return this.nodes.Contains(n)},CopyTo:function(n,t){this.nodes.CopyTo$$T$Array$$Int32(n,t)},Count$$:"System.Int32",get_Count:function(){return this.nodes.get_Count()},IsReadOnly$$:"System.Boolean",get_IsReadOnly:function(){return!1},Remove:function(n){return n==null?!1:(this.DetouchNode(n),this.nodes.Remove(n))},DetouchNode:function(n){for(var i=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_Edges()),t=0,u=i.length,r=i[t];t<u;t++,r=i[t])this.graph.get_Edges().Remove(r);n.set_GeometryParent(null)},GetEnumerator:function(){return this.nodes.GetEnumerator()},IndexOf:function(n){return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"item"),this.nodes.IndexOf$$T(n)},Insert:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"item");this.nodes.Insert(n,t)},RemoveAt:function(n){var t=this.nodes.get_Item$$Int32(n);this.DetouchNode(t);this.nodes.RemoveAt(n)},Item$$:"Microsoft.Msagl.Core.Layout.Node",get_Item$$Int32:function(n){return this.nodes.get_Item$$Int32(n)},set_Item$$Int32:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"value");var i=this.nodes.get_Item$$Int32(n);i!=t&&(this.DetouchNode(i),t.set_GeometryParent(this.graph),this.nodes.set_Item$$Int32(n,t))}}};JsTypes.push(Microsoft$Msagl$Core$Layout$NodeCollection);Microsoft$Msagl$Core$Layout$PackingMethod={fullname:"Microsoft.Msagl.Core.Layout.PackingMethod",staticDefinition:{Compact:0,Columns:1},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Layout$PackingMethod);Microsoft$Msagl$Core$Layout$PortObstacle={fullname:"Microsoft.Msagl.Core.Layout.PortObstacle",baseTypeName:"System.ValueType",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Layout.IObstacle"],Kind:"Struct",definition:{ctor$$Point:function(n){this.Location=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.ValueType.ctor.call(this);this.Location=n},Rectangle$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_Rectangle:function(){return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(this.Location)},ctor:function(){this.Location=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$PortObstacle);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ConjugateGradient$SparseMatrix={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix",baseTypeName:"System.Object",staticDefinition:{op_Multiply$$SparseMatrix$$Vector:function(n,t){var u,i,f,e,r,o;if(t.array.length<n.get_NumCol())throw $CreateException(new System.ArgumentException.ctor$$String("vector must have as many entries as the matrix has columns"),new Error);for(u=new Float64Array(n.get_NumRow()),i=0;i<n.get_NumRow();i++)for(f=n.row_ptr[i],e=n.row_ptr[i+1],r=f;r<e;r++)o=n.col_ind[r],u[i]+=t.array[o]*n.values[r];return new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(u)},op_Multiply$$SparseMatrix$$Double$Array:function(n,t){return Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix.op_Multiply$$SparseMatrix$$Vector(n,new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(t)).array}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Double$Array$$Int32$Array$$Int32$Array$$Int32:function(n,t,i,r){this.values=null;this.col_ind=null;this.row_ptr=null;this.numRow=0;this._NumCol=0;System.Object.ctor.call(this);this.values=n;this.col_ind=t;this.row_ptr=i;this.set_NumCol(r)},Values:function(){return this.values},ColInd:function(){return this.col_ind},RowPtr:function(){return this.row_ptr},NumRow$$:"System.Int32",get_NumRow:function(){return this.numRow},set_NumRow:function(n){this.numRow=n},NumCol$$:"System.Int32",get_NumCol:function(){return this._NumCol},set_NumCol:function(n){this._NumCol=n},ctor$$Int32$$Int32$$Int32:function(n,t,i){this.values=null;this.col_ind=null;this.row_ptr=null;this.numRow=0;this._NumCol=0;System.Object.ctor.call(this);this.values=new Float64Array(n);this.col_ind=new Int32Array(n);this.row_ptr=new Int32Array(t+1);this.set_NumRow(t);this.set_NumCol(i)},DiagonalPreconditioner:function(){for(var r,u,t,f,i=new Float64Array(this.get_NumRow()),n=0;n<this.get_NumRow();n++)for(r=this.row_ptr[n],u=this.row_ptr[n+1],t=r;t<u;t++)f=this.col_ind[t],n==f&&this.values[t]!=0&&(i[n]=1/this.values[t]);return new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(i)},GetFullMatrix:function(){throw $CreateException(new System.NotSupportedException.ctor$$String("Multi-dimensional arrays are not supported"),new Error);},PrintMatrix:function(){for(var n,t=this.GetFullMatrix(),r=t.GetLength(0),u=t.GetLength(1),i=0;i<r;i++){for(n=0;n<u;n++)System.Console.Write$$String(System.String.Format$$String$$Object("{0} \t",t[(i,n)].ToString$$String("0.00")));System.Console.Write$$String(System.Environment.get_NewLine()+System.Environment.get_NewLine())}}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ConjugateGradient$SparseMatrix);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ConjugateGradient$LinearSystemSolver={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.LinearSystemSolver",baseTypeName:"System.Object",staticDefinition:{SolveConjugateGradient$$SparseMatrix$$Vector$$Vector$$Int32$$Double:function(n,t,i,r,u){for(var f=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Subtraction(t,Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix.op_Multiply$$SparseMatrix$$Vector(n,i)),o=f.Clone(),e=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Vector$$Vector(f,f),s=System.Math.Sqrt(e)/n.get_NumRow(),v=s,y=0,h,c,l,a;y++<r&&s>u*v;)h=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix.op_Multiply$$SparseMatrix$$Vector(n,o),c=e/Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Vector$$Vector(o,h),i.Add(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Double$$Vector(c,o)),f.Sub(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Double$$Vector(c,h)),l=e,e=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Vector$$Vector(f,f),s=System.Math.Sqrt(e)/n.get_NumRow(),a=e/l,o=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Addition(f,Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Double$$Vector(a,o));return i},SolvePrecondConjugateGradient$$SparseMatrix$$Vector$$Vector$$Int32$$Double:function(n,t,i,r,u){for(var a=n.DiagonalPreconditioner(),f=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Subtraction(t,Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix.op_Multiply$$SparseMatrix$$Vector(n,i)),e=a.CompProduct(f),o=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Vector$$Vector(f,e),s=System.Math.Sqrt(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Vector$$Vector(f,f))/n.get_NumRow(),p=s,w=0,h,c,l,v,y;w++<r&&s>u*p;)h=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix.op_Multiply$$SparseMatrix$$Vector(n,e),c=o/Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Vector$$Vector(e,h),i.Add(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Double$$Vector(c,e)),f.Sub(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Double$$Vector(c,h)),l=a.CompProduct(f),v=o,s=System.Math.Sqrt(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Vector$$Vector(f,f))/n.get_NumRow(),o=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Vector$$Vector(f,l),y=o/v,e=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Addition(l,Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.op_Multiply$$Double$$Vector(y,e));return i},SolveConjugateGradient$$SparseMatrix$$Double$Array$$Double$Array$$Int32$$Double:function(n,t,i,r,u){return Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.LinearSystemSolver.SolveConjugateGradient$$SparseMatrix$$Vector$$Vector$$Int32$$Double(n,new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(t),new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(i.Clone()instanceof Float64Array||i.Clone()==null?i.Clone():function(){throw new Error("InvalidCastException");}()),r,u).array},SolvePrecondConjugateGradient$$SparseMatrix$$Double$Array$$Double$Array$$Int32$$Double:function(n,t,i,r,u){return Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.LinearSystemSolver.SolvePrecondConjugateGradient$$SparseMatrix$$Vector$$Vector$$Int32$$Double(n,new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(t),new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(i.Clone()instanceof Float64Array||i.Clone()==null?i.Clone():function(){throw new Error("InvalidCastException");}()),r,u).array},TestConjugateGradientMethod:function(){var u=new Float64Array([4,1,1,3]),f=new Int32Array([0,1,0,1]),e=new Int32Array([0,2,4]),t=new Float64Array([1,2]),i=new Float64Array([2,1]),r=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix.ctor$$Double$Array$$Int32$Array$$Int32$Array$$Int32(u,f,e,2),n=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.LinearSystemSolver.SolveConjugateGradient$$SparseMatrix$$Double$Array$$Double$Array$$Int32$$Double(r,t,i,1e3,.0001);System.Console.WriteLine$$String$$Object$$Object("Solution: x: {0}, y={1}",n[0],n[1]);n=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.LinearSystemSolver.SolvePrecondConjugateGradient$$SparseMatrix$$Double$Array$$Double$Array$$Int32$$Double(r,t,i,1e3,.0001);System.Console.WriteLine$$String$$Object$$Object("SolutionPreconditioned: x: {0}, y={1}",n[0],n[1])},TestConjugateGradientMethod2:function(){var t=new Float64Array([4,1,1,16,1,1,64,1,1,256,1,1,1024,1,1,4096,1,1,16384,1,1,65536,1,1,262144,1,1,1048576]),i=new Int32Array([0,1,0,1,2,1,2,3,2,3,4,3,4,5,4,5,6,5,6,7,6,7,8,7,8,9,8,9]),n=new Int32Array([0,2,5,8,11,14,17,20,23,26,28]),r=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix.ctor$$Double$Array$$Int32$Array$$Int32$Array$$Int32(t,i,n,n.length-1),u=new Float64Array([5,18,66,258,1026,4098,16386,65538,262146,1048577]),f=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.LinearSystemSolver.SolvePrecondConjugateGradient$$SparseMatrix$$Double$Array$$Double$Array$$Int32$$Double(r,u,new Float64Array(10),1e3,1e-6),e=System.Linq.Enumerable.Aggregate$2$$IEnumerable$1$$TAccumulate$$Func$3(System.Double.ctor,System.String.ctor,f,"",function(n,t){return System.String.Format$$String$$Object$$Object("{0},\t{1}",n,t)});System.Console.WriteLine$$String(e)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ConjugateGradient$LinearSystemSolver);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ConjugateGradient$Vector={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector",baseTypeName:"System.Object",staticDefinition:{op_Subtraction:function(n,t){for(var r=new Float64Array(n.array.length),i=0;i<n.array.length;i++)r[i]=n.array[i]-t.array[i];return new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(r)},op_Addition:function(n,t){for(var r=new Float64Array(n.array.length),i=0;i<n.array.length;i++)r[i]=n.array[i]+t.array[i];return new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(r)},op_Multiply$$Vector$$Vector:function(n,t){for(var r=0,i=0;i<n.array.length;i++)r+=n.array[i]*t.array[i];return r},op_Multiply$$Double$$Vector:function(n,t){for(var r=new Float64Array(t.array.length),i=0;i<t.array.length;i++)r[i]=t.array[i]*n;return new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(r)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.array=null;System.Object.ctor.call(this);this.array=n},Sub:function(n){for(var t=0;t<this.array.length;t++)this.array[t]-=n.array[t]},Add:function(n){for(var t=0;t<this.array.length;t++)this.array[t]+=n.array[t]},Clone:function(){return new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(this.array.Clone()instanceof Float64Array||this.array.Clone()==null?this.array.Clone():function(){throw new Error("InvalidCastException");}())},CompProduct:function(n){for(var i=new Float64Array(this.array.length),t=0;t<this.array.length;t++)i[t]=this.array[t]*n.array[t];return new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.Vector.ctor(i)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ConjugateGradient$Vector);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$IOverlapRemoval={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.IOverlapRemoval",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$IOverlapRemoval);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$MstLineSweeper={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.MstLineSweeper",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this._proximityEdges=null;this._nodeSizes=null;this._nodePositions=null;this._forLayers=!1;this._intervalTree=null;this._q=null;this._numberOfOverlaps=0;System.Object.ctor.call(this);this._proximityEdges=n;this._nodeSizes=t;this._nodePositions=i;this._forLayers=r;System.Diagnostics.Debug.Assert$$Boolean(i.length==t.length);this._q=new Microsoft.Msagl.Core.DataStructures.BinaryHeapPriorityQueue.ctor(t.length*2)},Run:function(){return this.InitQueue(),this.FindOverlaps(),this._numberOfOverlaps},FindOverlaps:function(){while(this._q.get_Count()>0){var n=this._q.Dequeue();n<this._nodePositions.length?(this.FindOverlapsWithInterval(n),this.AddIntervalToTree(n)):(n-=this._nodePositions.length,this.RemoveIntervalFromTree(n))}},RemoveIntervalFromTree:function(n){this._intervalTree.Remove(this.GetInterval(n),n)},AddIntervalToTree:function(n){var t=this.GetInterval(n);this._intervalTree==null&&(this._intervalTree=new Microsoft.Msagl.Core.Geometry.IntervalRTree$1.ctor(System.Int32.ctor));this._intervalTree.Add$$Interval$$TData(t,n)},FindOverlapsWithInterval:function(n){var u,t,i,r;if(this._intervalTree!=null)for(u=this.GetInterval(n),t=this._intervalTree.GetAllIntersecting(u).GetEnumerator();t.MoveNext();){if(i=t.get_Current(),r=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.GetIdealEdgeLength$$Int32$$Int32$$Point$$Point$$Size$Array$$Boolean(n,i,this._nodePositions[n],this._nodePositions[i],this._nodeSizes,this._forLayers),!(r.get_Item3()>1))return;this._proximityEdges.Add(r);this._numberOfOverlaps++}},GetInterval:function(n){var t=this._nodeSizes[n].get_Width()/2,i=this._nodePositions[n].get_X();return new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Double$$Double(i-t,i+t)},InitQueue:function(){for(var t,i,n=0;n<this._nodeSizes.length;n++)t=this._nodeSizes[n].get_Height()/2,i=this._nodePositions[n].get_Y(),this._q.Enqueue(n,i-t),this._q.Enqueue(this._nodeSizes.length+n,i+t)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$MstLineSweeper);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$OverlapRemovalSettings={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.OverlapRemovalSettings",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.method=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.OverlapRemovalMethod.MinimalSpanningTree;this.epsilon=.01;this.iterationsMax=1e3;this.stopOnMaxIterat=!1;this.nodeSeparation=4;this.randomizationSeed=1;this.workInInches=!1;this.randomizeAllPointsOnStart=!1;this._StressSettings=null;System.Object.ctor.call(this);this.set_StressSettings(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.StressMajorizationSettings.ctor)},StressSettings$$:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.StressMajorizationSettings",get_StressSettings:function(){return this._StressSettings},set_StressSettings:function(n){this._StressSettings=n},StopOnMaxIterat$$:"System.Boolean",get_StopOnMaxIterat:function(){return this.stopOnMaxIterat},set_StopOnMaxIterat:function(n){this.stopOnMaxIterat=n},Epsilon$$:"System.Double",get_Epsilon:function(){return this.epsilon},set_Epsilon:function(n){this.epsilon=n},IterationsMax$$:"System.Int32",get_IterationsMax:function(){return this.iterationsMax},set_IterationsMax:function(n){this.iterationsMax=n},NodeSeparation$$:"System.Double",get_NodeSeparation:function(){return this.nodeSeparation},set_NodeSeparation:function(n){this.nodeSeparation=n},RandomizationSeed$$:"System.Int32",get_RandomizationSeed:function(){return this.randomizationSeed},set_RandomizationSeed:function(n){this.randomizationSeed=n},RandomizeAllPointsOnStart$$:"System.Boolean",get_RandomizeAllPointsOnStart:function(){return this.randomizeAllPointsOnStart},set_RandomizeAllPointsOnStart:function(n){this.randomizeAllPointsOnStart=n},WorkInInches$$:"System.Boolean",get_WorkInInches:function(){return this.workInInches},set_WorkInInches:function(n){this.workInInches=n},Method$$:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.OverlapRemovalMethod",get_Method:function(){return this.method},set_Method:function(n){this.method=n},Clone:function(){var n=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.OverlapRemovalSettings.ctor;return n.set_Method(this.get_Method()),n.set_Epsilon(this.get_Epsilon()),n.set_IterationsMax(this.get_IterationsMax()),n.set_StopOnMaxIterat(this.get_StopOnMaxIterat()),n.set_NodeSeparation(this.get_NodeSeparation()),n.set_RandomizationSeed(this.get_RandomizationSeed()),n.set_RandomizeAllPointsOnStart(this.randomizeAllPointsOnStart),n.set_WorkInInches(this.get_WorkInInches()),n.set_StressSettings(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.StressMajorizationSettings.ctor),n.get_StressSettings().set_MaxStressIterations(this.get_StressSettings().get_MaxStressIterations()),n.get_StressSettings().set_SolvingMethod(this.get_StressSettings().get_SolvingMethod()),n.get_StressSettings().set_UpdateMethod(this.get_StressSettings().get_UpdateMethod()),n.get_StressSettings().set_StressChangeTolerance(this.get_StressSettings().get_StressChangeTolerance()),n.get_StressSettings().set_CancelOnStressConvergence(this.get_StressSettings().get_CancelOnStressConvergence()),n.get_StressSettings().set_CancelOnStressMaxIteration(this.get_StressSettings().get_CancelOnStressMaxIteration()),n.get_StressSettings().set_ResidualTolerance(this.get_StressSettings().get_ResidualTolerance()),n.get_StressSettings().set_CancelAfterFirstConjugate(this.get_StressSettings().get_CancelAfterFirstConjugate()),n.get_StressSettings().set_MaxSolverIterations(this.get_StressSettings().get_MaxSolverIterations()),n.get_StressSettings().set_SolverMaxIteratMethod(this.get_StressSettings().get_SolverMaxIteratMethod()),n.get_StressSettings().set_Parallelize(this.get_StressSettings().get_Parallelize()),n.get_StressSettings().set_ParallelDegree(this.get_StressSettings().get_ParallelDegree()),n}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$OverlapRemovalSettings);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ProximityOverlapRemoval={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval._DebugMode=!1},DebugMode$$:"System.Boolean",get_DebugMode:function(){return Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval._DebugMode},set_DebugMode:function(n){Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval._DebugMode=n},InitStressWithGraph:function(n,t,i){var r,u,f;for(n.set_Positions(new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,i)),n.set_NodeVotings(new System.Collections.Generic.List$1.ctor$$Int32(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.NodeVoting.ctor,t.length)),r=0;r<t.length;r++)u=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.NodeVoting.ctor$$Int32(r),f=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.VoteBlock.ctor(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor),100),u.get_VotingBlocks().Add(f),n.get_NodeVotings().Add(u)},RandomizePoints:function(n,t,i,r){for(var u,o,s,e=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),f=0;f<n.length;f++){if(u=n[f],e.Contains(u)||r)do o=u.get_X()+(2*t.NextDouble()-1)*i,s=u.get_Y()+(2*t.NextDouble()-1)+i,u=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(o,s);while(e.Contains(u));n[f]=u;e.Add(u)}},GetProximityEdgesWithDistance:function(n,t,i,r){var y,s,h,c,b;r.Value=new System.Collections.Generic.List$1.ctor(System.Tuple$4.ctor);for(var l=0,a=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Routing.CdtEdge.ctor),v=t.GetTriangles().GetEnumerator();v.MoveNext();)for(y=v.get_Current(),s=y.Edges.GetEnumerator();s.MoveNext();){var u=s.get_Current(),p=u.upperSite,w=u.lowerSite,f=p.get_Owner(),e=w.get_Owner();if(!a.Contains(u)){a.Add(u);var k=p.Point,d=w.Point,o,g=function(){var n={Value:o},t=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.GetIdealDistanceBetweenNodes(f,e,k,d,i,n);return o=n.Value,t}();o>1&&l++;h=f;c=e;f>e&&(h=e,c=f);b=new System.Tuple$4.ctor(System.Int32.ctor,System.Int32.ctor,System.Double.ctor,System.Double.ctor,h,c,g,o);r.Value.Add(b)}}return l},GetOverlapFactorBetweenNodes:function(n,t,i,r,u,f){return Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.GetIdealDistanceBetweenNodes(n,t,i,r,u,f)},GetIdealDistanceBetweenNodes:function(n,t,i,r,u,f){if(u==null)throw $CreateException(new System.ArgumentNullException.ctor$$String("nodeBoxes"),new Error);if((f.Value=-1,u.length<=n)||u.length<=t)return 0;var l=1e-16,a=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r).get_Length(),o=System.Math.Abs$$Double(i.get_X()-r.get_X()),s=System.Math.Abs$$Double(i.get_Y()-r.get_Y()),h=u[n].get_Width()/2+u[t].get_Width()/2,c=u[n].get_Height()/2+u[t].get_Height()/2,e;return e=o<l*h?c/s:s<l*c?h/o:System.Math.Min$$Double$$Double(h/o,c/s),e>1&&(e=System.Math.Max$$Double$$Double(e,1.001)),e=System.Math.Min$$Double$$Double(1.5,e),e=System.Math.Max$$Double$$Double(1,e),f.Value=e,e*a},ShowCurrentMovementVectors:function(){},InitNodePositionsAndBoxes:function(n,t,i,r){return i.Value=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,t,function(n){return n.get_Center()})),Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.RandomizePoints(i.Value,new System.Random.ctor$$Int32(n.get_RandomizationSeed()),n.get_Epsilon(),n.get_RandomizeAllPointsOnStart()),r.Value=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.GetNodeSizesByPaddingWithHalfSeparation(t,n.get_NodeSeparation()),i.Value},GetNodeSizesByPaddingWithHalfSeparation:function(n,t){var r,u,i;if(n==null)return null;for(r=new Array(n.length),u=t/2,i=0;i<n.length;i++)r[i]=n[i].get_BoundingBox().get_Size(),r[i].Pad(u);return r},AddStressFromProximityEdges:function(n,t){for(var o=new System.Collections.Generic.HashSet$1.ctor(System.Tuple$2.ctor),s=t.GetEnumerator(),e;s.MoveNext();){var i=s.get_Current(),r=i.get_Item1(),u=i.get_Item2();if(r>u&&(r=i.get_Item2(),u=i.get_Item1()),e=new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,r,u),!o.Contains(e)){o.Add(e);var f=i.get_Item3(),h=1/(f*f),c=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor$$Int32$$Double$$Double(r,f,h),l=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor$$Int32$$Double$$Double(u,f,h);i.get_Item4()<=1?(n.get_NodeVotings().get_Item$$Int32(u).get_VotingBlocks().get_Item$$Int32(0).get_Votings().Add(c),n.get_NodeVotings().get_Item$$Int32(r).get_VotingBlocks().get_Item$$Int32(0).get_Votings().Add(l)):(n.get_NodeVotings().get_Item$$Int32(u).get_VotingBlocks().get_Item$$Int32(1).get_Votings().Add(c),n.get_NodeVotings().get_Item$$Int32(r).get_VotingBlocks().get_Item$$Int32(1).get_Votings().Add(l))}}},RemoveOverlaps$$GeometryGraph$$Double:function(n,t){var i=function(){var i=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.ctor$$GeometryGraph(n);return i.get_Settings().set_NodeSeparation(t),i}();i.RemoveOverlaps()}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.IOverlapRemoval"],Kind:"Class",definition:{ctor$$OverlapRemovalSettings$$GeometryGraph:function(n,t){this._nodes=null;this.trajectories=null;this.crossingsOverTime=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);this.settings=null;this.lastCpuTime=new System.TimeSpan.ctor;this.nodeSizes=null;this.nodePositions=null;this.stressSolver=null;this._LastRunIterations=0;System.Object.ctor.call(this);this.set_Graph(t);this.set_Settings(n)},Settings$$:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.OverlapRemovalSettings",get_Settings:function(){return this.settings},set_Settings:function(n){this.settings=n;this.get_StressSolver()!=null&&n!=null&&this.get_StressSolver().set_Settings(n.get_StressSettings())},LastRunIterations$$:"System.Int32",get_LastRunIterations:function(){return this._LastRunIterations},set_LastRunIterations:function(n){this._LastRunIterations=n},NodeSizes$$:"Microsoft.Msagl.Core.DataStructures.Size[]",get_NodeSizes:function(){return this.nodeSizes},StressSolver$$:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.StressMajorization",get_StressSolver:function(){return this.stressSolver},set_StressSolver:function(n){this.stressSolver=n;this.get_Settings()!=null&&this.stressSolver!=null&&this.stressSolver.set_Settings(this.get_Settings().get_StressSettings())},Graph$$:"Microsoft.Msagl.Core.Layout.GeometryGraph",set_Graph:function(n){this._nodes=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes());this.InitWithGraph()},InitializeSettings:function(){this.set_Settings(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.OverlapRemovalSettings.ctor)},ctor:function(){this._nodes=null;this.trajectories=null;this.crossingsOverTime=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);this.settings=null;this.lastCpuTime=new System.TimeSpan.ctor;this.nodeSizes=null;this.nodePositions=null;this.stressSolver=null;this._LastRunIterations=0;System.Object.ctor.call(this);this.InitializeSettings()},ctor$$GeometryGraph:function(n){this._nodes=null;this.trajectories=null;this.crossingsOverTime=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);this.settings=null;this.lastCpuTime=new System.TimeSpan.ctor;this.nodeSizes=null;this.nodePositions=null;this.stressSolver=null;this._LastRunIterations=0;System.Object.ctor.call(this);this.set_Graph(n);this.InitializeSettings()},InitWithGraph:function(){(this.get_StressSolver()!=null,this._nodes!=null&&this._nodes.length!=0)&&this.get_StressSolver()==null&&(this.set_StressSolver(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.StressMajorization.ctor),this.get_Settings()!=null&&this.get_StressSolver().set_Settings(this.get_Settings().get_StressSettings()))},RemoveOverlaps:function(){var n,i;if(this._nodes!=null&&this._nodes.length!=0){for(function(){var n={Value:this.nodePositions},t={Value:this.nodeSizes},i=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.InitNodePositionsAndBoxes(this.get_Settings(),this._nodes,n,t);return this.nodePositions=n.Value,this.nodeSizes=t.Value,i}.call(this),Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.InitStressWithGraph(this.get_StressSolver(),this._nodes,this.nodePositions),this.trajectories=new System.Collections.Generic.List$1.ctor$$Int32(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this._nodes.length),n=0;n<this.nodePositions.length;n++)i=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,i.AddPoint$$Point(this.nodePositions[n]),this.trajectories.Add(i);for(var r=!1,t=0,u=!1;!u&&(t++<this.get_Settings().get_IterationsMax()||!this.get_Settings().get_StopOnMaxIterat());)u=function(){var n={Value:r},i=this.DoSingleIteration(t,n);return r=n.Value,i}.call(this);this.set_LastRunIterations(t);this.SetPositionsToGraph();var e=System.Linq.Enumerable.Sum$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.DataStructures.Size.ctor,this.nodeSizes,$CreateAnonymousDelegate(this,function(n){return n.get_Width()*n.get_Height()})),f=this.GetCommonRectangle(this.nodeSizes,this.nodePositions),o=f.get_Width()*f.get_Height();System.Console.WriteLine$$String$$Object("Needed maxIterat: {0}",t);System.Console.WriteLine$$String$$Object("BBox Area Ratio: {0}",o/e);return}},GetCommonRectangle:function(n,t){var r=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox(),i;for(System.Diagnostics.Debug.Assert$$Boolean(n.length==t.length),i=0;i<n.length;i++)r.Add$$Size$$Point(n[i],t[i]);return r},DoSingleIteration:function(n,t){var s=System.Linq.Enumerable.ToList$1(System.Tuple$2.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$3(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Tuple$2.ctor,this.nodePositions,$CreateAnonymousDelegate(this,function(n,t){return new System.Tuple$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Object.ctor,n,t)}))),e=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.ctor$$IEnumerable$1(s),r,i,o,f,u;if(e.Run(),i=function(){var n={Value:r},t=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.GetProximityEdgesWithDistance(this._nodes,e,this.nodeSizes,n);return r=n.Value,t}.call(this),(t.Value||i==0)&&(t.Value=!0,i=function(){var n={Value:i},t=this.CompleteProximityGraphWithRTree(n,r);return i=n.Value,t}.call(this)),o=this.CountCrossingsWithRTree(this.nodeSizes),this.crossingsOverTime.Add(o),n%10==0&&System.Console.WriteLine$$String$$Object$$Object("Scanline: {0}, Crossings: {1}",t.Value,i),i==0)return!0;for(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.AddStressFromProximityEdges(this.get_StressSolver(),r),f=this.get_StressSolver().IterateAll(),Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.ShowCurrentMovementVectors(n,this.nodeSizes,this.nodePositions,f,r,null),this.UpdatePointsAndBoxes(f),this.get_StressSolver().ClearVotings(),u=0;u<this.nodePositions.length;u++)this.trajectories.get_Item$$Int32(u).AddPoint$$Point(f.get_Item$$Int32(u));return!1},UpdatePointsAndBoxes:function(n){for(var t=0;t<this.nodePositions.length;t++)this.nodePositions[t]=n.get_Item$$Int32(t)},SetPositionsToGraph:function(){for(var n=0;n<this._nodes.length;n++)this.get_Settings().get_WorkInInches()?this._nodes[n].set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(this.nodePositions[n],72)):this._nodes[n].set_Center(this.nodePositions[n])},ShowTrajectoriesOfNodes:function(){},CompleteProximityGraphWithRTree:function(n,t){var i=this.CreateProximityEdgesWithRTree(t);return n.Value+i},DoInitialScaling:function(){return},CreateProximityEdgesWithRTree:function(n){for(var t=new System.Collections.Generic.HashSet$1.ctor(System.Tuple$2.ctor),f=n.GetEnumerator(),i,r,u;f.MoveNext();)i=f.get_Current(),t.Add(System.Tuple.Create$2$$T1$$T2(System.Int32.ctor,System.Int32.ctor,i.get_Item1(),i.get_Item2()));return r=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$3(Microsoft.Msagl.Core.DataStructures.Size.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,this.nodeSizes,$CreateAnonymousDelegate(this,function(n,t){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(System.Int32.ctor,t,new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Size$$Point(n,this.nodePositions[t]))}))),u=0,Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(System.Int32.ctor,System.Int32.ctor,r,r,$CreateAnonymousDelegate(this,function(i,r){if(i!=r){var o,s=function(){var n={Value:o},t=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.GetOverlapFactorBetweenNodes(i,r,this.nodePositions[i],this.nodePositions[r],this.nodeSizes,n);return o=n.Value,t}.call(this),f=i,e=r;(f>e&&(f=r,e=i),o>1&&!t.Contains(new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,f,e)))&&(n.Add(System.Tuple.Create$4$$T1$$T2$$T3$$T4(System.Int32.ctor,System.Int32.ctor,System.Double.ctor,System.Double.ctor,f,e,s,o)),t.Add(new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,f,e)),u++)}})),u},CountCrossingsWithRTree:function(n){var t=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$3(Microsoft.Msagl.Core.DataStructures.Size.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n,$CreateAnonymousDelegate(this,function(n,t){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(System.Int32.ctor,t,new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Size$$Point(n,this.nodePositions[t]))}))),i=0;return Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(System.Int32.ctor,System.Int32.ctor,t,t,$CreateAnonymousDelegate(this,function(n,t){n!=t&&i++})),i},RemoveOverlaps$$GeometryGraph:function(n){this.set_Graph(n);this.RemoveOverlaps()},GetLastRunIterations:function(){return this.get_LastRunIterations()},GetLastRunCpuTime:function(){return this.lastCpuTime}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$ProximityOverlapRemoval);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$MstOnDelaunayTriangulation={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.MstOnDelaunayTriangulation",baseTypeName:"System.Object",staticDefinition:{GetMstOnTuple:function(n,t){var i,u,r;if(n.get_Count()==0)return null;for(i=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$5.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,n,function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Item1(),n.get_Item2())})),u=new System.Collections.Generic.Dictionary$2.ctor$$Int32(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Tuple$5.ctor,System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,i)),r=0;r<n.get_Count();r++)u.set_Item$$TKey(i[r],n.get_Item$$Int32(r));var f=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.GraphAlgorithms.IEdge.ctor,i,t),e=new Microsoft.Msagl.Core.GraphAlgorithms.MinimumSpanningTreeByPrim.ctor(f,function(n){return u.get_Item$$TKey(Cast(n,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor)).get_Item5()},i[0].get_First());return System.Linq.Enumerable.ToList$1(System.Tuple$5.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.GraphAlgorithms.IEdge.ctor,System.Tuple$5.ctor,e.GetTreeEdges(),function(n){return u.get_Item$$TKey(Cast(n,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor))}))},GetMstOnCdt:function(n,t){for(var i=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Routing.CdtSite.ctor,n.PointsToSites.get_Values()),f=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.CdtSite.ctor,System.Int32.ctor),r=0;r<i.length;r++)f.set_Item$$TKey(i[r],r);var u=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.MstOnDelaunayTriangulation.GetEdges(i,f),e=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.GraphAlgorithms.IEdge.ctor,u.get_Keys(),i.length),o=new Microsoft.Msagl.Core.GraphAlgorithms.MinimumSpanningTreeByPrim.ctor(e,function(n){return t(u.get_Item$$TKey(Cast(n,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor)))},0);return new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.CdtEdge.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.GraphAlgorithms.IEdge.ctor,Microsoft.Msagl.Routing.CdtEdge.ctor,o.GetTreeEdges(),function(n){return u.get_Item$$TKey(Cast(n,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor))}))},GetEdges:function(n,t){for(var r,u=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,Microsoft.Msagl.Routing.CdtEdge.ctor),i=0;i<n.length;i++)for(var f=n[i],o=t.get_Item$$TKey(f),e=f.Edges.GetEnumerator();e.MoveNext();)r=e.get_Current(),u.set_Item$$TKey(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(o,t.get_Item$$TKey(r.lowerSite)),r);return u},Test:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$MstOnDelaunayTriangulation);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$ExampleStressMajorization={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.ExampleStressMajorization",baseTypeName:"System.Object",staticDefinition:{RunStressMajorizationExample:function(){var n=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,f,i,o,r,s,e,t;for(n.get_Nodes().Add(new Microsoft.Msagl.Core.Layout.Node.ctor),n.get_Nodes().Add(new Microsoft.Msagl.Core.Layout.Node.ctor),n.get_Nodes().Add(new Microsoft.Msagl.Core.Layout.Node.ctor),n.get_Nodes().Add(new Microsoft.Msagl.Core.Layout.Node.ctor),n.get_Nodes().get_Item$$Int32(0).set_BoundaryCurve(Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRectangle$$Double$$Double$$Point(20,10,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(5,5))),n.get_Nodes().get_Item$$Int32(1).set_BoundaryCurve(Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRectangle$$Double$$Double$$Point(20,10,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(7,10))),n.get_Nodes().get_Item$$Int32(2).set_BoundaryCurve(Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRectangle$$Double$$Double$$Point(20,10,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(7,2))),n.get_Nodes().get_Item$$Int32(3).set_BoundaryCurve(Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRectangle$$Double$$Double$$Point(20,10,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(35,1))),n.get_Edges().Add(new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(n.get_Nodes().get_Item$$Int32(0),n.get_Nodes().get_Item$$Int32(1))),n.get_Edges().Add(new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(n.get_Nodes().get_Item$$Int32(0),n.get_Nodes().get_Item$$Int32(2))),n.get_Edges().Add(new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(n.get_Nodes().get_Item$$Int32(0),n.get_Nodes().get_Item$$Int32(3))),f=new Float64Array(n.get_Edges().get_Count()),t=0;t<n.get_Edges().get_Count();t++)f[t]=100;for(i=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.StressMajorization.ctor,i.set_Positions(new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_Nodes(),function(n){return n.get_Center()}))),i.set_NodeVotings(new System.Collections.Generic.List$1.ctor$$Int32(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.NodeVoting.ctor,n.get_Nodes().get_Count())),t=0;t<n.get_Nodes().get_Count();t++)o=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.NodeVoting.ctor$$Int32(t),i.get_NodeVotings().Add(o);for(r=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Int32.ctor),t=0;t<n.get_Nodes().get_Count();t++)r.set_Item$$TKey(n.get_Nodes().get_Item$$Int32(t),t);for(s=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_Edges()),t=0;t<n.get_Edges().get_Count();t++){var h=s[t],c=r.get_Item$$TKey(h.get_Source()),l=r.get_Item$$TKey(h.get_Target()),u=f[t],a=1/(u*u),v=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor$$Int32$$Double$$Double(c,u,a),y=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor$$Int32$$Double$$Double(l,u,a);i.get_NodeVotings().get_Item$$Int32(l).get_VotingBlocks().get_Item$$Int32(0).get_Votings().Add(v);i.get_NodeVotings().get_Item$$Int32(c).get_VotingBlocks().get_Item$$Int32(0).get_Votings().Add(y)}for(i.set_Settings(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.StressMajorizationSettings.ctor),i.get_Settings().set_SolvingMethod(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.SolvingMethod.Localized),e=i.IterateAll(),t=0;t<e.get_Count();t++)n.get_Nodes().get_Item$$Int32(t).set_Center(e.get_Item$$Int32(t))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$ExampleStressMajorization);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$MaxIterationMethod={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.MaxIterationMethod",staticDefinition:{FixedMax:0,SqrtProblemSize:1,LinearProblemSize:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$MaxIterationMethod);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$NodeVoting={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.NodeVoting",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Int32:function(n){this.VotedNodeIndex=0;this._VotingBlocks=null;System.Object.ctor.call(this);this.VotedNodeIndex=n;this.set_VotingBlocks(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.VoteBlock.ctor));var t=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.VoteBlock.ctor(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor),1);this.get_VotingBlocks().Add(t)},VotingBlocks$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.VoteBlock]]",get_VotingBlocks:function(){return this._VotingBlocks},set_VotingBlocks:function(n){this._VotingBlocks=n},ctor$$Int32$$List$1$VoteBlock:function(n,t){this.VotedNodeIndex=0;this._VotingBlocks=null;System.Object.ctor.call(this);this.VotedNodeIndex=n;this.set_VotingBlocks(t)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$NodeVoting);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$StressMajorizationSettings={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.StressMajorizationSettings",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.maxStressIterations=31;this.solvingMethod=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.SolvingMethod.PrecondConjugateGradient;this.updateMethod=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.UpdateMethod.Parallel;this.stressChangeTolerance=.01;this.cancelOnStressConvergence=!0;this.cancelOnStressMaxIteration=!0;this.maxSolverIterations=100;this.solverMaxIteratMethod=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.MaxIterationMethod.SqrtProblemSize;this.residualTolerance=.01;this.cancelAfterFirstConjugate=!0;this.parallelDegree=4;this.parallelize=!1;System.Object.ctor.call(this)},UpdateMethod$$:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.UpdateMethod",get_UpdateMethod:function(){return this.updateMethod},set_UpdateMethod:function(n){this.updateMethod=n},SolvingMethod$$:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.SolvingMethod",get_SolvingMethod:function(){return this.solvingMethod},set_SolvingMethod:function(n){this.solvingMethod=n},MaxStressIterations$$:"System.Int32",get_MaxStressIterations:function(){return this.maxStressIterations},set_MaxStressIterations:function(n){this.maxStressIterations=n},StressChangeTolerance$$:"System.Double",get_StressChangeTolerance:function(){return this.stressChangeTolerance},set_StressChangeTolerance:function(n){this.stressChangeTolerance=n},CancelOnStressConvergence$$:"System.Boolean",get_CancelOnStressConvergence:function(){return this.cancelOnStressConvergence},set_CancelOnStressConvergence:function(n){this.cancelOnStressConvergence=n},CancelOnStressMaxIteration$$:"System.Boolean",get_CancelOnStressMaxIteration:function(){return this.cancelOnStressMaxIteration},set_CancelOnStressMaxIteration:function(n){this.cancelOnStressMaxIteration=n},ResidualTolerance$$:"System.Double",get_ResidualTolerance:function(){return this.residualTolerance},set_ResidualTolerance:function(n){this.residualTolerance=n},CancelAfterFirstConjugate$$:"System.Boolean",get_CancelAfterFirstConjugate:function(){return this.cancelAfterFirstConjugate},set_CancelAfterFirstConjugate:function(n){this.cancelAfterFirstConjugate=n},SolverMaxIteratMethod$$:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.MaxIterationMethod",get_SolverMaxIteratMethod:function(){return this.solverMaxIteratMethod},set_SolverMaxIteratMethod:function(n){this.solverMaxIteratMethod=n},MaxSolverIterations$$:"System.Int32",get_MaxSolverIterations:function(){return this.maxSolverIterations},set_MaxSolverIterations:function(n){this.maxSolverIterations=n},Parallelize$$:"System.Boolean",get_Parallelize:function(){return this.parallelize},set_Parallelize:function(n){this.parallelize=n},ParallelDegree$$:"System.Int32",get_ParallelDegree:function(){return this.parallelDegree},set_ParallelDegree:function(n){this.parallelDegree=n}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$StressMajorizationSettings);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$SolvingMethod={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.SolvingMethod",staticDefinition:{Localized:0,PrecondConjugateGradient:1,ConjugateGradient:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$SolvingMethod);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$StressMajorization={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.StressMajorization",baseTypeName:"System.Object",staticDefinition:{TestMajorizationSmall:function(){var t=new System.Collections.Generic.List$1.ctor$$Int32(Microsoft.Msagl.Core.Geometry.Point.ctor,4),f,e,o,r,s,n,h,a;t.Add(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0));t.Add(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-2,-1));t.Add(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1,2));var i=new System.Collections.Generic.List$1.ctor$$Int32(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.NodeVoting.ctor,8),u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor),c=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor),l=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor);for(c.Add(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor$$Int32$$Double$$Double(0,10,1/System.Math.Pow(10,2))),l.Add(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor$$Int32$$Double$$Double(0,10,1/System.Math.Pow(10,2))),u.Add(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor$$Int32$$Double$$Double(1,10,1/System.Math.Pow(10,2))),u.Add(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote.ctor$$Int32$$Double$$Double(2,10,1/System.Math.Pow(10,2))),f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.VoteBlock.ctor),f.Add(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.VoteBlock.ctor(u,1)),e=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.VoteBlock.ctor),e.Add(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.VoteBlock.ctor(c,1)),o=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.VoteBlock.ctor),o.Add(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.VoteBlock.ctor(l,1)),i.Add(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.NodeVoting.ctor$$Int32$$List$1$VoteBlock(0,f)),i.Add(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.NodeVoting.ctor$$Int32$$List$1$VoteBlock(1,e)),i.Add(new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.NodeVoting.ctor$$Int32$$List$1$VoteBlock(2,o)),r=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.StressMajorization.ctor,r.set_Positions(t),r.set_NodeVotings(i),s=0;s<20;s++){for(n=r.IterateSingleLocalizedMethod(),h=n.GetEnumerator();h.MoveNext();)a=h.get_Current(),System.Console.WriteLine$$String$$Object("ResultPoint: {0}",a.toString());System.Console.WriteLine$$String$$Object("Distance To Left: {0}",Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Item$$Int32(0),n.get_Item$$Int32(1)).get_Length());System.Console.WriteLine$$String$$Object("Distance To Right: {0}",Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Item$$Int32(0),n.get_Item$$Int32(2)).get_Length());System.Console.WriteLine$$String("----------------------------------------")}}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._Settings=null;this._NodeVotings=null;this._Positions=null;System.Object.ctor.call(this)},Settings$$:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.StressMajorizationSettings",get_Settings:function(){return this._Settings},set_Settings:function(n){this._Settings=n},NodeVotings$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.NodeVoting]]",get_NodeVotings:function(){return this._NodeVotings},set_NodeVotings:function(n){this._NodeVotings=n},Positions$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_Positions:function(){return this._Positions},set_Positions:function(n){this._Positions=n},IterateSingleLocalizedMethod:function(){for(var i,u,t=this.get_Settings().get_UpdateMethod()==Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.UpdateMethod.Serial?this.get_Positions():new System.Collections.Generic.List$1.ctor$$Int32(Microsoft.Msagl.Core.Geometry.Point.ctor,this.get_Positions().get_Count()),n=0;n<this.get_NodeVotings().get_Count();n++){var i=this.get_NodeVotings().get_Item$$Int32(n),f=i.VotedNodeIndex,r=this.LocalizedOptimization(i);this.get_Settings().get_UpdateMethod()==Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.UpdateMethod.Serial?t.set_Item$$Int32(f,r):t.Add(r)}if(this.get_Settings().get_UpdateMethod()==Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.UpdateMethod.Parallel)for(n=0;n<this.get_NodeVotings().get_Count();n++)i=this.get_NodeVotings().get_Item$$Int32(n),u=i.VotedNodeIndex,this.get_Positions().set_Item$$Int32(u,t.get_Item$$Int32(n));return t},IterateAll:function(){var r,t;this.initMaxIterationsSolver();for(var u=0,n=null,i=this.StressValue(this.get_Positions());!this.get_Settings().get_CancelOnStressMaxIteration()||u++<this.get_Settings().get_MaxStressIterations();){if(this.get_Settings().get_SolvingMethod()==Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.SolvingMethod.Localized)n=this.IterateSingleLocalizedMethod();else if(n=this.IterateSingleConjugateGradient(),this.get_Settings().get_CancelAfterFirstConjugate())break;if(r=this.StressValue(n),t=i>0?(i-r)/i:0,t=System.Math.Sqrt(t)/this.get_Positions().get_Count(),t<this.get_Settings().get_StressChangeTolerance())break}return n},initMaxIterationsSolver:function(){if(this.get_Positions()!=null){var t=this.get_Positions().get_Count(),n=this.get_Settings().get_MaxSolverIterations();switch(this.get_Settings().get_SolverMaxIteratMethod()){case Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.MaxIterationMethod.FixedMax:return;case Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.MaxIterationMethod.SqrtProblemSize:n=System.Math.Ceiling$$Double(System.Math.Sqrt(t))|0;break;case Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.MaxIterationMethod.LinearProblemSize:n=t;break;default:return}this.get_Settings().set_MaxSolverIterations(n)}},IterateSingleConjugateGradient:function(){var t,i,n;(function(){var n={Value:t},r={Value:i},u=this.ConstructLinearSystemFromMajorization(n,r);return t=n.Value,i=r.Value,u}).call(this);var r=System.Linq.Enumerable.ToArray$1(System.Double.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Double.ctor,this.get_Positions(),$CreateAnonymousDelegate(this,function(n){return n.get_X()}))),u=System.Linq.Enumerable.ToArray$1(System.Double.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Double.ctor,this.get_Positions(),$CreateAnonymousDelegate(this,function(n){return n.get_Y()}))),s=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix.op_Multiply$$SparseMatrix$$Double$Array(i,r),h=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix.op_Multiply$$SparseMatrix$$Double$Array(i,u),f=null,e=null,c=function(){var n=new System.Collections.Generic.Dictionary$2.ctor(System.Boolean.ctor,System.Action$1.ctor);return n.Add(!0,System.Threading.Tasks.Parallel.Invoke$$Action$Array),n.Add(!1,$CreateAnonymousDelegate(this,function(n){System.Array.ForEach(n,$CreateAnonymousDelegate(this,function(n){n()}))})),n}.call(this),o=function(){var n=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.SolvingMethod.ctor,System.Func$6.ctor);return n.Add(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.SolvingMethod.ConjugateGradient,Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.LinearSystemSolver.SolveConjugateGradient$$SparseMatrix$$Double$Array$$Double$Array$$Int32$$Double),n.Add(Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.SolvingMethod.PrecondConjugateGradient,Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.LinearSystemSolver.SolvePrecondConjugateGradient$$SparseMatrix$$Double$Array$$Double$Array$$Int32$$Double),n}.call(this);for(c.get_Item$$TKey(this.get_Settings().get_Parallelize())([$CreateAnonymousDelegate(this,function(){f=o.get_Item$$TKey(this.get_Settings().get_SolvingMethod())(t,s,r,this.get_Settings().get_MaxSolverIterations(),this.get_Settings().get_ResidualTolerance())}),$CreateAnonymousDelegate(this,function(){e=o.get_Item$$TKey(this.get_Settings().get_SolvingMethod())(t,h,u,this.get_Settings().get_MaxSolverIterations(),this.get_Settings().get_ResidualTolerance())})]),n=0;n<this.get_Positions().get_Count();n++)this.get_Positions().set_Item$$Int32(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(f[n],e[n]));return this.get_Positions()},LocalizedOptimization:function(n){var t=this.get_Positions().get_Item$$Int32(n.VotedNodeIndex),h=0,c=0,i=0,u,p;if(n.get_VotingBlocks()==null||n.get_VotingBlocks().get_Count()==0)return t;for(u=n.get_VotingBlocks().GetEnumerator();u.MoveNext();)for(var l=u.get_Current(),w=l.get_BlockWeight(),a=l.get_Votings().GetEnumerator();a.MoveNext();){var f=a.get_Current(),r=this.get_Positions().get_Item$$Int32(f.VoterIndex),v=f.Distance,e=t.get_X()-r.get_X(),o=t.get_Y()-r.get_Y(),y=System.Math.Sqrt(e*e+o*o),s=w*f.Weight,b=r.get_X()+v*e/y;h+=b*s;p=r.get_Y()+v*o/y;c+=p*s;i+=s}return i==0?t:new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(h/i,c/i)},ClearVoting:function(n){for(var t=n.get_VotingBlocks().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),i.get_Votings().Clear()},ClearVotings:function(){for(var n=this.get_NodeVotings().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.ClearVoting(t)},ConstructLinearSystemFromMajorization:function(n,t){for(var f=this.GetNumberOfEdges(this.get_NodeVotings()),nt=new Float64Array(f),tt=new Float64Array(f),i=new Array(this.get_NodeVotings().get_Count()),y=0,s=0,it=this.get_NodeVotings().GetEnumerator(),w,b,k,d,h,ut,e,c,l,u,r,a,o,st,v,ht,g;it.MoveNext();){var p=it.get_Current(),ct=p.VotedNodeIndex,rt=0;if(p.get_VotingBlocks().ForEach($CreateAnonymousDelegate(this,function(n){rt+=n.get_Votings().get_Count()})),w=new System.Collections.Generic.List$1.ctor$$Int32(Int32Array,rt),y!=ct)throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String("VotedNodeIndex must be consecutive starting from 0"),new Error);for(i[y]=w,b=p.get_VotingBlocks().GetEnumerator();b.MoveNext();)for(k=b.get_Current(),d=k.get_Votings().GetEnumerator();d.MoveNext();)h=d.get_Current(),ut=h.VoterIndex,nt[s]=h.Distance,tt[s]=h.Weight*k.get_BlockWeight(),w.Add(new Int32Array([ut,s])),s++;y++}for(e=0;e<i.length;e++)c=i[e],c.Add(new Int32Array([e,-1])),c.Sort$$Comparison$1($CreateAnonymousDelegate(this,function(n,t){return n[0].CompareTo$$Int32(t[0])}));for(f+=i.length,l=new Int32Array(i.length),n.Value=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix.ctor$$Int32$$Int32$$Int32(f,i.length,i.length),t.Value=new Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ConjugateGradient.SparseMatrix.ctor$$Int32$$Int32$$Int32(f,i.length,i.length),u=0,r=0;r<i.length;r++){for(var c=i[r],ft=0,et=0,ot=c.GetEnumerator();ot.MoveNext();)a=ot.get_Current(),o=a[0],n.Value.ColInd()[u]=o,t.Value.ColInd()[u]=o,r==o?l[r]=u:(st=nt[a[1]],v=tt[a[1]],n.Value.Values()[u]=-v,ft+=v,ht=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.get_Positions().get_Item$$Int32(r),this.get_Positions().get_Item$$Int32(o)).get_Length(),g=-v*st/ht,t.Value.Values()[u]=g,et+=g),u++;n.Value.Values()[l[r]]=ft;t.Value.Values()[l[r]]=-et;n.Value.RowPtr()[r+1]=u;t.Value.RowPtr()[r+1]=u}},GetNumberOfEdges:function(n){for(var t=0,i=n.GetEnumerator(),f;i.MoveNext();)for(var r=i.get_Current(),e=r.VotedNodeIndex,u=r.get_VotingBlocks().GetEnumerator();u.MoveNext();)f=u.get_Current(),t+=f.get_Votings().get_Count();return t},StressValue:function(n){for(var u=0,f=this.get_NodeVotings().GetEnumerator(),t,i;f.MoveNext();)for(var e=f.get_Current(),h=e.VotedNodeIndex,o=e.get_VotingBlocks().GetEnumerator();o.MoveNext();)for(t=o.get_Current(),i=t.get_Votings().GetEnumerator();i.MoveNext();){var r=i.get_Current(),c=r.VoterIndex,l=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Item$$Int32(h),n.get_Item$$Int32(c)).get_Length(),s=l-r.Distance;u+=t.get_BlockWeight()*r.Weight*s*s}return u}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$StressMajorization);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$UpdateMethod={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.UpdateMethod",staticDefinition:{Serial:0,Parallel:1},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$UpdateMethod);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$Vote={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Int32$$Double$$Double:function(n,t,i){this.VoterIndex=0;this.Distance=0;this.Weight=0;System.Object.ctor.call(this);this.VoterIndex=n;this.Distance=t;this.Weight=i},ctor$$Int32$$Double:function(n,t){this.VoterIndex=0;this.Distance=0;this.Weight=0;System.Object.ctor.call(this);this.VoterIndex=n;this.Distance=t;this.Weight=1/t/t}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$Vote);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$VoteBlock={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.VoteBlock",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this._Votings=null;this._BlockWeight=0;System.Object.ctor.call(this);this.set_Votings(n);this.set_BlockWeight(t)},Votings$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.StressEnergy.Vote]]",get_Votings:function(){return this._Votings},set_Votings:function(n){this._Votings=n},BlockWeight$$:"System.Double",get_BlockWeight:function(){return this._BlockWeight},set_BlockWeight:function(n){this._BlockWeight=n}}};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$StressEnergy$VoteBlock);Microsoft$Msagl$Core$Layout$RectangleObstacle={fullname:"Microsoft.Msagl.Core.Layout.RectangleObstacle",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Layout.IObstacle"],Kind:"Class",definition:{ctor$$Rectangle:function(n){this._Rectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._Data=null;System.Object.ctor.call(this);this.set_Rectangle(n)},ctor$$Rectangle$$Object:function(n,t){this._Rectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._Data=null;System.Object.ctor.call(this);this.set_Rectangle(n);this.set_Data(t)},Rectangle$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_Rectangle:function(){return this._Rectangle},set_Rectangle:function(n){this._Rectangle=n},Data$$:"System.Object",get_Data:function(){return this._Data},set_Data:function(n){this._Data=n}}};JsTypes.push(Microsoft$Msagl$Core$Layout$RectangleObstacle);Microsoft$Msagl$Core$Layout$SimpleIntEdge={fullname:"Microsoft.Msagl.Core.Layout.SimpleIntEdge",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.GraphAlgorithms.IEdge"],Kind:"Class",definition:{ctor:function(){this._Source=0;this._Target=0;System.Object.ctor.call(this)},Source$$:"System.Int32",get_Source:function(){return this._Source},set_Source:function(n){this._Source=n},Target$$:"System.Int32",get_Target:function(){return this._Target},set_Target:function(n){this._Target=n}}};JsTypes.push(Microsoft$Msagl$Core$Layout$SimpleIntEdge);Microsoft$Msagl$Core$ProjectionSolver$SolverAlgorithm={fullname:"Microsoft.Msagl.Core.ProjectionSolver.SolverAlgorithm",staticDefinition:{ProjectOnly:0,QpscWithScaling:1,QpscWithoutScaling:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$SolverAlgorithm);Microsoft$Msagl$Core$Routing$BundlingSettings={fullname:"Microsoft.Msagl.Core.Routing.BundlingSettings",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Routing.BundlingSettings.DefaultCapacityOverflowCoefficientMultiplier=1e3;Microsoft.Msagl.Core.Routing.BundlingSettings.DefaultPathLengthImportance=500;Microsoft.Msagl.Core.Routing.BundlingSettings.DefaultInkImportance=.01;Microsoft.Msagl.Core.Routing.BundlingSettings.DefaultEdgeSeparation=.5}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.capacityOverflowCoefficient=Microsoft.Msagl.Core.Routing.BundlingSettings.DefaultCapacityOverflowCoefficientMultiplier;this.MaxHubRadius=50;this.MinHubRadius=.1;this.pathLengthImportance=Microsoft.Msagl.Core.Routing.BundlingSettings.DefaultPathLengthImportance;this.inkImportance=Microsoft.Msagl.Core.Routing.BundlingSettings.DefaultInkImportance;this.edgeSeparation=Microsoft.Msagl.Core.Routing.BundlingSettings.DefaultEdgeSeparation;this.useCubicBezierSegmentsInsideOfHubs=!1;this.useGreedyMetrolineOrdering=!0;this.angleThreshold=.785398163397448;this.hubRepulsionImportance=100;this.bundleRepulsionImportance=100;this.minimalRatioOfGoodCdtEdges=.9;this.highestQuality=!0;this._CreateUnderlyingPolyline=!1;this._KeepOriginalSpline=!1;this._KeepOverlaps=!1;this._StopAfterShortestPaths=!1;System.Object.ctor.call(this)},CapacityOverflowCoefficient$$:"System.Double",get_CapacityOverflowCoefficient:function(){return this.capacityOverflowCoefficient},set_CapacityOverflowCoefficient:function(n){this.capacityOverflowCoefficient=n},CreateUnderlyingPolyline$$:"System.Boolean",get_CreateUnderlyingPolyline:function(){return this._CreateUnderlyingPolyline},set_CreateUnderlyingPolyline:function(n){this._CreateUnderlyingPolyline=n},PathLengthImportance$$:"System.Double",get_PathLengthImportance:function(){return this.pathLengthImportance},set_PathLengthImportance:function(n){this.pathLengthImportance=n},InkImportance$$:"System.Double",get_InkImportance:function(){return this.inkImportance},set_InkImportance:function(n){this.inkImportance=n},EdgeSeparation$$:"System.Double",get_EdgeSeparation:function(){return this.edgeSeparation},set_EdgeSeparation:function(n){this.edgeSeparation=n},UseCubicBezierSegmentsInsideOfHubs$$:"System.Boolean",get_UseCubicBezierSegmentsInsideOfHubs:function(){return this.useCubicBezierSegmentsInsideOfHubs},set_UseCubicBezierSegmentsInsideOfHubs:function(n){this.useCubicBezierSegmentsInsideOfHubs=n},UseGreedyMetrolineOrdering$$:"System.Boolean",get_UseGreedyMetrolineOrdering:function(){return this.useGreedyMetrolineOrdering},set_UseGreedyMetrolineOrdering:function(n){this.useGreedyMetrolineOrdering=n},AngleThreshold$$:"System.Double",get_AngleThreshold:function(){return this.angleThreshold},set_AngleThreshold:function(n){this.angleThreshold=n},HubRepulsionImportance$$:"System.Double",get_HubRepulsionImportance:function(){return this.hubRepulsionImportance},set_HubRepulsionImportance:function(n){this.hubRepulsionImportance=n},BundleRepulsionImportance$$:"System.Double",get_BundleRepulsionImportance:function(){return this.bundleRepulsionImportance},set_BundleRepulsionImportance:function(n){this.bundleRepulsionImportance=n},MinimalRatioOfGoodCdtEdges$$:"System.Double",get_MinimalRatioOfGoodCdtEdges:function(){return this.minimalRatioOfGoodCdtEdges},set_MinimalRatioOfGoodCdtEdges:function(n){this.minimalRatioOfGoodCdtEdges=n},HighestQuality$$:"System.Boolean",get_HighestQuality:function(){return this.highestQuality},set_HighestQuality:function(n){this.highestQuality=n},KeepOriginalSpline$$:"System.Boolean",get_KeepOriginalSpline:function(){return this._KeepOriginalSpline},set_KeepOriginalSpline:function(n){this._KeepOriginalSpline=n},KeepOverlaps$$:"System.Boolean",get_KeepOverlaps:function(){return this._KeepOverlaps},set_KeepOverlaps:function(n){this._KeepOverlaps=n},StopAfterShortestPaths$$:"System.Boolean",get_StopAfterShortestPaths:function(){return this._StopAfterShortestPaths},set_StopAfterShortestPaths:function(n){this._StopAfterShortestPaths=n}}};JsTypes.push(Microsoft$Msagl$Core$Routing$BundlingSettings);Microsoft$Msagl$DebugHelpers$Persistence$CharStreamElement={fullname:"Microsoft.Msagl.DebugHelpers.Persistence.CharStreamElement",baseTypeName:"Microsoft.Msagl.DebugHelpers.CurveStreamElement",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){Microsoft.Msagl.DebugHelpers.CurveStreamElement.ctor.call(this);this.Value=n},Char$$:"System.Char",get_Char:function(){return Cast(this.Value,System.Char.ctor)}}};JsTypes.push(Microsoft$Msagl$DebugHelpers$Persistence$CharStreamElement);Microsoft$Msagl$DebugHelpers$Persistence$GeometryGraphReader={fullname:"Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphReader",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphReader.NodeDefaultPadding=1},CreateFromFile$$String:function(n){var t;return function(){var i={Value:t},r=Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphReader.CreateFromFile$$String$$LayoutAlgorithmSettings(n,i);return t=i.Value,r}()},CreateFromFile$$String$$LayoutAlgorithmSettings:function(n,t){var r=System.IO.File.OpenRead(n),i,u;try{return i=new Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphReader.ctor$$Stream(r),u=i.Read(),t.Value=i.get_Settings(),u}finally{r.Dispose()}},ReadDoubleElement:function(n){return n.ReadElementContentAsDouble()}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.IDisposable"],Kind:"Class",definition:{ctor:function(){this.EdgeList=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.idToEdges=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.Core.Layout.Edge.ctor);this.idToRails=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor);this.railIdsToTopRankedEdgeInfo=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor);this._graph=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor;this.stringToClusters=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.DebugHelpers.ClusterWithChildLists.ctor);this.nodeIdToNodes=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.Core.Layout.Node.ctor);this.xmlTextReader=null;this._Settings=null;this._XmlReader=null;System.Object.ctor.call(this)},Settings$$:"Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings",get_Settings:function(){return this._Settings},set_Settings:function(n){this._Settings=n},ctor$$Stream:function(n){this.EdgeList=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.idToEdges=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.Core.Layout.Edge.ctor);this.idToRails=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor);this.railIdsToTopRankedEdgeInfo=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor);this._graph=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor;this.stringToClusters=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.DebugHelpers.ClusterWithChildLists.ctor);this.nodeIdToNodes=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.Core.Layout.Node.ctor);this.xmlTextReader=null;this._Settings=null;this._XmlReader=null;System.Object.ctor.call(this);var t=function(){var n=new System.Xml.XmlReaderSettings.ctor;return n.set_IgnoreComments(!1),n.set_IgnoreWhitespace(!0),n}.call(this);this.xmlTextReader=new System.Xml.XmlTextReader.ctor$$Stream(n);this.set_XmlReader(System.Xml.XmlReader.Create$$XmlReader$$XmlReaderSettings(this.xmlTextReader,t))},FindClusterById:function(n){var t;return function(){var i={Value:t},r=this.stringToClusters.TryGetValue(n,i);return t=i.Value,r}.call(this)?t.Cluster:null},FindNodeById:function(n){var t;return function(){var i={Value:t},r=this.nodeIdToNodes.TryGetValue(n,i);return t=i.Value,r}.call(this)?t:null},Read:function(){var n=System.Threading.Thread.get_CurrentThread().get_CurrentCulture();System.Threading.Thread.get_CurrentThread().set_CurrentCulture(System.Globalization.CultureInfo.get_InvariantCulture());try{return this.ReadGraph(),this._graph}finally{System.Threading.Thread.get_CurrentThread().set_CurrentCulture(n)}},ReadLayoutAlgorithmSettings:function(n){var i=null,r,f,e,t,u;if(this.CheckToken(Microsoft.Msagl.DebugHelpers.GeometryToken.LayoutAlgorithmSettings),n.get_IsEmptyElement())return n.Read(),null;if(r=this.GetIntAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.EdgeRoutingMode,0),f=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LayoutAlgorithmType),this.get_XmlReader().get_NodeType()==15)i=new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor,u=i.get_EdgeRoutingSettings(),u.set_EdgeRoutingMode(r);else if(f!=null)if(e=Cast(System.Enum.Parse$$Type$$String$$Boolean(Typeof(Microsoft.Msagl.DebugHelpers.GeometryToken.ctor),f,!1),Microsoft.Msagl.DebugHelpers.GeometryToken.ctor),e==Microsoft.Msagl.DebugHelpers.GeometryToken.SugiyamaLayoutSettings)i=this.ReadSugiyamaLayoutSettings(r);else if(e==Microsoft.Msagl.DebugHelpers.GeometryToken.MdsLayoutSettings)t=new Microsoft.Msagl.Layout.MDS.MdsLayoutSettings.ctor,u=t.get_EdgeRoutingSettings(),u.set_EdgeRoutingMode(r),i=t,this.get_XmlReader().IsStartElement$$String(Microsoft.Msagl.DebugHelpers.GeometryToken.Reporting.toString())&&this.ReadBooleanElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Reporting),t.set_Exponent(Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphReader.ReadDoubleElement(n)),t.set_IterationsWithMajorization(this.ReadIntElement(Microsoft.Msagl.DebugHelpers.GeometryToken.IterationsWithMajorization)),t.set_PivotNumber(this.ReadIntElement(Microsoft.Msagl.DebugHelpers.GeometryToken.PivotNumber)),t.set_RotationAngle(Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphReader.ReadDoubleElement(n)),t.set_ScaleX(Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphReader.ReadDoubleElement(n)),t.set_ScaleY(Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphReader.ReadDoubleElement(n));else throw $CreateException(new System.NotImplementedException.ctor,new Error);return n.ReadEndElement(),i},ReadSugiyamaLayoutSettings:function(n){var t=new Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings.ctor,u=t.get_EdgeRoutingSettings(),i,r;return u.set_EdgeRoutingMode(n),i=t,t.set_MinNodeWidth(this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.MinNodeWidth,t.get_MinNodeWidth())),t.set_MinNodeHeight(this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.MinNodeHeight,t.get_MinimalHeight())),t.set_AspectRatio(this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.AspectRatio,t.get_AspectRatio())),t.set_NodeSeparation(this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.NodeSeparation,t.get_NodeSeparation())),t.set_ClusterMargin(t.get_NodeSeparation()),t.set_RandomSeedForOrdering(this.GetIntAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.RandomSeedForOrdering,t.get_RandomSeedForOrdering())),t.set_NoGainAdjacentSwapStepsBound(this.GetIntAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.NoGainStepsBound,t.get_NoGainAdjacentSwapStepsBound())),t.set_MaxNumberOfPassesInOrdering(this.GetIntAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.MaxNumberOfPassesInOrdering,t.get_MaxNumberOfPassesInOrdering())),t.set_RepetitionCoefficientForOrdering(this.GetIntAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.RepetitionCoefficientForOrdering,t.get_RepetitionCoefficientForOrdering())),t.set_GroupSplit(this.GetIntAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.GroupSplit,t.get_GroupSplit())),t.set_LabelCornersPreserveCoefficient(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LabelCornersPreserveCoefficient)),t.set_BrandesThreshold(this.GetIntAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.BrandesThreshold,t.get_BrandesThreshold())),t.set_LayerSeparation(this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.LayerSeparation,t.get_LayerSeparation())),r=new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor,this.ReadTransform(r),i},ReadTransform:function(n){var t,i;if(this.XmlRead(),this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.Transform)){for(this.XmlRead(),t=0;t<2;t++)for(i=0;i<3;i++)this.CheckToken(Microsoft.Msagl.DebugHelpers.GeometryToken.TransformElement),this.MoveToContent(),n.set_Item$$Int32$$Int32(t,i,this.ReadElementContentAsDouble());this.XmlRead()}else n.set_Item$$Int32$$Int32(0,0,1),n.set_Item$$Int32$$Int32(0,1,0),n.set_Item$$Int32$$Int32(0,2,0),n.set_Item$$Int32$$Int32(1,0,0),n.set_Item$$Int32$$Int32(1,1,1),n.set_Item$$Int32$$Int32(1,2,0)},ReadBooleanElement:function(n){return this.CheckToken(n),this.ReadElementContentAsBoolean()},ReadElementContentAsBoolean:function(){return this.get_XmlReader().ReadElementContentAsBoolean()},ReadIntElement:function(n){return this.CheckToken(n),this.ReadElementContentAsInt()},ReadGraph:function(){this.MoveToContent();this._graph.set_Margins(this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.Margins,10));this.get_XmlReader().get_Name().toLowerCase()!=Microsoft.Msagl.DebugHelpers.GeometryToken.Graph.toString().toLowerCase()&&this.Error('expecting element "graph"');var n=!1;do switch(this.GetElementTag()){case Microsoft.Msagl.DebugHelpers.GeometryToken.Nodes:this.ReadNodes();break;case Microsoft.Msagl.DebugHelpers.GeometryToken.Edges:this.ReadEdges();break;case Microsoft.Msagl.DebugHelpers.GeometryToken.Clusters:this.ReadClusters();break;case Microsoft.Msagl.DebugHelpers.GeometryToken.LayoutAlgorithmSettings:this.set_Settings(this.ReadLayoutAlgorithmSettings(this.get_XmlReader()));break;case Microsoft.Msagl.DebugHelpers.GeometryToken.LgLevels:this.ReadLgLevels();break;case Microsoft.Msagl.DebugHelpers.GeometryToken.LgSkeletonLevels:this.ReadLgSkeletonLevels();break;case Microsoft.Msagl.DebugHelpers.GeometryToken.End:case Microsoft.Msagl.DebugHelpers.GeometryToken.Graph:if(this.get_XmlReader().get_NodeType()==15){n=!0;this.ReadEndElement();break}if(this.get_XmlReader().get_NodeType()==0){n=!0;break}this.XmlRead();break;default:this.get_XmlReader().Skip()}while(!n);this._graph.set_BoundingBox(this._graph.PumpTheBoxToTheGraphWithMargins())},ReadLgLevels:function(){var n=new Microsoft.Msagl.Layout.LargeGraphLayout.LgData.ctor(this._graph);this._graph.set_LgData(n);this.FillLgData(n);this.ReadEndElement()},ReadLgSkeletonLevels:function(){this.XmlRead();this.ReadSkeletonLevels(this._graph.get_LgData());this.ReadEndElement()},FillLgData:function(n){this.XmlRead();this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.LgEdgeInfos)&&this.ReadLgEdgeInfos(n);this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.LgNodeInfos)&&this.ReadLgNodeInfos(n);this.ReadLevels(n)},ReadLgEdgeInfos:function(n){if(this.get_XmlReader().get_IsEmptyElement()){this.XmlRead();return}for(this.XmlRead();this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.LgEdgeInfo);)this.ReadLgEdgeInfo(n);this.ReadEndElement()},ReadLgEdgeInfo:function(n){var i=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.EdgeId),t=this.idToEdges.get_Item$$TKey(i);n.GeometryEdgesToLgEdgeInfos.set_Item$$TKey(t,function(){var n=new Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor(t);return n.set_Rank(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Rank)),n.set_ZoomLevel(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Zoomlevel)),n}.call(this));this.XmlRead()},ReadLevels:function(n){for(var i=1,t;this.GetElementTag()==Microsoft.Msagl.DebugHelpers.GeometryToken.Level;)t=this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.Zoomlevel,i),this.ReadLevel(n,t|0),i=2*t|0},ReadSkeletonLevels:function(n){for(var i=1,t;this.GetElementTag()==Microsoft.Msagl.DebugHelpers.GeometryToken.SkeletonLevel;)t=this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.Zoomlevel,i),this.ReadSkeletonLevel(n,t|0),i=2*t|0},ReadLevel:function(n,t){var u=this.GetIntAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.NodeCountOnLevel),i,r;n.get_LevelNodeCounts()==null&&n.set_LevelNodeCounts(new System.Collections.Generic.List$1.ctor(System.Int32.ctor));n.get_LevelNodeCounts().Add(u);i=new Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.ctor(t,this._graph);n.get_Levels().Add(i);this.XmlRead();r=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor);this.ReadRailIdsPerEdgeIds(n,r);this.ReadRails(i);this.ReadEndElement();this.FillRailsOfEdges(i,r)},ReadSkeletonLevel:function(n,t){var i=function(){var n=new Microsoft.Msagl.Layout.LargeGraphLayout.LgSkeletonLevel.ctor;return n.ZoomLevel=t,n}.call(this);if(n.SkeletonLevels.Add(i),this.get_XmlReader().get_IsEmptyElement()){this.XmlRead();return}this.XmlRead();this.ReadEndElement()},FillRailsOfEdges:function(n,t){for(var i=t.GetEnumerator();i.MoveNext();){var r=i.get_Current(),u=this.idToEdges.get_Item$$TKey(r.get_Key()),f=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.String.ctor,Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.String.ctor,r.get_Value(),$CreateAnonymousDelegate(this,function(n){return n!=""})),$CreateAnonymousDelegate(this,function(n){return this.idToRails.get_Item$$TKey(n)})));n._railsOfEdges.set_Item$$TKey(u,f)}},ReadRailIdsPerEdgeIds:function(n,t){if(this.get_XmlReader().get_IsEmptyElement()){this.XmlRead();return}for(this.XmlRead();this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.EdgeRails);)this.ReadEdgeRailIds(n,t);this.ReadEndElement()},ReadEdgeRailIds:function(n,t){var f=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.EdgeId),e,o,s;t.set_Item$$TKey(f,e=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.String.ctor));o=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.EdgeRails);s=n.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(this.idToEdges.get_Item$$TKey(f));for(var i=0,r=o.Split$$Char$Array(" "),h=r.length,u=r[i];i<h;i++,u=r[i])this.UpdateToRankedEdgeInfoForRail(u,s),e.Insert(u);this.XmlRead()},UpdateToRankedEdgeInfoForRail:function(n,t){var i;(function(){var t={Value:i},r=this.railIdsToTopRankedEdgeInfo.TryGetValue(n,t);return i=t.Value,r}).call(this)?i.get_Rank()<t.get_Rank()&&this.railIdsToTopRankedEdgeInfo.set_Item$$TKey(n,t):this.railIdsToTopRankedEdgeInfo.set_Item$$TKey(n,t)},ReadRails:function(n){if(this.CheckToken(Microsoft.Msagl.DebugHelpers.GeometryToken.Rails),this.get_XmlReader().get_IsEmptyElement()){this.XmlRead();return}for(this.XmlRead();this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.Rail);)this.ReadRail(n);this.ReadEndElement()},ReadSkeletonRails:function(n){if(this.CheckToken(Microsoft.Msagl.DebugHelpers.GeometryToken.Rails),this.get_XmlReader().get_IsEmptyElement()){this.XmlRead();return}for(this.XmlRead();this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.Rail);)this.ReadSkeletonRail(n);this.ReadEndElement()},ReadRail:function(n){var t=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Id),i=this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Zoomlevel)|0,u=this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.MinPassingEdgeZoomLevel,i),f=this.GetTopRankedEdgeInfoOfRail(t),r=this.ContinueReadingRail(f,i,n);r.MinPassingEdgeZoomLevel=u;this.idToRails.set_Item$$TKey(t,r)},ReadSkeletonRail:function(){return},ContinueReadingRail:function(n,t,i){var o,s,e,f,h,r,u;if(this.XmlRead(),this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.Arrowhead)){var c=this.TryGetPointAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.ArrowheadPosition),l=this.TryGetPointAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.CurveAttachmentPoint),a=function(){var n=new Microsoft.Msagl.Core.Layout.Arrowhead.ctor;return n.set_TipPosition(c),n.set_Length(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(l,c).get_Length()),n}.call(this);return this.XmlRead(),this.ReadEndElement(),r=new Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor$$Arrowhead$$Point$$LgEdgeInfo$$Int32(a,l,n,t),u=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,c,l),i._railDictionary.set_Item$$TKey(u,r),r}if(this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.LineSegment))return o=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Points),s=this.ParsePoints(o),System.Diagnostics.Debug.Assert$$Boolean(s.length==2),e=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(s[0],s[1]),this.XmlRead(),this.ReadEndElement(),r=new Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor$$ICurve$$LgEdgeInfo$$Int32(e,n,t),u=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,e.get_Start(),e.get_End()),i._railDictionary.set_Item$$TKey(u,r),i._railTree.Add$$Rectangle$$TData(e.get_BoundingBox(),r),r;if(this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.CubicBezierSegment))return o=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Points),f=this.ParsePoints(o),System.Diagnostics.Debug.Assert$$Boolean(f.length==4),h=new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(f[0],f[1],f[2],f[3]),this.XmlRead(),this.ReadEndElement(),r=new Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor$$ICurve$$LgEdgeInfo$$Int32(h,n,t),u=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,h.get_Start(),h.get_End()),i._railDictionary.set_Item$$TKey(u,r),r;throw $CreateException(new System.Exception.ctor,new Error);},GetTopRankedEdgeInfoOfRail:function(n){return this.railIdsToTopRankedEdgeInfo.ContainsKey(n)?this.railIdsToTopRankedEdgeInfo.get_Item$$TKey(n):null},GetTopRankedEdgeInfoOfSkeletonRail:function(n){return this.railIdsToTopRankedEdgeInfo.ContainsKey(n)?this.railIdsToTopRankedEdgeInfo.get_Item$$TKey(n):null},ReadLgNodeInfos:function(n){if(!this.get_XmlReader().get_IsEmptyElement()){for(n.GeometryNodesToLgNodeInfos=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor),n.set_SortedLgNodeInfos(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor)),this.XmlRead();this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.LgNodeInfo);)this.ReadLgNodeInfo(n);this.ReadEndElement()}},ReadLgNodeInfo:function(n){var t=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Id),i=function(){var n=new Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor(this.nodeIdToNodes.get_Item$$TKey(t));return n.set_Rank(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Rank)),n.set_ZoomLevel(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Zoomlevel)),n.LabelVisibleFromScale=this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.LabelVisibleFromScale,1),n.LabelWidthToHeightRatio=this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.LabelWidthToHeightRatio,1),n.set_LabelOffset(this.TryGetPointAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LabelOffset)),n}.call(this);n.get_SortedLgNodeInfos().Add(i);n.GeometryNodesToLgNodeInfos.set_Item$$TKey(this.nodeIdToNodes.get_Item$$TKey(t),i);this.XmlRead()},GetElementTag:function(){if(this.get_XmlReader().get_NodeType()==15&&this.get_XmlReader().get_Name()=="graph")return Microsoft.Msagl.DebugHelpers.GeometryToken.End;var n;return this.get_XmlReader().get_ReadState()==3?Microsoft.Msagl.DebugHelpers.GeometryToken.Graph:function(){var t={Value:n},i=System.Enum.TryParse$1$$String$$Boolean$$TEnum(Microsoft.Msagl.DebugHelpers.GeometryToken.ctor,this.get_XmlReader().get_Name(),!0,t);return n=t.Value,i}.call(this)?n:Microsoft.Msagl.DebugHelpers.GeometryToken.Unknown},ReadClusters:function(){var n,i,t;for(this.XmlRead();this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.Cluster);)this.ReadCluster();for(this.FleshOutClusters(),n=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor),i=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.DebugHelpers.ClusterWithChildLists.ctor,Microsoft.Msagl.Core.Layout.Cluster.ctor,this.stringToClusters.get_Values(),$CreateAnonymousDelegate(this,function(n){return n.Cluster})).GetEnumerator();i.MoveNext();)t=i.get_Current(),t.get_ClusterParents()!=null&&System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,t.get_ClusterParents())||n.Insert(t);n.get_Count()==1?this._graph.set_RootCluster(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n)):this._graph.get_RootCluster().AddRangeOfCluster(n);this.get_XmlReader().IsStartElement()||this.ReadEndElement()},FleshOutClusters:function(){for(var r=this.stringToClusters.get_Values().GetEnumerator(),i,n;r.MoveNext();){for(var t=r.get_Current(),u=t.Cluster,f=t.ChildClusters.GetEnumerator();f.MoveNext();)n=f.get_Current(),u.AddCluster(this.stringToClusters.get_Item$$TKey(n).Cluster);for(i=t.ChildNodes.GetEnumerator();i.MoveNext();)n=i.get_Current(),u.AddNode(this.nodeIdToNodes.get_Item$$TKey(n))}},ReadCluster:function(){var n=function(){var n=new Microsoft.Msagl.Core.Layout.Cluster.ctor;return n.set_RectangularBoundary(new Microsoft.Msagl.Core.Geometry.RectangularClusterBoundary.ctor),n}.call(this),t=new Microsoft.Msagl.DebugHelpers.ClusterWithChildLists.ctor(n),i;n.Barycenter=this.TryGetPointAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Barycenter);i=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Id);this.stringToClusters.set_Item$$TKey(i,t);this.ReadChildClusters(t.ChildClusters);this.ReadChildNodes(t.ChildNodes);this.XmlRead();switch(this.NameToToken()){case Microsoft.Msagl.DebugHelpers.GeometryToken.ICurve:n.set_BoundaryCurve(this.ReadICurve());break;case Microsoft.Msagl.DebugHelpers.GeometryToken.Curve:n.set_BoundaryCurve(this.ReadCurve());this.XmlRead();break;case Microsoft.Msagl.DebugHelpers.GeometryToken.Rect:n.set_BoundaryCurve(this.ReadRect());this.XmlRead()}this.get_XmlReader().get_NodeType()!=15&&n.set_RectangularBoundary(this.ReadClusterRectBoundary());this.ReadEndElement()},ReadClusterRectBoundary:function(){var n=function(){var n=new Microsoft.Msagl.Core.Geometry.RectangularClusterBoundary.ctor;return n.set_LeftMargin(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LeftMargin)),n.set_RightMargin(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.RightMargin)),n.set_TopMargin(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.TopMargin)),n.set_BottomMargin(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.BottomMargin)),n}.call(this),t,i,r,u,f,e;if(this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.DefaultLeftMargin)!=null){var o=this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.DefaultLeftMargin),s=this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.DefaultRightMargin),h=this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.DefaultBottomMargin),c=this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.DefaultBottomMargin);n.StoreDefaultMargin$$Double$$Double$$Double$$Double(o,s,c,h)}return n.set_GenerateFixedConstraints(this.GetBoolAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.GenerateFixedConstraints,!1)),n.set_GenerateFixedConstraintsDefault(this.GetBoolAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.GenerateFixedConstraintsDefault,!1)),n.set_MinHeight(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.MinNodeHeight)),n.set_MinWidth(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.MinNodeWidth)),this.XmlRead(),function(){var n={Value:i},o={Value:r},s={Value:u},h={Value:f},c={Value:e},l={Value:t},a=this.ReadRectParams(n,o,s,h,c,l);return i=n.Value,r=o.Value,u=s.Value,f=h.Value,e=c.Value,t=l.Value,a}.call(this),n.set_Rect(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Point(i,r,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,f))),n.set_RadiusX(e),n.set_RadiusY(t),n.set_RightBorderInfo(this.ReadBorderInfo(Microsoft.Msagl.DebugHelpers.GeometryToken.RightBorderInfo)),n.set_LeftBorderInfo(this.ReadBorderInfo(Microsoft.Msagl.DebugHelpers.GeometryToken.LeftBorderInfo)),n.set_TopBorderInfo(this.ReadBorderInfo(Microsoft.Msagl.DebugHelpers.GeometryToken.TopBorderInfo)),n.set_BottomBorderInfo(this.ReadBorderInfo(Microsoft.Msagl.DebugHelpers.GeometryToken.BottomBorderInfo)),this.XmlRead(),this.ReadEndElement(),n},ReadBorderInfo:function(n){this.XmlRead();this.CheckToken(n);return function(){var n=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;return n.set_InnerMargin(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.InnerMargin)),n.set_FixedPosition(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.FixedPosition)),n.set_Weight(this.GetDoubleAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Weight)),n}.call(this)},ReadChildClusters:function(n){var t=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.ChildClusters);System.String.IsNullOrEmpty(t)||n.AddRange(t.Split$$Char$Array(" "))},ReadChildNodes:function(n){var t=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.ChildNodes);System.String.IsNullOrEmpty(t)||n.AddRange(t.Split$$Char$Array(" "))},ReadEdges:function(){if(this.CheckToken(Microsoft.Msagl.DebugHelpers.GeometryToken.Edges),this.get_XmlReader().get_IsEmptyElement()){this.XmlRead();return}for(this.XmlRead();this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.Edge);)this.ReadEdge();this.ReadEndElement()},ReadEdge:function(){var t,r;this.CheckToken(Microsoft.Msagl.DebugHelpers.GeometryToken.Edge);var u=this.ReadSourceNode(),f=this.ReadTargetNode(),n=function(){var n=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(u,f);return n.set_Separation(this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.Separation,1)|0),n.set_LineWidth(this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.LineWidth,1)),n.set_Weight(this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.Weight,1)|0),n}.call(this),i=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Id);if(i!=null?(System.Diagnostics.Debug.Assert$$Boolean(this.idToEdges.ContainsKey(i)==!1),this.idToEdges.set_Item$$TKey(i,n)):System.Diagnostics.Debug.Assert$$Boolean(this.idToEdges.get_Count()==0),this.EdgeList.Add(n),this.ReadArrowheadAtSource(n),this.ReadArrowheadAtTarget(n),this.ReadLabelFromAttribute(n),t=!1,this._graph.get_Edges().Add(n),this.get_XmlReader().get_IsEmptyElement()){this.get_XmlReader().Skip();return}this.XmlRead();do{r=this.GetElementTag();switch(r){case Microsoft.Msagl.DebugHelpers.GeometryToken.Curve:n.set_Curve(this.ReadICurve());break;case Microsoft.Msagl.DebugHelpers.GeometryToken.LineSegment:n.set_Curve(this.ReadLineSeg());break;case Microsoft.Msagl.DebugHelpers.GeometryToken.Edge:this.ReadEndElement();t=!0;break;case Microsoft.Msagl.DebugHelpers.GeometryToken.CubicBezierSegment:n.set_Curve(this.ReadCubucBezierSegment());break;case Microsoft.Msagl.DebugHelpers.GeometryToken.Polyline:break;default:t=!0}t||this.XmlRead()}while(!t)},ReadCubucBezierSegment:function(){var i=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Points),r=i.Split$$Char$Array(" "),t=System.Linq.Enumerable.ToList$1(System.String.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.String.ctor,r,$CreateAnonymousDelegate(this,function(n){return!System.String.IsNullOrEmpty(n)}))),n;return t.get_Count()!=8&&this.Error("wrong number of points in LineSegment"),n=System.Linq.Enumerable.ToArray$1(System.Double.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.String.ctor,System.Double.ctor,t,$CreateDelegate(this,this.ParseDouble))),new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[0],n[1]),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[2],n[3]),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[4],n[5]),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[6],n[7]))},ReadArrowheadAtSource:function(n){var t=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.As),i=function(t){return n.get_EdgeGeometry().set_SourceArrowhead(t),t}.call(this,t!=null?function(){var n=new Microsoft.Msagl.Core.Layout.Arrowhead.ctor;return n.set_TipPosition(this.ParsePoint(t)),n}.call(this):null);i!=null?i.set_Length(this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.Asl,10)):(t=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Asl),t!=null&&n.get_EdgeGeometry().set_SourceArrowhead(function(){var n=new Microsoft.Msagl.Core.Layout.Arrowhead.ctor;return n.set_Length(this.ParseDouble(t)),n}.call(this)))},ParsePoint:function(n){var t=System.Linq.Enumerable.ToArray$1(System.String.ctor,n.Split$$Char$Array(" ")),i,r;return(System.Diagnostics.Debug.Assert$$Boolean(t.length==2),function(){var n={Value:i},r=System.Double.TryParse$$String$$Double(t[0],n);return i=n.Value,r}.call(this)&&function(){var n={Value:r},i=System.Double.TryParse$$String$$Double(t[1],n);return r=n.Value,i}.call(this))?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i,r):(this.Error("invalid point format"+n),new Microsoft.Msagl.Core.Geometry.Point.ctor)},ParsePoints:function(n){var i=n.Split$$Char$Array(" "),r,t,u,f;for(System.Diagnostics.Debug.Assert$$Boolean(i.length%2==0),r=new Array(i.length/2|0),t=0;t<i.length-1;t+=2)(function(){var n={Value:u},r=System.Double.TryParse$$String$$Double(i[t],n);return u=n.Value,r}).call(this)&&function(){var n={Value:f},r=System.Double.TryParse$$String$$Double(i[t+1],n);return f=n.Value,r}.call(this)?r[t/2|0]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,f):this.Error("invalid point format"+n);return r},ReadArrowheadAtTarget:function(n){var t=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.At),i=function(t){return n.get_EdgeGeometry().set_TargetArrowhead(t),t}.call(this,t!=null?function(){var n=new Microsoft.Msagl.Core.Layout.Arrowhead.ctor;return n.set_TipPosition(this.ParsePoint(t)),n}.call(this):null);i!=null?i.set_Length(this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.Atl,10)):(t=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Atl),t!=null&&n.get_EdgeGeometry().set_TargetArrowhead(function(){var n=new Microsoft.Msagl.Core.Layout.Arrowhead.ctor;return n.set_Length(this.ParseDouble(t)),n}.call(this)))},ReadLabelFromAttribute:function(n){var i,t,r,u,f,e;(function(){var n={Value:i},t=this.TryGetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Label,n);return i=n.Value,t}).call(this)&&(t=new Microsoft.Msagl.Core.Layout.Label.ctor$$GeometryObject(n),function(){var n={Value:r},t={Value:u},e={Value:f},o=this.ParseLabel(i,n,t,e);return r=n.Value,u=t.Value,f=e.Value,o}.call(this),t.set_Center(r),t.set_Width(u),t.set_Height(f),e=As(n,Microsoft.Msagl.Core.Layout.Edge.ctor),e!=null&&e.set_Label(t))},ParseLabel:function(n,t,i,r){var u=n.Split$$Char$Array(" ");System.Diagnostics.Debug.Assert$$Boolean(u.length==4);t.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ParseDouble(u[0]),this.ParseDouble(u[1]));i.Value=this.ParseDouble(u[2]);r.Value=this.ParseDouble(u[3])},ParseDouble:function(n){var t;return function(){var i={Value:t},r=System.Double.TryParse$$String$$Double(n,i);return t=i.Value,r}.call(this)?t:(this.Error(" cannot parse double "+n),0)},ReadTargetNode:function(){var n=this.GetMustAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.T);return this.GetNodeOrClusterById(n)},ReadSourceNode:function(){var n=this.GetMustAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.S);return this.GetNodeOrClusterById(n)},GetNodeOrClusterById:function(n){var t;return function(){var i={Value:t},r=this.nodeIdToNodes.TryGetValue(n,i);return t=i.Value,r}.call(this)?t:this.stringToClusters.get_Item$$TKey(n).Cluster},ReadNodes:function(){if(!this.get_XmlReader().get_IsEmptyElement()){for(this.XmlRead();this.TokenIs(Microsoft.Msagl.DebugHelpers.GeometryToken.Node);)this.ReadNode();this.ReadEndElement()}},ReadNode:function(){var t=this.GetMustAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Id),i=this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.Padding,1),n;if(this.XmlRead(),n=function(){var n=new Microsoft.Msagl.Core.Layout.Node.ctor$$ICurve(this.ReadICurve());return n.set_Padding(i),n.set_UserData(t),n}.call(this),n.get_BoundaryCurve()==null)throw $CreateException(new System.InvalidOperationException.ctor,new Error);this._graph.get_Nodes().Add(n);this.get_XmlReader().Skip();this.ReadEndElement();this.nodeIdToNodes.set_Item$$TKey(t,n)},GetAttribute:function(n){return this.get_XmlReader().GetAttribute$$String(Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.FirstCharToLower(n))},TryGetAttribute:function(n,t){return(t.Value=this.GetAttribute(n))!=null},GetMustAttribute:function(n){var i=Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.FirstCharToLower(n),t=this.get_XmlReader().GetAttribute$$String(Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.FirstCharToLower(n));return t!=null?t:(this.Error("attribute "+i+" not found"),null)},GetIntAttribute:function(n){var t=this.GetAttribute(n),i;return(t==null&&this.Error(System.String.Format$$String$$Object("attribute {0} not found",n)),function(){var n={Value:i},r=System.Int32.TryParse$$String$$Int32(t,n);return i=n.Value,r}.call(this))?i:(this.Error("cannot parse an int value "+t),0)},GetDoubleAttribute:function(n){var t=this.GetAttribute(n),i;return(t==null&&this.Error(System.String.Format$$String$$Object("attribute {0} not found",n)),function(){var n={Value:i},r=System.Double.TryParse$$String$$Double(t,n);return i=n.Value,r}.call(this))?i:(this.Error("cannot parse an int value "+t),0)},GetDoubleAttributeOrDefault:function(n,t){var i=this.GetAttribute(n),r;return i==null?t:function(){var n={Value:r},t=System.Double.TryParse$$String$$Double(i,n);return r=n.Value,t}.call(this)?r:(this.Error("cannot parse a double value "+i),0)},GetBoolAttributeOrDefault:function(n,t){var i=this.GetAttribute(n),r;return i==null?t:function(){var n={Value:r},t=System.Boolean.TryParse(i,n);return r=n.Value,t}.call(this)?r:(this.Error("cannot parse a bool value "+i),!1)},GetIntAttributeOrDefault:function(n,t){var i=this.GetAttribute(n),r;return i==null?t:function(){var n={Value:r},t=System.Int32.TryParse$$String$$Int32(i,n);return r=n.Value,t}.call(this)?r:(this.Error("cannot parse a bool value "+i),0)},TryGetPointAttribute:function(n){var t=this.GetAttribute(n);return t==null?new Microsoft.Msagl.Core.Geometry.Point.ctor:this.ParsePoint(t)},Error:function(n){throw $CreateException(new System.InvalidOperationException.ctor$$String(n+";"+this.GetPositionInfo()),new Error);},ReadICurve:function(){switch(this.NameToToken()){case Microsoft.Msagl.DebugHelpers.GeometryToken.Curve:return this.ReadCurve();case Microsoft.Msagl.DebugHelpers.GeometryToken.Ellipse:return this.ReadEllipse();case Microsoft.Msagl.DebugHelpers.GeometryToken.Rect:return this.ReadRect();case Microsoft.Msagl.DebugHelpers.GeometryToken.Polygon:return this.ReadPolygon()}return null},ReadPolygon:function(){var r=this.GetMustAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Points),n=r.Split$$Char$Array(" "),i,t;for((n.length==0||n.length%2!=0)&&this.Error("invalid input for the polygon"),i=function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor;return n.set_Closed(!0),n}.call(this),t=0;t<n.length;t+=2)i.AddPoint$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ParseDouble(n[t]),this.ParseDouble(n[t+1])));return i},ReadRect:function(){var n,i,r,u,f,t,e;return function(){var e={Value:t},o={Value:n},s={Value:i},h={Value:r},c={Value:u},l={Value:f},a=this.ReadRectParams(e,o,s,h,c,l);return t=e.Value,n=o.Value,i=s.Value,r=h.Value,u=c.Value,f=l.Value,a}.call(this),e=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(t,n,t+i,n+r),new Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor$$Rectangle$$Double$$Double(e,u,f)},ReadRectParams:function(n,t,i,r,u,f){n.Value=this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.X,0);t.Value=this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.Y,0);i.Value=this.ParseDouble(this.GetMustAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Width));r.Value=this.ParseDouble(this.GetMustAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Height));u.Value=this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.Rx,0);f.Value=this.GetDoubleAttributeOrDefault(Microsoft.Msagl.DebugHelpers.GeometryToken.Ry,0)},ReadCurve:function(){if(this.get_XmlReader().MoveToFirstAttribute()){var n=this.NameToToken();switch(n){case Microsoft.Msagl.DebugHelpers.GeometryToken.CurveData:return this.ParseCurve(this.get_XmlReader().get_Value())}throw $CreateException(new System.InvalidOperationException.ctor,new Error);}return this.Error("No boundary curve is defined"),null},NameToToken:function(){var n;return function(){var t={Value:n},i=System.Enum.TryParse$1$$String$$Boolean$$TEnum(Microsoft.Msagl.DebugHelpers.GeometryToken.ctor,this.get_XmlReader().get_Name(),!0,t);return n=t.Value,i}.call(this)?n:(this.Error("cannot parse "+this.get_XmlReader().get_Name()),Microsoft.Msagl.DebugHelpers.GeometryToken.Error)},ParseCurve:function(n){var r=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,u=new Microsoft.Msagl.DebugHelpers.CurveStream.ctor(n),f=new Microsoft.Msagl.Core.Geometry.Point.ctor,t,i;do{if(t=u.GetNextCurveStreamElement(),t==null)return r;if(i=As(t,Microsoft.Msagl.DebugHelpers.Persistence.CharStreamElement.ctor),i==null)return this.Error("wrong formatted curve string "+t),null;(function(){var n={Value:f},t=this.AddCurveSegment(u,i.get_Char(),r,n);return f=n.Value,t}).call(this)}while(1)},AddCurveSegment:function(n,t,i,r){switch(t){case"M":r.Value=this.GetNextPointFromCurveData(n);break;case"m":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"Z":case"z":i.get_Segments().get_Count()==0&&this.Error("the curve is too short");i.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r.Value,r.Value=i.get_Start()));break;case"L":this.ProceedWithLines(i,n,r);break;case"l":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"H":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"h":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"V":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"v":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"C":this.ProceedWithCubicBeziers(i,n,r);break;case"c":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"S":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"s":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"Q":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"q":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"T":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"t":throw $CreateException(new System.NotImplementedException.ctor,new Error);case"A":this.ReadEllepticalArc$$Curve$$CurveStream$$Point(i,n,r);break;case"a":throw $CreateException(new System.NotImplementedException.ctor,new Error);default:this.Error("unknown character "+t)}},ProceedWithCubicBeziers:function(n,t,i){do n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(i.Value,this.GetNextPointFromCurveData(t),this.GetNextPointFromCurveData(t),i.Value=this.GetNextPointFromCurveData(t)));while(Is(t.PickNextCurveStreamElement(),Microsoft.Msagl.DebugHelpers.DoubleStreamElement.ctor))},ReadEllepticalArc$$Curve$$CurveStream$$Point:function(n,t,i){n.AddSegment(this.ReadEllepticalArc$$CurveStream$$Point(t,i))},ReadEllepticalArc$$CurveStream$$Point:function(n,t){var u=this.GetNextDoubleFromCurveData(n),l=this.GetNextDoubleFromCurveData(n),a=this.GetNextDoubleFromCurveData(n)/180*3.14159265358979,b=this.GetNextDoubleFromCurveData(n)|0,k=this.GetNextDoubleFromCurveData(n)|0,f=this.GetNextPointFromCurveData(n),y,i,o,s,r,p,h,w,c;(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(u,0)||Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(l,0))&&this.Error("ellipseArc radius is too small");var v=u/l,d=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.Rotation(-a),g=new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(1,0,0,0,v,0),e=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$PlaneTransformation(g,d),nt=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(e,t.Value);return t.Value=f,y=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(e,f),function(){var n={Value:i},t={Value:o},f={Value:s},e={Value:r},h=this.GetArcCenterAndAngles(u,b,k,nt,y,n,t,f,e);return i=n.Value,o=t.Value,s=f.Value,r=e.Value,h}.call(this),p=e.get_Inverse(),i=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(p,i),h=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.Rotation(a),w=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(h,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,0)),r=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(h,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(r,v)),c=new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Point(o,s,w,r,i),System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(c.get_End(),f)),c},GetArcCenterAndAngles:function(n,t,i,r,u,f,e,o,s){var h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u,r),v=h.get_LengthSquared(),y=h.get_Length(),a=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(r,u),2),c,l;h=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(h,y);c=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(h.get_Y(),-h.get_X()),System.Math.Sqrt(n*n-v/4));f.Value=i==1&&t==0||i==0&&t==1?Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(a,c):Microsoft.Msagl.Core.Geometry.Point.op_Addition(a,c);l=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,0);s.Value=i==1?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,n):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,-n);e.Value=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(l,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,f.Value));i==0&&(e.Value=6.28318530717959-e.Value);o.Value=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(l,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u,f.Value));i==0&&(o.Value=6.28318530717959-o.Value);Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(o.Value,e.Value)&&t==1?o.Value+=6.28318530717959:o.Value<e.Value&&(o.Value+=6.28318530717959)},ProceedWithLines:function(n,t,i){do n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(i.Value,i.Value=this.GetNextPointFromCurveData(t)));while(Is(t.PickNextCurveStreamElement(),Microsoft.Msagl.DebugHelpers.DoubleStreamElement.ctor))},GetNextPointFromCurveData:function(n){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.GetNextDoubleFromCurveData(n),this.GetNextDoubleFromCurveData(n))},GetNextDoubleFromCurveData:function(n){var i=n.GetNextCurveStreamElement(),t;return i==null&&this.Error("cannot parse curveData"),t=As(i,Microsoft.Msagl.DebugHelpers.DoubleStreamElement.ctor),t==null&&this.Error("cannot parse curveData"),t.get_Double()},ReadLineSeg:function(){var i,t,n;return this.CheckToken(Microsoft.Msagl.DebugHelpers.GeometryToken.LineSegment),i=this.GetAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Points),t=i.Split$$Char$Array(" "),t.length!=4&&this.Error("wrong number of points in LineSegment"),n=System.Linq.Enumerable.ToArray$1(System.Double.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.String.ctor,System.Double.ctor,t,$CreateDelegate(this,this.ParseDouble))),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[0],n[1]),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[2],n[3]))},ReadEllipse:function(){var n=this.ParseDouble(this.GetMustAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Cx)),t=this.ParseDouble(this.GetMustAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Cy)),i=this.ParseDouble(this.GetMustAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Rx)),r=this.ParseDouble(this.GetMustAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Ry));return new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point(i,r,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,t))},TokenIs:function(n){return this.get_XmlReader().IsStartElement$$String(Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.FirstCharToLower(n))||this.get_XmlReader().IsStartElement$$String(n.toString())},MoveToContent:function(){this.get_XmlReader().MoveToContent()},XmlReader$$:"System.Xml.XmlReader",get_XmlReader:function(){return this._XmlReader},set_XmlReader:function(n){this._XmlReader=n},SetXmlReader:function(n){this.set_XmlReader(n)},CheckToken:function(n){if(!this.get_XmlReader().IsStartElement$$String(Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.FirstCharToLower(n))&&!this.get_XmlReader().IsStartElement$$String(n.toString())){var t=this.GetPositionInfo();throw $CreateException(new System.IO.InvalidDataException.ctor$$String(System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"expected {0}, {1}",[n,t])),new Error);}},GetPositionInfo:function(){return this.xmlTextReader!=null?System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"line {0} col {1}",[this.xmlTextReader.get_LineNumber(),this.xmlTextReader.get_LinePosition()]):System.String.Empty},ReadEndElement:function(){this.get_XmlReader().ReadEndElement()},ReadElementContentAsDouble:function(){return this.get_XmlReader().ReadElementContentAsDouble()},XmlRead:function(){this.get_XmlReader().Read()},ReadElementContentAsInt:function(){return this.get_XmlReader().ReadElementContentAsInt()},Dispose$$Boolean:function(n){n&&this.xmlTextReader.Close()},Dispose:function(){this.Dispose$$Boolean(!0);System.GC.SuppressFinalize(this)}}};JsTypes.push(Microsoft$Msagl$DebugHelpers$Persistence$GeometryGraphReader);Microsoft$Msagl$DebugHelpers$Persistence$GeometryGraphWriter={fullname:"Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.FileExtension=".msagl.geom"},Write$$GeometryGraph$$String:function(n,t){Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.Write$$GeometryGraph$$LayoutAlgorithmSettings$$String(n,null,t)},Write$$GeometryGraph$$LayoutAlgorithmSettings$$String:function(n,t,i){var r,u;if(i!=null){i.EndsWith$$String$$StringComparison(".msagl.geom",3)||(i+=".msagl.geom");r=System.IO.File.Open$$String$$FileMode(i,2);try{u=new Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.ctor$$Stream$$GeometryGraph$$LayoutAlgorithmSettings(r,n,t);u.Write()}finally{r.Dispose()}}},FirstCharToLower:function(n){var t=n.toString();return t.substr(0,1).toLowerCase$$CultureInfo(System.Globalization.CultureInfo.get_InvariantCulture())+t.substr(1,t.length-1)},WriteEllepticalArc:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},AxesSwapped:function(n,t){return n.get_X()*t.get_Y()-t.get_X()*n.get_Y()<0}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Stream$$GeometryGraph$$LayoutAlgorithmSettings:function(n,t,i){this.nodeIds=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.String.ctor);this.edgeIds=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Int32.ctor);this.graph=null;this.needToCloseXmlWriter=!0;this.stream=null;this.formatForDoubleString="#.###########";this.precision=11;this.edgeEnumeration=null;this._XmlWriter=null;this._Settings=null;System.Object.ctor.call(this);this.stream=n;this.set_Graph(t);this.set_Settings(i);var r=function(){var n=new System.Xml.XmlWriterSettings.ctor;return n.set_Indent(!0),n}.call(this);this.set_XmlWriter(System.Xml.XmlWriter.Create$$Stream$$XmlWriterSettings(this.stream,r));this.set_EdgeEnumeration(t.get_Edges())},ctor:function(){this.nodeIds=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.String.ctor);this.edgeIds=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Int32.ctor);this.graph=null;this.needToCloseXmlWriter=!0;this.stream=null;this.formatForDoubleString="#.###########";this.precision=11;this.edgeEnumeration=null;this._XmlWriter=null;this._Settings=null;System.Object.ctor.call(this)},NeedToCloseXmlWriter$$:"System.Boolean",get_NeedToCloseXmlWriter:function(){return this.needToCloseXmlWriter},set_NeedToCloseXmlWriter:function(n){this.needToCloseXmlWriter=n},Stream$$:"System.IO.Stream",get_Stream:function(){return this.stream},set_Stream:function(n){this.stream=n},XmlWriter$$:"System.Xml.XmlWriter",get_XmlWriter:function(){return this._XmlWriter},set_XmlWriter:function(n){this._XmlWriter=n},Graph$$:"Microsoft.Msagl.Core.Layout.GeometryGraph",get_Graph:function(){return this.graph},set_Graph:function(n){this.graph=n},Settings$$:"Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings",get_Settings:function(){return this._Settings},set_Settings:function(n){this._Settings=n},Write:function(){var n=System.Threading.Thread.get_CurrentThread().get_CurrentCulture();System.Threading.Thread.get_CurrentThread().set_CurrentCulture(System.Globalization.CultureInfo.get_InvariantCulture());try{this.Open();this.WriteLayoutSettings();this.InitEdgeIds();this.WriteNodes();this.WriteClusters();this.WriteEdges();this.WriteLayers();this.Close()}finally{System.Threading.Thread.get_CurrentThread().set_CurrentCulture(n)}},WriteLayers:function(){var t,n;if(this.graph.get_LgData()!=null){for(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.LgLevels),this.WriteLgEdgeInfos(),this.WriteSortedLgInfos(),t=this.CreateRailIds(),n=0;n<this.graph.get_LgData().get_Levels().get_Count();n++)this.WriteLevel(this.graph.get_LgData().get_Levels().get_Item$$Int32(n),t,this.graph.get_LgData().get_LevelNodeCounts().get_Item$$Int32(n));for(this.WriteEndElement(),this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.LgSkeletonLevels),n=0;n<this.graph.get_LgData().SkeletonLevels.get_Count();n++)this.WriteSkeletonLevel(this.graph.get_LgData().SkeletonLevels.get_Item$$Int32(n),t);this.WriteEndElement()}},WriteLgEdgeInfos:function(){var n;for(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.LgEdgeInfos),n=this.graph.get_LgData().GeometryEdgesToLgEdgeInfos.GetEnumerator();n.MoveNext();){var t=n.get_Current(),i=t.get_Key(),r=t.get_Value();this.WriteLgEdgeInfo(i,r)}this.WriteEndElement()},WriteLgEdgeInfo:function(n,t){this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.LgEdgeInfo);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.EdgeId,this.edgeIds.get_Item$$TKey(n));this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Rank,t.get_Rank());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Zoomlevel,t.get_ZoomLevel());this.WriteEndElement()},WriteLevel:function(n,t,i){this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Level);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.NodeCountOnLevel,i);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Zoomlevel,n.ZoomLevel);this.WriteLevelRails(n,t);this.WriteEndElement()},WriteSkeletonLevel:function(n){this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.SkeletonLevel);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Zoomlevel,n.ZoomLevel);this.WriteEndElement()},WriteLevelRails:function(n,t){var i,r;for(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.RailsPerEdge),i=n._railsOfEdges.GetEnumerator();i.MoveNext();)r=i.get_Current(),this.WriteEdgeRails(r.get_Key(),r.get_Value(),t);this.WriteEndElement();this.WriteRailsGeometry(n,t)},WriteRailsGeometry:function(n,t){var i,r;for(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Rails),i=n._railDictionary.get_Values().GetEnumerator();i.MoveNext();)r=i.get_Current(),this.WriteRail(r,t.get_Item$$TKey(r));this.WriteEndElement()},WriteRail:function(n,t){var i,r;if(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Rail),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Id,t),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Zoomlevel,n.ZoomLevel),n.MinPassingEdgeZoomLevel!=1.79769313486232E+308&&this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.MinPassingEdgeZoomLevel,n.MinPassingEdgeZoomLevel),i=As(n.Geometry,Microsoft.Msagl.Core.Layout.Arrowhead.ctor),i!=null)this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Arrowhead),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.ArrowheadPosition,i.get_TipPosition()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.CurveAttachmentPoint,n.CurveAttachmentPoint),this.WriteEndElement();else if(r=As(n.Geometry,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor),r!=null)this.WriteICurve(r);else throw $CreateException(new System.InvalidOperationException.ctor,new Error);this.WriteEndElement()},WriteEdgeRails:function(n,t,i){var r,u,f;for(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.EdgeRails),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.EdgeId,this.edgeIds.get_Item$$TKey(n)),r=new System.Collections.Generic.List$1.ctor(System.String.ctor),u=t.GetEnumerator();u.MoveNext();)f=u.get_Current(),r.Add(i.get_Item$$TKey(f).toString());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.EdgeRails,System.String.Join$$String$$IEnumerable$1$String(" ",r));this.WriteEndElement()},CreateRailIds:function(){for(var n=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor,System.Int32.ctor),f=0,r=this.graph.get_LgData().get_Levels().GetEnumerator(),u,t,i;r.MoveNext();)for(u=r.get_Current(),t=u._railDictionary.get_Values().GetEnumerator();t.MoveNext();)(i=t.get_Current(),n.ContainsKey(i))||n.set_Item$$TKey(i,f++);return n},WriteSortedLgInfos:function(){var n,t;for(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.LgNodeInfos),n=this.graph.get_LgData().get_SortedLgNodeInfos().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.WriteLgNodeInfo(t);this.WriteEndElement()},WriteLgNodeInfo:function(n){this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.LgNodeInfo);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Id,this.nodeIds.get_Item$$TKey(n.get_GeometryNode()));this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Rank,n.get_Rank());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Zoomlevel,n.get_ZoomLevel());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LabelVisibleFromScale,n.LabelVisibleFromScale);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LabelOffset,n.get_LabelOffset());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LabelWidthToHeightRatio,n.LabelWidthToHeightRatio);this.WriteEndElement()},InitEdgeIds:function(){for(var i=0,n=this.graph.get_Edges().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.edgeIds.set_Item$$TKey(t,i++)},WriteIpe:function(){var n=System.Threading.Thread.get_CurrentThread().get_CurrentCulture();System.Threading.Thread.get_CurrentThread().set_CurrentCulture(System.Globalization.CultureInfo.get_InvariantCulture());try{this.Open();this.WriteNodesIpe();this.Close()}finally{System.Threading.Thread.get_CurrentThread().set_CurrentCulture(n)}},WriteClusters:function(){var n,t;if(this.graph.get_RootCluster()!=null){for(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Clusters),this.MapClustersToIds(this.graph.get_RootCluster()),n=this.graph.get_RootCluster().AllClustersDepthFirstExcludingSelf().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.WriteCluster(t,this.nodeIds.get_Item$$TKey(t));this.WriteEndElement()}},WriteCluster:function(n,t){this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Cluster);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Id,t);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Barycenter,n.Barycenter);this.WriteChildClusters(n);this.WriteChildNodes(n);n.get_BoundaryCurve()!=null&&this.WriteICurve(n.get_BoundaryCurve());this.WriteClusterRectBoundary(n.get_RectangularBoundary());this.WriteEndElement()},WriteClusterRectBoundary:function(n){n!=null&&(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.RectangularClusterBoundary),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LeftMargin,n.get_LeftMargin()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.RightMargin,n.get_RightMargin()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.TopMargin,n.get_TopMargin()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.BottomMargin,n.get_BottomMargin()),n.get_DefaultMarginIsSet()&&(this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.DefaultLeftMargin,n.get_DefaultLeftMargin()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.DefaultRightMargin,n.get_DefaultRightMargin()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.DefaultTopMargin,n.get_DefaultTopMargin()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.DefaultBottomMargin,n.get_DefaultBottomMargin())),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.GenerateFixedConstraints,n.get_GenerateFixedConstraints()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.GenerateFixedConstraintsDefault,n.get_GenerateFixedConstraintsDefault()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.MinNodeHeight,n.get_MinHeight()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.MinNodeWidth,n.get_MinWidth()),this.WriteRect(n.get_Rect().get_Left(),n.get_Rect().get_Bottom(),n.get_Rect().get_Width(),n.get_Rect().get_Height(),n.get_RadiusX(),n.get_RadiusY()),this.WriteBorderInfo(Microsoft.Msagl.DebugHelpers.GeometryToken.RightBorderInfo,n.get_RightBorderInfo()),this.WriteBorderInfo(Microsoft.Msagl.DebugHelpers.GeometryToken.LeftBorderInfo,n.get_LeftBorderInfo()),this.WriteBorderInfo(Microsoft.Msagl.DebugHelpers.GeometryToken.TopBorderInfo,n.get_TopBorderInfo()),this.WriteBorderInfo(Microsoft.Msagl.DebugHelpers.GeometryToken.BottomBorderInfo,n.get_BottomBorderInfo()),this.WriteEndElement())},WriteBorderInfo:function(n,t){this.WriteStartElement(n);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.InnerMargin,t.get_InnerMargin());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.FixedPosition,t.get_FixedPosition());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Weight,t.get_Weight());this.WriteEndElement()},WriteChildNodes:function(n){this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.ChildNodes,System.String.Join$$String$$IEnumerable$1$String(" ",System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,System.String.ctor,n.nodes,$CreateAnonymousDelegate(this,function(n){return this.nodeIds.get_Item$$TKey(n).ToString$$IFormatProvider(System.Globalization.CultureInfo.get_InvariantCulture())}))))},WriteChildClusters:function(n){this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.ChildClusters,System.String.Join$$String$$IEnumerable$1$String(" ",System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,System.String.ctor,n.get_Clusters(),$CreateAnonymousDelegate(this,function(n){return this.get_NodeToIds().get_Item$$TKey(n)}))))},MapClustersToIds:function(n){for(var t,r=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(System.String.ctor,this.nodeIds.get_Values()),u=n.AllClustersDepthFirst().GetEnumerator(),i;u.MoveNext();)i=u.get_Current(),function(){var n={Value:t},r=this.nodeIds.TryGetValue(i,n);return t=n.Value,r}.call(this)||(t=this.FindNewId(r),this.nodeIds.set_Item$$TKey(i,t),r.Insert(t))},FindNewId:function(n){var i=this.nodeIds.get_Count(),t;do{if(t=i.toString(),!n.Contains$$T(t))return t;i++}while(1)},Open:function(){this.get_XmlWriter().WriteStartElement$$String(Microsoft.Msagl.DebugHelpers.GeometryToken.Graph.toString().toLowerCase());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Margins,this.graph.get_Margins())},Close:function(){this.get_XmlWriter().WriteEndElement();this.get_NeedToCloseXmlWriter()&&(this.get_XmlWriter().WriteEndDocument(),this.get_XmlWriter().Flush(),this.get_XmlWriter().Close())},WriteEdges:function(){var n,t;for(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Edges),n=this.get_EdgeEnumeration().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.WriteEdge(t);this.WriteEndElement()},NodeOrClusterId:function(n){return this.nodeIds.get_Item$$TKey(n)},WriteEdge:function(n){this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Edge);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Id,this.edgeIds.get_Item$$TKey(n));this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.S,this.NodeOrClusterId(n.get_Source()).ToString$$IFormatProvider(System.Globalization.CultureInfo.get_InvariantCulture()));this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.T,this.NodeOrClusterId(n.get_Target()).ToString$$IFormatProvider(System.Globalization.CultureInfo.get_InvariantCulture()));n.get_LineWidth()!=1&&this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LineWidth,n.get_LineWidth());n.get_ArrowheadAtSource()&&(this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.As,n.get_EdgeGeometry().get_SourceArrowhead().get_TipPosition()),this.WriteDefaultDouble(Microsoft.Msagl.DebugHelpers.GeometryToken.Asl,n.get_EdgeGeometry().get_SourceArrowhead().get_Length(),10));n.get_ArrowheadAtTarget()&&(this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.At,n.get_EdgeGeometry().get_TargetArrowhead().get_TipPosition()),this.WriteDefaultDouble(Microsoft.Msagl.DebugHelpers.GeometryToken.Atl,n.get_EdgeGeometry().get_TargetArrowhead().get_Length(),10));n.get_Weight()!=1&&this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Weight,n.get_Weight());n.get_Separation()!=1&&this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Separation,n.get_Separation());n.get_Label()!=null&&this.WriteLabel(n.get_Label());this.WriteICurve(n.get_Curve());this.WriteEndElement()},WriteDefaultDouble:function(n,t,i){t!=i&&this.WriteAttribute(n,this.DoubleToString(t))},WriteAttribute:function(n,t){var i=Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.FirstCharToLower(n);Is(t,Microsoft.Msagl.Core.Geometry.Point.ctor)?this.get_XmlWriter().WriteAttributeString$$String$$String(i,this.PointToString(Cast(t,Microsoft.Msagl.Core.Geometry.Point.ctor))):this.get_XmlWriter().WriteAttributeString$$String$$String(i,this.DoubleToString(t))},PointToString:function(n){return this.DoubleToString(n.get_X())+" "+this.DoubleToString(n.get_Y())},Precision$$:"System.Int32",get_Precision:function(){return this.precision},set_Precision:function(n){var t,i;for(this.precision=System.Math.Max$$Int32$$Int32(1,n),t=new Array(this.precision+2),t[0]="#",t[1]=".",i=0;i<this.precision;i++)t[2+i]="#";this.formatForDoubleString=new System.String.ctor$$Char$Array(t)},NodeToIds$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.Layout.Node],[System.String]]",get_NodeToIds:function(){return this.nodeIds},set_NodeToIds:function(n){this.nodeIds=n},EdgeEnumeration$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Edge]]",get_EdgeEnumeration:function(){return this.edgeEnumeration},set_EdgeEnumeration:function(n){this.edgeEnumeration=n},DoubleToString:function(n){return System.Math.Abs$$Double(n)<1e-11?"0":n.ToString$$String$$IFormatProvider(this.formatForDoubleString,System.Globalization.CultureInfo.get_InvariantCulture())},WriteLabel:function(n){this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Label,this.LabelToString(n))},LabelToString:function(n){return System.String.Format$$String$$Object$$Object$$Object("{0} {1} {2}",this.PointToString(n.get_Center()),this.DoubleToString(n.get_Width()),this.DoubleToString(n.get_Height()))},WriteNodes:function(){var n,t;for(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Nodes),n=this.get_Graph().get_Nodes().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.WriteNode(t);this.WriteEndElement()},WriteNodesIpe:function(){for(var n=this.get_Graph().get_Nodes().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.WriteNodeIpe(t)},WriteNode:function(n){var t;(function(){var i={Value:t},r=this.nodeIds.TryGetValue(n,i);return t=i.Value,r}).call(this)||this.nodeIds.set_Item$$TKey(n,t=this.nodeIds.get_Count().toString());this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Node);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Id,t);n.get_Padding()!=1&&this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Padding,n.get_Padding());this.WriteICurve(n.get_BoundaryCurve());this.WriteEndElement()},WriteNodeIpe:function(n){var t;(function(){var i={Value:t},r=this.nodeIds.TryGetValue(n,i);return t=i.Value,r}).call(this)||this.nodeIds.set_Item$$TKey(n,t=this.nodeIds.get_Count().toString());n.get_BoundaryCurve()!=null&&(this.WriteICurveIpe(n.get_BoundaryCurve()),this.WriteLabelIpe(n.get_BoundaryCurve().get_BoundingBox().get_Center(),""+t))},WriteLabelIpe:function(n,t){this.get_XmlWriter().WriteStartElement$$String("text");this.get_XmlWriter().WriteAttributeString$$String$$String("pos",n.get_X()+" "+n.get_Y());this.get_XmlWriter().WriteAttributeString$$String$$String("halign","center");this.get_XmlWriter().WriteAttributeString$$String$$String("valign","center");this.get_XmlWriter().WriteString(t);this.get_XmlWriter().WriteEndElement()},WriteICurve:function(n){var t,i,r,u,f,e;if(n!=null)if(t=As(n,Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor),t!=null)this.WriteRect(t.get_BoundingBox().get_Left(),t.get_BoundingBox().get_Bottom(),t.get_BoundingBox().get_Width(),t.get_BoundingBox().get_Height(),t.get_RadiusX(),t.get_RadiusY());else if(i=As(n,Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),i!=null)this.WriteCurveInSvgStyle(i);else if(r=As(n,Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor),r!=null)this.WriteEllipseInSvgStyle(r);else if(u=As(n,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),u!=null)this.WritePolylineInSvgStyle(u);else if(f=As(n,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor),f!=null)this.WriteLineSeg(f);else if(e=As(n,Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor),e!=null)this.WriteBezierSegment(e);else throw $CreateException(new System.InvalidOperationException.ctor,new Error);},WriteBezierSegment:function(n){this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.CubicBezierSegment);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Points,this.PointsToString(n.B(0),n.B(1),n.B(2),n.B(3)));this.WriteEndElement()},WriteICurveIpe:function(n){if(n!=null){var t=As(n,Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor);t!=null&&this.WriteRectIpe(t.get_BoundingBox().get_Left(),t.get_BoundingBox().get_Bottom(),t.get_BoundingBox().get_Width(),t.get_BoundingBox().get_Height(),t.get_RadiusX(),t.get_RadiusY());return}},WriteRect:function(n,t,i,r,u,f){this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Rect);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.X,n);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Y,t);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Width,i);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Height,r);u>0&&this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Rx,u);f>0&&this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Ry,f);this.WriteEndElement()},WriteRectIpe:function(n,t,i,r){this.get_XmlWriter().WriteStartElement$$String("path");this.get_XmlWriter().WriteString("\n"+n+" "+t+" m\n");this.get_XmlWriter().WriteString(n+i+" "+t+" l\n");this.get_XmlWriter().WriteString(n+i+" "+(t+r)+" l\n");this.get_XmlWriter().WriteString(n+" "+(t+r)+" l\nh\n");this.get_XmlWriter().WriteEndElement()},WritePolylineInSvgStyle:function(n){this.WriteStartElement(n.get_Closed()?Microsoft.Msagl.DebugHelpers.GeometryToken.Polygon:Microsoft.Msagl.DebugHelpers.GeometryToken.Polyline);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Points,this.PointsToString(System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n)));this.WriteEndElement()},WriteEllipseInSvgStyle:function(n){Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.get_ParStart(),0)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.get_ParEnd(),6.28318530717959)?this.WriteFullEllipse(n):Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.WriteEllepticalArc(n)},WriteFullEllipse:function(n){this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Ellipse);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Cx,n.get_Center().get_X());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Cy,n.get_Center().get_Y());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Rx,n.get_AxisA().get_Length());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Ry,n.get_AxisB().get_Length());this.WriteEndElement()},WriteCurveInSvgStyle:function(n){this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Curve);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.CurveData,this.CurveString(n));this.WriteEndElement()},CurveString:function(n){return System.String.Join$$String$$IEnumerable$1$String(" ",this.CurveStringTokens(n))},CurveStringTokens:function(n){var t=[],i,r,u,f;if(t.push("M"),t.push(this.PointToString(n.get_Start())),i=As(n,Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),r="w",i!=null)for(u=0;u<i.get_Segments().get_Count();u++)f=i.get_Segments().get_Item$$Int32(u),u!=i.get_Segments().get_Count()-1?t.push(function(){var n={Value:r},t=this.SegmentString(f,n);return r=n.Value,t}.call(this)):Is(f,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(f.get_End(),n.get_Start())?t.push("Z"):t.push(function(){var n={Value:r},t=this.SegmentString(f,n);return r=n.Value,t}.call(this));return t},SegmentString:function(n,t){var f=As(n,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor),r,i,u;if(f!=null)return i=this.LineSegmentString(f,t.Value),t.Value="L",i;if(r=As(n,Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor),r!=null)return i=this.CubicBezierSegmentToString(r,t.Value),t.Value="C",i;if(u=As(n,Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor),u!=null)return t.Value="A",this.EllipticalArcToString(u);throw $CreateException(new System.NotImplementedException.ctor,new Error);},EllipticalArcToString:function(n){var r="A"+this.DoubleToString(n.get_AxisA().get_Length()),u=this.DoubleToString(n.get_AxisB().get_Length()),f=this.DoubleToString(180*Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1,0),n.get_AxisA())/3.14159265358979),e=System.Math.Abs$$Double(n.get_ParEnd()-n.get_ParStart())>=3.14159265358979?"1":"0",t=n.get_ParEnd()>n.get_ParStart()?1:0,i;return Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.AxesSwapped(n.get_AxisA(),n.get_AxisB())&&(t=t==1?0:1),i=this.PointToString(n.get_End()),System.String.Join$$String$$String$Array(" ",r,u,f,e,t.toString(),i)},CubicBezierSegmentToString:function(n,t){var i=this.PointsToString(n.B(1),n.B(2),n.B(3));return t=="C"?i:"C"+i},PointsToString:function(n){return System.String.Join$$String$$IEnumerable$1$String(" ",System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,System.String.ctor,n,$CreateDelegate(this,this.PointToString)))},LineSegmentString:function(n,t){var i=this.PointToString(n.get_End());return t=="L"?i:"L"+i},WriteLineSeg:function(n){this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.LineSegment);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Points,this.PointsToString(n.get_Start(),n.get_End()));this.WriteEndElement()},WriteTransformation:function(n){var t,i;for(this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.Transform),this.get_XmlWriter().WriteComment("the order of elements is [0,0],[0,1],[0,2],[1,0],[1,1],[1,2]"),t=0;t<2;t++)for(i=0;i<3;i++)this.WriteTransformationElement(n.get_Item$$Int32$$Int32(t,i));this.WriteEndElement()},WriteTransformationElement:function(n){this.WriteStringElement(Microsoft.Msagl.DebugHelpers.GeometryToken.TransformElement,n)},WriteStartElement:function(n){this.get_XmlWriter().WriteStartElement$$String(Microsoft.Msagl.DebugHelpers.Persistence.GeometryGraphWriter.FirstCharToLower(n))},WriteStringElement:function(n,t){this.get_XmlWriter().WriteElementString$$String$$String(n.toString(),System.Xml.XmlConvert.ToString$$Double(t))},WriteEndElement:function(){this.get_XmlWriter().WriteEndElement()},WriteLayoutSettings:function(){var t,r,i,n;this.get_Settings()!=null&&(t=this.get_Settings(),r=t.get_EdgeRoutingSettings(),this.WriteStartElement(Microsoft.Msagl.DebugHelpers.GeometryToken.LayoutAlgorithmSettings),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.EdgeRoutingMode,r.get_EdgeRoutingMode()),i=As(t,Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings.ctor),i!=null?this.WriteSugiyamaSettings(i):(n=As(t,Microsoft.Msagl.Layout.MDS.MdsLayoutSettings.ctor),n!=null&&(this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LayoutAlgorithmType,Microsoft.Msagl.DebugHelpers.GeometryToken.MdsLayoutSettings),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.Exponent,n.get_Exponent()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.IterationsWithMajorization,n.get_IterationsWithMajorization()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.PivotNumber,n.get_PivotNumber()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.RotationAngle,n.get_RotationAngle()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.ScaleX,n.get_ScaleX()),this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.ScaleY,n.get_ScaleY()))),this.get_XmlWriter().WriteEndElement())},WriteSugiyamaSettings:function(n){this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LayoutAlgorithmType,Microsoft.Msagl.DebugHelpers.GeometryToken.SugiyamaLayoutSettings);this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.MinNodeWidth,n.get_MinNodeWidth());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.MinNodeHeight,n.get_MinNodeHeight());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.AspectRatio,n.get_AspectRatio());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.NodeSeparation,n.get_NodeSeparation());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.RandomSeedForOrdering,n.get_RandomSeedForOrdering());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.NoGainStepsBound,n.get_NoGainAdjacentSwapStepsBound());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.MaxNumberOfPassesInOrdering,n.get_MaxNumberOfPassesInOrdering());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.RepetitionCoefficientForOrdering,n.get_RepetitionCoefficientForOrdering());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.GroupSplit,n.get_GroupSplit());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LabelCornersPreserveCoefficient,n.get_LabelCornersPreserveCoefficient());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.BrandesThreshold,n.get_BrandesThreshold());this.WriteAttribute(Microsoft.Msagl.DebugHelpers.GeometryToken.LayerSeparation,n.get_LayerSeparation());this.WriteTransformation(n.get_Transformation())}}};JsTypes.push(Microsoft$Msagl$DebugHelpers$Persistence$GeometryGraphWriter);Microsoft$Msagl$DebugHelpers$CurveStream={fullname:"Microsoft.Msagl.DebugHelpers.CurveStream",baseTypeName:"System.Object",staticDefinition:{RefineBlocks:function(n){for(var f,i,t=[],u=0,e=n.length,r=n[u];u<e;u++,r=n[u])f=r.charAt(0),System.Char.IsLetter$$Char(f)?(t.push(new Microsoft.Msagl.DebugHelpers.Persistence.CharStreamElement.ctor(f)),r.length>1&&(function(){var n={Value:i},t=System.Double.TryParse$$String$$Double(r.substr(1),n);return i=n.Value,t}()?t.push(new Microsoft.Msagl.DebugHelpers.DoubleStreamElement.ctor(i)):t.push(null))):function(){var n={Value:i},t=System.Double.TryParse$$String$$Double(r,n);return i=n.Value,t}()?t.push(new Microsoft.Msagl.DebugHelpers.DoubleStreamElement.ctor(i)):t.push(null);return t}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.data=null;this.curveStreamElements=null;this.offset=0;System.Object.ctor.call(this);this.data=n;this.Init()},Init:function(){this.data=this.data.trim();var n=this.data.Split$$Char$Array$$StringSplitOptions([" "],1);this.curveStreamElements=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.DebugHelpers.CurveStreamElement.ctor,Microsoft.Msagl.DebugHelpers.CurveStream.RefineBlocks(n))},GetNextCurveStreamElement:function(){return this.offset>=this.curveStreamElements.length?null:this.curveStreamElements[this.offset++]},PickNextCurveStreamElement:function(){return this.offset>=this.curveStreamElements.length?null:this.curveStreamElements[this.offset]}}};JsTypes.push(Microsoft$Msagl$DebugHelpers$CurveStream);Microsoft$Msagl$DebugHelpers$CurveStreamElement={fullname:"Microsoft.Msagl.DebugHelpers.CurveStreamElement",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.Value=null;System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$DebugHelpers$CurveStreamElement);Microsoft$Msagl$DebugHelpers$DoubleStreamElement={fullname:"Microsoft.Msagl.DebugHelpers.DoubleStreamElement",baseTypeName:"Microsoft.Msagl.DebugHelpers.CurveStreamElement",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){Microsoft.Msagl.DebugHelpers.CurveStreamElement.ctor.call(this);this.Value=n},Double$$:"System.Double",get_Double:function(){return this.Value}}};JsTypes.push(Microsoft$Msagl$DebugHelpers$DoubleStreamElement);Microsoft$Msagl$Layout$Initial$Relayout={fullname:"Microsoft.Msagl.Layout.Initial.Relayout",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},GetShallowCopyGraphUnderCluster:function(n){for(var r=Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.ShallowNodeCopyDictionary(n),u=Microsoft.Msagl.Layout.Initial.Relayout.CreateGeometryGraphAndPopulateItWithNodes(r),h=r.get_Keys().GetEnumerator(),t,f,c,e,o,s,i;h.MoveNext();)for(t=h.get_Current(),f=Microsoft.Msagl.Layout.Initial.Relayout.AllSuccessors(t).GetEnumerator();f.MoveNext();){for(c=f.get_Current(),e=c.get_InEdges().GetEnumerator();e.MoveNext();)i=e.get_Current(),o=Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.Ancestor(i.get_Source(),n),Microsoft.Msagl.Layout.Initial.Relayout.IsBetweenClusters(o,t)&&u.get_Edges().Add(Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.CopyEdge$$Dictionary$2$Node$Node$$Edge$$Node$$Node(r,i,o,t));for(s=t.get_SelfEdges().GetEnumerator();s.MoveNext();)i=s.get_Current(),u.get_Edges().Add(Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.CopyEdge$$Dictionary$2$Node$Node$$Edge(r,i))}return u},CreateGeometryGraphAndPopulateItWithNodes:function(n){for(var t=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,i=n.get_Values().GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.get_Nodes().Add(r);return t},IsBetweenClusters:function(n,t){return n!=t&&n!=null},AllSuccessors:function(n){var r=function(){var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor);return t.Add(n),t}(),u=As(n,Microsoft.Msagl.Core.Layout.Cluster.ctor),t,i;if(u!=null)for(t=u.AllSuccessorsWidthFirst().GetEnumerator();t.MoveNext();)i=t.get_Current(),i!=n&&r.Add(i);return r}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){var u,f;if(this.graph=null,this.modifiedNodes=null,this.clusterSettings=null,this.ancestorsOfModifiedNodes=null,this.addedNodesByCluster=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor,System.Collections.Generic.HashSet$1.ctor),Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this),Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"graph"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(r,"clusterSettings"),this.graph=n,this.modifiedNodes=t,this.clusterSettings=r,this.ancestorsOfModifiedNodes=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Cluster.ctor,t,$CreateAnonymousDelegate(this,function(n){return n.get_AllClusterAncestors()}))),i!=null){for(u=i.GetEnumerator();u.MoveNext();)f=u.get_Current(),this.CreateOrGetAddedChildrenOfParent(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,f.get_ClusterParents())).Add(f);this.ancestorsOfModifiedNodes.InsertRange(System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Cluster.ctor,i,$CreateAnonymousDelegate(this,function(n){return n.get_AllClusterAncestors()})))}},CreateOrGetAddedChildrenOfParent:function(n){var t;return function(){var i={Value:t},r=this.addedNodesByCluster.TryGetValue(n,i);return t=i.Value,r}.call(this),t==null&&this.addedNodesByCluster.set_Item$$TKey(n,t=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor)),t},RunInternal:function(){var n=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,System.Linq.Enumerable.OfType$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,this.modifiedNodes),$CreateAnonymousDelegate(this,function(n){return!n.get_IsCollapsed()})));n.length>0&&new Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.ctor$$GeometryGraph$$IEnumerable$1$Cluster$$Func$2$Cluster$LayoutAlgorithmSettings(this.graph,n,this.clusterSettings).Run();this.Visit(this.graph.get_RootCluster());Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.RouteParentEdges(this.graph,this.clusterSettings(this.graph.get_RootCluster()).get_EdgeRoutingSettings());Microsoft.Msagl.Miscellaneous.LayoutHelpers.RouteAndLabelEdges(this.graph,this.clusterSettings(this.graph.get_RootCluster()),System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,this.graph.get_Edges(),$CreateDelegate(this,this.BetweenClusterOnTheRightLevel)));this.graph.UpdateBoundingBox();this.ProgressComplete()},BetweenClusterOnTheRightLevel:function(n){var t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_Source().get_AllClusterAncestors()),i=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_Target().get_AllClusterAncestors());return Microsoft.Msagl.Core.DataStructures.Set$1.op_Multiply(t,i).IsContained(this.ancestorsOfModifiedNodes)},Visit:function(n){var t,i;if(!n.get_IsCollapsed()&&this.ancestorsOfModifiedNodes.Contains$$T(n)){for(t=n.get_Clusters().GetEnumerator();t.MoveNext();)i=t.get_Current(),this.Visit(i);this.LayoutCluster(n)}},LayoutCluster:function(n){var r,e,i;this.ProgressStep();n.UnsetInitialLayoutState();var t=null,u=this.clusterSettings(n),f=Microsoft.Msagl.Core.Geometry.Directions.None;Is(u,Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings.ctor)?(r=As(u,Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings.ctor),t=r.get_FallbackLayoutSettings()!=null?new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor$$FastIncrementalLayoutSettings(Cast(r.get_FallbackLayoutSettings(),Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor)):new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor,f=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.GetLayoutDirection(r)):t=new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor$$FastIncrementalLayoutSettings(Cast(u,Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor));t.set_ApplyForces(!0);t.set_MinorIterations(10);t.set_AvoidOverlaps(!0);t.set_InterComponentForces(!1);t.set_IdealEdgeLength(function(){var n=new Microsoft.Msagl.Core.Layout.IdealEdgeLengthSettings.ctor;return n.set_EdgeDirectionConstraints(f),n.set_ConstrainedEdgeSeparation(30),n}.call(this));t.get_EdgeRoutingSettings().set_EdgeRoutingMode(Microsoft.Msagl.Core.Routing.EdgeRoutingMode.Spline),function(){var t={Value:e},i=this.addedNodesByCluster.TryGetValue(n,t);return e=t.Value,i}.call(this)?(t.set_MinConstraintLevel(0),t.set_MaxConstraintLevel(2)):t.set_MinConstraintLevel(2);i=Microsoft.Msagl.Layout.Initial.Relayout.GetShallowCopyGraphUnderCluster(n);Microsoft.Msagl.Core.Layout.LayoutAlgorithmHelpers.ComputeDesiredEdgeLengths(t.get_IdealEdgeLength(),i);this.LayoutComponent(i,t);Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.FixOriginalGraph(i,!0);n.UpdateBoundary(i.get_BoundingBox())},GenerateOrthogonalOrderingConstraints:function(n,t){for(var i=null,f=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,System.Double.ctor,this.graph.get_Nodes(),$CreateAnonymousDelegate(this,function(n){return n.get_Center().get_X()})).GetEnumerator(),u,r;f.MoveNext();)r=f.get_Current(),i!=null&&t.AddStructuralConstraint(new Microsoft.Msagl.Layout.Incremental.HorizontalSeparationConstraint.ctor$$Node$$Node$$Double(i,r,.1)),i=r;for(i=null,u=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,System.Double.ctor,this.graph.get_Nodes(),$CreateAnonymousDelegate(this,function(n){return n.get_Center().get_Y()})).GetEnumerator();u.MoveNext();)r=u.get_Current(),i!=null&&t.AddStructuralConstraint(new Microsoft.Msagl.Layout.Incremental.VerticalSeparationConstraint.ctor$$Node$$Node$$Double(i,r,.1)),i=r},LayoutComponent:function(n,t){var i,u,r;for(t.set_MaxIterations(Microsoft.Msagl.Core.Layout.LayoutAlgorithmHelpers.NegativeLinearInterpolation(n.get_Nodes().get_Count(),50,500,3,5)),t.set_MinorIterations(Microsoft.Msagl.Core.Layout.LayoutAlgorithmHelpers.NegativeLinearInterpolation(n.get_Nodes().get_Count(),50,500,2,10)),i=new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayout.ctor(n,t,t.get_MinConstraintLevel(),$CreateAnonymousDelegate(this,function(){return t})),System.Diagnostics.Debug.Assert$$Boolean(t.get_Iterations()==0),u=System.Linq.Enumerable.Range(t.get_MinConstraintLevel(),t.get_MaxConstraintLevel()+1).GetEnumerator();u.MoveNext();){r=u.get_Current();r!=i.get_CurrentConstraintLevel()&&(i.set_CurrentConstraintLevel(r),r==2&&(t.set_MinorIterations(1),t.set_ApplyForces(!1)));do i.Run();while(!t.get_IsDone())}n.set_Margins(t.get_ClusterMargin());n.UpdateBoundingBox()}}};JsTypes.push(Microsoft$Msagl$Layout$Initial$Relayout);Microsoft$Msagl$Layout$Initial$InitialLayoutByCluster={fullname:"Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},RouteParentEdges:function(n,t){var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor),r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.RouteSimplHooksAndFillTheLists(n.get_RootCluster(),i,r,t);(i.get_Count()>0||r.get_Count()>0)&&Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.LabelParentEdgesAndMaybeRerouteThemNicely(n,i,r,t)},LabelParentEdgesAndMaybeRerouteThemNicely:function(n,t,i,r){var f,u,e;Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.AllowedToRoute(t,i,r)&&(f=new Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$Double$$Double$$Double$$List$1$Edge$$List$1$Edge(n,r.get_Padding(),r.get_PolylinePadding(),r.get_RoutingToParentConeAngle(),t,i),f.Run());u=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Edge.ctor,i,t),function(n){return System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Label.ctor,n.get_Labels())});System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,u)&&(e=new Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.ctor$$IEnumerable$1$Node$$IEnumerable$1$Edge(n.get_Nodes(),u),e.Run())},AllowedToRoute:function(n,t,i){return Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.NumberOfActiveNodesIsUnderThreshold(n,t,i.get_SimpleSelfLoopsForParentEdgesThreshold())},RouteSimplHooksAndFillTheLists:function(n,t,i,r){for(var f=r.get_Padding()+r.get_PolylinePadding(),e=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.AllClustersWidthFirstExcludingSelfAvoidingChildrenOfCollapsed(),function(n){return!n.get_IsCollapsed()}).GetEnumerator(),u;e.MoveNext();)u=e.get_Current(),Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.RouteClusterParentInEdges(t,r,u,f),Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.RouteClusterParentOutEdges(i,r,u,f)},RouteClusterParentOutEdges:function(n,t,i,r){for(var e=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,i.get_OutEdges(),function(n){return Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.IsDescendant(n.get_Target(),i)}).GetEnumerator();e.MoveNext();){var u=e.get_Current(),o=System.Math.Max$$Double$$Double(r,1.5*Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.ArrowlengthAtSource(u)),f=As(u.get_SourcePort(),Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor);f==null&&u.set_SourcePort(f=new Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor$$Func$1$ICurve(function(){return i.get_BoundaryCurve()}));f.set_HookSize(o);u.set_Curve(Microsoft.Msagl.Routing.StraightLineEdges.CreateLoop$$Rectangle$$Rectangle$$Double$$Boolean(u.get_Target().get_BoundingBox(),i.get_BoundingBox(),o,!1));Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$Edge$$ICurve$$Boolean$$Boolean(u,u.get_Curve(),!1,t.get_KeepOriginalSpline());n.Add(u)}},RouteClusterParentInEdges:function(n,t,i,r){for(var e=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,i.get_InEdges(),function(n){return Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.IsDescendant(n.get_Source(),i)}).GetEnumerator();e.MoveNext();){var u=e.get_Current(),o=System.Math.Max$$Double$$Double(r,1.5*Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.ArrowlengthAtTarget(u)),f=As(u.get_TargetPort(),Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor);f==null&&u.set_TargetPort(f=new Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor$$Func$1$ICurve(function(){return i.get_BoundaryCurve()}));f.set_HookSize(o);u.set_Curve(Microsoft.Msagl.Routing.StraightLineEdges.CreateLoop$$Rectangle$$Rectangle$$Double$$Boolean(u.get_Source().get_BoundingBox(),i.get_BoundingBox(),o,!1));Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$Edge$$ICurve$$Boolean$$Boolean(u,u.get_Curve(),!1,t.get_KeepOriginalSpline());n.Add(u)}},ArrowlengthAtSource:function(n){return n.get_EdgeGeometry().get_SourceArrowhead()==null?0:n.get_EdgeGeometry().get_SourceArrowhead().get_Length()},ArrowlengthAtTarget:function(n){return n.get_EdgeGeometry().get_TargetArrowhead()==null?0:n.get_EdgeGeometry().get_TargetArrowhead().get_Length()},ValidateLayout:function(n){for(var r=n.AllClustersDepthFirst().GetEnumerator(),t,i,u;r.MoveNext();)for(t=r.get_Current(),i=System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,t.nodes,System.Linq.Enumerable.Cast$1(Microsoft.Msagl.Core.Layout.Node.ctor,t.get_Clusters())).GetEnumerator();i.MoveNext();)u=i.get_Current(),System.Diagnostics.Debug.Assert$$Boolean(t.get_BoundingBox().Contains$$Rectangle(u.get_BoundingBox()))},FixOriginalGraph:function(n,t){for(var o=n.get_Nodes().GetEnumerator(),f,i,r,e,l;o.MoveNext();){var s=o.get_Current(),u=Cast(s.get_UserData(),Microsoft.Msagl.Core.Layout.Node.ctor),h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(s.get_BoundingBox().get_LeftBottom(),u.get_BoundingBox().get_LeftBottom()),c=As(u,Microsoft.Msagl.Core.Layout.Cluster.ctor);c!=null?c.DeepTranslation(h,t):u.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(u.get_Center(),h))}if(t)for(f=n.get_Edges().GetEnumerator();f.MoveNext();)if(i=f.get_Current(),Is(i.get_UserData(),Microsoft.Msagl.Core.Layout.Edge.ctor))for(r=As(i.get_UserData(),Microsoft.Msagl.Core.Layout.Edge.ctor),i.get_Curve()!=null&&r.set_Curve(i.get_Curve().Clone()),r.set_Length(i.get_Length()),r.get_EdgeGeometry().set_SourcePort(function(n){return i.set_SourcePort(n),n}(null)),r.get_EdgeGeometry().set_TargetPort(function(n){return i.set_TargetPort(n),n}(null)),e=r.get_Labels().GetEnumerator();e.MoveNext();)l=e.get_Current(),l.set_GeometryParent(r)},IsDescendant:function(n,t){return Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.Ancestor(n,t)!=null},GetComponents:function(n,t){for(var u=Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.ShallowNodeCopyDictionary(n),e=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor),c=u.get_Keys().GetEnumerator(),i,o,l,s,a,h,f,r,v;c.MoveNext();){for(i=c.get_Current(),o=i.get_InEdges().GetEnumerator();o.MoveNext();)f=o.get_Current(),r=Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.Ancestor(f.get_Source(),n),r==f.get_Source()&&e.Add(Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.CopyEdge$$Dictionary$2$Node$Node$$Edge$$Node$$Node(u,f,r,i));if(e.AddRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.Layout.Edge.ctor,i.get_SelfEdges(),function(n){return Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.CopyEdge$$Dictionary$2$Node$Node$$Edge(u,n)})),t&&Is(i,Microsoft.Msagl.Core.Layout.Cluster.ctor))for(l=As(i,Microsoft.Msagl.Core.Layout.Cluster.ctor),s=l.AllSuccessorsWidthFirst().GetEnumerator();s.MoveNext();)for(a=s.get_Current(),h=a.get_InEdges().GetEnumerator();h.MoveNext();)f=h.get_Current(),r=Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.Ancestor(f.get_Source(),n),r!=null&&r!=i&&(v=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(u.get_Item$$TKey(r),u.get_Item$$TKey(i)),e.Add(v))}return Microsoft.Msagl.Core.Layout.GraphConnectedComponents.CreateComponents(System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,u.get_Values()),e)},CopyEdge$$Dictionary$2$Node$Node$$Edge$$Node$$Node:function(n,t,i,r){for(var u=function(){var u=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(n.get_Item$$TKey(i),n.get_Item$$TKey(r));return u.set_EdgeGeometry(t.get_EdgeGeometry()),u.set_SourcePort(null),u.set_TargetPort(null),u.set_Length(t.get_Length()),u.set_UserData(t),u}(),e=t.get_Labels().GetEnumerator(),f;e.MoveNext();)f=e.get_Current(),u.get_Labels().Add(f),f.set_GeometryParent(u);return u},CopyEdge$$Dictionary$2$Node$Node$$Edge:function(n,t){return Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.CopyEdge$$Dictionary$2$Node$Node$$Edge$$Node$$Node(n,t,t.get_Source(),t.get_Target())},ShallowNodeCopyDictionary:function(n){for(var i=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor),f=n.get_Nodes().GetEnumerator(),r,u,t;f.MoveNext();)r=f.get_Current(),i.set_Item$$TKey(r,function(){var n=new Microsoft.Msagl.Core.Layout.Node.ctor$$ICurve(r.get_BoundaryCurve().Clone());return n.set_UserData(r),n}());for(u=n.get_Clusters().GetEnumerator();u.MoveNext();)t=u.get_Current(),t.get_IsCollapsed()?i.set_Item$$TKey(t,function(){var n=new Microsoft.Msagl.Core.Layout.Node.ctor$$ICurve(t.get_CollapsedBoundary().Clone());return n.set_UserData(t),n}()):(t.get_BoundaryCurve()==null&&t.set_BoundaryCurve(t.get_RectangularBoundary().RectangularHull()),i.set_Item$$TKey(t,function(){var n=new Microsoft.Msagl.Core.Layout.Node.ctor$$ICurve(t.get_BoundaryCurve().Clone());return n.set_UserData(t),n}()));return i},Ancestor:function(n,t){var i,r,u,f;if(System.Linq.Enumerable.Contains$1$$IEnumerable$1$$TSource(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_ClusterParents(),t))return n;for(i=new System.Collections.Generic.Queue$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_ClusterParents());i.get_Count()>0;){if(r=i.Dequeue(),System.Linq.Enumerable.Contains$1$$IEnumerable$1$$TSource(Microsoft.Msagl.Core.Layout.Cluster.ctor,t.get_Clusters(),r))return r;for(u=r.get_ClusterParents().GetEnumerator();u.MoveNext();)f=u.get_Current(),i.Enqueue(f)}return null}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$GeometryGraph$$LayoutAlgorithmSettings:function(n,t){this.graph=null;this.clusters=null;this.clusterSettings=null;this.parallelOptions=null;this.runInParallel=!1;Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.ctor$$GeometryGraph$$Func$2$Cluster$LayoutAlgorithmSettings.call(this,n,$CreateAnonymousDelegate(this,function(){return t}))},ctor$$GeometryGraph$$Func$2$Cluster$LayoutAlgorithmSettings:function(n,t){this.graph=null;this.clusters=null;this.clusterSettings=null;this.parallelOptions=null;this.runInParallel=!1;Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.ctor$$GeometryGraph$$IEnumerable$1$Cluster$$Func$2$Cluster$LayoutAlgorithmSettings.call(this,n,[n.get_RootCluster()],t)},ctor$$GeometryGraph$$IEnumerable$1$Cluster$$Func$2$Cluster$LayoutAlgorithmSettings:function(n,t,i){this.graph=null;this.clusters=null;this.clusterSettings=null;this.parallelOptions=null;this.runInParallel=!1;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"graph");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"clusters");Microsoft.Msagl.Core.ValidateArg.IsNotNull(i,"clusterSettings");this.graph=n;this.clusters=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,t);this.clusterSettings=i},RunInParallel$$:"System.Boolean",get_RunInParallel:function(){return this.runInParallel},set_RunInParallel:function(n){this.runInParallel=n},RunInternal:function(){var n,i,t;if(this.runInParallel&&(this.parallelOptions=new System.Threading.Tasks.ParallelOptions.ctor),this.runInParallel&&this.clusters.get_Count()>1)System.Threading.Tasks.Parallel.ForEach$1$$IEnumerable$1$$ParallelOptions$$Action$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,this.clusters,this.parallelOptions,$CreateDelegate(this,this.ProcessCluster));else for(n=this.clusters.GetEnumerator();n.MoveNext();)i=n.get_Current(),this.ProcessCluster(i);t=System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,this.clusters,$CreateAnonymousDelegate(this,function(n){return n==this.graph.get_RootCluster()}));t&&Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.RouteParentEdges(this.graph,this.clusterSettings(this.graph.get_RootCluster()).get_EdgeRoutingSettings());this.graph.UpdateBoundingBox();t&&(System.Diagnostics.Debug.Assert$$Boolean$$String(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,this.clusters)==1,"Layout by cluster with a root cluster should not contain any other cluster."),this.graph.Translate(Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(this.graph.get_BoundingBox().get_LeftBottom())));this.ProgressComplete()},ProcessCluster:function(n){var t,i;n.get_IsCollapsed()||(t=n.get_BoundingBox(),n.UnsetInitialLayoutStateIncludingAncestors(),this.LayoutCluster(n),n!=this.graph.get_RootCluster()&&(i=n.get_BoundingBox(),n.DeepTranslation(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Center(),i.get_Center()),!0)))},LayoutCluster:function(n){var t,r,f,i,e,u,o;if(!n.get_IsCollapsed()){if(t=this.clusterSettings(n),n.UnsetInitialLayoutState(),this.runInParallel&&System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_Clusters())>1)System.Threading.Tasks.Parallel.ForEach$1$$IEnumerable$1$$ParallelOptions$$Action$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_Clusters(),this.parallelOptions,$CreateDelegate(this,this.LayoutCluster));else for(r=n.get_Clusters().GetEnumerator();r.MoveNext();)f=r.get_Current(),this.LayoutCluster(f);for(i=Cast(Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.GetComponents(n,t.get_LiftCrossEdges()),System.Collections.Generic.List$1.ctor),i.ForEach($CreateAnonymousDelegate(this,function(n){this.LayoutComponent(t,n)})),e=Microsoft.Msagl.Layout.MDS.MdsGraphLayout.PackGraphs(i,t),u=i.GetEnumerator();u.MoveNext();)o=u.get_Current(),Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.FixOriginalGraph(o,!0);n.UpdateBoundary(e);n.SetInitialLayoutState(t.get_ClusterMargin());n.RaiseLayoutDoneEvent()}},LayoutComponent:function(n,t){var i=As(n,Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor),r=As(n,Microsoft.Msagl.Layout.MDS.MdsLayoutSettings.ctor),u=As(n,Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings.ctor);if(i!=null)this.ForceDirectedLayout(i,t);else if(r!=null)this.MDSLayout(r,t);else if(u!=null)this.LayeredLayout(u,t);else throw $CreateException(new System.NotImplementedException.ctor$$String("Unknown type of layout settings!"),new Error);},ForceDirectedLayout:function(n,t){Microsoft.Msagl.Core.Layout.LayoutAlgorithmHelpers.ComputeDesiredEdgeLengths(n.get_IdealEdgeLength(),t);var i=function(){var i=new Microsoft.Msagl.Layout.Initial.InitialLayout.ctor(t,n);return i.set_SingleComponent(!0),i}.call(this);i.Run$$CancelToken(this.get_CancelToken());Microsoft.Msagl.Layout.Initial.InitialLayoutHelpers.RouteEdges(t,n,this.get_CancelToken());Microsoft.Msagl.Layout.Initial.InitialLayoutHelpers.PlaceLabels(t,this.get_CancelToken());Microsoft.Msagl.Layout.Initial.InitialLayoutHelpers.FixBoundingBox(t,n)},MDSLayout:function(n,t){Microsoft.Msagl.Core.Layout.LayoutAlgorithmHelpers.ComputeDesiredEdgeLengths(n.get_IdealEdgeLength(),t);var i=new Microsoft.Msagl.Layout.MDS.MdsGraphLayout.ctor(n,t);i.Run$$CancelToken(this.get_CancelToken());Microsoft.Msagl.Layout.Initial.InitialLayoutHelpers.RouteEdges(t,n,this.get_CancelToken());Microsoft.Msagl.Layout.Initial.InitialLayoutHelpers.PlaceLabels(t,this.get_CancelToken());Microsoft.Msagl.Layout.Initial.InitialLayoutHelpers.FixBoundingBox(t,n)},LayeredLayout:function(n,t){var f=new Microsoft.Msagl.Layout.Layered.LayeredLayout.ctor(t,n),u;f.SetCancelToken(this.get_CancelToken());var e=f.EstimateAspectRatio(),i=t.get_Edges().get_Count()/t.get_Nodes().get_Count(),r=n.get_FallbackLayoutSettings();r!=null&&(t.get_Nodes().get_Count()>50&&i>2||t.get_Nodes().get_Count()>40&&i>3||t.get_Nodes().get_Count()>30&&i>4||t.get_Nodes().get_Count()>30&&e>n.get_MaxAspectRatioEccentricity()||t.get_Nodes().get_Count()>30&&e<1/n.get_MaxAspectRatioEccentricity())?(u=r.get_EdgeRoutingSettings().get_EdgeRoutingMode(),t.get_Nodes().get_Count()>100&&i>2&&r.get_EdgeRoutingSettings().set_EdgeRoutingMode(Microsoft.Msagl.Core.Routing.EdgeRoutingMode.StraightLine),this.LayoutComponent(r,t),r.get_EdgeRoutingSettings().set_EdgeRoutingMode(u)):(u=n.get_EdgeRoutingSettings().get_EdgeRoutingMode(),t.get_Nodes().get_Count()>100&&i>2&&n.get_EdgeRoutingSettings().set_EdgeRoutingMode(Microsoft.Msagl.Core.Routing.EdgeRoutingMode.StraightLine),f.Run$$CancelToken(this.get_CancelToken()),n.get_EdgeRoutingSettings().set_EdgeRoutingMode(u),Microsoft.Msagl.Layout.Initial.InitialLayoutHelpers.FixBoundingBox(t,n))}}};JsTypes.push(Microsoft$Msagl$Layout$Initial$InitialLayoutByCluster);Microsoft$Msagl$Layout$Initial$InitialLayoutHelpers={fullname:"Microsoft.Msagl.Layout.Initial.InitialLayoutHelpers",baseTypeName:"System.Object",staticDefinition:{RouteEdges:function(n,t,i){var u=t.get_EdgeRoutingSettings().get_EdgeRoutingMode(),r,f;n.get_Nodes().get_Count()>=2e3&&(u=Microsoft.Msagl.Core.Routing.EdgeRoutingMode.StraightLine);switch(u){case Microsoft.Msagl.Core.Routing.EdgeRoutingMode.Spline:r=new Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$Double$$Double$$Double$$BundlingSettings(n,t.get_EdgeRoutingSettings().get_Padding(),t.get_NodeSeparation(),t.get_EdgeRoutingSettings().get_ConeAngle(),null);r.Run$$CancelToken(i);break;case Microsoft.Msagl.Core.Routing.EdgeRoutingMode.SplineBundling:r=new Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$Double$$Double$$Double$$BundlingSettings(n,t.get_EdgeRoutingSettings().get_Padding(),t.get_NodeSeparation()/20,t.get_EdgeRoutingSettings().get_ConeAngle(),new Microsoft.Msagl.Core.Routing.BundlingSettings.ctor);r.Run$$CancelToken(i);break;case Microsoft.Msagl.Core.Routing.EdgeRoutingMode.Rectilinear:var e=t.get_EdgeRoutingSettings().get_Padding(),o=t.get_EdgeRoutingSettings().get_CornerRadius(),s=new Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.ctor$$GeometryGraph$$Double$$Double$$Boolean(n,e,o,!0);s.Run$$CancelToken(i);break;case Microsoft.Msagl.Core.Routing.EdgeRoutingMode.StraightLine:f=new Microsoft.Msagl.Routing.StraightLineEdges.ctor(n.get_Edges(),t.get_EdgeRoutingSettings().get_Padding());f.Run$$CancelToken(i)}},PlaceLabels:function(n,t){var i=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Label.ctor,System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.Layout.Label.ctor,n.get_Edges(),function(n){return n.get_Labels()})),r=new Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.ctor$$GeometryGraph$$ICollection$1$Label(n,i);r.Run$$CancelToken(t)},FixBoundingBox:function(n,t){n.set_Margins(t.get_ClusterMargin());n.UpdateBoundingBox();n.Translate(Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(n.get_BoundingBox().get_LeftBottom()))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Layout$Initial$InitialLayoutHelpers);Microsoft$Msagl$Layout$LargeGraphLayout$DeviceIndependendZoomCalculatorForNodes={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.DeviceIndependendZoomCalculatorForNodes",baseTypeName:"System.Object",staticDefinition:{PointToTuple:function(n,t,i){var r=t.get_X()-n.get_X(),u=t.get_Y()-n.get_Y();return new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,r/i|0,u/i|0)},GetDistBetweenBoundingBoxes:function(n,t){var i=n.get_BoundingBox(),r=t.get_BoundingBox(),u,f;return i.Intersects(r)?0:(u=Microsoft.Msagl.Layout.LargeGraphLayout.DeviceIndependendZoomCalculatorForNodes.PolygonFromBox(i),f=Microsoft.Msagl.Layout.LargeGraphLayout.DeviceIndependendZoomCalculatorForNodes.PolygonFromBox(r),Microsoft.Msagl.Routing.Visibility.Polygon.Distance$$Polygon$$Polygon(u,f))},PolygonFromBox:function(n){return new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(function(){var t=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$Point$Array([n.get_LeftBottom(),n.get_LeftTop(),n.get_RightTop(),n.get_RightBottom()]);return t.set_Closed(!0),t}())}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.LargeGraphLayout.IZoomLevelCalculator"],Kind:"Class",definition:{ctor:function(n,t,i,r){this.NodeToLgNodeInfo=null;this.maxAmountPerTile=0;this._levelNodeCounts=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);this.unassigned=0;this.sortedLgNodeInfos=null;this.zoomLevel=0;this._Graph=null;this._Settings=null;System.Object.ctor.call(this);this.NodeToLgNodeInfo=n;this.maxAmountPerTile=r;this.set_Graph(t);this.set_Settings(i);this.unassigned=t.get_Nodes().get_Count()},Graph$$:"Microsoft.Msagl.Core.Layout.GeometryGraph",get_Graph:function(){return this._Graph},set_Graph:function(n){this._Graph=n},Settings$$:"Microsoft.Msagl.Layout.LargeGraphLayout.LgLayoutSettings",get_Settings:function(){return this._Settings},set_Settings:function(n){this._Settings=n},SortedLgNodeInfos$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Layout.LgNodeInfo]]",get_SortedLgNodeInfos:function(){return this.sortedLgNodeInfos},LevelNodeCounts$$:"System.Collections.Generic.List`1[[System.Int32]]",get_LevelNodeCounts:function(){return this._levelNodeCounts},RunAfterFlow:function(){this.sortedLgNodeInfos=this.GetSortedLgNodeInfos2();this.get_Graph().UpdateBoundingBox();var n=System.Math.Max$$Double$$Double(this.get_Graph().get_Width(),this.get_Graph().get_Height());for(this.zoomLevel=1;this.SomeNodesAreNotAssigned();)System.Console.WriteLine$$String$$Object$$Object("zoom level = {0} with the grid size = {1}",this.zoomLevel,n),this.DrawNodesOnLevel2(n,this.zoomLevel),this.zoomLevel*=2,this.zoomLevel==2&&(n/=2.5),this.zoomLevel==4&&(n/=2),this.zoomLevel==8&&(n/=1.5),this.zoomLevel>=8&&(n/=10),this.zoomLevel>=256&&(n/=10)},Run:function(){this.sortedLgNodeInfos=this.GetSortedLgNodeInfos();this.get_Graph().UpdateBoundingBox();var n=System.Math.Max$$Double$$Double(this.get_Graph().get_Width(),this.get_Graph().get_Height());for(this.zoomLevel=1;this.SomeNodesAreNotAssigned();)System.Console.WriteLine$$String$$Object$$Object("zoom level = {0} with the grid size = {1}",this.zoomLevel,n),this.DrawNodesOnLevel(n,this.zoomLevel),this.zoomLevel*=2,this.zoomLevel==2&&(n/=2.5),this.zoomLevel==4&&(n/=2),this.zoomLevel==8&&(n/=1.5),this.zoomLevel>=8&&(n/=3),this.zoomLevel>=256&&(n/=10)},DrawNodesOnLevel2:function(n){var t=new Int32Array(530),r,i,f,u,e;for(t[1]=40,t[2]=30,t[4]=20,t[8]=10,t[16]=5,t[32]=5,t[64]=5,t[128]=20,t[256]=1e3,r=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,System.Int32.ctor),i=0;i<this.sortedLgNodeInfos.get_Count();i++){if(f=this.sortedLgNodeInfos.get_Item$$Int32(i),u=Microsoft.Msagl.Layout.LargeGraphLayout.DeviceIndependendZoomCalculatorForNodes.PointToTuple(this.get_Graph().get_LeftBottom(),f.get_Center(),n),r.ContainsKey(u)||r.set_Item$$TKey(u,0),e=r.set_Item$$TKey(u,r.get_Item$$TKey(u)+1)+1,e>this.maxAmountPerTile){this._levelNodeCounts.Add(i);break}if(f.get_ZoomLevel()==this.zoomLevel&&this.unassigned--,this.unassigned==0){this._levelNodeCounts.Add(i+1);break}if(this.zoomLevel>32){this.unassigned=0;break}}},DrawNodesOnLevel:function(n){var t=new Int32Array(530),r,i,f,u,e;for(t[1]=40,t[2]=30,t[4]=20,t[8]=10,t[16]=5,t[32]=5,t[64]=5,t[128]=20,t[256]=1e3,r=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,System.Int32.ctor),i=0;i<this.sortedLgNodeInfos.get_Count();i++){if(f=this.sortedLgNodeInfos.get_Item$$Int32(i),u=Microsoft.Msagl.Layout.LargeGraphLayout.DeviceIndependendZoomCalculatorForNodes.PointToTuple(this.get_Graph().get_LeftBottom(),f.get_Center(),n),r.ContainsKey(u)||r.set_Item$$TKey(u,0),e=r.set_Item$$TKey(u,r.get_Item$$TKey(u)+1)+1,e>this.maxAmountPerTile){this._levelNodeCounts.Add(i);break}if(f.get_ZoomLevelIsNotSet()&&(f.set_ZoomLevel(this.zoomLevel),this.unassigned--),this.unassigned==0){this._levelNodeCounts.Add(i+1);break}}},SomeNodesAreNotAssigned:function(){return this.unassigned>0},GetSortedLgNodeInfos:function(){var n=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,this.get_Graph().get_Nodes(),$CreateAnonymousDelegate(this,function(n){return this.NodeToLgNodeInfo(n)})));return n.Sort$$Comparison$1($CreateAnonymousDelegate(this,function(n,t){return t.get_Rank().CompareTo$$Double(n.get_Rank())})),n},GetSortedLgNodeInfos2:function(){var n=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,this.get_Graph().get_Nodes(),$CreateAnonymousDelegate(this,function(n){return this.NodeToLgNodeInfo(n)})));return n.Sort$$Comparison$1($CreateAnonymousDelegate(this,function(n,t){return t.get_ZoomLevel().CompareTo$$Double(n.get_ZoomLevel())})),n}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$DeviceIndependendZoomCalculatorForNodes);Microsoft$Msagl$Layout$LargeGraphLayout$EdgePicker={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.EdgePicker",baseTypeName:"System.Object",staticDefinition:{SetEdgeInfosZoomLevelsAndIcreaseRanks:function(n,t,i){var r=new Microsoft.Msagl.Layout.LargeGraphLayout.EdgePicker.ctor(n,t,i);r.Run()},TryToIncreaseRank:function(n,t){n.get_Rank()<t&&n.set_Rank(t)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.lgData=null;this.nodeZoomLevelCalculator=null;this._nodeCountOnLevel=0;this.zoomLevel=0;System.Object.ctor.call(this);this.lgData=n;this.nodeZoomLevelCalculator=t;this._nodeCountOnLevel=i;this.zoomLevel=t.get_SortedLgNodeInfos().get_Item$$Int32(i-1).get_ZoomLevel()|0},Run:function(){var n,t;if(this._nodeCountOnLevel==this.lgData.GeometryNodesToLgNodeInfos.get_Count()){for(n=this.lgData.GeometryEdgesToLgEdgeInfos.get_Keys().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.UpdateEdgeInfoZoomLevel$$Edge(t);return}this.FillShortRoutes()},FillShortRoutes:function(){for(var n=0;n<this._nodeCountOnLevel;n++)this.FillShortRoutesOfNode(this.nodeZoomLevelCalculator.get_SortedLgNodeInfos().get_Item$$Int32(n).get_GeometryNode())},FillShortRoutesOfNode:function(n){for(var t=n.get_OutEdges().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.TryPickingEdge(i)},TryPickingEdge:function(n){this.lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n.get_Target()).get_ZoomLevel()<=this.zoomLevel&&this.UpdateEdgeInfoZoomLevel$$Edge(n)},UpdateEdgeInfoZoomLevel$$Edge:function(n){var t=this.lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n.get_Source()),i=this.lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n.get_Target());this.UpdateEdgeInfoZoomLevel$$Edge$$Double(n,t.get_Rank()+i.get_Rank())},UpdateEdgeInfoZoomLevel$$Edge$$Double:function(n,t){var i=this.lgData.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(n);this.TryToDecreaseZoomLevel(i);Microsoft.Msagl.Layout.LargeGraphLayout.EdgePicker.TryToIncreaseRank(i,t)},TryToDecreaseZoomLevel:function(n){n.get_ZoomLevel()>this.zoomLevel&&n.set_ZoomLevel(this.zoomLevel)}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$EdgePicker);Microsoft$Msagl$Layout$LargeGraphLayout$IZoomLevelCalculator={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.IZoomLevelCalculator",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$IZoomLevelCalculator);Microsoft$Msagl$Layout$LargeGraphLayout$LgCellInfo={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgCellInfo",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.CellRectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.ZoomLevel=0;this.NumberNodesLeqItsLevelInside=0;this.MaxNumberNodesPerTile=0;System.Object.ctor.call(this)},toString:function(){return"ZoomLevel: "+this.ZoomLevel+"\nnodes of ZoomLevel <= "+this.ZoomLevel+" inside: "+this.NumberNodesLeqItsLevelInside+"/"+this.MaxNumberNodesPerTile}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgCellInfo);Microsoft$Msagl$Layout$LargeGraphLayout$LgData={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgData",baseTypeName:"System.Object",staticDefinition:{TransferHighlightedRails:function(n,t,i){for(var r=i.GetEnumerator(),u;r.MoveNext();)u=r.get_Current(),Microsoft.Msagl.Layout.LargeGraphLayout.LgData.AddRailToRailTreeOfLowerLevel(u,n);n._railsOfEdges.set_Item$$TKey(t,i);n.HighlightedRails.InsertRange(i)},AddRailToRailTreeOfLowerLevel:function(n,t){var i=n.PointTuple(),r=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(i.get_Item1(),i.get_Item2());t._railTree.Contains(r,n)||t._railTree.Add$$Rectangle$$TData(r,n)},RailBelongsToLevel:function(n,t){return n.ZoomLevel>=t.ZoomLevel}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this._connectedComponents=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor);this.GeometryNodesToLgNodeInfos=null;this.GeometryEdgesToLgEdgeInfos=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor);this._selectedEdges=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this._selectedNodeInfos=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor);this._levels=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.ctor);this.SkeletonLevels=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.LgSkeletonLevel.ctor);this.mainGeomGraph=null;this._SortedLgNodeInfos=null;this._LevelNodeCounts=null;System.Object.ctor.call(this);this.mainGeomGraph=n},Levels$$:"System.Collections.Generic.IList`1[[Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel]]",get_Levels:function(){return this._levels},AddConnectedGeomGraph:function(n){this._connectedComponents.Add(n)},ConnectedGeometryGraphs$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.GeometryGraph]]",get_ConnectedGeometryGraphs:function(){return this._connectedComponents},SortedLgNodeInfos$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Layout.LgNodeInfo]]",get_SortedLgNodeInfos:function(){return this._SortedLgNodeInfos},set_SortedLgNodeInfos:function(n){this._SortedLgNodeInfos=n},LevelNodeCounts$$:"System.Collections.Generic.List`1[[System.Int32]]",get_LevelNodeCounts:function(){return this._LevelNodeCounts},set_LevelNodeCounts:function(n){this._LevelNodeCounts=n},GetCurrentLevelByScale:function(n){return this._levels.get_Item$$Int32(this.GetLevelIndexByScale(n))},AddLevel:function(){var t=System.Math.Pow(2,System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.ctor,this._levels))|0,n=new Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.ctor(t,this.mainGeomGraph);return this._levels.Add(n),n},GetLevelIndexByScale:function(n){if(n<=1)return 0;var i=System.Math.Log$$Double$$Double(n,2),t=System.Math.Ceiling$$Double(i)|0;return i>=System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.ctor,this._levels).ZoomLevel?this._levels.get_Count()-1:(System.Diagnostics.Debug.Assert$$Boolean(0<=t&&t<this._levels.get_Count()),t)},SelectEdges$$List$1$Edge:function(n){this.get_SelectedEdges().InsertRange(n);for(var t=this._levels.get_Count()-1;t>=0;t--)this.SelectEdgesOnLevel(t,n)},SelectEdges$$List$1$Edge$$Int32:function(n,t){var r,u,i,e,f;for(this.get_SelectedEdges().InsertRange(n),r=n.GetEnumerator();r.MoveNext();)for(u=r.get_Current(),i=0;i<=t;i++)(function(){var n={Value:e},t=this._levels.get_Item$$Int32(i)._railsOfEdges.TryGetValue(u,n);return e=n.Value,t}).call(this)&&(f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor),f.Add(u),this.SelectEdgesOnLevel(i,f))},SelectedEdges$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Layout.Edge]]",get_SelectedEdges:function(){return this._selectedEdges},SelectedNodeInfos$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Layout.LgNodeInfo]]",get_SelectedNodeInfos:function(){return this._selectedNodeInfos},set_SelectedNodeInfos:function(n){this._selectedNodeInfos=n},SelectEdgesOnLevel:function(n,t){for(var f=this._levels.get_Item$$Int32(n),c=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),l=t.GetEnumerator(),i,r,a,e,s,u,h,o;l.MoveNext();)if(i=l.get_Current(),function(){var n={Value:r},t=f._railsOfEdges.TryGetValue(i,n);return r=n.Value,t}.call(this),a=this.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(i),e=System.Math.Min$$Double$$Double(System.Math.Log$$Double$$Double(a.get_ZoomLevel(),2),this._levels.get_Count()-1)|0,e=this._levels.get_Count()-1,this._levels.get_Item$$Int32(e)._railsOfEdges.ContainsKey(i)!=!1)for(r=this._levels.get_Item$$Int32(e)._railsOfEdges.get_Item$$TKey(i),Microsoft.Msagl.Layout.LargeGraphLayout.LgData.TransferHighlightedRails(f,i,r),c.InsertRange(r),s=r.GetEnumerator();s.MoveNext();)u=s.get_Current(),u.Color==null&&(u.Color=new System.Collections.Generic.List$1.ctor(System.Object.ctor)),u.Color.Contains(i.Color)==!1&&i.Color!=null&&u.Color.Add(i.Color),u.set_IsHighlighted(!0);for(h=c.GetEnumerator();h.MoveNext();)o=h.get_Current(),f.HighlightedRails.Contains$$T(o)||(o.set_IsHighlighted(!0),f.HighlightedRails.Insert(o))},GetRailsOfEdgesOnLevel:function(n,t){for(var u=this._levels.get_Item$$Int32(n),f=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),e=t.GetEnumerator(),i,r,o,s;e.MoveNext();)i=e.get_Current(),function(){var n={Value:r},t=u._railsOfEdges.TryGetValue(i,n);return r=n.Value,t}.call(this)?f.InsertRange(r):(o=this.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(i),s=System.Math.Min$$Double$$Double(System.Math.Log$$Double$$Double(o.get_ZoomLevel(),2),this._levels.get_Count()-1)|0,r=this._levels.get_Item$$Int32(s)._railsOfEdges.get_Item$$TKey(i),Microsoft.Msagl.Layout.LargeGraphLayout.LgData.TransferHighlightedRails(u,i,r));return f},GetRailsOfEdgeOnLevel:function(n,t){var u=this._levels.get_Item$$Int32(n),r=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),i;return function(){var n={Value:i},r=u._railsOfEdges.TryGetValue(t,n);return i=n.Value,r}.call(this)&&r.InsertRange(i),r},GetMaximalZoomLevel:function(){return this._levels==null||this._levels.get_Count()==0?1:System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.ctor,this._levels).ZoomLevel},PutOffEdgesPassingThroughTheRail:function(n){var t=this._levels.get_Item$$Int32(System.Math.Log$$Double$$Double(n.ZoomLevel,2)|0),i=t.GetEdgesPassingThroughRail(n);this.UnselectEdges(i)},UnselectColoredEdges:function(n,t){for(var s=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),f=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Boolean.ctor),h=n.GetEnumerator(),e,u,c,r,o,i;h.MoveNext();){for(i=h.get_Current(),r=this._levels.get_Count()-1;r>=0;r--)if(this._levels.get_Item$$Int32(r)._railsOfEdges.ContainsKey(i)!=!1)for(s=this._levels.get_Item$$Int32(r)._railsOfEdges.get_Item$$TKey(i),e=s.GetEnumerator();e.MoveNext();)(u=e.get_Current(),u.Color!=null)&&(u.Color.get_Count()>=1&&(f.ContainsKey(i)||f.set_Item$$TKey(i,!0)),u.Color.Remove(t));f.ContainsKey(i)||(i.Color=null)}for(c=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n),r=this._levels.get_Count()-1;r>=0;r--)this.PutOffEdgesOnLevel(r,c);for(o=n.GetEnumerator();o.MoveNext();)i=o.get_Current(),this.get_SelectedEdges().Remove(i)},UnselectEdges:function(n){for(var s=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),u=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Boolean.ctor),h=n.GetEnumerator(),f,r,e,c,i,o,t;h.MoveNext();){for(t=h.get_Current(),i=this._levels.get_Count()-1;i>=0;i--)if(this._levels.get_Item$$Int32(i)._railsOfEdges.ContainsKey(t)!=!1)for(s=this._levels.get_Item$$Int32(i)._railsOfEdges.get_Item$$TKey(t),f=s.GetEnumerator();f.MoveNext();)(r=f.get_Current(),r.Color!=null&&r.Color.get_Count()!=0)&&(r.Color.get_Count()>1&&(u.ContainsKey(t)||u.set_Item$$TKey(t,!0)),r.Color.Remove(t.Color));u.ContainsKey(t)||(t.Color=null)}for(e=u.get_Keys().GetEnumerator();e.MoveNext();)t=e.get_Current(),n.Remove(t);for(c=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n),i=this._levels.get_Count()-1;i>=0;i--)this.PutOffEdgesOnLevel(i,c);for(o=n.GetEnumerator();o.MoveNext();)t=o.get_Current(),this.get_SelectedEdges().Remove(t)},PutOffEdgesOnLevel:function(n,t){for(var r=this._levels.get_Item$$Int32(n),s=this.GetRailsThatShouldBeHighlighted(r,t),h=r.HighlightedRails.GetEnumerator(),i,f,u,e,o,c;h.MoveNext();)i=h.get_Current(),s.Contains$$T(i)||(Microsoft.Msagl.Layout.LargeGraphLayout.LgData.RailBelongsToLevel(r,i)?i.Color!=null&&i.Color.get_Count()>0||i.set_IsHighlighted(!1):(f=i.PointTuple(),u=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(f.get_Item1(),f.get_Item2()),r._railTree.Contains(u,i)==!1?(u=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(i.A,i.B),r._railTree.Remove(u,i)):r._railTree.Remove(u,i)));for(e=t.GetEnumerator();e.MoveNext();)o=e.get_Current(),c=this.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(o),c.get_ZoomLevel()>r.ZoomLevel&&r._railsOfEdges.Remove(o);r.HighlightedRails=s},GetRailsThatShouldBeHighlighted:function(n,t){for(var u=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),f=this.get_SelectedEdges().GetEnumerator(),i,r;f.MoveNext();)(i=f.get_Current(),t.Contains$$T(i))||function(){var t={Value:r},u=n._railsOfEdges.TryGetValue(i,t);return r=t.Value,u}.call(this)&&u.InsertRange(r);return u},AssembleEdgeAtLevel:function(n,t,i){var e=n.get_Edge(),f=this.get_Levels().get_Item$$Int32(t),r,u;for(f._railsOfEdges.set_Item$$TKey(e,i),r=i.GetEnumerator();r.MoveNext();)u=r.get_Current(),f.AddRail(u),u.UpdateTopEdgeInfo(n)},PutOffAllEdges:function(){this.UnselectEdges(System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,this.get_SelectedEdges()))},CreateLevelNodeTrees:function(n){for(var t=0;t<this._levels.get_Count();t++)this._levels.get_Item$$Int32(t).CreateNodeTree(System.Linq.Enumerable.Take$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,this.get_SortedLgNodeInfos(),this.get_LevelNodeCounts().get_Item$$Int32(t)),n),n/=2},NodeTreeIsCorrectOnLevel:function(n){return this._levels.get_Item$$Int32(n).get_NodeInfoTree().get_Count()==this.get_LevelNodeCounts().get_Item$$Int32(n)}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgData);Microsoft$Msagl$Layout$LargeGraphLayout$LgEdgeInfo={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo",baseTypeName:"Microsoft.Msagl.Core.Layout.LgInfoBase",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this._Edge=null;Microsoft.Msagl.Core.Layout.LgInfoBase.ctor.call(this);this.set_Edge(n);this.set_ZoomLevel(2147483647)},Edge$$:"Microsoft.Msagl.Core.Layout.Edge",get_Edge:function(){return this._Edge},set_Edge:function(n){this._Edge=n}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgEdgeInfo);Microsoft$Msagl$Layout$LargeGraphLayout$LgInteractor={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor.ShrinkEdgeLengths=!0},ComputePathSimplification:function(n,t,i){var w=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor),g,u,nt,v,tt,k,r,f,ft,s,y,p,it,b,e,c,l,d;for(System.Console.WriteLine$$String("Starting Path Simplicfication"),t.Start(),g=i.GetEnumerator();g.MoveNext();){for(u=g.get_Current(),nt=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),v=u.N;v<u.NumOfnodes;v++)u.DegList[v]==2&&nt.Add(v),u.VList[v].Visited=!1;for(tt=nt.GetEnumerator();tt.MoveNext();)if(k=tt.get_Current(),!u.VList[k].Visited){for(r=k,f=-1,w.set_Item$$TKey(k,1);u.DegList[r]==2&&r>=n.N;){if(y=u.EList[(r,0)].NodeId,p=u.EList[(r,1)].NodeId,f!=y?(f=r,r=y):f!=p&&(f=r,r=p),w.ContainsKey(r)){w.Clear();break}w.Add(r,1)}if(w.get_Count()!=0){for(ft=f,f=r,r=ft,s=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),s.Add(f),s.Add(r),u.VList[f].Visited=!0,u.VList[r].Visited=!0;u.DegList[r]==2&&r>=n.N;)y=u.EList[(r,0)].NodeId,p=u.EList[(r,1)].NodeId,f!=y?(f=r,r=y):f!=p&&(f=r,r=p),s.Add(r),u.VList[r].Visited=!0;for(var o=s.ToArray(),h=new Array(s.get_Count()),st=0,et=s.GetEnumerator();et.MoveNext();)it=et.get_Current(),h[st++]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u.VList[it].XLoc,u.VList[it].YLoc);for(Microsoft.Msagl.GraphmapsWithMesh.LocalModifications.PolygonalChainSimplification(h,0,h.length-1,1e3),b=0;b<h.length-1;){for(e=b+1;e<h.length;e++){if(h[e].get_X()==-1){u.RemoveEdge(o[e],o[e-1]);continue}u.RemoveEdge(o[e],o[e-1]);break}if(e<h.length){for(c=b,l=e;u.noCrossings$$Int32$Array$$Int32$$Int32(o,o[c],o[l])==!1&&c<l;)c++,l--;if(c<l)for(d=c+1;d<l;d++){var a=u.VList[o[d]],rt=u.VList[o[c]],ut=u.VList[o[l]],ot=Microsoft.Msagl.GraphmapsWithMesh.PointToSegmentDistance.getClosestPoint(rt,ut,a);a.PreciseX=ot.get_X();a.PreciseY=ot.get_Y();a.LeftX=rt.XLoc;a.LeftY=rt.YLoc;a.RightX=ut.XLoc;a.RightY=ut.YLoc}b=e}}}}}},PrepareGraphForLayout:function(n){for(var f=n.get_RootCluster().AllClustersDepthFirst().GetEnumerator(),r,u,t,i;f.MoveNext();)r=f.get_Current(),r.get_RectangularBoundary()==null&&r.set_RectangularBoundary(new Microsoft.Msagl.Core.Geometry.RectangularClusterBoundary.ctor);for(u=n.get_Edges().GetEnumerator();u.MoveNext();)t=u.get_Current(),t.get_SourcePort()==null&&(i=t,t.set_SourcePort(new Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point(function(){return i.get_Source().get_BoundaryCurve()},function(){return i.get_Source().get_Center()}))),t.get_TargetPort()==null&&(i=t,t.set_TargetPort(new Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point(function(){return i.get_Target().get_BoundaryCurve()},function(){return i.get_Target().get_Center()})))},CreateClusteredSubgraphFromFlatGraph:function(n,t){var r,i,f,o,u;if(System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,t.get_RootCluster().get_Clusters())==!1)return n;for(r=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,i=Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor.MapSubgraphNodesToNewNodesForRouting(n),Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor.ReplicateClusterStructure(n,i),Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor.AddNewNodeAndClustersToTheNewGraph(i,r),f=n.get_Edges().GetEnumerator();f.MoveNext();){var e=f.get_Current(),c=i.get_Item$$TKey(e.get_Source()),l=i.get_Item$$TKey(e.get_Target());r.get_Edges().Add(function(){var n=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(c,l);return n.set_EdgeGeometry(e.get_EdgeGeometry()),n.set_SourcePort(null),n.set_TargetPort(null),n}())}for(o=i.GetEnumerator();o.MoveNext();){var h=o.get_Current(),s=h.get_Value(),a=As(s,Microsoft.Msagl.Core.Layout.Cluster.ctor);a!=null&&(u=h.get_Key(),u.get_BoundaryCurve()!=s.get_BoundaryCurve()&&(u.set_BoundaryCurve(s.get_BoundaryCurve()),u.RaiseLayoutChangeEvent(null)))}return r},AddNewNodeAndClustersToTheNewGraph:function(n,t){for(var u=n.get_Values().GetEnumerator(),r,i;u.MoveNext();)r=u.get_Current(),i=As(r,Microsoft.Msagl.Core.Layout.Cluster.ctor),i==null?t.get_Nodes().Add(r):System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,i.get_ClusterParents())||t.get_RootCluster().AddCluster(i)},ReplicateClusterStructure:function(n,t){for(var f=n.get_Nodes().GetEnumerator(),i,r,e,u;f.MoveNext();)for(i=f.get_Current(),r=i.get_ClusterParents().GetEnumerator();r.MoveNext();)e=r.get_Current(),function(){var n={Value:u},i=t.TryGetValue(e,n);return u=n.Value,i}()&&Cast(u,Microsoft.Msagl.Core.Layout.Cluster.ctor).AddNode(t.get_Item$$TKey(i))},MapSubgraphNodesToNewNodesForRouting:function(n){for(var r=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor),u=n.get_Nodes().GetEnumerator(),t,i;u.MoveNext();)t=u.get_Current(),i=As(t,Microsoft.Msagl.Core.Layout.Cluster.ctor),r.set_Item$$TKey(t,i!=null?function(){var n=new Microsoft.Msagl.Core.Layout.Cluster.ctor;return n.set_CollapsedBoundary(i.get_CollapsedBoundary()),n.set_BoundaryCurve(t.get_BoundaryCurve()),n}():new Microsoft.Msagl.Core.Layout.Node.ctor$$ICurve(t.get_BoundaryCurve()));return r},ShowNodesAndSegmentsForOverlapRemoval:function(){},FindRailInVisGraph:function(n,t){var i,r;return function(){var t={Value:i},u={Value:r},f=n.GetStartEnd(t,u);return i=t.Value,r=u.Value,f}(),t.PathRouter.FindEdge(i,r)},LineFromRail:function(n){var t,i;return function(){var r={Value:t},u={Value:i},f=n.GetStartEnd(r,u);return t=r.Value,i=u.Value,f}(),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t,i)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this._initFromPrecomputedLgData=!1;this._lgData=null;this._lgLayoutSettings=null;this._cancelToken=null;this._mainGeometryGraph=null;this.g=null;this.PointToId=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Int32.ctor);this.locationtoNode=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Int32.ctor);this.idToNode=null;this._runInParallel=!0;this._railGraph=null;this._visibleRectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.SelectedNodeLabels=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.ctor);this.tileNodes=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.List$1.ctor);this.maxdepth=7;this.maxtiles=21845;this.immediatemaxtiles=5461;this.tileNodeCount=new Int32Array(21845);this.tileEdgeFlow=new Int32Array(21845);this.tileDepth=new Int32Array(21845);this.id=0;this.tiles=new Array(21845);this.Segs=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor);this.graphLayer=new Int32Array(100);this.RailToEdges=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor,System.Collections.Generic.List$1.ctor);this.forthefirsttime=!0;this._CurrentZoomLevel=0;System.Object.ctor.call(this);this._mainGeometryGraph=n;this._lgLayoutSettings=t;this._cancelToken=i;n.get_LgData()==null?(this._lgData=function(){var i=new Microsoft.Msagl.Layout.LargeGraphLayout.LgData.ctor(n);return i.GeometryNodesToLgNodeInfos=t.get_GeometryNodesToLgNodeInfos(),i}.call(this),n.set_LgData(this._lgData)):(this._initFromPrecomputedLgData=!0,this._lgData=n.get_LgData(),this._lgLayoutSettings.set_GeometryNodesToLgNodeInfos(this._lgData.GeometryNodesToLgNodeInfos));this.AddSkeletonLevels()},CurrentZoomLevel$$:"System.Double",get_CurrentZoomLevel:function(){return this._CurrentZoomLevel},set_CurrentZoomLevel:function(n){this._CurrentZoomLevel=n},RailGraph$$:"Microsoft.Msagl.Layout.LargeGraphLayout.RailGraph",get_RailGraph:function(){return this._railGraph},GeometryEdgesToLgEdgeInfos$$:"System.Collections.Generic.IDictionary`2[[Microsoft.Msagl.Core.Layout.Edge],[Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo]]",get_GeometryEdgesToLgEdgeInfos:function(){return this._lgData.GeometryEdgesToLgEdgeInfos},SelectedNodeInfos$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Layout.LgNodeInfo]]",get_SelectedNodeInfos:function(){return this._lgData.get_SelectedNodeInfos()},AddSkeletonLevels:function(){for(var n=this._lgData.SkeletonLevels.get_Count();n<System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.ctor,this._lgData.get_Levels());n++)this._lgData.SkeletonLevels.Add(function(){var t=new Microsoft.Msagl.Layout.LargeGraphLayout.LgSkeletonLevel.ctor;return t.ZoomLevel=this._lgData.get_Levels().get_Item$$Int32(n).ZoomLevel,t}.call(this))},calculateGraphsForEachZoomLevel:function(n,t){var l=new System.Diagnostics.Stopwatch.ctor,v,c,r,i,a,p,w,b,tt,k,h,u,f,o;l.Start();System.Console.WriteLine$$String("Calculating Graphs For Each ZoomLevel");var y=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.GraphmapsWithMesh.Tiling.ctor),s=null,d=new Microsoft.Msagl.GraphmapsWithMesh.DijkstraAlgo.ctor;for(n.pathList=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Collections.Generic.List$1.ctor),v=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Collections.Generic.List$1.ctor),c=1;c<=n.maxTheoreticalZoomLevel;c*=2){for(r=new Microsoft.Msagl.GraphmapsWithMesh.Tiling.ctor$$Int32$$Boolean(n.NumOfnodes,!0),r.N=n.N,i=0;i<n.NumOfnodes;i++)r.VList[i]=function(){var t=new Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor(n.VList[i].XLoc,n.VList[i].YLoc);return t.Id=n.VList[i].Id,t.ZoomLevel=n.VList[i].ZoomLevel,t}.call(this),r.VList[i].TargetX=r.VList[i].PreciseX=r.VList[i].XLoc,r.VList[i].TargetY=r.VList[i].PreciseY=r.VList[i].YLoc;if(s!=null)for(i=0;i<s.NumOfnodes;i++)for(a=0;a<s.DegList[i];a++)r.AddEdge$$Int32$$Int32$$Int32$$Int32(i,s.EList[(i,a)].NodeId,s.EList[(i,a)].Selected,s.EList[(i,a)].Used);for(p=this._mainGeometryGraph.get_Edges().GetEnumerator();p.MoveNext();){var e=p.get_Current(),g=n.VList[t.get_Item$$TKey(e.get_Source())].ZoomLevel,nt=n.VList[t.get_Item$$TKey(e.get_Target())].ZoomLevel;if(g<=c&&nt<=c){if(g<c&&nt<c){r.pathList.set_Item$$TKey(e,s.pathList.get_Item$$TKey(e));continue}for(r.pathList.set_Item$$TKey(e,new System.Collections.Generic.List$1.ctor(System.Int32.ctor)),v.ContainsKey(e)||(w=d.MSAGLAstarShortestPath(n.VList,n.EList,n.DegList,t.get_Item$$TKey(e.get_Source()),t.get_Item$$TKey(e.get_Target()),n.NumOfnodes),w.get_Count()==0&&System.Console.WriteLine$$String("missing path!"),n.pathList.Add(e,w),v.Add(e,d.Edgelist)),b=n.pathList.get_Item$$TKey(e).GetEnumerator();b.MoveNext();)tt=b.get_Current(),r.pathList.get_Item$$TKey(e).Add(tt);for(k=v.get_Item$$TKey(e).GetEnumerator();k.MoveNext();)h=k.get_Current(),r.AddEdge$$Int32$$Int32$$Int32$$Int32(h.A,n.EList[(h.A,h.Neighbor)].NodeId,n.EList[(h.A,h.Neighbor)].Selected,n.EList[(h.A,h.Neighbor)].Used)}}s=r;y.Add(r)}for(l.Stop(),System.Console.WriteLine$$String("Graphs for all levels calculated = "+l.get_ElapsedMilliseconds()),Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor.ComputePathSimplification(n,l,y),u=y.ToArray(),f=0;f<u.length;f++)for(o=u[f].N;o<u[f].NumOfnodes;o++)f<u.length-1?(u[f].VList[o].TargetX=u[f+1].VList[o].PreciseX,u[f].VList[o].TargetY=u[f+1].VList[o].PreciseY):(u[f].VList[o].TargetX=u[f].VList[o].PreciseX,u[f].VList[o].TargetY=u[f].VList[o].PreciseY);return l.Stop(),System.Console.WriteLine$$String("Done Simplification = "+l.get_ElapsedMilliseconds()),u},PromptUserforGraphSize:function(){System.Console.WriteLine();System.Console.WriteLine$$String("Loading a huge graph? (Y/N)");var n=System.Console.ReadLine();return n.StartsWith$$String("Y")||n.StartsWith$$String("y")},PromptUserforFlow:function(){System.Console.WriteLine();System.Console.WriteLine$$String("Use Flow to assign nodes on layers? (Y/N)");var n=System.Console.ReadLine();return n.StartsWith$$String("Y")||n.StartsWith$$String("y")},SetControlVariables:function(){this._mainGeometryGraph.get_Edges().get_Count()>=15e3?this._lgLayoutSettings.set_MaxNumberOfNodesPerTile(20):this._mainGeometryGraph.get_Edges().get_Count()>=1e4?this._lgLayoutSettings.set_MaxNumberOfNodesPerTile(30):this._lgLayoutSettings.set_MaxNumberOfNodesPerTile(40);this._mainGeometryGraph.get_Nodes().get_Count()>=1e3&&this._mainGeometryGraph.get_Edges().get_Count()<=15e3&&this._lgLayoutSettings.set_MaxNumberOfNodesPerTile(40);this._lgLayoutSettings.delta=(this._lgLayoutSettings.get_MaxNumberOfNodesPerTile()/8|0)+1},RunForMsaglFiles:function(n){System.Console.WriteLine$$String("Running in Default Settings - Enable UserPrompt in LgInteractor if needed.");this._lgLayoutSettings.hugeGraph=!0;this._lgLayoutSettings.flow=!1;this.SetControlVariables();var t,r=function(){var i={Value:t},r=this.TryCompetitionMeshApproach(i,n);return t=i.Value,r}.call(this),i=new System.Diagnostics.Stopwatch.ctor,u=this.calculateGraphsForEachZoomLevel(r,t,this._lgLayoutSettings.hugeGraph);i.Start();this.DrawAtEachLevelQuotaBounded(u,t);i.Stop();System.Console.WriteLine$$String("Time for DrawAtEachLevelQuotaBounded = "+i.get_ElapsedMilliseconds());System.Console.WriteLine$$String("Total Number of Rails = "+this._lgData.get_Levels().get_Item$$Int32(this._lgData.get_Levels().get_Count()-1).get_RailDictionary().get_Values().get_Count())},DrawAtEachLevelQuotaBounded:function(n){var t=0,v=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),e,c,i,o,u,r,f,h;for(this._lgData.get_Levels().Clear(),e=this._mainGeometryGraph.get_Nodes().GetEnumerator();e.MoveNext();)c=e.get_Current(),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(c).set_ZoomLevel(this.maxdepth);for(i=0;i<n.length;i++){for(o=this.CreateLevel(t),u=0,r=0;r<n[i].N;r++)n[i].DegList[r]>0&&(f=this.idToNode.get_Item$$TKey(n[i].VList[r].Id),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(f).get_ZoomLevel()==this.maxdepth?(u++,this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(f).set_ZoomLevel(t),this._lgLayoutSettings.get_GeometryNodesToLgNodeInfos().get_Item$$TKey(f).set_ZoomLevel(t)):u++);this._lgData.get_LevelNodeCounts().set_Item$$Int32(t,u);for(var a=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Int32.ctor),s=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),l=this._mainGeometryGraph.get_Edges().GetEnumerator();l.MoveNext();)h=l.get_Current(),s=this.MsaglAddRailsOfEdgeQuotaBounded(o,n[i],h,a),s.get_Count()>0&&o._railsOfEdges.set_Item$$TKey(h,s);t++}this._lgLayoutSettings.maximumNumOfLayers=t;System.Console.WriteLine$$String("MAX Num of Level "+t)},DrawAtEachLevelQuotaSatisfied:function(n,t){var i=0,u=0,h=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),e,o,s,r,f,c;for(this._lgData.get_Levels().Clear(),e=this.CreateLevel(i),o=this._mainGeometryGraph.get_Nodes().GetEnumerator();o.MoveNext();)r=o.get_Current(),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r).set_ZoomLevel(100);for(s=this._lgData.get_SortedLgNodeInfos().GetEnumerator();s.MoveNext();){for(r=s.get_Current(),this._lgData.get_SortedLgNodeInfos().get_Item$$Int32(u).set_ZoomLevel(i),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r.get_GeometryNode()).set_ZoomLevel(i),h.Add(r.get_GeometryNode()),f=i,i>=n.length&&(f=n.length-1),c=System.Math.Log$$Double$$Double(n[f].VList[t.get_Item$$TKey(r.get_GeometryNode())].ZoomLevel,2);;){if(c<=i&&this.MsaglNodePlottedandQuotaSatisfied(n[f],e,f,u,h,t))break;i++;e=this.CreateLevel(i);this._lgData.get_SortedLgNodeInfos().get_Item$$Int32(u).set_ZoomLevel(i);this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r.get_GeometryNode()).set_ZoomLevel(i);this._lgLayoutSettings.get_GeometryNodesToLgNodeInfos().get_Item$$TKey(r.get_GeometryNode()).set_ZoomLevel(i);r.set_ZoomLevel(i);f=i>=n.length?n.length-1:i;this._lgData.get_LevelNodeCounts().set_Item$$Int32(i,u)}u++;this._lgData.get_LevelNodeCounts().set_Item$$Int32(i,u)}this._lgLayoutSettings.maximumNumOfLayers=i;System.Console.WriteLine$$String("MAX Num of Level "+i)},buildTiles:function(n,t,i,r,u,f){var e,o,s;u>this.maxdepth||(e=4*f,this.tiles[f]=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(n,t,i,r),this.tileDepth[f]=u,o=n+(i-n)/2,s=t+(r-t)/2,this.buildTiles(n,t,o,s,u+1,e+1,1),this.buildTiles(o,t,i,s,u+1,e+2,2),this.buildTiles(n,s,o,r,u+1,e+3,3),this.buildTiles(o,s,i,r,u+1,e+4,4))},computeEdgeFlow:function(n,t,i,r){var f,u;if(this.immediatemaxtiles<=n&&n<=this.maxtiles)return!0;if(f=new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n,t),u=r.get_Item$$TKey(f).ToArray(),u.length==0)return!1;this.tileEdgeFlow[4*n+1]=u[1];this.tileEdgeFlow[4*n+2]=u[2];this.tileEdgeFlow[4*n+3]=u[3];this.tileEdgeFlow[4*n+4]=u[4];var e=this.computeEdgeFlow(4*n+1,u[1],i,r),o=this.computeEdgeFlow(4*n+2,u[2],i,r),s=this.computeEdgeFlow(4*n+3,u[3],i,r),h=this.computeEdgeFlow(4*n+4,u[4],i,r);return e&o&s&h},dynamicProgram:function(n,t,i,r){var f,o,s,h,a,g,u,y;if(this.immediatemaxtiles<=n&&n<=this.maxtiles)return this.tileNodeCount[n]<t?0:(this.tileNodeCount[n]-t)*(this.tileNodeCount[n]-t);var l,p=0,w=0,b=0,k=0,v=2147483647,d=2147483647;for(f=t;f<=this._lgLayoutSettings.get_MaxNumberOfNodesPerTile();f+=this._lgLayoutSettings.delta)for(o=0;o<=f;o+=this._lgLayoutSettings.delta)for(s=0;s<=f;s+=this._lgLayoutSettings.delta){if(f<o+s)break;for(h=0;h<=f;h+=this._lgLayoutSettings.delta){if(a=f-(o+s+h),a<0)break;if(g=o+s+h+a,g==f){var nt=f-t,tt=!0,e=new Int32Array(5),c=new Int32Array(5);for(c[1]=o,c[2]=s,c[3]=h,c[4]=a,u=1;u<=4;u++)e[u]=i[(4*n+u,c[u])],e[u]==-1&&(e[u]=this.dynamicProgram(4*n+u,c[u],i,r),i[(4*n+u,c[u])]=e[u]),e[u]==2147483647&&(tt=!1);tt!=!1&&(l=1+System.Math.Log$$Double$$Double(n+1,4)|0*nt*nt,n==0&&(l=0),l+=e[1]+e[2]+e[3]+e[4],v>l&&(v=l,d=f,p=o,w=s,b=h,k=a))}}}return i[(n,t)]=v,y=new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n,t),r.ContainsKey(y)||r.set_Item$$TKey(y,new System.Collections.Generic.List$1.ctor(System.Int32.ctor)),r.set_Item$$TKey(y,function(){var n=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);return n.Add(d),n.Add(p),n.Add(w),n.Add(b),n.Add(k),n}.call(this)),v},distributeNodes:function(n,t,i,r){var v,y,p,e,f,w,u;if(!(this.immediatemaxtiles<=n)||!(n<=this.maxtiles)){this.distributeNodes(4*n+1,t,i,r);this.distributeNodes(4*n+2,t,i,r);this.distributeNodes(4*n+3,t,i,r);this.distributeNodes(4*n+4,t,i,r);for(var o=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),s=new System.Collections.Generic.List$1.ctor(System.Double.ctor),b=this.tileNodes.get_Item$$TKey(4*n+1).GetEnumerator();b.MoveNext();)e=b.get_Current(),o.Add(e),s.Add(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r.get_Item$$TKey(e)).get_ZoomLevel());for(v=this.tileNodes.get_Item$$TKey(4*n+2).GetEnumerator();v.MoveNext();)e=v.get_Current(),o.Add(e),s.Add(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r.get_Item$$TKey(e)).get_ZoomLevel());for(y=this.tileNodes.get_Item$$TKey(4*n+3).GetEnumerator();y.MoveNext();)e=y.get_Current(),o.Add(e),s.Add(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r.get_Item$$TKey(e)).get_ZoomLevel());for(p=this.tileNodes.get_Item$$TKey(4*n+4).GetEnumerator();p.MoveNext();)e=p.get_Current(),o.Add(e),s.Add(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r.get_Item$$TKey(e)).get_ZoomLevel());n==0&&System.Console.Write$$String("");f=o.ToArray();w=s.ToArray();System.Array.Sort$2$$TKey$Array$$TValue$Array(System.Double.ctor,System.Int32.ctor,w,f);this.tileNodes.set_Item$$TKey(n,new System.Collections.Generic.List$1.ctor(System.Int32.ctor));var h=this.tileEdgeFlow[4*n+1],c=this.tileEdgeFlow[4*n+2],l=this.tileEdgeFlow[4*n+3],a=this.tileEdgeFlow[4*n+4];for(u=0;u<f.length;u++)if(w[u]<=System.Math.Pow(2,this.tileDepth[n])){this.tileNodes.get_Item$$TKey(n).Add(f[u]);this.tileNodes.get_Item$$TKey(4*n+1).Remove(f[u])&&h--;this.tileNodes.get_Item$$TKey(4*n+2).Remove(f[u])&&c--;this.tileNodes.get_Item$$TKey(4*n+3).Remove(f[u])&&l--;this.tileNodes.get_Item$$TKey(4*n+4).Remove(f[u])&&a--;continue}for(h*=1+System.Math.Log$$Double$$Double(n,4)|0,c*=1+System.Math.Log$$Double$$Double(n,4)|0,l*=1+System.Math.Log$$Double$$Double(n,4)|0,a*=1+System.Math.Log$$Double$$Double(n,4)|0,u=0;u<f.length;u++)this.tileNodes.get_Item$$TKey(4*n+1).Contains(f[u])&&h>0?(this.tileNodes.get_Item$$TKey(n).Add(f[u]),this.tileNodes.get_Item$$TKey(4*n+1).Remove(f[u]),h--,System.Console.Write$$String(".")):this.tileNodes.get_Item$$TKey(4*n+2).Contains(f[u])&&c>0?(this.tileNodes.get_Item$$TKey(n).Add(f[u]),this.tileNodes.get_Item$$TKey(4*n+2).Remove(f[u]),c--,System.Console.Write$$String(".")):this.tileNodes.get_Item$$TKey(4*n+3).Contains(f[u])&&l>0?(this.tileNodes.get_Item$$TKey(n).Add(f[u]),this.tileNodes.get_Item$$TKey(4*n+3).Remove(f[u]),l--,System.Console.Write$$String(".")):this.tileNodes.get_Item$$TKey(4*n+4).Contains(f[u])&&a>0&&(this.tileNodes.get_Item$$TKey(n).Add(f[u]),this.tileNodes.get_Item$$TKey(4*n+4).Remove(f[u]),a--,System.Console.Write$$String("."))}},distributeNodesOld:function(n,t,i,r){var h,c,l,e,u,b,f;if(!(this.immediatemaxtiles<=n)||!(n<=this.maxtiles)){this.distributeNodesOld(4*n+1,t,i,r);this.distributeNodesOld(4*n+2,t,i,r);this.distributeNodesOld(4*n+3,t,i,r);this.distributeNodesOld(4*n+4,t,i,r);for(var o=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),s=new System.Collections.Generic.List$1.ctor(System.Double.ctor),w=this.tileNodes.get_Item$$TKey(4*n+1).GetEnumerator();w.MoveNext();)e=w.get_Current(),o.Add(e),s.Add(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r.get_Item$$TKey(e)).get_ZoomLevel());for(h=this.tileNodes.get_Item$$TKey(4*n+2).GetEnumerator();h.MoveNext();)e=h.get_Current(),o.Add(e),s.Add(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r.get_Item$$TKey(e)).get_ZoomLevel());for(c=this.tileNodes.get_Item$$TKey(4*n+3).GetEnumerator();c.MoveNext();)e=c.get_Current(),o.Add(e),s.Add(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r.get_Item$$TKey(e)).get_ZoomLevel());for(l=this.tileNodes.get_Item$$TKey(4*n+4).GetEnumerator();l.MoveNext();)e=l.get_Current(),o.Add(e),s.Add(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r.get_Item$$TKey(e)).get_ZoomLevel());n==0&&System.Console.Write$$String("");u=o.ToArray();b=s.ToArray();System.Array.Sort$2$$TKey$Array$$TValue$Array(System.Double.ctor,System.Int32.ctor,b,u);this.tileNodes.set_Item$$TKey(n,new System.Collections.Generic.List$1.ctor(System.Int32.ctor));var a=this.tileEdgeFlow[4*n+1],v=this.tileEdgeFlow[4*n+2],y=this.tileEdgeFlow[4*n+3],p=this.tileEdgeFlow[4*n+4];if(a+v+y+p!=0)for(f=0;f<u.length;f++)this.tileNodes.get_Item$$TKey(4*n+1).Contains(u[f])&&a>0?(this.tileNodes.get_Item$$TKey(n).Add(u[f]),this.tileNodes.get_Item$$TKey(4*n+1).Remove(u[f]),a--,System.Console.Write$$String(".")):this.tileNodes.get_Item$$TKey(4*n+2).Contains(u[f])&&v>0?(this.tileNodes.get_Item$$TKey(n).Add(u[f]),this.tileNodes.get_Item$$TKey(4*n+2).Remove(u[f]),v--,System.Console.Write$$String(".")):this.tileNodes.get_Item$$TKey(4*n+3).Contains(u[f])&&y>0?(this.tileNodes.get_Item$$TKey(n).Add(u[f]),this.tileNodes.get_Item$$TKey(4*n+3).Remove(u[f]),y--,System.Console.Write$$String(".")):this.tileNodes.get_Item$$TKey(4*n+4).Contains(u[f])&&p>0&&(this.tileNodes.get_Item$$TKey(n).Add(u[f]),this.tileNodes.get_Item$$TKey(4*n+4).Remove(u[f]),p--,System.Console.Write$$String("."))}},TryCompetitionMeshApproach:function(n,t){var f=this.LoadNodeLocationsFromFile(t),i,r,u;return this._mainGeometryGraph.UpdateBoundingBox(),this._lgLayoutSettings.lgGeometryGraph=this._mainGeometryGraph,System.Console.WriteLine$$String("Nodes = "+this._mainGeometryGraph.get_Nodes().get_Count()+"Edges = "+this._mainGeometryGraph.get_Edges().get_Count()),this.g=new Microsoft.Msagl.GraphmapsWithMesh.Tiling.ctor$$Int32$$Boolean(this._mainGeometryGraph.get_Nodes().get_Count(),!0),this.idToNode=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,Microsoft.Msagl.Core.Layout.Node.ctor),n.Value=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Int32.ctor),i=new System.Diagnostics.Stopwatch.ctor,i.Start(),this.CreateConnectedGraphs(),this.FillGeometryNodeToLgInfosTables(),Microsoft.Msagl.Layout.LargeGraphLayout.LevelCalculator.RankGraph(this._lgData,this._mainGeometryGraph),f||this.LayoutTheWholeGraph(),u=function(){var i={Value:r},u=this.CreateNodePositions(this.g,n.Value,this.idToNode,i,t);return r=i.Value,u}.call(this),this._lgLayoutSettings.flow&&this.ComputeZoomLevelviaFlow(n.Value,u,r),i.Stop(),System.Console.WriteLine$$String("Conected Graph and MDS Time = "+i.get_ElapsedMilliseconds()),i.Start(),Microsoft.Msagl.GraphmapsWithMesh.MeshCreator.FastCompetitionMesh(this.g,this.idToNode,u,r,this.locationtoNode),i.Stop(),System.Console.WriteLine$$String("MeshCreation Time = "+i.get_ElapsedMilliseconds()),i.Start(),this.g.MsaglDetour(this.idToNode,!0),this.g.CreateNodeTreeEdgeTree(),i.Stop(),System.Console.WriteLine$$String("Detour Creation Time = "+i.get_ElapsedMilliseconds()),i.Start(),this.g=this.ComputeEdgeRoutes(this.g,n.Value),i.Stop(),System.Console.WriteLine$$String("Lev's = "+i.get_ElapsedMilliseconds()),System.Console.WriteLine$$String("Removing Deg 2 junctions"),i.Start(),this.g.MsaglRemoveDeg2(this.idToNode),i.Stop(),System.Console.WriteLine$$String("Deg 2 removal Time = "+i.get_ElapsedMilliseconds()),i.Start(),Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities.TransformToGeometricPlanarGraph(this.g),i.Stop(),System.Console.WriteLine$$String("Planar Graph Building Time = "+i.get_ElapsedMilliseconds()),i.Start(),Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities.RemoveLongEdgesFromThinFaces(this.g),i.Stop(),System.Console.WriteLine$$String("Thin Face Removal Time = "+i.get_ElapsedMilliseconds()),i.Start(),Microsoft.Msagl.GraphmapsWithMesh.LocalModifications.MsaglMoveToMedian(this.g,this.idToNode,this._lgLayoutSettings),i.Stop(),System.Console.WriteLine$$String("Ink Minimization Time = "+i.get_ElapsedMilliseconds()),Microsoft.Msagl.GraphmapsWithMesh.LocalModifications.MsaglShortcutShortEdges(this.g,this.idToNode,this._lgLayoutSettings),this.g.MsaglRemoveDeg2(this.idToNode),Microsoft.Msagl.GraphmapsWithMesh.LocalModifications.MsaglMoveToMedian(this.g,this.idToNode,this._lgLayoutSettings),this.g},ComputeZoomLevelviaFlow:function(n,t,i){var e,o,u,f,r,s;for(System.Console.WriteLine$$String("Assign Nodes to zoomlevels via Flow. Increase delta for faster computation."),this.id=0,this.buildTiles(0,0,t,i,0,0,0),System.Console.WriteLine$$String("Number of tiles ="+this.id),this.id=0,e=0,o=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(System.Int32.ctor),r=0;r<this.g.N;r++)o.Add$$Rectangle$$TData(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.g.VList[r].XLoc,this.g.VList[r].YLoc)),r);for(u=this.immediatemaxtiles;u<this.maxtiles;u++)if(!(this.tileDepth[u]<this.maxdepth)){for(this.tileNodes.Add(u,new System.Collections.Generic.List$1.ctor(System.Int32.ctor)),f=o.GetAllIntersecting(this.tiles[u]),r=0;r<f.length;r++)this.tileNodes.get_Item$$TKey(u).Add(f[r]);e+=f.length;this.tileNodeCount[u]=f.length}System.Console.WriteLine$$String("Total Nodes ="+this.g.N+" Nodes Found "+e);s=this._lgLayoutSettings.get_MaxNumberOfNodesPerTile();throw $CreateException(new System.NotImplementedException.ctor,new Error);},loadBipartiteData:function(n){var i,t,r,u,f,e;if(n==null)return!1;n=n.Replace$$String$$String(".tiles","");try{for(i=new System.IO.StreamReader.ctor$$String(n+".set"),t=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,System.Int32.ctor);(n=i.ReadLine())!=null;)r=n.Split$$Char$Array(","),t.set_Item$$TKey(r[0].trim(),System.Int32.Parse$$String(r[1]));for(u=this._mainGeometryGraph.get_Nodes().GetEnumerator();u.MoveNext();)f=u.get_Current(),e=f.toString().trim(),t.ContainsKey(e)&&(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(f).PartiteSet=t.get_Item$$TKey(e));return i.Close(),!0}catch(o){return System.Console.WriteLine$$String(o.get_Message()),System.Console.WriteLine$$String("May not be a Bipartite Graph"),!1}},LoadNodeLocationsFromFile:function(n){var t,o,i,r,s,h,f,u,e;if(n==null)return!1;t=n.Replace$$String$$String(".tiles","");try{for(o=new System.IO.StreamReader.ctor$$String(t+".loc"),i=new System.Collections.Generic.Dictionary$2.ctor(System.String.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor);(t=o.ReadLine())!=null;)r=t.Split$$Char$Array(","),s=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Double.Parse$$String(r[1])*5,System.Double.Parse$$String(r[2])*5),i.set_Item$$TKey(r[0],s);for(h=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),f=this._mainGeometryGraph.get_Nodes().GetEnumerator();f.MoveNext();)u=f.get_Current(),e=u.toString(),i.ContainsKey(e)?u.set_Center(i.get_Item$$TKey(e)):h.Add(u);return!0}catch(c){return System.Console.WriteLine$$String(c.get_Message()),System.Console.WriteLine$$String("exiting LoadNodeLocationsFromFile"),!1}},RouteByLayers:function(){this.FillLevelsWithNodesOnly(2147483647);this.InitRailsOfEdgesEmpty();this.AddSkeletonLevels();for(var n=0;n<this._lgData.get_Levels().get_Count();n++)this.RemoveOverlapsAndRouteForLayer(2147483647,2147483647,2147483647,n);this._lgData.CreateLevelNodeTrees(this.NodeDotWidth(1));this.TestAllEdgesConsistency()},CreateNodePositions:function(n,t,i,r,u){var s=0,l,b,k,e,a,d,o,ut,v,g,nt,tt,it,f,y;r.Value=0;for(var p=0,w=0,rt=this._mainGeometryGraph.get_Nodes().GetEnumerator();rt.MoveNext();)f=rt.get_Current(),f.get_Center().get_X()<p&&(p=f.get_Center().get_X()),f.get_Center().get_Y()<w&&(w=f.get_Center().get_Y());for(l=0,b=this._mainGeometryGraph.get_Nodes().GetEnumerator();b.MoveNext();)f=b.get_Current(),t.Add(f,l),i.Add(l,f),f.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(f.get_Center().get_X()-p+5|0,f.get_Center().get_Y()-w+5|0)),f.get_Center().get_X()>s&&(s=f.get_Center().get_X()|0),f.get_Center().get_Y()>r.Value&&(r.Value=f.get_Center().get_Y()|0),l++;for(k=this._mainGeometryGraph.get_Nodes().GetEnumerator();k.MoveNext();){for(var f=k.get_Current(),h=f.get_Center().get_X(),c=f.get_Center().get_Y(),o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(h|0,c|0),h=h|0,c=c|0;this.locationtoNode.ContainsKey(o);)h++,c++,o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(h|0,c|0);f.set_Center(o);this.locationtoNode.ContainsKey(o)||this.locationtoNode.Add(o,t.get_Item$$TKey(f));n.VList[t.get_Item$$TKey(f)]=function(){var n=new Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor(o.get_X()|0,o.get_Y()|0);return n.Id=t.get_Item$$TKey(f),n}.call(this)}for(s=0,r.Value=0,e=0;e<n.NumOfnodes;e++)n.VList[e].XLoc*=5,n.VList[e].YLoc*=5,i.get_Item$$TKey(e).set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.VList[e].XLoc,n.VList[e].YLoc)),n.VList[e].XLoc>s&&(s=n.VList[e].XLoc),n.VList[e].YLoc>r.Value&&(r.Value=n.VList[e].YLoc);for(this.locationtoNode=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Int32.ctor),e=0;e<n.NumOfnodes;e++)o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.VList[e].XLoc,n.VList[e].YLoc),this.locationtoNode.Add(o,e);for(a=0,d=this._mainGeometryGraph.get_Nodes().GetEnumerator();d.MoveNext();)f=d.get_Current(),o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.VList[a].XLoc,n.VList[a].YLoc),n.nodeToLoc.Add(f,o),a++;if(this._lgData.set_SortedLgNodeInfos(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor)),Microsoft.Msagl.Layout.LargeGraphLayout.LevelCalculator.SetNodeZoomLevelsAndRouteEdgesOnLevels(this._lgData,this._mainGeometryGraph,this._lgLayoutSettings),ut=this.loadBipartiteData(u),ut){for(v=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor),g=this._lgData.get_SortedLgNodeInfos().GetEnumerator();g.MoveNext();)f=g.get_Current(),f.PartiteSet==1&&v.Add(f);for(nt=this._lgData.get_SortedLgNodeInfos().GetEnumerator();nt.MoveNext();)f=nt.get_Current(),f.PartiteSet==0&&v.Add(f);for(this._lgData.get_SortedLgNodeInfos().Clear(),tt=v.GetEnumerator();tt.MoveNext();)f=tt.get_Current(),this._lgData.get_SortedLgNodeInfos().Add(f)}for(it=this._lgData.get_SortedLgNodeInfos().GetEnumerator();it.MoveNext();)f=it.get_Current(),y=f.get_ZoomLevel()|0,n.VList[t.get_Item$$TKey(f.get_GeometryNode())].ZoomLevel=y,n.maxTheoreticalZoomLevel<y&&(n.maxTheoreticalZoomLevel=y);return this._lgData.get_Levels().Clear(),this._mainGeometryGraph.UpdateBoundingBox(),s},ComputeEdgeRoutes:function(n,t){var r=new Microsoft.Msagl.GraphmapsWithMesh.Tiling.ctor$$Int32$$Boolean(n.NumOfnodes,!0),f,e,u,i;for(r.N=n.N,r.isPlanar=n.isPlanar,r.NumOfnodesBeforeDetour=n.NumOfnodesBeforeDetour,r.nodeTree=n.nodeTree,r.maxTheoreticalZoomLevel=n.maxTheoreticalZoomLevel,i=0;i<n.NumOfnodes;i++)r.VList[i]=function(){var t=new Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor(n.VList[i].XLoc,n.VList[i].YLoc);return t.Id=n.VList[i].Id,t.ZoomLevel=n.VList[i].ZoomLevel,t}.call(this);for(var o=new Microsoft.Msagl.GraphmapsWithMesh.DijkstraAlgo.ctor,s=0,h=this._mainGeometryGraph.get_Edges().GetEnumerator();h.MoveNext();)for(f=h.get_Current(),s++,s%1e4==0&&System.Console.WriteLine$$String("."),o.MSAGLGreedy(n.VList,n.EList,n.DegList,t.get_Item$$TKey(f.get_Source()),t.get_Item$$TKey(f.get_Target()),n.NumOfnodes),e=o.Edgelist.GetEnumerator();e.MoveNext();)u=e.get_Current(),r.AddEdge$$Int32$$Int32$$Int32$$Int32(u.A,n.EList[(u.A,u.Neighbor)].NodeId,n.EList[(u.A,u.Neighbor)].Selected,n.EList[(u.A,u.Neighbor)].Used);for(i=0;i<r.NumOfnodes;i++)r.DegList[i]==0&&(r.VList[i].Invalid=!0);return r},MsaglNodePlottedandQuotaSatisfied:function(n,t,i,r,u,f){var h,l,c,a,v,e,y,p,b,w,o;for(this.graphLayer[t.ZoomLevel]=i,h=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),l=this._mainGeometryGraph.get_Edges().GetEnumerator();l.MoveNext();)o=l.get_Current(),t._railsOfEdges.ContainsKey(o)||(h=this.MsaglAddRailsOfEdge(t,n,o,f),h.get_Count()>0&&t._railsOfEdges.set_Item$$TKey(o,h));for(a=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor),v=t.get_RailDictionary().get_Values().GetEnumerator();v.MoveNext();)e=v.get_Current(),c=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,e.Left,e.Right),this.Segs.ContainsKey(c)||(this.Segs.Add(c,e),a.Add(c));if(y=!0,t.QuotaSatisfied(u,this._lgLayoutSettings.get_MaxNumberOfNodesPerTile(),this._lgLayoutSettings.get_MaxNumberOfRailsPerTile())||(y=!1),!y&&t.ZoomLevel-1>=0){for(t._railsOfEdges.Clear(),t._railDictionary.Clear(),t.get_RailTree().Clear(),p=a.GetEnumerator();p.MoveNext();)b=p.get_Current(),this.Segs.Remove(b);for(w=this._lgData.get_Levels().get_Item$$Int32(t.ZoomLevel-1)._railsOfEdges.get_Keys().GetEnumerator();w.MoveNext();){o=w.get_Current();h=this._lgData.get_Levels().get_Item$$Int32(t.ZoomLevel-1)._railsOfEdges.get_Item$$TKey(o);for(var k=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),tt=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),d=h.GetEnumerator();d.MoveNext();){var s=d.get_Current(),g=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(s.A,s.B),nt=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,s.A,s.B),e;(function(){var n={Value:e},i=t._railDictionary.TryGetValue(nt,n);return e=n.Value,i}).call(this)?this.RailToEdges.get_Item$$TKey(e).Contains(o)||this.RailToEdges.get_Item$$TKey(e).Add(o):(e=new Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor$$ICurve$$LgEdgeInfo$$Int32(g,this._lgData.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(o),t.ZoomLevel),this._lgData.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(o).set_ZoomLevel(t.ZoomLevel),e.A=s.targetA,e.B=s.targetB,e.initialA=s.initialA,e.initialB=s.initialB,e.targetA=s.targetA,e.targetB=s.targetB,this.RailToEdges.ContainsKey(e)||this.RailToEdges.set_Item$$TKey(e,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor)),this.RailToEdges.get_Item$$TKey(e).Contains(o)||this.RailToEdges.get_Item$$TKey(e).Add(o),t._railDictionary.set_Item$$TKey(nt,e),t._railTree.Add$$Rectangle$$TData(g.get_BoundingBox(),e),k.Insert(e))}t._railsOfEdges.set_Item$$TKey(o,k)}return!1}return!0},MsaglNodeSuccessfullyPlotted:function(n,t,i,r,u,f){var o,l,s,h,a,c,v,y,d,p,w,g,b,e;for(this.graphLayer[t.ZoomLevel]=i,o=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),l=this._mainGeometryGraph.get_Edges().GetEnumerator();l.MoveNext();)e=l.get_Current(),t._railsOfEdges.ContainsKey(e)||(o=this.MsaglAddRailsOfEdge(t,n,e,f),o.get_Count()>0&&t._railsOfEdges.set_Item$$TKey(e,o));var nt=this.GetLargestTile(),tt=new Microsoft.Msagl.Miscellaneous.RegularGrid.GridTraversal.ctor(nt,t.ZoomLevel),k=new Microsoft.Msagl.Layout.LargeGraphLayout.NodeRailLevelCalculator.GreedyNodeRailLevelCalculator.ctor(this._lgData.get_SortedLgNodeInfos());for(k.MaxAmountRailsPerTile=this._lgLayoutSettings.get_MaxNumberOfRailsPerTile(),h=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor),a=t.get_RailDictionary().get_Values().GetEnumerator();a.MoveNext();)c=a.get_Current(),s=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,c.Left,c.Right),this.Segs.ContainsKey(s)||(this.Segs.Add(s,c),h.Add(s));for(v=!0,y=h.GetEnumerator();y.MoveNext();)d=y.get_Current(),k.IfCanInsertLooseSegmentUpdateTiles(d,tt)==!1&&(v=!1);if(!v&&t.ZoomLevel-1>=0){for(p=t._railsOfEdges.get_Keys().GetEnumerator();p.MoveNext();)e=p.get_Current(),t._railsOfEdges.get_Item$$TKey(e).Clear();for(w=h.GetEnumerator();w.MoveNext();)g=w.get_Current(),this.Segs.Remove(g);for(b=this._lgData.get_Levels().get_Item$$Int32(t.ZoomLevel-1)._railsOfEdges.get_Keys().GetEnumerator();b.MoveNext();)e=b.get_Current(),o=this._lgData.get_Levels().get_Item$$Int32(t.ZoomLevel-1)._railsOfEdges.get_Item$$TKey(e),t._railsOfEdges.set_Item$$TKey(e,o);return!1}return!0},MsaglAddRailsOfEdge:function(n,t,i){var h,u,r,l,f,a;if(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()).get_ZoomLevel()>n.ZoomLevel||this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()).get_ZoomLevel()>n.ZoomLevel||!t.pathList.ContainsKey(i))return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor);for(this._lgData.GeometryEdgesToLgEdgeInfos.set_Item$$TKey(i,function(){var n=new Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor(i);return n.set_Rank(System.Math.Min$$Double$$Double(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()).get_ZoomLevel(),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()).get_ZoomLevel())),n.set_ZoomLevel(System.Math.Max$$Double$$Double(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()).get_ZoomLevel(),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()).get_ZoomLevel())),n}.call(this)),h=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),u=t.pathList.get_Item$$TKey(i).ToArray(),r=0;r<u.length-1;r++){var o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r]].PreciseX,t.VList[u[r]].PreciseY),s=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r+1]].PreciseX,t.VList[u[r+1]].PreciseY),v=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r]].XLoc,t.VList[u[r]].YLoc),y=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r+1]].XLoc,t.VList[u[r+1]].YLoc),p=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r]].TargetX,t.VList[u[r]].TargetY),w=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r+1]].TargetX,t.VList[u[r+1]].TargetY),e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0),c=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0);t.VList[u[r]].LeftX!=0&&t.VList[u[r]].RightX!=0?(e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r]].LeftX,t.VList[u[r]].LeftY),c=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r]].RightX,t.VList[u[r]].RightY)):t.VList[u[r+1]].LeftX!=0&&t.VList[u[r+1]].RightX!=0&&(e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r+1]].LeftX,t.VList[u[r+1]].LeftY),c=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r+1]].RightX,t.VList[u[r+1]].RightY));l=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,o,s),function(){var t={Value:f},i=n._railDictionary.TryGetValue(l,t);return f=t.Value,i}.call(this)?(f.ZoomLevel=System.Math.Max$$Int32$$Int32(f.ZoomLevel,n.ZoomLevel),this.RailToEdges.get_Item$$TKey(f).Contains(i)||this.RailToEdges.get_Item$$TKey(f).Add(i)):(a=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(o,s),f=new Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor$$ICurve$$LgEdgeInfo$$Int32(a,this._lgData.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(i),n.ZoomLevel),this.RailToEdges.ContainsKey(f)||this.RailToEdges.set_Item$$TKey(f,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor)),this.RailToEdges.get_Item$$TKey(f).Contains(i)||this.RailToEdges.get_Item$$TKey(f).Add(i),f.A=o,f.B=s,f.initialA=v,f.initialB=y,f.targetA=p,f.targetB=w,e.get_X()!=0&&e.get_Y()!=0?(f.Left=e,f.Right=c):(f.Left=o,f.Right=s),n._railDictionary.set_Item$$TKey(l,f),n._railTree.Add$$Rectangle$$TData(a.get_BoundingBox(),f));h.Insert(f)}return h},MsaglAddRailsOfEdgeQuotaBounded:function(n,t,i){var h,u,r,l,f,a;if(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()).get_ZoomLevel()>n.ZoomLevel||this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()).get_ZoomLevel()>n.ZoomLevel||!t.pathList.ContainsKey(i))return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor);for(this._lgData.GeometryEdgesToLgEdgeInfos.set_Item$$TKey(i,function(){var n=new Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor(i);return n.set_Rank(System.Math.Max$$Double$$Double(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()).get_ZoomLevel(),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()).get_ZoomLevel())),n.set_ZoomLevel(System.Math.Max$$Double$$Double(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()).get_ZoomLevel(),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()).get_ZoomLevel())),n}.call(this)),h=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),u=t.pathList.get_Item$$TKey(i).ToArray(),r=0;r<u.length-1;r++){var o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r]].PreciseX,t.VList[u[r]].PreciseY),s=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r+1]].PreciseX,t.VList[u[r+1]].PreciseY),v=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r]].XLoc,t.VList[u[r]].YLoc),y=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r+1]].XLoc,t.VList[u[r+1]].YLoc),p=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r]].TargetX,t.VList[u[r]].TargetY),w=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r+1]].TargetX,t.VList[u[r+1]].TargetY),e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0),c=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0);t.VList[u[r]].LeftX!=0&&t.VList[u[r]].RightX!=0?(e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r]].LeftX,t.VList[u[r]].LeftY),c=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r]].RightX,t.VList[u[r]].RightY)):t.VList[u[r+1]].LeftX!=0&&t.VList[u[r+1]].RightX!=0&&(e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r+1]].LeftX,t.VList[u[r+1]].LeftY),c=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.VList[u[r+1]].RightX,t.VList[u[r+1]].RightY));l=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,o,s),function(){var t={Value:f},i=n._railDictionary.TryGetValue(l,t);return f=t.Value,i}.call(this)?(f.ZoomLevel=System.Math.Max$$Int32$$Int32(f.ZoomLevel,n.ZoomLevel),this.RailToEdges.get_Item$$TKey(f).Contains(i)||this.RailToEdges.get_Item$$TKey(f).Add(i)):(a=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(o,s),f=new Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor$$ICurve$$LgEdgeInfo$$Int32(a,this._lgData.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(i),n.ZoomLevel),this.RailToEdges.ContainsKey(f)||this.RailToEdges.set_Item$$TKey(f,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor)),this.RailToEdges.get_Item$$TKey(f).Contains(i)||this.RailToEdges.get_Item$$TKey(f).Add(i),f.A=o,f.B=s,f.initialA=v,f.initialB=y,f.targetA=p,f.targetB=w,e.get_X()!=0&&e.get_Y()!=0?(f.Left=e,f.Right=c):(f.Left=o,f.Right=s),n._railDictionary.set_Item$$TKey(l,f),n._railTree.Add$$Rectangle$$TData(a.get_BoundingBox(),f),f.UpdateTopEdgeInfo(this._lgData.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(i)));h.Insert(f)}return h},FillGeometryNodesToLgNodeInfos:function(){var r=2147483647,t,n,i;for(this._lgData.set_SortedLgNodeInfos(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor)),t=this._mainGeometryGraph.get_Nodes().GetEnumerator();t.MoveNext();)n=t.get_Current(),i=function(){var t=new Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor(n);return t.set_Rank(r--),t.set_ZoomLevel(1e3),t.LabelVisibleFromScale=1,t.LabelWidthToHeightRatio=1,t.set_LabelOffset(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1,1)),t}.call(this),this._lgData.get_SortedLgNodeInfos().Add(i),this._lgData.GeometryNodesToLgNodeInfos.set_Item$$TKey(n,i),System.Console.WriteLine$$String(""+n)},Run:function(n){System.Console.WriteLine$$String("dot graph");this.RunForMsaglFiles(n);this._lgData.CreateLevelNodeTrees(this.NodeDotWidth(1));this._railGraph=new Microsoft.Msagl.Layout.LargeGraphLayout.RailGraph.ctor},NodeSuccessfullyPlotted:function(n,t,i,r,u,f){for(var h=new Microsoft.Msagl.GraphmapsWithMesh.DijkstraAlgo.ctor,o=this._mainGeometryGraph.get_Edges().GetEnumerator(),e,s;o.MoveNext();)e=o.get_Current(),s=this.AddRailsOfEdge(n,t,i,r,e,h),i._railsOfEdges.set_Item$$TKey(e,s);return i.QuotaSatisfied(f,this._lgLayoutSettings.get_MaxNumberOfNodesPerTile(),this._lgLayoutSettings.get_MaxNumberOfRailsPerTile())},AddRailsOfEdge:function(n,t,i,r,u,f){var s,h,c;if(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(u.get_Source()).get_ZoomLevel()>i.ZoomLevel||this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(u.get_Target()).get_ZoomLevel()>i.ZoomLevel)return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor);for(this._lgData.GeometryEdgesToLgEdgeInfos.set_Item$$TKey(u,function(){var n=new Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor(u);return n.set_Rank(System.Math.Min$$Double$$Double(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(u.get_Source()).get_ZoomLevel(),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(u.get_Target()).get_ZoomLevel())),n.set_ZoomLevel(System.Math.Max$$Double$$Double(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(u.get_Source()).get_ZoomLevel(),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(u.get_Target()).get_ZoomLevel())),n}.call(this)),f.SelectShortestPath(r.VList,r.EList,r.DegList,n.Pt[t.get_Item$$TKey(u.get_Source())].GridPoint,n.Pt[t.get_Item$$TKey(u.get_Target())].GridPoint,r.NumOfnodes),s=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),h=f.Edgelist.GetEnumerator();h.MoveNext();){var o=h.get_Current(),l=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r.VList[o.A].XLoc,r.VList[o.A].YLoc),a=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r.VList[r.EList[(o.A,o.Neighbor)].NodeId].XLoc,r.VList[r.EList[(o.A,o.Neighbor)].NodeId].YLoc),v=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,l,a),e;(function(){var n={Value:e},t=i._railDictionary.TryGetValue(v,n);return e=n.Value,t}).call(this)?e.ZoomLevel=System.Math.Max$$Int32$$Int32(e.ZoomLevel,i.ZoomLevel):(c=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(l,a),e=new Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor$$ICurve$$LgEdgeInfo$$Int32(c,this._lgData.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(u),this._lgData.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(u).get_ZoomLevel()|0),i._railDictionary.set_Item$$TKey(v,e),i._railTree.Add$$Rectangle$$TData(c.get_BoundingBox(),e));s.Insert(e)}return s},CreateLevel:function(n){var t=new Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.ctor(n,this._mainGeometryGraph),i=this._mainGeometryGraph.get_Nodes().get_Count();return this._lgData.get_LevelNodeCounts()==null&&this._lgData.set_LevelNodeCounts(new System.Collections.Generic.List$1.ctor(System.Int32.ctor)),this._lgData.get_LevelNodeCounts().Add(i),this._lgData.get_Levels().Add(t),t},ClusterRanksAreNotLessThanChildrens:function(){return System.Linq.Enumerable.All$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,this._mainGeometryGraph.get_RootCluster().AllClustersDepthFirstExcludingSelf(),$CreateAnonymousDelegate(this,function(n){return System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Clusters(),n.get_Nodes()),$CreateAnonymousDelegate(this,function(t){return this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n).get_Rank()>=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(t).get_Rank()}))}))},FillGeometryNodeToLgInfosTables:function(){for(var r=System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,this._mainGeometryGraph.get_Nodes(),this._mainGeometryGraph.get_RootCluster().AllClustersWideFirstExcludingSelf()).GetEnumerator(),n,t,i;r.MoveNext();)n=r.get_Current(),this._lgData.GeometryNodesToLgNodeInfos.set_Item$$TKey(n,new Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor(n));for(t=this._mainGeometryGraph.get_Edges().GetEnumerator();t.MoveNext();)i=t.get_Current(),this._lgData.GeometryEdgesToLgEdgeInfos.set_Item$$TKey(i,new Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor(i))},LayoutTheWholeGraph:function(){var n,i,r,t,u;if(this._lgLayoutSettings.get_NeedToLayout()){if(this._runInParallel)System.Threading.Tasks.Parallel.ForEach$1$$IEnumerable$1$$ParallelOptions$$Action$1(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,this._lgData.get_ConnectedGeometryGraphs(),new System.Threading.Tasks.ParallelOptions.ctor,$CreateDelegate(this,this.LayoutAndPadOneComponent));else for(n=this._lgData.get_ConnectedGeometryGraphs().GetEnumerator();n.MoveNext();)i=n.get_Current(),this.LayoutAndPadOneComponent(i);r=Microsoft.Msagl.Layout.MDS.MdsGraphLayout.PackGraphs(this._lgData.get_ConnectedGeometryGraphs(),this._lgLayoutSettings);this._mainGeometryGraph.set_BoundingBox(r)}else for(t=this._lgData.get_ConnectedGeometryGraphs().GetEnumerator();t.MoveNext();)u=t.get_Current(),u.UpdateBoundingBox()},LayoutAndPadOneComponent:function(n){this.LayoutOneComponent(n);n.get_BoundingBox().Pad$$Double(this._lgLayoutSettings.get_NodeSeparation()/2)},CreateConnectedGraphs:function(){for(var n,t=function(){var t={Value:n},i=this.CreateNodeListForBasicGraph(t);return n=t.Value,i}.call(this),u=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor,this.GetSimpleIntEdges(n),t.get_Count()),f=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(u),i=f.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),this._lgData.AddConnectedGeomGraph(this.GetConnectedSubgraph(r,t))},GetConnectedSubgraph:function(n,t){for(var u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor),s=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),i=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,h=n.GetEnumerator(),e,o;h.MoveNext();){var c=h.get_Current(),r=t.get_Item$$Int32(c),f=As(r,Microsoft.Msagl.Core.Layout.Cluster.ctor);for(f!=null?System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,f.get_ClusterParents())==this._mainGeometryGraph.get_RootCluster()&&i.get_RootCluster().AddCluster(f):s.Add(r),e=System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Edge.ctor,r.get_OutEdges(),r.get_SelfEdges()).GetEnumerator();e.MoveNext();)o=e.get_Current(),System.Diagnostics.Debug.Assert$$Boolean(!u.Contains(o)),u.Add(o)}return i.set_Edges(new Microsoft.Msagl.Layout.LargeGraphLayout.SimpleEdgeCollection.ctor(u)),i.set_Nodes(new Microsoft.Msagl.Layout.LargeGraphLayout.SimpleNodeCollection.ctor(s)),i},CreateNodeListForBasicGraph:function(n){var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),r,u,t;for(n.Value=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Int32.ctor),r=this._mainGeometryGraph.get_Nodes().GetEnumerator();r.MoveNext();)t=r.get_Current(),n.Value.set_Item$$TKey(t,i.get_Count()),i.Add(t);for(u=this._mainGeometryGraph.get_RootCluster().AllClustersDepthFirstExcludingSelf().GetEnumerator();u.MoveNext();)t=u.get_Current(),n.Value.set_Item$$TKey(t,i.get_Count()),i.Add(t);return i},GetSimpleIntEdges:function(n){for(var i=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor,this._mainGeometryGraph.get_Edges(),$CreateAnonymousDelegate(this,function(t){return function(){var i=new Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor;return i.set_Source(n.get_Item$$TKey(t.get_Source())),i.set_Target(n.get_Item$$TKey(t.get_Target())),i}.call(this)}))),r=this._mainGeometryGraph.get_RootCluster().AllClustersDepthFirstExcludingSelf().GetEnumerator(),t;r.MoveNext();)t=r.get_Current(),i.AddRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor,t.get_Clusters(),$CreateAnonymousDelegate(this,function(i){return function(){var r=new Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor;return r.set_Source(n.get_Item$$TKey(t)),r.set_Target(n.get_Item$$TKey(i)),r}.call(this)}))),i.AddRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor,t.get_Nodes(),$CreateAnonymousDelegate(this,function(i){return function(){var r=new Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor;return r.set_Source(n.get_Item$$TKey(t)),r.set_Target(n.get_Item$$TKey(i)),r}.call(this)})));return i},LayoutOneComponent:function(n){var i,r,t;Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor.PrepareGraphForLayout(n);System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_RootCluster().get_Clusters())?(i=function(){var n=new Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings.ctor;return n.set_FallbackLayoutSettings(function(){var n=new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor;return n.set_AvoidOverlaps(!0),n}.call(this)),n.set_NodeSeparation(this._lgLayoutSettings.get_NodeSeparation()),n.set_LayerSeparation(this._lgLayoutSettings.get_NodeSeparation()),n.set_EdgeRoutingSettings(this._lgLayoutSettings.get_EdgeRoutingSettings()),n.set_LayeringOnly(!0),n}.call(this),r=new Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.ctor$$GeometryGraph$$Func$2$Cluster$LayoutAlgorithmSettings(n,$CreateAnonymousDelegate(this,function(){return i})),r.Run()):(Microsoft.Msagl.Miscellaneous.LayoutHelpers.CalculateLayout(n,this.GetMdsLayoutSettings(),this._cancelToken,null),this.RemoveOverlapsForLgLayout(n));t=n.get_BoundingBox().Clone();t.Pad$$Double(this._lgLayoutSettings.get_NodeSeparation()/2);n.set_BoundingBox(t)},RemoveOverlapsForLgLayout:function(n){var t=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes()),i,r;System.Diagnostics.Debug.Assert$$Boolean(this.RankingIsDefined(t));this.SortComponentNodesByRanking(t);i=this.GetApproximateLayerCounts(t);r=this.GetApproxSizesForOverlapRemoval(i,this._lgLayoutSettings.get_NodeSeparation()*3,t);Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.RemoveOverlapsForLayers(t,r)},GetApproxSizesForOverlapRemoval:function(n,t,i){for(var u=new Array(i.length),f=0,r=0;r<i.length;r++)u[r]=new Microsoft.Msagl.Core.DataStructures.Size.ctor$$Double$$Double(t,t),r==n.get_Item$$Int32(f)&&(t/=2,f++);return u},GetApproximateLayerCounts:function(n){for(var i=n.length,f=this._lgLayoutSettings.get_MaxNumberOfNodesPerTile(),r=1,u=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),t;;){if(t=System.Math.Min$$Int32$$Int32(f*r,i),u.Add(t),t==i)break;r*=3}return u},SortComponentNodesByRanking:function(n){var t=new Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor.RankComparer.ctor(this._lgData.GeometryNodesToLgNodeInfos);System.Array.Sort$1$$T$Array$$IComparer$1(Microsoft.Msagl.Core.Layout.Node.ctor,n,t)},RankingIsDefined:function(n){return n.length==0?!0:this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n[0]).get_Rank()>0},GetMdsLayoutSettings:function(){return function(){var n=new Microsoft.Msagl.Layout.MDS.MdsLayoutSettings.ctor;return n.get_EdgeRoutingSettings().set_KeepOriginalSpline(!0),n.get_EdgeRoutingSettings().set_EdgeRoutingMode(Microsoft.Msagl.Core.Routing.EdgeRoutingMode.None),n.set_RemoveOverlaps(!1),n}.call(this)},IsEdgeVisibleAtCurrentLevel:function(n){var t,i;return function(){var i={Value:t},r=this.get_GeometryEdgesToLgEdgeInfos().TryGetValue(n,i);return t=i.Value,r}.call(this)?(i=this._lgData.get_Levels().get_Item$$Int32(this._lgData.GetLevelIndexByScale(this.get_CurrentZoomLevel())).ZoomLevel,t.get_ZoomLevel()<=i):!1},AddHighlightedEdgesAndNodesToRailGraph:function(){this._railGraph.Edges.InsertRange(this._lgData.get_SelectedEdges());this._railGraph.Nodes.InsertRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,this._lgData.get_SelectedNodeInfos(),$CreateAnonymousDelegate(this,function(n){return n.get_GeometryNode()})))},AddLabelsOfHighlightedNodes:function(n){var t,u,f,i,e,o,r;for(this.SelectedNodeLabels.Clear(),t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor),u=this._lgData.get_SelectedEdges().GetEnumerator();u.MoveNext();)f=u.get_Current(),i=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(f.get_Source()),this._visibleRectangle.Intersects(this.GetNodeDotRect(i,n))&&t.Insert(i),i=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(f.get_Target()),this._visibleRectangle.Intersects(this.GetNodeDotRect(i,n))&&t.Insert(i);if(t.InsertRange(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,this._lgData.get_SelectedNodeInfos(),$CreateAnonymousDelegate(this,function(t){return this._visibleRectangle.Intersects(this.GetNodeDotRect(t,n))}))),System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,t)){for(e=t.GetEnumerator();e.MoveNext();)o=e.get_Current();r=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,t);r=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Linq.Enumerable.OrderByDescending$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Double.ctor,r,$CreateAnonymousDelegate(this,function(n){return n.get_Rank()})));this.InsertCandidateLabelsGreedily(r,n)}},AddVisibleRailsAndNodes:function(){this._railGraph.Rails.Clear();var n=this._lgData.GetCurrentLevelByScale(this.get_CurrentZoomLevel());System.Console.WriteLine$$String("current zoomlevel = "+n.ZoomLevel);this._railGraph.Rails.InsertRange(n.GetRailsIntersectingRect(this._visibleRectangle));this.forthefirsttime?this._railGraph.Nodes.InsertRange(n.GetNodesIntersectingRectLabelzero(this._visibleRectangle,1)):this._railGraph.Nodes.InsertRange(n.GetNodesIntersectingRectLabelzero(this._visibleRectangle,System.Math.Pow(2,n.ZoomLevel)));this._railGraph.Edges.Clear();this._railGraph.Edges.InsertRange(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor,Microsoft.Msagl.Core.Layout.Edge.ctor,this._railGraph.Rails,$CreateAnonymousDelegate(this,function(n){return n.TopRankedEdgeInfoOfTheRail.get_Edge()})),$CreateDelegate(this,this.IsEdgeVisibleAtCurrentLevel)));this.AddHighlightedEdgesAndNodesToRailGraph()},RunOnViewChange:function(){(this._visibleRectangle=this._lgLayoutSettings.get_ClientViewportMappedToGraph()(),this._visibleRectangle.get_IsEmpty())||(this.set_CurrentZoomLevel(this.GetZoomFactorToTheGraph()),this.FillRailGraph(),this._lgLayoutSettings.OnViewerChangeTransformAndInvalidateGraph())},GetZoomFactorToTheGraph:function(){return this._lgLayoutSettings.TransformFromGraphToScreen().get_Item$$Int32$$Int32(0,0)/this.FitFactor()},FitFactor:function(){var n=this._lgLayoutSettings.get_ClientViewportFunc()();return this._lgLayoutSettings.mainGeometryGraphWidth=this._mainGeometryGraph.get_Width(),this._lgLayoutSettings.mainGeometryGraphHeight=this._mainGeometryGraph.get_Height(),System.Math.Min$$Double$$Double(n.get_Width()/this._mainGeometryGraph.get_Width(),n.get_Height()/this._mainGeometryGraph.get_Height())},FillRailGraph:function(){this._railGraph.Nodes.Clear();this.AddVisibleRailsAndNodes();this.RegisterEdgeSourceTargets()},RegisterEdgeSourceTargets:function(){for(var n=this._railGraph.Edges.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.AddEdgeSourceAndTarget(t)},AddEdgeSourceAndTarget:function(n){this._railGraph.Nodes.Insert(n.get_Source());this._railGraph.Nodes.Insert(n.get_Target())},GetMaximalZoomLevel:function(){return this._lgData==null?1:this._lgData.GetMaximalZoomLevel()},GetEdgesPassingThroughRail:function(n){var t=System.Math.Log$$Double$$Double(n.ZoomLevel,2)|0,i=this._lgData.get_Levels().get_Item$$Int32(t);return i.GetEdgesPassingThroughRail(n)},GetIndexByZoomLevel:function(n){return System.Math.Log$$Double$$Double(n,2)|0},GetAllNodesOnVisibleLayers:function(){for(var i,t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor),n=0;n<this._lgData.get_Levels().get_Count();n++)i=this.GetNodeInfosOnLevel(n),t.AddRange(i);return t},GetNodeInfosOnLevel:function(n){for(var i=[],r=n==0?0:this._lgData.get_LevelNodeCounts().get_Item$$Int32(n-1),u=this._lgData.get_LevelNodeCounts().get_Item$$Int32(n),t=r;t<u;t++)i.push(this._lgData.get_SortedLgNodeInfos().get_Item$$Int32(t));return i},GetNodeInfosOnLevelLeq:function(n){for(var i=[],r=this._lgData.get_LevelNodeCounts().get_Item$$Int32(n),t=0;t<r;t++)i.push(this._lgData.get_SortedLgNodeInfos().get_Item$$Int32(t));return i},InitEdgesOfLevels:function(){for(var i=this.get_GeometryEdgesToLgEdgeInfos().get_Keys().GetEnumerator(),n;i.MoveNext();){var t=i.get_Current(),r=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(t.get_Source()),u=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(t.get_Target()),f=this.GetIndexByZoomLevel(System.Math.Max$$Double$$Double(r.get_ZoomLevel(),u.get_ZoomLevel()));for(n=f;n<this._lgData.get_Levels().get_Count();n++)this._lgData.get_Levels().get_Item$$Int32(n)._railsOfEdges.set_Item$$TKey(t,new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor))}},GetNeighborsOnLevel:function(n,t){var i=this._lgData.get_Levels().get_Item$$Int32(t).ZoomLevel,r;return System.Diagnostics.Debug.Assert$$Boolean(n.get_ZoomLevel()<=i),r=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,null,n.get_GeometryNode().get_OutEdges(),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({e:n,nit:this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n.get_Target())})})),$CreateAnonymousDelegate(this,function(n){return n.get_nit().get_ZoomLevel()<=i})),$CreateAnonymousDelegate(this,function(n){return n.get_nit()}))),r.AddRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,null,n.get_GeometryNode().get_InEdges(),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({e:n,nis:this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n.get_Source())})})),$CreateAnonymousDelegate(this,function(n){return n.get_nis().get_ZoomLevel()<=i})),$CreateAnonymousDelegate(this,function(n){return n.get_nis()}))),r},RouteEdgesOnZeroLayer:function(){var t=new Microsoft.Msagl.GraphmapsWithMesh.Tiling.ctor$$Int32$$Boolean(this.g.NumOfnodes,!0),i,h,r,l,c,e,u,v,s,n;for(t.N=this.g.N,t.isPlanar=this.g.isPlanar,t.NumOfnodesBeforeDetour=this.g.NumOfnodesBeforeDetour,t.nodeTree=this.g.nodeTree,t.maxTheoreticalZoomLevel=this.g.maxTheoreticalZoomLevel,t.nodeToLoc=this.g.nodeToLoc,n=0;n<this.g.NumOfnodes;n++)t.VList[n]=function(){var t=new Microsoft.Msagl.GraphmapsWithMesh.Vertex.ctor(this.g.VList[n].XLoc,this.g.VList[n].YLoc);return t.Id=this.g.VList[n].Id,t.ZoomLevel=this.g.VList[n].ZoomLevel,t}.call(this);for(i=this._lgData.SkeletonLevels.get_Item$$Int32(0),i.ClearSavedTrajectoriesAndUsedEdges(),System.Console.Write$$String("\nRouting edges"),h=this.GetNodeInfosOnLevelLeq(0).GetEnumerator();h.MoveNext();)for(r=h.get_Current(),i.PathRouter.SetAllEdgeLengthMultipliersMin(.8),this.DecreaseWeightsAlongOldTrajectoriesFromSource(0,i,r),l=this.GetNeighborsOnLevel(r,0),c=l.GetEnumerator();c.MoveNext();){e=c.get_Current();u=this._lgData.SkeletonLevels.get_Item$$Int32(0).HasSavedTrajectory(r,e)?i.GetTrajectory(r,e):i.PathRouter.GetPath$$LgNodeInfo$$LgNodeInfo$$Boolean$$Tiling(r,e,!0,this.g);i.SetTrajectoryAndAddEdgesToUsed(r,e,u);for(var f=this.PointToId.get_Item$$TKey(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,u)),y=this.PointToId.get_Item$$TKey(System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,u)),p=System.Math.Max$$Int32$$Int32(this.g.VList[f].ZoomLevel,this.g.VList[y].ZoomLevel),o=-1,a=u.GetEnumerator();a.MoveNext();)if(v=a.get_Current(),o=this.PointToId.get_Item$$TKey(v),f!=o){for(s=-1,s=0;s<this.g.DegList[f];s++)if(this.g.EList[(f,s)].NodeId==o)break;t.AddEdge$$Int32$$Int32$$Int32$$Int32(f,o,1,p);f=o}i.PathRouter.DecreaseWeightOfEdgesAlongPath(u,.5)}for(n=0;n<t.NumOfnodes;n++)t.DegList[n]==0&&(t.VList[n].Invalid=!0);this.g=t},EdgeIsNew:function(n,t,i){return System.Math.Max$$Double$$Double(n.get_ZoomLevel(),t.get_ZoomLevel())>=this._lgData.get_Levels().get_Item$$Int32(i).ZoomLevel},RouteEdges:function(n){this.AddAllPortEdges(n);n==0?this.RouteEdgesOnZeroLayer():this.RouteOnHigherLevel(n)},RouteOnHigherLevel:function(n){var t,i=function(){var i={Value:t},r=this.DealWithPathsFromPreviousLevels(n,i);return t=i.Value,r}.call(this);this.ComputeNewTrajectories(n,t,i)},DealWithPathsFromPreviousLevels:function(n,t){var i=this._lgData.SkeletonLevels.get_Item$$Int32(n),r=this._lgData.SkeletonLevels.get_Item$$Int32(n-1);return t.Value=this.GetNodeInfosOnLevelLeq(n),i.ClearSavedTrajectoriesAndUsedEdges(),i.PathRouter.ResetAllEdgeLengthMultipliers(),System.Console.Write$$String("\nRouting edges"),System.Console.Write$$String("\nUpdating old trajectories"),i.PathRouter.ResetAllEdgeLengthMultipliers(),this.UpdatePrevLayerTrajectories(n,t.Value,r,i),i},UpdatePrevLayerTrajectories:function(n,t,i,r){for(var c=0,s=t.GetEnumerator(),f,e,o;s.MoveNext();){for(var u=s.get_Current(),l=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Double.ctor,this.GetNeighborsOnLevel(u,n),$CreateAnonymousDelegate(this,function(n){return n.get_ZoomLevel()})),h=l.GetEnumerator();h.MoveNext();)(f=h.get_Current(),e=i.GetTrajectory(u,f),e!=null)&&(o=r.PathRouter.GetPathOnSavedTrajectory(u,f,e,!0),r.SetTrajectoryAndAddEdgesToUsed(u,f,o),r.MarkEdgesAlongPathAsEdgesOnOldTrajectories(o));++c%100==1&&System.Console.Write$$String(".")}},DecreaseWeightsAlongOldTrajectories:function(n,t){for(var u=t.get_EdgeTrajectories().GetEnumerator(),i;u.MoveNext();)if(i=u.get_Current(),!this.EdgeIsNew(i.get_Key().get_A(),i.get_Key().get_B(),n)){var e=i.get_Value(),f=System.Math.Log$$Double$$Double(System.Math.Max$$Double$$Double(i.get_Key().get_A().get_ZoomLevel(),i.get_Key().get_B().get_ZoomLevel()),2),r=f<1?.1:f<2?.2:.6;r=System.Math.Max$$Double$$Double(.1,r);r=System.Math.Min$$Double$$Double(.6,r);t.PathRouter.DecreaseWeightOfEdgesAlongPath(e,r)}},DecreaseWeightsAlongOldTrajectoriesFromSource:function(n,t,i){for(var h=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Double.ctor,this.GetNeighborsOnLevel(i,n),$CreateAnonymousDelegate(this,function(n){return n.get_ZoomLevel()})),o=h.GetEnumerator(),f,s,u,e,r;o.MoveNext();)f=o.get_Current(),s=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,i,f),function(){var n={Value:u},i=t.get_EdgeTrajectories().TryGetValue(s,n);return u=n.Value,i}.call(this),u!=null&&(e=System.Math.Log$$Double$$Double(System.Math.Max$$Double$$Double(i.get_ZoomLevel(),f.get_ZoomLevel()),2),r=e<1?.4:e<2?.5:.6,r=System.Math.Max$$Double$$Double(.4,r),r=System.Math.Min$$Double$$Double(.6,r),t.PathRouter.DecreaseWeightOfEdgesAlongPath(u,r))},GetSegmentsOnOldTrajectoriesFromSource:function(n,t,i){for(var f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor),h=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Double.ctor,this.GetNeighborsOnLevel(i,n),$CreateAnonymousDelegate(this,function(n){return n.get_ZoomLevel()})),e=h.GetEnumerator(),o,s,r,u;e.MoveNext();)if(o=e.get_Current(),s=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,i,o),function(){var n={Value:r},i=t.get_EdgeTrajectories().TryGetValue(s,n);return r=n.Value,i}.call(this),r!=null)for(u=0;u<r.get_Count()-1;u++)f.Add(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r.get_Item$$Int32(u),r.get_Item$$Int32(u+1)));return f},SetWeightsAlongOldTrajectoriesFromSourceToMin:function(n,t,i,r){for(var s=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Double.ctor,this.GetNeighborsOnLevel(i,n),$CreateAnonymousDelegate(this,function(n){return n.get_ZoomLevel()})),f=s.GetEnumerator(),e,o,u;f.MoveNext();)e=f.get_Current(),o=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,i,e),function(){var n={Value:u},i=t.get_EdgeTrajectories().TryGetValue(o,n);return u=n.Value,i}.call(this),u!=null&&t.PathRouter.SetWeightOfEdgesAlongPathToMin(u,r)},ComputeNewTrajectories:function(n,t,i){var s=0,e,r,h,o,u,f;for(System.Console.Write$$String("\nComputing new trajectories"),i.PathRouter.SetAllEdgeLengthMultipliersMin(.8),e=t.GetEnumerator();e.MoveNext();){for(r=e.get_Current(),this.DecreaseWeightsAlongOldTrajectoriesFromSource(n,i,r),h=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Double.ctor,this.GetNeighborsOnLevel(r,n),$CreateAnonymousDelegate(this,function(n){return n.get_ZoomLevel()})),o=h.GetEnumerator();o.MoveNext();)u=o.get_Current(),f=i.GetTrajectory(r,u),f==null&&(f=i.PathRouter.GetPath$$LgNodeInfo$$LgNodeInfo$$Boolean(r,u,!0),i.SetTrajectoryAndAddEdgesToUsed(r,u,f)),s++,s%100==1&&System.Console.Write$$String(".");this.SetWeightsAlongOldTrajectoriesFromSourceToMin(n,i,r,.8)}},CheckSanityAllRoutes:function(n){for(var u=this.GetNodeInfosOnLevelLeq(n),t=!0,i=u.GetEnumerator(),r;i.MoveNext();)if(r=i.get_Current(),t&=this.CheckSanityRoutes(r,n),!t)break;return t},CheckSanityRoutes:function(n,t){for(var s=this.GetNeighborsOnLevel(n,t),h=this._lgData.SkeletonLevels.get_Item$$Int32(t).PathRouter.AddVisGraphVertex(n.get_Center()),f=new Microsoft.Msagl.Layout.LargeGraphLayout.LgPathRouter.ctor,e=s.GetEnumerator(),o,r,i,u;e.MoveNext();)for(o=e.get_Current(),r=this._lgData.SkeletonLevels.get_Item$$Int32(t).GetTrajectory(n,o),i=0;i<r.get_Count()-1;i++)f.AddVisGraphEdge(r.get_Item$$Int32(i),r.get_Item$$Int32(i+1));return u=f.HasCycles(h),u&&System.Console.WriteLine$$String("BAD SP Tree at: "+n),!u},CopyGraphToNextLevel:function(n){for(var i=this._lgData.SkeletonLevels.get_Item$$Int32(n).PathRouter.GetAllEdgesVisibilityEdges().GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),this._lgData.SkeletonLevels.get_Item$$Int32(n+1).PathRouter.AddVisGraphEdge(t.get_SourcePoint(),t.get_TargetPoint())},ClearSkeleton:function(n){this._lgData.SkeletonLevels.get_Item$$Int32(n).Clear()},RunOverlapRemovalBitmap:function(n){for(var e,y,p=n>0?this.GetNodeInfosOnLevelLeq(n-1):new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor),h=this.GetNodeInfosOnLevel(n),t=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,Microsoft.Msagl.Core.Geometry.Rectangle.ctor,p,$CreateAnonymousDelegate(this,function(n){return n.get_BoundaryOnLayer().get_BoundingBox()}))),c=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,Microsoft.Msagl.Core.Geometry.Rectangle.ctor,h,$CreateAnonymousDelegate(this,function(n){return n.get_BoundaryOnLayer().get_BoundingBox()}))),i=n>0?this._lgData.get_Levels().get_Item$$Int32(n-1).GetAllRailsEndpoints().ToArray():new Array(0),o=function(){var n=new Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsBitmap.ctor$$Rectangle$Array$$Rectangle$Array$$SymmetricTuple$1$Point$Array(c,t,i);return n.NumPixelsPadding=10,n}.call(this),l=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.Geometry.Rectangle.ctor),a=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor),r=0,w=t.length,s=t[r];r<w;r++,s=t[r])l.Add$$Rectangle$$TData(s,s);for(var u=0,b=i.length,f=i[u];u<b;u++,f=i[u])a.Add$$Rectangle$$TData(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(f.get_A(),f.get_B()),f);for(e=0;;){if(e=o.PositionAllMoveableRectsSameSize(e,l,a),e>=System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,c))break;o.ScaleBbox(1.25)}for(var k=o.GetTranslations(),d=0,v=h.GetEnumerator();v.MoveNext();)y=v.get_Current(),y.Translate(k[d++])},ClearLevels:function(n){var t,i,r;for(this._lgData.get_Levels().Clear(),this._lgData.SkeletonLevels.Clear(),t=1,i=0;i<n;i++)r=new Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.ctor(t,this._mainGeometryGraph),r.ClearRailTree(),this._lgData.get_Levels().Add(r),this._lgData.SkeletonLevels.Add(function(){var n=new Microsoft.Msagl.Layout.LargeGraphLayout.LgSkeletonLevel.ctor;return n.ZoomLevel=t,n}.call(this)),t*=2},UpdateNodeInfoZoomLayers:function(){for(var i=1,t=0,n=0;n<this._lgData.get_SortedLgNodeInfos().get_Count();n++){while(t<this._lgData.get_LevelNodeCounts().get_Count()&&n==this._lgData.get_LevelNodeCounts().get_Item$$Int32(t))t++,i*=2;this._lgData.get_SortedLgNodeInfos().get_Item$$Int32(n).set_ZoomLevel(i)}},InitRailsOfEdgesEmpty:function(){for(var i=this._mainGeometryGraph.get_Edges().GetEnumerator(),u,t;i.MoveNext();){var n=i.get_Current(),f=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n.get_Source()),e=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n.get_Target()),r=System.Math.Max$$Double$$Double(f.get_ZoomLevel(),e.get_ZoomLevel());for(this.get_GeometryEdgesToLgEdgeInfos().get_Item$$TKey(n).set_ZoomLevel(r),u=this.GetIndexByZoomLevel(r),t=u;t<this._lgData.get_Levels().get_Count();t++)this._lgData.get_Levels().get_Item$$Int32(t)._railsOfEdges.set_Item$$TKey(n,new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor))}},InitRailsOfEdgesEmpty$$Int32:function(n){for(var r=this._mainGeometryGraph.get_Edges().GetEnumerator(),f,i;r.MoveNext();){var t=r.get_Current(),e=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(t.get_Source()),o=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(t.get_Target()),u=System.Math.Max$$Double$$Double(e.get_ZoomLevel(),o.get_ZoomLevel());for(this.get_GeometryEdgesToLgEdgeInfos().get_Item$$TKey(t).set_ZoomLevel(u),f=System.Math.Max$$Int32$$Int32(this.GetIndexByZoomLevel(u),n),i=f;i<this._lgData.get_Levels().get_Count();i++)this._lgData.get_Levels().get_Item$$Int32(i)._railsOfEdges.set_Item$$TKey(t,new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor))}},AddAllPortEdges:function(n){var t=this.GetNodeInfosOnLevelLeq(n),i=this._lgData.SkeletonLevels.get_Item$$Int32(n);i.AddGraphEdgesFromCentersToPointsOnBorders(t)},CreateGraphFromSteinerCdt:function(n){for(var u,r,f,e,o,s=this.GetNodeInfosOnLevelLeq(n),i=new Microsoft.Msagl.Miscellaneous.ConstrainedSkeleton.SteinerCdt.ctor(this._lgData.SkeletonLevels.get_Item$$Int32(n).PathRouter.get_VisGraph(),s),t=0;t<this.g.NumOfnodes;t++)u=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.g.VList[t].XLoc,this.g.VList[t].YLoc),r=i._visGraph.AddVertex$$Point(u),r.isReal=t<this.g.NumOfnodesBeforeDetour?!0:!1,i._outPoints.set_Item$$TKey(t,r),i._visGraph.get_PointToVertexMap().set_Item$$TKey(u,r),i._visGraph.visVertexToId.set_Item$$TKey(r,t),this.PointToId.set_Item$$TKey(u,t);for(t=0;t<this.g.NumOfnodes;t++)for(f=0;f<this.g.DegList[t];f++)e=i._outPoints.get_Item$$TKey(t),o=i._outPoints.get_Item$$TKey(this.g.EList[(t,f)].NodeId),i.AddVisEdge(e,o)},SimplifyRoutes:function(n){var r;System.Console.WriteLine$$String$$Object("\nsimplifying level {0}",n);var t=this.GetNodeInfosOnLevelLeq(n),u=this._lgData.SkeletonLevels.get_Item$$Int32(n),i=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,t,$CreateAnonymousDelegate(this,function(n){return n.get_Center()})));return n>0&&i.InsertRange(this._lgData.SkeletonLevels.get_Item$$Int32(n-1).GetPointsOnSavedTrajectories()),r=new Microsoft.Msagl.Layout.LargeGraphLayout.RouteSimplifier.ctor(u.PathRouter,t,i),r.Run()},FillLevelsWithNodesOnly:function(n){var t=function(){var n=new Microsoft.Msagl.Layout.LargeGraphLayout.NodeRailLevelCalculator.GreedyNodeRailLevelCalculator.ctor(this._lgData.get_SortedLgNodeInfos());return n.set_GeometryNodesToLgNodeInfos(this._lgData.GeometryNodesToLgNodeInfos),n}.call(this),i;t.MaxAmountNodesPerTile=n;t.set_IncreaseNodeQuota(this._lgLayoutSettings.get_IncreaseNodeQuota());i=this.GetLargestTile();t.PlaceNodesOnly(i);this._lgData.set_LevelNodeCounts(t.GetLevelNodeCounts());this.ClearLevels(this._lgData.get_LevelNodeCounts().get_Count())},FillLevelWithNodesRoutesTryRerouting:function(n,t,i,r){var u=function(){var n=new Microsoft.Msagl.Layout.LargeGraphLayout.NodeRailLevelCalculator.GreedyNodeRailLevelCalculator.ctor(this._lgData.get_SortedLgNodeInfos());return n.set_GeometryNodesToLgNodeInfos(this._lgData.GeometryNodesToLgNodeInfos),n}.call(this);u.InitBoundingBox();u.MaxAmountNodesPerTile=t;u.MaxAmountRailsPerTile=i;u.set_IncreaseNodeQuota(r);var o=this._lgData.SkeletonLevels.get_Item$$Int32(n).get_EdgeTrajectories(),e=this._lgData.get_LevelNodeCounts().get_Item$$Int32(n),s=this._lgData.get_Levels().get_Item$$Int32(n).ZoomLevel,h=n>0?this._lgData.get_LevelNodeCounts().get_Item$$Int32(n-1):0,c=this.GetLargestTile(),l=this.GetSegmentsOnOldTrajectories(n),f=u.TryInsertingNodesAndRoutes(e,o,l,s,h,new Microsoft.Msagl.Miscellaneous.RegularGrid.GridTraversal.ctor(c,n),this._lgData.SkeletonLevels.get_Item$$Int32(n).PathRouter);n>0&&f<this._lgData.get_LevelNodeCounts().get_Item$$Int32(n-1)&&(f=this._lgData.get_LevelNodeCounts().get_Item$$Int32(n-1));f<e&&this.PushNodesToNextLevel(n,f);this._lgData.get_LevelNodeCounts().set_Item$$Int32(n,f)},GetSegmentsOnOldTrajectories:function(n){for(var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor),t=0;t<n;t++)i.AddRange(this._lgData.SkeletonLevels.get_Item$$Int32(t).PathRouter.SegmentsNotOnOldTrajectories());return i},AssignRailsByTrajectories:function(n){var o=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,this._lgData.get_Levels().get_Item$$Int32(n)._railsOfEdges.get_Keys()),i,e,r;for(this._lgData.get_Levels().get_Item$$Int32(n)._railTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),i=o.GetEnumerator();i.MoveNext();){var t=i.get_Current(),s=this._lgData.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(t),u=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(t.get_Source()),f=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(t.get_Target());this._lgData.SkeletonLevels.get_Item$$Int32(n).HasSavedTrajectory(u,f)&&(e=this._lgData.SkeletonLevels.get_Item$$Int32(n).GetTrajectory(u,f),r=this._lgData.get_Levels().get_Item$$Int32(n).FetchOrCreateRailSequence(e),this._lgData.get_Levels().get_Item$$Int32(n)._orderedRailsOfEdges.set_Item$$TKey(t,r),this._lgData.AssembleEdgeAtLevel(s,n,new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor,r)))}},PushNodesToNextLevel:function(n,t){var i,u,f,r;if(n==this._lgData.get_Levels().get_Count()-1&&(i=new Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.ctor(this._lgData.get_Levels().get_Item$$Int32(n).ZoomLevel*2,this._mainGeometryGraph),i.CreateEmptyRailTree(),this._lgData.get_Levels().Add(i),this._lgData.SkeletonLevels.Add(function(){var n=new Microsoft.Msagl.Layout.LargeGraphLayout.LgSkeletonLevel.ctor;return n.ZoomLevel=i.ZoomLevel,n}.call(this)),this._lgData.get_LevelNodeCounts().Add(System.Linq.Enumerable.Last$1$$IEnumerable$1(System.Int32.ctor,this._lgData.get_LevelNodeCounts()))),u=this._lgData.get_LevelNodeCounts().get_Item$$Int32(n),!(u<=t)){for(f=this._lgData.get_Levels().get_Item$$Int32(n+1).ZoomLevel,r=t;r<u;r++)this._lgData.get_SortedLgNodeInfos().get_Item$$Int32(r).set_ZoomLevel(f);this._lgData.get_LevelNodeCounts().set_Item$$Int32(n,t);this._lgData.get_Levels().get_Item$$Int32(n)._railsOfEdges.Clear();this._lgData.get_Levels().get_Item$$Int32(n+1)._railsOfEdges.Clear();this.InitRailsOfEdgesEmpty$$Int32(n)}},LayoutAndRouteByLayers:function(n,t,i){this.FillLevelsWithNodesOnly(n);this.InitRailsOfEdgesEmpty();this.AddSkeletonLevels();for(var r=0;r<this._lgData.get_Levels().get_Count();r++)this.RemoveOverlapsAndRouteForLayer(n,t,i,r);this._lgData.CreateLevelNodeTrees(this.NodeDotWidth(1));this.TestAllEdgesConsistency()},GetLargestTile:function(){var t=this._mainGeometryGraph.boundingBox.Clone(),n=this.NodeDotWidth(1)*.5;return t.Pad$$Double$$Double$$Double$$Double(n,n,n,n),t},LabelingOfOneRun:function(){for(var u=this._lgData.get_SortedLgNodeInfos().GetEnumerator(),r,n;u.MoveNext();)n=u.get_Current(),n.LabelVisibleFromScale=0;for(var i=.0625,f=System.Math.Pow(2,.125),t=0,e=System.Math.Pow(2,System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.ctor,this._lgData.get_Levels()).ZoomLevel+1);t<this._lgData.GeometryNodesToLgNodeInfos.get_Count()&&i<=e;)t=this.InsertLabelsGreedily(i),i*=f;for(t<this._lgData.get_SortedLgNodeInfos().get_Count()&&System.Console.WriteLine$$String$$Object("Failed to label {0} nodes",this._lgData.get_SortedLgNodeInfos().get_Count()-t),this.CleanUpRails(),r=this._lgData.get_SortedLgNodeInfos().GetEnumerator();r.MoveNext();)n=r.get_Current(),n.LabelVisibleFromScale-=.0001},RemoveOverlapsAndRouteForLayer:function(n,t,i,r){var f,u,e;this.PrepareNodeBoundariesAndSkeletonOnLayer(r);f=this._lgData.SkeletonLevels.get_Item$$Int32(r);this.CreateGraphFromSteinerCdt(r);u=this.GetLargestTile();e=new Microsoft.Msagl.Miscellaneous.RegularGrid.GridTraversal.ctor(u,r);this.RouteEdges(r);this.RemoveUnusedVisibilityGraphEdgesAndNodes(r)},HigherTrajectoriesPreserved:function(n){for(var t=0;t<=n;t++)if(!this.TestTrajectoriesPreserved(n))return!1;return!0},PrepareNodeBoundariesAndSkeletonOnLayer:function(n){for(var i,r=System.Math.Pow(2,n),u=this.NodeDotWidth(r),t=0;t<this._lgData.get_LevelNodeCounts().get_Item$$Int32(n);t++)i=this._lgData.get_SortedLgNodeInfos().get_Item$$Int32(t),i.set_BoundaryOnLayer(Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRegularPolygon(this._lgLayoutSettings.get_NumberOfNodeShapeSegs(),i.get_Center(),u));n>0&&this.ModifySkeletonWithNewBoundariesOnLayer(n)},ModifySkeletonWithNewBoundariesOnLayer:function(n){for(var t=0;t<this._lgData.get_LevelNodeCounts().get_Item$$Int32(n);t++)this._lgData.SkeletonLevels.get_Item$$Int32(n).PathRouter.ModifySkeletonWithNewBoundaryOnLayer(this._lgData.get_SortedLgNodeInfos().get_Item$$Int32(t))},RemoveUnusedVisibilityGraphEdgesAndNodes:function(n){this._lgData.SkeletonLevels.get_Item$$Int32(n).RemoveUnusedGraphEdgesAndNodes()},SimplifyRoutesOnLevelUntilDone:function(n){do{if(!this.SimplifyRoutes(n))break;this.UpdateRoutesAfterSimplification(n)}while(1)},InitNodeLabelWidthToHeightRatios:function(n){for(var r,i,t=0;t<this._mainGeometryGraph.get_Nodes().get_Count();t++)r=this._mainGeometryGraph.get_Nodes().get_Item$$Int32(t),i=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(r),i!=null&&(i.LabelWidthToHeightRatio=n.get_Item$$Int32(t))},RemoveTrajectoriesForEdgesWithHighZoom:function(n){var r=this._lgData.SkeletonLevels.get_Item$$Int32(n).get_EdgeTrajectories(),i=this._lgData.get_Levels().get_Item$$Int32(n).ZoomLevel,t=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,r.get_Keys(),$CreateAnonymousDelegate(this,function(n){return n.get_A().get_ZoomLevel()>i||n.get_B().get_ZoomLevel()>i})));t.get_Count()>0&&(this._lgData.SkeletonLevels.get_Item$$Int32(n).RemoveSomeEdgeTrajectories(t),this._lgData.get_Levels().get_Item$$Int32(n).RemoveFromRailEdges(t))},TestRailsForTrajectories:function(n){for(var r=this._lgData.SkeletonLevels.get_Item$$Int32(n).get_EdgeTrajectories().get_Values().GetEnumerator(),i,t,u;r.MoveNext();)for(i=r.get_Current(),t=0;t<i.get_Count()-1;t++)u=this._lgData.get_Levels().get_Item$$Int32(n).FindRail(i.get_Item$$Int32(t),i.get_Item$$Int32(t+1)),u==null&&System.Console.WriteLine$$String("Rail not found for trajectory!")},UpdateRoutesAfterSimplification:function(n){for(var u=this._lgData.SkeletonLevels.get_Item$$Int32(n),f=this._lgData.get_Levels().get_Item$$Int32(n)._railsOfEdges.get_Keys().GetEnumerator(),i,r;f.MoveNext();){var e=f.get_Current(),o=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(e.get_Source()),s=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(e.get_Target()),t=u.GetTrajectory(o,s);if(t!=null){for(i=0,r=1;r<t.get_Count()-1;r++){if(u.PathRouter.ContainsVertex(t.get_Item$$Int32(r))){i>0&&(u.PathRouter.MarkEdgeUsed(t.get_Item$$Int32(i-1),t.get_Item$$Int32(r)),i=0);continue}t.RemoveAt(r);i==0&&(i=r);r--}i>0&&u.PathRouter.MarkEdgeUsed(t.get_Item$$Int32(i-1),System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,t));this.EdgeIsNew(o,s,n)||u.MarkEdgesAlongPathAsEdgesOnOldTrajectories(t)}}},TestTrajectoriesPreserved:function(n){var e,r,i,f,h;if(n==0)return!0;for(e=this._lgData.SkeletonLevels.get_Item$$Int32(n-1).get_EdgeTrajectories().GetEnumerator();e.MoveNext();){var o=e.get_Current(),c=o.get_Key().get_A(),l=o.get_Key().get_B(),u=o.get_Value(),s=System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,u),t=this._lgData.SkeletonLevels.get_Item$$Int32(n).GetTrajectory(c,l);if(System.Diagnostics.Debug.Assert$$Boolean(t.get_Count()>1),System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,t).Equals$$Object(s)||t.Reverse(),!System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,t).Equals$$Object(s))return System.Console.WriteLine$$String("Endpoint of old path not found on new path!"),!1;for(r=1,i=1;r<u.get_Count();r++,i++){for(f=function(){var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);return n.Add(u.get_Item$$Int32(r-1)),n}.call(this);i<t.get_Count()&&!u.get_Item$$Int32(r).Equals$$Object(t.get_Item$$Int32(i));)f.Add(t.get_Item$$Int32(i)),i++;if(i==t.get_Count()||!u.get_Item$$Int32(r).Equals$$Object(t.get_Item$$Int32(i)))return System.Console.WriteLine$$String("Point of old path not found on new path!"),!1;if(f.Add(t.get_Item$$Int32(i)),h=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.ArePointsOnLine(f),!h)return System.Console.WriteLine$$String("New path segment is not a line!"),!1}}return!0},CleanUpRails:function(){for(var u=this._lgData.get_Levels().GetEnumerator(),o,t,i,r;u.MoveNext();){for(var n=u.get_Current(),f=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),e=n._railsOfEdges.get_Values().GetEnumerator();e.MoveNext();)o=e.get_Current(),f.InsertRange(o);if(t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor,n._railDictionary.get_Values(),$CreateAnonymousDelegate(this,function(n){return!f.Contains$$T(n)}))),System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor,t))for(i=t.GetEnumerator();i.MoveNext();)r=i.get_Current(),n.RemoveRailFromDictionary(r),n.RemoveRailFromRtree(r)}},TestAllEdgesConsistency:function(){for(var f=this._mainGeometryGraph.get_Edges().GetEnumerator(),n,e,r,u,t,o;f.MoveNext();){var i=f.get_Current(),s=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()),h=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()),c=System.Math.Max$$Double$$Double(s.get_ZoomLevel(),h.get_ZoomLevel()),l=this.GetIndexByZoomLevel(c);for(n=l;n<this._lgData.get_Levels().get_Count();n++)for(e=this._lgData.get_Levels().get_Item$$Int32(n)._railsOfEdges.get_Item$$TKey(i),r=e.GetEnumerator();r.MoveNext();)u=r.get_Current(),t=As(u.Geometry,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor),t!=null&&(o=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,t.get_Start(),t.get_End()),this._lgData.get_Levels().get_Item$$Int32(n)._railDictionary.ContainsKey(o)||System.Diagnostics.Debug.Assert$$Boolean$$String(!1,System.String.Format$$String$$Object("rail {0} is not in the dictionary",u)))}},SelectAllColoredEdgesIncidentTo:function(n,t){for(var u=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_GeometryNode().get_Edges()),e=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor),r=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Object.ctor),o=u.GetEnumerator(),f,i;o.MoveNext();)i=o.get_Current(),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()).Color!=null&&this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()).Color!=null&&(Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_GeometryNode().get_Center(),i.get_Source().get_Center())?r.set_Item$$TKey(i,this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()).Color):r.set_Item$$TKey(i,this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()).Color)),e.Add(i),n.Selected?Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_GeometryNode().get_Center(),i.get_Source().get_Center())?this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()).SelectedNeighbor--:this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()).SelectedNeighbor--:(i.Color=n.Color,Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_GeometryNode().get_Center(),i.get_Source().get_Center())?this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()).SelectedNeighbor++:this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()).SelectedNeighbor++);if(u=e,n.Selected){for(this._lgData.UnselectColoredEdges(u,t),f=r.get_Keys().GetEnumerator();f.MoveNext();)i=f.get_Current(),i.Color=r.get_Item$$TKey(i);this._lgData.SelectEdges$$List$1$Edge(System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,r.get_Keys()))}else this._lgData.SelectEdges$$List$1$Edge(u)},SelectAllEdgesIncidentTo:function(n){for(var t=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_GeometryNode().get_Edges()),r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor),u=t.GetEnumerator(),i;u.MoveNext();)i=u.get_Current(),r.Add(i),n.Selected||(i.Color=n.Color);t=r;n.Selected?this._lgData.UnselectEdges(t):this._lgData.SelectEdges$$List$1$Edge(t)},UpdateVisibleEdgesIncidentTo:function(n,t){for(var r=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_GeometryNode().get_Edges()),u=System.Math.Max$$Int32$$Int32(0,t-1),f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor),e=r.GetEnumerator(),i;e.MoveNext();)i=e.get_Current(),this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Source()).get_ZoomLevel()<=u&&this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(i.get_Target()).get_ZoomLevel()<=u&&f.Add(i);r=f;n.Selected&&this._lgData.SelectEdges$$List$1$Edge$$Int32(r,System.Math.Min$$Int32$$Int32(t,this._lgLayoutSettings.maximumNumOfLayers))},SelectEdge:function(n){var t=function(){var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);return t.Add(n.get_Edge()),t}.call(this);this._lgData.SelectEdges$$List$1$Edge(t)},DeselectAllEdges:function(){this._lgData.PutOffAllEdges()},RunMds:function(){for(var o=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,System.Double.ctor),t=this.get_GeometryEdgesToLgEdgeInfos().get_Keys().GetEnumerator(),u,f,e;t.MoveNext();){var n=t.get_Current(),i=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n.get_Source()),r=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n.get_Target()),s=System.Math.Max$$Double$$Double(i.get_ZoomLevel(),r.get_ZoomLevel());s<5&&(u=10,o.Add(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,i.get_GeometryNode(),r.get_GeometryNode()),u),n.set_Length(3))}f=function(){var n=new Microsoft.Msagl.Layout.MDS.MdsLayoutSettings.ctor;return n.set_ScaleX(600),n.set_ScaleY(600),n.RunInParallel=!1,n.set_PivotNumber(100),n}.call(this);e=new Microsoft.Msagl.Layout.MDS.MdsGraphLayout.ctor(f,this._mainGeometryGraph);e.Run()},SelectTopEdgePassingThroughRailWithEndpoint:function(n,t){var i=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,this.GetEdgesPassingThroughRail(n),$CreateAnonymousDelegate(this,function(n){return t.Contains$$T(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n.get_Source()))||t.Contains$$T(this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(n.get_Target()))}))),r;System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,i)&&(this.DeselectAllEdges(),r=System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.OrderByDescending$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Double.ctor,i,$CreateAnonymousDelegate(this,function(n){return this._lgData.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(n).get_Rank()}))),this.SelectEdge(this._lgData.GeometryEdgesToLgEdgeInfos.get_Item$$TKey(r)))},GetLabelRectForScale$$LgNodeInfo$$Double:function(n,t){var i=this._lgLayoutSettings.NodeLabelHeightInInches*this._lgLayoutSettings.DpiX/t/this.FitFactor(),r=i*n.LabelWidthToHeightRatio,u=this.GetNodeDotRect(n,t).get_Width(),f=Microsoft.Msagl.Core.Geometry.Point.Scale(r+u*1.01,i+u*1.01,n.get_LabelOffset()),e=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(.5*r,.5*i),.7);return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Center(),f),e),Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Center(),f),e))},GetLabelRectForScale$$LgNodeInfo$$LabelPlacement$$Double:function(n,t,i){var r=this._lgLayoutSettings.NodeLabelHeightInInches*this._lgLayoutSettings.DpiX/i/this.FitFactor(),u=r*n.LabelWidthToHeightRatio,f=this.GetNodeDotRect(n,i).get_Width(),e=Microsoft.Msagl.Core.Geometry.Point.Scale(u+f*1.01,r+f*1.01,Microsoft.Msagl.Core.Layout.LgNodeInfo.GetLabelOffset(t)),o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(.5*u,.5*r);return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Center(),e),o),Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Center(),e),o))},GetNodeDotRect:function(n,t){var i=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(n.get_Center());return i.Pad$$Double(this.NodeDotWidth(t)/2),i},NodeDotWidth:function(n){return this._lgLayoutSettings.NodeDotWidthInInches*this._lgLayoutSettings.DpiX/n/this.FitFactor()},InsertCandidateLabelsGreedily:function(n){for(var r=this.get_CurrentZoomLevel(),f=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor),c=this._railGraph.Nodes.GetEnumerator(),i,u,o,t;c.MoveNext();)t=c.get_Current(),i=this._lgData.GeometryNodesToLgNodeInfos.get_Item$$TKey(t),f.Add$$Rectangle$$TData(this.GetNodeDotRect(i,r),i),i.LabelVisibleFromScale<=r&&(u=this.GetLabelRectForScale$$LgNodeInfo$$Double(i,r),f.Add$$Rectangle$$TData(u,i));for(o=n.GetEnumerator();o.MoveNext();)if(t=o.get_Current(),!(t.LabelVisibleFromScale<=r)){for(var s=[Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Bottom,Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Right,Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Left,Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Top],l=!1,u=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor,h=Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Bottom,e=0,v=s.length,a=s[e];e<v;e++,a=s[e])if(h=a,u=this.GetLabelRectForScale$$LgNodeInfo$$LabelPlacement$$Double(t,h,r),!f.IsIntersecting(u)){l=!0;break}l&&(f.Add$$Rectangle$$TData(u,t),this.SelectedNodeLabels.set_Item$$TKey(t,h))}},InsertLabelsGreedily:function(n){for(var o=0,u=0,i,s,t,c;u<this._lgData.get_Levels().get_Count()-1&&n>=this._lgData.get_Levels().get_Item$$Int32(u).ZoomLevel;)u++;for(var l=this.GetNodeInfosOnLevelLeq(u),f=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor),a=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor),v=l.GetEnumerator();v.MoveNext();)t=v.get_Current(),f.Add$$Rectangle$$TData(this.GetNodeDotRect(t,n),t),t.LabelVisibleFromScale>0&&t.LabelVisibleFromScale<n&&(i=this.GetLabelRectForScale$$LgNodeInfo$$Double(t,n),f.Add$$Rectangle$$TData(i,t),o++);for(s=l.GetEnumerator();s.MoveNext();)if(t=s.get_Current(),!(t.LabelVisibleFromScale>0)||!(t.LabelVisibleFromScale<n)){for(var h=[Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Bottom,Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Right,Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Left,Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement.Top],r=!1,i=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor,e=0,p=h.length,y=h[e];e<p;e++,y=h[e])if(t.LabelPosition=y,i=this.GetLabelRectForScale$$LgNodeInfo$$Double(t,n),!f.IsIntersecting(i)){r=!0;break}if(!r)break;r&&(c=a.GetAllIntersecting(i),System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,c)&&this.DoesOverlapTooManyImportant(t,c)&&(r=!1));r?(t.LabelVisibleFromScale<=0&&(t.LabelVisibleFromScale=n),f.Add$$Rectangle$$TData(i,t),o++):(t.LabelVisibleFromScale=0,a.Add$$Rectangle$$TData(i,t))}return o},DoesOverlapTooManyImportant:function(n,t){var i=n.get_Rank(),r=System.Linq.Enumerable.Sum$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,t,$CreateAnonymousDelegate(this,function(n){return n.get_Rank()}));return i*20<r},RectIsEmptyStartingFromLevel:function(n,t){for(var i=t;i<this._lgData.get_Levels().get_Count();i++)if(!this._lgData.get_Levels().get_Item$$Int32(i).RectIsEmptyOnLevel(n))return!1;return!0},GetNumberOfLevels:function(){return this._lgData.get_Levels().get_Count()},FindClosestNodeInfoForMouseClickOnLevel:function(n,t){var u,f,o;if(t>=this._lgData.get_Levels().get_Count())return null;var h=this._lgData.get_Levels().get_Item$$Int32(t),s=this.NodeDotWidth(this.get_CurrentZoomLevel())/2,c=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Size$$Point(new Microsoft.Msagl.Core.DataStructures.Size.ctor$$Double$$Double(s,s),n),i=h.get_NodeInfoTree().GetAllIntersecting(c);if(!System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,i))return null;u=Infinity;f=null;for(var r=0,l=i.length,e=i[r];r<l;r++,e=i[r])o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e.get_Center(),n).get_LengthSquared(),o<u&&(u=o,f=e);return f},FindClosestNodeInfoForMouseClickBelowCurrentLevel:function(n){for(var i,r=this._lgData.GetLevelIndexByScale(this.get_CurrentZoomLevel()),t=r+1;t<this._lgData.get_LevelNodeCounts().get_Count();t++)if(i=this.FindClosestNodeInfoForMouseClickOnLevel(n,t),i!=null)return i;return null},AnalyzeClick:function(n){var t=this.FindClosestNodeInfoForMouseClickBelowCurrentLevel(n),i;t!=null&&(this.SelectAllEdgesIncidentTo(t),i=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,t.get_GeometryNode().get_Edges()),this._railGraph.Edges.InsertRange(i),t.Selected=!0,this._lgData.get_SelectedNodeInfos().Insert(t),this._railGraph.Nodes.Insert(t.get_GeometryNode()),this.RunOnViewChange())},AnalyzeClickForInvisibleNode:function(n){var t=this.FindClosestNodeInfoForMouseClickBelowCurrentLevel(n),i;return t==null?null:(this.SelectAllEdgesIncidentTo(t),i=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,t.get_GeometryNode().get_Edges()),this._railGraph.Edges.InsertRange(i),t.Selected=!0,this._lgData.get_SelectedNodeInfos().Insert(t),this._railGraph.Nodes.Insert(t.get_GeometryNode()),this.RunOnViewChange(),t.get_GeometryNode())},NumberOfNodesOfLastLayerIntersectedRectIsLessThanBound:function(n,t,i){var r=this.GetNumberOfLevels()-1,u=this._lgData.get_Levels().get_Item$$Int32(r),f=System.Math.Pow(2,n);return u.get_NodeInfoTree().NumberOfIntersectedIsLessThanBound(t,i,$CreateAnonymousDelegate(this,function(n){return n.get_ZoomLevel()>f}))},TileIsEmpty:function(n){var i=this.GetNumberOfLevels()-1,r=this._lgData.get_Levels().get_Item$$Int32(i),t;return!function(){var i={Value:t},u=r.get_NodeInfoTree().OneIntersecting(n,i);return t=i.Value,u}.call(this)},GetTileNodes:function(n){var t=new Microsoft.Msagl.Miscellaneous.RegularGrid.GridTraversal.ctor(this._mainGeometryGraph.get_BoundingBox(),n.get_Item1()),i=t.GetTileRect(n.get_Item2(),n.get_Item3());return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,this._lgData.get_Levels().get_Item$$Int32(this.GetNumberOfLevels()-1).get_NodeInfoTree().GetAllIntersecting(i),$CreateAnonymousDelegate(this,function(n){return n.get_GeometryNode()}))}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgInteractor);Microsoft$Msagl$Layout$LargeGraphLayout$LgLayoutSettings={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgLayoutSettings",baseTypeName:"Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this.maximumNumOfLayers=0;this.mainGeometryGraphWidth=0;this.mainGeometryGraphHeight=0;this.lgGeometryGraph=null;this.hugeGraph=!1;this.flow=!1;this.delta=0;this.TransformFromGraphToScreen=null;this.DpiX=0;this.DpiY=0;this.NodeDotWidthInInches=.08;this.NodeDotWidthInInchesMinInImage=.06;this.NodeLabelHeightInInches=.14;this.MaximalArrowheadLength=null;this.geometryNodesToLgNodeInfos=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor);this._scaleInterval=new Microsoft.Msagl.Layout.LargeGraphLayout.Interval.ctor$$Double$$Double(1e-5,1e8);this.needToLayout=!0;this.maxNumberOfNodesPerTile=20;this.ExitAfterInit=!1;this.increaseNodeQuota=0;this.maxNumberOfRailsPerTile=300;this._simplifyRoutes=!0;this._numberOfNodeShapeSegs=12;this._generateTiles=!0;this._railColors=null;this._selectionColors=null;this.ViewerChangeTransformAndInvalidateGraph=null;this._Interactor=null;this._ClientViewportFunc=null;this._ClientViewportMappedToGraph=null;Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings.ctor.call(this);this.set_ClientViewportFunc(n);this.TransformFromGraphToScreen=t;this.DpiX=i;this.DpiY=r;this.MaximalArrowheadLength=u;this.get_EdgeRoutingSettings().set_Padding(this.get_NodeSeparation()/4);this.get_EdgeRoutingSettings().set_PolylinePadding(this.get_NodeSeparation()/6);this.InitDefaultRailColors();this.InitDefaultSelectionColors()},add_ViewerChangeTransformAndInvalidateGraph:function(n){this.ViewerChangeTransformAndInvalidateGraph=$CombineDelegates(this.ViewerChangeTransformAndInvalidateGraph,n)},remove_ViewerChangeTransformAndInvalidateGraph:function(n){this.ViewerChangeTransformAndInvalidateGraph=$RemoveDelegate(this.ViewerChangeTransformAndInvalidateGraph,n)},OnViewerChangeTransformAndInvalidateGraph:function(){this.ViewerChangeTransformAndInvalidateGraph!=null&&this.ViewerChangeTransformAndInvalidateGraph()},RailGraph$$:"Microsoft.Msagl.Layout.LargeGraphLayout.RailGraph",get_RailGraph:function(){return this.get_Interactor()!=null?this.get_Interactor().get_RailGraph():null},Clone:function(){return Cast(this.MemberwiseClone(),Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings.ctor)},Interactor$$:"Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor",get_Interactor:function(){return this._Interactor},set_Interactor:function(n){this._Interactor=n},ClientViewportFunc$$:"System.Func`1[[Microsoft.Msagl.Core.Geometry.Rectangle]]",get_ClientViewportFunc:function(){return this._ClientViewportFunc},set_ClientViewportFunc:function(n){this._ClientViewportFunc=n},ClientViewportMappedToGraph$$:"System.Func`1[[Microsoft.Msagl.Core.Geometry.Rectangle]]",get_ClientViewportMappedToGraph:function(){return this._ClientViewportMappedToGraph},set_ClientViewportMappedToGraph:function(n){this._ClientViewportMappedToGraph=n},GeometryNodesToLgNodeInfos$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.Layout.Node],[Microsoft.Msagl.Core.Layout.LgNodeInfo]]",get_GeometryNodesToLgNodeInfos:function(){return this.geometryNodesToLgNodeInfos},set_GeometryNodesToLgNodeInfos:function(n){this.geometryNodesToLgNodeInfos=n},GeometryEdgesToLgEdgeInfos$$:"System.Collections.Generic.IDictionary`2[[Microsoft.Msagl.Core.Layout.Edge],[Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo]]",get_GeometryEdgesToLgEdgeInfos:function(){return this.get_Interactor().get_GeometryEdgesToLgEdgeInfos()},ScaleInterval$$:"Microsoft.Msagl.Layout.LargeGraphLayout.Interval",get_ScaleInterval:function(){return this._scaleInterval},set_ScaleInterval:function(n){this._scaleInterval=n},NeedToLayout$$:"System.Boolean",get_NeedToLayout:function(){return this.needToLayout},set_NeedToLayout:function(n){this.needToLayout=n},MaxNumberOfNodesPerTile$$:"System.Int32",get_MaxNumberOfNodesPerTile:function(){return this.maxNumberOfNodesPerTile},set_MaxNumberOfNodesPerTile:function(n){this.maxNumberOfNodesPerTile=n},IncreaseNodeQuota$$:"System.Double",get_IncreaseNodeQuota:function(){return this.increaseNodeQuota},set_IncreaseNodeQuota:function(n){this.increaseNodeQuota=n},MaxNumberOfRailsPerTile$$:"System.Int32",get_MaxNumberOfRailsPerTile:function(){return this.maxNumberOfRailsPerTile},set_MaxNumberOfRailsPerTile:function(n){this.maxNumberOfRailsPerTile=n},GetMaximalZoomLevel:function(){return this.get_Interactor().GetMaximalZoomLevel()},SimplifyRoutes$$:"System.Boolean",get_SimplifyRoutes:function(){return this._simplifyRoutes},set_SimplifyRoutes:function(n){this._simplifyRoutes=n},NumberOfNodeShapeSegs$$:"System.Int32",get_NumberOfNodeShapeSegs:function(){return this._numberOfNodeShapeSegs},set_NumberOfNodeShapeSegs:function(n){this._numberOfNodeShapeSegs=n},GenerateTiles$$:"System.Boolean",get_GenerateTiles:function(){return this._generateTiles},set_GenerateTiles:function(n){this._generateTiles=n},RailColors$$:"System.String[]",get_RailColors:function(){return this._railColors},set_RailColors:function(n){this._railColors=n},SelectionColors$$:"System.String[]",get_SelectionColors:function(){return this._selectionColors},set_SelectionColors:function(n){this._selectionColors=n},InitDefaultRailColors:function(){this._railColors=new Array(3);this._railColors[0]="#87CEFA";this._railColors[1]="#FAFAD2";this._railColors[2]="#FAFAD2"},InitDefaultSelectionColors:function(){this._selectionColors=new Array(3);this._selectionColors[0]="#E60000";this._selectionColors[1]="#E60000";this._selectionColors[2]="#E60000"},GetColorForZoomLevel:function(n){var t=System.Math.Log$$Double$$Double(n,2)|0;return t=System.Math.Min$$Int32$$Int32(t,System.Linq.Enumerable.Count$1$$IEnumerable$1(System.String.ctor,this.get_RailColors())-1),t=System.Math.Max$$Int32$$Int32(t,0),this.get_RailColors()[t]},GetSelColorForZoomLevel:function(n){var t=System.Math.Log$$Double$$Double(n,2)|0;return t=System.Math.Min$$Int32$$Int32(t,System.Linq.Enumerable.Count$1$$IEnumerable$1(System.String.ctor,this.get_SelectionColors())-1),t=System.Math.Max$$Int32$$Int32(t,0),this.get_SelectionColors()[t]},GetNodeSelColor:function(){return this.get_SelectionColors()[0]}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgLayoutSettings);Microsoft$Msagl$Layout$LargeGraphLayout$LevelCalculator={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LevelCalculator",baseTypeName:"System.Object",staticDefinition:{AssignEdges:function(n,t){var r,i,u,f;for(Microsoft.Msagl.Layout.LargeGraphLayout.LevelCalculator.AssignEdgesToLevels(n,t),r=Microsoft.Msagl.Layout.LargeGraphLayout.LevelCalculator.SortEdgeInfosByZoomLevel(n),i=t.get_LevelNodeCounts().GetEnumerator();i.MoveNext();)if(u=i.get_Current(),f=Microsoft.Msagl.Layout.LargeGraphLayout.LevelCalculator.AddLevel(n,t,u,r),f)break},AddLevel:function(n,t,i,r){var u=t.get_SortedLgNodeInfos().get_Item$$Int32(i-1).get_ZoomLevel()|0,f=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor,System.Linq.Enumerable.TakeWhile$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor,r,function(n){return n.get_ZoomLevel()<=u}));return n.AddLevel(),System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor,f)==n.GeometryEdgesToLgEdgeInfos.get_Count()},SortEdgeInfosByZoomLevel:function(n){var t=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor,n.GeometryEdgesToLgEdgeInfos.get_Values());return System.Array.Sort$1$$T$Array$$Comparison$1(Microsoft.Msagl.Layout.LargeGraphLayout.LgEdgeInfo.ctor,t,function(n,t){return n.get_ZoomLevel().CompareTo$$Double(t.get_ZoomLevel())}),t},AssignEdgesToLevels:function(n,t){for(var i=t.get_LevelNodeCounts().GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),Microsoft.Msagl.Layout.LargeGraphLayout.EdgePicker.SetEdgeInfosZoomLevelsAndIcreaseRanks(n,t,r)},SetEdgesOnLevels:function(n,t,i){var r=new Microsoft.Msagl.Layout.LargeGraphLayout.DeviceIndependendZoomCalculatorForNodes.ctor(function(t){return n.GeometryNodesToLgNodeInfos.get_Item$$TKey(t)},t,i,i.get_MaxNumberOfNodesPerTile());r.RunAfterFlow(n);n.set_SortedLgNodeInfos(r.get_SortedLgNodeInfos());n.set_LevelNodeCounts(r.get_LevelNodeCounts())},SetNodeZoomLevelsAndRouteEdgesOnLevels:function(n,t,i){var r=new Microsoft.Msagl.Layout.LargeGraphLayout.DeviceIndependendZoomCalculatorForNodes.ctor(function(t){return n.GeometryNodesToLgNodeInfos.get_Item$$TKey(t)},t,i,i.get_MaxNumberOfNodesPerTile());r.Run();n.set_SortedLgNodeInfos(r.get_SortedLgNodeInfos());n.set_LevelNodeCounts(r.get_LevelNodeCounts());Microsoft.Msagl.Layout.LargeGraphLayout.LevelCalculator.AssignEdges(n,r)},RankGraph:function(n,t){for(var i=n.get_ConnectedGeometryGraphs().GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),Microsoft.Msagl.Layout.LargeGraphLayout.LevelCalculator.RankTheGraph(n,t,r);Microsoft.Msagl.Layout.LargeGraphLayout.LevelCalculator.UpdateRanksOfClusters(n)},UpdateRanksOfClusters:function(n){for(var u=n.GeometryNodesToLgNodeInfos.get_Values().GetEnumerator(),t,r,f,i;u.MoveNext();)for(t=u.get_Current(),r=t.get_GeometryNode().get_ClusterParents().GetEnumerator();r.MoveNext();)f=r.get_Current(),function(){var t={Value:i},r=n.GeometryNodesToLgNodeInfos.TryGetValue(f,t);return i=t.Value,r}()&&i.get_Rank()<t.get_Rank()&&i.set_Rank(t.get_Rank())},RankTheGraph:function(n,t,i){for(var f,u=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,i.get_Nodes()),e=function(){var n=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor;return n.set_Nodes(new Microsoft.Msagl.Layout.LargeGraphLayout.SimpleNodeCollection.ctor(u)),n.set_Edges(new Microsoft.Msagl.Layout.LargeGraphLayout.SimpleEdgeCollection.ctor(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,i.get_Edges(),function(n){return!Is(n.get_Source(),Microsoft.Msagl.Core.Layout.Cluster.ctor)&&!Is(n.get_Target(),Microsoft.Msagl.Core.Layout.Cluster.ctor)}))),n}(),o=Microsoft.Msagl.Prototype.Ranking.Centrality.PageRank(e,.85,!1),s=i.get_Nodes().get_Count()/t.get_Nodes().get_Count(),r=0;r<u.length;r++)f=u[r],System.Diagnostics.Debug.Assert$$Boolean(f!=t.get_RootCluster()),n.GeometryNodesToLgNodeInfos.get_Item$$TKey(f).set_Rank(s*o[r])}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LevelCalculator);Microsoft$Msagl$Layout$LargeGraphLayout$LgLevel={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this._railDictionary=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor);this._railsOfEdges=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor);this.HighlightedRails=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor);this.ZoomLevel=0;this._geomGraph=null;this._railTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor);this._nodeInfoTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor);this._orderedRailsOfEdges=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Collections.Generic.List$1.ctor);this.tileTableForStatistic=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.TileStatistic.ctor);System.Object.ctor.call(this);this._geomGraph=t;this.ZoomLevel=n},RailDictionary$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.DataStructures.SymmetricTuple`1[[Microsoft.Msagl.Core.Geometry.Point]]],[Microsoft.Msagl.Layout.LargeGraphLayout.Rail]]",get_RailDictionary:function(){return this._railDictionary},RailTree$$:"Microsoft.Msagl.Core.Geometry.RTree`1[[Microsoft.Msagl.Layout.LargeGraphLayout.Rail]]",get_RailTree:function(){return this._railTree},NodeInfoTree$$:"Microsoft.Msagl.Core.Geometry.RTree`1[[Microsoft.Msagl.Core.Layout.LgNodeInfo]]",get_NodeInfoTree:function(){return this._nodeInfoTree},CreateEmptyRailTree:function(){this._railTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor)},GetAllRailsEndpoints:function(){for(var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor),n,t,r=this._railTree.GetAllLeaves().GetEnumerator(),u;r.MoveNext();)u=r.get_Current(),function(){var i={Value:n},r={Value:t},f=u.GetStartEnd(i,r);return n=i.Value,t=r.Value,f}.call(this)&&i.Add(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n,t));return i},FetchOrCreateRailSequence:function(n){for(var i,r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),t=0;t<n.get_Count()-1;t++)(i=this.FindOrCreateRail(n.get_Item$$Int32(t),n.get_Item$$Int32(t+1)),i!=null)&&r.Add(i);return r},FindOrCreateRail:function(n,t){var r=n,u=t,e=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,r,u),i,f;return function(){var n={Value:i},t=this.get_RailDictionary().TryGetValue(e,n);return i=n.Value,t}.call(this)?i:(f=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,u,r),function(){var n={Value:i},t=this.get_RailDictionary().TryGetValue(f,n);return i=n.Value,t}.call(this))?i:this.CreateRail(r,u)},CreateRail:function(n,t){var r=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n,t),i,u;return function(){var n={Value:i},t=this.get_RailDictionary().TryGetValue(r,n);return i=n.Value,t}.call(this)?i:(u=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t),i=new Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor$$ICurve$$Int32(u,this.ZoomLevel),this.get_RailTree().Add$$Rectangle$$TData(i.get_BoundingBox(),i),this.get_RailDictionary().Add(r,i),i)},FindRail:function(n,t){var r=n,u=t,f=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,u,r),i;return function(){var n={Value:i},t=this.get_RailDictionary().TryGetValue(f,n);return i=n.Value,t}.call(this),i},GetRailsIntersectingRect:function(n){for(var r=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor),t=0,i=this._railTree.GetAllIntersecting(n),f=i.length,u=i[t];t<f;t++,u=i[t])r.Insert(u);return r},GetEdgesPassingThroughRail:function(n){return System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,this._railsOfEdges,$CreateAnonymousDelegate(this,function(t){return t.get_Value().Contains$$T(n)})),$CreateAnonymousDelegate(this,function(n){return n.get_Key()})))},RemoveRailFromRtree:function(n){return this._railTree.Remove(n.get_BoundingBox(),n)},AddRailToDictionary:function(n){var t,i,r;return function(){var r={Value:t},u={Value:i},f=n.GetStartEnd(r,u);return t=r.Value,i=u.Value,f}.call(this)?(r=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,t,i),!this._railDictionary.ContainsKey(r))?(this._railDictionary.Add(r,n),!0):!1:!1},AddRailToRtree:function(n){var t,i;(function(){var r={Value:t},u={Value:i},f=n.GetStartEnd(r,u);return t=r.Value,i=u.Value,f}).call(this)&&(this._railTree.Contains(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(t,i),n)||this._railTree.Add$$Rectangle$$TData(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(t,i),n))},RemoveRailFromDictionary:function(n){var t,i;(function(){var r={Value:t},u={Value:i},f=n.GetStartEnd(r,u);return t=r.Value,i=u.Value,f}).call(this)&&this._railDictionary.Remove(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,t,i))},PrintQuota:function(n,t,i){var e,o,r;for(this.tileTableForStatistic.Clear(),e=this._railDictionary.get_Values().GetEnumerator();e.MoveNext();)o=e.get_Current(),o.ZoomLevel==this.ZoomLevel&&this.CreateStatisticsForRail(o);this.RunStatisticsForNodes(n);for(var u=0,f=0,s=this.tileTableForStatistic.get_Values().GetEnumerator();s.MoveNext();)r=s.get_Current(),f<r.rails&&(f=r.rails),u<r.vertices&&(u=r.vertices);return(System.Console.WriteLine$$String$$Object$$Object("max rails per tile {0}\nmax verts per tile {1}.\n",f,u),u<=t&&f<=i)?!0:!1},QuotaSatisfied:function(n,t,i){var f,e,r;for(this.tileTableForStatistic.Clear(),f=this._railDictionary.get_Values().GetEnumerator();f.MoveNext();)e=f.get_Current(),e.ZoomLevel==this.ZoomLevel&&this.CreateStatisticsForRail(e);this.RunStatisticsForNodes(n);for(var o=0,u=0,s=this.tileTableForStatistic.get_Values().GetEnumerator();s.MoveNext();)r=s.get_Current(),u<r.rails&&(u=r.rails),o<r.vertices&&(o=r.vertices);return u<=i?!0:(System.Console.WriteLine$$String$$Object$$Object("max rails per tile {0}\nmax verts per tile {1}.\n",u,o),!1)},RunLevelStatistics:function(n){var i,e,t;for(System.Console.WriteLine$$String("running stats"),i=this._railDictionary.get_Values().GetEnumerator();i.MoveNext();)e=i.get_Current(),this.CreateStatisticsForRail(e);this.RunStatisticsForNodes(n);for(var o=this.ZoomLevel*this.ZoomLevel,s=0,h=0,r=0,u=0,f=0,c=this.tileTableForStatistic.get_Values().GetEnumerator();c.MoveNext();)t=c.get_Current(),h+=t.vertices/o,s+=t.rails/o,u<t.rails&&(u=t.rails),r<t.vertices&&(r=t.vertices),f<t.vertices+t.rails&&(f=t.vertices+t.rails);System.Console.WriteLine$$String$$Object$$Object$$Object("level {0}: average rails per tile {1}\naverage verts per tile {2}, total average per tile {1}.\n",this.ZoomLevel,s,h);System.Console.WriteLine$$String$$Object$$Object$$Object("max rails per tile {0}\nmax verts per tile {1}, total max per tile {2}.\n",u,r,f);System.Console.WriteLine$$String("done with stats")},RunStatisticsForNodes:function(n){for(var t=n.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.CreateStatisticsForNode(i)},CreateStatisticsForNode:function(n){for(var t=this.GetCurveTiles(n.get_BoundaryCurve()).GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),i.vertices++},CreateStatisticsForRail:function(n){var i=As(n.Geometry,Microsoft.Msagl.Core.Layout.Arrowhead.ctor),t,r;if(i!=null)this.CreateStatisticsForArrowhead(i);else for(t=this.GetCurveTiles(As(n.Geometry,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor)).GetEnumerator();t.MoveNext();)r=t.get_Current(),r.rails++},CreateStatisticsForArrowhead:function(n){var t=this.GetOrCreateTileStatistic(n.get_TipPosition());t.rails++},GetOrCreateTileStatistic:function(n){var i=Microsoft.Msagl.Layout.LargeGraphLayout.DeviceIndependendZoomCalculatorForNodes.PointToTuple(this._geomGraph.get_LeftBottom(),n,this.GetGridSize()),t;return function(){var n={Value:t},r=this.tileTableForStatistic.TryGetValue(i,n);return t=n.Value,r}.call(this)?t:(this.tileTableForStatistic.set_Item$$TKey(i,t=function(){var n=new Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.TileStatistic.ctor;return n.rails=0,n.vertices=0,n}.call(this)),t)},GetCurveTiles:function(n){for(var u,f,i=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.TileStatistic.ctor),r=n.get_ParStart(),e=n.get_ParEnd(),o=(e-r)/63,t=0;t<64;t++)u=r+t*o,f=this.GetOrCreateTileStatistic(n.get_Item$$Double(u)),i.Insert(f);return i},GetGridSize:function(){return System.Math.Max$$Double$$Double(this._geomGraph.get_Width(),this._geomGraph.get_Height())/this.ZoomLevel},AddRail:function(n){this.AddRailToDictionary(n)&&this.AddRailToRtree(n)},ClearRailTree:function(){this._railTree.Clear()},CreateNodeTree:function(n,t){for(var r=n.GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),this.get_NodeInfoTree().Add$$RectangleNode$1(new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,i,new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Size$$Point(new Microsoft.Msagl.Core.DataStructures.Size.ctor$$Double$$Double(t,t),i.get_Center())))},GetNodesIntersectingRect:function(n){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,this.get_NodeInfoTree().GetAllIntersecting(n),$CreateAnonymousDelegate(this,function(n){return n.get_GeometryNode()}))},GetNodesIntersectingRectLabelzero:function(n,t){for(var r=this.get_NodeInfoTree().GetAllIntersecting(n),f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),i=0,e=r.length,u=r[i];i<e;i++,u=r[i])u.get_ZoomLevel()<=t&&f.Add(u.get_GeometryNode());return f},RectIsEmptyOnLevel:function(n){var t;return!function(){var i={Value:t},r=this.get_NodeInfoTree().OneIntersecting(n,i);return t=i.Value,r}.call(this)},RemoveFromRailEdges:function(n){for(var t=n.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.RemoveTupleFromRailEdges(i)},RemoveTupleFromRailEdges:function(n){for(var r=n.get_A().get_GeometryNode(),u=n.get_B().get_GeometryNode(),t=this.EdgesBetween(r,u).GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this._railsOfEdges.Remove(i)},EdgesBetween:function(n,t){for(var r=[],f=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_InEdges(),$CreateAnonymousDelegate(this,function(n){return n.get_Source()==t})).GetEnumerator(),u,i;f.MoveNext();)i=f.get_Current(),r.push(i);for(u=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_OutEdges(),$CreateAnonymousDelegate(this,function(n){return n.get_Target()==t})).GetEnumerator();u.MoveNext();)i=u.get_Current(),r.push(i);return r}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgLevel);Microsoft$Msagl$Layout$LargeGraphLayout$LgNodeCollection={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgNodeCollection",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IList$1"],Kind:"Class",definition:{ctor:function(n){this.funcOfNodes=null;this._IsReadOnly=!1;System.Object.ctor.call(this);this.funcOfNodes=$CreateAnonymousDelegate(this,function(){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n(),$CreateAnonymousDelegate(this,function(n){return n.get_GeometryNode()}))})},GetEnumerator:function(){return this.funcOfNodes().GetEnumerator()},Add:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Clear:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Contains:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},CopyTo:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Remove:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Count$$:"System.Int32",get_Count:function(){return System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,this.funcOfNodes())},IsReadOnly$$:"System.Boolean",get_IsReadOnly:function(){return this._IsReadOnly},set_IsReadOnly:function(n){this._IsReadOnly=n},IndexOf:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Insert:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},RemoveAt:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Item$$:"Microsoft.Msagl.Core.Layout.Node",get_Item$$Int32:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},set_Item$$Int32:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgNodeCollection);Microsoft$Msagl$Layout$LargeGraphLayout$LgSkeletonLevel={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgSkeletonLevel",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._visGraphVertices=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);this.ZoomLevel=0;this.PathRouter=new Microsoft.Msagl.Layout.LargeGraphLayout.LgPathRouter.ctor;this._edgeTrajectories=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Collections.Generic.List$1.ctor);System.Object.ctor.call(this)},EdgeTrajectories$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.DataStructures.SymmetricTuple`1[[Microsoft.Msagl.Core.Layout.LgNodeInfo]]],[System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Geometry.Point]]]]",get_EdgeTrajectories:function(){return this._edgeTrajectories},AddGraphEdgesFromCentersToPointsOnBorders:function(n){for(var t=n.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.PathRouter.AddVisGraphEdgesFromNodeCenterToNodeBorder(i)},Clear:function(){this._visGraphVertices.Clear();this.PathRouter=new Microsoft.Msagl.Layout.LargeGraphLayout.LgPathRouter.ctor},SetTrajectoryAndAddEdgesToUsed:function(n,t,i){var r=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,n,t);this._edgeTrajectories.ContainsKey(r)||(this._edgeTrajectories.set_Item$$TKey(r,i),this.PathRouter.MarkEdgesUsedAlongPath(i))},HasSavedTrajectory:function(n,t){var i=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,n,t);return this.get_EdgeTrajectories().ContainsKey(i)},GetTrajectory:function(n,t){var i,r=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,n,t);return function(){var n={Value:i},t=this.get_EdgeTrajectories().TryGetValue(r,n);return i=n.Value,t}.call(this),i},ClearSavedTrajectoriesAndUsedEdges:function(){this._edgeTrajectories.Clear();this.PathRouter.ClearUsedEdges()},GetPointsOnSavedTrajectories:function(){for(var n=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),t=this._edgeTrajectories.get_Values().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.InsertRange(i);return n},RemoveUnusedGraphEdgesAndNodes:function(){var n=this.GetUnusedGraphEdges();this.PathRouter.RemoveVisibilityEdges(n)},GetUnusedGraphEdges:function(){return System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,this.PathRouter.GetAllEdgesVisibilityEdges(),$CreateAnonymousDelegate(this,function(n){return!this.PathRouter.IsEdgeUsed(n)})))},SymSegsOfPointList:function(n){for(var i=[],t=0;t<n.get_Count()-1;t++)i.push(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_Item$$Int32(t),n.get_Item$$Int32(t+1)));return i},RoutesAreConsistent:function(){var t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,this.PathRouter.UsedEdges()),n=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(System.Collections.Generic.List$1.ctor,Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,System.Collections.Generic.List$1.ctor,this._edgeTrajectories,$CreateAnonymousDelegate(this,function(n){return n.get_Value()})),$CreateDelegate(this,this.SymSegsOfPointList))),i=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,this.PathRouter.get_VisGraph().get_Edges(),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_SourcePoint(),n.get_TargetPoint())})));return Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(n,i)&&Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(t,n)},Ttt:function(n){for(var i=[],r=n.GetEnumerator(),t;r.MoveNext();)t=r.get_Current(),i.push(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.get_A(),t.get_B()));return i},RemoveSomeEdgeTrajectories:function(n){for(var t=n.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.RemoveEdgeTrajectory(i);this.RemoveUnusedGraphEdgesAndNodes()},RemoveEdgeTrajectory:function(n){var t,i;if(function(){var i={Value:t},r=this._edgeTrajectories.TryGetValue(n,i);return t=i.Value,r}.call(this)){for(i=0;i<t.get_Count()-1;i++)this.DiminishUsed(t.get_Item$$Int32(i),t.get_Item$$Int32(i+1));this._edgeTrajectories.Remove(n)}},DiminishUsed:function(n,t){this.PathRouter.DiminishUsed(n,t)},MarkEdgesAlongPathAsEdgesOnOldTrajectories:function(n){this.PathRouter.MarkEdgesAlongPathAsEdgesOnOldTrajectories(n)}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgSkeletonLevel);Microsoft$Msagl$Layout$LargeGraphLayout$NodeRailLevelCalculator$GreedyNodeRailLevelCalculator={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.NodeRailLevelCalculator.GreedyNodeRailLevelCalculator",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){var t,i;for(this.ReroutingAttempts=0,this.BoundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor,this.MaxGridSize=0,this.NumCones=8,this.MaxLevel=16384,this.MaxAmountNodesPerTile=15,this.MaxAmountRailsPerTile=80,this._insertedNodes=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor),this._insertedNodesTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor),this._insertedNodeRectsTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.Geometry.Rectangle.ctor),this._insertedSegmentsTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor),this._nodeTileTable=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,System.Int32.ctor),this._segmentTileTable=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,System.Int32.ctor),this._nodeLevels=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.List$1.ctor),this.ScaleBbox=1.1,this.UpdateBitmapForEveryInsertion=!0,this._pathRouter=new Microsoft.Msagl.Layout.LargeGraphLayout.LgPathRouter.ctor,this._SortedLgNodeInfos=null,this._GeometryNodesToLgNodeInfos=null,this._IncreaseNodeQuota=0,System.Object.ctor.call(this),this.set_SortedLgNodeInfos(n),t=this.get_SortedLgNodeInfos().GetEnumerator();t.MoveNext();)i=t.get_Current(),i.Processed=!1;this.InitBoundingBox()},SortedLgNodeInfos$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Layout.LgNodeInfo]]",get_SortedLgNodeInfos:function(){return this._SortedLgNodeInfos},set_SortedLgNodeInfos:function(n){this._SortedLgNodeInfos=n},InitBoundingBox:function(){this.BoundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$IEnumerable$1$Point(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,this.get_SortedLgNodeInfos(),$CreateAnonymousDelegate(this,function(n){return n.get_Center()})))},PlaceNodesOnly:function(n){this.BoundingBox=n;for(var t=0,i=1,r=0;t<this.get_SortedLgNodeInfos().get_Count()&&i<=this.MaxLevel;)t=this.DrawNodesOnlyOnLevel(i,t),this.AddAllToNodeLevel(r),i*=2,r++},MarkAllNodesNotProcessed:function(){for(var n=this.get_SortedLgNodeInfos().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.Processed=!1},TryInsertingNodesAndRoutes:function(n,t,i,r,u,f,e){var c,h,o,s,w;if(this.MarkAllNodesNotProcessed(),this._segmentTileTable=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,System.Int32.ctor),this._nodeTileTable=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,System.Int32.ctor),c=this.TryAddingOldSegments(i,f),!c)return 0;for(this.AddOldNodes(u,f),h=u;h<n;h++){if(o=this.get_SortedLgNodeInfos().get_Item$$Int32(h),s=f.PointToTuple(o.get_Center()),this._nodeTileTable.ContainsKey(s)||this._nodeTileTable.set_Item$$TKey(s,0),this._nodeTileTable.get_Item$$TKey(s)>=this.MaxNodesPerTile(r)){this.ShowDebugInsertedSegments(f,r,o,null,null);break}var v=this.GetSegmentsOnPathsToInsertedNeighborsNotOnOldTrajectories(o,t,e),y=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,v,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_SourcePoint(),n.get_TargetPoint())}))),l=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,y,$CreateAnonymousDelegate(this,function(n){return!this.IsSegmentAlreadyAdded(n)}))),a,p=function(){var n={Value:a},t=this.TryAddingSegmentsUpdateTiles(l,f,n);return a=n.Value,t}.call(this);if(p){this.AddSegmentsToRtree(l);o.Processed=!0;this._nodeTileTable.set_Item$$TKey(s,this._nodeTileTable.get_Item$$TKey(s)+1);this._insertedNodes.Add(o);continue}break}return w=n<this.get_SortedLgNodeInfos().get_Count()?this.get_SortedLgNodeInfos().get_Item$$Int32(n):null,h},GetSegmentsOnPathsToInsertedNeighborsNotOnOldTrajectories:function(n,t,i){for(var o=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor),c=this.GetAdjacentProcessed(n),s=c.GetEnumerator(),h,f,u,r;s.MoveNext();){if(h=s.get_Current(),f=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,n,h),t.ContainsKey(f))u=t.get_Item$$TKey(f);else continue;for(r=0;r<u.get_Count()-1;r++){var l=u.get_Item$$Int32(r),a=u.get_Item$$Int32(r+1),e=i.FindEdge(l,a);System.Diagnostics.Debug.Assert$$Boolean$$String(e!=null,"VisibilityEdge on trajectory not found!");i.IsOnOldTrajectory(e)||o.Insert(e)}}return o},TryAddingOldSegments:function(n,t){var i,r=function(){var r={Value:i},u=this.TryAddingSegmentsUpdateTiles(n,t,r);return i=r.Value,u}.call(this);return r?(this.AddSegmentsToRtree(n),!0):!1},AddOldNodes:function(n,t){for(var u,i,r=0;r<n;r++)u=this.get_SortedLgNodeInfos().get_Item$$Int32(r),i=t.PointToTuple(u.get_Center()),this._nodeTileTable.ContainsKey(i)||this._nodeTileTable.set_Item$$TKey(i,0),u.Processed=!0,this._nodeTileTable.set_Item$$TKey(i,this._nodeTileTable.get_Item$$TKey(i)+1),this._insertedNodes.Add(u)},ShowDebugInsertedSegments:function(){},PrintInsertedNodesLabels:function(){var t=this.BoundingBox,n='<group>\n<path stroke="black">',i,r,u;for(n+=t.get_LeftTop().get_X()+" "+t.get_LeftTop().get_Y()+" m\n",n+=t.get_LeftBottom().get_X()+" "+t.get_LeftBottom().get_Y()+" l\n",n+=t.get_RightBottom().get_X()+" "+t.get_RightBottom().get_Y()+" l\n",n+=t.get_RightTop().get_X()+" "+t.get_RightTop().get_Y()+" l\n",n+="h\n<\/path>\n",i=0,r=this._insertedNodes.GetEnumerator();r.MoveNext();)u=r.get_Current(),n+='<text transformations="translations" pos="',n+=u.get_Center().get_X()+" "+u.get_Center().get_Y(),n+='" stroke="black" type="label" valign="baseline">'+i+"<\/text>\n",i++;n+="<\/group>"},TryAddingSegmentsUpdateTiles:function(n,t,i){return this.IfCanInsertLooseSegmentsUpdateTiles(System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,n),i,t)?!0:(this.RemoveLooseSegmentsDecrementTiles(i.Value,t),!1)},AddNodeToInserted:function(n){this._insertedNodes.Add(n);var t=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n.get_Center(),n.get_Center());this._insertedNodesTree.Add$$Rectangle$$TData(t,n);this._insertedNodeRectsTree.Add$$Rectangle$$TData(t,t)},AddAllToNodeLevel:function(n){var t,i;for(this._nodeLevels.ContainsKey(n)||this._nodeLevels.set_Item$$TKey(n,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor)),t=this._insertedNodes.GetEnumerator();t.MoveNext();)i=t.get_Current(),this._nodeLevels.get_Item$$TKey(n).Add(i)},GetLevelNodeCounts:function(){var n=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(System.Int32.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Collections.Generic.List$1.ctor,System.Int32.ctor,this._nodeLevels.get_Values(),$CreateAnonymousDelegate(this,function(n){return n.get_Count()})));return n.Sort(),n},DrawNodesOnlyOnLevel:function(n,t){var e=System.Math.Log$$Double$$Double(n,2)|0,f=new Microsoft.Msagl.Miscellaneous.RegularGrid.GridTraversal.ctor(this.BoundingBox,e),i,u,r;for(this.UpdateTilesCountInsertedNodesOnly(n,f),i=t;i<this.get_SortedLgNodeInfos().get_Count();i++){if(u=this.get_SortedLgNodeInfos().get_Item$$Int32(i),r=f.PointToTuple(u.get_Center()),this._nodeTileTable.ContainsKey(r)||this._nodeTileTable.set_Item$$TKey(r,0),this._nodeTileTable.get_Item$$TKey(r)>=this.MaxNodesPerTile(n))return i;this.PerformNodeInsertion(u,r);u.set_ZoomLevel(n)}return this.get_SortedLgNodeInfos().get_Count()},MaxNodesPerTile:function(n){var t=System.Math.Log$$Double$$Double(n,2),i=this.MaxAmountNodesPerTile;return i+(this.get_IncreaseNodeQuota()*System.Math.Pow(t,.4)*this.MaxAmountNodesPerTile|0)},GetAdjacentProcessed:function(n){return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,null,n.get_GeometryNode().get_Edges(),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({edge:n,s:this.get_GeometryNodesToLgNodeInfos().get_Item$$TKey(n.get_Source())})})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({x0:n,t:this.get_GeometryNodesToLgNodeInfos().get_Item$$TKey(n.get_edge().get_Target())})})),$CreateAnonymousDelegate(this,function(t){return n==t.get_x0().get_s()?t.get_t():t.get_x0().get_s()})),$CreateAnonymousDelegate(this,function(n){return n.Processed})))},PerformNodeInsertion:function(n,t){this._nodeTileTable.set_Item$$TKey(t,this._nodeTileTable.get_Item$$TKey(t)+1);this.AddNodeToInserted(n)},IfCanInsertLooseSegmentUpdateTiles:function(n,t){var u,i;if(this.IsSegmentAlreadyAdded(n))return!0;for(var f=this.GetIntersectedTiles(n.get_A(),n.get_B(),t),r=0,e=!0,o=f.GetEnumerator();o.MoveNext();)i=o.get_Current(),this._segmentTileTable.ContainsKey(i)||this._segmentTileTable.set_Item$$TKey(i,0),r<this._segmentTileTable.get_Item$$TKey(i)&&(r=this._segmentTileTable.get_Item$$TKey(i)),e&=this._segmentTileTable.get_Item$$TKey(i)<this.MaxAmountRailsPerTile;if(!e)return System.Console.WriteLine$$String("maxNumRailPerTile = "+r),!1;for(u=f.GetEnumerator();u.MoveNext();)i=u.get_Current(),this._segmentTileTable.set_Item$$TKey(i,this._segmentTileTable.get_Item$$TKey(i)+1);return!0},IfCanInsertLooseSegmentsUpdateTiles:function(n,t,i){var r,u;for(t.Value=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor),r=n.GetEnumerator();r.MoveNext();)if(u=r.get_Current(),this.IfCanInsertLooseSegmentUpdateTiles(u,i))t.Value.Insert(u);else return!1;return!0},RemoveLooseSegmentsDecrementTiles:function(n,t){for(var i=n.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),this.RemoveLooseSegmentDecrementTiles(r,t)},RemoveLooseSegmentDecrementTiles:function(n,t){for(var u=this.GetIntersectedTiles(n.get_A(),n.get_B(),t),r=u.GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),this._segmentTileTable.ContainsKey(i)&&this._segmentTileTable.set_Item$$TKey(i,this._segmentTileTable.get_Item$$TKey(i)-1)},AddSegmentToRtree:function(n){if(!this.IsSegmentAlreadyAdded(n)){var t=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n.get_A(),n.get_B());this._insertedSegmentsTree.Add$$Rectangle$$TData(t,n);this._pathRouter.AddVisGraphEdge(n.get_A(),n.get_B())}},IsSegmentAlreadyAdded:function(n){return this._pathRouter.ExistsEdge(n.get_A(),n.get_B())},AddSegmentsToRtree:function(n){for(var t=n.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.AddSegmentToRtree(i)},UpdateTilesCountInsertedNodes:function(n,t){for(var r=this._insertedNodes.GetEnumerator(),u,i;r.MoveNext();)u=r.get_Current(),i=t.PointToTuple(u.get_Center()),this._nodeTileTable.ContainsKey(i)||this._nodeTileTable.set_Item$$TKey(i,0),this._nodeTileTable.set_Item$$TKey(i,this._nodeTileTable.get_Item$$TKey(i)+1)},UpdateTilesCountInsertedNodesOnly:function(n,t){this._nodeTileTable=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,System.Int32.ctor);this.UpdateTilesCountInsertedNodes(n,t)},GetIntersectedTiles:function(n,t,i){return i.GetTilesIntersectedByLineSeg(n,t)},GeometryNodesToLgNodeInfos$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.Layout.Node],[Microsoft.Msagl.Core.Layout.LgNodeInfo]]",get_GeometryNodesToLgNodeInfos:function(){return this._GeometryNodesToLgNodeInfos},set_GeometryNodesToLgNodeInfos:function(n){this._GeometryNodesToLgNodeInfos=n},IncreaseNodeQuota$$:"System.Double",get_IncreaseNodeQuota:function(){return this._IncreaseNodeQuota},set_IncreaseNodeQuota:function(n){this._IncreaseNodeQuota=n}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$NodeRailLevelCalculator$GreedyNodeRailLevelCalculator);Microsoft$Msagl$Layout$LargeGraphLayout$Rail={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.Rail",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.LargeGraphLayout.Rail.railCount=0}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.A=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.B=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.targetA=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.targetB=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.initialA=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.initialB=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Left=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Right=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Weight=1;this.id=0;this._isHighlighted=!1;this.Geometry=null;this.CurveAttachmentPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.TopRankedEdgeInfoOfTheRail=null;this._isUsedOnPreviousLevel=!1;this.MinPassingEdgeZoomLevel=1.79769313486232E+308;this.ZoomLevel=0;this.Color=null;System.Object.ctor.call(this);Microsoft.Msagl.Layout.LargeGraphLayout.Rail.railCount++;this.id=Microsoft.Msagl.Layout.LargeGraphLayout.Rail.railCount},IsUsedOnPreviousLevel$$:"System.Boolean",get_IsUsedOnPreviousLevel:function(){return this._isUsedOnPreviousLevel},set_IsUsedOnPreviousLevel:function(n){this._isUsedOnPreviousLevel=n},GetId:function(){return this.id},toString:function(){return this.id+this.StartEndString()},StartEndString:function(){var n,t;return function(){var i={Value:n},r={Value:t},u=this.GetStartEnd(i,r);return n=i.Value,t=r.Value,u}.call(this)?" "+new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t):""},ctor$$ICurve$$LgEdgeInfo$$Int32:function(n,t,i){this.A=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.B=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.targetA=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.targetB=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.initialA=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.initialB=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Left=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Right=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Weight=1;this.id=0;this._isHighlighted=!1;this.Geometry=null;this.CurveAttachmentPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.TopRankedEdgeInfoOfTheRail=null;this._isUsedOnPreviousLevel=!1;this.MinPassingEdgeZoomLevel=1.79769313486232E+308;this.ZoomLevel=0;this.Color=null;Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor.call(this);this.TopRankedEdgeInfoOfTheRail=t;this.ZoomLevel=i;this.Geometry=n},ctor$$Arrowhead$$Point$$LgEdgeInfo$$Int32:function(n,t,i,r){this.A=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.B=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.targetA=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.targetB=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.initialA=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.initialB=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Left=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Right=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Weight=1;this.id=0;this._isHighlighted=!1;this.Geometry=null;this.CurveAttachmentPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.TopRankedEdgeInfoOfTheRail=null;this._isUsedOnPreviousLevel=!1;this.MinPassingEdgeZoomLevel=1.79769313486232E+308;this.ZoomLevel=0;this.Color=null;Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor.call(this);this.TopRankedEdgeInfoOfTheRail=i;this.Geometry=n.Clone();this.CurveAttachmentPoint=t;this.ZoomLevel=r},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){var i=As(this.Geometry,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor),n,t;return i!=null?i.get_BoundingBox():(n=Cast(this.Geometry,Microsoft.Msagl.Core.Layout.Arrowhead.ctor),t=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n.get_TipPosition(),this.CurveAttachmentPoint),t.Pad$$Double(n.get_Width()),t)},IsHighlighted$$:"System.Boolean",get_IsHighlighted:function(){return this._isHighlighted},set_IsHighlighted:function(n){this._isHighlighted=n},PointTuple:function(){var n=As(this.Geometry,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor),t;return n!=null?new System.Tuple$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_Start(),n.get_End()):(t=Cast(this.Geometry,Microsoft.Msagl.Core.Layout.Arrowhead.ctor),new System.Tuple$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,t.get_TipPosition(),this.CurveAttachmentPoint))},ctor$$ICurve$$Int32:function(n,t){this.A=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.B=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.targetA=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.targetB=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.initialA=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.initialB=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Left=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Right=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Weight=1;this.id=0;this._isHighlighted=!1;this.Geometry=null;this.CurveAttachmentPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.TopRankedEdgeInfoOfTheRail=null;this._isUsedOnPreviousLevel=!1;this.MinPassingEdgeZoomLevel=1.79769313486232E+308;this.ZoomLevel=0;this.Color=null;System.Object.ctor.call(this);this.ZoomLevel=t;Microsoft.Msagl.Layout.LargeGraphLayout.Rail.railCount++;this.id=Microsoft.Msagl.Layout.LargeGraphLayout.Rail.railCount;this.Geometry=n},GetStartEnd:function(n,t){var i=As(this.Geometry,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor),r;return i!=null?(n.Value=i.get_Start(),t.Value=i.get_End(),!0):(r=As(this.Geometry,Microsoft.Msagl.Core.Layout.Arrowhead.ctor),r!=null)?(n.Value=this.CurveAttachmentPoint,t.Value=r.get_TipPosition(),!0):(n.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,t.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,!1)},UpdateTopEdgeInfo:function(n){(this.TopRankedEdgeInfoOfTheRail==null||this.TopRankedEdgeInfoOfTheRail.get_Rank()<n.get_Rank())&&(this.TopRankedEdgeInfoOfTheRail=n);this.MinPassingEdgeZoomLevel=1+System.Math.Min$$Double$$Double(this.MinPassingEdgeZoomLevel,n.get_ZoomLevel())},GetTopEdgeInfo:function(){return this.TopRankedEdgeInfoOfTheRail}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$Rail);Microsoft$Msagl$Layout$LargeGraphLayout$RailGraph={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.RailGraph",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.Nodes=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor);this.Rails=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.LargeGraphLayout.Rail.ctor);this.Edges=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$RailGraph);Microsoft$Msagl$Layout$LargeGraphLayout$Interval={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.Interval",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Double$$Double:function(n,t){this._Start=0;this._End=0;System.Object.ctor.call(this);this.set_Start(n);this.set_End(t)},ctor$$Interval$$Interval:function(n,t){this._Start=0;this._End=0;System.Object.ctor.call(this);this.set_Start(n.get_Start());this.set_End(n.get_End());this.Add(t.get_Start());this.Add(t.get_End())},Add:function(n){this.get_Start()>n&&this.set_Start(n);this.get_End()<n&&this.set_End(n)},Start$$:"System.Double",get_Start:function(){return this._Start},set_Start:function(n){this._Start=n},End$$:"System.Double",get_End:function(){return this._End},set_End:function(n){this._End=n},Length$$:"System.Double",get_Length:function(){return this.get_End()-this.get_Start()},Contains:function(n){return this.get_Start()<=n&&n<=this.get_End()},GetInRange:function(n){return n<this.get_Start()?this.get_Start():n>this.get_End()?this.get_End():n},Intersects:function(n){return n.get_Start()>this.get_End()+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?!1:!(n.get_End()<this.get_Start()-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$Interval);Microsoft$Msagl$Layout$LargeGraphLayout$RouteSimplifier={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.RouteSimplifier",baseTypeName:"System.Object",staticDefinition:{SymmetricSegmentIntersects:function(n,t,i){var r,u,f=function(){var f={Value:r},e={Value:u},o=Microsoft.Msagl.Core.Geometry.Curves.LineSegment.MinDistBetweenLineSegments(n.get_A(),n.get_B(),t,i,f,e);return r=f.Value,u=e.Value,o}();return f<.001&&(.01<r&&r<.99||.01<u&&u<.99)},AngleIsTooSmall:function(n){var t=.369599135716446;return System.Diagnostics.Debug.Assert$$Boolean(n>=0&&6.28318530717959>=n),n<t||6.28318530717959-n<t}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){var u,f,e,o,r;for(this._pathRouter=null,this._nodesTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor),this._fixedPoints=null,this._symmetricSegmentsTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor),System.Object.ctor.call(this),this._pathRouter=n,this._fixedPoints=i,u=t.GetEnumerator();u.MoveNext();)f=u.get_Current(),this._nodesTree.Add$$Rectangle$$TData(f.get_BoundaryOnLayer().get_BoundingBox(),f);for(e=n.get_VisGraph().get_Edges().GetEnumerator();e.MoveNext();)o=e.get_Current(),r=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,o.get_SourcePoint(),o.get_TargetPoint()),this._symmetricSegmentsTree.Add$$Rectangle$$TData(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(r.get_A(),r.get_B()),r)},IntersectedByLineSegNodeInfos:function(n,t){var i=this._nodesTree.GetAllIntersecting(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n,t));return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,i,$CreateAnonymousDelegate(this,function(i){return Microsoft.Msagl.Core.Geometry.Curves.Curve.CurvesIntersect(i.get_BoundaryOnLayer(),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t))})))},Run:function(){for(var r,t,i,f=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,this._pathRouter.GetAllVertices(),$CreateAnonymousDelegate(this,function(n){return!this._fixedPoints.Contains$$T(n.Point)&&n.get_Degree()==2&&!n.get_IsTerminal()}))).ToArray(),e=!1,u=0,o=f.length,n=f[u];u<o;u++,n=f[u])(r=this.GetNeighbors(n),r.get_Count()==2)&&((System.Diagnostics.Debug.Assert$$Boolean(r.get_Count()==2),t=r.get_Item$$Int32(0),i=r.get_Item$$Int32(1),this.AngleIsTooSmallAfterShortcut(t,n,i))||this.ShortcutIntersectsNewVerticesOrCuttingInsideNodes(t,n,i)||this.KeepsPlanarity(t.Point,i.Point)&&(this.RemoveAction(t.Point,n.Point),this.RemoveAction(n.Point,i.Point),this._pathRouter.RemoveVisGraphVertex(n.Point),this.AddAction(t.Point,i.Point),e=!0));return e},AddAction:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(this._pathRouter.get_VisGraph().ContainsVertex(n));System.Diagnostics.Debug.Assert$$Boolean(this._pathRouter.get_VisGraph().ContainsVertex(t));this._pathRouter.get_VisGraph().AddEdge$$Point$$Point(n,t);var i=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n,t);this._symmetricSegmentsTree.Add$$Rectangle$$TData(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n,t),i)},RemoveAction:function(n,t){var r,i;System.Diagnostics.Debug.Assert$$Boolean(function(){var i={Value:r},u=this._pathRouter.FindVertex(n).TryGetEdge(this._pathRouter.FindVertex(t),i);return r=i.Value,u}.call(this));this._pathRouter.RemoveEdge(n,t);i=new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n,t);this._symmetricSegmentsTree.Remove(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(i.get_A(),i.get_B()),i)},GetSymmetricSegmentsIntersectedBySeg:function(n,t){var i=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n,t);return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,this._symmetricSegmentsTree.GetAllIntersecting(i),$CreateAnonymousDelegate(this,function(i){return Microsoft.Msagl.Layout.LargeGraphLayout.RouteSimplifier.SymmetricSegmentIntersects(i,n,t)})))},KeepsPlanarity:function(n,t){return!System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,this.GetSymmetricSegmentsIntersectedBySeg(n,t))},AngleIsTooSmallAfterShortcut:function(n,t,i){return this.AngleIsTooSmallAfterShortcutAtVertex(n,t,i)||this.AngleIsTooSmallAfterShortcutAtVertex(i,t,n)},AngleIsTooSmallAfterShortcutAtVertex:function(n,t,i){for(var e=n.get_OutEdges().GetEnumerator(),f,u,r;e.MoveNext();)if((u=e.get_Current(),r=u.get_Target(),r!=i&&r!=t)&&Microsoft.Msagl.Layout.LargeGraphLayout.RouteSimplifier.AngleIsTooSmall(Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point$$Point(i.Point,n.Point,r.Point)))return!0;for(f=n.get_InEdges().GetEnumerator();f.MoveNext();)if((u=f.get_Current(),r=u.get_Source(),r!=i&&r!=t)&&Microsoft.Msagl.Layout.LargeGraphLayout.RouteSimplifier.AngleIsTooSmall(Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point$$Point(i.Point,n.Point,r.Point)))return!0;return!1},ShortcutIntersectsNewVerticesOrCuttingInsideNodes:function(n,t,i){var u=Microsoft.Msagl.Core.DataStructures.Set$1.op_Addition(this.IntersectedByLineSegNodeInfos(n.Point,t.Point),this.IntersectedByLineSegNodeInfos(t.Point,i.Point)),r=this.IntersectedByLineSegNodeInfos(n.Point,i.Point);return this.CuttingInsideOfNodes(r,n.Point,i.Point)?!0:!u.Contains$$Set$1(r)},CuttingInsideOfNodes:function(n,t,i){return System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,n,$CreateAnonymousDelegate(this,function(n){return this.GettingTooCloseToNode(n,t,i)}))},GettingTooCloseToNode:function(n,t,i){var r=n.get_Center(),u,f;return Microsoft.Msagl.Core.Geometry.Point.op_Equality(t,r)||Microsoft.Msagl.Core.Geometry.Point.op_Equality(i,r)?!1:(u=Microsoft.Msagl.Core.Geometry.Point.ClosestPointAtLineSegment(r,t,i),f=Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(u,n.get_BoundaryOnLayer()),f==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside)},GetNeighbors:function(n){var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor);return t.AddRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,n.get_InEdges(),$CreateAnonymousDelegate(this,function(n){return n.get_Source()}))),t.AddRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,n.get_OutEdges(),$CreateAnonymousDelegate(this,function(n){return n.get_Target()}))),t}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$RouteSimplifier);Microsoft$Msagl$Layout$LargeGraphLayout$ShortestPartRouterForLg={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.ShortestPartRouterForLg",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.source=null;this.target=null;this.queue=new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor);this.prev=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Tuple$2.ctor);this.pathDirection=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.alpha=.5;this.costToTarget=0;this.bestEdgeIntoTarget=null;this.ignoreInteresingEdgesFunc=!1;this.geomNodeToLgNode=null;this._EdgeIsInterestingFunc=null;this._ConsiderOnlyInterestingEdges=!1;System.Object.ctor.call(this);this.source=n;this.target=t;this.geomNodeToLgNode=i;this.queue.Enqueue(n,0);this.pathDirection=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Center(),n.get_Center());this.costToTarget=Infinity;this.set_EdgeIsInterestingFunc($CreateDelegate(this,this.MonotonicityFunc))},EdgeIsInterestingFunc$$:"System.Func`3[[Microsoft.Msagl.Core.Layout.Node],[Microsoft.Msagl.Core.Layout.Node],[System.Boolean]]",get_EdgeIsInterestingFunc:function(){return this._EdgeIsInterestingFunc},set_EdgeIsInterestingFunc:function(n){this._EdgeIsInterestingFunc=n},ConsiderOnlyInterestingEdges$$:"System.Boolean",get_ConsiderOnlyInterestingEdges:function(){return this._ConsiderOnlyInterestingEdges},set_ConsiderOnlyInterestingEdges:function(n){this._ConsiderOnlyInterestingEdges=n},MonotonicityFunc:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Center(),t.get_Center());return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(i,this.pathDirection)>=0},Run:function(){var n;return(this.ignoreInteresingEdgesFunc=!1,n=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Edge.ctor,this.SearchForPath()),n.length>0)?n:this.get_ConsiderOnlyInterestingEdges()?null:(this.ignoreInteresingEdgesFunc=!0,this.Cleanup(),System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Edge.ctor,this.SearchForPath()))},Cleanup:function(){this.costToTarget=Infinity;this.bestEdgeIntoTarget=null;this.prev.Clear();this.queue=new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor);this.queue.Enqueue(this.source,0)},SearchForPath:function(){for(var t,n,i;this.queue.get_Count()>0;){if(n=function(){var n={Value:t},i=this.queue.Dequeue$$Double(n);return t=n.Value,i}.call(this),t>=this.costToTarget)break;i=n==this.source?0:this.prev.get_Item$$TKey(n).get_Item2();this.ProcessVertex(n,i)}return this.RecoverPath()},RecoverPath:function(){var i=[],n,t;if(this.bestEdgeIntoTarget!=null){n=this.target;t=this.bestEdgeIntoTarget;do{if(i.push(t),n=this.GetOtherVertex(t,n),n==this.source)break;t=this.prev.get_Item$$TKey(n).get_Item1()}while(1)}return i},GetOtherVertex:function(n,t){return n.get_Source()==t?n.get_Target():n.get_Source()},ProcessVertex:function(n,t){for(var u=n.get_OutEdges().GetEnumerator(),r,i;u.MoveNext();)i=u.get_Current(),this.ProcessOutEdge(i,t);for(r=n.get_InEdges().GetEnumerator();r.MoveNext();)i=r.get_Current(),this.ProcessInEdge(i,t)},ProcessInEdge:function(n,t){var e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Source().get_Center(),n.get_Target().get_Center()),f,i,r,u;if(this.ignoreInteresingEdgesFunc||this.get_EdgeIsInterestingFunc()==null||this.get_EdgeIsInterestingFunc()(n.get_Target(),n.get_Source()))if(f=this.CalculateCostPlus(n,e),i=t+f,n.get_Source()==this.target)i<this.costToTarget&&(this.costToTarget=i,this.bestEdgeIntoTarget=n);else{if(r=this.AStarH(n.get_Source()),i+r>=this.costToTarget)return;(function(){var t={Value:u},i=this.prev.TryGetValue(n.get_Source(),t);return u=t.Value,i}).call(this)?u.get_Item2()>i&&(this.prev.set_Item$$TKey(n.get_Source(),new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Double.ctor,n,i)),this.queue.Enqueue(n.get_Source(),i+r)):(this.prev.set_Item$$TKey(n.get_Source(),new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Double.ctor,n,i)),this.queue.Enqueue(n.get_Source(),i+r))}},ProcessOutEdge:function(n,t){var e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Target().get_Center(),n.get_Source().get_Center()),f,i,r,u;if(this.ignoreInteresingEdgesFunc||this.get_EdgeIsInterestingFunc()==null||this.get_EdgeIsInterestingFunc()(n.get_Source(),n.get_Target()))if(f=this.CalculateCostPlus(n,e),i=t+f,n.get_Target()==this.target)i<this.costToTarget&&(this.costToTarget=i,this.bestEdgeIntoTarget=n);else{if(r=this.AStarH(n.get_Target()),i+r>=this.costToTarget)return;(function(){var t={Value:u},i=this.prev.TryGetValue(n.get_Target(),t);return u=t.Value,i}).call(this)?u.get_Item2()>i&&(this.prev.set_Item$$TKey(n.get_Target(),new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Double.ctor,n,i)),this.queue.Enqueue(n.get_Target(),i+r)):(this.prev.set_Item$$TKey(n.get_Target(),new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Double.ctor,n,i)),this.queue.Enqueue(n.get_Target(),i+r))}},AStarH:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Center(),this.target.get_Center()).get_Length()*(1-this.alpha)},CalculateCostPlus:function(n,t){return t.get_Length()*(1-this.alpha/this.ZoomLevel(n))},ZoomLevel:function(n){var t=this.geomNodeToLgNode(n.get_Source()),i=this.geomNodeToLgNode(n.get_Target());return System.Math.Max$$Double$$Double(t.get_ZoomLevel(),i.get_ZoomLevel())}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$ShortestPartRouterForLg);Microsoft$Msagl$Layout$LargeGraphLayout$SimpleEdgeCollection={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.SimpleEdgeCollection",baseTypeName:"Microsoft.Msagl.Core.Layout.EdgeCollection",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.edges=null;Microsoft.Msagl.Core.Layout.EdgeCollection.ctor.call(this,null);this.edges=As(n,System.Collections.Generic.List$1.ctor)!=null?As(n,System.Collections.Generic.List$1.ctor):System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n)},GetEnumerator:function(){return this.edges.GetEnumerator()},Count$$:"System.Int32",get_Count:function(){return this.edges.get_Count()},Add:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Clear:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Remove:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$SimpleEdgeCollection);Microsoft$Msagl$Layout$LargeGraphLayout$SimpleNodeCollection={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.SimpleNodeCollection",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IList$1"],Kind:"Class",definition:{ctor:function(n){this.nodes=null;this._IsReadOnly=!1;System.Object.ctor.call(this);this.nodes=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,n)},GetEnumerator:function(){return this.nodes.GetEnumerator()},Add:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Clear:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Contains:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},CopyTo:function(n,t){this.nodes.CopyTo$$T$Array$$Int32(n,t)},Remove:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Count$$:"System.Int32",get_Count:function(){return this.nodes.get_Count()},IsReadOnly$$:"System.Boolean",get_IsReadOnly:function(){return this._IsReadOnly},set_IsReadOnly:function(n){this._IsReadOnly=n},IndexOf:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Insert:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},RemoveAt:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Item$$:"Microsoft.Msagl.Core.Layout.Node",get_Item$$Int32:function(n){return this.nodes.get_Item$$Int32(n)},set_Item$$Int32:function(n,t){this.nodes.set_Item$$Int32(n,t)}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$SimpleNodeCollection);Microsoft$Msagl$Layout$Layered$LayeredLayoutEngine={fullname:"Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},VirtualNodeWidth$$:"System.Double",get_VirtualNodeWidth:function(){return 1},VirtualNodeHeight:function(n){return n.get_MinNodeHeight()*1.5/8},EdgeSpan:function(n,t){return n[t.get_Source()]-n[t.get_Target()]},CreateUpDownConstrainedIntEdge:function(n){var t=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(n.x,n.y);return t.set_Weight(0),t.set_Separation(1),t},TryToPutLabelOutsideOfAngle:function(n,t,i){if(n.get_LabelToTheRightOfAnchorCenter()){if(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Origin(),n.get_Origin(),i.get_Origin())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise)return!0;var r=n.get_LeftAnchor(),u=n.get_RightAnchor(),f=n.get_X();return(Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.PutLabelToTheLeft(n),Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Origin(),n.get_Origin(),i.get_Origin())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise)?!0:(n.set_X(f),n.set_LeftAnchor(r),n.set_RightAnchor(u),n.set_LabelToTheRightOfAnchorCenter(!0),n.set_LabelToTheLeftOfAnchorCenter(!1),!1)}return!1},PutLabelToTheLeft:function(n){var t=n.get_Right(),i=n.get_LeftAnchor();n.set_LeftAnchor(n.get_RightAnchor());n.set_RightAnchor(i);n.set_X(t-n.get_RightAnchor());n.set_LabelToTheLeftOfAnchorCenter(!0);n.set_LabelToTheRightOfAnchorCenter(!1)},CalculateAnchorSizes:function(n,t,i,r,u,f){var s,l,e,a,v,c,o;for(n.set_Anchors(t.Value=new Array(i.get_NodeCount())),s=0;s<t.Value.length;s++)t.Value[s]=new Microsoft.Msagl.Layout.Layered.Anchor.ctor$$Double(f.get_LabelCornersPreserveCoefficient());for(s=0;s<r.get_Nodes().get_Count();s++)Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.CalcAnchorsForOriginalNode(s,u,t.Value,n,f);for(l=n.get_AllIntEdges().GetEnumerator();l.MoveNext();)if(e=l.get_Current(),e.get_LayerEdges()!=null){for(a=e.get_LayerEdges().GetEnumerator();a.MoveNext();)v=a.get_Current(),c=v.get_Target(),c!=e.get_Target()&&(o=t.Value[c],n.get_MultipleMiddles().Contains$$T(c)?(o.set_LeftAnchor(function(n){return o.set_RightAnchor(n),n}(Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.get_VirtualNodeWidth()*4)),o.set_TopAnchor(function(n){return o.set_BottomAnchor(n),n}(Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.VirtualNodeHeight(f)/2))):(o.set_LeftAnchor(function(n){return o.set_RightAnchor(n),n}(Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.get_VirtualNodeWidth()/2)),o.set_TopAnchor(function(n){return o.set_BottomAnchor(n),n}(Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.VirtualNodeHeight(f)/2))));if(e.get_HasLabel()){var p=e.get_LayerEdges().get_Item$$Int32(e.get_LayerEdges().get_Count()/2|0).get_Source(),h=t.Value[p],w=e.get_LabelWidth(),y=e.get_LabelHeight();h.set_RightAnchor(w);h.set_LeftAnchor(Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.get_VirtualNodeWidth()*8);h.get_TopAnchor()<y/2&&h.set_TopAnchor(function(n){return h.set_BottomAnchor(n),n}(y/2));h.set_LabelToTheRightOfAnchorCenter(!0)}}},CalcInitialYAnchorLocations:function(n,t,i,r,u,f,e){for(var h,a,v,y,rt,l=r.get_Anchors(),p=i.get_Margins()+t,nt=0,w=0,tt=n.get_Layers(),ut=tt.length,o=tt[w];w<ut;w++,o=tt[w]){h=0;a=0;for(var b=0,ft=o.length,s=o[b];b<ft;b++,s=o[b])v=l[s],v.get_BottomAnchor()>h&&(h=v.get_BottomAnchor()),v.get_TopAnchor()>a&&(a=v.get_TopAnchor());Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.MakeVirtualNodesTall(o,h,a,i.get_Nodes().get_Count(),r.get_Anchors());var et=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.SetFlatEdgesForLayer(r,n,nt,u,f,p),it=p+h+et,c=it+a;if(Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.NeedToSnapTopsToGrid(f)){c+=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.SnapDeltaUp(c,f.get_GridSizeByY());for(var k=0,ot=o.length,s=o[k];k<ot;k++,s=o[k])l[s].set_Top(c)}else if(Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.NeedToSnapBottomsToGrid(f)){y=it-h;y+=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.SnapDeltaUp(y,y);for(var d=0,st=o.length,s=o[d];d<st;d++,s=o[d])l[s].set_Bottom(y),c=System.Math.Max$$Double$$Double(l[s].get_Top(),c)}else for(var g=0,ht=o.length,s=o[g];g<ht;g++,s=o[g])l[s].set_Y(it);rt=f.ActualLayerSeparation(e);p=c+rt;nt++}Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.SetFlatEdgesForLayer(r,n,nt,u,f,p)},NeedToSnapTopsToGrid:function(n){return n.get_SnapToGridByY()==Microsoft.Msagl.Layout.Layered.SnapToGridByY.Top},NeedToSnapBottomsToGrid:function(n){return n.get_SnapToGridByY()==Microsoft.Msagl.Layout.Layered.SnapToGridByY.Bottom},SnapDeltaUp:function(n,t){if(t==0)return 0;var r=n/t|0,i=n-r*t;return(System.Diagnostics.Debug.Assert$$Boolean(i>=0&&i<t),System.Math.Abs$$Double(i)<.0001)?0:t-i},SetFlatEdgesForLayer:function(n,t,i,r,u,f){var o=0,e,s,h;return i>0&&(e=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.GetFlatPairs(t.get_Layers()[i-1],t.Y,r),System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,e)&&(s=u.get_LayerSeparation()/3,h=f,o=System.Linq.Enumerable.Max$$IEnumerable$1$Double(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Double.ctor,e,function(t){return Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.SetFlatEdgesLabelsHeightAndPositionts(t,h,s,n)})))),o},GetLayoutDirection:function(n){var t=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n.get_Transformation(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,1));return t.get_CompassDirection()},SetFlatEdgesLabelsHeightAndPositionts:function(n,t,i,r){for(var f=0,s=r.GetMultiedge$$IntPair(n),e=s.GetEnumerator(),o,u;e.MoveNext();)o=e.get_Current(),f+=i,u=o.get_Edge().get_Label(),u!=null&&(u.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u.get_Center().get_X(),t+f+u.get_Height()/2)),f+=u.get_Height());return f},GetFlatPairs:function(n,t,i){return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.SelectMany$3$$IEnumerable$1$$Func$2$$Func$3(System.Int32.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,null,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Int32.ctor,n,function(n){return n<i.get_NodeCount()}),function(n){return i.OutEdges(n)},function(n,t){return $CreateAnonymousObject({v:n,edge:t})}),function(n){return t[n.get_edge().get_Source()]==t[n.get_edge().get_Target()]}),function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_edge().get_Source(),n.get_edge().get_Target())}))},MakeVirtualNodesTall:function(n,t,i,r,u){var o;if(Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.LayerIsOriginal(n,r))for(var f=0,s=n.length,e=n[f];f<s;f++,e=n[f])e>=r&&(o=u[e],o.set_BottomAnchor(t),o.set_TopAnchor(i))},LayerIsOriginal:function(n,t){for(var i=0,u=n.length,r=n[i];i<u;i++,r=n[i])if(r<t)return!0;return!1},CalcAnchorsForOriginalNode:function(n,t,i,r,u){var s=0,e=s,f=0,o=f,l,h,c;t.get_Nodes()!=null&&(l=t.get_Nodes().get_Item$$Int32(n),function(){var n={Value:s},t={Value:e},i={Value:f},r={Value:o},h=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.ExtendStandardAnchors(n,t,i,r,l,u);return s=n.Value,e=t.Value,f=i.Value,o=r.Value,h}()),function(){var t={Value:e},i={Value:f},s={Value:o},h=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.RightAnchorMultiSelfEdges(n,t,i,s,r,u);return e=t.Value,f=i.Value,o=s.Value,h}();h=u.get_MinNodeWidth()/2;s<h&&(s=h);e<h&&(e=h);c=u.get_MinNodeHeight()/2;f<c&&(f=c);o<c&&(o=c);i[n]=function(){var i=new Microsoft.Msagl.Layout.Layered.Anchor.ctor$$Double$$Double$$Double$$Double$$Node$$Double(s,e,f,o,t.get_Nodes().get_Item$$Int32(n),u.get_LabelCornersPreserveCoefficient());return i.set_Padding(t.get_Nodes().get_Item$$Int32(n).get_Padding()),i}()},RightAnchorMultiSelfEdges:function(n,t,i,r,u,f){var e=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.WidthOfSelfEdge(u,n,t,i,r,f);t.Value+=e},WidthOfSelfEdge:function(n,t,i,r,u,f){var h=0,o=n.GetMultiedge$$Int32$$Int32(t,t),s,e;if(o.get_Count()>0){for(s=o.GetEnumerator();s.MoveNext();)e=s.get_Current(),e.get_Edge().get_Label()!=null&&(i.Value+=e.get_Edge().get_Label().get_Width(),r.Value<e.get_Edge().get_Label().get_Height()/2&&(r.Value=u.Value=e.get_Edge().get_Label().get_Height()/2));h+=(f.get_NodeSeparation()+f.get_MinNodeWidth())*o.get_Count()}return h},ExtendStandardAnchors:function(n,t,i,r,u,f){var e=u.get_Width(),o=u.get_Height();e/=2;o/=2;t.Value=n.Value=e;i.Value=r.Value=o;f.get_GridSizeByX()>0&&(t.Value+=f.get_GridSizeByX()/2,n.Value+=f.get_GridSizeByX()/2)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$LayerArrays$$GeometryGraph$$ProperLayeredGraph$$SugiyamaLayoutSettings$$Database$$BasicGraph$2$Node$IntEdge$$Dictionary$2$Node$Int32$$BasicGraph$2$Node$IntEdge$$Boolean$$ConstrainedOrdering$$Boolean$$XLayoutGraph:function(n,t,i,r,u,f,e,o,s,h,c,l){this.engineLayerArrays=null;this.originalGraph=null;this.properLayeredGraph=null;this.sugiyamaSettings=null;this.database=null;this.IntGraph=null;this.xLayoutGraph=null;this.nodeIdToIndex=null;this.anchors=null;this.constrainedOrdering=null;this._Brandes=!1;this._GluedDagSkeletonForLayering=null;this._LayersAreDoubled=!1;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.engineLayerArrays=n;this.originalGraph=t;this.properLayeredGraph=i;this.sugiyamaSettings=r;this.database=u;this.IntGraph=f;this.nodeIdToIndex=e;this.set_GluedDagSkeletonForLayering(o);this.set_LayersAreDoubled(s);this.constrainedOrdering=h;this.set_Brandes(c);this.anchors=u.anchors;this.xLayoutGraph=l},Brandes$$:"System.Boolean",get_Brandes:function(){return this._Brandes},set_Brandes:function(n){this._Brandes=n},Database$$:"Microsoft.Msagl.Layout.Layered.Database",get_Database:function(){return this.database},set_Database:function(n){this.database=n},GluedDagSkeletonForLayering$$:"Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph`2[[Microsoft.Msagl.Core.Layout.Node],[Microsoft.Msagl.Layout.Layered.IntEdge]]",get_GluedDagSkeletonForLayering:function(){return this._GluedDagSkeletonForLayering},set_GluedDagSkeletonForLayering:function(n){this._GluedDagSkeletonForLayering=n},ctor$$GeometryGraph$$BasicGraph$2$Node$IntEdge$$Dictionary$2$Node$Int32$$SugiyamaLayoutSettings:function(n,t,i,r){var u,f;if(this.engineLayerArrays=null,this.originalGraph=null,this.properLayeredGraph=null,this.sugiyamaSettings=null,this.database=null,this.IntGraph=null,this.xLayoutGraph=null,this.nodeIdToIndex=null,this.anchors=null,this.constrainedOrdering=null,this._Brandes=!1,this._GluedDagSkeletonForLayering=null,this._LayersAreDoubled=!1,Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this),n!=null){for(this.originalGraph=n,this.sugiyamaSettings=r,this.IntGraph=t,this.set_Database(new Microsoft.Msagl.Layout.Layered.Database.ctor),this.nodeIdToIndex=i,u=t.get_Edges().GetEnumerator();u.MoveNext();)f=u.get_Current(),this.database.RegisterOriginalEdgeInMultiedges(f);this.CycleRemoval()}},ctor$$GeometryGraph$$SugiyamaLayoutSettings:function(n,t){var o,i,a,r,v;if(this.engineLayerArrays=null,this.originalGraph=null,this.properLayeredGraph=null,this.sugiyamaSettings=null,this.database=null,this.IntGraph=null,this.xLayoutGraph=null,this.nodeIdToIndex=null,this.anchors=null,this.constrainedOrdering=null,this._Brandes=!1,this._GluedDagSkeletonForLayering=null,this._LayersAreDoubled=!1,Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this),n!=null){this.nodeIdToIndex=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Int32.ctor);for(var u=n.get_Nodes(),f=0,e=u.GetEnumerator();e.MoveNext();)o=e.get_Current(),this.nodeIdToIndex.set_Item$$TKey(o,f),f++;for(var s=n.get_Edges(),h=new Array(s.get_Count()),c=0,l=s.GetEnumerator();l.MoveNext();){if(i=l.get_Current(),i.get_Source()==null||i.get_Target()==null)throw $CreateException(new System.InvalidOperationException.ctor,new Error);a=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32$$Edge(this.nodeIdToIndex.get_Item$$TKey(i.get_Source()),this.nodeIdToIndex.get_Item$$TKey(i.get_Target()),i);h[c]=a;c++}for(this.IntGraph=function(){var t=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$2.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,h,n.get_Nodes().get_Count());return t.set_Nodes(u),t}.call(this),this.originalGraph=n,this.sugiyamaSettings=t,this.set_Database(new Microsoft.Msagl.Layout.Layered.Database.ctor),r=this.IntGraph.get_Edges().GetEnumerator();r.MoveNext();)v=r.get_Current(),this.database.RegisterOriginalEdgeInMultiedges(v);this.CycleRemoval()}},CreateGluedDagSkeletonForLayering:function(){this.set_GluedDagSkeletonForLayering(new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$2.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.GluedDagSkeletonEdges(),this.originalGraph.get_Nodes().get_Count()));this.SetGluedEdgesWeights()},SetGluedEdgesWeights:function(){for(var e=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor),o=this.get_GluedDagSkeletonForLayering().get_Edges().GetEnumerator(),r,t,i,u,f,n;o.MoveNext();)n=o.get_Current(),e.set_Item$$TKey(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Source(),n.get_Target()),n);for(r=this.database.get_Multiedges().GetEnumerator();r.MoveNext();)if(t=r.get_Current(),t.get_Key().x!=t.get_Key().y){if(i=this.get_VerticalConstraints().GluedIntPair$$IntPair(t.get_Key()),i.x==i.y)continue;for(u=e.get_Item$$TKey(i),f=t.get_Value().GetEnumerator();f.MoveNext();)n=f.get_Current(),u.set_Weight(u.get_Weight()+n.get_Weight())}},GluedDagSkeletonEdges:function(){for(var n=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,null,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,this.database.get_Multiedges(),$CreateAnonymousDelegate(this,function(n){return n.get_Key().x!=n.get_Key().y})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({kv:n,e:this.get_VerticalConstraints().GluedIntEdge(n.get_Value().get_Item$$Int32(0))})})),$CreateAnonymousDelegate(this,function(n){return n.get_e().get_Source()!=n.get_e().get_Target()})),$CreateAnonymousDelegate(this,function(n){return n.get_e()}))),r=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.get_VerticalConstraints().get_GluedUpDownIntConstraints(),$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.CreateUpDownConstrainedIntEdge(n)})),t=r.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.Insert(i);return n},RunInternal:function(){this.originalGraph.get_Nodes().get_Count()>0?(this.engineLayerArrays=this.CalculateLayers(),this.sugiyamaSettings.get_LayeringOnly()||this.RunPostLayering()):this.originalGraph.boundingBox.SetToEmpty()},RunPostLayering:function(){var t=this.sugiyamaSettings.get_EdgeRoutingSettings(),u=t.get_EdgeRoutingMode(),f,e,i;this.constrainedOrdering!=null&&(u=Microsoft.Msagl.Core.Routing.EdgeRoutingMode.Spline);switch(u){case Microsoft.Msagl.Core.Routing.EdgeRoutingMode.SugiyamaSplines:this.CalculateEdgeSplines();break;case Microsoft.Msagl.Core.Routing.EdgeRoutingMode.StraightLine:Microsoft.Msagl.Routing.StraightLineEdges.SetStraightLineEdgesWithUnderlyingPolylines(this.originalGraph);this.SetLabels();break;case Microsoft.Msagl.Core.Routing.EdgeRoutingMode.Spline:var n=this.sugiyamaSettings.get_NodeSeparation()/4,r=Microsoft.Msagl.Routing.SplineRouter.ComputeLooseSplinePadding(this.sugiyamaSettings.get_NodeSeparation(),n),o=new Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$Double$$Double$$Double$$BundlingSettings(this.originalGraph,n,r,.523598775598299,null);o.Run();this.SetLabels();break;case Microsoft.Msagl.Core.Routing.EdgeRoutingMode.SplineBundling:f=t.get_ConeAngle();n=this.sugiyamaSettings.get_NodeSeparation()/20;r=Microsoft.Msagl.Routing.SplineRouter.ComputeLooseSplinePadding(this.sugiyamaSettings.get_NodeSeparation(),n)*2;this.sugiyamaSettings.get_EdgeRoutingSettings().get_BundlingSettings()==null&&this.sugiyamaSettings.get_EdgeRoutingSettings().set_BundlingSettings(new Microsoft.Msagl.Core.Routing.BundlingSettings.ctor);e=new Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$Double$$Double$$Double$$BundlingSettings(this.originalGraph,n,r,f,this.sugiyamaSettings.get_EdgeRoutingSettings().get_BundlingSettings());e.Run();this.SetLabels();break;case Microsoft.Msagl.Core.Routing.EdgeRoutingMode.Rectilinear:case Microsoft.Msagl.Core.Routing.EdgeRoutingMode.RectilinearToCenter:i=new Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.ctor$$GeometryGraph$$Double$$Double$$Boolean$$Boolean(this.originalGraph,this.sugiyamaSettings.get_NodeSeparation()/3,this.sugiyamaSettings.get_NodeSeparation()/4,!0,this.sugiyamaSettings.get_EdgeRoutingSettings().get_UseObstacleRectangles());i.set_RouteToCenterOfObstacles(t.get_EdgeRoutingMode()==Microsoft.Msagl.Core.Routing.EdgeRoutingMode.RectilinearToCenter);i.set_BendPenaltyAsAPercentageOfDistance(t.get_BendPenalty());i.Run();this.SetLabels()}this.originalGraph.set_BoundingBox(this.originalGraph.PumpTheBoxToTheGraphWithMargins())},SetLabels:function(){var n=new Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.ctor$$GeometryGraph(this.originalGraph);n.Run()},IncrementalRun:function(n){this.PushLayers(n);this.RunPostLayering()},PushLayers:function(n){var r=System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,System.Linq.Enumerable.TakeWhile$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,this.IntGraph.get_Nodes(),$CreateAnonymousDelegate(this,function(t){return n!=t}))),t=this.anchors[r],o=.5*(n.get_BoundaryCurve().get_BoundingBox().get_Width()-t.get_Width()),u=.5*(n.get_BoundaryCurve().get_BoundingBox().get_Height()-t.get_Height()),i,f,e;for(t.set_RightAnchor(t.get_RightAnchor()+o),t.set_LeftAnchor(t.get_LeftAnchor()+o),t.set_TopAnchor(t.get_TopAnchor()+u),t.set_BottomAnchor(t.get_BottomAnchor()+u),t.set_Node(n),this.PushDownLowerLayers(u,r),this.PushUpUpperLayers(u,r),this.xLayoutGraph!=null?(this.FixEdgeSeparation(r),this.CalculateXLayersByGansnerNorthOnProperLayeredGraph()):this.CalculateXPositionsByBrandes(this.engineLayerArrays),i=0;i<this.IntGraph.get_NodeCount();i++)f=this.IntGraph.get_Nodes().get_Item$$Int32(i),e=this.anchors[i],f.set_Center(e.get_Origin()),e.set_Node(f)},FixEdgeSeparation:function(n){var h=this.engineLayerArrays.Y[n],r=this.engineLayerArrays.get_Layers()[h],i=this.engineLayerArrays.get_X()[n],s=this.anchors[n],u,f,e,o,t;if(i>0)for(u=r[i-1],f=this.xLayoutGraph.OutEdges(n).GetEnumerator();f.MoveNext();)if(t=f.get_Current(),t.get_Target()==u){t.set_Separation(this.sugiyamaSettings.get_NodeSeparation()+s.get_LeftAnchor()+this.anchors[u].get_RightAnchor()+1|0);break}if(i<r.length-1)for(e=r[i+1],o=this.xLayoutGraph.InEdges(n).GetEnumerator();o.MoveNext();)if(t=o.get_Current(),t.get_Source()==e){t.set_Separation(this.sugiyamaSettings.get_NodeSeparation()+s.get_RightAnchor()+this.anchors[e].get_LeftAnchor()+1|0);break}},MoveNode:function(n,t){if(t<this.IntGraph.get_Nodes().get_Count()){var i=this.IntGraph.get_Nodes().get_Item$$Int32(t);i.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Center(),n));this.anchors[t].set_Node(i)}},PushUpUpperLayers:function(n,t){for(var i,e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,n),o=this.engineLayerArrays.Y[t],u=o+1;u<this.engineLayerArrays.get_Layers().length;u++){i=this.engineLayerArrays.get_Layers()[u];for(var r=0,s=i.length,f=i[r];r<s;r++,f=i[r])this.MoveNode(e,f),this.anchors[f].Move(e)}},PushDownLowerLayers:function(n,t){for(var i,e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,-n),o=this.engineLayerArrays.Y[t],u=0;u<o;u++){i=this.engineLayerArrays.get_Layers()[u];for(var r=0,s=i.length,f=i[r];r<s;r++,f=i[r])this.MoveNode(e,f),this.anchors[f].Move(e)}},CalculateLayers:function(){this.CreateGluedDagSkeletonForLayering();var n=this.CalculateLayerArrays();return this.UpdateNodePositionData(),n},UpdateNodePositionData:function(){var n;for(this.TryToSatisfyMinWidhtAndMinHeight(),n=0;n<this.IntGraph.get_Nodes().get_Count()&&n<this.database.get_Anchors().length;n++)this.IntGraph.get_Nodes().get_Item$$Int32(n).set_Center(this.database.get_Anchors()[n].get_Origin());if(this.sugiyamaSettings.get_GridSizeByX()>0)for(n=0;n<this.originalGraph.get_Nodes().get_Count();n++)this.SnapLeftSidesOfTheNodeToGrid(n,this.sugiyamaSettings.get_GridSizeByX())},SnapLeftSidesOfTheNodeToGrid:function(n,t){var i=this.IntGraph.get_Nodes().get_Item$$Int32(n),r=this.database.get_Anchors()[n];r.set_LeftAnchor(r.get_LeftAnchor()-t/2);r.set_RightAnchor(r.get_RightAnchor()-t/2);var f=i.get_BoundingBox().get_Left(),e=f/t|0,u=f-e*t;System.Math.Abs$$Double(u)<.001||(System.Math.Abs$$Double(u)<=t/2?i.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Center(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-u,0))):i.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Center(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t-u,0))),r.set_X(i.get_Center().get_X()))},TryToSatisfyMinWidhtAndMinHeight:function(){this.TryToSatisfyMinWidth();this.TryToSatisfyMinHeight()},TryToSatisfyMinWidth:function(){if(this.sugiyamaSettings.get_MinimalWidth()!=0){var n=this.GetCurrentWidth();n<this.sugiyamaSettings.get_MinimalWidth()&&this.StretchWidth()}},StretchWidth:function(){for(var i=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,s=this.originalGraph.get_Nodes().GetEnumerator(),r,n,u,h,f;s.MoveNext();)r=s.get_Current(),i.AddValue(r.get_BoundingBox().get_Width()/2),i.AddValue(this.sugiyamaSettings.get_MinimalWidth()-r.get_BoundingBox().get_Width()/2);for(n=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,u=this.NodeAnchors().GetEnumerator();u.MoveNext();)h=u.get_Current(),n.AddValue(h.get_X());if(n.get_Length()>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(f=i.get_Length()/n.get_Length(),f>1))for(var t=0,e=this.anchors,c=e.length,o=e[t];t<c;t++,o=e[t])o.set_X(o.get_X()*f)},TryToSatisfyMinHeight:function(){if(this.sugiyamaSettings.get_MinimalHeight()!=0){var n=this.GetCurrentHeight();n<this.sugiyamaSettings.get_MinimalHeight()&&this.StretchHeight()}},GetCurrentHeight:function(){for(var n=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,i=this.NodeAnchors().GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),n.AddValue(t.get_Top()),n.AddValue(t.get_Bottom());return n.get_Length()},StretchHeight:function(){for(var i=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,s=this.originalGraph.get_Nodes().GetEnumerator(),r,n,u,h,f;s.MoveNext();)r=s.get_Current(),i.AddValue(r.get_BoundingBox().get_Height()/2),i.AddValue(this.sugiyamaSettings.get_MinimalHeight()-r.get_BoundingBox().get_Height()/2);for(n=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,u=this.NodeAnchors().GetEnumerator();u.MoveNext();)h=u.get_Current(),n.AddValue(h.get_Y());if(n.get_Length()>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(f=i.get_Length()/n.get_Length(),f>1))for(var t=0,e=this.anchors,c=e.length,o=e[t];t<c;t++,o=e[t])o.set_Y(o.get_Y()*f)},NodeAnchors:function(){return System.Linq.Enumerable.Take$1(Microsoft.Msagl.Layout.Layered.Anchor.ctor,this.anchors,System.Math.Min$$Int32$$Int32(this.IntGraph.get_Nodes().get_Count(),this.anchors.length))},GetCurrentWidth:function(){for(var n=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,i=this.NodeAnchors().GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),n.AddValue(t.get_Left()),n.AddValue(t.get_Right());return n.get_Length()},StretchToDesiredAspectRatio:function(n,t){n>t?this.StretchInYDirection(n/t):n<t&&this.StretchInXDirection(t/n)},StretchInYDirection:function(n){for(var f,i=(this.originalGraph.get_BoundingBox().get_Top()+this.originalGraph.get_BoundingBox().get_Bottom())/2,r=0,u=this.get_Database().get_Anchors(),e=u.length,t=u[r];r<e;r++,t=u[r])t.set_BottomAnchor(t.get_BottomAnchor()*n),t.set_TopAnchor(t.get_TopAnchor()*n),t.set_Y(i+n*(t.get_Y()-i));f=this.originalGraph.get_Height()*n;this.originalGraph.set_BoundingBox(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(this.originalGraph.get_BoundingBox().get_Left(),i+f/2,this.originalGraph.get_BoundingBox().get_Right(),i-f/2))},StretchInXDirection:function(n){for(var f,i=(this.originalGraph.get_BoundingBox().get_Left()+this.originalGraph.get_BoundingBox().get_Right())/2,r=0,u=this.get_Database().get_Anchors(),e=u.length,t=u[r];r<e;r++,t=u[r])t.set_LeftAnchor(t.get_LeftAnchor()*n),t.set_RightAnchor(t.get_RightAnchor()*n),t.set_X(i+n*(t.get_X()-i));f=this.originalGraph.get_Width()*n;this.originalGraph.set_BoundingBox(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(i-f/2,this.originalGraph.get_BoundingBox().get_Top(),i+f/2,this.originalGraph.get_BoundingBox().get_Bottom()))},CalculateLayerArrays:function(){var n=this.CalculateYLayers(),t;return this.constrainedOrdering==null?(this.DecideIfUsingFastXCoordCalculation(n),this.CalculateAnchorsAndYPositions(n),this.get_Brandes()?this.CalculateXPositionsByBrandes(n):this.CalculateXLayersByGansnerNorth(n)):this.anchors=this.database.get_Anchors(),this.OptimizeEdgeLabelsLocations(),this.engineLayerArrays=n,this.StraightensShortEdges(),function(){var n={Value:t},i=this.CalculateOriginalGraphBox(n);return t=n.Value,i}.call(this),this.sugiyamaSettings.get_AspectRatio()!=0&&this.StretchToDesiredAspectRatio(t,this.sugiyamaSettings.get_AspectRatio()),n},DecideIfUsingFastXCoordCalculation:function(n){n.get_X().length>=this.sugiyamaSettings.get_BrandesThreshold()&&this.set_Brandes(!0)},StraightensShortEdges:function(){for(;this.StraightenEdgePaths(););},StraightenEdgePaths:function(){for(var t=!1,i=this.database.get_AllIntEdges().GetEnumerator(),n;i.MoveNext();)n=i.get_Current(),n.get_LayerSpan()==2&&(t=this.ShiftVertexWithNeighbors(n.get_LayerEdges().get_Item$$Int32(0).get_Source(),n.get_LayerEdges().get_Item$$Int32(0).get_Target(),n.get_LayerEdges().get_Item$$Int32(1).get_Target())||t);return t},ShiftVertexWithNeighbors:function(n,t,i){var r=this.database.get_Anchors()[n],e=this.database.get_Anchors()[i],f=this.database.get_Anchors()[t],u=(f.get_Y()-r.get_Y())*(e.get_X()-r.get_X())/(e.get_Y()-r.get_Y())+r.get_X(),o=.0001;return u>f.get_X()+o?this.TryShiftToTheRight(u,t):u<f.get_X()-o?this.TryShiftToTheLeft(u,t):!1},TryShiftToTheLeft:function(n,t){var f=this.engineLayerArrays.get_Layers()[this.engineLayerArrays.Y[t]],r=this.engineLayerArrays.get_X()[t],u,i;return r>0?(u=this.database.get_Anchors()[f[r-1]],i=System.Math.Max$$Double$$Double(u.get_Right()+this.sugiyamaSettings.get_NodeSeparation()+this.database.get_Anchors()[t].get_LeftAnchor(),n),i<this.database.get_Anchors()[t].get_X()-1)?(this.database.get_Anchors()[t].set_X(i),!0):!1:(this.database.get_Anchors()[t].set_X(n),!0)},TryShiftToTheRight:function(n,t){var r=this.engineLayerArrays.get_Layers()[this.engineLayerArrays.Y[t]],u=this.engineLayerArrays.get_X()[t],f,i;return u<r.length-1?(f=this.database.get_Anchors()[r[u+1]],i=System.Math.Min$$Double$$Double(f.get_Left()-this.sugiyamaSettings.get_NodeSeparation()-this.database.get_Anchors()[t].get_RightAnchor(),n),i>this.database.get_Anchors()[t].get_X()+1)?(this.database.get_Anchors()[t].set_X(i),!0):!1:(this.database.get_Anchors()[t].set_X(n),!0)},CalculateYLayers:function(){var n=this.YLayeringAndOrdering(new Microsoft.Msagl.Layout.Layered.NetworkSimplexForGeneralGraph.ctor(this.get_GluedDagSkeletonForLayering(),this.get_CancelToken()));return this.constrainedOrdering!=null?n:this.InsertLayersIfNeeded(n)},VerticalConstraints$$:"Microsoft.Msagl.Layout.Layered.VerticalConstraintsForSugiyama",get_VerticalConstraints:function(){return this.sugiyamaSettings.get_VerticalConstraints()},HorizontalConstraints$$:"Microsoft.Msagl.Layout.Layered.HorizontalConstraintsForSugiyama",get_HorizontalConstraints:function(){return this.sugiyamaSettings.get_HorizontalConstraints()},CalculateAnchorsAndYPositions:function(n){(function(){var n={Value:this.anchors},t=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.CalculateAnchorSizes(this.database,n,this.properLayeredGraph,this.originalGraph,this.IntGraph,this.sugiyamaSettings);return this.anchors=n.Value,t}).call(this);Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.CalcInitialYAnchorLocations(n,500,this.originalGraph,this.database,this.IntGraph,this.sugiyamaSettings,this.get_LayersAreDoubled())},OptimizeEdgeLabelsLocations:function(){for(var n,i,r,t=0;t<this.anchors.length;t++)if(n=this.anchors[t],n.get_LabelToTheRightOfAnchorCenter()&&(function(){var n={Value:i},u={Value:r},f=this.GetSuccessorAndPredecessor(t,n,u);return i=n.Value,r=u.Value,f}.call(this),!Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.TryToPutLabelOutsideOfAngle(n,i,r))){var f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Origin(),n.get_Origin()).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r.get_Origin(),n.get_Origin()).get_Length(),e=n.get_Right()-n.get_LeftAnchor(),u=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,n.get_Y()),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Origin(),u).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r.get_Origin(),u).get_Length();o<f&&Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.PutLabelToTheLeft(n)}},GetSuccessorAndPredecessor:function(n,t,i){for(var e=10,o=this.properLayeredGraph.InEdges(n).GetEnumerator(),u,f,r;o.MoveNext();)r=o.get_Current(),e=r.get_Source();for(u=10,f=this.properLayeredGraph.OutEdges(n).GetEnumerator();f.MoveNext();)r=f.get_Current(),u=r.get_Target();t.Value=this.anchors[e];i.Value=this.anchors[u]},CycleRemoval:function(){var n=this.sugiyamaSettings.get_VerticalConstraints(),t=n.get_IsEmpty()?Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval$1.GetFeedbackSet(this.IntGraph):n.GetFeedbackSet$$BasicGraph$2$Node$IntEdge$$Dictionary$2$Node$Int32(this.IntGraph,this.nodeIdToIndex);this.database.AddFeedbackSet(t)},CalculateXLayersByGansnerNorth:function(n){this.xLayoutGraph=this.CreateXLayoutGraph(n);this.CalculateXLayersByGansnerNorthOnProperLayeredGraph()},CalculateXLayersByGansnerNorthOnProperLayeredGraph:function(){for(var t=new Microsoft.Msagl.Layout.Layered.NetworkSimplex.ctor(this.xLayoutGraph,null).GetLayers(),n=0;n<this.database.get_Anchors().length;n++)this.anchors[n].set_X(t[n])},CreaeteProperLayeredGraph:function(n,t){for(var p=n.length,s=0,v=this.database.SkeletonEdges().GetEnumerator(),u,o,f,h,r,e,c,i,l,a,y;v.MoveNext();)if(i=v.get_Current(),u=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.EdgeSpan(n,i),System.Diagnostics.Debug.Assert$$Boolean(u>=0),u>0&&i.set_LayerEdges(new Array(u)),o=0,u>1){for(f=p+s++,r=new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32$$Int32(i.get_Source(),f,i.get_CrossingWeight(),i.get_Weight()),i.get_LayerEdges().set_Item$$Int32(o++,r),h=0;h<u-2;h++)f++,s++,r=new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32$$Int32(f-1,f,i.get_CrossingWeight(),i.get_Weight()),i.get_LayerEdges().set_Item$$Int32(o++,r);r=new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32$$Int32(f,i.get_Target(),i.get_CrossingWeight(),i.get_Weight());i.get_LayerEdges().set_Item$$Int32(o,r)}else u==1&&(r=new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32$$Int32(i.get_Source(),i.get_Target(),i.get_CrossingWeight(),i.get_Weight()),i.get_LayerEdges().set_Item$$Int32(o,r));for(e=new Int32Array(this.originalGraph.get_Nodes().get_Count()+s),c=this.database.SkeletonEdges().GetEnumerator();c.MoveNext();)if(i=c.get_Current(),i.get_LayerEdges()!=null)for(l=n[i.get_Source()],e[i.get_Source()]=l--,a=i.get_LayerEdges().GetEnumerator();a.MoveNext();)y=a.get_Current(),e[y.get_Target()]=l--;else e[i.get_Source()]=n[i.get_Source()],e[i.get_Target()]=n[i.get_Target()];this.properLayeredGraph=new Microsoft.Msagl.Layout.Layered.ProperLayeredGraph.ctor(new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$2.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.database.SkeletonEdges(),n.length));this.properLayeredGraph.BaseGraph.set_Nodes(this.IntGraph.get_Nodes());t.Value=new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(e)},YLayeringAndOrdering:function(n){var t=n.GetLayers(),i;return(Microsoft.Msagl.Layout.Layered.Balancing.Balance(this.get_GluedDagSkeletonForLayering(),t,this.GetNodeCountsOfGluedDag(),null),t=this.ExtendLayeringToUngluedSameLayerVertices(t),i=new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(t),this.get_HorizontalConstraints()==null||this.get_HorizontalConstraints().get_IsEmpty())?this.YLayeringAndOrderingWithoutHorizontalConstraints(i):(this.constrainedOrdering=new Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.ctor(this.originalGraph,this.IntGraph,i.Y,this.nodeIdToIndex,this.database,this.sugiyamaSettings),this.constrainedOrdering.Calculate(),this.properLayeredGraph=this.constrainedOrdering.ProperLayeredGraph,this.constrainedOrdering.LayerArrays)},YLayeringAndOrderingWithoutHorizontalConstraints:function(n){return function(){var t={Value:n},i=this.CreaeteProperLayeredGraph(n.Y,t);return n=t.Value,i}.call(this),Microsoft.Msagl.Layout.Layered.Ordering.OrderLayers(this.properLayeredGraph,n,this.originalGraph.get_Nodes().get_Count(),this.sugiyamaSettings.get_AspectRatio()!=0,this.sugiyamaSettings,this.get_CancelToken()),Microsoft.Msagl.Layout.Layered.MetroMapOrdering.UpdateLayerArrays$$ProperLayeredGraph$$LayerArrays(this.properLayeredGraph,n),n},CalculateXPositionsByBrandes:function(n){Microsoft.Msagl.Layout.Layered.XCoordsWithAlignment.CalculateXCoordinates(n,this.properLayeredGraph,this.originalGraph.get_Nodes().get_Count(),this.database.get_Anchors(),this.sugiyamaSettings.get_NodeSeparation())},CalculateOriginalGraphBox:function(n){var t,i,r,u,f;if(n.Value=0,this.anchors.length>0){for(t=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(this.anchors[0].get_Left(),this.anchors[0].get_Top(),this.anchors[0].get_Right(),this.anchors[0].get_Bottom()),i=1;i<this.anchors.length;i++)r=this.anchors[i],t.Add$$Point(r.get_LeftTop()),t.Add$$Point(r.get_RightBottom());n.Value=t.get_Width()/t.get_Height();u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_LeftTop(),t.get_RightBottom()).get_Length()/2;f=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-u,u);t.Add$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_LeftTop(),f));t.Add$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_RightBottom(),f));this.originalGraph.set_BoundingBox(t)}},InsertLayersIfNeeded:function(n){var t=!1,i=!1;return this.InsertVirtualEdgesIfNeeded(n),function(){var r={Value:t},u={Value:i},f=this.AnalyzeNeedToInsertLayersAndHasMultiedges(n,r,u);return t=r.Value,i=u.Value,f}.call(this),t?(function(){var t={Value:this.properLayeredGraph},i={Value:n},r=Microsoft.Msagl.Layout.Layered.LayerInserter.InsertLayers$$ProperLayeredGraph$$LayerArrays$$Database$$BasicGraph$2$Node$IntEdge(t,i,this.database,this.IntGraph);return this.properLayeredGraph=t.Value,n=i.Value,r}.call(this),this.set_LayersAreDoubled(!0)):i&&function(){var t={Value:this.properLayeredGraph},i={Value:n},r=Microsoft.Msagl.Layout.Layered.EdgePathsInserter.InsertPaths$$ProperLayeredGraph$$LayerArrays$$Database$$BasicGraph$2$Node$IntEdge(t,i,this.database,this.IntGraph);return this.properLayeredGraph=t.Value,n=i.Value,r}.call(this),this.RecreateIntGraphFromDataBase(),n},LayersAreDoubled$$:"System.Boolean",get_LayersAreDoubled:function(){return this._LayersAreDoubled},set_LayersAreDoubled:function(n){this._LayersAreDoubled=n},RecreateIntGraphFromDataBase:function(){for(var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Layered.IntEdge.ctor),t=this.database.get_Multiedges().get_Values().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.AddRange(i);this.IntGraph.SetEdges(n,this.IntGraph.get_NodeCount())},AnalyzeNeedToInsertLayersAndHasMultiedges:function(n,t,i){for(var e=this.IntGraph.get_Edges().GetEnumerator(),r,f,u;e.MoveNext();)if(r=e.get_Current(),r.get_HasLabel()&&n.Y[r.get_Source()]!=n.Y[r.get_Target()]){t.Value=!0;break}if(t.Value==!1&&this.constrainedOrdering==null)for(f=this.database.get_Multiedges().GetEnumerator();f.MoveNext();)if(u=f.get_Current(),u.get_Value().get_Count()>1&&(i.Value=!0,n.Y[u.get_Key().x]-n.Y[u.get_Key().y]==1)){t.Value=!0;break}},InsertVirtualEdgesIfNeeded:function(n){var r,t,i;if(this.constrainedOrdering==null)for(r=this.database.get_Multiedges().GetEnumerator();r.MoveNext();)t=r.get_Current(),t.get_Value().get_Count()%2==0&&n.Y[t.get_Key().get_First()]-1==n.Y[t.get_Key().get_Second()]&&(i=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(t.get_Key().get_First(),t.get_Key().get_Second()),i.set_Edge(new Microsoft.Msagl.Core.Layout.Edge.ctor),i.set_IsVirtualEdge(!0),t.get_Value().Insert(t.get_Value().get_Count()/2|0,i),this.IntGraph.AddEdge(i))},GetNodeCountsOfGluedDag:function(){var n,t;if(this.get_VerticalConstraints().get_IsEmpty()){for(n=new Int32Array(this.IntGraph.get_NodeCount()),t=0;t<n.length;t++)n[t]=1;return n}return this.get_VerticalConstraints().GetGluedNodeCounts()},ExtendLayeringToUngluedSameLayerVertices:function(n){for(var i=this.get_VerticalConstraints(),t=0;t<n.length;t++)n[t]=n[i.NodeToRepr(t)];return n},CalculateEdgeSplines:function(){var n=new Microsoft.Msagl.Layout.Layered.Routing.ctor(this.sugiyamaSettings,this.originalGraph,this.database,this.engineLayerArrays,this.properLayeredGraph,this.IntGraph);n.Run()},CalculateApproximateDimensions:function(){var s,t,f,e,h,n;this.CreateGluedDagSkeletonForLayering();var l=new Microsoft.Msagl.Layout.Layered.NetworkSimplexForGeneralGraph.ctor(this.get_GluedDagSkeletonForLayering(),null),o=l.GetLayers(),i=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor),r,u,c=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.GetLayoutDirection(this.sugiyamaSettings);if(c==Microsoft.Msagl.Core.Geometry.Directions.North||c==Microsoft.Msagl.Core.Geometry.Directions.South){for(t=0;t<o.length;++t){var f=this.originalGraph.get_Nodes().get_Item$$Int32(t),n=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0),e=o[t];(function(){var t={Value:n},r=i.TryGetValue(e,t);return n=t.Value,r}).call(this);i.set_Item$$TKey(e,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(f.get_BoundingBox().get_Width()+n.get_X()+this.sugiyamaSettings.get_NodeSeparation(),System.Math.Max$$Double$$Double(f.get_BoundingBox().get_Height(),n.get_Y())))}for(r=0,u=this.sugiyamaSettings.get_LayerSeparation()*(i.get_Count()-1),s=i.get_Values().GetEnumerator();s.MoveNext();)n=s.get_Current(),r=System.Math.Max$$Double$$Double(n.get_X(),r),u+=n.get_Y()}else{for(t=0;t<o.length;++t)f=this.originalGraph.get_Nodes().get_Item$$Int32(t),e=o[t],function(){var t={Value:n},r=i.TryGetValue(e,t);return n=t.Value,r}.call(this),i.set_Item$$TKey(e,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Max$$Double$$Double(f.get_BoundingBox().get_Width(),n.get_X()),f.get_BoundingBox().get_Height()+n.get_Y()+this.sugiyamaSettings.get_NodeSeparation()));for(r=this.sugiyamaSettings.get_LayerSeparation()*(i.get_Count()-1),u=0,h=i.get_Values().GetEnumerator();h.MoveNext();)n=h.get_Current(),r+=n.get_X(),u=System.Math.Max$$Double$$Double(n.get_Y(),u)}return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r,u)},CreateXLayoutGraph:function(n){for(var i=this.properLayeredGraph.get_NodeCount(),r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Layered.IntEdge.ctor),l=this.properLayeredGraph.get_Edges().GetEnumerator(),t,c;l.MoveNext();){var e=l.get_Current(),o=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(i,e.get_Source()),s=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(i,e.get_Target());o.set_Weight(function(n){return s.set_Weight(n),n}.call(this,e.Weight));o.set_Separation(0);s.set_Separation(0);i++;r.Add(o);r.Add(s)}for(var u=0,h=n.get_Layers(),p=h.length,f=h[u];u<p;u++,f=h[u])for(t=f.length-1;t>0;t--){var a=f[t],v=f[t-1],y=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(a,v),w=this.database.get_Anchors()[a],b=this.database.get_Anchors()[v],k=w.get_LeftAnchor()+b.get_RightAnchor()+this.sugiyamaSettings.get_NodeSeparation();y.set_Separation(k+1|0);r.Add(y)}return c=new Microsoft.Msagl.Layout.Layered.XLayoutGraph.ctor(this.IntGraph,this.properLayeredGraph,n,r,i),c.SetEdgeWeights(),c},SugiyamaSettings$$:"Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings",get_SugiyamaSettings:function(){return this.sugiyamaSettings}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$LayeredLayoutEngine);Microsoft$Msagl$Layout$Layered$RecoveryLayerCalculator={fullname:"Microsoft.Msagl.Layout.Layered.RecoveryLayerCalculator",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.Layered.LayerCalculator"],Kind:"Class",definition:{ctor:function(n){this.layers=null;System.Object.ctor.call(this);this.layers=n},GetLayers:function(){return this.layers.Y}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$RecoveryLayerCalculator);Microsoft$Msagl$Layout$Layered$RecoveryLayeredLayoutEngine={fullname:"Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine",baseTypeName:"System.Object",staticDefinition:{VirtualNodeWidth$$:"System.Double",get_VirtualNodeWidth:function(){return 1},VirtualNodeHeight:function(n){return n.get_MinNodeHeight()*1.5/8},EdgeSpan:function(n,t){return n[t.get_Source()]-n[t.get_Target()]},CreateUpDownConstrainedIntEdge:function(n){var t=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(n.x,n.y);return t.set_Weight(0),t.set_Separation(1),t},TryToPutLabelOutsideOfAngle:function(n,t,i){if(n.get_LabelToTheRightOfAnchorCenter()){if(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Origin(),n.get_Origin(),i.get_Origin())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise)return!0;var r=n.get_LeftAnchor(),u=n.get_RightAnchor(),f=n.get_X();return(Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.PutLabelToTheLeft(n),Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Origin(),n.get_Origin(),i.get_Origin())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise)?!0:(n.set_X(f),n.set_LeftAnchor(r),n.set_RightAnchor(u),n.set_LabelToTheRightOfAnchorCenter(!0),n.set_LabelToTheLeftOfAnchorCenter(!1),!1)}return!1},PutLabelToTheLeft:function(n){var t=n.get_Right(),i=n.get_LeftAnchor();n.set_LeftAnchor(n.get_RightAnchor());n.set_RightAnchor(i);n.set_X(t-n.get_RightAnchor());n.set_LabelToTheLeftOfAnchorCenter(!0);n.set_LabelToTheRightOfAnchorCenter(!1)},CalculateAnchorSizes:function(n,t,i,r,u,f){var s,l,e,a,v,c,o;for(n.set_Anchors(t.Value=new Array(i.get_NodeCount())),s=0;s<t.Value.length;s++)t.Value[s]=new Microsoft.Msagl.Layout.Layered.Anchor.ctor$$Double(f.get_LabelCornersPreserveCoefficient());for(s=0;s<r.get_Nodes().get_Count();s++)Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.CalcAnchorsForOriginalNode(s,u,t.Value,n,f);for(l=n.get_AllIntEdges().GetEnumerator();l.MoveNext();)if(e=l.get_Current(),e.get_LayerEdges()!=null){for(a=e.get_LayerEdges().GetEnumerator();a.MoveNext();)v=a.get_Current(),c=v.get_Target(),c!=e.get_Target()&&(o=t.Value[c],n.get_MultipleMiddles().Contains$$T(c)?(o.set_LeftAnchor(function(n){return o.set_RightAnchor(n),n}(Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.get_VirtualNodeWidth()*4)),o.set_TopAnchor(function(n){return o.set_BottomAnchor(n),n}(Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.VirtualNodeHeight(f)/2))):(o.set_LeftAnchor(function(n){return o.set_RightAnchor(n),n}(Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.get_VirtualNodeWidth()/2)),o.set_TopAnchor(function(n){return o.set_BottomAnchor(n),n}(Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.VirtualNodeHeight(f)/2))));if(e.get_HasLabel()){var p=e.get_LayerEdges().get_Item$$Int32(e.get_LayerEdges().get_Count()/2|0).get_Source(),h=t.Value[p],w=e.get_LabelWidth(),y=e.get_LabelHeight();h.set_RightAnchor(w);h.set_LeftAnchor(Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.get_VirtualNodeWidth()*8);h.get_TopAnchor()<y/2&&h.set_TopAnchor(function(n){return h.set_BottomAnchor(n),n}(y/2));h.set_LabelToTheRightOfAnchorCenter(!0)}}},CalcInitialYAnchorLocations:function(n,t,i,r,u,f,e){for(var s,h,c,g,k,nt,d=r.get_Anchors(),l=i.get_Margins()+t,w=0,a=0,b=n.get_Layers(),tt=b.length,o=b[a];a<tt;a++,o=b[a]){s=0;h=0;for(var v=0,it=o.length,y=o[v];v<it;v++,y=o[v])c=d[y],c.get_BottomAnchor()>s&&(s=c.get_BottomAnchor()),c.get_TopAnchor()>h&&(h=c.get_TopAnchor());Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.MakeVirtualNodesHigh(o,s,h,i.get_Nodes().get_Count(),r.get_Anchors());g=Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.SetFlatEdgesForLayer(r,n,w,u,f,l);k=l+s+g;for(var p=0,rt=o.length,y=o[p];p<rt;p++,y=o[p])d[y].set_Y(k);nt=f.ActualLayerSeparation(e);l=k+h+nt;w++}Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.SetFlatEdgesForLayer(r,n,w,u,f,l)},SetFlatEdgesForLayer:function(n,t,i,r,u,f){var o=0,e,s,h;return i>0&&(e=Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.GetFlatPairs(t.get_Layers()[i-1],t.Y,r),System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,e)&&(s=u.get_LayerSeparation()/3,h=f,o=System.Linq.Enumerable.Max$$IEnumerable$1$Double(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Double.ctor,e,function(t){return Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.SetFlatEdgesLabelsHeightAndPositionts(t,h,s,n)})))),o},SetFlatEdgesLabelsHeightAndPositionts:function(n,t,i,r){for(var f=0,s=r.GetMultiedge$$IntPair(n),e=s.GetEnumerator(),o,u;e.MoveNext();)o=e.get_Current(),f+=i,u=o.get_Edge().get_Label(),u!=null&&(u.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u.get_Center().get_X(),t+f+u.get_Height()/2)),f+=u.get_Height());return f},GetFlatPairs:function(n,t,i){return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.SelectMany$3$$IEnumerable$1$$Func$2$$Func$3(System.Int32.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,null,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Int32.ctor,n,function(n){return n<i.get_NodeCount()}),function(n){return i.OutEdges(n)},function(n,t){return $CreateAnonymousObject({v:n,edge:t})}),function(n){return t[n.get_edge().get_Source()]==t[n.get_edge().get_Target()]}),function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_edge().get_Source(),n.get_edge().get_Target())}))},MakeVirtualNodesHigh:function(n,t,i,r,u){var o;if(Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.LayerIsOriginal(n,r))for(var f=0,s=n.length,e=n[f];f<s;f++,e=n[f])e>=r&&(o=u[e],o.set_BottomAnchor(t),o.set_TopAnchor(i))},LayerIsOriginal:function(n,t){for(var i=0,u=n.length,r=n[i];i<u;i++,r=n[i])if(r<t)return!0;return!1},CalcAnchorsForOriginalNode:function(n,t,i,r,u){var s=0,e=s,f=0,o=f,l,h,c;t.get_Nodes()!=null&&(l=t.get_Nodes().get_Item$$Int32(n),function(){var n={Value:s},t={Value:e},i={Value:f},r={Value:o},u=Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.ExtendStandardAnchors(n,t,i,r,l);return s=n.Value,e=t.Value,f=i.Value,o=r.Value,u}()),function(){var t={Value:e},i={Value:f},s={Value:o},h=Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.RightAnchorMultiSelfEdges(n,t,i,s,r,u);return e=t.Value,f=i.Value,o=s.Value,h}();h=u.get_MinNodeWidth()/2;s<h&&(s=h);e<h&&(e=h);c=u.get_MinNodeHeight()/2;f<c&&(f=c);o<c&&(o=c);i[n]=function(){var i=new Microsoft.Msagl.Layout.Layered.Anchor.ctor$$Double$$Double$$Double$$Double$$Node$$Double(s,e,f,o,t.get_Nodes().get_Item$$Int32(n),u.get_LabelCornersPreserveCoefficient());return i.set_Padding(t.get_Nodes().get_Item$$Int32(n).get_Padding()),i}()},RightAnchorMultiSelfEdges:function(n,t,i,r,u,f){var e=Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.WidthOfSelfEdge(u,n,t,i,r,f);t.Value+=e},WidthOfSelfEdge:function(n,t,i,r,u,f){var h=0,o=n.GetMultiedge$$Int32$$Int32(t,t),s,e;if(o.get_Count()>0){for(s=o.GetEnumerator();s.MoveNext();)e=s.get_Current(),e.get_Edge().get_Label()!=null&&(i.Value+=e.get_Edge().get_Label().get_Width(),r.Value<e.get_Edge().get_Label().get_Height()/2&&(r.Value=u.Value=e.get_Edge().get_Label().get_Height()/2));h+=(f.get_NodeSeparation()+f.get_MinNodeWidth())*o.get_Count()}return h},ExtendStandardAnchors:function(n,t,i,r,u){var f=u.get_Width(),e=u.get_Height();f/=2;e/=2;t.Value=n.Value=f;i.Value=r.Value=e},RecoverOriginalLayersAndSettings:function(n,t){return t.Value=new Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings.ctor,Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.RecoverOriginalHorizontalLayers(n,t.Value)!=null?Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.RecoverOriginalHorizontalLayers(n,t.Value):Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.RecoverOriginalVerticalLayers(n,t.Value)},RecoverOriginalHorizontalLayers:function(n,t){for(var o,f,e,u=n.get_Nodes(),s=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),i=0;i<u.get_Count();i++)s.Add(i);for(var l=System.Linq.Enumerable.GroupBy$2$$IEnumerable$1$$Func$2(System.Int32.ctor,System.Double.ctor,s,function(n){return u.get_Item$$Int32(n).get_Center().get_Y()}),r=new System.Collections.Generic.List$1.ctor(Int32Array),h=l.GetEnumerator();h.MoveNext();)f=h.get_Current(),r.Add(System.Linq.Enumerable.ToArray$1(System.Int32.ctor,f));for(t.set_LayerSeparation(Infinity),r=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Int32Array,System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Int32Array,System.Double.ctor,r,function(n){return u.get_Item$$Int32(n[0]).get_Center().get_Y()})),i=0;i<r.get_Count()-1;i++){var a=System.Linq.Enumerable.Max$1$$IEnumerable$1$$Func$2(System.Int32.ctor,r.get_Item$$Int32(i),function(n){return u.get_Item$$Int32(n).get_BoundingBox().get_Top()}),v=System.Linq.Enumerable.Min$1$$IEnumerable$1$$Func$2(System.Int32.ctor,r.get_Item$$Int32(i+1),function(n){return u.get_Item$$Int32(n).get_BoundingBox().get_Bottom()}),c=v-a;if(c<=0)return t.set_Transformation(null),null;t.set_LayerSeparation(System.Math.Min$$Double$$Double(t.get_LayerSeparation(),c))}for(o=new Int32Array(u.get_Count()),i=0;i<r.get_Count();i++)for(f=r.get_Item$$Int32(i),e=0;e<f.length;e++)o[f[e]]=i;return t.set_Transformation(System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_Edges(),function(n){return n.get_Source().get_Center().get_Y()>n.get_Target().get_Center().get_Y()})?new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor:Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.Rotation(3.14159265358979)),new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(o)},RecoverOriginalVerticalLayers:function(n,t){for(var o,f,e,u=n.get_Nodes(),s=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),i=0;i<n.get_Nodes().get_Count();i++)s.Add(i);for(var l=System.Linq.Enumerable.GroupBy$2$$IEnumerable$1$$Func$2(System.Int32.ctor,System.Double.ctor,s,function(n){return u.get_Item$$Int32(n).get_Center().get_X()}),r=new System.Collections.Generic.List$1.ctor(Int32Array),h=l.GetEnumerator();h.MoveNext();)f=h.get_Current(),r.Add(System.Linq.Enumerable.ToArray$1(System.Int32.ctor,f));for(r=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Int32Array,System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Int32Array,System.Double.ctor,r,function(n){return u.get_Item$$Int32(n[0]).get_Center().get_X()})),t.set_LayerSeparation(Infinity),i=0;i<r.get_Count()-1;i++){var a=System.Linq.Enumerable.Max$1$$IEnumerable$1$$Func$2(System.Int32.ctor,r.get_Item$$Int32(i),function(n){return u.get_Item$$Int32(n).get_BoundingBox().get_Right()}),v=System.Linq.Enumerable.Min$1$$IEnumerable$1$$Func$2(System.Int32.ctor,r.get_Item$$Int32(i+1),function(n){return u.get_Item$$Int32(n).get_BoundingBox().get_Left()}),c=v-a;if(c<=0)return null;t.set_LayerSeparation(System.Math.Min$$Double$$Double(t.get_LayerSeparation(),c))}for(o=new Int32Array(u.get_Count()),i=0;i<r.get_Count();i++)for(f=r.get_Item$$Int32(i),e=0;e<f.length;e++)o[f[e]]=i;return t.set_Transformation(System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_Edges(),function(n){return n.get_Source().get_Center().get_X()>n.get_Target().get_Center().get_X()})?Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.Rotation(-1.5707963267949):Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.Rotation(1.5707963267949)),new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(o)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.engineLayerArrays=null;this.originalGraph=null;this.properLayeredGraph=null;this.sugiyamaSettings=null;this.database=null;this.IntGraph=null;this.xLayoutGraph=null;this.nodeIdToIndex=null;this.anchors=null;this.recoveredLayerArrays=null;this.layerToRecoveredYCoordinates=null;this.skeletonVirtualVerticesToX=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Double.ctor);this.constrainedOrdering=null;this._Brandes=!1;this._GluedDagSkeletonForLayering=null;this._LayersAreDoubled=!1;System.Object.ctor.call(this);n!=null&&(this.Init(n),this.recoveredLayerArrays=function(){var t={Value:this.sugiyamaSettings},i=Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.RecoverOriginalLayersAndSettings(n,t);return this.sugiyamaSettings=t.Value,i}.call(this))},Brandes$$:"System.Boolean",get_Brandes:function(){return this._Brandes},set_Brandes:function(n){this._Brandes=n},Database$$:"Microsoft.Msagl.Layout.Layered.Database",get_Database:function(){return this.database},set_Database:function(n){this.database=n},GluedDagSkeletonForLayering$$:"Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph`2[[Microsoft.Msagl.Core.Layout.Node],[Microsoft.Msagl.Layout.Layered.IntEdge]]",get_GluedDagSkeletonForLayering:function(){return this._GluedDagSkeletonForLayering},set_GluedDagSkeletonForLayering:function(n){this._GluedDagSkeletonForLayering=n},FillLayersToRecoveredYCoordinates:function(){this.layerToRecoveredYCoordinates=new Float64Array(this.recoveredLayerArrays.get_Layers().length);for(var n=0;n<this.layerToRecoveredYCoordinates.length;n++)this.layerToRecoveredYCoordinates[n]=this.originalGraph.get_Nodes().get_Item$$Int32(this.recoveredLayerArrays.get_Layers()[n][0]).get_Center().get_Y()},Init:function(n){var t,i;this.nodeIdToIndex=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Int32.ctor);t=n.get_Nodes();this.InitNodesToIndex(t);i=this.CreateIntEdges(n);this.IntGraph=function(){var r=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$2.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,i,n.get_Nodes().get_Count());return r.set_Nodes(t),r}.call(this);this.originalGraph=n;this.sugiyamaSettings==null&&(this.sugiyamaSettings=new Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings.ctor);this.CreateDatabaseAndRegisterIntEdgesInMultiEdges()},CreateDatabaseAndRegisterIntEdgesInMultiEdges:function(){var n,t;for(this.set_Database(new Microsoft.Msagl.Layout.Layered.Database.ctor),n=this.IntGraph.get_Edges().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.database.RegisterOriginalEdgeInMultiedges(t)},CreateIntEdges:function(n){for(var i=n.get_Edges(),r=new Array(i.get_Count()),u=0,f=i.GetEnumerator(),t,e;f.MoveNext();){if(t=f.get_Current(),t.get_Source()==null||t.get_Target()==null)throw $CreateException(new System.InvalidOperationException.ctor,new Error);e=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32$$Edge(this.nodeIdToIndex.get_Item$$TKey(t.get_Source()),this.nodeIdToIndex.get_Item$$TKey(t.get_Target()),t);r[u]=e;u++}return r},InitNodesToIndex:function(n){for(var t=0,i=n.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),this.nodeIdToIndex.set_Item$$TKey(r,t),t++},CreateGluedDagSkeletonForLayering:function(){this.set_GluedDagSkeletonForLayering(new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$2.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.GluedDagSkeletonEdges(),this.originalGraph.get_Nodes().get_Count()));this.SetGluedEdgesWeights()},SetGluedEdgesWeights:function(){for(var e=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor),o=this.get_GluedDagSkeletonForLayering().get_Edges().GetEnumerator(),r,t,i,u,f,n;o.MoveNext();)n=o.get_Current(),e.set_Item$$TKey(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Source(),n.get_Target()),n);for(r=this.database.get_Multiedges().GetEnumerator();r.MoveNext();)if(t=r.get_Current(),t.get_Key().x!=t.get_Key().y){if(i=this.get_VerticalConstraints().GluedIntPair$$IntPair(t.get_Key()),i.x==i.y)continue;for(u=e.get_Item$$TKey(i),f=t.get_Value().GetEnumerator();f.MoveNext();)n=f.get_Current(),u.set_Weight(u.get_Weight()+n.get_Weight())}},GluedDagSkeletonEdges:function(){for(var n=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,null,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,this.database.get_Multiedges(),$CreateAnonymousDelegate(this,function(n){return n.get_Key().x!=n.get_Key().y})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({kv:n,e:this.get_VerticalConstraints().GluedIntEdge(n.get_Value().get_Item$$Int32(0))})})),$CreateAnonymousDelegate(this,function(n){return n.get_e().get_Source()!=n.get_e().get_Target()})),$CreateAnonymousDelegate(this,function(n){return n.get_e()}))),r=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.get_VerticalConstraints().get_GluedUpDownIntConstraints(),$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.CreateUpDownConstrainedIntEdge(n)})),t=r.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.Insert(i);return n},Run:function(){this.originalGraph.get_Nodes().get_Count()>0?this.engineLayerArrays=this.CalculateLayers():this.originalGraph.boundingBox.SetToEmpty()},CalculateLayers:function(){this.CreateGluedDagSkeletonForLayering();var n=this.CalculateLayersWithoutAspectRatio();return this.UpdateNodePositionData(),n},UpdateNodePositionData:function(){this.TryToSatisfyMinWidhtAndMinHeight();for(var n=0;n<this.IntGraph.get_Nodes().get_Count()&&n<this.database.get_Anchors().length;n++)this.IntGraph.get_Nodes().get_Item$$Int32(n).set_Center(this.database.get_Anchors()[n].get_Origin())},TryToSatisfyMinWidhtAndMinHeight:function(){this.TryToSatisfyMinWidth();this.TryToSatisfyMinHeight()},TryToSatisfyMinWidth:function(){if(this.sugiyamaSettings.get_MinimalWidth()!=0){var n=this.GetCurrentWidth();n<this.sugiyamaSettings.get_MinimalWidth()&&this.StretchWidth()}},StretchWidth:function(){for(var i=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,s=this.originalGraph.get_Nodes().GetEnumerator(),r,n,u,h,f;s.MoveNext();)r=s.get_Current(),i.AddValue(r.get_BoundingBox().get_Width()/2),i.AddValue(this.sugiyamaSettings.get_MinimalWidth()-r.get_BoundingBox().get_Width()/2);for(n=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,u=this.NodeAnchors().GetEnumerator();u.MoveNext();)h=u.get_Current(),n.AddValue(h.get_X());if(n.get_Length()>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(f=i.get_Length()/n.get_Length(),f>1))for(var t=0,e=this.anchors,c=e.length,o=e[t];t<c;t++,o=e[t])o.set_X(o.get_X()*f)},TryToSatisfyMinHeight:function(){if(this.sugiyamaSettings.get_MinimalHeight()!=0){var n=this.GetCurrentHeight();n<this.sugiyamaSettings.get_MinimalHeight()&&this.StretchHeight()}},GetCurrentHeight:function(){for(var n=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,i=this.NodeAnchors().GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),n.AddValue(t.get_Top()),n.AddValue(t.get_Bottom());return n.get_Length()},StretchHeight:function(){for(var i=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,s=this.originalGraph.get_Nodes().GetEnumerator(),r,n,u,h,f;s.MoveNext();)r=s.get_Current(),i.AddValue(r.get_BoundingBox().get_Height()/2),i.AddValue(this.sugiyamaSettings.get_MinimalHeight()-r.get_BoundingBox().get_Height()/2);for(n=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,u=this.NodeAnchors().GetEnumerator();u.MoveNext();)h=u.get_Current(),n.AddValue(h.get_Y());if(n.get_Length()>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(f=i.get_Length()/n.get_Length(),f>1))for(var t=0,e=this.anchors,c=e.length,o=e[t];t<c;t++,o=e[t])o.set_Y(o.get_Y()*f)},NodeAnchors:function(){return System.Linq.Enumerable.Take$1(Microsoft.Msagl.Layout.Layered.Anchor.ctor,this.anchors,System.Math.Min$$Int32$$Int32(this.IntGraph.get_Nodes().get_Count(),this.anchors.length))},GetCurrentWidth:function(){for(var n=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,i=this.NodeAnchors().GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),n.AddValue(t.get_Left()),n.AddValue(t.get_Right());return n.get_Length()},StretchToDesiredAspectRatio:function(n,t){n>t?this.StretchInYDirection(n/t):n<t&&this.StretchInXDirection(t/n)},StretchInYDirection:function(n){for(var f,i=(this.originalGraph.get_BoundingBox().get_Top()+this.originalGraph.get_BoundingBox().get_Bottom())/2,r=0,u=this.get_Database().get_Anchors(),e=u.length,t=u[r];r<e;r++,t=u[r])t.set_BottomAnchor(t.get_BottomAnchor()*n),t.set_TopAnchor(t.get_TopAnchor()*n),t.set_Y(i+n*(t.get_Y()-i));f=this.originalGraph.get_Height()*n;this.originalGraph.set_BoundingBox(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(this.originalGraph.get_BoundingBox().get_Left(),i+f/2,this.originalGraph.get_BoundingBox().get_Right(),i-f/2))},StretchInXDirection:function(n){for(var f,i=(this.originalGraph.get_BoundingBox().get_Left()+this.originalGraph.get_BoundingBox().get_Right())/2,r=0,u=this.get_Database().get_Anchors(),e=u.length,t=u[r];r<e;r++,t=u[r])t.set_LeftAnchor(t.get_LeftAnchor()*n),t.set_RightAnchor(t.get_RightAnchor()*n),t.set_X(i+n*(t.get_X()-i));f=this.originalGraph.get_Width()*n;this.originalGraph.set_BoundingBox(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(i-f/2,this.originalGraph.get_BoundingBox().get_Top(),i+f/2,this.originalGraph.get_BoundingBox().get_Bottom()))},CalculateLayersWithoutAspectRatio:function(){var n=this.CalculateYLayers(),t;return this.constrainedOrdering==null?(this.DecideIfUsingFastXCoordCalculation(n),this.CalculateAnchorsAndYPositions(n),this.get_Brandes()?this.CalculateXPositionsByBrandes(n):this.CalculateXLayersByGansnerNorth(n)):this.anchors=this.database.get_Anchors(),this.OptimizeEdgeLabelsLocations(),this.engineLayerArrays=n,this.StraightensShortEdges(),function(){var n={Value:t},i=this.CalculateOriginalGraphBox(n);return t=n.Value,i}.call(this),this.sugiyamaSettings.get_AspectRatio()!=0&&this.StretchToDesiredAspectRatio(t,this.sugiyamaSettings.get_AspectRatio()),n},DecideIfUsingFastXCoordCalculation:function(n){if(n.get_X().length>=this.sugiyamaSettings.get_BrandesThreshold())this.set_Brandes(!0);else{var t=System.Environment.GetEnvironmentVariable$$String("Brandes");System.String.IsNullOrEmpty(t)||System.String.Compare$$String$$String$$Boolean$$CultureInfo(t,"on",!0,System.Globalization.CultureInfo.get_CurrentCulture())!=0||this.set_Brandes(!0)}},StraightensShortEdges:function(){for(;this.StraightenEdgePaths(););},StraightenEdgePaths:function(){for(var t=!1,i=this.database.get_AllIntEdges().GetEnumerator(),n;i.MoveNext();)n=i.get_Current(),n.get_LayerSpan()==2&&(t=this.ShiftVertexWithNeighbors(n.get_LayerEdges().get_Item$$Int32(0).get_Source(),n.get_LayerEdges().get_Item$$Int32(0).get_Target(),n.get_LayerEdges().get_Item$$Int32(1).get_Target())||t);return t},ShiftVertexWithNeighbors:function(n,t,i){var r=this.database.get_Anchors()[n],e=this.database.get_Anchors()[i],f=this.database.get_Anchors()[t],u=(f.get_Y()-r.get_Y())*(e.get_X()-r.get_X())/(e.get_Y()-r.get_Y())+r.get_X(),o=.0001;return u>f.get_X()+o?this.TryShiftToTheRight(u,t):u<f.get_X()-o?this.TryShiftToTheLeft(u,t):!1},TryShiftToTheLeft:function(n,t){var f=this.engineLayerArrays.get_Layers()[this.engineLayerArrays.Y[t]],r=this.engineLayerArrays.get_X()[t],u,i;return r>0?(u=this.database.get_Anchors()[f[r-1]],i=System.Math.Max$$Double$$Double(u.get_Right()+this.sugiyamaSettings.get_NodeSeparation()+this.database.get_Anchors()[t].get_LeftAnchor(),n),i<this.database.get_Anchors()[t].get_X()-1)?(this.database.get_Anchors()[t].set_X(i),!0):!1:(this.database.get_Anchors()[t].set_X(n),!0)},TryShiftToTheRight:function(n,t){var r=this.engineLayerArrays.get_Layers()[this.engineLayerArrays.Y[t]],u=this.engineLayerArrays.get_X()[t],f,i;return u<r.length-1?(f=this.database.get_Anchors()[r[u+1]],i=System.Math.Min$$Double$$Double(f.get_Left()-this.sugiyamaSettings.get_NodeSeparation()-this.database.get_Anchors()[t].get_RightAnchor(),n),i>this.database.get_Anchors()[t].get_X()+1)?(this.database.get_Anchors()[t].set_X(i),!0):!1:(this.database.get_Anchors()[t].set_X(n),!0)},CalculateYLayers:function(){var n=this.YLayeringAndOrdering(new Microsoft.Msagl.Layout.Layered.RecoveryLayerCalculator.ctor(this.recoveredLayerArrays));return this.constrainedOrdering!=null?n:this.InsertLayersIfNeeded(n)},VerticalConstraints$$:"Microsoft.Msagl.Layout.Layered.VerticalConstraintsForSugiyama",get_VerticalConstraints:function(){return this.sugiyamaSettings.get_VerticalConstraints()},HorizontalConstraints$$:"Microsoft.Msagl.Layout.Layered.HorizontalConstraintsForSugiyama",get_HorizontalConstraints:function(){return this.sugiyamaSettings.get_HorizontalConstraints()},CalculateAnchorsAndYPositions:function(n){(function(){var n={Value:this.anchors},t=Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.CalculateAnchorSizes(this.database,n,this.properLayeredGraph,this.originalGraph,this.IntGraph,this.sugiyamaSettings);return this.anchors=n.Value,t}).call(this);Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.CalcInitialYAnchorLocations(n,500,this.originalGraph,this.database,this.IntGraph,this.sugiyamaSettings,this.get_LayersAreDoubled())},OptimizeEdgeLabelsLocations:function(){for(var n,i,r,t=0;t<this.anchors.length;t++)if(n=this.anchors[t],n.get_LabelToTheRightOfAnchorCenter()&&(function(){var n={Value:i},u={Value:r},f=this.GetSuccessorAndPredecessor(t,n,u);return i=n.Value,r=u.Value,f}.call(this),!Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.TryToPutLabelOutsideOfAngle(n,i,r))){var f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Origin(),n.get_Origin()).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r.get_Origin(),n.get_Origin()).get_Length(),e=n.get_Right()-n.get_LeftAnchor(),u=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,n.get_Y()),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Origin(),u).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r.get_Origin(),u).get_Length();o<f&&Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.PutLabelToTheLeft(n)}},GetSuccessorAndPredecessor:function(n,t,i){for(var e=10,o=this.properLayeredGraph.InEdges(n).GetEnumerator(),u,f,r;o.MoveNext();)r=o.get_Current(),e=r.get_Source();for(u=10,f=this.properLayeredGraph.OutEdges(n).GetEnumerator();f.MoveNext();)r=f.get_Current(),u=r.get_Target();t.Value=this.anchors[e];i.Value=this.anchors[u]},CycleRemoval:function(){var n=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.IntGraph.get_Edges(),$CreateAnonymousDelegate(this,function(n){return this.recoveredLayerArrays.Y[n.get_Source()]<this.recoveredLayerArrays.Y[n.get_Target()]})));this.database.AddFeedbackSet(n)},CalculateXLayersByGansnerNorth:function(n){this.xLayoutGraph=this.CreateXLayoutGraph(n);this.CalculateXLayersByGansnerNorthOnProperLayeredGraph()},CalculateXLayersByGansnerNorthOnProperLayeredGraph:function(){for(var t=new Microsoft.Msagl.Layout.Layered.NetworkSimplex.ctor(this.xLayoutGraph,null).GetLayers(),n=0;n<this.database.get_Anchors().length;n++)this.anchors[n].set_X(t[n])},CreateProperLayeredGraph:function(n,t){for(var p=n.length,s=0,v=this.database.SkeletonEdges().GetEnumerator(),u,o,f,h,r,e,c,i,l,a,y;v.MoveNext();)if(i=v.get_Current(),u=Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.EdgeSpan(n,i),System.Diagnostics.Debug.Assert$$Boolean(u>=0),u>0&&i.set_LayerEdges(new Array(u)),o=0,u>1){for(f=p+s++,r=new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(i.get_Source(),f,i.get_CrossingWeight()),i.get_LayerEdges().set_Item$$Int32(o++,r),h=0;h<u-2;h++)f++,s++,r=new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(f-1,f,i.get_CrossingWeight()),i.get_LayerEdges().set_Item$$Int32(o++,r);r=new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(f,i.get_Target(),i.get_CrossingWeight());i.get_LayerEdges().set_Item$$Int32(o,r)}else u==1&&(r=new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(i.get_Source(),i.get_Target(),i.get_CrossingWeight()),i.get_LayerEdges().set_Item$$Int32(o,r));for(e=new Int32Array(this.originalGraph.get_Nodes().get_Count()+s),c=this.database.SkeletonEdges().GetEnumerator();c.MoveNext();)if(i=c.get_Current(),i.get_LayerEdges()!=null)for(l=n[i.get_Source()],e[i.get_Source()]=l--,a=i.get_LayerEdges().GetEnumerator();a.MoveNext();)y=a.get_Current(),e[y.get_Target()]=l--;else e[i.get_Source()]=n[i.get_Source()],e[i.get_Target()]=n[i.get_Target()];this.properLayeredGraph=new Microsoft.Msagl.Layout.Layered.ProperLayeredGraph.ctor(new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$2.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.database.SkeletonEdges(),n.length));this.properLayeredGraph.BaseGraph.set_Nodes(this.IntGraph.get_Nodes());t.Value=new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(e)},YLayeringAndOrdering:function(n){var t=n.GetLayers(),i;return(t=this.ExtendLayeringToUngluedSameLayerVertices(t),i=new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(t),this.get_HorizontalConstraints()==null||this.get_HorizontalConstraints().get_IsEmpty())?this.YLayeringAndOrderingWithoutHorizontalConstraints(i):(this.constrainedOrdering=new Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.ctor(this.originalGraph,this.IntGraph,i.Y,this.nodeIdToIndex,this.database,this.sugiyamaSettings),this.constrainedOrdering.Calculate(),this.properLayeredGraph=this.constrainedOrdering.ProperLayeredGraph,this.constrainedOrdering.LayerArrays)},YLayeringAndOrderingWithoutHorizontalConstraints:function(n){return function(){var t={Value:n},i=this.CreateProperLayeredGraph(n.Y,t);return n=t.Value,i}.call(this),this.GetXCoordinatesOfVirtualNodesOfTheProperLayeredGraph(n),this.OrderLayers(n),Microsoft.Msagl.Layout.Layered.MetroMapOrdering.UpdateLayerArrays$$ProperLayeredGraph$$LayerArrays(this.properLayeredGraph,n),n},GetXCoordinatesOfVirtualNodesOfTheProperLayeredGraph:function(n){for(var t=this.database.SkeletonEdges().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.GetXCoordinatesOfVirtualNodesOfTheProperLayeredGraphForSkeletonEdge(i,n)},GetXCoordinatesOfVirtualNodesOfTheProperLayeredGraphForSkeletonEdge:function(n,t){var r,u,i;if(n.get_LayerEdges()!=null&&!(n.get_LayerEdges().get_Count()<2))for(r=n.get_Edge().get_Curve(),u=t.Y[n.get_Source()]-1,i=1;i<n.get_LayerEdges().get_Count();i++){var e=n.get_LayerEdges().get_Item$$Int32(i).get_Source(),f=this.layerToRecoveredYCoordinates[u--],o=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.originalGraph.get_Left(),f),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.originalGraph.get_Right(),f)),s=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(r,o,!1);this.skeletonVirtualVerticesToX.set_Item$$TKey(e,s.get_IntersectionPoint().get_X())}},OrderLayers:function(n){for(var t=0,i=n.get_Layers(),u=i.length,r=i[t];t<u;t++,r=i[t])this.OrderLayerBasedOnRecoveredXCoords(r)},OrderLayerBasedOnRecoveredXCoords:function(n){var r,t,i;if(!(n.length<=1)){for(r=new Float64Array(n.length),t=0;t<n.length;t++)i=n[t],r[t]=this.properLayeredGraph.IsVirtualNode(i)?this.skeletonVirtualVerticesToX.get_Item$$TKey(i):this.originalGraph.get_Nodes().get_Item$$Int32(i).get_Center().get_X();System.Array.Sort$2$$TKey$Array$$TValue$Array(System.Double.ctor,System.Int32.ctor,r,n)}},CalculateXPositionsByBrandes:function(n){Microsoft.Msagl.Layout.Layered.XCoordsWithAlignment.CalculateXCoordinates(n,this.properLayeredGraph,this.originalGraph.get_Nodes().get_Count(),this.database.get_Anchors(),this.sugiyamaSettings.get_NodeSeparation())},CalculateOriginalGraphBox:function(n){var t,i,r,u,f;if(n.Value=0,this.anchors.length>0){for(t=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(this.anchors[0].get_Left(),this.anchors[0].get_Top(),this.anchors[0].get_Right(),this.anchors[0].get_Bottom()),i=1;i<this.anchors.length;i++)r=this.anchors[i],t.Add$$Point(r.get_LeftTop()),t.Add$$Point(r.get_RightBottom());n.Value=t.get_Width()/t.get_Height();u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_LeftTop(),t.get_RightBottom()).get_Length()/2;f=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-u,u);t.Add$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_LeftTop(),f));t.Add$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_RightBottom(),f));this.originalGraph.set_BoundingBox(t)}},InsertLayersIfNeeded:function(n){var t=!1,i=!1;return this.InsertVirtualEdgesIfNeeded(n),function(){var r={Value:t},u={Value:i},f=this.AnalyzeNeedToInsertLayersAndHasMultiedges(n,r,u);return t=r.Value,i=u.Value,f}.call(this),t?(function(){var t={Value:this.properLayeredGraph},i={Value:n},r=Microsoft.Msagl.Layout.Layered.LayerInserter.InsertLayers$$ProperLayeredGraph$$LayerArrays$$Database$$BasicGraph$2$Node$IntEdge(t,i,this.database,this.IntGraph);return this.properLayeredGraph=t.Value,n=i.Value,r}.call(this),this.set_LayersAreDoubled(!0)):i&&function(){var t={Value:this.properLayeredGraph},i={Value:n},r=Microsoft.Msagl.Layout.Layered.EdgePathsInserter.InsertPaths$$ProperLayeredGraph$$LayerArrays$$Database$$BasicGraph$2$Node$IntEdge(t,i,this.database,this.IntGraph);return this.properLayeredGraph=t.Value,n=i.Value,r}.call(this),this.RecreateIntGraphFromDataBase(),n},LayersAreDoubled$$:"System.Boolean",get_LayersAreDoubled:function(){return this._LayersAreDoubled},set_LayersAreDoubled:function(n){this._LayersAreDoubled=n},RecreateIntGraphFromDataBase:function(){for(var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Layered.IntEdge.ctor),t=this.database.get_Multiedges().get_Values().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.AddRange(i);this.IntGraph.SetEdges(n,this.IntGraph.get_NodeCount())},AnalyzeNeedToInsertLayersAndHasMultiedges:function(n,t,i){for(var e=this.IntGraph.get_Edges().GetEnumerator(),r,f,u;e.MoveNext();)if(r=e.get_Current(),r.get_HasLabel()&&n.Y[r.get_Source()]!=n.Y[r.get_Target()]){t.Value=!0;break}if(t.Value==!1&&this.constrainedOrdering==null)for(f=this.database.get_Multiedges().GetEnumerator();f.MoveNext();)if(u=f.get_Current(),u.get_Value().get_Count()>1&&(i.Value=!0,n.Y[u.get_Key().x]-n.Y[u.get_Key().y]==1)){t.Value=!0;break}},InsertVirtualEdgesIfNeeded:function(n){var r,t,i;if(this.constrainedOrdering==null)for(r=this.database.get_Multiedges().GetEnumerator();r.MoveNext();)t=r.get_Current(),t.get_Value().get_Count()%2==0&&n.Y[t.get_Key().get_First()]-1==n.Y[t.get_Key().get_Second()]&&(i=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(t.get_Key().get_First(),t.get_Key().get_Second()),i.set_Edge(new Microsoft.Msagl.Core.Layout.Edge.ctor),i.set_IsVirtualEdge(!0),t.get_Value().Insert(t.get_Value().get_Count()/2|0,i),this.IntGraph.AddEdge(i))},ExtendLayeringToUngluedSameLayerVertices:function(n){for(var i=this.get_VerticalConstraints(),t=0;t<n.length;t++)n[t]=n[i.NodeToRepr(t)];return n},CreateXLayoutGraph:function(n){for(var i=this.properLayeredGraph.get_NodeCount(),r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Layered.IntEdge.ctor),c=this.properLayeredGraph.get_Edges().GetEnumerator(),t,h;c.MoveNext();){var l=c.get_Current(),e=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(i,l.get_Source()),o=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(i,l.get_Target());e.set_Weight(function(n){return o.set_Weight(n),n}.call(this,1));e.set_Separation(0);o.set_Separation(0);i++;r.Add(e);r.Add(o)}for(var u=0,s=n.get_Layers(),p=s.length,f=s[u];u<p;u++,f=s[u])for(t=f.length-1;t>0;t--){var a=f[t],v=f[t-1],y=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(a,v),w=this.database.get_Anchors()[a],b=this.database.get_Anchors()[v],k=w.get_LeftAnchor()+b.get_RightAnchor()+this.sugiyamaSettings.get_NodeSeparation();y.set_Separation(k+1|0);r.Add(y)}return h=new Microsoft.Msagl.Layout.Layered.XLayoutGraph.ctor(this.IntGraph,this.properLayeredGraph,n,r,i),h.SetEdgeWeights(),h},GetEngine:function(){if(this.recoveredLayerArrays==null)return null;this.sugiyamaSettings.get_Transformation().get_IsIdentity()||this.originalGraph.Transform(this.sugiyamaSettings.get_Transformation().get_Inverse());this.FillLayersToRecoveredYCoordinates();this.CycleRemoval();this.Run();var n=this.CreateEngine();return this.sugiyamaSettings.get_Transformation().get_IsIdentity()||this.originalGraph.Transform(this.sugiyamaSettings.get_Transformation()),n},CreateEngine:function(){return new Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.ctor$$LayerArrays$$GeometryGraph$$ProperLayeredGraph$$SugiyamaLayoutSettings$$Database$$BasicGraph$2$Node$IntEdge$$Dictionary$2$Node$Int32$$BasicGraph$2$Node$IntEdge$$Boolean$$ConstrainedOrdering$$Boolean$$XLayoutGraph(this.engineLayerArrays,this.originalGraph,this.properLayeredGraph,this.sugiyamaSettings,this.database,this.IntGraph,this.nodeIdToIndex,this.get_GluedDagSkeletonForLayering(),this.get_LayersAreDoubled(),this.constrainedOrdering,this.get_Brandes(),this.xLayoutGraph)}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$RecoveryLayeredLayoutEngine);Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$OverlapRemovalMethod={fullname:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.OverlapRemovalMethod",staticDefinition:{Prism:0,MinimalSpanningTree:1},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Layout$ProximityOverlapRemoval$MinimumSpanningTree$OverlapRemovalMethod);Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$FakeBitmap={fullname:"Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.FakeBitmap",baseTypeName:"System.Object",staticDefinition:{UpdatePixelInsideForXCase:function(n,t,i,r,u,f){if(n.Value.X!=i.X){n.Value.X++;var e=PixelPoint.op_Multiply(r,PixelPoint.op_Subtraction(n.Value,t));System.Math.Abs$$Int32(e)<=u||(n.Value.Y+=f,e+=f*r.Y,System.Math.Abs$$Int32(e)<=u)||(n.Value.Y-=2*f,e-=2*f*r.Y,System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Int32(e-2*f*r.Y)<=u))}}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this._width=0;this._height=0;this._m=null;System.Object.ctor.call(this);this._width=n;this._height=t;var i=this._width*this._height;this._m=new Uint8Array(i)},GetPixelValue:function(n,t){return this.InBounds(n,t)?this._m[n+t*this._width]:0},Offset:function(n,t){return System.Diagnostics.Debug.Assert$$Boolean(this.InBounds(n,t)),n+this._width*t},InBounds:function(n,t){return 0<=n&&n<this._width&&0<=t&&t<this._height},FillRectangle:function(n,t,i,r){var e,o,u,s,f;for(function(){var i={Value:n},r={Value:t},u=this.AdjustLeftTop(i,r);return n=i.Value,t=r.Value,u}.call(this),e=System.Math.Min$$Int32$$Int32(t+r,this._height-1),o=System.Math.Min$$Int32$$Int32(n+i,this._width-1),u=t;u<e;u++)for(s=this.Offset(n,u),f=n;f<o;f++)this._m[s++]=1},AdjustLeftTop:function(n,t){n.Value<0&&(n.Value=0);t.Value<0&&(t.Value=0);n.Value>=this._width&&(n.Value=this._width-1);t.Value>=this._height&&(t.Value=this._height-1)},Plot:function(n,t){this._m[this.Offset(n,t)]=1},DrawFatSegByX:function(n,t,i){var r=new PixelPoint.ctor$$Int32$$Int32(-(t.Y-n.Y),t.X-n.X),u;if(r.Y==0){this.FillRectangle(n.X,n.Y-i,t.X-n.X,2*i);return}r.Y<0&&(r=PixelPoint.op_UnaryNegation(r));var f=n,e=System.Math.Sqrt(PixelPoint.op_Multiply(r,r)),o=e*i|0;for(u=n.X;u<=t.X;u++)(function(){var i={Value:f},e=this.ScanVertLine(u,i,n,t,r,o);return f=i.Value,e}).call(this)},ScanVertLine:function(n,t,i,r,u,f){this.ScanVertLineUp(n,t.Value,i,u,f);this.ScanVertLineDown(n,t.Value,i,u,f);Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.FakeBitmap.UpdatePixelInsideForXCase(t,i,r,u,f,System.Math.Sign$$Int32(r.Y-i.Y))},ScanVertLineDown:function(n,t,i,r,u){var f=t.Y,e=PixelPoint.op_Multiply(r,PixelPoint.op_Subtraction(t,i));System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Int32(e)<=u);do{if(this.Plot(n,f),e-=r.Y,e<-u)break;f--}while(f>=0)},ScanVertLineUp:function(n,t,i,r,u){System.Diagnostics.Debug.Assert$$Boolean(r.Y>0);var f=t.Y,e=PixelPoint.op_Multiply(r,PixelPoint.op_Subtraction(t,i));System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Int32(e)<=u);do{if(this.Plot(n,f),e+=r.Y,e>u)break;f++}while(f<this._height)},DrawFatSegByY:function(n,t,i){var r,u;if(System.Diagnostics.Debug.Assert$$Boolean(n.Y<=t.Y),r=new PixelPoint.ctor$$Int32$$Int32(-t.Y+n.Y,t.X-n.X),r.X==0){this.FillRectangle(n.X-i,n.Y,2*i,t.Y-n.Y);return}r.X<0&&(r=PixelPoint.op_UnaryNegation(r));var f=n,e=System.Math.Sqrt(PixelPoint.op_Multiply(r,r)),o=e*i|0;for(u=n.Y;u<=t.Y;u++)(function(){var i={Value:f},e=this.ScanHorizontalLine(u,i,n,t,r,o);return f=i.Value,e}).call(this)},ScanHorizontalLine:function(n,t,i,r,u,f){this.ScanHorizontalLineRight(n,t.Value,i,u,f);this.ScanHorizontalLineLeft(n,t.Value,i,u,f);this.UpdatePixelInsideForYCase(t,i,r,u,f,System.Math.Sign$$Int32(r.Y-i.Y))},UpdatePixelInsideForYCase:function(n,t,i,r,u,f){if(n.Value.Y!=i.Y){n.Value.Y++;var e=PixelPoint.op_Multiply(r,PixelPoint.op_Subtraction(n.Value,t));System.Math.Abs$$Int32(e)<=u||(n.Value.X+=f,e+=f*r.X,System.Math.Abs$$Int32(e)<=u)||(n.Value.X-=2*f,e-=2*f*r.X,System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Int32(e)<=u))}},ScanHorizontalLineRight:function(n,t,i,r,u){System.Diagnostics.Debug.Assert$$Boolean(r.X>0);var f=t.X,e=PixelPoint.op_Multiply(r,PixelPoint.op_Subtraction(t,i));System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Int32(e)<=u);do{if(this.Plot(f,n),e+=r.X,e>u)break;f++}while(f<this._width)},ScanHorizontalLineLeft:function(n,t,i,r,u){System.Diagnostics.Debug.Assert$$Boolean(r.X>0);var f=t.X,e=PixelPoint.op_Multiply(r,PixelPoint.op_Subtraction(t,i));System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Int32(e)<=u);do{if(this.Plot(f,n),e-=r.X,e<-u)break;f--}while(f>=0)},DrawFatSeg:function(n,t,i){var r=t.X-n.X,u=t.Y-n.Y;this.FillRectangle(n.X-i,n.Y-i,2*i,2*i);this.FillRectangle(t.X-i,t.Y-i,2*i,2*i);System.Math.Abs$$Double(r)>System.Math.Abs$$Double(u)?r>0?this.DrawFatSegByX(n,t,i):this.DrawFatSegByX(t,n,i):u>0?this.DrawFatSegByY(n,t,i):this.DrawFatSegByY(t,n,i)}}};JsTypes.push(Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$FakeBitmap);Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsBitmap={fullname:"Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsBitmap",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsBitmap.MaxSize=2048},Translate:function(n,t){return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_LeftBottom(),t),Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_RightTop(),t))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Rectangle$Array$$Rectangle$Array$$SymmetricTuple$1$Point$Array:function(n,t,i){this._moveableRectangles=null;this._fixedRectangles=null;this._fixedSegments=null;this.movedRectangles=null;this._bitmap=null;this._mapWidth=0;this._mapHeight=0;this._pixelSize=0;this._bbox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._worldToMap=null;this._mapToWorld=null;this._insertRectSize=0;this.NumPixelsPadding=5;System.Object.ctor.call(this);this._moveableRectangles=n;this._fixedRectangles=t;this._fixedSegments=i;this._bbox=this.GetInitialBoundingBox();this._bbox.ScaleAroundCenter(1.25);this.InitBitmap();this.InitTransform();this.movedRectangles=new Array(n.length)},InitInsertRectSize:function(n){this._insertRectSize=n.get_Width();this._insertRectSize+=this.NumPixelsPadding*this._pixelSize},ScaleBbox:function(){this._bbox.ScaleAroundCenter(1.25);this.InitBitmap();this.InitTransform()},ctor$$Rectangle:function(n){this._moveableRectangles=null;this._fixedRectangles=null;this._fixedSegments=null;this.movedRectangles=null;this._bitmap=null;this._mapWidth=0;this._mapHeight=0;this._pixelSize=0;this._bbox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._worldToMap=null;this._mapToWorld=null;this._insertRectSize=0;this.NumPixelsPadding=5;System.Object.ctor.call(this);this._bbox=n;this.InitBitmap();this.InitTransform()},GetInitialBoundingBox:function(){var n=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;n.SetToEmpty();for(var t=0,u=this._fixedRectangles,e=u.length,i=u[t];t<e;t++,i=u[t])n.Add$$Rectangle(i);for(var r=0,f=this._moveableRectangles,o=f.length,i=f[r];r<o;r++,i=f[r])n.Add$$Rectangle(i);return n},InitBitmap:function(){var n=System.Math.Max$$Double$$Double(this._bbox.get_Width(),this._bbox.get_Height());this._mapWidth=this._bbox.get_Width()/n*2048|0;this._mapHeight=this._bbox.get_Height()/n*2048|0;this._pixelSize=this._bbox.get_Width()/this._mapWidth;this._bitmap=new Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.FakeBitmap.ctor(this._mapWidth,this._mapHeight)},FindClosestFreePixel:function(n,t){for(var i=this.PointToPixel(n),r=0;r<1024;r++)if(function(){var n={Value:i},t=this.GetFreePixelInRadius(n,r);return i=n.Value,t}.call(this))return t.Value=i,!0;return t.Value=new PixelPoint.ctor,!1},IsPositionFree:function(n){return this.IsFree(this.PointToPixel(n))},PositionAllMoveableRectsSameSize:function(n,t,i){var r,u,f,e;if(System.Console.WriteLine$$String("\nRemoving overlaps"),this._moveableRectangles.length==0)return 0;for(this.InitInsertRectSize(this._moveableRectangles[n]),this.DrawFixedRectsSegments(t,i),r=n;r<this._moveableRectangles.length;r++){if(u=this._moveableRectangles[r],this.IsPositionFree(u.get_Center())?(this.movedRectangles[r]=u,f=!0):(f=function(){var n={Value:e},t=this.FindClosestFreePos(u.get_Center(),n);return e=n.Value,t}.call(this),this.movedRectangles[r]=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsBitmap.Translate(u,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,u.get_Center()))),!f)return r;t.Add$$Rectangle$$TData(this.movedRectangles[r],this.movedRectangles[r]);this.DrawRectDilated(this.movedRectangles[r]);r%10==0&&System.Console.Write$$String(".")}return this._moveableRectangles.length},DrawFixedRectsSegments:function(n,t){for(var u=n.GetAllLeaves().GetEnumerator(),f,i,r;u.MoveNext();)f=u.get_Current(),this.DrawRectDilated(f);for(i=t.GetAllLeaves().GetEnumerator();i.MoveNext();)r=i.get_Current(),this.DrawLineSegDilated(r.get_A(),r.get_B())},FindClosestFreePos:function(n,t){var i,r=function(){var t={Value:i},r=this.FindClosestFreePixel(n,t);return i=t.Value,r}.call(this);return t.Value=this.GetWorldCoord(i),r},GetTranslations:function(){for(var t=new Array(this._moveableRectangles.length),n=0;n<this._moveableRectangles.length;n++)t[n]=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.movedRectangles[n].get_Center(),this._moveableRectangles[n].get_Center());return t},GetFreePixelInRadius:function(n,t){for(var f,i,r,u=n.Value.X-t;u<=n.Value.X+t;u++){if(i=new PixelPoint.ctor$$Int32$$Int32(u,n.Value.Y-t),this.IsFree(i))return n.Value=i,!0;if(r=new PixelPoint.ctor$$Int32$$Int32(u,n.Value.Y+t),t!=0&&this.IsFree(r))return n.Value=r,!0}for(f=n.Value.Y-t+1;f<n.Value.Y+t;f++){if(i=new PixelPoint.ctor$$Int32$$Int32(n.Value.X-t,f),this.IsFree(i))return n.Value=i,!0;if(r=new PixelPoint.ctor$$Int32$$Int32(n.Value.X+t,f),this.IsFree(r))return n.Value=r,!0}return!1},IsFree:function(n){return this._bitmap.GetPixelValue(n.X,n.Y)==0},DrawRectDilated:function(n){var i=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this._insertRectSize/2,this._insertRectSize/2),t=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(this._worldToMap,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_LeftBottom(),i)),r=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(this._worldToMap,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_RightTop(),i)),u=t.get_X()|0,f=t.get_Y()|0,e=r.get_X()-t.get_X()|0,o=r.get_Y()-t.get_Y()|0;this._bitmap.FillRectangle(u,f,e,o)},DrawLineSegDilated:function(n,t){var i=this.PointToPixel(n),r=this.PointToPixel(t);this._bitmap.DrawFatSeg(i,r,this._insertRectSize/(2*this._pixelSize)+.5|0)},PointToPixel:function(n){var t=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(this._worldToMap,n);return new PixelPoint.ctor$$Int32$$Int32(t.get_X()+.5|0,t.get_Y()+.5|0)},GetWorldCoord:function(n){return Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(this._mapToWorld,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.X,n.Y))},InitTransform:function(){var i=.5*this._mapWidth,r=.5*this._mapHeight,u=this._bbox.get_Center().get_X(),f=this._bbox.get_Center().get_Y(),n=this._mapWidth/this._bbox.get_Width(),t=this._mapHeight/this._bbox.get_Height();this._worldToMap=new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(n,0,i-n*u,0,t,r-t*f);this._mapToWorld=this._worldToMap.get_Inverse()}}};JsTypes.push(Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsBitmap);Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$SiteType={fullname:"Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.SiteType",staticDefinition:{CenterBoxMoveable:0,CenterBoxFixed:1,PointOnSegment:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$SiteType);Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst={fullname:"Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.Precision=5;Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.PrecisionDelta=1e-5}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.time=0;this.moveableRectangles=null;this.fixedRectangles=null;this.fixedSegments=null;this.oldPositionsMoveable=null;this.nodeLabelsMoveable=null;this.nodeLabelsFixed=null;this.cdt=null;this.pointToTreeNode=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor);this._segmentTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.Segment.ctor);this._moveableRectanglesTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor);this._fixedRectanglesTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor);this._rectNodesRtree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor);this.movedCriticalNodes=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor,System.Collections.Generic.List$1.ctor);this.oldOverlapsBoxes=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor,System.Collections.Generic.List$1.ctor);this.oldOverlapsSegments=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor,System.Collections.Generic.List$1.ctor);this._subtrees=new System.Collections.Generic.List$1.ctor(System.Collections.Generic.List$1.ctor);this._roots=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor);this.treeSegments=null;this.EdgeContractionFactor=.1;this.EdgeExpansionFactor=1.1;this.BoxSegmentOverlapShiftFactor=1.1;System.Object.ctor.call(this);Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.numNodes=0;this.moveableRectangles=n;this.fixedRectangles=t;this.fixedSegments=i;this.SaveOldPositionsMoveable()},Round:function(n){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point$$Int32(n,5)},SetNodeLabels:function(n,t){this.nodeLabelsMoveable=n;this.nodeLabelsFixed=t},SaveOldPositionsMoveable:function(){this.oldPositionsMoveable=new Array(this.moveableRectangles.length);for(var n=0;n<this.moveableRectangles.length;n++)this.oldPositionsMoveable[n]=this.moveableRectangles[n].get_Center()},GetTranslations:function(){for(var r=this._moveableRectanglesTree.GetAllLeaves(),t=new Array(this._moveableRectanglesTree.get_Count()),i=r.GetEnumerator(),n;i.MoveNext();)n=i.get_Current(),t[n.rectId]=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.rect.get_Center(),this.oldPositionsMoveable[n.rectId]);return t},Init:function(){this.InitCdt();this.InitTree()},InitCdt:function(){var n,i,t,r;for(this.InitSegmentTree(),n=0;n<this.fixedRectangles.length;n++)i=this.Round(this.fixedRectangles[n].get_Center()),t=function(){var t=new Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor;return t.isFixed=!0,t.rectId=n,t.rect=this.fixedRectangles[n],t.sitePoint=i,t.type=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.RectFixed,t}.call(this),this.nodeLabelsFixed!=null&&(t.label=this.nodeLabelsFixed[n]),this.pointToTreeNode.set_Item$$TKey(i,t),this._rectNodesRtree.Add$$Rectangle$$TData(t.rect,t),this._fixedRectanglesTree.Add$$Rectangle$$TData(this.fixedRectangles[n],t);for(n=0;n<this.moveableRectangles.length;n++)i=this.Round(this.moveableRectangles[n].get_Center()),t=function(){var t=new Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor;return t.isFixed=!1,t.rectId=n,t.rect=this.moveableRectangles[n],t.sitePoint=i,t.type=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.RectMoveable,t}.call(this),this.nodeLabelsMoveable!=null&&(t.label=this.nodeLabelsMoveable[n]),this.pointToTreeNode.set_Item$$TKey(i,t),this._rectNodesRtree.Add$$Rectangle$$TData(t.rect,t),this._moveableRectanglesTree.Add$$Rectangle$$TData(this.moveableRectangles[n],t);r=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Geometry.Point.ctor,this.pointToTreeNode.get_Keys());this.cdt=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.ctor$$IEnumerable$1$Point$$IEnumerable$1$Polyline$$List$1(r,null,null);this.cdt.Run()},AddNodesForBoxSegmentOverlaps:function(n,t){var o,r,u,s,l,a,h,c;n.Value=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);t.Value=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor);for(var f=0,e=this.moveableRectangles,v=e.length,i=e[f];f<v;f++,i=e[f])(o=this.GetAllSegmentsIntersecting(i),System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.Segment.ctor,o))&&(r=System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.Segment.ctor,o),s=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.ClosestPointOnSegment(r.get_p1(),r.get_p2(),i.get_Center()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(s,i.get_Center()).get_Length()<.0001?(l=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r.get_p2(),r.get_p2()).Rotate90Ccw(),a=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,this.GetShiftUntilNoLongerOverlapRectSeg(i,r,l)),u=this.Round(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Center(),a))):u=this.Round(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Center(),s))),h=function(){var n=new Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor;return n.isFixed=!1,n.sitePoint=u,n.type=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.AdditionalPointBoxSegmentOverlap,n.segment=r,n.rect=i,n.label="SegOvlp ",n}.call(this),this.pointToTreeNode.ContainsKey(u)||(n.Value.Add(u),this.pointToTreeNode.set_Item$$TKey(u,h),t.Value.Add(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,u,this.Round(i.get_Center())))),c=this.pointToTreeNode.get_Item$$TKey(this.Round(i.get_Center())),c.type==Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.RectMoveable&&(h.label+=c.label))},GetAllSegmentsIntersecting:function(n){for(var u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.Segment.ctor),r=this._segmentTree.GetAllIntersecting(n),t=0,f=r.length,i=r[t];t<f;t++,i=r[t])Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.Intersect(n,i.get_p1(),i.get_p2())&&u.Add(i);return u},InitSegmentTree:function(){for(var t,i,n=0;n<this.fixedSegments.length;n++)t=new Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.Segment.ctor(this.fixedSegments[n].get_A(),this.fixedSegments[n].get_B()),i=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(t.get_p1(),t.get_p2()),this._segmentTree.Add$$Rectangle$$TData(i,t)},GetMstFromCdt:function(){var n=$CreateDelegate(this,this.GetWeightOfCdtEdgeDefault),t=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.MstOnDelaunayTriangulation.GetMstOnCdt(this.cdt,n);return System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.CdtEdge.ctor,Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,t,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n.upperSite.Point,n.lowerSite.Point)})))},BuildForestFromCdtEdges:function(n){for(var t=n.GetEnumerator();t.MoveNext();){var i=t.get_Current(),r=i.get_A(),u=i.get_B();this.AddTreeEdge(r,u)}},AddTreeEdge:function(n,t){var i=this.pointToTreeNode.get_Item$$TKey(n),r=this.pointToTreeNode.get_Item$$TKey(t);i.neighbors.Insert(r);r.neighbors.Insert(i)},RectsOverlap:function(n,t){return!Microsoft.Msagl.Core.Geometry.Rectangle.Intersect(n.rect,t.rect).get_IsEmpty()},GetWeightOfCdtEdgeDefault:function(n){var e=this.Round(n.upperSite.Point),o=this.Round(n.lowerSite.Point),r=this.pointToTreeNode.get_Item$$TKey(e),u=this.pointToTreeNode.get_Item$$TKey(o),t,i,f;return r.type==Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.AdditionalPointBoxSegmentOverlap||u.type==Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.AdditionalPointBoxSegmentOverlap?-System.Math.Max$$Double$$Double(r.rect.get_Diagonal(),u.rect.get_Diagonal()):(t=r.rect,i=u.rect,!Microsoft.Msagl.Core.Geometry.Rectangle.Intersect(t,i).get_IsEmpty())?function(){var n={Value:f},r=this.GetWeightOverlappingRectangles(t,i,n);return f=n.Value,r}.call(this):this.GetDistance(t,i)},GetWeightOfCdtEdgePenalizeFixed:function(n){var o=this.Round(n.upperSite.Point),s=this.Round(n.lowerSite.Point),r=this.pointToTreeNode.get_Item$$TKey(o),u=this.pointToTreeNode.get_Item$$TKey(s),t=r.rect,i=u.rect,h=Microsoft.Msagl.Core.Geometry.Rectangle.Intersect(t,i).get_IsEmpty(),f,e;return Microsoft.Msagl.Core.Geometry.Rectangle.Intersect(t,i).get_IsEmpty()?(e=r.isFixed||u.isFixed?10:1,e*this.GetDistance(t,i)):function(){var n={Value:f},r=this.GetWeightOverlappingRectangles(t,i,n);return f=n.Value,r}.call(this)},GetWeightOfCdtEdgePenalizeSegmentCrossings:function(n){var r=this.Round(n.upperSite.Point),u=this.Round(n.lowerSite.Point),o=this.pointToTreeNode.get_Item$$TKey(r),s=this.pointToTreeNode.get_Item$$TKey(u),t=o.rect,i=s.rect,h=Microsoft.Msagl.Core.Geometry.Rectangle.Intersect(t,i).get_IsEmpty(),f,e;return Microsoft.Msagl.Core.Geometry.Rectangle.Intersect(t,i).get_IsEmpty()?(e=this.IsCrossedBySegment(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,r,u))?3:1,e*this.GetDistance(t,i)):function(){var n={Value:f},r=this.GetWeightOverlappingRectangles(t,i,n);return f=n.Value,r}.call(this)},GetWeightOverlappingRectangles:function(n,t,i){var r=n.get_Center(),u=t.get_Center(),c=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,u).get_Length(),f=System.Math.Abs$$Double(r.get_X()-u.get_X()),e=System.Math.Abs$$Double(r.get_Y()-u.get_Y()),o=n.get_Width()/2+t.get_Width()/2,s=n.get_Height()/2+t.get_Height()/2,h=1e-16;return i.Value=f<h*o?s/e:e<h*s?o/f:System.Math.Min$$Double$$Double(o/f,s/e),-(i.Value-1)*c},getT:function(n,t){var i=n.get_Center(),r=t.get_Center(),h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r).get_Length(),u=System.Math.Abs$$Double(i.get_X()-r.get_X()),f=System.Math.Abs$$Double(i.get_Y()-r.get_Y()),e=n.get_Width()/2+t.get_Width()/2,o=n.get_Height()/2+t.get_Height()/2,s=1e-16;return u<s*e?o/f:f<s*o?e/u:System.Math.Min$$Double$$Double(e/u,o/f)},GetShiftUntilOverlap:function(n,t){var i=n.get_Center(),r=t.get_Center(),u=this.getT(n,t);return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1-u,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r))},GetShiftUntilNoLongerOverlap:function(n,t){var i=n.get_Center(),r=t.get_Center(),u=this.getT(n,t);return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(u-1,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,i))},GetDistance:function(n,t){if(!Microsoft.Msagl.Core.Geometry.Rectangle.Intersect(n,t).get_IsEmpty())return 0;var u=n.get_Left()<=t.get_Left()?n:t,f=n.get_Left()<=t.get_Left()?t:n,e=n.get_Bottom()<=t.get_Bottom()?n:t,o=n.get_Bottom()<=t.get_Bottom()?t:n,i=f.get_Left()-u.get_Right(),r=o.get_Bottom()-e.get_Top();return n.IntersectsOnX(t)?r:n.IntersectsOnY(t)?i:System.Math.Sqrt(i*i+r*r)},GetInitialBoundingBox:function(){var n=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;n.SetToEmpty();for(var t=0,u=this.fixedRectangles,e=u.length,i=u[t];t<e;t++,i=u[t])n.Add$$Rectangle(i);for(var r=0,f=this.moveableRectangles,o=f.length,i=f[r];r<o;r++,i=f[r])n.Add$$Rectangle(i);return n},GetBoundingBox:function(n){var t=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor,i,r;for(t.SetToEmpty(),i=n.GetEnumerator();i.MoveNext();)r=i.get_Current(),t.Add$$Rectangle(r.rect);return t},GetClosestSiteTo$$Point:function(n){for(var r=1.79769313486232E+308,u=System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,this.pointToTreeNode.get_Keys()),f=this.pointToTreeNode.get_Keys().GetEnumerator(),t,i;f.MoveNext();)t=f.get_Current(),i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t).get_LengthSquared(),i<r&&(r=i,u=t);return u},GetClosestSiteTo$$List$1$$Point:function(n,t){for(var i=1.79769313486232E+308,r=System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,this.pointToTreeNode.get_Keys()),u=n.GetEnumerator();u.MoveNext();){var o=u.get_Current(),f=o.sitePoint,e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,f).get_LengthSquared();e<i&&(i=e,r=f)}return r},GetClosestSiteToPreferFixed:function(n,t){for(var r=1.79769313486232E+308,u=System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,this.pointToTreeNode.get_Keys()),f=n.GetEnumerator();f.MoveNext();){var e=f.get_Current(),o=e.sitePoint,i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,o).get_LengthSquared();e.isFixed&&(i/=4);i<r&&(r=i,u=o)}return u},GetRandom:function(n){var t=new System.Random.ctor,i=t.Next$$Int32$$Int32(0,n.get_Count());return n.get_Item$$Int32(i)},OrientTreeEdges:function(n){var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor),r,u,i;for(this.time++,n.visited=this.time,n.parent=null,t.Add(n);System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor,t);)for(r=t.get_Item$$Int32(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor,t)-1),t.RemoveAt(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor,t)-1),u=r.neighbors.GetEnumerator();u.MoveNext();)i=u.get_Current(),i.visited<this.time&&(i.parent=r,i.visited=this.time,t.Add(i))},PrecomputeMovedCriticalNodes:function(n){var i,t;if(!this.movedCriticalNodes.ContainsKey(n)){for(this.movedCriticalNodes.set_Item$$TKey(n,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor)),i=n.neighbors.GetEnumerator();i.MoveNext();)t=i.get_Current(),t!=n.parent&&(this.PrecomputeMovedCriticalNodes(t),n.isFixed||this.movedCriticalNodes.get_Item$$TKey(n).AddRange(this.movedCriticalNodes.get_Item$$TKey(t)));!n.isFixed&&this.oldOverlapsBoxes.ContainsKey(n)&&this.movedCriticalNodes.get_Item$$TKey(n).Add(n)}},PrecomputeMovedCriticalNodesBoxesSegments:function(n){var i,t;if(!this.movedCriticalNodes.ContainsKey(n)){for(this.movedCriticalNodes.set_Item$$TKey(n,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor)),i=n.neighbors.GetEnumerator();i.MoveNext();)t=i.get_Current(),t!=n.parent&&(this.PrecomputeMovedCriticalNodesBoxesSegments(t),n.isFixed||this.movedCriticalNodes.get_Item$$TKey(n).AddRange(this.movedCriticalNodes.get_Item$$TKey(t)));n.type==Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.RectMoveable&&(this.oldOverlapsBoxes.ContainsKey(n)||this.oldOverlapsSegments.ContainsKey(n))&&this.movedCriticalNodes.get_Item$$TKey(n).Add(n)}},MoveSubtree:function(n,t){var i,r;if(!n.isFixed){for(i=n.neighbors.GetEnumerator();i.MoveNext();)r=i.get_Current(),r!=n.parent&&this.MoveSubtree(r,t);n.rect=this.translate(n.rect,t)}},PrecomputeMovedCriticalNodesRoot:function(n){for(var t=n.neighbors.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.PrecomputeMovedCriticalNodes(i)},PrecomputeMovedCriticalNodesBoxesSegmentsRoot:function(n){for(var t=n.neighbors.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.PrecomputeMovedCriticalNodesBoxesSegments(i)},PrecomputeMovedCriticalNodesBoxesSegmentsAllRoots:function(){for(var n=this._roots.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.PrecomputeMovedCriticalNodesBoxesSegmentsRoot(t)},PrecomputeMovedCriticalNodesAllRoots:function(){for(var n=this._roots.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.PrecomputeMovedCriticalNodesRoot(t)},GetDfsOrder:function(n,t){for(var r=n.neighbors.GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),i!=n.parent&&(t.Add(i),this.GetDfsOrder(i,t))},SaveCurrentOverlapsBoxes:function(){var u,t,n,i;for(this.oldOverlapsBoxes=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor,System.Collections.Generic.List$1.ctor),u=this._moveableRectanglesTree.GetAllLeaves().GetEnumerator();u.MoveNext();)if(t=u.get_Current(),n=this._rectNodesRtree.GetAllIntersecting(t.rect),!(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor,n)<=1)){i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor);for(var r=0,e=n.length,f=n[r];r<e;r++,f=n[r])f!=t&&i.Add(f);System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor,i)&&this.oldOverlapsBoxes.Add(t,i)}},SaveCurrentOverlapsSegments:function(){var f,t,n,i;for(this.oldOverlapsSegments=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor,System.Collections.Generic.List$1.ctor),f=this._moveableRectanglesTree.GetAllLeaves().GetEnumerator();f.MoveNext();)if(t=f.get_Current(),n=this._segmentTree.GetAllIntersecting(t.rect),System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.Segment.ctor,n)){i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.Segment.ctor);for(var r=0,e=n.length,u=n[r];r<e;r++,u=n[r])Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.Intersect(t.rect,u.get_p1(),u.get_p2())&&i.Add(u);System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.Segment.ctor,i)&&this.oldOverlapsSegments.Add(t,i)}},SaveCurrentOverlapsBoxesSegments:function(){this.SaveCurrentOverlapsBoxes();this.SaveCurrentOverlapsSegments()},DoOneIterationBoxesSegmentsAllRoots:function(){var n,t;for(this.SaveCurrentOverlapsBoxesSegments(),this.PrecomputeMovedCriticalNodesBoxesSegmentsAllRoots(),n=this._roots.GetEnumerator();n.MoveNext();)t=n.get_Current(),this.DoOneIterationBoxesSegments(t)},DoOneIterationBoxesSegments:function(n){var f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor),u,i,r,t,e,o;for(this.GetDfsOrder(n,f),u=f.GetEnumerator();u.MoveNext();)(i=u.get_Current(),r=this.movedCriticalNodes.get_Item$$TKey(i),System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor,r))&&((i.type==Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.AdditionalPointBoxSegmentOverlap?function(){var n={Value:t},r=this.HandleCaseAdditionalPointOvlp(i,n);return t=n.Value,r}.call(this):function(){var n={Value:t},r=this.HandleCaseRectMoveable(i,n);return t=n.Value,r}.call(this),e=this.GetAreaOldOverlapsBoxesSegments(r),this.translateAllRects(r,t),o=this.GetAreaOldOverlapsBoxesSegments(r),this.translateAllRects(r,Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(t)),e<=o)||this.MoveSubtree(i,t))},HandleCaseRectMoveable:function(n,t){if(n.parent.type==Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.RectFixed||n.parent.type==Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.RectMoveable)t.Value=this.RectsOverlap(n,n.parent)?Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.EdgeExpansionFactor,this.GetShiftUntilNoLongerOverlap(n.parent.rect,n.rect)):Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.EdgeContractionFactor,this.GetShiftUntilOverlap(n.parent.rect,n.rect));else{var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.sitePoint,n.parent.sitePoint);t.Value=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.BoxSegmentOverlapShiftFactor,this.GetShiftUntilNoLongerOverlapRectSeg(n.rect,n.parent.segment,i))}},GetShiftUntilNoLongerOverlapRectSeg:function(n,t,i){return Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOrthShiftUntilNoLongerOverlapRectSeg(n,t.get_p1(),t.get_p2(),i)},HandleCaseAdditionalPointOvlp:function(n,t){t.Value=this.RectsOverlap(n,n.parent)?Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.EdgeExpansionFactor,this.GetShiftUntilNoLongerOverlap(n.parent.rect,n.rect)):Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.EdgeContractionFactor,this.GetShiftUntilOverlap(n.parent.rect,n.rect))},GetAreaOldOverlapsBoxesSegments:function(n){for(var r=0,s=n.GetEnumerator(),t,u,h,f,i,e,o;s.MoveNext();){if(t=s.get_Current(),this.oldOverlapsBoxes.ContainsKey(t))for(i=this.oldOverlapsBoxes.get_Item$$TKey(t),u=i.GetEnumerator();u.MoveNext();)h=u.get_Current(),f=Microsoft.Msagl.Core.Geometry.Rectangle.Intersect(t.rect,h.rect),f.get_IsEmpty()||(r+=f.get_Area());if(this.oldOverlapsSegments.ContainsKey(t))for(i=this.oldOverlapsSegments.get_Item$$TKey(t),e=i.GetEnumerator();e.MoveNext();)o=e.get_Current(),r+=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOverlapAmount(t.rect,o.get_p1(),o.get_p2())}return r},translate:function(n,t){return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_LeftBottom(),t),Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_RightTop(),t))},translateAllRects:function(n,t){for(var r=n.GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),i.rect=this.translate(i.rect,t)},GetEdgesWithoutSegmentCrossings:function(n){for(var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor),r=n.GetEnumerator(),t;r.MoveNext();)t=r.get_Current(),this.IsCrossedBySegment(t)||i.Add(t);return i},InitConnectedComponents:function(n){for(var e=new Array(this.pointToTreeNode.get_Count()),o=this.pointToTreeNode.get_Values().GetEnumerator(),t,i,r,h,u,a,f,v;o.MoveNext();)t=o.get_Current(),e[t.id]=t;for(i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor),r=n.GetEnumerator();r.MoveNext();){var s=r.get_Current(),y=this.pointToTreeNode.get_Item$$TKey(s.get_A()).id,p=this.pointToTreeNode.get_Item$$TKey(s.get_B()).id;i.Add(function(){var n=new Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor;return n.set_Source(y),n.set_Target(p),n}.call(this))}for(h=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor,i,this.pointToTreeNode.get_Count())),u=h.GetEnumerator();u.MoveNext();){for(var w=u.get_Current(),c=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor),l=w.GetEnumerator();l.MoveNext();)a=l.get_Current(),c.Add(e[a]);this._subtrees.Add(c)}for(this.ChooseRootsRandom(),this.BuildForestFromCdtEdges(n),f=this._roots.GetEnumerator();f.MoveNext();)v=f.get_Current(),this.OrientTreeEdges(v)},ChooseRoots:function(){for(var n=this._subtrees.GetEnumerator();n.MoveNext();){var t=n.get_Current(),i=this.GetBoundingBox(t),r=this.GetClosestSiteToPreferFixed(t,i.get_Center());this._roots.Add(this.pointToTreeNode.get_Item$$TKey(r))}},ChooseRootsRandom:function(){for(var t=this._subtrees.GetEnumerator(),n;t.MoveNext();){for(var i=t.get_Current(),r=!1,u=i.GetEnumerator();u.MoveNext();)if(n=u.get_Current(),n.type==Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.AdditionalPointBoxSegmentOverlap){this._roots.Add(n);r=!0;break}r||(n=this.GetRandom(i),this._roots.Add(n))}},IsCrossedBySegment:function(n){for(var i=this._segmentTree.GetAllIntersecting(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n.get_A(),n.get_B())),u=!1,t=0,f=i.length,r=i[t];t<f;t++,r=i[t])if(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.SegmentsIntersect(n.get_A(),n.get_B(),r.get_p1(),r.get_p2())){u=!0;break}return u},InitTree:function(){var r=this.GetMstFromCdt(),n=this.GetEdgesWithoutSegmentCrossings(r),i,t;(function(){var n={Value:i},r={Value:t},u=this.AddNodesForBoxSegmentOverlaps(n,r);return i=n.Value,t=r.Value,u}).call(this);n.AddRange(t);this.InitConnectedComponents(n);this.treeSegments=n},GetTreeEdges:function(){return this.treeSegments}}};JsTypes.push(Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst);PixelPoint={fullname:"PixelPoint",baseTypeName:"System.ValueType",staticDefinition:{op_Division:function(n,t){return new PixelPoint.ctor$$Int32$$Int32(n.X/t|0,n.Y/t|0)},op_Subtraction:function(n,t){return new PixelPoint.ctor$$Int32$$Int32(n.X-t.X,n.Y-t.Y)},op_Addition:function(n,t){return new PixelPoint.ctor$$Int32$$Int32(n.X+t.X,n.Y+t.Y)},op_UnaryNegation:function(n){return new PixelPoint.ctor$$Int32$$Int32(-n.X,-n.Y)},op_Multiply:function(n,t){return n.X*t.X+n.Y*t.Y}},assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Int32$$Int32:function(n,t){this.X=0;this.Y=0;System.ValueType.ctor.call(this);this.X=n;this.Y=t},toString:function(){return System.String.Format$$String$$Object$$Object("({0},{1})",this.X,this.Y)},ctor:function(){this.X=0;this.Y=0;System.ValueType.ctor.call(this)}}};JsTypes.push(PixelPoint);Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$RectSegIntersection={fullname:"Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.INSIDE=0;Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.LEFT=1;Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.RIGHT=2;Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.BOTTOM=4;Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.TOP=8;Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.acc=1e-15},GetInt:function(n,t,i,r){var u=i-t,f=n-t;return System.Math.Abs$$Double(u/f)>Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.acc?(r.Value=f/u,!0):(r.Value=0,!1)},GetOutCode:function(n,t){var i=0;return t.get_X()<n.get_Left()?i|=1:t.get_X()>n.get_Right()&&(i|=2),t.get_Y()<n.get_Bottom()?i|=4:t.get_Y()>n.get_Top()&&(i|=8),i},GetIntX:function(n,t,i,r){return Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetInt(n,t.get_X(),i.get_X(),r)},GetIntY:function(n,t,i,r){return Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetInt(n,t.get_Y(),i.get_Y(),r)},GetIntersectionPointX:function(n,t,i,r){var u;return function(){var r={Value:u},f=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntX(n,t,i,r);return u=r.Value,f}()?u<0||u>1?(r.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,!1):(r.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(u,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t))),!0):(r.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,!1)},GetIntersectionPointY:function(n,t,i,r){var u;return function(){var r={Value:u},f=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntY(n,t,i,r);return u=r.Value,f}()?u<0||u>1?(r.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,!1):(r.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(u,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t))),!0):(r.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,!1)},GetIntersectionLeft:function(n,t,i,r){return Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionPointX(n.get_Left(),t,i,r)},GetIntersectionRight:function(n,t,i,r){return Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionPointX(n.get_Right(),t,i,r)},GetIntersectionBottom:function(n,t,i,r){return Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionPointY(n.get_Bottom(),t,i,r)},GetIntersectionTop:function(n,t,i,r){return Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionPointY(n.get_Top(),t,i,r)},GetOverlapAmountBothOnBorder:function(n,t,i){var u,f,e,o,s=function(){var r={Value:u},f=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionLeft(n,t,i,r);return u=r.Value,f}(),h=function(){var r={Value:f},u=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionRight(n,t,i,r);return f=r.Value,u}(),c=function(){var r={Value:o},u=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionBottom(n,t,i,r);return o=r.Value,u}(),l=function(){var r={Value:e},u=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionTop(n,t,i,r);return e=r.Value,u}(),a=n.get_Area(),r=0;return l&&c?r=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetHorizontalTrapezoidArea(n.get_LeftBottom(),o,e,n.get_LeftTop()):l&&s?r=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetTriangleArea(u,e,n.get_LeftTop()):l&&h?r=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetTriangleArea(f,n.get_RightTop(),e):s&&h?r=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetVerticalTrapezoidArea(n.get_LeftBottom(),n.get_RightBottom(),f,u):s&&c?r=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetTriangleArea(n.get_LeftBottom(),o,u):h&&c&&(r=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetTriangleArea(o,n.get_RightBottom(),f)),System.Math.Min$$Double$$Double(r,a-r)},GetOverlapAmount:function(n,t,i){var e=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOutCode(n,t),o=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOutCode(n,i),r,u,f;return(e|o)==0?(r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t).Normalize(),Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOverlapAmount(n,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,n.get_Diagonal())),Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,n.get_Diagonal())))):e==0?Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOverlapAmountInsideOutside(n,t,i):o==0?Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOverlapAmountInsideOutside(n,i,t):(function(){var r={Value:u},e={Value:f},o=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.ClipOnRect$$Rectangle$$Point$$Point$$Point$$Point(n,t,i,r,e);return u=r.Value,f=e.Value,o}(),Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOverlapAmountBothOnBorder(n,u,f))},Intersect:function(n,t,i){var r;return function(){var u={Value:r},f=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.ClipOnRect$$Rectangle$$Point$$Point$$Point(n,t,i,u);return r=u.Value,f}()},ClipOnRect$$Rectangle$$Point$$Point$$Point:function(n,t,i,r){var u,e,f;if(r.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X(),t.get_Y()),u=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOutCode(n,t),e=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOutCode(n,i),u==0)return r.Value=t,!0;while(u!=0){if((u&e)!=0)return r.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,!1;f=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r.Value.get_X(),r.Value.get_Y());(u&8)!=0?(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionPointY(n.get_Top(),f,i,r),r.Value.set_Y(n.get_Top())):(u&4)!=0?(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionPointY(n.get_Bottom(),f,i,r),r.Value.set_Y(n.get_Bottom())):(u&1)!=0?(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionPointX(n.get_Left(),f,i,r),r.Value.set_X(n.get_Left())):(u&2)!=0&&(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntersectionPointX(n.get_Right(),f,i,r),r.Value.set_X(n.get_Right()));u=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOutCode(n,r.Value)}return!0},ClipOnRect$$Rectangle$$Point$$Point$$Point$$Point:function(n,t,i,r,u){var f,e,o=function(){var r={Value:f},u=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.ClipOnRect$$Rectangle$$Point$$Point$$Point(n,t,i,r);return f=r.Value,u}();return o?(function(){var r={Value:e},u=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.ClipOnRect$$Rectangle$$Point$$Point$$Point(n,i,t,r);return e=r.Value,u}(),r.Value=f,u.Value=e,!0):(r.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,u.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,!1)},GetOverlapAmountInsideOutside:function(n,t,i){var u=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOutCode(n,i),r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,i).Normalize();return Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetOverlapAmount(n,i,Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,n.get_Diagonal())))},GetHorizontalTrapezoidArea:function(n,t,i,r){var u=r.get_Y()-n.get_Y(),f=t.get_X()-n.get_X(),e=i.get_X()-r.get_X();return u*(f+e)*.5},GetVerticalTrapezoidArea:function(n,t,i,r){var u=i.get_X()-r.get_X(),f=r.get_Y()-n.get_Y(),e=i.get_Y()-t.get_Y();return u*(f+e)*.5},GetTriangleArea:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,n),f=r.get_X()*u.get_Y()-r.get_Y()*u.get_X();return.5*System.Math.Abs$$Double(f)},SegmentsIntersect:function(n,t,i,r){var u=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t),f=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(i,r),e=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(u,f,!1);return System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor,e)},ClosestPointOnSegment:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),f=r.Normalize(),u=Microsoft.Msagl.Core.Geometry.Point.Dot(f,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,n))/r.get_Length(),e=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,u));return u<=0?n:u>=1?t:Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,u))},Dot:function(n,t){return n.get_X()*t.get_X()+n.get_Y()*t.get_Y()},GetOrthShiftUntilNoLongerOverlapRectSeg:function(n,t,i,r){var f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t).Rotate90Cw().Normalize(),u;return Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.Dot(f,r)<0&&(f=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(f)),u=0,u=System.Math.Min$$Double$$Double(u,Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.Dot(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_LeftBottom(),t),f)),u=System.Math.Min$$Double$$Double(u,Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.Dot(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_LeftTop(),t),f)),u=System.Math.Min$$Double$$Double(u,Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.Dot(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_RightBottom(),t),f)),u=System.Math.Min$$Double$$Double(u,Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.Dot(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_RightTop(),t),f)),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(-u,f)},GetBoundarySegments:function(n){var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor);return t.Add(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_LeftBottom(),n.get_RightBottom())),t.Add(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_RightBottom(),n.get_RightTop())),t.Add(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_RightTop(),n.get_LeftTop())),t.Add(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_LeftTop(),n.get_LeftBottom())),t},GetIntersectionWithRayFromRectOrigin:function(n,t){var r=1.79769313486232E+308,i=0,u=n.get_Center(),f=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Center(),t);return function(){var t={Value:i},r=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntX(n.get_Left(),u,f,t);return i=t.Value,r}(),i>0&&(r=System.Math.Min$$Double$$Double(r,i)),function(){var t={Value:i},r=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntX(n.get_Right(),u,f,t);return i=t.Value,r}(),i>0&&(r=System.Math.Min$$Double$$Double(r,i)),function(){var t={Value:i},r=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntY(n.get_Bottom(),u,f,t);return i=t.Value,r}(),i>0&&(r=System.Math.Min$$Double$$Double(r,i)),function(){var t={Value:i},r=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetIntY(n.get_Top(),u,f,t);return i=t.Value,r}(),i>0&&(r=System.Math.Min$$Double$$Double(r,i)),Microsoft.Msagl.Core.Geometry.Point.op_Addition(u,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(r,t))},GetScaled$$Rectangle$$Double:function(n,t){var i=n.Clone();return i.ScaleAroundCenter(t),i},GetScaled$$Rectangle$$Double$$Double:function(n,t,i){var r=n.get_Width()/2,u=n.get_Height()/2;return r*=t,u*=i,new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Center(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r,u)),Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Center(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r,u)))},IsSegmentTouchingSomeRectangle:function(n,t,i,r){var u=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n,t),f,e;return u=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetDilated(u,r),f=i.GetAllIntersecting(u),e=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.Geometry.Rectangle.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,null,f,function(n){return $CreateAnonymousObject({r:n,boxBig:Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetScaled$$Rectangle$$Double(n,1+r)})}),function(n){return $CreateAnonymousObject({x0:n,boxSmall:Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetScaled$$Rectangle$$Double(n.get_r(),1-r)})}),function(i){return Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.Intersect(i.get_x0().get_boxBig(),n,t)&&!Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.Intersect(i.get_boxSmall(),n,t)}),function(n){return n.get_x0().get_r()}),System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,e)},IsSegmentInsideBoundaryOfSomeRectangle:function(n,t,i,r){var s=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n,t),f,h;s=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetDilated(s,r);f=i.GetAllIntersecting(s);h=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Rectangle.ctor);for(var e=0,a=f.length,o=f[e];e<a;e++,o=f[e]){var c=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetDilated(o,r),l=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.RectSegIntersection.GetDilated(o,-r),u=!0;u&=c.Contains$$Point(n);u&=c.Contains$$Point(t);u&=!l.Contains$$Point(n);u&=!l.Contains$$Point(t);u&&h.Add(o)}return System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,h)},GetDilated:function(n,t){return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_LeftBottom(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,t)),Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_RightTop(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,t)))},ArePointsOnLine:function(n){for(var t=1;t<n.get_Count()-1;t++){var r=n.get_Item$$Int32(t-1),i=n.get_Item$$Int32(t),u=n.get_Item$$Int32(t+1),f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u,i);if(!Microsoft.Msagl.Core.Geometry.Point.ParallelWithinEpsilon(f,e,1))return!1}return!0}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$RectSegIntersection);Microsoft$Msagl$Miscellaneous$ConstrainedSkeleton$SteinerCdt={fullname:"Microsoft.Msagl.Miscellaneous.ConstrainedSkeleton.SteinerCdt",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this._pointsToIndices=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Int32.ctor);this._pointList=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);this._segments=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor);this._outPoints=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor);this._visGraph=null;this._nodeInfos=null;this._boundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._random=new System.Random.ctor;System.Object.ctor.call(this);this._visGraph=n;this._nodeInfos=t},MakeSureThatNodeBoundariesAreInVisGraph:function(n){for(var i=n.GetEnumerator(),r,t,u;i.MoveNext();)for(r=i.get_Current(),t=r.get_BoundaryOnLayer().get_PolylinePoints().GetEnumerator();t.MoveNext();)u=t.get_Current(),this._visGraph.AddVertex$$Point(u.get_Point())},SaveInputFilePoly:function(n){System.Console.WriteLine$$String("\nInitializing Cdt input");this.IndexPoints();this.InitSegments();System.Diagnostics.Debug.Assert$$Boolean(this.TopologyForCallingTriangleIsCorrect());System.Console.WriteLine$$String("\nWriting Cdt input");var t=new System.IO.StreamWriter.ctor$$String(n);try{this.WritePoints(t);this.WriteSegments(t);this.WriteHoles(t)}finally{t.Dispose()}},WriteHoles:function(n){var t,i,u,r;for(n.WriteLine$$String("# holes"),n.WriteLine$$Int32(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.LgNodeInfo.ctor,this._nodeInfos)),t=0,i=this._nodeInfos.GetEnumerator();i.MoveNext();)u=i.get_Current(),r=u.get_Center(),n.WriteLine$$String(t+1+" "+r.get_X()+" "+r.get_Y()),t++},WriteSegments:function(n){var t,i,r;for(n.WriteLine$$String("# segments"),n.WriteLine$$String(this._segments.get_Count()+" 0"),t=1,i=this._segments.GetEnumerator();i.MoveNext();)r=i.get_Current(),n.WriteLine$$String(t+" "+(r.get_A()+1)+" "+(r.get_B()+1)),t++},WritePoints:function(n){var i,t;for(n.WriteLine$$String("# vertices"),n.WriteLine$$String(this._pointsToIndices.get_Count()+" 2 0 0"),i=this._pointsToIndices.GetEnumerator();i.MoveNext();)t=i.get_Current(),n.WriteLine$$String(t.get_Value()+1+" "+t.get_Key().get_X()+" "+t.get_Key().get_Y())},LoadOutputFileNode:function(n){var h=this._pointList.get_Count(),u=new System.IO.StreamReader.ctor$$String(n),t,e,f,r,i,o,s;try{if(t=u.ReadLine(),t==null)throw $CreateException(new System.InvalidOperationException.ctor$$String("unexpected end of file"),new Error);for(System.Text.RegularExpressions.Regex.Split$$String$$String(t,"\\s{2,}"),e=System.Int32.Parse$$String(System.Linq.Enumerable.First$1$$IEnumerable$1(System.String.ctor,t.Split$$Char$Array(" "))),f=0;f<e;f++){if(t=u.ReadLine(),t==null)break;t=t.TrimStart(" ");r=System.Text.RegularExpressions.Regex.Split$$String$$String(t,"\\s{2,}");i=System.Int32.Parse$$String(r[0])-1;i<h?this._outPoints.set_Item$$TKey(i,this._visGraph.FindVertex(this._pointList.get_Item$$Int32(i))):(o=System.Double.Parse$$String(r[1]),s=System.Double.Parse$$String(r[2]),this._outPoints.set_Item$$TKey(i,this._visGraph.AddVertex$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(o,s))))}}finally{u.Dispose()}},LoadOutputFileSides:function(n){var i,t,f,r;this._visGraph.ClearEdges();i=new System.IO.StreamReader.ctor$$String(n);try{if(t=i.ReadLine(),t==null)throw $CreateException(new System.Exception.ctor$$String("unexpected end of file"),new Error);for(t=t.TrimStart(" "),f=System.Int32.Parse$$String(System.Linq.Enumerable.First$1$$IEnumerable$1(System.String.ctor,t.Split$$Char$Array(" "))),r=0;r<f;r++){if(t=i.ReadLine(),t==null)break;t=t.TrimStart(" ");var u=System.Text.RegularExpressions.Regex.Split$$String$$String(t,"\\s{2,}"),h=System.Int32.Parse$$String(u[1])-1,c=System.Int32.Parse$$String(u[2])-1,l=System.Int32.Parse$$String(u[3])-1,e=this._outPoints.get_Item$$TKey(h),o=this._outPoints.get_Item$$TKey(c),s=this._outPoints.get_Item$$TKey(l);this.AddVisEdge(e,o);this.AddVisEdge(o,s);this.AddVisEdge(s,e)}}finally{i.Dispose()}},AddVisEdge:function(n,t){n!=t?Microsoft.Msagl.Routing.Visibility.VisibilityGraph.AddEdge$$VisibilityVertex$$VisibilityVertex(n,t):System.Console.WriteLine$$String("avoiding creating a small visibility edge")},InitSegment:function(n,t){var i=this._pointsToIndices.get_Item$$TKey(n),r=this._pointsToIndices.get_Item$$TKey(t);this._segments.Insert(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(System.Int32.ctor,i,r))},IndexPoints:function(){this._pointsToIndices.Clear();this.IndexVisGraphVertices();this.IndexNodeInfos();this.CreateAndIndexBoundingBox()},IndexNodeInfos:function(){for(var n=this._nodeInfos.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.AddNodeBoundaryToPointIndices(t)},IndexVisGraphVertices:function(){var n,t;if(this._visGraph!=null)for(n=this._visGraph.Vertices().GetEnumerator();n.MoveNext();)t=n.get_Current(),this._pointsToIndices.set_Item$$TKey(t.Point,this._pointsToIndices.get_Count()),this._pointList.Add(t.Point)},CreateAndIndexBoundingBox:function(){var n,t;for(this._boundingBox=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox(),n=this._pointsToIndices.get_Keys().GetEnumerator();n.MoveNext();)t=n.get_Current(),this._boundingBox.Add$$Point(t);this._boundingBox.Pad$$Double(1);this.IndexAPoint(this._boundingBox.get_LeftBottom());this.IndexAPoint(this._boundingBox.get_RightBottom());this.IndexAPoint(this._boundingBox.get_LeftTop());this.IndexAPoint(this._boundingBox.get_RightTop())},AddNodeBoundaryToPointIndices:function(n){for(var t=n.get_BoundaryOnLayer().get_PolylinePoints().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.IndexAPoint(i.get_Point())},IndexAPoint:function(n){this._pointsToIndices.ContainsKey(n)||(this._pointsToIndices.set_Item$$TKey(n,this._pointsToIndices.get_Count()),this._pointList.Add(n),this._visGraph.AddVertex$$Point(n))},TopologyForCallingTriangleIsCorrect:function(){for(var t=new Array(this._pointsToIndices.get_Count()),i=this._pointsToIndices.GetEnumerator(),n,r,u;i.MoveNext();)n=i.get_Current(),t[n.get_Value()]=n.get_Key();return r=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Collections.Generic.KeyValuePair$2.ctor,this._pointsToIndices.get_Keys(),$CreateAnonymousDelegate(this,function(n){return new System.Collections.Generic.KeyValuePair$2.ctor$$TKey$$TValue(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(n),n)}))),u=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,null,this._segments,$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({e:n,overlaps:this.GetPointsOverlappingSeg(n,r,t)})})),$CreateAnonymousDelegate(this,function(n){return n.get_overlaps().get_Count()>2})),$CreateAnonymousDelegate(this,function(n){return n.get_e()}))),!System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,u)},GetPointsOverlappingSeg:function(n,t,i){var u=i[n.get_A()],e=i[n.get_B()],o=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(u,e),s,h,r,f,c;if(o.Pad$$Double(1e-5),s=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,t.GetAllIntersecting(o)),r=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,s,$CreateAnonymousDelegate(this,function(n){return function(){var t={Value:h},i=Microsoft.Msagl.Core.Geometry.Point.DistToLineSegment(n,u,e,t);return h=t.Value,i}.call(this)<1e-5}))),r=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Double.ctor,r,$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,u).get_Length()}))),r.get_Count()>2)for(System.Console.WriteLine$$String("overlapping points"),f=r.GetEnumerator();f.MoveNext();)c=f.get_Current(),System.Console.WriteLine$$Object(c);return r},InitSegments:function(){var n,t;for(this._segments.Clear(),this.InitSegsOfVisGraph(),n=this._nodeInfos.GetEnumerator();n.MoveNext();)t=n.get_Current(),this.InitSegsOfPolyline(t.get_BoundaryOnLayer());this.InitSegments$$Point$Array(this._boundingBox.get_LeftTop(),this._boundingBox.get_RightTop(),this._boundingBox.get_RightBottom(),this._boundingBox.get_LeftBottom())},InitSegsOfPolyline:function(n){var t=n.get_StartPoint(),u=this._pointsToIndices.get_Item$$TKey(t.get_Point()),i=u,r;do{if(t=t.get_Next(),t==null)break;r=this._pointsToIndices.get_Item$$TKey(t.get_Point());this._segments.Insert(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(System.Int32.ctor,i,r));i=r}while(1);this._segments.Insert(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(System.Int32.ctor,i,u))},InitSegments$$Point$Array:function(n){for(var t=0;t<n.length-1;t++)this.InitSegment(n[t],n[t+1]);this.InitSegment(n[n.length-1],n[0])},InitSegsOfVisGraph:function(){var n,r;if(this._visGraph!=null)for(n=this._visGraph.Vertices().GetEnumerator();n.MoveNext();)for(var t=n.get_Current(),u=this._pointsToIndices.get_Item$$TKey(t.Point),i=t.get_OutEdges().GetEnumerator();i.MoveNext();)r=i.get_Current(),this._segments.Insert(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(System.Int32.ctor,u,this._pointsToIndices.get_Item$$TKey(r.get_Target().Point)))},LaunchTriangleExe:function(){},ReadTriangleOutputAndPopulateTheLevelVisibilityGraphFromTriangulation:function(){var n=System.IO.Path.Combine$$String$$String(System.IO.Path.GetTempPath(),"pointssegments"+this._random.Next$$Int32(1e4)),t,arguments;this.SaveInputFilePoly(n+".poly");t="triangle.exe";arguments=n+".poly -c -q10 -S100000000";this.LaunchTriangleExe(t,arguments);System.Console.WriteLine$$String("loading output of triangle exe");this.LoadOutputFileNode(n+".1.node");this.LoadOutputFileSides(n+".1.ele");System.IO.File.Delete(n+".poly");System.IO.File.Delete(n+".1.node");System.IO.File.Delete(n+".1.ele");System.IO.File.Delete(n+".1.poly")}}};JsTypes.push(Microsoft$Msagl$Miscellaneous$ConstrainedSkeleton$SteinerCdt);Microsoft$Msagl$Prototype$Constraints$AlignmentConstraint={fullname:"Microsoft.Msagl.Prototype.Constraints.AlignmentConstraint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.Incremental.IConstraint"],Kind:"Class",definition:{ctor:function(n){this.nodes=null;System.Object.ctor.call(this);this.nodes=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Node.ctor,n)},leastSquaresLineFit:function(n,t){for(var i=0,r=0,s=0,h=0,c=0,u=this.nodes.get_Count(),l=this.nodes.GetEnumerator(),o;l.MoveNext();){var a=l.get_Current(),f=a.get_Center().get_X(),e=a.get_Center().get_Y();i+=f;r+=e;s+=f*f;h+=e*e;c+=f*e}i/=u;r/=u;o=.5*(h-u*r*r-(s-u*i*i))/(u*i*r-c);t.Value=System.Math.Sqrt(o*o+1)-o;n.Value=r-t.Value*i},Project:function(){var i,n,u=0,r;for(function(){var t={Value:i},r={Value:n},u=this.leastSquaresLineFit(t,r);return i=t.Value,n=r.Value,u}.call(this),r=this.nodes.GetEnumerator();r.MoveNext();){var t=r.get_Current(),o=t.get_Center().get_X(),s=t.get_Center().get_Y(),f=(n*s+o)/(n*n+1),h=i+n*f,e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(f,h);u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Center(),e).get_Length();t.set_Center(e)}return u},Level$$:"System.Int32",get_Level:function(){return 1},Nodes$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Node]]",get_Nodes:function(){return this.nodes}}};JsTypes.push(Microsoft$Msagl$Prototype$Constraints$AlignmentConstraint);Microsoft$Msagl$Miscellaneous$LayoutEditing$BumperPusher={fullname:"Microsoft.Msagl.Miscellaneous.LayoutEditing.BumperPusher",baseTypeName:"System.Object",staticDefinition:{PushByPoint:function(n,t){n.get_UserData().set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_UserData().get_Center(),t));var i=As(n.get_UserData(),Microsoft.Msagl.Core.Layout.Cluster.ctor);i!=null&&i.DeepContentsTranslation(t,!0)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.separation=0;this.fixedNodes=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor);this.rtree=null;this.pushingNodes=null;System.Object.ctor.call(this);this.separation=t;this.rtree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor$$RectangleNode$1(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Core.Layout.Node.ctor,n,this.GetPaddedBoxOfNode(n))}))));this.pushingNodes=i},FixedNodes$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Node]]",get_FixedNodes:function(){return this.fixedNodes},GetPaddedBoxOfNode:function(n){var t=n.get_BoundaryCurve().get_BoundingBox().Clone();return t.Pad$$Double(this.separation/2),t},PushNodes:function(){var n,i,u,r,t;for(this.fixedNodes.Clear(),this.fixedNodes.InsertRange(this.pushingNodes),n=new System.Collections.Generic.Queue$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,this.pushingNodes),i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor);n.get_Count()>0;)for(u=n.Dequeue(),r=this.PushByNodeAndReportPushedAsFixed(u).GetEnumerator();r.MoveNext();)t=r.get_Current(),n.Enqueue(t),this.fixedNodes.Insert(t),i.Add(t);return i},PushByNodeAndReportPushedAsFixed:function(n){for(var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),u=this.GetPaddedBoxOfNode(n),r=this.rtree.GetAllLeavesIntersectingRectangle(u).GetEnumerator(),t;r.MoveNext();)(t=r.get_Current(),this.fixedNodes.Contains$$T(t.get_UserData()))||this.PushNodeAndUpdateRTree(n,t)&&i.Add(t.get_UserData());return i},PushNodeAndUpdateRTree:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_UserData().get_Center(),n.get_Center()),s=n.get_Width()/2+t.get_UserData().get_Width()/2,h=n.get_Height()/2+t.get_UserData().get_Height()/2,e=System.Math.Abs$$Double(i.get_X()),o=System.Math.Abs$$Double(i.get_Y()),u=e-s,f=o-h,r;return u>=this.separation||f>=this.separation?!1:(e>=o?(r=i.get_X()>0?this.separation-u:u-this.separation,this.PushByX(r,t)):(r=i.get_Y()>0?this.separation-f:f-this.separation,this.PushByY(r,t)),this.UpdateBoundingBoxesOfPushedAndUpParents(t),!0)},PushByX:function(n,t){var i=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,0);Microsoft.Msagl.Miscellaneous.LayoutEditing.BumperPusher.PushByPoint(t,i)},PushByY:function(n,t){var i=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,n);Microsoft.Msagl.Miscellaneous.LayoutEditing.BumperPusher.PushByPoint(t,i)},UpdateBoundingBoxesOfPushedAndUpParents:function(n){n.set_Rectangle(this.GetPaddedBoxOfNode(n.get_UserData()));for(var t=n.get_Parent();t!=null;)t.set_Rectangle(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(t.get_Left().get_Rectangle(),t.get_Right().get_Rectangle())),t=t.get_Parent()},UpdateRTreeByChangedNodeBox:function(n,t){var i=this.FindClusterNode(n,t);this.UpdateBoundingBoxesOfPushedAndUpParents(i)},FindClusterNode:function(n,t){var i=this.rtree.get_RootNode();return this.FindClusterNodeRecurse(i,n,t)},FindClusterNodeRecurse:function(n,t,i){if(n.get_UserData()!=null)return n.get_UserData()==t?n:null;var r=null;return(i.Intersects(n.get_Left().get_Rectangle())&&(r=this.FindClusterNodeRecurse(n.get_Left(),t,i)),r!=null)?r:i.Intersects(n.get_Right().get_Rectangle())?this.FindClusterNodeRecurse(n.get_Right(),t,i):null},FirstPushingNode:function(){return this.pushingNodes[0]}}};JsTypes.push(Microsoft$Msagl$Miscellaneous$LayoutEditing$BumperPusher);Microsoft$Msagl$Miscellaneous$LayoutEditing$IncrementalDragger={fullname:"Microsoft.Msagl.Miscellaneous.LayoutEditing.IncrementalDragger",baseTypeName:"System.Object",staticDefinition:{DefaultClusterParent:function(n){return System.Linq.Enumerable.FirstOrDefault$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_ClusterParents())}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.nodeSeparation=0;this.layoutSettings=null;this.listOfPushers=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Miscellaneous.LayoutEditing.BumperPusher.ctor);this.pushingNodesArray=null;this.ChangedGraph=null;this.labelFixtures=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,Microsoft.Msagl.Miscellaneous.LayoutEditing.LabelFixture.ctor);this._graph=null;System.Object.ctor.call(this);this.set_graph(t);this.nodeSeparation=i.get_NodeSeparation();this.layoutSettings=i;this.pushingNodesArray=n instanceof Array?n:System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,n);System.Diagnostics.Debug.Assert$$Boolean$$String(System.Linq.Enumerable.All$1(Microsoft.Msagl.Core.Layout.Node.ctor,this.pushingNodesArray,$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Miscellaneous.LayoutEditing.IncrementalDragger.DefaultClusterParent(n)==null}))||new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Cluster.ctor,this.pushingNodesArray,$CreateAnonymousDelegate(this,function(n){return System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_ClusterParents())}))).get_Count()==1,"dragged nodes have to belong to the same cluster");this.InitBumperPushers()},graph$$:"Microsoft.Msagl.Core.Layout.GeometryGraph",get_graph:function(){return this._graph},set_graph:function(n){this._graph=n},InitBumperPushers:function(){var n,t;if(this.pushingNodesArray.length!=0)if(n=Microsoft.Msagl.Miscellaneous.LayoutEditing.IncrementalDragger.DefaultClusterParent(this.pushingNodesArray[0]),n==null)this.listOfPushers.Add(new Microsoft.Msagl.Miscellaneous.LayoutEditing.BumperPusher.ctor(this.get_graph().get_Nodes(),this.nodeSeparation,this.pushingNodesArray));else{this.listOfPushers.Add(new Microsoft.Msagl.Miscellaneous.LayoutEditing.BumperPusher.ctor(System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes(),n.get_Clusters()),this.nodeSeparation,this.pushingNodesArray));do{if(t=n,n=Microsoft.Msagl.Miscellaneous.LayoutEditing.IncrementalDragger.DefaultClusterParent(n),n==null)break;this.listOfPushers.Add(new Microsoft.Msagl.Miscellaneous.LayoutEditing.BumperPusher.ctor(System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes(),n.get_Clusters()),this.nodeSeparation,[t]))}while(1)}},RunPushers:function(){for(var i,n,r,u,t=0;t<this.listOfPushers.get_Count();t++){if(i=this.listOfPushers.get_Item$$Int32(t),i.PushNodes(),n=Microsoft.Msagl.Miscellaneous.LayoutEditing.IncrementalDragger.DefaultClusterParent(i.FirstPushingNode()),n==null||n==this.get_graph().get_RootCluster())break;if(r=n.get_BoundaryCurve().get_BoundingBox(),n.CalculateBoundsFromChildren(this.layoutSettings.get_ClusterMargin()),System.Diagnostics.Debug.Assert$$Boolean(System.Linq.Enumerable.All$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes(),$CreateAnonymousDelegate(this,function(t){return n.get_BoundingBox().Contains$$Rectangle(t.get_BoundingBox())}))),u=n.get_BoundaryCurve().get_BoundingBox(),Microsoft.Msagl.Core.Geometry.Rectangle.op_Equality(u,r))break;this.listOfPushers.get_Item$$Int32(t+1).UpdateRTreeByChangedNodeBox(n,r)}},Drag:function(n){var u;if(n.get_Length()>0)for(var t=0,r=this.pushingNodesArray,f=r.length,i=r[t];t<f;t++,i=r[t])i.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Center(),n)),u=As(i,Microsoft.Msagl.Core.Layout.Cluster.ctor),u!=null&&u.DeepContentsTranslation(n,!0);this.RunPushers();this.RouteChangedEdges()},RouteChangedEdges:function(){var n,t;this.ChangedGraph=this.GetChangedFlatGraph();n=Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor.CreateClusteredSubgraphFromFlatGraph(this.ChangedGraph,this.get_graph());this.InitLabelFixtures(n);t=function(){var t=new Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$Double$$Double$$Double$$BundlingSettings(n,this.layoutSettings.get_EdgeRoutingSettings().get_Padding(),this.layoutSettings.get_EdgeRoutingSettings().get_PolylinePadding(),this.layoutSettings.get_EdgeRoutingSettings().get_ConeAngle(),this.layoutSettings.get_EdgeRoutingSettings().get_BundlingSettings());return t.set_ContinueOnOverlaps(!0),t}.call(this);t.Run();this.PositionLabels(n)},PositionLabels:function(n){for(var t=n.get_Edges().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.PositionEdge(i)},PositionEdge:function(n){var t;if(function(){var i={Value:t},r=this.labelFixtures.TryGetValue(n.get_EdgeGeometry(),i);return t=i.Value,r}.call(this)){var i=n.get_Curve(),f=i.get_Length()*t.RelativeLengthOnCurve,r=i.GetParameterAtLength(f),u=i.Derivative(r),e=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double((t.RightSide?u.Rotate90Cw():u.Rotate90Ccw()).Normalize(),t.NormalLength);n.get_Label().set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Item$$Double(r),e))}},InitLabelFixtures:function(n){for(var t=n.get_Edges().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.InitLabelFixture(i)},InitLabelFixture:function(n){if(n.get_Label()!=null&&!this.labelFixtures.ContainsKey(n.get_EdgeGeometry())){var i=n.get_Curve().ClosestParameter(n.get_Label().get_Center()),t=n.get_Curve(),u=t.Derivative(i),f=u.Rotate90Cw(),r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Label().get_Center(),t.get_Item$$Double(i)),e=function(){var n=new Microsoft.Msagl.Miscellaneous.LayoutEditing.LabelFixture.ctor;return n.RelativeLengthOnCurve=t.LengthPartial(0,i)/t.get_Length(),n.NormalLength=r.get_Length(),n.RightSide=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,f)>0,n}.call(this);this.labelFixtures.set_Item$$TKey(n.get_EdgeGeometry(),e)}},GetChangedFlatGraph:function(){for(var n=this.GetChangedNodes(),i=this.GetChangedEdges(n),r=i.GetEnumerator(),t;r.MoveNext();)t=r.get_Current(),n.Insert(t.get_Source()),n.Insert(t.get_Target());return function(){var t=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor;return t.set_Nodes(new Microsoft.Msagl.Layout.LargeGraphLayout.SimpleNodeCollection.ctor(n)),t.set_Edges(new Microsoft.Msagl.Layout.LargeGraphLayout.SimpleEdgeCollection.ctor(i)),t}.call(this)},GetChangedEdges:function(n){for(var u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor),t=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox(),f=n.GetEnumerator(),e,o,i,r;f.MoveNext();)e=f.get_Current(),t.Add$$Rectangle(e.get_BoundaryCurve().get_BoundingBox());for(o=t.Perimeter(),i=this.get_graph().get_Edges().GetEnumerator();i.MoveNext();)r=i.get_Current(),function(){var i={Value:t},u=this.EdgeNeedsRouting(i,r,o,n);return t=i.Value,u}.call(this)&&u.Add(r);return u},EdgeNeedsRouting:function(n,t,i,r){return t.get_Curve()==null?!0:r.Contains$$T(t.get_Source())||r.Contains$$T(t.get_Target())?!0:t.get_Source().get_BoundaryCurve().get_BoundingBox().Intersects(n.Value)||t.get_Target().get_BoundaryCurve().get_BoundingBox().Intersects(n.Value)?!0:t.get_BoundingBox().Intersects(n.Value)?Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(i,t.get_Curve(),!1)!=null:!1},GetChangedNodes:function(){return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Miscellaneous.LayoutEditing.BumperPusher.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,this.listOfPushers,$CreateAnonymousDelegate(this,function(n){return n.get_FixedNodes()})))}}};JsTypes.push(Microsoft$Msagl$Miscellaneous$LayoutEditing$IncrementalDragger);Microsoft$Msagl$Miscellaneous$LayoutEditing$LabelFixture={fullname:"Microsoft.Msagl.Miscellaneous.LayoutEditing.LabelFixture",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.RelativeLengthOnCurve=0;this.RightSide=!1;this.NormalLength=0;System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Miscellaneous$LayoutEditing$LabelFixture);Microsoft$Msagl$Miscellaneous$LayoutHelpers={fullname:"Microsoft.Msagl.Miscellaneous.LayoutHelpers",baseTypeName:"System.Object",staticDefinition:{CalculateLayout:function(n,t,i,r){var e,o,s,h,u,c,f;Is(t,Microsoft.Msagl.Prototype.Ranking.RankingLayoutSettings.ctor)?(e=As(t,Microsoft.Msagl.Prototype.Ranking.RankingLayoutSettings.ctor),o=new Microsoft.Msagl.Prototype.Ranking.RankingLayout.ctor(e,n),o.Run$$CancelToken(i),Microsoft.Msagl.Miscellaneous.LayoutHelpers.RouteAndLabelEdges(n,t,n.get_Edges())):Is(t,Microsoft.Msagl.Layout.MDS.MdsLayoutSettings.ctor)?(s=As(t,Microsoft.Msagl.Layout.MDS.MdsLayoutSettings.ctor),h=new Microsoft.Msagl.Layout.MDS.MdsGraphLayout.ctor(s,n),h.Run$$CancelToken(i),t.get_EdgeRoutingSettings().get_EdgeRoutingMode()!=Microsoft.Msagl.Core.Routing.EdgeRoutingMode.None&&Microsoft.Msagl.Miscellaneous.LayoutHelpers.RouteAndLabelEdges(n,t,n.get_Edges())):Is(t,Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor)?(u=As(t,Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor),u.set_AvoidOverlaps(!0),c=new Microsoft.Msagl.Layout.Initial.InitialLayout.ctor(n,u),c.Run$$CancelToken(i),t.get_EdgeRoutingSettings().get_EdgeRoutingMode()!=Microsoft.Msagl.Core.Routing.EdgeRoutingMode.None&&Microsoft.Msagl.Miscellaneous.LayoutHelpers.RouteAndLabelEdges(n,t,n.get_Edges())):(f=As(t,Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings.ctor),f!=null?Microsoft.Msagl.Miscellaneous.LayoutHelpers.ProcessSugiamaLayout(n,f,i):(System.Diagnostics.Debug.Assert$$Boolean(Is(t,Microsoft.Msagl.Layout.LargeGraphLayout.LgLayoutSettings.ctor)),Microsoft.Msagl.Miscellaneous.LayoutHelpers.LayoutLargeGraphWithLayers(n,t,i,r)))},LayoutLargeGraphWithLayers:function(n,t,i,r){var u=Cast(t,Microsoft.Msagl.Layout.LargeGraphLayout.LgLayoutSettings.ctor),f=new Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor.ctor(n,u,i);u.set_Interactor(f);f.Run(r)},ComputeNodeLabelsOfLargeGraphWithLayers:function(n,t,i){var u=Cast(t,Microsoft.Msagl.Layout.LargeGraphLayout.LgLayoutSettings.ctor),r=u.get_Interactor();r.InitNodeLabelWidthToHeightRatios(i);r.LabelingOfOneRun()},ProcessSugiamaLayout:function(n,t,i){var r,f=function(){var i={Value:r},u=Microsoft.Msagl.Miscellaneous.LayoutHelpers.HandleTransformIsNotIdentity(n,t,i);return r=i.Value,u}(),u;System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_RootCluster().get_Clusters())?(Microsoft.Msagl.Miscellaneous.LayoutHelpers.PrepareGraphForInitialLayoutByCluster(n,t),u=new Microsoft.Msagl.Layout.Initial.InitialLayoutByCluster.ctor$$GeometryGraph$$Func$2$Cluster$LayoutAlgorithmSettings(n,function(){return t}),u.Run$$CancelToken(i),Microsoft.Msagl.Miscellaneous.LayoutHelpers.RouteAndLabelEdges(n,t,System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_Edges(),function(n){return n.get_Curve()==null})))):n.AlgorithmData=Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings.CalculateLayout(n,t,i);f&&t.set_Transformation(r);Microsoft.Msagl.Miscellaneous.LayoutHelpers.PostRunTransform(n,t)},HandleTransformIsNotIdentity:function(n,t,i){var s=!t.get_Transformation().get_IsIdentity(),u,f,h,e,r,o;if(i.Value=t.get_Transformation(),s){for(u=t.get_Transformation().get_Inverse(),f=n.get_Nodes().GetEnumerator();f.MoveNext();)h=f.get_Current(),h.Transform(u);for(e=n.get_Edges().GetEnumerator();e.MoveNext();)r=e.get_Current(),r.get_Label()!=null&&(r.set_OriginalLabelWidth(r.get_Label().get_Width()),r.set_OriginalLabelHeight(r.get_Label().get_Height()),o=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(u,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0)),Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(u,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r.get_Label().get_Width(),r.get_Label().get_Height()))),r.get_Label().set_Width(o.get_Width()),r.get_Label().set_Height(o.get_Height()))}return t.set_Transformation(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.get_UnitTransformation()),s},PrepareGraphForInitialLayoutByCluster:function(n,t){for(var e=n.get_RootCluster().AllClustersDepthFirst().GetEnumerator(),r,f,i,u;e.MoveNext();)r=e.get_Current(),r.get_RectangularBoundary()==null&&r.set_RectangularBoundary(function(){var n=new Microsoft.Msagl.Core.Geometry.RectangularClusterBoundary.ctor;return n.set_TopMargin(10),n}()),r.get_BoundaryCurve()==null&&r.set_BoundaryCurve(new Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor$$Rectangle$$Double$$Double(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(0,0,10,10),3,3));for(f=n.get_Edges().GetEnumerator();f.MoveNext();)i=f.get_Current(),i.set_Curve(null),i.get_SourcePort()==null&&(u=i,i.set_SourcePort(function(n){return new Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point(function(){return n.get_Source().get_BoundaryCurve()},function(){return n.get_Source().get_Center()})}(u))),i.get_TargetPort()==null&&(u=i,i.set_TargetPort(function(n){return new Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point(function(){return n.get_Target().get_BoundaryCurve()},function(){return n.get_Target().get_Center()})}(u)));t.get_FallbackLayoutSettings()==null&&t.set_FallbackLayoutSettings(function(){var n=new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor;return n.set_AvoidOverlaps(!0),n}());Microsoft.Msagl.Miscellaneous.LayoutHelpers.AddOrphanNodesToRootCluster(n)},AddOrphanNodesToRootCluster:function(n){for(var r=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),u=n.get_RootCluster().AllClustersDepthFirst().GetEnumerator(),f,t,i;u.MoveNext();)f=u.get_Current(),r.InsertRange(f.get_Nodes());for(t=n.get_Nodes().GetEnumerator();t.MoveNext();)(i=t.get_Current(),r.Contains$$T(i))||n.get_RootCluster().AddNode(i)},RouteAndLabelEdges:function(n,t,i){var u=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,i,function(n){return!n.UnderCollapsedCluster()})),r=t.get_EdgeRoutingSettings(),e,f,o,s;r.get_EdgeRoutingMode()==Microsoft.Msagl.Core.Routing.EdgeRoutingMode.Rectilinear||r.get_EdgeRoutingMode()==Microsoft.Msagl.Core.Routing.EdgeRoutingMode.RectilinearToCenter?Microsoft.Msagl.Routing.Rectilinear.RectilinearInteractiveEditor.CreatePortsAndRouteEdges$$Double$$Double$$IEnumerable$1$Node$$IEnumerable$1$Edge$$EdgeRoutingMode$$Boolean$$Boolean$$Double(t.get_NodeSeparation()/3,t.get_NodeSeparation()/3,n.get_Nodes(),i,r.get_EdgeRoutingMode(),!0,r.get_UseObstacleRectangles(),r.get_BendPenalty()):r.get_EdgeRoutingMode()==Microsoft.Msagl.Core.Routing.EdgeRoutingMode.Spline||r.get_EdgeRoutingMode()==Microsoft.Msagl.Core.Routing.EdgeRoutingMode.SugiyamaSplines?function(){var t=new Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$IEnumerable$1$Edge$$Double$$Double$$Double$$BundlingSettings(n,u,r.get_Padding(),r.get_PolylinePadding(),r.get_ConeAngle(),null);return t.set_ContinueOnOverlaps(!0),t.set_KeepOriginalSpline(r.get_KeepOriginalSpline()),t}().Run():r.get_EdgeRoutingMode()==Microsoft.Msagl.Core.Routing.EdgeRoutingMode.SplineBundling?(e=r.get_BundlingSettings()!=null?r.get_BundlingSettings():new Microsoft.Msagl.Core.Routing.BundlingSettings.ctor,f=function(){var t=new Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$IEnumerable$1$Edge$$Double$$Double$$Double$$BundlingSettings(n,u,r.get_Padding(),r.get_PolylinePadding(),r.get_ConeAngle(),e);return t.set_KeepOriginalSpline(r.get_KeepOriginalSpline()),t}(),f.Run(),f.get_OverlapsDetected()&&function(){var t=new Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$IEnumerable$1$Edge$$Double$$Double$$Double$$BundlingSettings(n,u,r.get_Padding(),r.get_PolylinePadding(),r.get_ConeAngle(),null);return t.set_ContinueOnOverlaps(!0),t.set_KeepOriginalSpline(r.get_KeepOriginalSpline()),t}().Run()):r.get_EdgeRoutingMode()==Microsoft.Msagl.Core.Routing.EdgeRoutingMode.StraightLine&&(o=new Microsoft.Msagl.Routing.StraightLineEdges.ctor(u,r.get_Padding()),o.Run());s=new Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.ctor$$IEnumerable$1$Node$$IEnumerable$1$Edge(n.get_Nodes(),u);s.Run();n.UpdateBoundingBox()},IncrementalLayout:function(n,t,i){if(i!=null){var r=As(n.AlgorithmData,Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.ctor);r!=null&&(r.IncrementalRun(t),Microsoft.Msagl.Miscellaneous.LayoutHelpers.PostRunTransform(n,i))}},PostRunTransform:function(n,t){var o=!t.get_Transformation().get_IsIdentity(),u,f,i,e,r;if(o){for(u=n.get_Nodes().GetEnumerator();u.MoveNext();)i=u.get_Current(),i.Transform(t.get_Transformation());for(f=n.get_RootCluster().AllClustersDepthFirst().GetEnumerator();f.MoveNext();)i=f.get_Current(),i.Transform(t.get_Transformation()),i.get_BoundaryCurve()!=null&&i.get_RectangularBoundary().set_Rect(i.get_BoundaryCurve().get_BoundingBox());for(e=n.get_Edges().GetEnumerator();e.MoveNext();)r=e.get_Current(),r.get_Label()!=null&&(r.get_Label().set_Width(r.get_OriginalLabelWidth()),r.get_Label().set_Height(r.get_OriginalLabelHeight()));Microsoft.Msagl.Miscellaneous.LayoutHelpers.TransformCurves(n,t)}n.UpdateBoundingBox()},TransformCurves:function(n,t){var u=t.get_Transformation(),f,i,r;for(n.set_BoundingBox(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(u,n.get_LeftBottom()),Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(u,n.get_RightTop()))),f=n.get_Edges().GetEnumerator();f.MoveNext();)i=f.get_Current(),i.get_Label()!=null&&i.get_Label().set_Center(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(u,i.get_Label().get_Center())),i.get_Curve()!=null&&(i.set_Curve(i.get_Curve().Transform(u)),r=i.get_EdgeGeometry(),r.get_SourceArrowhead()!=null&&r.get_SourceArrowhead().set_TipPosition(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(u,r.get_SourceArrowhead().get_TipPosition())),r.get_TargetArrowhead()!=null&&r.get_TargetArrowhead().set_TipPosition(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(u,r.get_TargetArrowhead().get_TipPosition())),Microsoft.Msagl.Miscellaneous.LayoutHelpers.TransformUnderlyingPolyline(i,t))},TransformUnderlyingPolyline:function(n,t){if(n.get_UnderlyingPolyline()!=null)for(var i=n.get_UnderlyingPolyline().get_HeadSite();i!=null;i=i.get_Next())i.set_Point(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(t.get_Transformation(),i.get_Point()))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Miscellaneous$LayoutHelpers);Microsoft$Msagl$Prototype$LayoutEditing$EdgeRestoreData={fullname:"Microsoft.Msagl.Prototype.LayoutEditing.EdgeRestoreData",baseTypeName:"Microsoft.Msagl.Prototype.LayoutEditing.RestoreData",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){var i,t;this.labelCenter=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._UnderlyingPolyline=null;this._Curve=null;this._ArrowheadAtSourcePosition=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._ArrowheadAtTargetPosition=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._LabelOffsetFromTheAttachmentPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._LabelAttachmentParameter=0;Microsoft.Msagl.Prototype.LayoutEditing.RestoreData.ctor.call(this);n.get_UnderlyingPolyline()==null&&(i=As(n.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor)!=null?As(n.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor):new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$List$1$ICurve(function(){var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor);return t.Add(n.get_Curve()),t}.call(this)),n.set_UnderlyingPolyline(Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints(System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Geometry.Point.ctor,[n.get_Source().get_Center()],Microsoft.Msagl.Core.Geometry.Curves.Polyline.PolylineFromCurve(i)),[n.get_Target().get_Center()]))));this.set_UnderlyingPolyline(n.get_UnderlyingPolyline().Clone());this.set_Curve(n.get_Curve().Clone());n.get_EdgeGeometry().get_SourceArrowhead()!=null&&this.set_ArrowheadAtSourcePosition(n.get_EdgeGeometry().get_SourceArrowhead().get_TipPosition());n.get_EdgeGeometry().get_TargetArrowhead()!=null&&this.set_ArrowheadAtTargetPosition(n.get_EdgeGeometry().get_TargetArrowhead().get_TipPosition());n.get_Label()!=null&&n.get_UnderlyingPolyline()!=null&&(this.labelCenter=n.get_Label().get_Center(),t=n.get_UnderlyingPolyline().CreateCurve(),this.set_LabelAttachmentParameter(t.ClosestParameter(this.labelCenter)),this.set_LabelOffsetFromTheAttachmentPoint(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.labelCenter,t.get_Item$$Double(this.get_LabelAttachmentParameter()))))},UnderlyingPolyline$$:"Microsoft.Msagl.Core.Geometry.SmoothedPolyline",get_UnderlyingPolyline:function(){return this._UnderlyingPolyline},set_UnderlyingPolyline:function(n){this._UnderlyingPolyline=n},LabelCenter$$:"Microsoft.Msagl.Core.Geometry.Point",get_LabelCenter:function(){return this.labelCenter},set_LabelCenter:function(n){this.labelCenter=n},Curve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Curve:function(){return this._Curve},set_Curve:function(n){this._Curve=n},ArrowheadAtSourcePosition$$:"Microsoft.Msagl.Core.Geometry.Point",get_ArrowheadAtSourcePosition:function(){return this._ArrowheadAtSourcePosition},set_ArrowheadAtSourcePosition:function(n){this._ArrowheadAtSourcePosition=n},ArrowheadAtTargetPosition$$:"Microsoft.Msagl.Core.Geometry.Point",get_ArrowheadAtTargetPosition:function(){return this._ArrowheadAtTargetPosition},set_ArrowheadAtTargetPosition:function(n){this._ArrowheadAtTargetPosition=n},LabelOffsetFromTheAttachmentPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_LabelOffsetFromTheAttachmentPoint:function(){return this._LabelOffsetFromTheAttachmentPoint},set_LabelOffsetFromTheAttachmentPoint:function(n){this._LabelOffsetFromTheAttachmentPoint=n},LabelAttachmentParameter$$:"System.Double",get_LabelAttachmentParameter:function(){return this._LabelAttachmentParameter},set_LabelAttachmentParameter:function(n){this._LabelAttachmentParameter=n}}};JsTypes.push(Microsoft$Msagl$Prototype$LayoutEditing$EdgeRestoreData);Microsoft$Msagl$Prototype$LayoutEditing$GraphRestoreData={fullname:"Microsoft.Msagl.Prototype.LayoutEditing.GraphRestoreData",baseTypeName:"Microsoft.Msagl.Prototype.LayoutEditing.RestoreData",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){Microsoft.Msagl.Prototype.LayoutEditing.RestoreData.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Prototype$LayoutEditing$GraphRestoreData);Microsoft$Msagl$Prototype$LayoutEditing$LabelRestoreData={fullname:"Microsoft.Msagl.Prototype.LayoutEditing.LabelRestoreData",baseTypeName:"Microsoft.Msagl.Prototype.LayoutEditing.RestoreData",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.center=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Prototype.LayoutEditing.RestoreData.ctor.call(this);this.center=n},Center$$:"Microsoft.Msagl.Core.Geometry.Point",get_Center:function(){return this.center},set_Center:function(n){this.center=n}}};JsTypes.push(Microsoft$Msagl$Prototype$LayoutEditing$LabelRestoreData);Microsoft$Msagl$Prototype$LayoutEditing$NodeRestoreData={fullname:"Microsoft.Msagl.Prototype.LayoutEditing.NodeRestoreData",baseTypeName:"Microsoft.Msagl.Prototype.LayoutEditing.RestoreData",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.boundaryCurve=null;Microsoft.Msagl.Prototype.LayoutEditing.RestoreData.ctor.call(this);this.boundaryCurve=n},BoundaryCurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_BoundaryCurve:function(){return this.boundaryCurve},set_BoundaryCurve:function(n){this.boundaryCurve=n}}};JsTypes.push(Microsoft$Msagl$Prototype$LayoutEditing$NodeRestoreData);Microsoft$Msagl$Prototype$LayoutEditing$ObstacleCalculator={fullname:"Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator",baseTypeName:"System.Object",staticDefinition:{TraverseHierarchy:function(n,t){t(n);n.get_Left()!=null&&Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.TraverseHierarchy(n.get_Left(),t);n.get_Right()!=null&&Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.TraverseHierarchy(n.get_Right(),t)},ConnectedComponents:function(n){for(var u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.DataStructures.Set$1.ctor),i=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),f=n.get_Nodes().GetEnumerator(),r,t;f.MoveNext();)r=f.get_Current(),i.Contains$$T(r)||(t=Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.GetComponent(r,n),t.get_Count()>1&&u.Add(t),i=Microsoft.Msagl.Core.DataStructures.Set$1.op_Addition(i,t));return u},GetComponent:function(n,t){var r=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),i,f,u;for(r.Insert(n),i=new System.Collections.Generic.Queue$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),i.Enqueue(n);i.get_Count()>0;)for(f=t.Descendents(i.Dequeue()).GetEnumerator();f.MoveNext();)u=f.get_Current(),r.Contains$$T(u)||(i.Enqueue(u),r.Insert(u));return r},CreateRectNodeOfPolyline:function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,As(n,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor).get_BoundingBox())},OneCurveLiesInsideOfOther:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n.get_Start(),t)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside||Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t.get_Start(),n)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside},GetPaddedPolyline:function(n,t){return Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CreatePaddedPolyline(Microsoft.Msagl.Core.Geometry.Curves.Curve.PolylineAroundClosedCurve(n),t)},TrimCurve:function(n,t,i){if(System.Diagnostics.Debug.Assert$$Boolean(t>=n.get_ParStart()&&t<=n.get_ParEnd()),System.Diagnostics.Debug.Assert$$Boolean(i>=n.get_ParStart()&&i<=n.get_ParEnd()),t<i)return As(n.Trim(t,i),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor);var r=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor;return r.AddSegment(As(n.Trim(t,n.get_ParEnd()),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor)),r.AddSegment(As(n.Trim(n.get_ParStart(),i),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor)),r},PaddedPolylineBoundaryOfNode:function(n,t){return Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CreatePaddedPolyline(Microsoft.Msagl.Core.Geometry.Curves.Curve.PolylineAroundClosedCurve(n.get_BoundaryCurve()),t)},LoosePolylineWithFewCorners:function(n,t){if(t<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return n;return Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.CreateLoosePolylineOnBisectors(n,t)},CreateLoosePolylineOnBisectors:function(n,t){var i=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,r,o;i.AddPoint$$Point(Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.GetStickingVertexOnBisector(n.get_StartPoint(),t));var u=new Microsoft.Msagl.Core.Geometry.Point.ctor,f=new Microsoft.Msagl.Core.Geometry.Point.ctor,e=!0;for(r=n.get_StartPoint().get_Next();r!=null;r=r.get_Next())o=Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.GetStickingVertexOnBisector(r,t),e?(u=r.get_Point(),f=o,e=!1):(i.get_Count()>1,Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(i.get_EndPoint().get_Point(),u,o)!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise?(i.AddPoint$$Point(f),e=!0,r=r.get_Prev()):(f=o,Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(i.get_EndPoint().get_Point(),u,r.get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&(u=r.get_Point())));return e?Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(i.get_EndPoint().get_Point(),n.get_StartPoint().get_Point(),i.get_StartPoint().get_Next().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&i.RemoveStartPoint():Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(i.get_EndPoint().get_Point(),u,i.get_StartPoint().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise?Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(i.get_EndPoint().get_Point(),u,i.get_StartPoint().get_Next().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&i.RemoveStartPoint():i.AddPoint$$Point(f),i.set_Closed(!0),i},GetStickingVertexOnBisector:function(n,t){var r=n.get_Polyline().Prev(n).get_Point(),i=n.get_Point(),u=n.get_Polyline().Next(n).get_Point();return Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r).Normalize(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,u).Normalize()).Normalize()),i)},CurvesIntersect:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,t,!1).get_Count()>0},CurveIntersectsRectangleNode$$ICurve$$RectangleNode$1$Polyline:function(n,t){var i=n.get_BoundingBox();return function(){var r={Value:i},u=Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.CurveIntersectsRectangleNode$$ICurve$$Rectangle$$RectangleNode$1$Polyline(n,r,t);return i=r.Value,u}()},CurveIntersectsRectangleNode$$ICurve$$Rectangle$$RectangleNode$1$Polyline:function(n,t,i){return i.get_Rectangle().Intersects(t.Value)?i.get_UserData()!=null?Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(i.get_UserData(),n,!1)!=null||Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.Inside(i.get_UserData(),n):(System.Diagnostics.Debug.Assert$$Boolean(i.get_Left()!=null&&i.get_Right()!=null),Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.CurveIntersectsRectangleNode$$ICurve$$Rectangle$$RectangleNode$1$Polyline(n,t,i.get_Left())||Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.CurveIntersectsRectangleNode$$ICurve$$Rectangle$$RectangleNode$1$Polyline(n,t,i.get_Right())):!1},Inside:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t.get_Start(),n)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside},CurveIntersectsRectangleNode$$Polyline$$RectangleNode$1$Polyline$$Polyline:function(n,t,i){var r=n.get_BoundingBox();return function(){var u={Value:r},f=Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.CurveIntersectsRectangleNode$$ICurve$$Rectangle$$RectangleNode$1$Polyline$$Polyline(n,u,t,i);return r=u.Value,f}()},CurveIntersectsRectangleNode$$ICurve$$Rectangle$$RectangleNode$1$Polyline$$Polyline:function(n,t,i,r){return i.get_Rectangle().Intersects(t.Value)?i.get_UserData()!=null?i.get_UserData()!=r&&(Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(i.get_UserData(),n,!1)!=null||Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.Inside(i.get_UserData(),n)):(System.Diagnostics.Debug.Assert$$Boolean(i.get_Left()!=null&&i.get_Right()!=null),Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.CurveIntersectsRectangleNode$$ICurve$$Rectangle$$RectangleNode$1$Polyline$$Polyline(n,t,i.get_Left(),r)||Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.CurveIntersectsRectangleNode$$ICurve$$Rectangle$$RectangleNode$1$Polyline$$Polyline(n,t,i.get_Right(),r)):!1}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.looseObstacles=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);this.portObstacles=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor);this.rootOfLooseHierarchy=null;this.rootOfTightHierarachy=null;this.router=null;this.sourceFilterLine=null;this.targetFilterLine=null;this.tightObstacles=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);System.Object.ctor.call(this);this.router=n},TightObstacles$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_TightObstacles:function(){return this.tightObstacles},LooseObstacles$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_LooseObstacles:function(){return this.looseObstacles},RootOfTightHierararchy$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_RootOfTightHierararchy:function(){return this.rootOfTightHierarachy},set_RootOfTightHierararchy:function(n){this.rootOfTightHierarachy=n},RootOfLooseHierarchy$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_RootOfLooseHierarchy:function(){return this.rootOfLooseHierarchy},set_RootOfLooseHierarchy:function(n){this.rootOfLooseHierarchy=n},SourceFilterLine$$:"Microsoft.Msagl.Core.Geometry.Curves.LineSegment",get_SourceFilterLine:function(){return this.sourceFilterLine},TargetFilterLine$$:"Microsoft.Msagl.Core.Geometry.Curves.LineSegment",get_TargetFilterLine:function(){return this.targetFilterLine},EnteringAngle$$:"System.Double",get_EnteringAngle:function(){return this.router.get_EnteringAngleBound()*3.14159265358979/180},Calculate:function(){this.CreateTightObstacles();this.CreateLooseObstacles()},CreateLooseObstacles:function(){this.set_RootOfLooseHierarchy(this.get_RootOfTightHierararchy().Clone());Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.TraverseHierarchy(this.get_RootOfLooseHierarchy(),$CreateAnonymousDelegate(this,function(n){if(n.get_UserData()!=null){var t=n.get_UserData(),i=this.FindMaxPaddingForTightPolyline(t);this.get_LooseObstacles().Add(n.set_UserData(Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.LoosePolylineWithFewCorners(t,System.Math.Min$$Double$$Double(this.router.get_LoosePadding(),i*.3))));n.set_Rectangle(n.get_UserData().get_BoundingBox());Microsoft.Msagl.Routing.InteractiveObstacleCalculator.UpdateRectsForParents(n)}}))},CreateTightObstacles:function(){var n,t,i;this.CreateInitialTightObstacles();do for(this.RemoveTightObstaclesOverlappingPortTightObstacles(),this.CalculateTightHierarchy(),n=this.GetOverlappingSets(),t=n.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.InsertOverlappingSet(i);while(n.get_Count()>0)},RemoveTightObstaclesOverlappingPortTightObstacles:function(){for(var u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),f=this.TightObstaclesMinusPortObstacles().GetEnumerator(),i,t,r,n;f.MoveNext();)for(n=f.get_Current(),i=this.portObstacles.GetEnumerator();i.MoveNext();)t=i.get_Current(),n.get_BoundingBox().Intersects(t.get_BoundingBox())&&(Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,t,!1).get_Count()>0||Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.OneCurveLiesInsideOfOther(n,t))&&u.Add(n);for(r=u.GetEnumerator();r.MoveNext();)n=r.get_Current(),this.get_TightObstacles().Remove(n)},TightObstaclesMinusPortObstacles:function(){for(var t=[],i=this.get_TightObstacles().GetEnumerator(),n;i.MoveNext();)n=i.get_Current(),this.portObstacles.Contains$$T(n)==!1&&t.push(n);return t},InsertOverlappingSet:function(n){for(var u=n.GetEnumerator(),i,r,t;u.MoveNext();)t=u.get_Current(),this.tightObstacles.Remove(t);for(i=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,r=Microsoft.Msagl.Core.Geometry.ConvexHull.CalculateConvexHull(this.EnumerateOverSetOfPolylines(n)).GetEnumerator();r.MoveNext();)t=r.get_Current(),i.AddPoint$$Point(t);i.set_Closed(!0);this.tightObstacles.Insert(i)},EnumerateOverSetOfPolylines:function(n){for(var i=[],r=n.GetEnumerator(),u,t,f;r.MoveNext();)for(u=r.get_Current(),t=u.GetEnumerator();t.MoveNext();)f=t.get_Current(),i.push(f);return i},GetOverlappingSets:function(){var n=this.CalculateOverlapGraph();return Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.ConnectedComponents(n)},CalculateOverlapGraph:function(){var n=new Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.PolylineGraph.ctor;return this.CreateEdgesUnderTwoNodes(this.rootOfTightHierarachy,this.rootOfTightHierarachy,n),n},CalculateTightHierarchy:function(){for(var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor),t=this.get_TightObstacles().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.Add(Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.CreateRectNodeOfPolyline(i));this.set_RootOfTightHierararchy(Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnListOfNodes(n))},CreateEdgesUnderTwoNodes:function(n,t,i){System.Diagnostics.Debug.Assert$$Boolean(n.get_UserData()==null&&n.get_Left()!=null&&n.get_Right()!=null||n.get_UserData()!=null&&n.get_Left()==null&&n.get_Right()==null);System.Diagnostics.Debug.Assert$$Boolean(t.get_UserData()==null&&t.get_Left()!=null&&t.get_Right()!=null||t.get_UserData()!=null&&t.get_Left()==null&&t.get_Right()==null);n.get_Rectangle().Intersects(t.get_Rectangle())&&(n.get_UserData()!=null?t.get_UserData()!=null?n.get_UserData()!=t.get_UserData()&&(Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n.get_UserData(),t.get_UserData(),!1).get_Count()>0||Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.OneCurveLiesInsideOfOther(n.get_UserData(),t.get_UserData()))&&(i.AddEdge(n.get_UserData(),t.get_UserData()),i.AddEdge(t.get_UserData(),n.get_UserData())):(this.CreateEdgesUnderTwoNodes(n,t.get_Left(),i),this.CreateEdgesUnderTwoNodes(n,t.get_Right(),i)):t.get_UserData()!=null?(this.CreateEdgesUnderTwoNodes(t,n.get_Left(),i),this.CreateEdgesUnderTwoNodes(t,n.get_Right(),i)):(this.CreateEdgesUnderTwoNodes(n.get_Left(),t.get_Left(),i),this.CreateEdgesUnderTwoNodes(n.get_Left(),t.get_Right(),i),this.CreateEdgesUnderTwoNodes(n.get_Right(),t.get_Left(),i),this.CreateEdgesUnderTwoNodes(n.get_Right(),t.get_Right(),i)))},CreateInitialTightObstacles:function(){var t,n;for(this.tightObstacles=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),t=this.router.get_Graph().get_Nodes().GetEnumerator();t.MoveNext();)n=t.get_Current(),n==this.router.get_Source()?function(){var n={Value:this.sourceFilterLine},t=this.CreatePortObstacles(this.router.get_Source(),this.router.get_SourcePort(),n);return this.sourceFilterLine=n.Value,t}.call(this):n==this.router.get_Target()?function(){var n={Value:this.targetFilterLine},t=this.CreatePortObstacles(this.router.get_Target(),this.router.get_TargetPort(),n);return this.targetFilterLine=n.Value,t}.call(this):this.get_TightObstacles().Insert(Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.PaddedPolylineBoundaryOfNode(n,this.router.get_Padding()))},CreatePortObstacles:function(n,t,i){var f=As(t,Microsoft.Msagl.Core.Layout.CurvePort.ctor),e,o,s,u;if(f!=null){var l=this.router.get_Padding(),a=n.get_BoundaryCurve(),r=Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.GetPaddedPolyline(a,l).ToCurve(),h=n.get_BoundaryCurve().get_Item$$Double(f.get_Parameter()),c=n.get_BoundaryCurve().get_BoundingBox().get_Width()+n.get_BoundaryCurve().get_BoundingBox().get_Height(),v=this.GetLeftTipParam(f.get_Parameter(),h,r,n,c),y=this.GetRightTipParam(f.get_Parameter(),h,r,n,c);r=Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.TrimCurve(r,y,v);e=r.get_Segments().get_Count()/2|0;System.Diagnostics.Debug.Assert$$Boolean(e>0);o=Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.TrimCurve(r,0,e);s=Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.TrimCurve(r,e+.8,r.get_ParEnd());i.Value=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Addition(s.get_Start(),s.get_End())),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Addition(o.get_Start(),o.get_End())));u=Microsoft.Msagl.Core.Geometry.Curves.Polyline.PolylineFromCurve(s);u.set_Closed(!0);this.portObstacles.Insert(u);this.get_TightObstacles().Insert(u);u=Microsoft.Msagl.Core.Geometry.Curves.Polyline.PolylineFromCurve(o);u.set_Closed(!0);this.portObstacles.Insert(u);this.get_TightObstacles().Insert(u)}else i.Value=null,this.portObstacles.Insert(n.get_BoundaryCurve())},GetRightTipParam:function(n,t,i,r,u){var o=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CurveIsClockwise(r.get_BoundaryCurve(),r.get_Center()),f=o?r.get_BoundaryCurve().RightDerivative(n):Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(r.get_BoundaryCurve().LeftDerivative(n)),e;return f=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(f.Normalize(),u).Rotate(this.get_EnteringAngle()),e=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(i,new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t,Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,f)),!0),System.Diagnostics.Debug.Assert$$Boolean(e.get_Count()==1),e.get_Item$$Int32(0).get_Par0()},GetLeftTipParam:function(n,t,i,r,u){var o=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CurveIsClockwise(r.get_BoundaryCurve(),r.get_Center()),f=o?r.get_BoundaryCurve().LeftDerivative(n):Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(r.get_BoundaryCurve().RightDerivative(n)),e;return f=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(f.Normalize()),u).Rotate(-this.get_EnteringAngle()),e=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(i,new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t,Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,f)),!0),System.Diagnostics.Debug.Assert$$Boolean(e.get_Count()==1),e.get_Item$$Int32(0).get_Par0()},FindMaxPaddingForTightPolyline:function(n){for(var t=1.79769313486232E+308,u=new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(n),i=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.get_RootOfLooseHierarchy().GetAllLeaves(),$CreateAnonymousDelegate(this,function(t){return t!=n})).GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t=System.Math.Min$$Double$$Double(t,Microsoft.Msagl.Routing.Visibility.Polygon.Distance$$Polygon$$Polygon(u,new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(r)));return t=System.Math.Min$$Double$$Double(t,Microsoft.Msagl.Prototype.LayoutEditing.RouterBetweenTwoNodes.DistanceFromPointToPolyline(this.router.get_SourcePoint(),n)),System.Math.Min$$Double$$Double(t,Microsoft.Msagl.Prototype.LayoutEditing.RouterBetweenTwoNodes.DistanceFromPointToPolyline(this.router.get_TargetPoint(),n))},ObstaclesIntersectLine:function(n,t){return this.ObstaclesIntersectICurve(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t))},ObstaclesIntersectICurve:function(n){return Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.CurveIntersectsRectangleNode$$ICurve$$RectangleNode$1$Polyline(n,this.get_RootOfTightHierararchy())||this.get_SourceFilterLine()!=null&&Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.CurvesIntersect(n,this.get_SourceFilterLine())||this.get_TargetFilterLine()!=null&&Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.CurvesIntersect(n,this.get_TargetFilterLine())}}};JsTypes.push(Microsoft$Msagl$Prototype$LayoutEditing$ObstacleCalculator);Microsoft$Msagl$Prototype$LayoutEditing$RestoreData={fullname:"Microsoft.Msagl.Prototype.LayoutEditing.RestoreData",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.Action=null;System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Prototype$LayoutEditing$RestoreData);Microsoft$Msagl$Prototype$LayoutEditing$RestoreHelper={fullname:"Microsoft.Msagl.Prototype.LayoutEditing.RestoreHelper",baseTypeName:"System.Object",staticDefinition:{GetRestoreData$$Node:function(n){return new Microsoft.Msagl.Prototype.LayoutEditing.NodeRestoreData.ctor(n.get_BoundaryCurve().Clone())},GetRestoreData$$Edge:function(n){return new Microsoft.Msagl.Prototype.LayoutEditing.EdgeRestoreData.ctor(n)},GetRestoreData$$GeometryGraph:function(){return new Microsoft.Msagl.Prototype.LayoutEditing.GraphRestoreData.ctor},GetRestoreData$$Label:function(n){return new Microsoft.Msagl.Prototype.LayoutEditing.LabelRestoreData.ctor(n.get_Center())},GetRestoreData$$GeometryObject:function(n){var u=As(n,Microsoft.Msagl.Core.Layout.Node.ctor),t,i,r;return u!=null?Microsoft.Msagl.Prototype.LayoutEditing.RestoreHelper.GetRestoreData$$Node(u):(t=As(n,Microsoft.Msagl.Core.Layout.Edge.ctor),t!=null)?Microsoft.Msagl.Prototype.LayoutEditing.RestoreHelper.GetRestoreData$$Edge(t):(i=As(n,Microsoft.Msagl.Core.Layout.Label.ctor),i!=null)?Microsoft.Msagl.Prototype.LayoutEditing.RestoreHelper.GetRestoreData$$Label(i):(r=As(n,Microsoft.Msagl.Core.Layout.GeometryGraph.ctor),r!=null)?Microsoft.Msagl.Prototype.LayoutEditing.RestoreHelper.GetRestoreData$$GeometryGraph(r):null}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Prototype$LayoutEditing$RestoreHelper);Microsoft$Msagl$Prototype$LayoutEditing$RouterBetweenTwoNodes={fullname:"Microsoft.Msagl.Prototype.LayoutEditing.RouterBetweenTwoNodes",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Prototype.LayoutEditing.RouterBetweenTwoNodes.enteringAngleBound=10},DistanceFromPointToPolyline:function(n,t){for(var r=Infinity,u,i=t.get_StartPoint();i.get_Next()!=null;i=i.get_Next())r=System.Math.Min$$Double$$Double(r,function(){var t={Value:u},r=Microsoft.Msagl.Core.Geometry.Point.DistToLineSegment(n,i.get_Point(),i.get_Next().get_Point(),t);return u=t.Value,r}());return r},CreateRelaxedPolylinePoints:function(n){for(var t=n.get_StartPoint(),u=new Microsoft.Msagl.Routing.RelaxedPolylinePoint.ctor(t,t.get_Point()),i=u,r;t.get_Next()!=null;)t=t.get_Next(),r=function(){var n=new Microsoft.Msagl.Routing.RelaxedPolylinePoint.ctor(t,t.get_Point());return n.set_Prev(i),n}(),i.set_Next(r),i=r;return u},PullCloserRelaxedPoint:function(n){n.get_PolylinePoint().set_Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.2,n.get_OriginalPosition()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.8,n.get_PolylinePoint().get_Point())))},LineIntersectsRectangleNode:function(n,t){return n.get_BoundingBox().Intersects(t.get_Rectangle())?t.get_UserData()!=null?Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(t.get_UserData(),n,!1).get_Count()>0:Microsoft.Msagl.Prototype.LayoutEditing.RouterBetweenTwoNodes.LineIntersectsRectangleNode(n,t.get_Left())||Microsoft.Msagl.Prototype.LayoutEditing.RouterBetweenTwoNodes.LineIntersectsRectangleNode(n,t.get_Right()):!1},SetRelaxedPointLocation:function(n,t){var r=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Next().get_OriginalPosition(),t.get_OriginalPosition(),t.get_Prev().get_OriginalPosition())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise,i=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Next().get_OriginalPosition(),t.get_Prev().get_OriginalPosition()).Normalize(),n).Rotate(1.5707963267949);r||(i=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(i));t.get_PolylinePoint().set_Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_OriginalPosition(),i))},RemoveCollinearPoint:function(n){for(var t=n.get_StartPoint().get_Next();t.get_Next()!=null;t=t.get_Next())Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Prev().get_Point(),t.get_Point(),t.get_Next().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear&&(t.get_Prev().set_Next(t.get_Next()),t.get_Next().set_Prev(t.get_Prev()));return n}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.pointsToObstacles=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);this._visGraph=null;this.obstacleCalculator=null;this.minimalPadding=1;this.graph=null;this.sourceVisibilityVertex=null;this.targetVisibilityVertex=null;this._SourcePort=null;this._TargetPort=null;this._LoosePadding=0;this._Target=null;this._Source=null;this._Polyline=null;this._OffsetForPolylineRelaxing=0;System.Object.ctor.call(this);this.graph=n;this.set_LoosePadding(i);this.set_Padding(t);this.set_OffsetForPolylineRelaxing(r)},SourcePort$$:"Microsoft.Msagl.Core.Layout.Port",get_SourcePort:function(){return this._SourcePort},set_SourcePort:function(n){this._SourcePort=n},TargetPort$$:"Microsoft.Msagl.Core.Layout.Port",get_TargetPort:function(){return this._TargetPort},set_TargetPort:function(n){this._TargetPort=n},EnteringAngleBound$$:"System.Double",get_EnteringAngleBound:function(){return 10},Padding$$:"System.Double",get_Padding:function(){return this.minimalPadding},set_Padding:function(n){this.minimalPadding=n},LoosePadding$$:"System.Double",get_LoosePadding:function(){return this._LoosePadding},set_LoosePadding:function(n){this._LoosePadding=n},Target$$:"Microsoft.Msagl.Core.Layout.Node",get_Target:function(){return this._Target},set_Target:function(n){this._Target=n},TargetVisibilityVertex$$:"Microsoft.Msagl.Routing.Visibility.VisibilityVertex",get_TargetVisibilityVertex:function(){return this.targetVisibilityVertex},Source$$:"Microsoft.Msagl.Core.Layout.Node",get_Source:function(){return this._Source},set_Source:function(n){this._Source=n},Graph$$:"Microsoft.Msagl.Core.Layout.GeometryGraph",get_Graph:function(){return this.graph},Polyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_Polyline:function(){return this._Polyline},set_Polyline:function(n){this._Polyline=n},OffsetForPolylineRelaxing$$:"System.Double",get_OffsetForPolylineRelaxing:function(){return this._OffsetForPolylineRelaxing},set_OffsetForPolylineRelaxing:function(n){this._OffsetForPolylineRelaxing=n},RouteEdge:function(n,t){this.set_Source(n.get_Source());this.set_Target(n.get_Target());this.set_SourcePort(n.get_SourcePort());this.set_TargetPort(n.get_TargetPort());this.CalculateObstacles();var i=this.TryRouteStraightLine();i!=null?(this.set_Polyline(new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$Point$$Point(i.get_Start(),i.get_End())),n.set_UnderlyingPolyline(Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints(this.get_Polyline()))):(this.CalculateTangentVisibilityGraph(),this.set_Polyline(this.GetShortestPolyline()),this.RelaxPolyline(),n.set_UnderlyingPolyline(Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints(this.get_Polyline())),t&&(this.TryToRemoveInflectionsAndCollinearSegs(n.get_UnderlyingPolyline()),this.SmoothCorners(n.get_UnderlyingPolyline())));n.set_Curve(n.get_UnderlyingPolyline().CreateCurve())},RelaxPolyline:function(){for(var n=Microsoft.Msagl.Prototype.LayoutEditing.RouterBetweenTwoNodes.CreateRelaxedPolylinePoints(this.get_Polyline()),n=n.get_Next();n.get_Next()!=null;n=n.get_Next())this.RelaxPolylinePoint(n)},RelaxPolylinePoint:function(n){for(var t=this.get_OffsetForPolylineRelaxing();!this.RelaxWithGivenOffset(t,n);t/=2);},RelaxWithGivenOffset:function(n,t){return(Microsoft.Msagl.Prototype.LayoutEditing.RouterBetweenTwoNodes.SetRelaxedPointLocation(n,t),this.StickingSegmentDoesNotIntersectTightObstacles(t))?!0:(Microsoft.Msagl.Prototype.LayoutEditing.RouterBetweenTwoNodes.PullCloserRelaxedPoint(t.get_Prev()),!1)},StickingSegmentDoesNotIntersectTightObstacles:function(n){return!this.LineIntersectsTightObstacles(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_PolylinePoint().get_Point(),n.get_Prev().get_PolylinePoint().get_Point()))&&(n.get_Next()==null||!this.LineIntersectsTightObstacles(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_PolylinePoint().get_Point(),n.get_Next().get_PolylinePoint().get_Point())))},LineIntersectsTightObstacles:function(n){return Microsoft.Msagl.Prototype.LayoutEditing.RouterBetweenTwoNodes.LineIntersectsRectangleNode(n,this.obstacleCalculator.get_RootOfTightHierararchy())},SmoothCorners:function(n){for(var f=n.get_HeadSite(),i,e,s=1.5,t,o,r,u;function(){var n={Value:i},t={Value:e},r=Microsoft.Msagl.Core.Geometry.Curves.Curve.FindCorner(f,n,t);return i=n.Value,e=t.Value,r}.call(this);){t=.5;f.get_Previous()==null?(r=2,u=1):e.get_Next()==null?(r=1,u=2):r=u=1;do o=Microsoft.Msagl.Core.Geometry.Curves.Curve.CreateBezierSeg$$Double$$Double$$Site$$Site$$Site(t*r,t*u,f,i,e),i.set_PreviousBezierSegmentFitCoefficient(t*r),i.set_NextBezierSegmentFitCoefficient(t*u),t/=s;while(this.obstacleCalculator.ObstaclesIntersectICurve(o));t*=s;t<.5&&(t=.5*(t+t*s),o=Microsoft.Msagl.Core.Geometry.Curves.Curve.CreateBezierSeg$$Double$$Double$$Site$$Site$$Site(t*r,t*u,f,i,e),this.obstacleCalculator.ObstaclesIntersectICurve(o)||(i.set_PreviousBezierSegmentFitCoefficient(t*r),i.set_NextBezierSegmentFitCoefficient(t*u)));f=i}},TryToRemoveInflectionsAndCollinearSegs:function(n){for(var i=!0,t;i;)for(i=!1,t=n.get_HeadSite();t!=null&&t.get_Next()!=null;t=t.get_Next())t.get_Turn()*t.get_Next().get_Turn()<0&&(i=function(){var n={Value:t},i=this.TryToRemoveInflectionEdge(n);return t=n.Value,i}.call(this)||i)},TryToRemoveInflectionEdge:function(n){var i,t;return this.obstacleCalculator.ObstaclesIntersectLine(n.Value.get_Previous().get_Point(),n.Value.get_Next().get_Point())?this.obstacleCalculator.ObstaclesIntersectLine(n.Value.get_Previous().get_Point(),n.Value.get_Next().get_Next().get_Point())?this.obstacleCalculator.ObstaclesIntersectLine(n.Value.get_Point(),n.Value.get_Next().get_Next().get_Point())?!1:(t=n.Value.get_Next().get_Next(),n.Value.set_Next(t),t.set_Previous(n.Value),!0):(i=n.Value.get_Previous(),t=n.Value.get_Next().get_Next(),i.set_Next(t),t.set_Previous(i),n.Value=i,!0):(i=n.Value.get_Previous(),t=n.Value.get_Next(),i.set_Next(t),t.set_Previous(i),n.Value=i,!0)},TryRouteStraightLine:function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_SourcePoint(),this.get_TargetPoint());return this.obstacleCalculator.ObstaclesIntersectICurve(n)?null:n},TargetPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_TargetPoint:function(){var n=As(this.get_TargetPort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor);return n!=null?this.get_Target().get_BoundaryCurve().get_Item$$Double(n.get_Parameter()):this.get_TargetPort().get_Location()},SourcePoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_SourcePoint:function(){var n=As(this.get_SourcePort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor);return n!=null?this.get_Source().get_BoundaryCurve().get_Item$$Double(n.get_Parameter()):this.get_SourcePort().get_Location()},GetShortestPolyline:function(){for(var r=new Microsoft.Msagl.Routing.SingleSourceSingleTargetShortestPathOnVisibilityGraph.ctor$$VisibilityGraph$$VisibilityVertex$$VisibilityVertex(this._visGraph,this.sourceVisibilityVertex,this.get_TargetVisibilityVertex()),u=r.GetPath(!1),n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,t=u.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.AddPoint$$Point(i.Point);return Microsoft.Msagl.Prototype.LayoutEditing.RouterBetweenTwoNodes.RemoveCollinearPoint(n)},CalculateTangentVisibilityGraph:function(){this._visGraph=function(){var n={Value:this.sourceVisibilityVertex},t={Value:this.targetVisibilityVertex},i=Microsoft.Msagl.Routing.Visibility.VisibilityGraph.GetVisibilityGraphForShortestPath(this.get_SourcePoint(),this.get_TargetPoint(),this.obstacleCalculator.get_LooseObstacles(),n,t);return this.sourceVisibilityVertex=n.Value,this.targetVisibilityVertex=t.Value,i}.call(this)},CalculateObstacles:function(){var n,t,i,r;for(this.obstacleCalculator=new Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.ctor(this),this.obstacleCalculator.Calculate(),n=this.obstacleCalculator.get_TightObstacles().GetEnumerator();n.MoveNext();)for(t=n.get_Current(),i=t.GetEnumerator();i.MoveNext();)r=i.get_Current(),this.pointsToObstacles.set_Item$$TKey(r,t)}}};JsTypes.push(Microsoft$Msagl$Prototype$LayoutEditing$RouterBetweenTwoNodes);Microsoft$Msagl$Prototype$LayoutEditing$WeightedEdge={fullname:"Microsoft.Msagl.Prototype.LayoutEditing.WeightedEdge",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.GraphAlgorithms.IEdge"],Kind:"Class",definition:{ctor:function(n,t,i){this.source=0;this.target=0;this.weight=0;System.Object.ctor.call(this);this.set_Source(n);this.set_Target(t);this.set_Weight(i)},Source$$:"System.Int32",get_Source:function(){return this.source},set_Source:function(n){this.source=n},Target$$:"System.Int32",get_Target:function(){return this.target},set_Target:function(n){this.target=n},Weight$$:"System.Double",get_Weight:function(){return this.weight},set_Weight:function(n){this.weight=n}}};JsTypes.push(Microsoft$Msagl$Prototype$LayoutEditing$WeightedEdge);Microsoft$Msagl$Prototype$MultiScale$MultiScaleLayout={fullname:"Microsoft.Msagl.Prototype.MultiScale.MultiScaleLayout",baseTypeName:"System.Object",staticDefinition:{CenterNode:function(n){for(var t=n.get_Center(),r=1,e=n.get_InEdges().GetEnumerator(),u,i,f;e.MoveNext();)i=e.get_Current(),t=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,i.get_Source().get_Center()),++r;for(u=n.get_OutEdges().GetEnumerator();u.MoveNext();)i=u.get_Current(),t=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,i.get_Target().get_Center()),++r;f=new System.Random.ctor;t=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(f.NextDouble(),f.NextDouble()));n.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(t,r))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)},CalculateLayout:function(n,t,i){var r,u,c,l,o,s,f,h,e;if(!(n.get_Nodes().get_Count()<=1)){for(r=n,u=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor);r.get_Nodes().get_Count()>3;)if(u.Push(r),c=r.get_Nodes().get_Count(),r=this.CreateAbridgedGraph(r,t,i),r.get_Nodes().get_Count()==c){r=u.Pop();break}for(this.SimpleLayout(r,1,i),l=u.get_Count()+1;u.get_Count()>0;){for(o=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),s=r.get_Nodes().GetEnumerator();s.MoveNext();)f=s.get_Current(),h=As(f.get_UserData(),Microsoft.Msagl.Core.Layout.Node.ctor),h!=null?h.set_Center(f.get_Center()):(e=As(f.get_UserData(),Microsoft.Msagl.Core.Layout.Edge.ctor),e.get_Source().set_Center(function(n){return e.get_Target().set_Center(n),n}.call(this,f.get_Center())),o.Add(e.get_Source()),o.Add(e.get_Target()));o.ForEach(Microsoft.Msagl.Prototype.MultiScale.MultiScaleLayout.CenterNode);r=u.Pop();this.SimpleLayout(r,u.get_Count()/l,i)}}},SimpleLayout:function(n,t,i){for(var r=function(){var n=new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor;return n.set_MaxIterations(10),n.set_MinorIterations(3),n.set_GravityConstant(1-t),n.set_RepulsiveForceConstant(System.Math.Log$$Double(i*t*500+2.71828182845905)),n.set_InitialStepSize(.6),n}.call(this),f=n.get_Edges().GetEnumerator(),u;f.MoveNext();)u=f.get_Current(),u.set_Length(u.get_Length()*System.Math.Log$$Double(t*500+2.71828182845905));r.InitializeLayout$$GeometryGraph$$Int32(n,r.get_MinConstraintLevel());do Microsoft.Msagl.Miscellaneous.LayoutHelpers.CalculateLayout(n,r,null,null);while(r.get_Iterations()<r.get_MaxIterations())},CreateAbridgedGraph:function(n,t,i){var r,h,a,u,f,c,v,w;Microsoft.Msagl.Core.Layout.LayoutAlgorithmHelpers.SetEdgeLengthsProportionalToSymmetricDifference(n,t,i);for(var s=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,e=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes()),b=new System.Random.ctor$$Int32(1),y=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.ThenBy$2$$IOrderedEnumerable$1$$Func$2(null,System.Int32.ctor,System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(null,System.Double.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,null,n.get_Edges(),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({e:n,r:b.Next()})})),$CreateAnonymousDelegate(this,function(n){return n.get_e().get_Length()})),$CreateAnonymousDelegate(this,function(n){return n.get_r()})),$CreateAnonymousDelegate(this,function(n){return n.get_e()}))),o=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor),p=y.GetEnumerator();p.MoveNext();)r=p.get_Current(),e.Contains$$T(r.get_Source())&&e.Contains$$T(r.get_Target())&&(h=function(){var n=new Microsoft.Msagl.Core.Layout.Node.ctor;return n.set_UserData(r),n}.call(this),o.set_Item$$TKey(r.get_Source(),h),o.set_Item$$TKey(r.get_Target(),h),s.get_Nodes().Add(h),e.Remove(r.get_Source()),e.Remove(r.get_Target()));for(a=e.GetEnumerator();a.MoveNext();)u=a.get_Current(),f=function(){var n=new Microsoft.Msagl.Core.Layout.Node.ctor;return n.set_UserData(u),n}.call(this),s.get_Nodes().Add(f),o.set_Item$$TKey(u,f);for(c=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Collections.Generic.KeyValuePair$2.ctor),v=y.GetEnumerator();v.MoveNext();){var r=v.get_Current(),u=o.get_Item$$TKey(r.get_Source()),f=o.get_Item$$TKey(r.get_Target()),l=new System.Collections.Generic.KeyValuePair$2.ctor$$TKey$$TValue(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,u,f),k=new System.Collections.Generic.KeyValuePair$2.ctor$$TKey$$TValue(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,f,u);l.get_Key()==l.get_Value()||c.Contains$$T(l)||c.Contains$$T(k)||(w=function(){var n=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(u,f);return n.set_Length(r.get_Length()),n}.call(this),c.Insert(l),s.get_Edges().Add(w))}return s}}};JsTypes.push(Microsoft$Msagl$Prototype$MultiScale$MultiScaleLayout);Microsoft$Msagl$Prototype$NonOverlappingBoundaries$CvxHull={fullname:"Microsoft.Msagl.Prototype.NonOverlappingBoundaries.CvxHull",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Prototype.NonOverlappingBoundaries.IHull"],Kind:"Class",definition:{ctor:function(){this._Parent=null;System.Object.ctor.call(this)},Parent$$:"Microsoft.Msagl.Prototype.NonOverlappingBoundaries.ClusterConvexHull",get_Parent:function(){return this._Parent},set_Parent:function(n){this._Parent=n},Center$$:"Microsoft.Msagl.Core.Geometry.Point",RectangleNode$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Prototype.NonOverlappingBoundaries.IHull]]",Weight$$:"System.Double",Project:function(n){var t=As(n,Microsoft.Msagl.Prototype.NonOverlappingBoundaries.CvxHull.ctor),u=As(t,Microsoft.Msagl.Prototype.NonOverlappingBoundaries.ClusterConvexHull.ctor),f=As(this,Microsoft.Msagl.Prototype.NonOverlappingBoundaries.ClusterConvexHull.ctor),i,r;return f!=null&&f.Contains(t)?0:u!=null&&u.Contains(this)?0:(System.Diagnostics.Debug.Assert$$Boolean(t!=null),i=Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.PenetrationDepthForPolylines(this.TranslatedBoundary(),t.TranslatedBoundary()),i.get_Length()>0&&(r=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(i,this.get_Weight()+t.get_Weight()),this.MoveCenter(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t.get_Weight(),r)),t.MoveCenter(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(-this.get_Weight(),r))),i.get_Length())}}};JsTypes.push(Microsoft$Msagl$Prototype$NonOverlappingBoundaries$CvxHull);Microsoft$Msagl$Prototype$NonOverlappingBoundaries$RCHull={fullname:"Microsoft.Msagl.Prototype.NonOverlappingBoundaries.RCHull",baseTypeName:"Microsoft.Msagl.Prototype.NonOverlappingBoundaries.CvxHull",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.mNode=null;this.boundary=null;this.translatedBoundary=null;this.w2=0;this.h2=0;Microsoft.Msagl.Prototype.NonOverlappingBoundaries.CvxHull.ctor.call(this);this.w2=t.get_Width()/2+i;this.h2=t.get_Height()/2+i;this.set_Parent(n);this.boundary=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$Point$Array([new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-this.w2,-this.h2),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-this.w2,this.h2),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.w2,this.h2),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.w2,-this.h2)]);this.boundary.set_Closed(!0);this.translatedBoundary=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(this.boundary);this.translatedBoundary.set_Closed(!0);this.mNode=t},Center$$:"Microsoft.Msagl.Core.Geometry.Point",get_Center:function(){return this.mNode.get_Center()},MoveCenter:function(n){this.mNode.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.mNode.get_Center(),n))},RectangleNode$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Prototype.NonOverlappingBoundaries.IHull]]",get_RectangleNode:function(){var n=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(this.get_Center().get_X()-this.w2,this.get_Center().get_Y()-this.h2,this.get_Center().get_X()+this.w2,this.get_Center().get_Y()+this.h2);return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Prototype.NonOverlappingBoundaries.IHull.ctor,this,n)},Weight$$:"System.Double",get_Weight:function(){return Cast(this.mNode.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor).stayWeight},TranslatedBoundary:function(){for(var t=this.translatedBoundary.get_StartPoint(),n=this.boundary.get_StartPoint();n!=null;n=n.get_Next())t.set_Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Point(),this.get_Center())),t=t.get_Next();return this.translatedBoundary}}};JsTypes.push(Microsoft$Msagl$Prototype$NonOverlappingBoundaries$RCHull);Microsoft$Msagl$Prototype$NonOverlappingBoundaries$ClusterConvexHull={fullname:"Microsoft.Msagl.Prototype.NonOverlappingBoundaries.ClusterConvexHull",baseTypeName:"Microsoft.Msagl.Prototype.NonOverlappingBoundaries.CvxHull",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.cluster=null;Microsoft.Msagl.Prototype.NonOverlappingBoundaries.CvxHull.ctor.call(this);this.cluster=n;this.set_Parent(t)},Center$$:"Microsoft.Msagl.Core.Geometry.Point",get_Center:function(){return this.cluster.SetBarycenter()},MoveCenter:function(n){this.cluster.ForEachNode($CreateAnonymousDelegate(this,function(t){t.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Center(),n))}))},Weight$$:"System.Double",get_Weight:function(){return this.cluster.get_Weight()},RectangleNode$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Prototype.NonOverlappingBoundaries.IHull]]",get_RectangleNode:function(){for(var n=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(this.get_Center()),t=this.cluster.get_Nodes().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.Add$$Rectangle(i.get_BoundingBox());return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Prototype.NonOverlappingBoundaries.IHull.ctor,this,n)},TranslatedBoundary:function(){return this.ComputeConvexHull()},ComputeConvexHull:function(){for(var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),i=this.cluster.get_Nodes().GetEnumerator(),u,t,f;i.MoveNext();)for(var e=i.get_Current(),o=new Microsoft.Msagl.Prototype.NonOverlappingBoundaries.RCHull.ctor(null,e,0),r=o.TranslatedBoundary().get_PolylinePoints().GetEnumerator();r.MoveNext();)u=r.get_Current(),n.Add(u.get_Point());for(t=this.cluster.get_Clusters().GetEnumerator();t.MoveNext();)f=t.get_Current(),n.AddRange(new Microsoft.Msagl.Prototype.NonOverlappingBoundaries.ClusterConvexHull.ctor(f,this).TranslatedBoundary());return function(){var t=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(Microsoft.Msagl.Core.Geometry.ConvexHull.CalculateConvexHull(n));return t.set_Closed(!0),t}.call(this)},Contains:function(n){return n.get_Parent()==null?!1:n.get_Parent()==this?!0:this.Contains(n.get_Parent())}}};JsTypes.push(Microsoft$Msagl$Prototype$NonOverlappingBoundaries$ClusterConvexHull);Microsoft$Msagl$Prototype$NonOverlappingBoundaries$AllPairsNonOverlappingBoundaries={fullname:"Microsoft.Msagl.Prototype.NonOverlappingBoundaries.AllPairsNonOverlappingBoundaries",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Prototype.NonOverlappingBoundaries.AllPairsNonOverlappingBoundaries.AllPairsComputationLimit=20}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.Incremental.IConstraint"],Kind:"Class",definition:{ctor:function(n,t){var i,u,r,f;for(this.hulls=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Prototype.NonOverlappingBoundaries.IHull.ctor),System.Object.ctor.call(this),i=n.nodes.GetEnumerator();i.MoveNext();)u=i.get_Current(),this.hulls.Add(new Microsoft.Msagl.Prototype.NonOverlappingBoundaries.RCHull.ctor(null,u,t.get_NodeSeparation()));for(r=n.clusters.GetEnumerator();r.MoveNext();)f=r.get_Current(),this.traverseClusters(null,f,t.get_NodeSeparation())},traverseClusters:function(n,t,i){var r=new Microsoft.Msagl.Prototype.NonOverlappingBoundaries.ClusterConvexHull.ctor(t,n),u,e,f,o;for(this.hulls.Add(r),u=t.nodes.GetEnumerator();u.MoveNext();)e=u.get_Current(),this.hulls.Add(new Microsoft.Msagl.Prototype.NonOverlappingBoundaries.RCHull.ctor(r,e,i));for(f=t.clusters.GetEnumerator();f.MoveNext();)o=f.get_Current(),this.traverseClusters(r,o,i)},Project:function(){var i=0,n,u,t,r;if(this.hulls.get_Count()<Microsoft.Msagl.Prototype.NonOverlappingBoundaries.AllPairsNonOverlappingBoundaries.AllPairsComputationLimit)for(n=0;n<this.hulls.get_Count()-1;++n)for(u=this.hulls.get_Item$$Int32(n),t=n+1;t<this.hulls.get_Count();++t)i+=u.Project(this.hulls.get_Item$$Int32(t));else for(var e=new Microsoft.Msagl.Prototype.NonOverlappingBoundaries.ProximityQuery.ctor(this.hulls),o=e.GetAllIntersections(),f=o.GetEnumerator();f.MoveNext();)r=f.get_Current(),i+=r.get_Item1().Project(r.get_Item2());return i},Level$$:"System.Int32",get_Level:function(){return 2},Nodes$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Node]]",get_Nodes:function(){return new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor)}}};JsTypes.push(Microsoft$Msagl$Prototype$NonOverlappingBoundaries$AllPairsNonOverlappingBoundaries);Microsoft$Msagl$Prototype$NonOverlappingBoundaries$IHull={fullname:"Microsoft.Msagl.Prototype.NonOverlappingBoundaries.IHull",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Prototype$NonOverlappingBoundaries$IHull);Microsoft$Msagl$Prototype$NonOverlappingBoundaries$ProximityQuery={fullname:"Microsoft.Msagl.Prototype.NonOverlappingBoundaries.ProximityQuery",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.hierarchy=null;System.Object.ctor.call(this);this.hierarchy=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(this.GetNodeRects(n))},GetAllIntersections:function(){var n=new System.Collections.Generic.List$1.ctor(System.Tuple$2.ctor);return this.GetClosePairs(this.hierarchy,this.hierarchy,n),n},GetIntersecting:function(n,t,i){(System.Diagnostics.Debug.Assert$$Boolean(n.get_UserData()!=null),n.get_Rectangle().Intersects(t.get_Rectangle()))&&(t.get_UserData()!=null?n.get_UserData()!=t.get_UserData()&&i.Add(t.get_UserData()):(this.GetIntersecting(n,t.get_Left(),i),this.GetIntersecting(n,t.get_Right(),i)))},GetClosePairs:function(n,t,i){if(n.get_Rectangle().Intersects(t.get_Rectangle()))if(n.get_UserData()!=null&&t.get_UserData()!=null){if(n.get_UserData()!=t.get_UserData()){var r=n.get_UserData().get_Center(),u=t.get_UserData().get_Center();(r.get_X()<=u.get_X()||r.get_X()==u.get_X()&&r.get_Y()<=u.get_Y())&&i.Add(new System.Tuple$2.ctor(Microsoft.Msagl.Prototype.NonOverlappingBoundaries.IHull.ctor,Microsoft.Msagl.Prototype.NonOverlappingBoundaries.IHull.ctor,n.get_UserData(),t.get_UserData()))}}else n.get_UserData()==null&&t.get_UserData()==null?(this.GetClosePairs(n.get_Left(),t.get_Left(),i),this.GetClosePairs(n.get_Left(),t.get_Right(),i),this.GetClosePairs(n.get_Right(),t.get_Left(),i),this.GetClosePairs(n.get_Right(),t.get_Right(),i)):n.get_UserData()==null?(this.GetClosePairs(n.get_Left(),t,i),this.GetClosePairs(n.get_Right(),t,i)):(this.GetClosePairs(n,t.get_Left(),i),this.GetClosePairs(n,t.get_Right(),i))},GetNodeRects:function(n){for(var t=[],i=n.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.push(r.get_RectangleNode());return t}}};JsTypes.push(Microsoft$Msagl$Prototype$NonOverlappingBoundaries$ProximityQuery);Microsoft$Msagl$Prototype$Phylo$PhyloEdge={fullname:"Microsoft.Msagl.Prototype.Phylo.PhyloEdge",baseTypeName:"Microsoft.Msagl.Core.Layout.Edge",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Prototype$Phylo$PhyloEdge);Microsoft$Msagl$Prototype$Phylo$PhyloTree={fullname:"Microsoft.Msagl.Prototype.Phylo.PhyloTree",baseTypeName:"Microsoft.Msagl.Core.Layout.GeometryGraph",staticDefinition:{NodeIsALeaf:function(n){return!n.get_OutEdges().GetEnumerator().MoveNext()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.root=null;Microsoft.Msagl.Core.Layout.GeometryGraph.ctor.call(this)},Root$$:"Microsoft.Msagl.Core.Layout.Node",get_Root:function(){return this.root!=null?this.root:this.root=this.GetRoot()},GetRoot:function(){for(var n=null,i=this.get_Nodes().GetEnumerator(),r,u,t,f;i.MoveNext();){r=i.get_Current();n=r;break}do for(u=n,t=n.get_InEdges().GetEnumerator();t.MoveNext();)f=t.get_Current(),n=f.get_Source();while(u!=n);return n},Leaves$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Node]]",get_Leaves:function(){for(var t=[],i=this.get_Nodes().GetEnumerator(),n;i.MoveNext();)n=i.get_Current(),Microsoft.Msagl.Prototype.Phylo.PhyloTree.NodeIsALeaf(n)&&t.push(n);return t}}};JsTypes.push(Microsoft$Msagl$Prototype$Phylo$PhyloTree);Microsoft$Msagl$Prototype$Phylo$PhyloTreeLayoutCalclulation={fullname:"Microsoft.Msagl.Prototype.Phylo.PhyloTreeLayoutCalclulation",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},IsATreeUnderNode:function(n,t){return t.Contains$$T(n)?!1:(t.Insert(n),System.Linq.Enumerable.All$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_OutEdges(),function(n){return Microsoft.Msagl.Prototype.Phylo.PhyloTreeLayoutCalclulation.IsATreeUnderNode(n.get_Target(),t)}))},VirtualNodeWidth$$:"System.Double",get_VirtualNodeWidth:function(){return 1},ExtendStandardAnchors:function(n,t,i,r,u){var f=u.get_Width(),e=u.get_Height();f/=2;e/=2;t.Value=n.Value=f;i.Value=r.Value=e},GetTarget:function(n,t,i,r){return n<t-1?r:i.get_Target()},GetSource:function(n,t,i){return n>0?i.Value++:t.get_Source()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.anchors=null;this.properLayeredGraph=null;this.dataBase=null;this.tree=null;this.intGraph=null;this.layerArrays=null;this.gridLayerOffsets=new System.Collections.Generic.SortedDictionary$2.ctor(System.Int32.ctor,System.Double.ctor);this.layerOffsets=null;this.cellSize=0;this.nodeOffsets=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Double.ctor);this.nodesToIndices=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Int32.ctor);this.originalNodeToGridLayerIndices=null;this.gridLayerToLayer=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor);this._LayoutSettings=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.dataBase=r;this.tree=n;this.set_LayoutSettings(t);this.intGraph=i;this.originalNodeToGridLayerIndices=new Int32Array(this.intGraph.get_Nodes().get_Count())},LayoutSettings$$:"Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings",get_LayoutSettings:function(){return this._LayoutSettings},set_LayoutSettings:function(n){this._LayoutSettings=n},RunInternal:function(){if(!this.IsATree())throw $CreateException(new System.IO.InvalidDataException.ctor$$String("the graph is not a tree"),new Error);this.DefineCellSize();this.CalculateOriginalNodeToGridLayerIndices();this.CreateLayerArraysAndProperLayeredGraph();this.FillDataBase();this.RunXCoordinateAssignmentsByBrandes();this.CalcTheBoxFromAnchors();this.StretchIfNeeded();this.ProcessPositionedAnchors();this.RouteSplines()},IsATree:function(){var n=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),t=System.Linq.Enumerable.FirstOrDefault$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,this.tree.get_Nodes(),$CreateAnonymousDelegate(this,function(n){return!System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_InEdges())}));return t==null?!1:Microsoft.Msagl.Prototype.Phylo.PhyloTreeLayoutCalclulation.IsATreeUnderNode(t,n)&&n.get_Count()==this.tree.get_Nodes().get_Count()},StretchIfNeeded:function(){if(this.get_LayoutSettings().get_AspectRatio()!=0){var n=this.tree.get_Width()/this.tree.get_Height();this.StretchToDesiredAspectRatio(n,this.get_LayoutSettings().get_AspectRatio())}},StretchToDesiredAspectRatio:function(n,t){n>t?this.StretchInYDirection(n/t):n<t&&this.StretchInXDirection(t/n)},StretchInYDirection:function(n){for(var f,i=(this.tree.get_BoundingBox().get_Top()+this.tree.get_BoundingBox().get_Bottom())/2,r=0,u=this.dataBase.get_Anchors(),e=u.length,t=u[r];r<e;r++,t=u[r])t.set_BottomAnchor(t.get_BottomAnchor()*n),t.set_TopAnchor(t.get_TopAnchor()*n),t.set_Y(i+n*(t.get_Y()-i));f=this.tree.get_Height()*n;this.tree.set_BoundingBox(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(this.tree.get_BoundingBox().get_Left(),i+f/2,this.tree.get_BoundingBox().get_Right(),i-f/2))},StretchInXDirection:function(n){for(var f,i=(this.tree.get_BoundingBox().get_Left()+this.tree.get_BoundingBox().get_Right())/2,r=0,u=this.dataBase.get_Anchors(),e=u.length,t=u[r];r<e;r++,t=u[r])t.set_LeftAnchor(t.get_LeftAnchor()*n),t.set_RightAnchor(t.get_RightAnchor()*n),t.set_X(i+n*(t.get_X()-i));f=this.tree.get_Width()*n;this.tree.set_BoundingBox(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(i-f/2,this.tree.get_BoundingBox().get_Top(),i+f/2,this.tree.get_BoundingBox().get_Bottom()))},DefineCellSize:function(){for(var n=1.79769313486232E+308,t=this.tree.get_Edges().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n=System.Math.Min$$Double$$Double(n,i.get_Length());this.cellSize=.3*n},CalculateOriginalNodeToGridLayerIndices:function(){var n;for(this.InitNodesToIndices(),this.FillNodeOffsets(),n=this.nodeOffsets.GetEnumerator();n.MoveNext();){var t=n.get_Current(),r=this.nodesToIndices.get_Item$$TKey(t.get_Key()),i=this.originalNodeToGridLayerIndices[r]=this.GetGridLayerIndex(t.get_Value());this.gridLayerOffsets.ContainsKey(i)||this.gridLayerOffsets.set_Item$$TKey(i,t.get_Value())}},GetGridLayerIndex:function(n){return n/this.cellSize+.5|0},InitNodesToIndices:function(){for(var n=0;n<this.intGraph.get_Nodes().get_Count();n++)this.nodesToIndices.set_Item$$TKey(this.intGraph.get_Nodes().get_Item$$Int32(n),n)},FillNodeOffsets:function(){this.FillNodeOffsets$$Double$$Node(0,this.tree.get_Root())},FillNodeOffsets$$Double$$Node:function(n,t){var i,r;for(this.nodeOffsets.set_Item$$TKey(t,n),i=t.get_OutEdges().GetEnumerator();i.MoveNext();)r=i.get_Current(),this.FillNodeOffsets$$Double$$Node(n+r.get_Length(),r.get_Target())},FillDataBase:function(){for(var n=this.intGraph.get_Edges().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.dataBase.RegisterOriginalEdgeInMultiedges(t);this.SizeAnchors();this.FigureYCoordinates()},FigureYCoordinates:function(){var t=this.GetMultiplier(),i=this.nodesToIndices.get_Item$$TKey(this.tree.get_Root()),n;for(this.CalculateAnchorsY(i,t,0),n=this.intGraph.get_NodeCount();n<this.dataBase.get_Anchors().length;n++)this.dataBase.get_Anchors()[n].set_Y(-t*this.layerOffsets[this.layerArrays.Y[n]]);for(n=0;n<this.layerOffsets.length;n++)this.layerOffsets[n]*=t},GetMultiplier:function(){for(var i,n=1,t=this.layerArrays.get_Layers().length-1;t>0;t--)i=this.GetMultiplierBetweenLayers(t),i>n&&(n=i);return n},GetMultiplierBetweenLayers:function(n){var i=this.FindLowestBottomOnLayer(n),r=this.FindHighestTopOnLayer(n-1),f=this.NodeY(n,i),e=this.NodeY(n-1,r),u=f-e,t;if(u<0)throw $CreateException(new System.InvalidOperationException.ctor,new Error);return(t=(this.dataBase.get_Anchors()[i].get_BottomAnchor()+this.dataBase.get_Anchors()[r].get_TopAnchor()+this.get_LayoutSettings().get_LayerSeparation())/u,t>1)?t:1},FindHighestTopOnLayer:function(n){for(var i,f,r=this.layerArrays.get_Layers()[n],t=r[0],e=this.NodeY(n,t)+this.dataBase.get_Anchors()[t].get_TopAnchor(),u=1;u<r.length;u++)i=r[u],f=this.NodeY(n,i)+this.dataBase.get_Anchors()[i].get_TopAnchor(),f>e&&(e=f,t=i);return t},FindLowestBottomOnLayer:function(n){for(var i,f,r=this.layerArrays.get_Layers()[n],t=r[0],e=this.NodeY(n,t)-this.dataBase.get_Anchors()[t].get_BottomAnchor(),u=1;u<r.length;u++)i=r[u],f=this.NodeY(n,i)-this.dataBase.get_Anchors()[i].get_BottomAnchor(),f<e&&(e=f,t=i);return t},NodeY:function(n,t){return-(this.IsOriginal(t)?this.nodeOffsets.get_Item$$TKey(this.intGraph.get_Nodes().get_Item$$Int32(t)):this.layerOffsets[n])},IsOriginal:function(n){return n<this.intGraph.get_NodeCount()},CalculateAnchorsY:function(n,t,i){var r,u;for(this.dataBase.get_Anchors()[n].set_Y(-i),r=this.intGraph.OutEdges(n).GetEnumerator();r.MoveNext();)u=r.get_Current(),this.CalculateAnchorsY(u.get_Target(),t,i+u.get_Edge().get_Length()*t)},SizeAnchors:function(){var i,f,n,e,o,u,t;for(this.dataBase.set_Anchors(this.anchors=new Array(this.properLayeredGraph.get_NodeCount())),i=0;i<this.anchors.length;i++)this.anchors[i]=new Microsoft.Msagl.Layout.Layered.Anchor.ctor$$Double(this.get_LayoutSettings().get_LabelCornersPreserveCoefficient());for(i=0;i<this.intGraph.get_NodeCount();i++)this.CalcAnchorsForOriginalNode(i);for(f=this.dataBase.get_AllIntEdges().GetEnumerator();f.MoveNext();)if(n=f.get_Current(),n.get_LayerEdges()!=null){for(e=n.get_LayerEdges().GetEnumerator();e.MoveNext();)o=e.get_Current(),u=o.get_Target(),u!=n.get_Target()&&(t=this.anchors[u],this.dataBase.get_MultipleMiddles().Contains$$T(u)?(t.set_LeftAnchor(function(n){return t.set_RightAnchor(n),n}.call(this,Microsoft.Msagl.Prototype.Phylo.PhyloTreeLayoutCalclulation.get_VirtualNodeWidth()*4)),t.set_TopAnchor(function(n){return t.set_BottomAnchor(n),n}.call(this,this.get_VirtualNodeHeight()/2))):(t.set_LeftAnchor(function(n){return t.set_RightAnchor(n),n}.call(this,Microsoft.Msagl.Prototype.Phylo.PhyloTreeLayoutCalclulation.get_VirtualNodeWidth()/2)),t.set_TopAnchor(function(n){return t.set_BottomAnchor(n),n}.call(this,this.get_VirtualNodeHeight()/2))));if(n.get_Edge().get_Label()!=null){var h=n.get_LayerEdges().get_Item$$Int32(n.get_LayerEdges().get_Count()/2|0).get_Source(),r=this.anchors[h],c=n.get_LabelWidth(),s=n.get_LabelHeight();r.set_RightAnchor(c);r.set_LeftAnchor(this.get_LayoutSettings().get_NodeSeparation());r.get_TopAnchor()<s/2&&r.set_TopAnchor(function(n){return r.set_BottomAnchor(n),n}.call(this,s/2));r.set_LabelToTheRightOfAnchorCenter(!0)}}},VirtualNodeHeight$$:"System.Double",get_VirtualNodeHeight:function(){return this.get_LayoutSettings().get_MinNodeHeight()*1.5/8},CalcAnchorsForOriginalNode:function(n){var u=0,i=u,t=0,r=t,o,f,e;this.intGraph.get_Nodes()!=null&&(o=this.intGraph.get_Nodes().get_Item$$Int32(n),function(){var n={Value:u},f={Value:i},e={Value:t},s={Value:r},h=Microsoft.Msagl.Prototype.Phylo.PhyloTreeLayoutCalclulation.ExtendStandardAnchors(n,f,e,s,o);return u=n.Value,i=f.Value,t=e.Value,r=s.Value,h}.call(this)),function(){var u={Value:i},f={Value:t},e={Value:r},o=this.RightAnchorMultiSelfEdges(n,u,f,e);return i=u.Value,t=f.Value,r=e.Value,o}.call(this);f=this.get_LayoutSettings().get_MinNodeWidth()/2;u<f&&(u=f);i<f&&(i=f);e=this.get_LayoutSettings().get_MinNodeHeight()/2;t<e&&(t=e);r<e&&(r=e);this.anchors[n]=function(){var f=new Microsoft.Msagl.Layout.Layered.Anchor.ctor$$Double$$Double$$Double$$Double$$Node$$Double(u,i,t,r,this.intGraph.get_Nodes().get_Item$$Int32(n),this.get_LayoutSettings().get_LabelCornersPreserveCoefficient());return f.set_Padding(this.intGraph.get_Nodes().get_Item$$Int32(n).get_Padding()),f}.call(this)},RightAnchorMultiSelfEdges:function(n,t,i,r){var u=this.WidthOfSelfeEdge(n,t,i,r);t.Value+=u},WidthOfSelfeEdge:function(n,t,i,r){var o=0,f=this.dataBase.GetMultiedge$$Int32$$Int32(n,n),e,u;if(f.get_Count()>0){for(e=f.GetEnumerator();e.MoveNext();)u=e.get_Current(),u.get_Edge().get_Label()!=null&&(t.Value+=u.get_Edge().get_Label().get_Width(),i.Value<u.get_Edge().get_Label().get_Height()/2&&(i.Value=r.Value=u.get_Edge().get_Label().get_Height()/2));o+=(this.get_LayoutSettings().get_NodeSeparation()+this.get_LayoutSettings().get_MinNodeWidth())*f.get_Count()}return o},RouteSplines:function(){var n=new Microsoft.Msagl.Layout.Layered.Routing.ctor(this.get_LayoutSettings(),this.tree,this.dataBase,this.layerArrays,this.properLayeredGraph,null);n.Run()},RunXCoordinateAssignmentsByBrandes:function(){Microsoft.Msagl.Layout.Layered.XCoordsWithAlignment.CalculateXCoordinates(this.layerArrays,this.properLayeredGraph,this.tree.get_Nodes().get_Count(),this.dataBase.get_Anchors(),this.get_LayoutSettings().get_NodeSeparation())},CreateLayerArraysAndProperLayeredGraph:function(){var t=this.gridLayerOffsets.get_Count(),n,u,f,o;for(this.layerOffsets=new Float64Array(t),n=t-1,u=this.gridLayerOffsets.GetEnumerator();u.MoveNext();)f=u.get_Current(),this.layerOffsets[n]=f.get_Value(),this.gridLayerToLayer.set_Item$$TKey(f.get_Key(),n--);var h=this.CountTotalNodesIncludingVirtual(this.nodesToIndices.get_Item$$TKey(this.tree.get_Root())),e=new Int32Array(h),i=new Array(t);for(n=0;n<t;n++)i[n]=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);this.WalkTreeAndInsertLayerEdges$$Int32$Array$$List$1$Int32$Array(e,i);this.layerArrays=new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(e);o=function(n){return this.layerArrays.set_Layers(n),n}.call(this,new Array(t));n=0;for(var r=0,c=i.length,s=i[r];r<c;r++,s=i[r])o[n++]=s.ToArray();this.properLayeredGraph=new Microsoft.Msagl.Layout.Layered.ProperLayeredGraph.ctor(this.intGraph)},CountTotalNodesIncludingVirtual:function(n){for(var i=1,r=this.intGraph.OutEdges(n).GetEnumerator(),t;r.MoveNext();)t=r.get_Current(),i+=this.NumberOfVirtualNodesOnEdge(t)+this.CountTotalNodesIncludingVirtual(t.get_Target());return i},NumberOfVirtualNodesOnEdge:function(n){return this.OriginalNodeLayer(n.get_Source())-this.OriginalNodeLayer(n.get_Target())-1},OriginalNodeLayer:function(n){return this.gridLayerToLayer.get_Item$$TKey(this.originalNodeToGridLayerIndices[n])},WalkTreeAndInsertLayerEdges$$Int32$Array$$List$1$Int32$Array:function(n,t){var r=this.intGraph.get_NodeCount(),i=this.nodesToIndices.get_Item$$TKey(this.tree.get_Root()),u;n[i]=u=this.OriginalNodeLayer(i);t[u].Add(i),function(){var u={Value:r},f=this.WalkTreeAndInsertLayerEdges$$Int32$Array$$List$1$Int32$Array$$Int32$$Int32(n,t,i,u);return r=u.Value,f}.call(this)},WalkTreeAndInsertLayerEdges$$Int32$Array$$List$1$Int32$Array$$Int32$$Int32:function(n,t,i,r){for(var u=this.intGraph.OutEdges(i).GetEnumerator(),f;u.MoveNext();)f=u.get_Current(),this.InsertLayerEdgesForEdge(f,n,r,t)},InsertLayerEdgesForEdge:function(n,t,i,r){var f=this.OriginalNodeLayer(n.get_Source())-this.OriginalNodeLayer(n.get_Target()),e,u,o;for(n.set_LayerEdges(new Array(f)),u=0;u<f;u++)n.get_LayerEdges().set_Item$$Int32(u,new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(Microsoft.Msagl.Prototype.Phylo.PhyloTreeLayoutCalclulation.GetSource(u,n,i),Microsoft.Msagl.Prototype.Phylo.PhyloTreeLayoutCalclulation.GetTarget(u,f,n,i.Value),n.get_CrossingWeight()));for(e=this.OriginalNodeLayer(n.get_Source())-1,u=0;u<f;u++)o=n.get_LayerEdges().get_Item$$Int32(u).get_Target(),t[o]=e,r[e--].Add(o);this.WalkTreeAndInsertLayerEdges$$Int32$Array$$List$1$Int32$Array$$Int32$$Int32(t,r,n.get_Target(),i)},ProcessPositionedAnchors:function(){for(var n=0;n<this.tree.get_Nodes().get_Count();n++)this.intGraph.get_Nodes().get_Item$$Int32(n).set_Center(this.anchors[n].get_Origin())},CalcTheBoxFromAnchors:function(){var n,t,i;if(this.anchors.length>0){for(n=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(this.anchors[0].get_Left(),this.anchors[0].get_Top(),this.anchors[0].get_Right(),this.anchors[0].get_Bottom()),t=1;t<this.anchors.length;t++)i=this.anchors[t],n.Add$$Point(i.get_LeftTop()),n.Add$$Point(i.get_RightBottom());var f=System.Math.Max$$Double$$Double(n.get_Width(),n.get_Height()),r=this.tree.get_Margins()/100*f,u=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-r,r);n.Add$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_LeftTop(),u));n.Add$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_RightBottom(),u));this.tree.set_BoundingBox(n)}}}};JsTypes.push(Microsoft$Msagl$Prototype$Phylo$PhyloTreeLayoutCalclulation);Microsoft$Msagl$Prototype$Ranking$Centrality={fullname:"Microsoft.Msagl.Prototype.Ranking.Centrality",baseTypeName:"System.Object",staticDefinition:{PageRank:function(n,t,i){for(var e=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Double.ctor),k=n.get_Nodes().get_Count(),y=n.get_Nodes().GetEnumerator(),s,u,h,c,l,a,v,o,f,r;y.MoveNext();)r=y.get_Current(),e.set_Item$$TKey(r,1/n.get_Nodes().get_Count());for(s=0;s<50;s++){for(u=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Double.ctor),h=n.get_Nodes().GetEnumerator();h.MoveNext();)r=h.get_Current(),u.set_Item$$TKey(r,(1-t)/n.get_Nodes().get_Count());if(i)for(c=n.get_Nodes().GetEnumerator();c.MoveNext();)for(r=c.get_Current(),l=r.get_OutEdges().GetEnumerator();l.MoveNext();)o=l.get_Current(),f=o.get_Target(),u.set_Item$$TKey(r,u.get_Item$$TKey(r)+t*e.get_Item$$TKey(f)/System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,f.get_InEdges()));else for(a=n.get_Nodes().GetEnumerator();a.MoveNext();)for(r=a.get_Current(),v=r.get_InEdges().GetEnumerator();v.MoveNext();)o=v.get_Current(),f=o.get_Source(),u.set_Item$$TKey(r,u.get_Item$$TKey(r)+t*e.get_Item$$TKey(f)/System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,f.get_OutEdges()));e=u}for(var p=new Float64Array(k),w=0,b=n.get_Nodes().GetEnumerator();b.MoveNext();)r=b.get_Current(),p[w]=e.get_Item$$TKey(r),w++;return p}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Prototype$Ranking$Centrality);Microsoft$Msagl$Prototype$Ranking$RankingLayout={fullname:"Microsoft.Msagl.Prototype.Ranking.RankingLayout",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},Standardize:function(n){for(var i=Infinity,r=-Infinity,t=0;t<n.length;t++)r=System.Math.Max$$Double$$Double(r,n[t]),i=System.Math.Min$$Double$$Double(i,n[t]);for(t=0;t<n.length;t++)n[t]=(n[t]-i)/(r-i)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.graph=null;this.settings=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.settings=n;this.graph=t},SetNodePositionsAndMovedBoundaries:function(n){var c=System.Math.Min$$Int32$$Int32(n.get_Nodes().get_Count(),this.settings.get_PivotNumber()),l=this.settings.get_ScaleX(),a=this.settings.get_ScaleY(),f=new Int32Array(c),e=new Microsoft.Msagl.Layout.MDS.PivotDistances.ctor(n,!1,f),o,t,s,r,i,u,h;for(e.Run(),o=e.get_Result(),function(){var n={Value:t},i={Value:s},r=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.LandmarkClassicalScaling(o,n,i,f);return t=n.Value,s=i.Value,r}.call(this),Microsoft.Msagl.Prototype.Ranking.RankingLayout.Standardize(t),r=Microsoft.Msagl.Prototype.Ranking.Centrality.PageRank(n,.85,!1),Microsoft.Msagl.Prototype.Ranking.RankingLayout.Standardize(r),i=0,u=n.get_Nodes().GetEnumerator();u.MoveNext();)h=u.get_Current(),h.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t[i]*l|0,System.Math.Sqrt(r[i])*a|0)),i++;Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.RemoveOverlaps$$Node$Array$$Double(System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes()),this.settings.get_NodeSeparation())},RunInternal:function(){for(var i,r,n=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.CreateComponents(this.graph.get_Nodes(),this.graph.get_Edges())),t=0;t<n.length;t++)System.Console.WriteLine$$String$$Object("laying out {0} connected component",t),this.Calculate(n[t]);if(n.length>1)for(Microsoft.Msagl.Layout.MDS.MdsGraphLayout.PackGraphs(n,this.settings),i=System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n,$CreateAnonymousDelegate(this,function(n){return n.get_Nodes()})).GetEnumerator();i.MoveNext();)r=i.get_Current(),r.set_GeometryParent(this.graph)},Calculate:function(n){if(n.get_Nodes().get_Count()!=0){this.SetNodePositionsAndMovedBoundaries(n);var t=this.settings.get_NodeSeparation();t<=0&&(t=10);Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.RemoveOverlaps$$Node$Array$$Double(System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes()),t);this.SetGraphBoundingBox(n)}},SetGraphBoundingBox:function(n){n.set_BoundingBox(n.PumpTheBoxToTheGraphWithMargins())}}};JsTypes.push(Microsoft$Msagl$Prototype$Ranking$RankingLayout);Microsoft$Msagl$Prototype$Ranking$RankingLayoutSettings={fullname:"Microsoft.Msagl.Prototype.Ranking.RankingLayoutSettings",baseTypeName:"Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.pivotNumber=50;this.scaleX=200;this.scaleY=200;this.omegaX=.15;this.omegaY=.15;Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings.ctor.call(this);this.set_NodeSeparation(0)},PivotNumber$$:"System.Int32",get_PivotNumber:function(){return this.pivotNumber},set_PivotNumber:function(n){this.pivotNumber=n},OmegaX$$:"System.Double",get_OmegaX:function(){return this.omegaX},set_OmegaX:function(n){this.omegaX=n},OmegaY$$:"System.Double",get_OmegaY:function(){return this.omegaY},set_OmegaY:function(n){this.omegaY=n},ScaleX$$:"System.Double",get_ScaleX:function(){return this.scaleX},set_ScaleX:function(n){this.scaleX=n},ScaleY$$:"System.Double",get_ScaleY:function(){return this.scaleY},set_ScaleY:function(n){this.scaleY=n},Clone:function(){return As(this.MemberwiseClone(),Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings.ctor)}}};JsTypes.push(Microsoft$Msagl$Prototype$Ranking$RankingLayoutSettings);Microsoft$Msagl$Miscellaneous$RegularGrid$GridTraversal={fullname:"Microsoft.Msagl.Miscellaneous.RegularGrid.GridTraversal",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this._boundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._iLevel=0;this._numberOfTilesOnSide=0;this._TileWidth=0;this._TileHeight=0;System.Object.ctor.call(this);this._boundingBox=n;this._iLevel=t;this._numberOfTilesOnSide=System.Math.Pow(2,t)|0;this.set_TileWidth(n.get_Width()/this._numberOfTilesOnSide);this.set_TileHeight(n.get_Height()/this._numberOfTilesOnSide)},TileWidth$$:"System.Double",get_TileWidth:function(){return this._TileWidth},set_TileWidth:function(n){this._TileWidth=n},TileHeight$$:"System.Double",get_TileHeight:function(){return this._TileHeight},set_TileHeight:function(n){this._TileHeight=n},ILevel$$:"System.Int32",get_ILevel:function(){return this._iLevel},PointToTuple:function(n){var t=n.get_X()-this._boundingBox.get_Left()|0,i=n.get_Y()-this._boundingBox.get_Bottom()|0,r=t/this.get_TileWidth()|0,u=i/this.get_TileHeight()|0;return new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,r,u)},GetTilesIntersectedByLineSeg:function(n,t){var i=new System.Collections.Generic.List$1.ctor(System.Tuple$2.ctor),r=this.PointToTuple(n),u=this.PointToTuple(t),f;return(i.Add(r),r.Equals$$Object(u))?i:(i.Add(u),f=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,t),2),this.InsertTilesLeftHalf(r,n,f,i),this.InsertTilesRightHalf(f,t,u,i),i)},InsertTilesLeftHalf:function(n,t,i,r){var u,f;(System.Diagnostics.Debug.Assert$$Boolean(this.PointToTuple(t).Equals$$Object(n)),u=this.PointToTuple(i),u.Equals$$Object(n)||Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point$$Double(t,i,this.get_TileWidth()/10))||(r.Add(u),f=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,i),2),this.InsertTilesLeftHalf(n,t,f,r),this.InsertTilesRightHalf(f,i,u,r))},InsertTilesRightHalf:function(n,t,i,r){var u=this.PointToTuple(n),f;u.Equals$$Object(i)||Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point$$Double(n,t,this.get_TileWidth()/10)||(r.Add(u),f=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,t),2),this.InsertTilesLeftHalf(u,n,f,r),this.InsertTilesRightHalf(f,t,i,r))},GetTileRect:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this._boundingBox.get_LeftBottom(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n*this.get_TileWidth(),t*this.get_TileHeight()));return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(i,Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_TileWidth(),this.get_TileHeight())))},SplitTileNameOnDirectories:function(n,t){var r=new System.Collections.Generic.List$1.ctor(System.String.ctor),i=t|0*this._numberOfTilesOnSide+n|0,u=500,f,e;do{if(i<u){r.Add(i.toString());break}f=i/u|0;e=i-f*u;r.Add(e.toString());i=f}while(1);return r.Add(this.get_ILevel().toString()),r},GetTileCenter:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.op_Addition(this._boundingBox.get_LeftBottom(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n*this.get_TileWidth()+.5*this.get_TileWidth(),t*this.get_TileHeight()+.5*this.get_TileHeight()))}}};JsTypes.push(Microsoft$Msagl$Miscellaneous$RegularGrid$GridTraversal);Microsoft$Msagl$Layout$LargeGraphLayout$LgPathRouter={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgPathRouter",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.LargeGraphLayout.LgPathRouter.searchEps=1e-5},SortPointByAngles:function(n,t){for(var r=new Float64Array(t.length),i=0;i<t.length;i++)r[i]=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1,0),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t[i],n.get_Center()));System.Array.Sort$2$$TKey$Array$$TValue$Array(System.Double.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,r,t)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._visGraph=null;this._visGraphVerticesTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor);this._usedEdges=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,System.Int32.ctor);this._edgesOnOldTrajectories=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor);System.Object.ctor.call(this);this._visGraph=new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor},VisGraph$$:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",get_VisGraph:function(){return this._visGraph},set_VisGraph:function(n){this._visGraph=n},IsOnOldTrajectory:function(n){return this._edgesOnOldTrajectories.Contains$$T(n)},MarkEdgeUsed:function(n,t){var i=this.FindEdge(n,t),r;(function(){var n={Value:r},t=this._usedEdges.TryGetValue(i,n);return r=n.Value,t}).call(this)?this._usedEdges.set_Item$$TKey(i,this._usedEdges.get_Item$$TKey(i)+1):this._usedEdges.set_Item$$TKey(i,1)},MarkEdgeAsEdgeOnOldTrajectory:function(n,t){var i=this.FindEdge(n,t);this._edgesOnOldTrajectories.Insert(i)},IsEdgeUsed:function(n){var t;return function(){var i={Value:t},r=this._usedEdges.TryGetValue(n,i);return t=i.Value,r}.call(this)?t>0:!1},MarkEdgesUsedAlongPath:function(n){for(var t=0;t<n.get_Count()-1;t++)this.MarkEdgeUsed(n.get_Item$$Int32(t),n.get_Item$$Int32(t+1))},MarkEdgesAlongPathAsEdgesOnOldTrajectories:function(n){for(var t=0;t<n.get_Count()-1;t++)this.MarkEdgeAsEdgeOnOldTrajectory(n.get_Item$$Int32(t),n.get_Item$$Int32(t+1))},AddVisGraphEdge:function(n,t){var i=this.GetOrFindVisibilityVertex(n)!=null?this.GetOrFindVisibilityVertex(n):this.AddNewVertex(n),r=this.GetOrFindVisibilityVertex(t)!=null?this.GetOrFindVisibilityVertex(t):this.AddNewVertex(t);return Microsoft.Msagl.Routing.Visibility.VisibilityGraph.AddEdge$$VisibilityVertex$$VisibilityVertex(i,r)},AddVisGraphEdgesFromNodeCenterToNodeBorder:function(n){var i=this.get_VisGraph().AddVertex$$Point(n.get_Center()),t;for(i.set_IsTerminal(!0),t=n.get_BoundaryOnLayer().get_PolylinePoints().GetEnumerator();t.MoveNext();){var u=t.get_Current(),f=this.GetOrFindVisibilityVertex(u.get_Point()),r=Microsoft.Msagl.Routing.Visibility.VisibilityGraph.AddEdge$$VisibilityVertex$$VisibilityVertex(i,f);r.set_IsPassable($CreateAnonymousDelegate(this,function(){return this.EdgeIsPassable(r)}))}},RemoveVisGraphVertex:function(n){var t=this._visGraph.FindVertex(n);t!=null&&(this._visGraph.RemoveVertex(t),this._visGraphVerticesTree.Remove(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(n),t))},GetOrFindVisibilityVertex:function(n){var t=this._visGraph.FindVertex(n);return t!=null?t:(t=this._visGraph.AddVertex$$Point(n),this.RegisterInTree(t),t)},ModifySkeletonWithNewBoundaryOnLayer:function(n){for(var r=this.GetEdgeSnapAtVertexMap(n),u=r.GetEnumerator(),f,t,i;u.MoveNext();)f=u.get_Current(),t=f.get_Key(),Microsoft.Msagl.Routing.Visibility.VisibilityGraph.RemoveEdge$$VisibilityEdge(t),i=r.get_Item$$TKey(t),Microsoft.Msagl.Core.Geometry.Point.op_Inequality(n.get_Center(),t.get_SourcePoint())?Microsoft.Msagl.Routing.Visibility.VisibilityGraph.AddEdge$$VisibilityVertex$$VisibilityVertex(t.get_Source(),i):Microsoft.Msagl.Routing.Visibility.VisibilityGraph.AddEdge$$VisibilityVertex$$VisibilityVertex(i,t.get_Target())},GlueOrAddToPolylineAndVisGraph:function(n,t,i,r){var u=n[t],f;return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(i.Point,u)?i:Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(u,r.get_StartPoint().get_Point())?(f=this.get_VisGraph().FindVertex(r.get_StartPoint().get_Point()),System.Diagnostics.Debug.Assert$$Boolean(f!=null),f):(r.AddPoint$$Point(u),this.get_VisGraph().AddVertex$$Point(u))},GetEdgeSnapAtVertexMap:function(n){for(var i=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor),r=n.get_Center(),f=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$Func$3(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,$CreateAnonymousDelegate(this,function(n,t){return this.CompareByAngleFromNodeCenter(n,t,r)})),s=n.get_BoundaryOnLayer().GetEnumerator(),h,u,e,o,t;s.MoveNext();)h=s.get_Current(),f.Insert(this._visGraph.AddVertex$$Point(h));if(u=this.get_VisGraph().FindVertex(r),u==null)return i;for(e=u.get_OutEdges().GetEnumerator();e.MoveNext();)t=e.get_Current(),this.SnapToAfterBefore(t.get_Target(),f,r,i,t);for(o=u.get_InEdges().GetEnumerator();o.MoveNext();)t=o.get_Current(),this.SnapToAfterBefore(t.get_Source(),f,r,i,t);return i},SnapToAfterBefore:function(n,t,i,r,u){var f,e,o,s;(function(){var r={Value:f},u={Value:e},o=this.FindBeforeAfterV(n,t,r,u,i);return f=r.Value,e=u.Value,o}).call(this);o=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.Point,i),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Point,i));s=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Point,i),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e.Point,i));r.set_Item$$TKey(u,o<=s?f:e)},FindBeforeAfterV:function(n,t,i,r,u){var e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1,0),o=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(e,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Point,u)),f=t.FindLast$$Func$2($CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(e,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Point,u))<=o}));i.Value=f!=null?f.Item:t.TreeMaximum().Item;f=t.FindFirst$$Func$2($CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(e,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Point,u))>=o}));r.Value=f!=null?f.Item:t.TreeMinimum().Item},CompareByAngleFromNodeCenter:function(n,t,i){var r=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1,0),u=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(r,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Point,i)),f=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(r,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Point,i));return u.CompareTo$$Double(f)},AddNewVertex:function(n){var t=this._visGraph.AddVertex$$Point(n);return this.RegisterInTree(t),t},AddVisGraphVertex:function(n){return this._visGraph.ContainsVertex(n)?n:(this.AddNewVertex(n),n)},GetPortVertices:function(n){return System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_BoundaryOnLayer().get_PolylinePoints(),$CreateAnonymousDelegate(this,function(n){return n.get_Point()})))},GetPath$$VisibilityVertex$$VisibilityVertex$$Boolean:function(n,t,i){var u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),o,f,e,r;if(n.set_IsShortestPathTerminal(function(n){return t.set_IsShortestPathTerminal(n),n}.call(this,!0)),this._visGraph.ClearPrevEdgesTable(),o=function(){var i=new Microsoft.Msagl.Routing.SingleSourceSingleTargetShortestPathOnVisibilityGraph.ctor$$VisibilityGraph$$VisibilityVertex$$VisibilityVertex(this._visGraph,n,t);return i.set_LengthMultiplier(.8),i.set_LengthMultiplierForAStar(.3),i}.call(this),f=o.GetPath(i),f==null)return System.Console.WriteLine$$String("seeing a null path"),n.set_IsShortestPathTerminal(function(n){return t.set_IsShortestPathTerminal(n),n}.call(this,!1)),u;for(e=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,f),r=0;r<System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,e);r++)u.Add(e.get_Item$$Int32(r).Point);return n.set_IsShortestPathTerminal(function(n){return t.set_IsShortestPathTerminal(n),n}.call(this,!1)),u},GetPath$$VisibilityVertex$$VisibilityVertex$$Boolean$$Tiling:function(n,t,i,r){var f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),s,e,o,u;if(n.set_IsShortestPathTerminal(function(n){return t.set_IsShortestPathTerminal(n),n}.call(this,!0)),this._visGraph.ClearPrevEdgesTable(),s=function(){var i=new Microsoft.Msagl.Routing.SingleSourceSingleTargetShortestPathOnVisibilityGraph.ctor$$VisibilityGraph$$VisibilityVertex$$VisibilityVertex$$Tiling(this._visGraph,n,t,r);return i.set_LengthMultiplier(.8),i.set_LengthMultiplierForAStar(.3),i}.call(this),e=s.GetPath(i),e==null)return System.Console.WriteLine$$String("seeing a null path"),n.set_IsShortestPathTerminal(function(n){return t.set_IsShortestPathTerminal(n),n}.call(this,!1)),f;for(o=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,e),u=0;u<System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,o);u++)f.Add(o.get_Item$$Int32(u).Point);return n.set_IsShortestPathTerminal(function(n){return t.set_IsShortestPathTerminal(n),n}.call(this,!1)),f},GetEdgesOfPath:function(n){for(var i,r,u,f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor),t=0;t<n.get_Count()-1;t++)(i=this.GetOrFindVisibilityVertex(n.get_Item$$Int32(t)),i!=null)&&(r=this.GetOrFindVisibilityVertex(n.get_Item$$Int32(t+1)),r!=null)&&(u=this._visGraph.FindEdge$$Point$$Point(i.Point,r.Point),u!=null&&f.Add(u));return f},FindEdge:function(n,t){var r=this.FindVertex(n),i;return r==null?null:(i=this.FindVertex(t),i==null?null:this._visGraph.FindEdge$$Point$$Point(r.Point,i.Point))},GetPath$$LgNodeInfo$$LgNodeInfo$$Boolean:function(n,t,i){var u=this.get_VisGraph().FindVertex(n.get_Center()),r;return System.Diagnostics.Debug.Assert$$Boolean(u!=null),r=this.get_VisGraph().FindVertex(t.get_Center()),System.Diagnostics.Debug.Assert$$Boolean(r!=null),this.GetPath$$VisibilityVertex$$VisibilityVertex$$Boolean(u,r,i)},GetPath$$LgNodeInfo$$LgNodeInfo$$Boolean$$Tiling:function(n,t,i,r){var f=this.get_VisGraph().FindVertex(r.nodeToLoc.get_Item$$TKey(n.get_GeometryNode())),u;return System.Diagnostics.Debug.Assert$$Boolean(f!=null),u=this.get_VisGraph().FindVertex(r.nodeToLoc.get_Item$$TKey(t.get_GeometryNode())),System.Diagnostics.Debug.Assert$$Boolean(u!=null),this.GetPath$$VisibilityVertex$$VisibilityVertex$$Boolean$$Tiling(f,u,i,r)},GetAllVertices:function(){return System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,this._visGraph.Vertices())},GetPointsOfVerticesOverlappingSegment:function(n,t){var i=this.get_VisGraph().FindVertex(n),r=this.get_VisGraph().FindVertex(t);return this.GetPath$$VisibilityVertex$$VisibilityVertex$$Boolean(i,r,!1)},GetAllEdgesVisibilityEdges:function(){return this._visGraph.get_Edges()},ExistsEdge:function(n,t){var r=this.GetOrFindVisibilityVertex(n),i;return r==null?!1:(i=this.GetOrFindVisibilityVertex(t),i==null)?!1:this._visGraph.FindEdge$$Point$$Point(r.Point,i.Point)!=null},GetPathOnSavedTrajectory:function(n,t,i){var f,r,u;if(i==null||i.get_Count()<2)return this.GetPath$$LgNodeInfo$$LgNodeInfo$$Boolean(n,t,!0);for(f=function(){var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);return n.Add(i.get_Item$$Int32(0)),n}.call(this),r=0;r<i.get_Count()-1;r++){var o=i.get_Item$$Int32(r),s=i.get_Item$$Int32(r+1),e=this.GetPointsOfVerticesOverlappingSegment(o,s);for(u=1;u<e.get_Count();u++)f.Add(e.get_Item$$Int32(u))}return f},HasCycles:function(n){var e=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),o=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor),f=this.AddVisGraphVertex(n),t,i,s,r,h,u;for(e.Insert(f),o.set_Item$$TKey(f,f),t=function(){var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);return n.Add(f),n}.call(this);System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,t);)for(i=System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,t),t.Remove(i),s=this._visGraph.FindVertex(i),r=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),r.InsertRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,s.get_OutEdges(),$CreateAnonymousDelegate(this,function(n){return n.get_TargetPoint()}))),r.InsertRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,s.get_InEdges(),$CreateAnonymousDelegate(this,function(n){return n.get_SourcePoint()}))),r.Remove(o.get_Item$$TKey(i)),h=r.GetEnumerator();h.MoveNext();){if(u=h.get_Current(),o.set_Item$$TKey(u,i),e.Contains$$T(u))return!0;e.Insert(u);t.Add(u)}return!1},DecreaseWeightOfEdgesAlongPath:function(n,t){for(var u=this.GetEdgesOfPath(n),r=u.GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),i.LengthMultiplier=System.Math.Min$$Double$$Double(i.LengthMultiplier,t)},AssertEdgesPresentAndPassable:function(n){var r=this.get_VisGraph().FindVertex(n.get_Item$$Int32(0)),t,e,u,i,f;for(System.Diagnostics.Debug.Assert$$Boolean(r!=null),t=this.get_VisGraph().FindVertex(n.get_Item$$Int32(n.get_Count()-2)),System.Diagnostics.Debug.Assert$$Boolean(t!=null),r.set_IsShortestPathTerminal(function(n){return t.set_IsShortestPathTerminal(n),n}.call(this,!0)),e=function(){var n=new Microsoft.Msagl.Routing.SingleSourceSingleTargetShortestPathOnVisibilityGraph.ctor$$VisibilityGraph$$VisibilityVertex$$VisibilityVertex(this._visGraph,r,t);return n.set_LengthMultiplier(.8),n.set_LengthMultiplierForAStar(0),n}.call(this),u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor),i=0;i<n.get_Count()-1;i++)f=this.FindEdge(n.get_Item$$Int32(i),n.get_Item$$Int32(i+1)),System.Diagnostics.Debug.Assert$$Boolean(f!=null),u.Add(f);e.AssertEdgesPassable(u);r.set_IsShortestPathTerminal(function(n){return t.set_IsShortestPathTerminal(n),n}.call(this,!1))},SetWeightOfEdgesAlongPathToMin:function(n,t){for(var u=this.GetEdgesOfPath(n),r=u.GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),i.LengthMultiplier=System.Math.Max$$Double$$Double(i.LengthMultiplier,t)},ResetAllEdgeLengthMultipliers:function(){for(var i=this._visGraph.get_Edges(),n=i.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.LengthMultiplier=1},SetAllEdgeLengthMultipliersMin:function(n){for(var r=this._visGraph.get_Edges(),i=r.GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),t.LengthMultiplier=System.Math.Max$$Double$$Double(t.LengthMultiplier,n)},ContainsVertex:function(n){return this.get_VisGraph().FindVertex(n)!=null},FindVertex:function(n){return this.get_VisGraph().FindVertex(n)},RemoveEdge:function(n,t){var i=this.get_VisGraph().FindEdge$$Point$$Point(n,t);this._usedEdges.Remove(i);this._edgesOnOldTrajectories.Remove(i);this._visGraph.RemoveEdge$$VisibilityVertex$$VisibilityVertex(i.get_Source(),i.get_Target())},RemoveVisibilityEdges:function(n){for(var i=n.GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),this._visGraph.RemoveEdge$$VisibilityVertex$$VisibilityVertex(t.get_Source(),t.get_Target()),t.get_Source().get_Degree()==0&&this.RemoveVisGraphVertex(t.get_SourcePoint()),t.get_Target().get_Degree()==0&&this.RemoveVisGraphVertex(t.get_TargetPoint())},AddEdges:function(n){for(var i=n.GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),this.AddVisGraphEdge(t.get_A(),t.get_B())},RegisterInTree:function(n){var i=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(n.Point),t;if(function(){var n={Value:t},r=this._visGraphVerticesTree.OneIntersecting(i,n);return t=n.Value,r}.call(this)){System.Diagnostics.Debug.Assert$$Boolean(t==n);return}this._visGraphVerticesTree.Add$$Rectangle$$TData(i,n)},EdgeIsPassable:function(n){return!n.get_Source().get_IsTerminal()&&!n.get_Target().get_IsTerminal()||n.get_Source().get_IsShortestPathTerminal()||n.get_Target().get_IsShortestPathTerminal()},ClearUsedEdges:function(){this._usedEdges.Clear()},DiminishUsed:function(n,t){var i=this.get_VisGraph().FindEdge$$Point$$Point(n,t),r;i!=null&&function(){var n={Value:r},t=this._usedEdges.TryGetValue(i,n);return r=n.Value,t}.call(this)&&r>0&&this._usedEdges.set_Item$$TKey(i,this._usedEdges.get_Item$$TKey(i)-1)},UsedEdges:function(){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,this._usedEdges,$CreateAnonymousDelegate(this,function(n){return n.get_Value()>0})),$CreateAnonymousDelegate(this,function(n){return n.get_Key()})),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_SourcePoint(),n.get_TargetPoint())}))},EdgesOnOldTrajectories:function(){for(var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor),i=this._edgesOnOldTrajectories.GetEnumerator(),n;i.MoveNext();)n=i.get_Current(),t.Add(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_SourcePoint(),n.get_TargetPoint()));return t},SegmentsNotOnOldTrajectories:function(){for(var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor),i=this.get_VisGraph().get_Edges().GetEnumerator(),n;i.MoveNext();)n=i.get_Current(),this._edgesOnOldTrajectories.Contains$$T(n)||t.Add(new Microsoft.Msagl.Core.DataStructures.SymmetricTuple$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_SourcePoint(),n.get_TargetPoint()));return t}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgPathRouter);Microsoft$Msagl$Miscellaneous$Routing$ShortestPathTree={fullname:"Microsoft.Msagl.Miscellaneous.Routing.ShortestPathTree",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this._points=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);this._paret=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor);this._root=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this._root=n;this._points.Insert(n);this._paret.set_Item$$TKey(this._root,this._root)},AddPathToTree:function(n){var i,t;if(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n).Equals$$Object(this._root)||n.Reverse(),System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n).Equals$$Object(this._root)){for(i=n.get_Count()-1;i>=0;i--)if(this._points.Contains$$T(n.get_Item$$Int32(i)))break;for(t=n.get_Count()-1;t>i;t--){if(this._points.Contains$$T(n.get_Item$$Int32(t)))break;this._points.Insert(n.get_Item$$Int32(t));this._paret.set_Item$$TKey(n.get_Item$$Int32(t),n.get_Item$$Int32(t-1))}}},GetPathFromRoot:function(n){var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),t;if(!this._points.Contains$$T(n))return null;for(t=n;!t.Equals$$Object(this._root);t=this._paret.get_Item$$TKey(t))i.Insert(0,t);return i.Insert(0,this._root),i}}};JsTypes.push(Microsoft$Msagl$Miscellaneous$Routing$ShortestPathTree);Microsoft$Msagl$Routing$ClusterBoundaryPort={fullname:"Microsoft.Msagl.Routing.ClusterBoundaryPort",baseTypeName:"Microsoft.Msagl.Core.Layout.RelativeFloatingPort",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Func$1$ICurve$$Func$1$Point$$Point:function(n,t,i){this.loosePolyline=null;Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point$$Point.call(this,n,t,i)},LoosePolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_LoosePolyline:function(){return this.loosePolyline},set_LoosePolyline:function(n){this.loosePolyline=n},ctor$$Func$1$ICurve$$Func$1$Point:function(n,t){this.loosePolyline=null;Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$ClusterBoundaryPort);Microsoft$Msagl$Routing$CdtEdge={fullname:"Microsoft.Msagl.Routing.CdtEdge",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.upperSite=null;this.lowerSite=null;this.ccwTriangle=null;this.cwTriangle=null;this.Constrained=!1;this.Capacity=1e6;this._ResidualCapacity=0;System.Object.ctor.call(this);var i=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.Above$$Point$$Point(n.Point,t.Point);i==1?(this.upperSite=n,this.lowerSite=t):(System.Diagnostics.Debug.Assert$$Boolean(i!=0),this.lowerSite=n,this.upperSite=t);this.upperSite.AddEdgeToSite(this)},ResidualCapacity$$:"System.Double",get_ResidualCapacity:function(){return this._ResidualCapacity},set_ResidualCapacity:function(n){this._ResidualCapacity=n},CcwTriangle$$:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle",get_CcwTriangle:function(){return this.ccwTriangle},set_CcwTriangle:function(n){System.Diagnostics.Debug.Assert$$Boolean(n==null||this.cwTriangle==null||n.OppositeSite(this)!=this.cwTriangle.OppositeSite(this));this.ccwTriangle=n},CwTriangle$$:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle",get_CwTriangle:function(){return this.cwTriangle},set_CwTriangle:function(n){System.Diagnostics.Debug.Assert$$Boolean(n==null||this.ccwTriangle==null||n.OppositeSite(this)!=this.ccwTriangle.OppositeSite(this));this.cwTriangle=n},GetOtherTriangle$$CdtSite:function(n){return this.cwTriangle.Contains(n)?this.ccwTriangle:this.cwTriangle},IsAdjacent:function(n){return n==this.upperSite||n==this.lowerSite},GetOtherTriangle$$CdtTriangle:function(n){return this.ccwTriangle==n?this.cwTriangle:this.ccwTriangle},toString:function(){return System.String.Format$$String$$Object$$Object("({0},{1})",this.upperSite,this.lowerSite)},OtherSite:function(n){return System.Diagnostics.Debug.Assert$$Boolean(this.IsAdjacent(n)),this.upperSite==n?this.lowerSite:this.upperSite}}};JsTypes.push(Microsoft$Msagl$Routing$CdtEdge);Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtFront={fullname:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtFront",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.front=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$Func$3(Microsoft.Msagl.Routing.CdtSite.ctor,$CreateAnonymousDelegate(this,function(n,t){return n.Point.get_X().CompareTo$$Double(t.Point.get_X())}));System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtFront);Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtFrontElement={fullname:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtFrontElement",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.LeftSite=null;this.Edge=null;this.RightSite=null;System.Object.ctor.call(this);System.Diagnostics.Debug.Assert$$Boolean(t.upperSite.Point.get_X()!=t.lowerSite.Point.get_X()&&t.upperSite.Point.get_X()<t.lowerSite.Point.get_X()&&n==t.upperSite||t.upperSite.Point.get_X()>t.lowerSite.Point.get_X()&&n==t.lowerSite);this.RightSite=t.upperSite==n?t.lowerSite:t.upperSite;this.LeftSite=n;this.Edge=t},X$$:"System.Double",get_X:function(){return this.LeftSite.Point.get_X()}}};JsTypes.push(Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtFrontElement);Microsoft$Msagl$Routing$CdtSite={fullname:"Microsoft.Msagl.Routing.CdtSite",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.Point=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Edges=null;this.InEdges=null;this._Owner=null;System.Object.ctor.call(this);this.Point=n},Owner$$:"System.Object",get_Owner:function(){return this._Owner},set_Owner:function(n){this._Owner=n},AddEdgeToSite:function(n){this.Edges==null&&(this.Edges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.CdtEdge.ctor));this.Edges.Add(n)},EdgeBetweenUpperSiteAndLowerSite:function(n){var t,i;if(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.Above$$CdtSite$$CdtSite(this,n)>0),this.Edges!=null)for(t=this.Edges.GetEnumerator();t.MoveNext();)if(i=t.get_Current(),i.lowerSite==n)return i;return null},AddInEdge:function(n){this.InEdges==null&&(this.InEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.CdtEdge.ctor));this.InEdges.Add(n)},Triangles$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle]]",get_Triangles:function(){var r=[],i,n,t;if(this.Edges!=null&&this.Edges.get_Count()>0)i=this.Edges.get_Item$$Int32(0);else if(this.InEdges!=null&&this.InEdges.get_Count()>0)i=this.InEdges.get_Item$$Int32(0);else return r;n=i;do{if(t=n.upperSite==this?n.get_CcwTriangle():n.get_CwTriangle(),t==null){n=null;break}r.push(t);n=t.Edges.get_Item$$Int32(t.Edges.Index(n)+2)}while(n!=i);if(n!=i){n=i;do{if(t=n.upperSite==this?n.get_CwTriangle():n.get_CcwTriangle(),t==null)break;r.push(t);n=t.Edges.get_Item$$Int32(t.Edges.Index(n)+1)}while(1)}return r}}};JsTypes.push(Microsoft$Msagl$Routing$CdtSite);Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtSweeper={fullname:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},FindPivot:function(n){var i=n,t=n;do t=t.Next,(t.Start.Point.get_X()<i.Start.Point.get_X()||t.Start.Point.get_X()==i.Start.Point.get_X()&&t.Start.Point.get_Y()<i.Start.Point.get_Y())&&(i=t);while(t!=n);return i},FindNextEdgeOnPerimeter:function(n){var t=n.get_CwTriangle()!=null?n.get_CwTriangle():n.get_CcwTriangle();for(n=t.Edges.get_Item$$Int32(t.Edges.Index(n)+2);n.get_CwTriangle()!=null&&n.get_CcwTriangle()!=null;)t=n.GetOtherTriangle$$CdtTriangle(t),n=t.Edges.get_Item$$Int32(t.Edges.Index(n)+2);return n},CreatePerimeterElementFromEdge:function(n){var t=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.PerimeterEdge.ctor(n);return n.get_CwTriangle()!=null?(t.Start=n.upperSite,t.End=n.lowerSite):(t.End=n.upperSite,t.Start=n.lowerSite),t},RemoveTriangleWithEdges:function(n,t){var r,i;for(n.Remove(t),r=t.Edges.GetEnumerator();r.MoveNext();)i=r.get_Current(),i.get_CwTriangle()==t?i.set_CwTriangle(null):i.set_CcwTriangle(null),i.get_CwTriangle()==null&&i.get_CcwTriangle()==null&&i.upperSite.Edges.Remove(i)},RemoveTriangleButLeaveEdges:function(n,t){var r,i;for(n.Remove(t),r=t.Edges.GetEnumerator();r.MoveNext();)i=r.get_Current(),i.get_CwTriangle()==t?i.set_CwTriangle(null):i.set_CcwTriangle(null)},EdgeIsProcessed:function(n){return n.get_CwTriangle()!=null||n.get_CcwTriangle()!=null},DropsSharpEnoughToTheLeft:function(n){var i=n.Edge,t;return n.RightSite!=i.upperSite?!1:(t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.lowerSite.Point,i.upperSite.Point),System.Diagnostics.Debug.Assert$$Boolean(t.get_X()<0&&t.get_Y()<=0),t.get_X()>=.5*t.get_Y())},DropsSharpEnoughToTheRight:function(n){var i=n.Edge,t;return n.LeftSite!=i.upperSite?!1:(t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.lowerSite.Point,i.upperSite.Point),System.Diagnostics.Debug.Assert$$Boolean(t.get_X()>0&&t.get_Y()<=0),t.get_X()<=-.5*t.get_Y())},FindNodeInFrontBySite:function(n,t){return n.FindLast$$Func$2(function(n){return n.LeftSite.Point.get_X()<=t.Point.get_X()})},IsIllegal:function(n,t,i,r){return Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.InCone(n,t,i,r)&&Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.InCircle(n,t,i,r)},InCircle:function(n,t,i,r){System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(t.Point,i.Point,r.Point)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise);var o=t.Point.get_X()-n.Point.get_X(),u=t.Point.get_Y()-n.Point.get_Y(),s=i.Point.get_X()-n.Point.get_X(),f=i.Point.get_Y()-n.Point.get_Y(),h=r.Point.get_X()-n.Point.get_X(),e=r.Point.get_Y()-n.Point.get_Y(),c=o*o+u*u,l=s*s+f*f,a=h*h+e*e;return o*(f*a-e*l)-s*(u*a-e*c)+h*(u*l-f*c)>Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()},InCone:function(n,t,i,r){return System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(t.Point,i.Point,r.Point)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise),Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(t.Point,n.Point,i.Point)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(i.Point,n.Point,r.Point)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise},Flip:function(n,t){var i,r,e,f;System.Diagnostics.Debug.Assert$$Boolean(!t.IsAdjacent(n));System.Diagnostics.Debug.Assert$$Boolean(t.get_CcwTriangle().Contains(n)||t.get_CwTriangle().Contains(n));t.get_CcwTriangle().Contains(n)?(i=t.get_CcwTriangle(),r=t.get_CwTriangle()):(i=t.get_CwTriangle(),r=t.get_CcwTriangle());System.Diagnostics.Debug.Assert$$Boolean(i.Contains(n));e=i.Edges.Index(t);f=r.Edges.Index(t);System.Diagnostics.Debug.Assert$$Boolean(e>-1&&f>-1);var h=r.Sites.get_Item$$Int32(f+2),o=i.Edges.get_Item$$Int32(e+1),s=r.Edges.get_Item$$Int32(f+1),u=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.GetOrCreateEdge(n,h);return i.Sites.set_Item$$Int32(e+1,h),i.Edges.set_Item$$Int32(e,s),i.Edges.set_Item$$Int32(e+1,u),r.Sites.set_Item$$Int32(f+1,n),r.Edges.set_Item$$Int32(f,o),r.Edges.set_Item$$Int32(f+1,u),s.lowerSite==h?s.set_CcwTriangle(i):s.set_CwTriangle(i),o.lowerSite==n?o.set_CcwTriangle(r):o.set_CwTriangle(r),u.upperSite==n?(u.set_CcwTriangle(r),u.set_CwTriangle(i)):(u.set_CcwTriangle(i),u.set_CwTriangle(r)),System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.CheckTriangle(i)),System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.CheckTriangle(i)),t.upperSite.Edges.Remove(t),u},CheckTriangle:function(n){var t;if(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(n.Sites.get_Item$$Int32(0).Point,n.Sites.get_Item$$Int32(1).Point,n.Sites.get_Item$$Int32(2).Point)!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise)return!1;for(t=0;t<3;t++){var i=n.Edges.get_Item$$Int32(t),r=n.Sites.get_Item$$Int32(t),u=n.Sites.get_Item$$Int32(t+1);if(!i.IsAdjacent(r)||!i.IsAdjacent(u))return!1;if(i.upperSite==r){if(i.get_CcwTriangle()!=n)return!1}else if(i.get_CwTriangle()!=n)return!1}return!0}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){if(this.front=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$Func$3(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtFrontElement.ctor,$CreateAnonymousDelegate(this,function(n,t){return n.get_X().CompareTo$$Double(t.get_X())})),this.triangles=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor),this.listOfSites=null,this.p_2=null,this.createEdgeDelegate=null,this.p_1=null,Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this),this.listOfSites=n,n.get_Count()!=0){var u=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor$$CdtSite$$CdtSite$$CdtSite$$Func$3$CdtSite$CdtSite$CdtEdge(t,i,n.get_Item$$Int32(0),r);this.get_Triangles().Insert(u);this.front.Insert(new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtFrontElement.ctor(t,u.Edges.get_Item$$Int32(2)));this.front.Insert(new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtFrontElement.ctor(n.get_Item$$Int32(0),u.Edges.get_Item$$Int32(1)));this.p_1=t;this.p_2=i;this.createEdgeDelegate=r}},Triangles$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle]]",get_Triangles:function(){return this.triangles},RunInternal:function(){if(this.listOfSites.get_Count()!=0){for(var n=1;n<this.listOfSites.get_Count();n++)this.ProcessSite(this.listOfSites.get_Item$$Int32(n));this.FinalizeTriangulation()}},FinalizeTriangulation:function(){var n=this.CreateDoubleLinkedListOfPerimeter();this.MakePerimeterConvex(n);this.RemoveP1AndP2Triangles()},MakePerimeterConvex:function(n){var r,t,u,i;n=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.FindPivot(n);r=n.Start;t=n;do if(u=t.Next,Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(t.Start.Point,t.End.Point,u.End.Point)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise)for(t=this.ShortcutTwoListElements(t);t.Start!=r;)if(i=t.Prev,Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(i.Start.Point,i.End.Point,t.End.Point)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise)t=this.ShortcutTwoListElements(i);else break;else t=u;while(t.End!=r)},CreateDoubleLinkedListOfPerimeter:function(){var u=System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtFrontElement.ctor,this.front).Edge,t=u,n,i=null,r=null;do n=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.CreatePerimeterElementFromEdge(t),t=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.FindNextEdgeOnPerimeter(t),i!=null?(n.Prev=i,i.Next=n):r=n,i=n;while(t!=u);return r.Prev=n,n.Next=r,r},RemoveP1AndP2Triangles:function(){for(var i=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor),r=this.triangles.GetEnumerator(),t,n;r.MoveNext();)n=r.get_Current(),(n.Sites.Contains(this.p_1)||n.Sites.Contains(this.p_2))&&i.Insert(n);for(t=i.GetEnumerator();t.MoveNext();)n=t.get_Current(),Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.RemoveTriangleWithEdges(this.triangles,n)},ProcessSite:function(n){var t,i;for(this.PointEvent(n),t=0;t<n.Edges.get_Count();t++)i=n.Edges.get_Item$$Int32(t),i.Constrained&&this.EdgeEvent(i)},EdgeEvent:function(n){if(System.Diagnostics.Debug.Assert$$Boolean(n.Constrained),!Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.EdgeIsProcessed(n)){var t=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.EdgeInserter.ctor(n,this.get_Triangles(),this.front,this.createEdgeDelegate);t.Run()}},PointEvent:function(n){var t,i,u,r;(function(){var i={Value:t},r=this.ProjectToFront(n,i);return t=i.Value,r}).call(this);u=t.Item.get_X()+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<n.Point.get_X()?function(){var r={Value:i},u=this.MiddleCase(n,t,r);return i=r.Value,u}.call(this):function(){var r={Value:i},u=this.LeftCase(n,t,r);return i=r.Value,u}.call(this);r=this.InsertSiteIntoFront(u,n,i);this.TriangulateEmptySpaceToTheRight(r);r=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.FindNodeInFrontBySite(this.front,u);this.TriangulateEmptySpaceToTheLeft(r)},LeftCase:function(n,t,i){var u,r,f,e;return System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.Point.get_X(),t.Item.get_X())),u=t.Item,this.InsertAndLegalizeTriangle(n,u),r=this.front.Previous(t),f=r.Item.LeftSite,i.Value=t.Item.RightSite,this.InsertAndLegalizeTriangle(n,r.Item),this.front.DeleteNodeInternal(r),e=this.front.Remove(u),System.Diagnostics.Debug.Assert$$Boolean(e!=null),f},MiddleCase:function(n,t,i){var r=t.Item.LeftSite;return i.Value=t.Item.RightSite,this.InsertAndLegalizeTriangle(n,t.Item),this.front.DeleteNodeInternal(t),r},TriangulateEmptySpaceToTheLeft:function(n){for(var u=n.Item.RightSite,t=this.front.Previous(n);t!=null;){var i=t.Item,f=i.LeftSite,r=i.RightSite;if(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r.Point,u.Point),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.Point,r.Point))<0)n=this.ShortcutTwoFrontElements(t,n),t=this.front.Previous(n);else{this.TryTriangulateBasinToTheLeft(n);break}}},ShortcutTwoListElements:function(n){var t=n.Next,r,i,u;return System.Diagnostics.Debug.Assert$$Boolean(n.End==t.Start),r=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor$$CdtSite$$CdtSite$$CdtSite$$CdtEdge$$CdtEdge$$Func$3$CdtSite$CdtSite$CdtEdge(n.Start,n.End,t.End,n.Edge,t.Edge,this.createEdgeDelegate),this.get_Triangles().Insert(r),i=r.Edges.get_Item$$Int32(2),System.Diagnostics.Debug.Assert$$Boolean(i.IsAdjacent(n.Start)&&i.IsAdjacent(t.End)),this.LegalizeEdge(n.Start,r.OppositeEdge(n.Start)),r=i.get_CcwTriangle()!=null?i.get_CcwTriangle():i.get_CwTriangle(),this.LegalizeEdge(t.End,r.OppositeEdge(t.End)),u=function(){var r=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.PerimeterEdge.ctor(i);return r.Start=n.Start,r.End=t.End,r}.call(this),n.Prev.Next=u,u.Prev=n.Prev,u.Next=t.Next,t.Next.Prev=u,u},ShortcutTwoFrontElements:function(n,t){var i=n.Item,r=t.Item,f,u;return System.Diagnostics.Debug.Assert$$Boolean(i.RightSite==r.LeftSite),f=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor$$CdtSite$$CdtSite$$CdtSite$$CdtEdge$$CdtEdge$$Func$3$CdtSite$CdtSite$CdtEdge(i.LeftSite,i.RightSite,r.RightSite,i.Edge,r.Edge,this.createEdgeDelegate),this.get_Triangles().Insert(f),this.front.DeleteNodeInternal(n),this.front.Remove(r),u=f.Edges.get_Item$$Int32(2),System.Diagnostics.Debug.Assert$$Boolean(u.IsAdjacent(i.LeftSite)&&u.IsAdjacent(r.RightSite)),this.LegalizeEdge(i.LeftSite,f.OppositeEdge(i.LeftSite)),f=u.get_CcwTriangle()!=null?u.get_CcwTriangle():u.get_CwTriangle(),this.LegalizeEdge(r.RightSite,f.OppositeEdge(r.RightSite)),this.front.Insert(new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtFrontElement.ctor(i.LeftSite,u))},TryTriangulateBasinToTheLeft:function(n){var i,r,t;if(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.DropsSharpEnoughToTheLeft(n.Item))for(i=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Routing.CdtSite.ctor),i.Push(n.Item.LeftSite);;){if(r=i.Pop(),n=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.FindNodeInFrontBySite(this.front,r),t=this.front.Previous(n),t==null)return;if(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(t.Item.LeftSite.Point,n.Item.LeftSite.Point,n.Item.RightSite.Point)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise)i.Push(t.Item.LeftSite),this.ShortcutTwoFrontElements(t,n);else if(n.Item.LeftSite.Point.get_Y()>n.Item.RightSite.Point.get_Y())i.Push(t.Item.LeftSite);else{if(t.Item.LeftSite.Point.get_Y()<=t.Item.RightSite.Point.get_Y())return;i.Push(t.Item.LeftSite)}}},InsertSiteIntoFront:function(n,t,i){for(var r=null,u=null,e=t.Edges.GetEnumerator(),f;e.MoveNext();)if(f=e.get_Current(),r==null&&f.lowerSite==n&&(r=f),u==null&&f.lowerSite==i&&(u=f),r!=null&&u!=null)break;return System.Diagnostics.Debug.Assert$$Boolean(r!=null&&u!=null),this.front.Insert(new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtFrontElement.ctor(n,r)),this.front.Insert(new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtFrontElement.ctor(t,u))},TriangulateEmptySpaceToTheRight:function(n){for(var u=n.Item.LeftSite,f=u.Point,t=this.front.Next(n);t!=null;){var i=t.Item,r=i.LeftSite,e=i.RightSite;if(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r.Point,f),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e.Point,r.Point))<0)n=this.ShortcutTwoFrontElements(n,t),t=this.front.Next(n);else{this.TryTriangulateBasinToTheRight(n);break}}},TryTriangulateBasinToTheRight:function(n){var t,r,i;if(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.DropsSharpEnoughToTheRight(n.Item))for(t=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Routing.CdtSite.ctor),t.Push(n.Item.LeftSite);;){if(r=t.Pop(),n=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.FindNodeInFrontBySite(this.front,r),i=this.front.Next(n),i==null)return;if(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(n.Item.LeftSite.Point,n.Item.RightSite.Point,i.Item.RightSite.Point)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise)this.ShortcutTwoFrontElements(n,i),t.Push(r);else if(n.Item.LeftSite.Point.get_Y()>n.Item.RightSite.Point.get_Y())t.Push(n.Item.RightSite);else{if(i.Item.LeftSite.Point.get_Y()>=i.Item.RightSite.Point.get_Y())return;t.Push(n.Item.RightSite)}}},InsertAndLegalizeTriangle:function(n,t){var u,i,r,f,e;Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(n.Point,t.LeftSite.Point,t.RightSite.Point)!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear?(u=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor$$CdtSite$$CdtEdge$$Func$3$CdtSite$CdtSite$CdtEdge(n,t.Edge,this.createEdgeDelegate),this.get_Triangles().Insert(u),this.LegalizeEdge(n,u.Edges.get_Item$$Int32(0))):(i=t.Edge,i.upperSite.Edges.Remove(i),r=i.get_CcwTriangle()!=null?i.get_CcwTriangle():i.get_CwTriangle(),f=r.OppositeSite(i),Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.RemoveTriangleButLeaveEdges(this.triangles,r),r=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor$$CdtSite$$CdtSite$$CdtSite$$Func$3$CdtSite$CdtSite$CdtEdge(t.LeftSite,f,n,this.createEdgeDelegate),e=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor$$CdtSite$$CdtSite$$CdtSite$$Func$3$CdtSite$CdtSite$CdtEdge(t.RightSite,f,n,this.createEdgeDelegate),this.triangles.Insert(r),this.triangles.Insert(e),this.LegalizeEdge(n,r.OppositeEdge(n)),this.LegalizeEdge(n,e.OppositeEdge(n)))},LegalizeEdge:function(n,t){(System.Diagnostics.Debug.Assert$$Boolean(n!=t.upperSite&&n!=t.lowerSite),t.Constrained||t.get_CcwTriangle()==null||t.get_CwTriangle()==null)||(t.get_CcwTriangle().Contains(n)?this.LegalizeEdgeForOtherCwTriangle(n,t):this.LegalizeEdgeForOtherCcwTriangle(n,t))},LegalizeEdgeForOtherCcwTriangle:function(n,t){var r=t.get_CcwTriangle().Edges.Index(t),i;Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.IsIllegal(n,t.lowerSite,t.get_CcwTriangle().Sites.get_Item$$Int32(r+2),t.upperSite)&&(i=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.Flip(n,t),this.LegalizeEdge(n,i.get_CwTriangle().OppositeEdge(n)),this.LegalizeEdge(n,i.get_CcwTriangle().OppositeEdge(n)))},LegalizeEdgeForOtherCwTriangle:function(n,t){var r=t.get_CwTriangle().Edges.Index(t),i;System.Diagnostics.Debug.Assert$$Boolean(r>=0);Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.IsIllegal(n,t.upperSite,t.get_CwTriangle().Sites.get_Item$$Int32(r+2),t.lowerSite)&&(i=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.Flip(n,t),this.LegalizeEdge(n,i.get_CwTriangle().OppositeEdge(n)),this.LegalizeEdge(n,i.get_CcwTriangle().OppositeEdge(n)))},ProjectToFront:function(n,t){t.Value=this.front.FindLast$$Func$2($CreateAnonymousDelegate(this,function(t){return t.get_X()<=n.Point.get_X()}))}}};JsTypes.push(Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtSweeper);Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$Cdt={fullname:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},GetOrCreateEdge:function(n,t){var i;return Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.Above$$Point$$Point(n.Point,t.Point)==1?(i=n.EdgeBetweenUpperSiteAndLowerSite(t),i!=null)?i:Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.CreateEdgeOnOrderedCouple(n,t):(i=t.EdgeBetweenUpperSiteAndLowerSite(n),i!=null)?i:Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.CreateEdgeOnOrderedCouple(t,n)},CreateEdgeOnOrderedCouple:function(n,t){return System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.Above$$Point$$Point(n.Point,t.Point)==1),new Microsoft.Msagl.Routing.CdtEdge.ctor(n,t)},OnComparison:function(n,t){return Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.Above$$Point$$Point(n.Point,t.Point)},Above$$Point$$Point:function(n,t){var i=n.get_Y()-t.get_Y();return i>0?1:i<0?-1:(i=n.get_X()-t.get_X(),i>0?-1:i<0?1:0)},Above$$CdtSite$$CdtSite:function(n,t){var i=n.Point.get_Y()-t.Point.get_Y();return i>0?1:i<0?-1:(i=n.Point.get_X()-t.Point.get_X(),i>0?-1:i<0?1:0)},PointIsInsideOfTriangle:function(n,t){for(var r,u,i=0;i<3;i++)if(r=t.Sites.get_Item$$Int32(i).Point,u=t.Sites.get_Item$$Int32(i+1).Point,Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,r,u)<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return!1;return!0}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$IEnumerable$1$Point$$IEnumerable$1$Polyline$$List$1:function(n,t,i){this.isolatedSitesWithObject=null;this.isolatedSites=null;this.obstacles=null;this.isolatedSegments=null;this.P1=null;this.P2=null;this.sweeper=null;this.PointsToSites=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.CdtSite.ctor);this.allInputSites=null;this.cdtTree=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.isolatedSites=n;this.obstacles=t;this.isolatedSegments=i},ctor$$IEnumerable$1:function(n){this.isolatedSitesWithObject=null;this.isolatedSites=null;this.obstacles=null;this.isolatedSegments=null;this.P1=null;this.P2=null;this.sweeper=null;this.PointsToSites=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.CdtSite.ctor);this.allInputSites=null;this.cdtTree=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.isolatedSitesWithObject=n},FillAllInputSites:function(){var n,t,i,e,r,o,u,f;if(this.isolatedSitesWithObject!=null)for(n=this.isolatedSitesWithObject.GetEnumerator();n.MoveNext();)t=n.get_Current(),this.AddSite(t.get_Item1(),t.get_Item2());if(this.isolatedSites!=null)for(i=this.isolatedSites.GetEnumerator();i.MoveNext();)e=i.get_Current(),this.AddSite(e,null);if(this.obstacles!=null)for(r=this.obstacles.GetEnumerator();r.MoveNext();)o=r.get_Current(),this.AddPolylineToAllInputSites(o);if(this.isolatedSegments!=null)for(u=this.isolatedSegments.GetEnumerator();u.MoveNext();)f=u.get_Current(),this.AddConstrainedEdge(f.get_A(),f.get_B(),null);this.AddP1AndP2();this.allInputSites=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.CdtSite.ctor,this.PointsToSites.get_Values())},AddSite:function(n,t){var i;return function(){var t={Value:i},r=this.PointsToSites.TryGetValue(n,t);return i=t.Value,r}.call(this)?(i.set_Owner(t),i):(this.PointsToSites.set_Item$$TKey(n,i=function(){var i=new Microsoft.Msagl.Routing.CdtSite.ctor(n);return i.set_Owner(t),i}.call(this)),i)},AddP1AndP2:function(){for(var n=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox(),r=this.PointsToSites.get_Keys().GetEnumerator(),u,t,i;r.MoveNext();)u=r.get_Current(),n.Add$$Point(u);t=n.get_Width()/3;i=n.get_Height()/3;this.P1=new Microsoft.Msagl.Routing.CdtSite.ctor(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_LeftBottom(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-t,-i)));this.P2=new Microsoft.Msagl.Routing.CdtSite.ctor(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_RightBottom(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,-i)))},AddPolylineToAllInputSites:function(n){for(var t=n.get_StartPoint();t.get_Next()!=null;t=t.get_Next())this.AddConstrainedEdge(t.get_Point(),t.get_Next().get_Point(),n);n.get_Closed()&&this.AddConstrainedEdge(n.get_EndPoint().get_Point(),n.get_StartPoint().get_Point(),n)},AddConstrainedEdge:function(n,t,i){var r=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.Above$$Point$$Point(n,t),u,f,e;System.Diagnostics.Debug.Assert$$Boolean(r!=0);r>0?(u=this.AddSite(n,i),f=this.AddSite(t,i)):(System.Diagnostics.Debug.Assert$$Boolean(r<0),u=this.AddSite(t,i),f=this.AddSite(n,i));e=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.CreateEdgeOnOrderedCouple(u,f);e.Constrained=!0},GetTriangles:function(){return this.sweeper.get_Triangles()},RunInternal:function(){this.Initialization();this.SweepAndFinalize()},SweepAndFinalize:function(){this.sweeper=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.ctor(this.allInputSites,this.P1,this.P2,Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.GetOrCreateEdge);this.sweeper.Run()},Initialization:function(){this.FillAllInputSites();this.allInputSites.Sort$$Comparison$1(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.OnComparison)},RestoreEdgeCapacities:function(){for(var i=this.allInputSites.GetEnumerator(),r,t,n;i.MoveNext();)for(r=i.get_Current(),t=r.Edges.GetEnumerator();t.MoveNext();)n=t.get_Current(),n.Constrained||n.set_ResidualCapacity(n.Capacity)},SetInEdges:function(){for(var f=this.PointsToSites.get_Values().GetEnumerator(),t,i,n,r,u;f.MoveNext();)for(t=f.get_Current(),i=t.Edges,n=i.get_Count()-1;n>=0;n--)r=i.get_Item$$Int32(n),u=r.lowerSite,System.Diagnostics.Debug.Assert$$Boolean(u!=t),u.AddInEdge(r)},FindSite:function(n){return this.PointsToSites.get_Item$$TKey(n)},GetCdtTree:function(){return this.cdtTree==null&&(this.cdtTree=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,this.GetTriangles(),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor,n,n.BoundingBox())})))),this.cdtTree}}};JsTypes.push(Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$Cdt);Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtTriangle={fullname:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$CdtSite$$CdtSite$$CdtSite$$Func$3$CdtSite$CdtSite$CdtEdge:function(n,t,i,r){this.Edges=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.ThreeArray$1.ctor(Microsoft.Msagl.Routing.CdtEdge.ctor);this.Sites=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.ThreeArray$1.ctor(Microsoft.Msagl.Routing.CdtSite.ctor);System.Object.ctor.call(this);var u=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(n.Point,t.Point,i.Point);switch(u){case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise:this.FillCcwTriangle(n,t,i,r);break;case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise:this.FillCcwTriangle(n,i,t,r);break;default:throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},ctor$$CdtSite$$CdtEdge$$Func$3$CdtSite$CdtSite$CdtEdge:function(n,t,i){this.Edges=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.ThreeArray$1.ctor(Microsoft.Msagl.Routing.CdtEdge.ctor);this.Sites=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.ThreeArray$1.ctor(Microsoft.Msagl.Routing.CdtSite.ctor);System.Object.ctor.call(this);switch(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientationWithNoEpsilon(t.upperSite.Point,t.lowerSite.Point,n.Point)){case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise:t.set_CcwTriangle(this);this.Sites.set_Item$$Int32(0,t.upperSite);this.Sites.set_Item$$Int32(1,t.lowerSite);break;case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise:t.set_CwTriangle(this);this.Sites.set_Item$$Int32(0,t.lowerSite);this.Sites.set_Item$$Int32(1,t.upperSite);break;default:throw $CreateException(new System.InvalidOperationException.ctor,new Error);}this.Edges.set_Item$$Int32(0,t);this.Sites.set_Item$$Int32(2,n);this.CreateEdge(1,i);this.CreateEdge(2,i)},ctor$$CdtSite$$CdtSite$$CdtSite$$CdtEdge$$CdtEdge$$Func$3$CdtSite$CdtSite$CdtEdge:function(n,t,i,r,u,f){this.Edges=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.ThreeArray$1.ctor(Microsoft.Msagl.Routing.CdtEdge.ctor);this.Sites=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.ThreeArray$1.ctor(Microsoft.Msagl.Routing.CdtSite.ctor);System.Object.ctor.call(this);this.Sites.set_Item$$Int32(0,n);this.Sites.set_Item$$Int32(1,t);this.Sites.set_Item$$Int32(2,i);this.Edges.set_Item$$Int32(0,r);this.Edges.set_Item$$Int32(1,u);this.BindEdgeToTriangle(n,r);this.BindEdgeToTriangle(t,u);this.CreateEdge(2,f)},BindEdgeToTriangle:function(n,t){n==t.upperSite?t.set_CcwTriangle(this):t.set_CwTriangle(this)},FillCcwTriangle:function(n,t,i,r){this.Sites.set_Item$$Int32(0,n);this.Sites.set_Item$$Int32(1,t);this.Sites.set_Item$$Int32(2,i);for(var u=0;u<3;u++)this.CreateEdge(u,r)},CreateEdge:function(n,t){var i=this.Sites.get_Item$$Int32(n),r=this.Sites.get_Item$$Int32(n+1),u=function(t){return this.Edges.set_Item$$Int32(n,t),t}.call(this,t(i,r));this.BindEdgeToTriangle(i,u)},Contains:function(n){return this.Sites.Contains(n)},OppositeEdge:function(n){var t=this.Sites.Index(n);return System.Diagnostics.Debug.Assert$$Boolean(t!=-1),this.Edges.get_Item$$Int32(t+1)},OppositeSite:function(n){var t=this.Edges.Index(n);return this.Sites.get_Item$$Int32(t+2)},BoundingBox:function(){var n=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(this.Sites.get_Item$$Int32(0).Point,this.Sites.get_Item$$Int32(1).Point);return n.Add$$Point(this.Sites.get_Item$$Int32(2).Point),n}}};JsTypes.push(Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$CdtTriangle);Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$EdgeInserter={fullname:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.EdgeInserter",baseTypeName:"System.Object",staticDefinition:{LocalInCircle:function(n,t,i,r,u){return u?Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.InCircle(n,t,r,i):Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.InCircle(n,t,i,r)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.edge=null;this.triangles=null;this.front=null;this.createEdgeDelegate=null;this.rightPolygon=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.CdtSite.ctor);this.leftPolygon=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.CdtSite.ctor);this.addedTriangles=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor);System.Object.ctor.call(this);this.edge=n;this.triangles=t;this.front=i;this.createEdgeDelegate=r},Run:function(){this.TraceEdgeThroughTriangles();this.TriangulatePolygon$$List$1$CdtSite$$CdtSite$$CdtSite$$Boolean(this.rightPolygon,this.edge.upperSite,this.edge.lowerSite,!0);this.TriangulatePolygon$$List$1$CdtSite$$CdtSite$$CdtSite$$Boolean(this.leftPolygon,this.edge.upperSite,this.edge.lowerSite,!1);this.UpdateFront()},UpdateFront:function(){for(var r=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.CdtEdge.ctor),u=this.addedTriangles.GetEnumerator(),f,t,i,n;u.MoveNext();)for(f=u.get_Current(),t=f.Edges.GetEnumerator();t.MoveNext();)n=t.get_Current(),(n.get_CwTriangle()==null||n.get_CcwTriangle()==null)&&r.Insert(n);for(i=r.GetEnumerator();i.MoveNext();)n=i.get_Current(),this.AddEdgeToFront(n)},AddEdgeToFront:function(n){var t=n.upperSite.Point.get_X()<n.lowerSite.Point.get_X()?n.upperSite:n.lowerSite;this.front.Insert(new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtFrontElement.ctor(t,n))},TriangulatePolygon$$List$1$CdtSite$$CdtSite$$CdtSite$$Boolean:function(n,t,i,r){n.get_Count()>0&&this.TriangulatePolygon$$Int32$$Int32$$List$1$CdtSite$$CdtSite$$CdtSite$$Boolean(0,n.get_Count()-1,n,t,i,r)},TriangulatePolygon$$Int32$$Int32$$List$1$CdtSite$$CdtSite$$CdtSite$$Boolean:function(n,t,i,r,u,f){for(var h,c,e=i.get_Item$$Int32(n),o=n,s=n+1;s<=t;s++)h=i.get_Item$$Int32(s),Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.EdgeInserter.LocalInCircle(h,r,u,e,f)&&(o=s,e=h);c=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor$$CdtSite$$CdtSite$$CdtSite$$Func$3$CdtSite$CdtSite$CdtEdge(r,u,e,this.createEdgeDelegate);this.triangles.Insert(c);this.addedTriangles.Add(c);n<o&&this.TriangulatePolygon$$Int32$$Int32$$List$1$CdtSite$$CdtSite$$CdtSite$$Boolean(n,o-1,i,r,e,f);o<t&&this.TriangulatePolygon$$Int32$$Int32$$List$1$CdtSite$$CdtSite$$CdtSite$$Boolean(o+1,t,i,e,u,f)},TraceEdgeThroughTriangles:function(){var n=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.EdgeTracer.ctor(this.edge,this.triangles,this.front,this.leftPolygon,this.rightPolygon);n.Run()}}};JsTypes.push(Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$EdgeInserter);Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$EdgeTracer={fullname:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.EdgeTracer",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this.edge=null;this.triangles=null;this.front=null;this.leftPolygon=null;this.rightPolygon=null;this.a=null;this.b=null;this.piercedEdge=null;this.piercedTriangle=null;this.piercedToTheLeftFrontElemNode=null;this.piercedToTheRightFrontElemNode=null;this.elementsToBeRemovedFromFront=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtFrontElement.ctor);this.removedTriangles=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor);System.Object.ctor.call(this);this.edge=n;this.triangles=t;this.front=i;this.leftPolygon=r;this.rightPolygon=u;this.a=n.upperSite;this.b=n.lowerSite},Run:function(){this.Init();this.Traverse()},Traverse:function(){for(var n,t;!this.BIsReached();)this.piercedToTheLeftFrontElemNode!=null?this.ProcessLeftFrontPiercedElement():this.piercedToTheRightFrontElemNode!=null?this.ProcessRightFrontPiercedElement():this.ProcessPiercedEdge();for(this.piercedTriangle!=null&&this.RemovePiercedTriangle(this.piercedTriangle),this.FindMoreRemovedFromFrontElements(),n=this.elementsToBeRemovedFromFront.GetEnumerator();n.MoveNext();)t=n.get_Current(),this.front.Remove(t)},ProcessLeftFrontPiercedElement:function(){var n=this.piercedToTheLeftFrontElemNode;do this.elementsToBeRemovedFromFront.Add(n.Item),this.AddSiteToLeftPolygon(n.Item.LeftSite),n=this.front.Previous(n);while(Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLine(n.Item.LeftSite.Point,this.a.Point,this.b.Point));if(this.elementsToBeRemovedFromFront.Add(n.Item),this.AddSiteToRightPolygon(n.Item.LeftSite),n.Item.LeftSite==this.b){this.piercedToTheLeftFrontElemNode=n;return}this.FindPiercedTriangle(n);this.piercedToTheLeftFrontElemNode=null},FindPiercedTriangle:function(n){for(var t=n.Item.Edge,i=t.get_CcwTriangle()!=null?t.get_CcwTriangle():t.get_CwTriangle(),f=i.Edges.Index(t),r=1;r<=2;r++){var u=i.Edges.get_Item$$Int32(r+f),e=Microsoft.Msagl.Core.Geometry.ApproximateComparer.Sign(Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(u.lowerSite.Point,this.a.Point,this.b.Point)),o=Microsoft.Msagl.Core.Geometry.ApproximateComparer.Sign(Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(u.upperSite.Point,this.a.Point,this.b.Point));if(o*e<=0){this.piercedTriangle=i;this.piercedEdge=u;break}}},FindMoreRemovedFromFrontElements:function(){for(var r=this.removedTriangles.GetEnumerator(),u,t,n,f,i;r.MoveNext();)for(u=r.get_Current(),t=u.Edges.GetEnumerator();t.MoveNext();)n=t.get_Current(),n.get_CcwTriangle()==null&&n.get_CwTriangle()==null&&(f=n.upperSite.Point.get_X()<n.lowerSite.Point.get_X()?n.upperSite:n.lowerSite,i=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.FindNodeInFrontBySite(this.front,f),i.Item.Edge==n&&this.elementsToBeRemovedFromFront.Add(i.Item))},ProcessPiercedEdge:function(){this.piercedEdge.get_CcwTriangle()==this.piercedTriangle?(this.AddSiteToLeftPolygon(this.piercedEdge.lowerSite),this.AddSiteToRightPolygon(this.piercedEdge.upperSite)):(this.AddSiteToLeftPolygon(this.piercedEdge.upperSite),this.AddSiteToRightPolygon(this.piercedEdge.lowerSite));this.RemovePiercedTriangle(this.piercedTriangle);this.PrepareNextStateAfterPiercedEdge()},PrepareNextStateAfterPiercedEdge:function(){for(var u,t,i=this.piercedEdge.get_CwTriangle()!=null?this.piercedEdge.get_CwTriangle():this.piercedEdge.get_CcwTriangle(),f=i.Edges.Index(this.piercedEdge),r=1;r<=2;r++){var n=i.Edges.get_Item$$Int32(r+f),e=Microsoft.Msagl.Core.Geometry.ApproximateComparer.Sign(Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n.lowerSite.Point,this.a.Point,this.b.Point)),o=Microsoft.Msagl.Core.Geometry.ApproximateComparer.Sign(Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n.upperSite.Point,this.a.Point,this.b.Point));if(o*e<=0){if(n.get_CwTriangle()!=null&&n.get_CcwTriangle()!=null){this.piercedTriangle=i;this.piercedEdge=n;break}this.piercedTriangle=null;this.piercedEdge=null;u=n.upperSite.Point.get_X()<n.lowerSite.Point.get_X()?n.upperSite:n.lowerSite;t=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.FindNodeInFrontBySite(this.front,u);System.Diagnostics.Debug.Assert$$Boolean(t!=null);u.Point.get_X()<this.a.Point.get_X()?this.piercedToTheLeftFrontElemNode=t:this.piercedToTheRightFrontElemNode=t;this.RemovePiercedTriangle(n.get_CwTriangle()!=null?n.get_CwTriangle():n.get_CcwTriangle());break}}},RemovePiercedTriangle:function(n){var i,t;for(this.triangles.Remove(n),i=n.Edges.GetEnumerator();i.MoveNext();)t=i.get_Current(),t.get_CwTriangle()==n?t.set_CwTriangle(null):t.set_CcwTriangle(null);this.removedTriangles.Add(n)},ProcessRightFrontPiercedElement:function(){var n=this.piercedToTheRightFrontElemNode;do this.elementsToBeRemovedFromFront.Add(n.Item),this.AddSiteToRightPolygon(n.Item.RightSite),n=this.front.Next(n);while(Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLine(n.Item.RightSite.Point,this.a.Point,this.b.Point));if(this.elementsToBeRemovedFromFront.Add(n.Item),this.AddSiteToLeftPolygon(n.Item.RightSite),n.Item.RightSite==this.b){this.piercedToTheRightFrontElemNode=n;return}this.FindPiercedTriangle(n);this.piercedToTheRightFrontElemNode=null},AddSiteToLeftPolygon:function(n){this.AddSiteToPolygonWithCheck(n,this.leftPolygon)},AddSiteToPolygonWithCheck:function(n,t){n!=this.b&&(t.get_Count()==0||t.get_Item$$Int32(t.get_Count()-1)!=n)&&t.Add(n)},AddSiteToRightPolygon:function(n){this.AddSiteToPolygonWithCheck(n,this.rightPolygon)},BIsReached:function(){var n=this.piercedToTheLeftFrontElemNode!=null?this.piercedToTheLeftFrontElemNode:this.piercedToTheRightFrontElemNode;return n!=null?n.Item.Edge.IsAdjacent(this.b):this.piercedEdge.IsAdjacent(this.b)},Init:function(){var i=Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtSweeper.FindNodeInFrontBySite(this.front,this.a),r=this.front.Previous(i),u,n,t,f,e;if(Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLine(this.b.Point,r.Item.LeftSite.Point,r.Item.RightSite.Point))this.piercedToTheLeftFrontElemNode=r;else if(Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLine(this.b.Point,i.Item.RightSite.Point,i.Item.LeftSite.Point))this.piercedToTheRightFrontElemNode=i;else for(u=this.a.Edges.GetEnumerator();u.MoveNext();)if((n=u.get_Current(),t=n.get_CcwTriangle(),t!=null)&&!Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLine(this.b.Point,n.lowerSite.Point,n.upperSite.Point)&&(f=t.Edges.Index(n),e=t.Sites.get_Item$$Int32(f+2),Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(this.b.Point,e.Point,n.upperSite.Point))){this.piercedEdge=t.Edges.get_Item$$Int32(f+1);this.piercedTriangle=t;break}}}};JsTypes.push(Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$EdgeTracer);Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$PerimeterEdge={fullname:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.PerimeterEdge",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.Start=null;this.End=null;this.Prev=null;this.Next=null;this.Edge=null;System.Object.ctor.call(this);System.Diagnostics.Debug.Assert$$Boolean(n.get_CcwTriangle()==null||n.get_CwTriangle()==null);this.Edge=n}}};JsTypes.push(Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$PerimeterEdge);Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$ThreeArray$1={fullname:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.ThreeArray$1",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor$$T$$T$$T:function(n,t,i,r){this.T=n;this.item0=null;this.item1=null;this.item2=null;System.Object.ctor.call(this);this.item0=t;this.item1=i;this.item2=r},Contains:function(n){return n.Equals$$Object(this.item0)||n.Equals$$Object(this.item1)||n.Equals$$Object(this.item2)},Index:function(n){return n.Equals$$Object(this.item0)?0:n.Equals$$Object(this.item1)?1:n.Equals$$Object(this.item2)?2:-1},ctor:function(n){this.T=n;this.item0=null;this.item1=null;this.item2=null;System.Object.ctor.call(this)},Item$$:"`0",get_Item$$Int32:function(n){switch(n){case 0:case 3:case-3:return this.item0;case 1:case 4:case-2:return this.item1;case 2:case 5:case-1:return this.item2;default:throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},set_Item$$Int32:function(n,t){switch(n){case 0:case 3:case-3:this.item0=t;break;case 1:case 4:case-2:this.item1=t;break;case 2:case 5:case-1:this.item2=t;break;default:throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},GetEnumerator:function(){var n=[];return n.push(this.item0),n.push(this.item1),n.push(this.item2),n.GetEnumerator()}}};JsTypes.push(Microsoft$Msagl$Routing$ConstrainedDelaunayTriangulation$ThreeArray$1);Microsoft$Msagl$Routing$Corner={fullname:"Microsoft.Msagl.Routing.Corner",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this._hashKey=null;this.a=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.b=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.c=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.a=n;this.b=t;this.c=i;this.UpdateHashKey()},Equals$$Corner:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.b,n.b)&&(Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.a,n.a)&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.c,n.c)||Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.a,n.c)&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.c,n.a))},GetHashCode:function(){return this.b.GetHashCode()^(this.a.GetHashCode()^this.c.GetHashCode())*397},UpdateHashKey:function(){this._hashKey=this.GetHashCode().toString()},Equals$$Object:function(n){if(System.Object.ReferenceEquals(null,n))return!1;if(System.Object.ReferenceEquals(this,n))return!0;var t=As(n,Microsoft.Msagl.Routing.Corner.ctor);return System.Object.ReferenceEquals(t,null)?!1:this.Equals$$Corner(t)}}};JsTypes.push(Microsoft$Msagl$Routing$Corner);Microsoft$Msagl$Routing$MultiEdgeRouter={fullname:"Microsoft.Msagl.Routing.MultiEdgeRouter",baseTypeName:"System.Object",staticDefinition:{GetIntersectionGraphOfPreGraphs:function(n){var t=Microsoft.Msagl.Routing.MultiEdgeRouter.EnumeratePairsOfIntersectedPreGraphs(n);return System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,t)?new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,t,n.get_Count()):null},EnumeratePairsOfIntersectedPreGraphs:function(n){var t=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnData(System.Linq.Enumerable.Range(0,n.get_Count()),function(t){return n.get_Item$$Int32(t).boundingBox}),i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor);return Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(System.Int32.ctor,t,t,function(n,t){i.Add(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n,t))}),i}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this.multiEdgeGeometries=null;this.interactiveEdgeRouter=null;this.bundlingSettings=null;this.transparentShapeSetter=null;this.nodeTree=null;System.Object.ctor.call(this);this.multiEdgeGeometries=System.Linq.Enumerable.ToList$1(Array,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Array,Array,n,$CreateAnonymousDelegate(this,function(n){return System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,n,$CreateAnonymousDelegate(this,function(n){return n.get_EdgeGeometry()})))})));this.interactiveEdgeRouter=t;this.bundlingSettings=r;this.transparentShapeSetter=u;this.nodeTree=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnData(i,$CreateAnonymousDelegate(this,function(n){return n.get_BoundingBox()}))},Run:function(){for(var n=this.GetGeometryGraphs().GetEnumerator(),t,i;n.MoveNext();)t=n.get_Current(),i=new Microsoft.Msagl.Routing.Spline.Bundling.BundleRouter.ctor(t,new Microsoft.Msagl.Routing.Spline.Bundling.SdShortestPath.ctor(this.transparentShapeSetter,null,null),this.interactiveEdgeRouter.get_VisibilityGraph(),this.bundlingSettings,this.interactiveEdgeRouter.get_LoosePadding(),this.interactiveEdgeRouter.get_TightHierarchy(),this.interactiveEdgeRouter.get_LooseHierarchy(),null,null,null),i.Run()},GetGeometryGraphs:function(){for(var n=[],t=this.GetIndependantPreGraphs().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.push(this.CreateGeometryGraph(i));return n},CreateGeometryGraph:function(n){for(var t=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,f=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,Microsoft.Msagl.Core.Layout.Node.ctor),e=n.nodeBoundaries.GetEnumerator(),i,r,u,o;e.MoveNext();)i=e.get_Current(),r=new Microsoft.Msagl.Core.Layout.Node.ctor$$ICurve(i),f.set_Item$$TKey(i,r),t.get_Nodes().Add(r);for(u=n.edgeGeometries.GetEnumerator();u.MoveNext();)o=u.get_Current(),this.AddEdgeGeometryToGraph(o,t,f);return t},AddEdgeGeometryToGraph:function(n,t,i){var r=this.GetOrCreateNode(n.get_SourcePort(),i),u=this.GetOrCreateNode(n.get_TargetPort(),i),f=function(){var t=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(r,u);return t.set_EdgeGeometry(n),t}.call(this);t.get_Edges().Add(f)},GetOrCreateNode:function(n,t){var r=this.GetPortCurve(n),i;return function(){var n={Value:i},u=t.TryGetValue(r,n);return i=n.Value,u}.call(this)||t.set_Item$$TKey(r,i=new Microsoft.Msagl.Core.Layout.Node.ctor$$ICurve(r)),i},GetPortCurve:function(n){return this.nodeTree.FirstHitNode$$Point$$Func$3(n.get_Location(),$CreateAnonymousDelegate(this,function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n,t)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside?Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue})).get_UserData()},GetIndependantPreGraphs:function(){var n=this.CreateInitialPregraphs(),t;do if(t=n.get_Count(),function(){var t={Value:n},i=this.UniteConnectedPreGraphs(t);return n=t.Value,i}.call(this),t<=n.get_Count())break;while(1);return n},UniteConnectedPreGraphs:function(n){var u=Microsoft.Msagl.Routing.MultiEdgeRouter.GetIntersectionGraphOfPreGraphs(n.Value),i,r,s;if(u!=null){for(var h=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(u),f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.PreGraph.ctor),e=h.GetEnumerator();e.MoveNext();)for(var c=e.get_Current(),t=null,o=c.GetEnumerator();o.MoveNext();)i=o.get_Current(),t==null?(t=n.Value.get_Item$$Int32(i),f.Add(t)):t.AddGraph(n.Value.get_Item$$Int32(i));for(n.Value=f,r=n.Value.GetEnumerator();r.MoveNext();)s=r.get_Current(),this.AddIntersectingNodes(s)}},AddIntersectingNodes:function(n){for(var r=n.boundingBox,t=this.nodeTree.GetNodeItemsIntersectingRectangle(r).GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.AddNodeBoundary(i)},CreateInitialPregraphs:function(){return new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.PreGraph.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Array,Microsoft.Msagl.Routing.PreGraph.ctor,this.multiEdgeGeometries,$CreateDelegate(this,this.CreatePregraphFromSetOfEdgeGeometries)))},CreatePregraphFromSetOfEdgeGeometries:function(n){var t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor),i=n[0],u=this.GetPortCurve(i.get_SourcePort()),f=u.get_BoundingBox().Clone(),e,r,o;for(t.Insert(u),t.Insert(i.get_TargetPort().get_Curve()),f.Add$$Rectangle(i.get_TargetPort().get_Curve().get_BoundingBox()),e=this.nodeTree.GetNodeItemsIntersectingRectangle(f),r=e.GetEnumerator();r.MoveNext();)o=r.get_Current(),t.Insert(o);return new Microsoft.Msagl.Routing.PreGraph.ctor$$EdgeGeometry$Array$$Set$1$ICurve(n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$MultiEdgeRouter);Microsoft$Msagl$Routing$MultipleSourceMultipleTargetsShortestPathOnVisibilityGraph={fullname:"Microsoft.Msagl.Routing.MultipleSourceMultipleTargetsShortestPathOnVisibilityGraph",baseTypeName:"System.Object",staticDefinition:{IsForbidden:function(n){return n.get_IsPassable()!=null&&!n.get_IsPassable()()||Is(n,Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){var r,u;for(this.sources=null,this.targets=null,this._current=null,this.closestTarget=null,this.upperBound=Infinity,this._visGraph=null,System.Object.ctor.call(this),this._visGraph=i,i.ClearPrevEdgesTable(),r=i.Vertices().GetEnumerator();r.MoveNext();)u=r.get_Current(),u.set_Distance(Infinity);this.sources=n;this.targets=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,t)},GetPath:function(){for(var t=new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor),f=this.sources.GetEnumerator(),i,r,u,n;f.MoveNext();)i=f.get_Current(),i.set_Distance(0),t.Enqueue(i,0);while(!t.IsEmpty()){if(this._current=t.Dequeue(),this.targets.Contains$$T(this._current))break;for(r=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,this._current.get_OutEdges(),$CreateDelegate(this,this.PassableOutEdge)).GetEnumerator();r.MoveNext();)n=r.get_Current(),this.ProcessNeighbor(t,n,n.get_Target());for(u=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,this._current.get_InEdges(),$CreateDelegate(this,this.PassableInEdge)).GetEnumerator();u.MoveNext();)n=u.get_Current(),this.ProcessNeighbor(t,n,n.get_Source())}return this._visGraph.PreviosVertex(this._current)==null?null:this.CalculatePath()},PassableOutEdge:function(n){return n.get_Source()==this.sources||this.targets.Contains$$T(n.get_Target())||!Microsoft.Msagl.Routing.MultipleSourceMultipleTargetsShortestPathOnVisibilityGraph.IsForbidden(n)},PassableInEdge:function(n){return this.targets.Contains$$T(n.get_Source())||n.get_Target()==this.sources||!Microsoft.Msagl.Routing.MultipleSourceMultipleTargetsShortestPathOnVisibilityGraph.IsForbidden(n)},ProcessNeighbor:function(n,t,i){var u=t.get_Length(),r=this._current.get_Distance()+u;r>=this.upperBound||(this.targets.Contains$$T(i)&&(this.upperBound=r,this.closestTarget=i),i!=this.sources&&this._visGraph.PreviosVertex(i)==null?(i.set_Distance(r),this._visGraph.SetPreviousEdge(i,t),n.Enqueue(i,r)):r<i.get_Distance()&&(i.set_Distance(r),this._visGraph.SetPreviousEdge(i,t),n.DecreasePriority(i,r)))},CalculatePath:function(){if(this.closestTarget==null)return null;var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor),n=this.closestTarget;do t.Add(n),n=this._visGraph.PreviosVertex(n);while(n.get_Distance()>0);return t.Add(n),t.Reverse(),t}}};JsTypes.push(Microsoft$Msagl$Routing$MultipleSourceMultipleTargetsShortestPathOnVisibilityGraph);Microsoft$Msagl$Routing$PreGraph={fullname:"Microsoft.Msagl.Routing.PreGraph",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$EdgeGeometry$Array$$Set$1$ICurve:function(n,t){var i,r;for(this.edgeGeometries=null,this.nodeBoundaries=null,this.boundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor,System.Object.ctor.call(this),this.edgeGeometries=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,n),this.nodeBoundaries=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,t),this.boundingBox=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox(),i=t.GetEnumerator();i.MoveNext();)r=i.get_Current(),this.boundingBox.Add$$Rectangle(r.get_BoundingBox())},ctor:function(){this.edgeGeometries=null;this.nodeBoundaries=null;this.boundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;System.Object.ctor.call(this)},AddGraph:function(n){this.edgeGeometries.AddRange(n.edgeGeometries);this.nodeBoundaries=Microsoft.Msagl.Core.DataStructures.Set$1.op_Addition(this.nodeBoundaries,n.nodeBoundaries);this.boundingBox.Add$$Rectangle(n.boundingBox)},AddNodeBoundary:function(n){this.nodeBoundaries.Insert(n);this.boundingBox.Add$$Rectangle(n.get_BoundingBox())}}};JsTypes.push(Microsoft$Msagl$Routing$PreGraph);Microsoft$Msagl$Routing$Rectilinear$AxisCoordinateEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.AxisCoordinateEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.site=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor.call(this);this.site=n},Site$$:"Microsoft.Msagl.Core.Geometry.Point",get_Site:function(){return this.site}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$AxisCoordinateEvent);Microsoft$Msagl$Routing$Rectilinear$Clump={fullname:"Microsoft.Msagl.Routing.Rectilinear.Clump",baseTypeName:"System.Collections.Generic.List$1",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){System.Collections.Generic.List$1.ctor.call(this,Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor);this.AddRange(n)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Clump);Microsoft$Msagl$Routing$Rectilinear$EnumeratorWrapper$1={fullname:"Microsoft.Msagl.Routing.Rectilinear.EnumeratorWrapper$1",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.T=n;this.state=Microsoft.Msagl.Routing.Rectilinear.EnumeratorWrapper.MoveNextState$1.NotCalled;this.enumerator=null;System.Object.ctor.call(this);this.enumerator=t.GetEnumerator()},HasCurrent$$:"System.Boolean",get_HasCurrent:function(){return this.state==Microsoft.Msagl.Routing.Rectilinear.EnumeratorWrapper.MoveNextState$1.True},Current$$:"`0",get_Current:function(){return System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_HasCurrent(),"MoveNext has not been called or has returned false"),this.enumerator.get_Current()},MoveNext:function(){return(System.Diagnostics.Debug.Assert$$Boolean$$String(this.state!=Microsoft.Msagl.Routing.Rectilinear.EnumeratorWrapper.MoveNextState$1.False,"MoveNext has returned false"),this.enumerator.MoveNext())?(this.state=Microsoft.Msagl.Routing.Rectilinear.EnumeratorWrapper.MoveNextState$1.True,!0):(this.state=Microsoft.Msagl.Routing.Rectilinear.EnumeratorWrapper.MoveNextState$1.False,!1)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$EnumeratorWrapper$1);Microsoft$Msagl$Routing$Rectilinear$FullVisibilityGraphGenerator={fullname:"Microsoft.Msagl.Routing.Rectilinear.FullVisibilityGraphGenerator",baseTypeName:"Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.hintScanSegment=null;Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.ctor.call(this,!0)},GenerateVisibilityGraph:function(){null!=this.ObstacleTree.get_Root()&&(Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.commonPrototype.GenerateVisibilityGraph.call(this),this.HorizontalScanSegments.MergeSegments(),this.VerticalScanSegments.MergeSegments(),this.IntersectScanSegments(),Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.Debug_AssertGraphIsRectilinear(this.get_VisibilityGraph(),this.ObstacleTree))},IntersectScanSegments:function(){var n=new Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.ctor;this.set_VisibilityGraph(n.Generate(this.HorizontalScanSegments.get_Segments(),this.VerticalScanSegments.get_Segments()));n.RemoveSegmentsWithNoVisibility(this.HorizontalScanSegments,this.VerticalScanSegments)},InitializeEventQueue:function(n){Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.commonPrototype.InitializeEventQueue.call(this,n);this.hintScanSegment=null},Clear:function(){Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.commonPrototype.Clear.call(this);this.hintScanSegment=null},InsertPerpendicularReflectionSegment:function(n,t){return null!=this.get_PerpendicularScanSegments().Find(n,t)?!1:(this.get_PerpendicularScanSegments().InsertUnique(new Microsoft.Msagl.Routing.Rectilinear.ScanSegment.ctor$$Point$$Point$$Double$$PointAndCrossingsList(n,t,5,null)),!0)},InsertParallelReflectionSegment:function(n,t,i,r,u,f){return null!=this.get_ParallelScanSegments().Find(n,t)?!1:this.AddSegment(n,t,i,r,u,f,5)},AddSegment:function(n,t,i,r,u,f,e){if(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,t))return!1;var h=this.CurrentGroupBoundaryCrossingMap.GetOrderedListBetween(n,t),o,s,c=function(){var i={Value:this.hintScanSegment},r={Value:o},u={Value:s},f=Microsoft.Msagl.Routing.Rectilinear.ScanSegment.Subsume(i,n,t,e,h,this.ScanDirection,this.get_ParallelScanSegments(),r,u);return this.hintScanSegment=i.Value,o=r.Value,s=u.Value,f}.call(this);if(c){if(e==5)return!1}else System.Diagnostics.Debug.Assert$$Boolean$$String(e!=5||this.get_ParallelScanSegments().Find(n,t)==null,"Reflection segments already in the ScanSegmentTree should should have been detected before calling AddSegment"),this.hintScanSegment=this.get_ParallelScanSegments().InsertUnique(new Microsoft.Msagl.Routing.Rectilinear.ScanSegment.ctor$$Point$$Point$$Double$$PointAndCrossingsList(n,t,e,h)).Item;return 500!=e&&(System.Diagnostics.Debug.Assert$$Boolean$$String(Is(r,Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide.ctor),"lowNbor is not HighObstacleSide"),System.Diagnostics.Debug.Assert$$Boolean$$String(Is(u,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor),"highNbor is not LowObstacleSide"),Is(f,Microsoft.Msagl.Routing.Rectilinear.CloseVertexEvent.ctor)?this.SideReflectsUpward(r)&&this.SideReflectsUpward(u)||(o&&this.StoreLookaheadSite(u.get_Obstacle(),r,n,!1),s&&this.StoreLookaheadSite(r.get_Obstacle(),u,t,!1)):(o&&this.StoreLookaheadSite$$Obstacle$$BasicObstacleSide$$BasicObstacleSide$$Point(i,this.LowNeighborSides.get_GroupSideInterveningBeforeLowNeighbor(),r,n),s&&this.StoreLookaheadSite$$Obstacle$$BasicObstacleSide$$BasicObstacleSide$$Point(i,this.HighNeighborSides.get_GroupSideInterveningBeforeHighNeighbor(),u,t))),!0},StoreLookaheadSite$$Obstacle$$BasicObstacleSide$$BasicObstacleSide$$Point:function(n,t,i,r){if(null==t)this.StoreLookaheadSite(n,i,r,!1);else{var u=Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.ScanLineIntersectSide$$Point$$BasicObstacleSide$$ScanDirection(r,t,this.ScanDirection);this.StoreLookaheadSite(n,t,u,!1)}},IntersectionAtSideIsInsideAnotherObstacle$$BasicObstacleSide$$BasicVertexEvent:function(n,t){var i=this.ScanLineIntersectSide$$Point$$BasicObstacleSide(t.get_Site(),n);return this.IntersectionAtSideIsInsideAnotherObstacle$$BasicObstacleSide$$Obstacle$$Point(n,t.get_Obstacle(),i)},IntersectionAtSideIsInsideAnotherObstacle$$BasicObstacleSide$$Obstacle$$Point:function(n,t,i){return n.get_Obstacle().get_IsOverlapped()?!n.get_Obstacle().get_IsGroup()&&!t.get_IsGroup()&&n.get_Obstacle().get_Clump()!=t.get_Clump()?!1:this.ObstacleTree.IntersectionIsInsideAnotherObstacle(n.get_Obstacle(),t,i,this.ScanDirection):!1},CreateScanSegments$$Obstacle$$HighObstacleSide$$BasicObstacleSide$$BasicObstacleSide$$LowObstacleSide$$BasicVertexEvent:function(n,t,i,r,u,f){var o,h;(null==r||this.IntersectionAtSideIsInsideAnotherObstacle$$BasicObstacleSide$$BasicVertexEvent(r,f))&&(r=u);(null==i||this.IntersectionAtSideIsInsideAnotherObstacle$$BasicObstacleSide$$BasicVertexEvent(i,f))&&(i=t);var e=this.ScanLineIntersectSide$$Point$$BasicObstacleSide(f.get_Site(),t),s=this.ScanLineIntersectSide$$Point$$BasicObstacleSide(f.get_Site(),u),c=this.IntersectionAtSideIsInsideAnotherObstacle$$BasicObstacleSide$$Obstacle$$Point(t,f.get_Obstacle(),e);if(!c&&t==i){this.AddSegment(e,s,n,t,u,f,1);return}o=r==u?s:this.ScanLineIntersectSide$$Point$$BasicObstacleSide(f.get_Site(),r);h=i==t?e:this.ScanLineIntersectSide$$Point$$BasicObstacleSide(f.get_Site(),i);c?(this.AddSegment(e,o,n,t,r,f,500),r!=u&&this.AddSegment(o,s,n,r,u,f,1)):(this.AddSegment(e,h,n,t,i,f,1),this.AddSegment(h,o,n,i,r,f,500),r!=u&&this.AddSegment(o,s,n,r,u,f,1))},CreateScanSegments$$Obstacle$$NeighborSides$$BasicVertexEvent:function(n,t,i){this.CreateScanSegments$$Obstacle$$HighObstacleSide$$BasicObstacleSide$$BasicObstacleSide$$LowObstacleSide$$BasicVertexEvent(n,Cast(t.get_LowNeighbor().Item,Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide.ctor),null==t.get_LowOverlapEnd()?null:t.get_LowOverlapEnd().Item,null==t.get_HighOverlapEnd()?null:t.get_HighOverlapEnd().Item,Cast(t.get_HighNeighbor().Item,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor),i)},CreateScanSegmentFromLowSide:function(n,t){this.CreateScanSegments$$Obstacle$$NeighborSides$$BasicVertexEvent(n.Item.get_Obstacle(),this.LowNeighborSides,t)},CreateScanSegmentFromHighSide:function(n,t){this.CreateScanSegments$$Obstacle$$NeighborSides$$BasicVertexEvent(n.Item.get_Obstacle(),this.HighNeighborSides,t)},ProcessVertexEvent:function(n,t,i){this.CreateScanSegmentFromLowSide(n,i);this.LowNeighborSides.get_HighNeighbor().Item!=this.HighNeighborSides.get_HighNeighbor().Item&&this.CreateScanSegmentFromHighSide(t,i)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$FullVisibilityGraphGenerator);Microsoft$Msagl$Routing$Rectilinear$VisibilityGraphGenerator={fullname:"Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.SentinelOffset=1},NewVisibilityGraph:function(){return function(){var n=new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor;return n.set_VertexFactory(function(n){return new Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear.ctor(n)}),n}()},Debug_AssertGraphIsRectilinear:function(n,t){if(System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,n.get_Edges(),function(n){return!Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureDirection$$Directions(Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n.get_SourcePoint(),n.get_TargetPoint()))})){Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(!1,"Generated VisibilityGraph contains non-rectilinear lines",t,n);return}},ScanLineIntersectSide$$Point$$BasicObstacleSide$$ScanDirection:function(n,t,i){System.Diagnostics.Debug.Assert$$Boolean$$String(!i.IsFlat$$SegmentBase(t),"flat sides should not be in the scanline or encountered on lookahead scan");var u=t.get_Direction(),r=t.get_Start().Clone();return i.get_IsHorizontal()?(r.set_X(r.get_X()+u.get_X()/u.get_Y()*(n.get_Y()-t.get_Start().get_Y())),r.set_X(Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.MungeIntersect(n.get_X(),r.get_X(),t.get_Start().get_X(),t.get_End().get_X())),r.set_Y(n.get_Y())):(r.set_X(n.get_X()),r.set_Y(r.get_Y()+u.get_Y()/u.get_X()*(n.get_X()-t.get_Start().get_X())),r.set_Y(Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.MungeIntersect(n.get_Y(),r.get_Y(),t.get_Start().get_Y(),t.get_End().get_Y()))),r}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.ScanDirection=null;this.eventQueue=null;this.HorizontalScanSegments=null;this.VerticalScanSegments=null;this.lookaheadScan=null;this.wantReflections=!1;this.ObstacleTree=new Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.ctor;this.scanLine=null;this.CurrentGroupBoundaryCrossingMap=new Microsoft.Msagl.Routing.Rectilinear.GroupBoundaryCrossingMap.ctor;this.LowNeighborSides=new Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.NeighborSides.ctor;this.HighNeighborSides=new Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.NeighborSides.ctor;this._VisibilityGraph=null;System.Object.ctor.call(this);this.ScanDirection=Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_HorizontalInstance();this.eventQueue=new Microsoft.Msagl.Routing.Rectilinear.EventQueue.ctor;this.HorizontalScanSegments=new Microsoft.Msagl.Routing.Rectilinear.ScanSegmentTree.ctor(Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_HorizontalInstance());this.VerticalScanSegments=new Microsoft.Msagl.Routing.Rectilinear.ScanSegmentTree.ctor(Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_VerticalInstance());this.wantReflections=n},VisibilityGraph$$:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",get_VisibilityGraph:function(){return this._VisibilityGraph},set_VisibilityGraph:function(n){this._VisibilityGraph=n},ParallelScanSegments$$:"Microsoft.Msagl.Routing.Rectilinear.ScanSegmentTree",get_ParallelScanSegments:function(){return this.ScanDirection.get_IsHorizontal()?this.HorizontalScanSegments:this.VerticalScanSegments},PerpendicularScanSegments$$:"Microsoft.Msagl.Routing.Rectilinear.ScanSegmentTree",get_PerpendicularScanSegments:function(){return this.ScanDirection.get_IsHorizontal()?this.VerticalScanSegments:this.HorizontalScanSegments},GenerateVisibilityGraph:function(){if(null!=this.ObstacleTree.get_Root()){if(this.InitializeEventQueue(Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_HorizontalInstance()),this.ObstacleTree.get_GraphBox().get_Left()<=-1.79769313486232E+308||this.ObstacleTree.get_GraphBox().get_Bottom()<=-1.79769313486232E+308||this.ObstacleTree.get_GraphBox().get_Right()>=1.79769313486232E+308||this.ObstacleTree.get_GraphBox().get_Top()>=1.79769313486232E+308)throw $CreateException(new System.InvalidOperationException.ctor$$String("One or more obstacle boundaries are out of range"),new Error);var r=1,n=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ObstacleTree.get_GraphBox().get_Left()-1,this.ObstacleTree.get_GraphBox().get_Bottom()-1),t=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ObstacleTree.get_GraphBox().get_Left()-1,this.ObstacleTree.get_GraphBox().get_Top()+1),i=Microsoft.Msagl.Routing.Rectilinear.Obstacle.CreateSentinel(n,t,this.ScanDirection,r++);this.scanLine.Insert(i.get_ActiveHighSide(),this.ObstacleTree.get_GraphBox().get_LeftBottom());n=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ObstacleTree.get_GraphBox().get_Right()+1,this.ObstacleTree.get_GraphBox().get_Bottom()-1);t=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ObstacleTree.get_GraphBox().get_Right()+1,this.ObstacleTree.get_GraphBox().get_Top()+1);i=Microsoft.Msagl.Routing.Rectilinear.Obstacle.CreateSentinel(n,t,this.ScanDirection,r++);this.scanLine.Insert(i.get_ActiveLowSide(),this.ObstacleTree.get_GraphBox().get_LeftBottom());this.ProcessEvents();this.InitializeEventQueue(Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_VerticalInstance());n=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ObstacleTree.get_GraphBox().get_Left()-1,this.ObstacleTree.get_GraphBox().get_Bottom()-1);t=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ObstacleTree.get_GraphBox().get_Right()+1,this.ObstacleTree.get_GraphBox().get_Bottom()-1);i=Microsoft.Msagl.Routing.Rectilinear.Obstacle.CreateSentinel(n,t,this.ScanDirection,r++);this.scanLine.Insert(i.get_ActiveHighSide(),this.ObstacleTree.get_GraphBox().get_LeftBottom());n=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ObstacleTree.get_GraphBox().get_Left()-1,this.ObstacleTree.get_GraphBox().get_Top()+1);t=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ObstacleTree.get_GraphBox().get_Right()+1,this.ObstacleTree.get_GraphBox().get_Top()+1);i=Microsoft.Msagl.Routing.Rectilinear.Obstacle.CreateSentinel(n,t,this.ScanDirection,r);this.scanLine.Insert(i.get_ActiveLowSide(),this.ObstacleTree.get_GraphBox().get_LeftBottom());this.ProcessEvents()}},GetOpenVertex:function(n){for(var t=n.get_StartPoint(),i=this.TraversePolylineForEvents(t),u=this.PointCompare(i.get_Point(),t.get_Point()),r;;i=this.TraversePolylineForEvents(i)){if(r=this.PointCompare(i.get_Point(),t.get_Point()),r<=0)t=i;else if(r>0&&u<=0)break;u=r}return t},TraversePolylineForEvents:function(n){return this.ScanDirection.get_IsHorizontal()?n.get_NextOnPolyline():n.get_PrevOnPolyline()},InitializeEventQueue:function(n){this.ScanDirection=n;this.eventQueue.Reset(this.ScanDirection);this.EnqueueBottomVertexEvents();this.scanLine=new Microsoft.Msagl.Routing.Rectilinear.RectilinearScanLine.ctor(this.ScanDirection,this.ObstacleTree.get_GraphBox().get_LeftBottom());this.lookaheadScan=new Microsoft.Msagl.Routing.Rectilinear.LookaheadScan.ctor(this.ScanDirection)},EnqueueBottomVertexEvents:function(){for(var t=this.ObstacleTree.GetAllPrimaryObstacles().GetEnumerator(),n,i;t.MoveNext();)n=t.get_Current(),i=this.GetOpenVertex(n.get_VisibilityPolyline()),this.eventQueue.Enqueue(new Microsoft.Msagl.Routing.Rectilinear.OpenVertexEvent.ctor(n,i))},IsFlat:function(n){return this.ScanDirection.IsFlat$$SegmentBase(n)},IsPerpendicular:function(n){return this.ScanDirection.IsPerpendicular$$SegmentBase(n)},ScanLineIntersectSide$$Point$$BasicObstacleSide:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.ScanLineIntersectSide$$Point$$BasicObstacleSide$$ScanDirection(n,t,this.ScanDirection)},SideReflectsUpward:function(n){return Is(n,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor)?this.ScanDirection.Coord(n.get_End())>this.ScanDirection.Coord(n.get_Start()):this.ScanDirection.Coord(n.get_End())<this.ScanDirection.Coord(n.get_Start())},SideReflectsDownward:function(n){return Is(n,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor)?this.ScanDirection.Coord(n.get_End())<this.ScanDirection.Coord(n.get_Start()):this.ScanDirection.Coord(n.get_End())>this.ScanDirection.Coord(n.get_Start())},StoreLookaheadSite:function(n,t,i,r){if(this.wantReflections&&!this.IsPerpendicular(t)){if(!r&&!Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.PointIsInRectangleInterior(i,t.get_Obstacle().get_VisibilityBoundingBox()))return;this.SideReflectsUpward(t)&&null==this.lookaheadScan.Find(i)&&this.lookaheadScan.Add(new Microsoft.Msagl.Routing.Rectilinear.BasicReflectionEvent.ctor$$Obstacle$$Obstacle$$Point(n,t.get_Obstacle(),i))}},LoadReflectionEvents$$BasicObstacleSide:function(n){this.LoadReflectionEvents$$BasicObstacleSide$$BasicObstacleSide(n,n)},LoadReflectionEvents$$BasicObstacleSide$$BasicObstacleSide:function(n,t){var r,u,f;if(null!=n&&!this.SideReflectsUpward(n)&&!this.IsPerpendicular(n)&&(r=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n.get_Start(),n.get_End()),u=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(t.get_Start(),t.get_End()),this.ScanDirection.get_IsHorizontal()?r.IntersectsOnX(u):r.IntersectsOnY(u))){for(var e=Microsoft.Msagl.Core.Geometry.Rectangle.Intersect(r,u),s=e.get_LeftBottom(),o=e.get_RightTop(),i=this.lookaheadScan.FindFirstInRange(s,o);null!=i;)f=Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.ScanLineIntersectSide$$Point$$BasicObstacleSide$$ScanDirection(i.Item.get_Site(),n,this.ScanDirection.get_PerpendicularInstance()),this.ScanDirection.ComparePerpCoord(f,i.Item.get_Site())>0?this.AddReflectionEvent(i.Item,n,f):i.Item.get_ReflectingObstacle()!=n.get_Obstacle()&&this.lookaheadScan.MarkStaleSite(i.Item),i=this.lookaheadScan.FindNextInRange(i,o);this.lookaheadScan.RemoveStaleSites()}},AddPerpendicularReflectionSegment:function(n,t,i){if(System.Diagnostics.Debug.Assert$$Boolean$$String(null!=t,"eventSide should not be null"),this.lookaheadScan.RemoveExact(n.get_PreviousSite())){if(System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_InitialObstacle()==n.get_PreviousSite().get_ReflectingObstacle(),"Inconsistency: currentEvent.InitialObstacle != currentEvent.PreviousSite.ReflectingObstacle"),null==t)return!1;if(System.Diagnostics.Debug.Assert$$Boolean$$String(!this.IsFlat(t),"Flat sides should not be encountered in reflections"),n.get_PreviousSite().IsStaircaseStep(n.get_ReflectingObstacle())){if(!Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.PointIsInRectangleInterior(n.get_Site(),n.get_ReflectingObstacle().get_VisibilityBoundingBox())||!this.InsertPerpendicularReflectionSegment(n.get_PreviousSite().get_Site(),n.get_Site()))return!1;if(null!=i&&n.IsStaircaseStep(i.get_Obstacle()))return this.ScanLineCrossesObstacle(n.get_Site(),i.get_Obstacle())}}return!1},AddParallelReflectionSegment:function(n,t,i,r){var u=this.ScanLineIntersectSide$$Point$$BasicObstacleSide(r.get_Site(),t!=null?t:i),f=null!=t?u:r.get_Site(),e=null!=t?r.get_Site():u;return null==t?t=this.scanLine.NextLow$$BasicObstacleSide(i).Item:i=this.scanLine.NextHigh$$BasicObstacleSide(t).Item,this.InsertParallelReflectionSegment(f,e,n,t,i,r)},AddReflectionEvent:function(n,t,i){System.Diagnostics.Debug.Assert$$Boolean$$String(null!=this.scanLine.Find(t),"AddReflectionEvent could not find 'side' in the scanline");var r=As(t,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor);r!=null?this.eventQueue.Enqueue(new Microsoft.Msagl.Routing.Rectilinear.LowReflectionEvent.ctor(n,r,i)):this.eventQueue.Enqueue(new Microsoft.Msagl.Routing.Rectilinear.HighReflectionEvent.ctor(n,Cast(t,Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide.ctor),i))},AddSideToScanLine:function(n,t){var i=this.scanLine.Insert(n,t);return this.LoadReflectionEvents$$BasicObstacleSide(n),i},RemoveSideFromScanLine:function(n,t){this.scanLine.Remove(n.Item,t)},PointCompare:function(n,t){return this.ScanDirection.Compare(n,t)},Clear:function(){this.ObstacleTree.Clear();this.eventQueue=new Microsoft.Msagl.Routing.Rectilinear.EventQueue.ctor;this.HorizontalScanSegments=new Microsoft.Msagl.Routing.Rectilinear.ScanSegmentTree.ctor(Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_HorizontalInstance());this.VerticalScanSegments=new Microsoft.Msagl.Routing.Rectilinear.ScanSegmentTree.ctor(Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_VerticalInstance());this.set_VisibilityGraph(null)},ProcessEvents:function(){while(this.eventQueue.get_Count()>0){var n=this.eventQueue.Dequeue();Is(n,Microsoft.Msagl.Routing.Rectilinear.OpenVertexEvent.ctor)?this.ProcessEvent$$OpenVertexEvent(As(n,Microsoft.Msagl.Routing.Rectilinear.OpenVertexEvent.ctor)):Is(n,Microsoft.Msagl.Routing.Rectilinear.LowBendVertexEvent.ctor)?this.ProcessEvent$$LowBendVertexEvent(As(n,Microsoft.Msagl.Routing.Rectilinear.LowBendVertexEvent.ctor)):Is(n,Microsoft.Msagl.Routing.Rectilinear.HighBendVertexEvent.ctor)?this.ProcessEvent$$HighBendVertexEvent(As(n,Microsoft.Msagl.Routing.Rectilinear.HighBendVertexEvent.ctor)):Is(n,Microsoft.Msagl.Routing.Rectilinear.CloseVertexEvent.ctor)?this.ProcessEvent$$CloseVertexEvent(As(n,Microsoft.Msagl.Routing.Rectilinear.CloseVertexEvent.ctor)):Is(n,Microsoft.Msagl.Routing.Rectilinear.LowReflectionEvent.ctor)?this.ProcessEvent$$LowReflectionEvent(As(n,Microsoft.Msagl.Routing.Rectilinear.LowReflectionEvent.ctor)):Is(n,Microsoft.Msagl.Routing.Rectilinear.HighReflectionEvent.ctor)?this.ProcessEvent$$HighReflectionEvent(As(n,Microsoft.Msagl.Routing.Rectilinear.HighReflectionEvent.ctor)):this.ProcessCustomEvent(n);this.LowNeighborSides.Clear();this.HighNeighborSides.Clear()}System.Diagnostics.Debug.Assert$$Boolean$$String(2==this.scanLine.get_Count(),"There are leftovers in the scanline")},ProcessCustomEvent:function(){System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"Unknown event type")},ScanLineCrossesObstacle:function(n,t){return this.ScanDirection.ComparePerpCoord(n,t.get_VisibilityBoundingBox().get_LeftBottom())>0&&this.ScanDirection.ComparePerpCoord(n,t.get_VisibilityBoundingBox().get_RightTop())<0},FindInitialNeighborSides:function(n,t,i){t.Value=this.scanLine.NextLow$$RBNode$1$BasicObstacleSide(n);i.Value=this.scanLine.NextHigh$$RBNode$1$BasicObstacleSide(n)},FindNeighbors$$BasicVertexEvent$$RBNode$1$BasicObstacleSide$$RBNode$1$BasicObstacleSide:function(n,t,i){this.LowNeighborSides.Clear();this.HighNeighborSides.Clear();this.FindNeighbors$$BasicVertexEvent$$RBNode$1$BasicObstacleSide$$NeighborSides(n,t,this.LowNeighborSides);this.FindNeighbors$$BasicVertexEvent$$RBNode$1$BasicObstacleSide$$NeighborSides(n,i,this.HighNeighborSides)},FindNeighbors$$BasicVertexEvent$$RBNode$1$BasicObstacleSide$$NeighborSides:function(n,t,i){var f=Is(n,Microsoft.Msagl.Routing.Rectilinear.OpenVertexEvent.ctor)?t.Item.get_Start():t.Item.get_End(),r,u;(function(){var n={Value:r},i={Value:u},f=this.FindInitialNeighborSides(t,n,i);return r=n.Value,u=i.Value,f}).call(this);this.SkipToNeighbor(this.ScanDirection.get_OppositeDirection(),t.Item,f,r,i);this.SkipToNeighbor(this.ScanDirection.get_Direction(),t.Item,f,u,i)},SkipToNeighbor:function(n,t,i,r,u){for(var e=null,f=null;;r=this.scanLine.Next(n,r))if(r.Item.get_Obstacle()!=t.get_Obstacle()){if(r.Item.get_Obstacle().get_IsGroup()){this.ProcessGroupSideEncounteredOnTraversalToNeighbor(r,i,n)&&null==f&&(f=r.Item);continue}if(Is(r.Item,Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide.ctor)==Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsAscending(n)){this.ScanLineCrossesObstacle(i,r.Item.get_Obstacle())&&(e=r,f=null);continue}break}u.SetSides(n,r,e,f)},ProcessGroupSideEncounteredOnTraversalToNeighbor:function(n,t,i){if(!this.ScanLineCrossesObstacle(t,n.Item.get_Obstacle()))return!1;var r=Is(n.Item,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor)==Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsAscending(i)?i:Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(i),u=this.ScanLineIntersectSide$$Point$$BasicObstacleSide(t,n.Item);return this.CurrentGroupBoundaryCrossingMap.AddIntersection(u,n.Item.get_Obstacle(),r),!0},FindNeighborsAndProcessVertexEvent:function(n,t,i){this.CurrentGroupBoundaryCrossingMap.Clear();this.FindNeighbors$$BasicVertexEvent$$RBNode$1$BasicObstacleSide$$RBNode$1$BasicObstacleSide(i,n,t);this.ProcessVertexEvent(n,t,i);this.CurrentGroupBoundaryCrossingMap.Clear()},DevTrace_DumpScanSegmentsDuringAdd:function(){},ProcessEvent$$OpenVertexEvent:function(n){var t=n.get_Obstacle(),r,u,f,e,i;t.CreateInitialSides(n.get_Vertex(),this.ScanDirection);System.Diagnostics.Debug.Assert$$Boolean$$String(!this.IsFlat(t.get_ActiveLowSide()),"OpenVertexEvent ActiveLowSide should not be flat");System.Diagnostics.Debug.Assert$$Boolean$$String(!this.IsFlat(t.get_ActiveHighSide()),"RemoveCollinearSides should have been called");this.AddSideToScanLine(t.get_ActiveLowSide(),n.get_Site());r=this.AddSideToScanLine(t.get_ActiveHighSide(),n.get_Site());u=this.scanLine.Find(t.get_ActiveLowSide());this.FindNeighborsAndProcessVertexEvent(u,r,n);f=this.LowNeighborSides.get_GroupSideInterveningBeforeLowNeighbor()!=null?this.LowNeighborSides.get_GroupSideInterveningBeforeLowNeighbor():this.LowNeighborSides.get_LowNeighborSide();this.SideReflectsUpward(f)&&this.LoadReflectionEvents$$BasicObstacleSide(t.get_ActiveLowSide());e=this.HighNeighborSides.get_GroupSideInterveningBeforeHighNeighbor()!=null?this.HighNeighborSides.get_GroupSideInterveningBeforeHighNeighbor():this.HighNeighborSides.get_HighNeighborSide();this.SideReflectsUpward(e)&&this.LoadReflectionEvents$$BasicObstacleSide(t.get_ActiveHighSide());Microsoft.Msagl.Core.Geometry.Point.op_Inequality(t.get_ActiveHighSide().get_Start(),t.get_ActiveLowSide().get_Start())&&(i=new Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide.ctor(t,n.get_Vertex(),this.ScanDirection),this.lookaheadScan.RemoveSitesForFlatBottom(i.get_Start(),i.get_End()));this.EnqueueLowBendVertexEvent(t.get_ActiveLowSide());this.EnqueueHighBendOrCloseVertexEvent(t.get_ActiveHighSide())},ProcessEvent$$LowBendVertexEvent:function(n){var i=n.get_Obstacle(),t=new Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor(i,n.get_Vertex(),this.ScanDirection);this.ScanDirection.ComparePerpCoord(t.get_End(),t.get_Start())>0&&(this.RemoveSideFromScanLine(this.scanLine.Find(i.get_ActiveLowSide()),n.get_Site()),this.AddSideToScanLine(t,n.get_Site()),i.set_ActiveLowSide(t),this.EnqueueLowBendVertexEvent(t))},EnqueueLowBendVertexEvent:function(n){this.eventQueue.Enqueue(new Microsoft.Msagl.Routing.Rectilinear.LowBendVertexEvent.ctor(n.get_Obstacle(),n.get_EndVertex()))},ProcessEvent$$HighBendVertexEvent:function(n){var i=n.get_Obstacle(),t=new Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide.ctor(i,n.get_Vertex(),this.ScanDirection),u,r;this.RemoveSideFromScanLine(this.scanLine.Find(i.get_ActiveHighSide()),n.get_Site());u=this.AddSideToScanLine(t,n.get_Site());i.set_ActiveHighSide(t);this.EnqueueHighBendOrCloseVertexEvent(i.get_ActiveHighSide());this.wantReflections&&this.ScanDirection.get_IsHorizontal()&&t.get_Start().get_X()==i.get_VisibilityBoundingBox().get_Right()&&this.SideReflectsUpward(t)&&(r=this.scanLine.NextHigh$$RBNode$1$BasicObstacleSide(u),Is(r.Item,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor)&&this.SideReflectsDownward(r.Item)&&(i.get_IsOverlapped()&&this.ObstacleTree.PointIsInsideAnObstacle$$Point$$ScanDirection(t.get_Start(),this.ScanDirection)||(this.StoreLookaheadSite(r.Item.get_Obstacle(),t,t.get_Start(),!0),this.LoadReflectionEvents$$BasicObstacleSide(r.Item))))},EnqueueHighBendOrCloseVertexEvent:function(n){var t=n.get_Obstacle(),i=this.ScanDirection.get_IsHorizontal()?n.get_EndVertex().get_PrevOnPolyline():n.get_EndVertex().get_NextOnPolyline();this.ScanDirection.ComparePerpCoord(i.get_Point(),n.get_End())>0?this.eventQueue.Enqueue(new Microsoft.Msagl.Routing.Rectilinear.HighBendVertexEvent.ctor(t,n.get_EndVertex())):this.eventQueue.Enqueue(new Microsoft.Msagl.Routing.Rectilinear.CloseVertexEvent.ctor(t,n.get_EndVertex()))},CreateCloseEventSegmentsAndFindNeighbors:function(n){var t=n.get_Obstacle(),r=this.scanLine.Find(t.get_ActiveLowSide()),u=this.scanLine.Find(t.get_ActiveHighSide()),f,i;if(1==this.scanLine.Compare(t.get_ActiveLowSide(),t.get_ActiveHighSide())&&(f=r,r=u,u=f),this.FindNeighborsAndProcessVertexEvent(r,u,n),this.wantReflections&&t.get_IsOverlapped())for(i=this.scanLine.NextHigh$$RBNode$1$BasicObstacleSide(r);i.Item!=u.Item;i=this.scanLine.NextHigh$$RBNode$1$BasicObstacleSide(i))this.LoadReflectionEvents$$BasicObstacleSide(i.Item);this.scanLine.Remove(t.get_ActiveLowSide(),n.get_Site());this.scanLine.Remove(t.get_ActiveHighSide(),n.get_Site())},ProcessEvent$$CloseVertexEvent:function(n){this.CreateCloseEventSegmentsAndFindNeighbors(n);var t=Cast(this.LowNeighborSides.get_LowNeighbor().Item,Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide.ctor),i=Cast(this.HighNeighborSides.get_HighNeighbor().Item,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor),r=n.get_Obstacle();this.LoadReflectionEvents$$BasicObstacleSide(t);this.LoadReflectionEvents$$BasicObstacleSide(i);r.Close()},ProcessEvent$$LowReflectionEvent:function(n){var t=n.get_Side().get_Obstacle(),i=As(this.scanLine.NextLow$$BasicObstacleSide(n.get_Side()).Item,Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide.ctor);this.AddPerpendicularReflectionSegment(n,n.get_Side(),i)&&this.AddParallelReflectionSegment(t,i,null,n)&&this.LoadReflectionEvents$$BasicObstacleSide(t.get_ActiveLowSide())},ProcessEvent$$HighReflectionEvent:function(n){var t=n.get_Side().get_Obstacle(),i=As(this.scanLine.NextHigh$$BasicObstacleSide(n.get_Side()).Item,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor);this.AddPerpendicularReflectionSegment(n,n.get_Side(),i)&&this.AddParallelReflectionSegment(t,null,i,n)&&this.LoadReflectionEvents$$BasicObstacleSide(t.get_ActiveHighSide())},MakeInBoundsLocation:function(n){var t=System.Math.Max$$Double$$Double(n.get_X(),this.ObstacleTree.get_GraphBox().get_Left()),i=System.Math.Max$$Double$$Double(n.get_Y(),this.ObstacleTree.get_GraphBox().get_Bottom());return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Min$$Double$$Double(t,this.ObstacleTree.get_GraphBox().get_Right()),System.Math.Min$$Double$$Double(i,this.ObstacleTree.get_GraphBox().get_Top()))},IsInBounds$$VisibilityVertex:function(n){return this.IsInBounds$$Point(n.Point)},IsInBounds$$Point:function(n){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,this.MakeInBoundsLocation(n))},DevTraceInfoVgGen:function(){},DevTraceIfFlatSide:function(){},DevTraceScanSegmentDump:function(){}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$VisibilityGraphGenerator);Microsoft$Msagl$Routing$Rectilinear$OverlapConvexHull={fullname:"Microsoft.Msagl.Routing.Rectilinear.OverlapConvexHull",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this._Polyline=null;this._PrimaryObstacle=null;this._Obstacles=null;System.Object.ctor.call(this);this.set_Polyline(n);this.set_Obstacles(System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,t));this.set_PrimaryObstacle(this.get_Obstacles().get_Item$$Int32(0));Microsoft.Msagl.Routing.Rectilinear.Obstacle.RoundVertices(this.get_Polyline())},Polyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_Polyline:function(){return this._Polyline},set_Polyline:function(n){this._Polyline=n},PrimaryObstacle$$:"Microsoft.Msagl.Routing.Rectilinear.Obstacle",get_PrimaryObstacle:function(){return this._PrimaryObstacle},set_PrimaryObstacle:function(n){this._PrimaryObstacle=n},Obstacles$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.Obstacle]]",get_Obstacles:function(){return this._Obstacles},set_Obstacles:function(n){this._Obstacles=n},toString:function(){return this.get_Polyline().toString()}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$OverlapConvexHull);Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator={fullname:"Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator",baseTypeName:"Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator",staticDefinition:{cctor:function(){},GetBoundingCorners:function(n,t,i,r,u){if(t){r.Value=n.get_LeftBottom();u.Value=i?n.get_RightBottom():n.get_LeftTop();return}r.Value=i?n.get_LeftTop():n.get_RightBottom();u.Value=n.get_RightTop()},FindIntersectingSlot:function(n,t,i,r){var f=n.GetParallelCoord(i),u;return function(){var n={Value:u},i=t.TryGetValue(f,n);return u=n.Value,i}()?u:0==r?-1:n.FindNearest(f,r)},CreateScanSegmentTree:function(n,t){for(var r=n.get_Items().GetEnumerator(),u,i;r.MoveNext();)for(u=r.get_Current(),i=u.FirstSegment;i!=null;i=i.get_NextSegment())i.HasVisibility()&&t.InsertUnique(i)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.horizontalVertexPoints=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);this.verticalVertexPoints=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);this.boundingBoxSteinerPoints=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);this.xCoordAccumulator=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Double.ctor);this.yCoordAccumulator=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Double.ctor);this.horizontalScanSegmentVector=null;this.verticalScanSegmentVector=null;this.horizontalCoordMap=new System.Collections.Generic.Dictionary$2.ctor(System.Double.ctor,System.Int32.ctor);this.verticalCoordMap=new System.Collections.Generic.Dictionary$2.ctor(System.Double.ctor,System.Int32.ctor);this.perpendicularCoordMap=null;this.parallelSegmentVector=null;this.perpendicularSegmentVector=null;this.currentAxisPointComparer=null;Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.ctor.call(this,!1)},Clear:function(){Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.commonPrototype.Clear.call(this);this.Cleanup()},Cleanup:function(){this.horizontalVertexPoints.Clear();this.verticalVertexPoints.Clear();this.boundingBoxSteinerPoints.Clear();this.xCoordAccumulator.Clear();this.yCoordAccumulator.Clear();this.horizontalCoordMap.Clear();this.verticalCoordMap.Clear()},GenerateVisibilityGraph:function(){this.AccumulateVertexCoords();this.CreateSegmentVectorsAndPopulateCoordinateMaps();this.RunScanLineToCreateSegmentsAndBoundingBoxSteinerPoints();this.GenerateSparseIntersectionsFromVertexPoints();this.CreateScanSegmentTrees();Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.Debug_AssertGraphIsRectilinear(this.get_VisibilityGraph(),this.ObstacleTree);this.Cleanup()},AccumulateVertexCoords:function(){for(var t=this.ObstacleTree.GetAllObstacles().GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),this.xCoordAccumulator.Insert(n.get_VisibilityBoundingBox().get_Left()),this.xCoordAccumulator.Insert(n.get_VisibilityBoundingBox().get_Right()),this.yCoordAccumulator.Insert(n.get_VisibilityBoundingBox().get_Top()),this.yCoordAccumulator.Insert(n.get_VisibilityBoundingBox().get_Bottom())},CreateSegmentVectorsAndPopulateCoordinateMaps:function(){var n;for(this.horizontalScanSegmentVector=new Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.ScanSegmentVector.ctor(this.yCoordAccumulator,!0),this.verticalScanSegmentVector=new Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.ScanSegmentVector.ctor(this.xCoordAccumulator,!1),n=0;n<this.horizontalScanSegmentVector.get_Length();++n)this.horizontalCoordMap.set_Item$$TKey(this.horizontalScanSegmentVector.get_Item$$Int32(n).get_Coord(),n);for(n=0;n<this.verticalScanSegmentVector.get_Length();++n)this.verticalCoordMap.set_Item$$TKey(this.verticalScanSegmentVector.get_Item$$Int32(n).get_Coord(),n)},RunScanLineToCreateSegmentsAndBoundingBoxSteinerPoints:function(){Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.commonPrototype.GenerateVisibilityGraph.call(this);this.horizontalScanSegmentVector.ScanSegmentsComplete();this.verticalScanSegmentVector.ScanSegmentsComplete();this.xCoordAccumulator.Clear();this.yCoordAccumulator.Clear()},InitializeEventQueue:function(n){Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.commonPrototype.InitializeEventQueue.call(this,n);this.SetVectorsAndCoordMaps(n);this.AddAxisCoordinateEvents(n)},AddAxisCoordinateEvents:function(n){var i,r,t;if(n.get_IsHorizontal()){for(i=this.yCoordAccumulator.GetEnumerator();i.MoveNext();)t=i.get_Current(),this.eventQueue.Enqueue(new Microsoft.Msagl.Routing.Rectilinear.AxisCoordinateEvent.ctor(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ObstacleTree.get_GraphBox().get_Left()-1,t)));return}for(r=this.xCoordAccumulator.GetEnumerator();r.MoveNext();)t=r.get_Current(),this.eventQueue.Enqueue(new Microsoft.Msagl.Routing.Rectilinear.AxisCoordinateEvent.ctor(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,this.ObstacleTree.get_GraphBox().get_Bottom()-1)))},ProcessCustomEvent:function(n){this.ProcessAxisCoordinate(n)||Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.commonPrototype.ProcessCustomEvent.call(this,n)},ProcessAxisCoordinate:function(n){var t=As(n,Microsoft.Msagl.Routing.Rectilinear.AxisCoordinateEvent.ctor);return null!=t?(this.CreateScanSegmentsOnAxisCoordinate(t.get_Site()),!0):!1},InsertPerpendicularReflectionSegment:function(){return System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"base.wantReflections is false in Sparse mode so this should never be called"),!1},InsertParallelReflectionSegment:function(){return System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"base.wantReflections is false in Sparse mode so this should never be called"),!1},ProcessVertexEvent:function(n,t,i){var f=this.ScanDirection.get_IsHorizontal()?this.horizontalVertexPoints:this.verticalVertexPoints,c,l,r,u;f.Insert(i.get_Site());var e=this.LowNeighborSides.get_LowNeighbor().Item,o=this.HighNeighborSides.get_HighNeighbor().Item,a=this.ScanDirection.get_Direction(),v=this.ScanDirection.get_OppositeDirection(),s=this.ScanLineIntersectSide$$Point$$BasicObstacleSide(i.get_Site(),e),h=this.ScanLineIntersectSide$$Point$$BasicObstacleSide(i.get_Site(),o);this.ObstacleTree.get_GraphBox().Contains$$Point(s)&&(c=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.RectangleBorderIntersect(e.get_Obstacle().get_VisibilityBoundingBox(),s,a),Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(c,i.get_Site())&&this.boundingBoxSteinerPoints.Insert(c));this.ObstacleTree.get_GraphBox().Contains$$Point(h)&&(l=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.RectangleBorderIntersect(o.get_Obstacle().get_VisibilityBoundingBox(),h,v),Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(i.get_Site(),l)&&this.boundingBoxSteinerPoints.Insert(l)),function(){var t={Value:r},f={Value:u},e=Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.GetBoundingCorners(n.Item.get_Obstacle().get_VisibilityBoundingBox(),Is(i,Microsoft.Msagl.Routing.Rectilinear.OpenVertexEvent.ctor),this.ScanDirection.get_IsHorizontal(),t,f);return r=t.Value,u=f.Value,e}.call(this);(Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(s,r)||e.get_Obstacle().IsInSameClump(i.get_Obstacle()))&&f.Insert(r);(Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(u,h)||o.get_Obstacle().IsInSameClump(i.get_Obstacle()))&&f.Insert(u)},CreateScanSegmentsOnAxisCoordinate:function(n){var e,f;this.CurrentGroupBoundaryCrossingMap.Clear();for(var o=this.scanLine.Lowest(),t=this.scanLine.NextHigh$$RBNode$1$BasicObstacleSide(o),r=0,i=n,u=!1;null!=t;t=this.scanLine.NextHigh$$RBNode$1$BasicObstacleSide(t))if(!this.SkipSide(i,t.Item)){if(t.Item.get_Obstacle().get_IsGroup()){(r==0||u)&&this.HandleGroupCrossing(n,t.Item);continue}if(e=Is(t.Item,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor),e){if(r>0){++r;continue}i=this.CreateScanSegment(i,t.Item,1);this.CurrentGroupBoundaryCrossingMap.Clear();r=1;u=t.Item.get_Obstacle().get_IsOverlapped();continue}(System.Diagnostics.Debug.Assert$$Boolean$$String(r>0,"Overlap depth must be positive"),--r,r>0)||(i=t.Item.get_Obstacle().get_IsOverlapped()||t.Item.get_Obstacle().get_OverlapsGroupCorner()?this.CreateScanSegment(i,t.Item,500):this.ScanLineIntersectSide$$Point$$BasicObstacleSide(i,t.Item),this.CurrentGroupBoundaryCrossingMap.Clear(),u=!1)}f=this.ScanDirection.get_IsHorizontal()?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.ObstacleTree.get_GraphBox().get_Right()+1,i.get_Y()):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i.get_X(),this.ObstacleTree.get_GraphBox().get_Top()+1);this.parallelSegmentVector.CreateScanSegment(i,f,1,this.CurrentGroupBoundaryCrossingMap.GetOrderedListBetween(i,f));this.parallelSegmentVector.ScanSegmentsCompleteForCurrentSlot()},HandleGroupCrossing:function(n,t){var r;if(Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.commonPrototype.ScanLineCrossesObstacle.call(this,n,t.get_Obstacle())){var u=Is(t,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor)?this.ScanDirection.get_Direction():this.ScanDirection.get_OppositeDirection(),i=this.ScanLineIntersectSide$$Point$$BasicObstacleSide(n,t),f=this.CurrentGroupBoundaryCrossingMap.AddIntersection(i,t.get_Obstacle(),u);this.AddPerpendicularCoordForGroupCrossing(i);r=f.GetInteriorVertexPoint(i);this.AddPerpendicularCoordForGroupCrossing(r)}},AddPerpendicularCoordForGroupCrossing:function(n){var t=this.FindPerpendicularSlot(n,0);-1!=t&&this.perpendicularSegmentVector.get_Item$$Int32(t).AddPendingPerpendicularCoord(this.parallelSegmentVector.get_CurrentSlot().get_Coord())},SkipSide:function(n,t){if(t.get_Obstacle().get_IsSentinel())return!0;var i=t.get_Obstacle().get_VisibilityBoundingBox();return this.ScanDirection.get_IsHorizontal()?n.get_Y()==i.get_Bottom()||n.get_Y()==i.get_Top():n.get_X()==i.get_Left()||n.get_X()==i.get_Right()},CreateScanSegment:function(n,t,i){var r=this.ScanLineIntersectSide$$Point$$BasicObstacleSide(n,t);return Microsoft.Msagl.Core.Geometry.Point.op_Inequality(n,r)&&this.parallelSegmentVector.CreateScanSegment(n,r,i,this.CurrentGroupBoundaryCrossingMap.GetOrderedListBetween(n,r)),r},GenerateSparseIntersectionsFromVertexPoints:function(){this.set_VisibilityGraph(Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.NewVisibilityGraph());this.GenerateSparseIntersectionsAlongHorizontalAxis();this.GenerateSparseIntersectionsAlongVerticalAxis();this.ConnectAdjoiningScanSegments();this.horizontalScanSegmentVector.CreateSparseVerticesAndEdges(this.get_VisibilityGraph());this.verticalScanSegmentVector.CreateSparseVerticesAndEdges(this.get_VisibilityGraph())},GenerateSparseIntersectionsAlongHorizontalAxis:function(){this.currentAxisPointComparer=new Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.HorizontalPointComparer.ctor;var n=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2$$IComparer$1(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,this.horizontalVertexPoints,$CreateAnonymousDelegate(this,function(n){return n}),this.currentAxisPointComparer).GetEnumerator(),t=new Microsoft.Msagl.Routing.Rectilinear.EnumeratorWrapper$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2$$IComparer$1(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,this.boundingBoxSteinerPoints,$CreateAnonymousDelegate(this,function(n){return n}),this.currentAxisPointComparer));this.ScanDirection=Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_HorizontalInstance();this.SetVectorsAndCoordMaps(this.ScanDirection);this.GenerateSparseIntersections(n,t)},GenerateSparseIntersectionsAlongVerticalAxis:function(){this.currentAxisPointComparer=new Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.VerticalPointComparer.ctor;var n=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2$$IComparer$1(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,this.verticalVertexPoints,$CreateAnonymousDelegate(this,function(n){return n}),this.currentAxisPointComparer).GetEnumerator(),t=new Microsoft.Msagl.Routing.Rectilinear.EnumeratorWrapper$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2$$IComparer$1(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,this.boundingBoxSteinerPoints,$CreateAnonymousDelegate(this,function(n){return n}),this.currentAxisPointComparer));this.ScanDirection=Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_VerticalInstance();this.SetVectorsAndCoordMaps(this.ScanDirection);this.GenerateSparseIntersections(n,t)},SetVectorsAndCoordMaps:function(n){n.get_IsHorizontal()?(this.parallelSegmentVector=this.horizontalScanSegmentVector,this.perpendicularSegmentVector=this.verticalScanSegmentVector,this.perpendicularCoordMap=this.verticalCoordMap):(this.parallelSegmentVector=this.verticalScanSegmentVector,this.perpendicularSegmentVector=this.horizontalScanSegmentVector,this.perpendicularCoordMap=this.horizontalCoordMap)},ConnectAdjoiningScanSegments:function(){this.horizontalScanSegmentVector.ConnectAdjoiningSegmentEndpoints();this.verticalScanSegmentVector.ConnectAdjoiningSegmentEndpoints()},GenerateSparseIntersections:function(n,t){var r,i;for(this.perpendicularSegmentVector.ResetForIntersections(),this.parallelSegmentVector.ResetForIntersections(),n.MoveNext(),t.MoveNext(),r=this.parallelSegmentVector.get_Items().GetEnumerator();r.MoveNext();)for(i=r.get_Current();;){if(!i.CurrentSegment.ContainsPoint(n.get_Current())&&(!this.AddSteinerPointsToInterveningSegments(n.get_Current(),t,i)||!i.TraverseToSegmentContainingPoint(n.get_Current())))break;if(this.AddPointsToCurrentSegmentIntersections(t,i),this.GenerateIntersectionsFromVertexPointForCurrentSegment(n.get_Current(),i),i.PointIsCurrentEndAndNextStart(n.get_Current())){i.MoveNext();System.Diagnostics.Debug.Assert$$Boolean$$String(i.get_HasCurrent(),"MoveNext ended before EndAndNextStart");continue}if(!n.MoveNext()){System.Diagnostics.Debug.Assert$$Boolean$$String(!t.get_HasCurrent(),"Some boundingBoxSteinerPoints remain");return}}System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"Mismatch in points and segments")},AddSteinerPointsToInterveningSegments:function(n,t,i){while(t.get_HasCurrent()&&this.currentAxisPointComparer.Compare(t.get_Current(),n)==-1){if(!i.TraverseToSegmentContainingPoint(t.get_Current()))return!1;this.AddPointsToCurrentSegmentIntersections(t,i)}return!0},AddPointsToCurrentSegmentIntersections:function(n,t){for(;n.get_HasCurrent()&&t.CurrentSegment.ContainsPoint(n.get_Current());n.MoveNext()){var i=this.FindPerpendicularSlot(n.get_Current(),0);this.AddSlotToSegmentIntersections(t,i)}},GenerateIntersectionsFromVertexPointForCurrentSegment:function(n,t){var i=this.FindPerpendicularSlot(t.CurrentSegment.get_Start(),1),r=this.FindPerpendicularSlot(t.CurrentSegment.get_End(),-1),u=this.FindPerpendicularSlot(n,0);i>=r||(this.AddSlotToSegmentIntersections(t,i),this.AddSlotToSegmentIntersections(t,r),u>i&&u<r&&(this.AddSlotToSegmentIntersections(t,u),this.AddBinaryDivisionSlotsToSegmentIntersections(t,i,u,r)))},FindPerpendicularSlot:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.FindIntersectingSlot(this.perpendicularSegmentVector,this.perpendicularCoordMap,n,t)},AddSlotToSegmentIntersections:function(n,t){var i=this.perpendicularSegmentVector.get_Item$$Int32(t);n.CurrentSegment.AddSparseVertexCoord(i.get_Coord());i.AddPerpendicularCoord(n.get_Coord())},AddBinaryDivisionSlotsToSegmentIntersections:function(n,t,i,r){for(var u=0,f=this.perpendicularSegmentVector.get_Length()-1,e;f-u>1;){if(e=u+((f-u)/2|0),i<=e){f=e;i<f&&f<=r&&this.AddSlotToSegmentIntersections(n,f);continue}u=e;i>u&&u>=t&&this.AddSlotToSegmentIntersections(n,u)}},CreateScanSegmentTrees:function(){Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.CreateScanSegmentTree(this.horizontalScanSegmentVector,this.HorizontalScanSegments);Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.CreateScanSegmentTree(this.verticalScanSegmentVector,this.VerticalScanSegments)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator);Microsoft$Msagl$Routing$Rectilinear$VertexEntry={fullname:"Microsoft.Msagl.Routing.Rectilinear.VertexEntry",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this._Cost=0;this._Vertex=null;this._Direction=Microsoft.Msagl.Core.Geometry.Directions.None;this._Length=0;this._NumberOfBends=0;this._PreviousEntry=null;this._IsClosed=!1;System.Object.ctor.call(this);this.set_Vertex(n);this.set_Direction(t!=null?Microsoft.Msagl.Core.Geometry.CompassVector.PureDirectionFromPointToPoint(t.get_Vertex().Point,n.Point):Microsoft.Msagl.Core.Geometry.Directions.None);this.ResetEntry(t,i,r,u)},ResetEntry:function(n,t,i,r){this.get_PreviousEntry()!=null&&(System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_PreviousEntry().get_Vertex()==n.get_Vertex(),"Inconsistent prevEntry vertex"),System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_PreviousEntry().get_Direction()!=n.get_Direction(),"Duplicate prevEntry direction"),System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_Direction()==Microsoft.Msagl.Core.Geometry.CompassVector.PureDirectionFromPointToPoint(this.get_PreviousEntry().get_Vertex().Point,this.get_Vertex().Point),"Inconsistent entryDir"));this.set_PreviousEntry(n);this.set_Length(t);this.set_NumberOfBends(i);this.set_Cost(r)},Cost$$:"System.Double",get_Cost:function(){return this._Cost},set_Cost:function(n){this._Cost=n},Vertex$$:"Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear",get_Vertex:function(){return this._Vertex},set_Vertex:function(n){this._Vertex=n},PreviousVertex$$:"Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear",get_PreviousVertex:function(){return this.get_PreviousEntry()==null?null:this.get_PreviousEntry().get_Vertex()},Direction$$:"Microsoft.Msagl.Core.Geometry.Directions",get_Direction:function(){return this._Direction},set_Direction:function(n){this._Direction=n},Length$$:"System.Double",get_Length:function(){return this._Length},set_Length:function(n){this._Length=n},NumberOfBends$$:"System.Int32",get_NumberOfBends:function(){return this._NumberOfBends},set_NumberOfBends:function(n){this._NumberOfBends=n},PreviousEntry$$:"Microsoft.Msagl.Routing.Rectilinear.VertexEntry",get_PreviousEntry:function(){return this._PreviousEntry},set_PreviousEntry:function(n){this._PreviousEntry=n},IsClosed$$:"System.Boolean",get_IsClosed:function(){return this._IsClosed},set_IsClosed:function(n){this._IsClosed=n},toString:function(){return this.get_Vertex().Point+" "+this.get_Direction()+" "+this.get_IsClosed()+" "+this.get_Cost()}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$VertexEntry);Microsoft$Msagl$Routing$Rectilinear$VisibilityVertexRectilinear={fullname:"Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear",baseTypeName:"Microsoft.Msagl.Routing.Visibility.VisibilityVertex",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this._VertexEntries=null;Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor.call(this,n)},VertexEntries$$:"Microsoft.Msagl.Routing.Rectilinear.VertexEntry[]",get_VertexEntries:function(){return this._VertexEntries},set_VertexEntries:function(n){this._VertexEntries=n},SetVertexEntry:function(n){this.get_VertexEntries()==null&&this.set_VertexEntries(new Array(4));this.get_VertexEntries()[Microsoft.Msagl.Core.Geometry.CompassVector.ToIndex(n.get_Direction())]=n},RemoveVertexEntries:function(){this.set_VertexEntries(null)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$VisibilityVertexRectilinear);Microsoft$Msagl$Routing$ShapeCreator={fullname:"Microsoft.Msagl.Routing.ShapeCreator",baseTypeName:"System.Object",staticDefinition:{GetShapes:function(n){for(var s,r,h,c,l,a,y,v,u,f,t=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Routing.Shape.ctor),o=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes(),function(n){return!n.UnderCollapsedCluster()})),e=0,p=o.length,i=o[e];e<p;e++,i=o[e])t.set_Item$$TKey(i,Microsoft.Msagl.Routing.ShapeCreator.CreateShapeWithCenterPort(i));for(s=n.get_RootCluster().AllClustersDepthFirst().GetEnumerator();s.MoveNext();){if(r=s.get_Current(),!r.get_IsCollapsed())for(h=r.get_Nodes().GetEnumerator();h.MoveNext();)i=h.get_Current(),t.ContainsKey(i)||t.set_Item$$TKey(i,Microsoft.Msagl.Routing.ShapeCreator.CreateShapeWithCenterPort(i));if(r!=n.get_RootCluster()&&(c=function(n){return t.set_Item$$TKey(r,n),n}(Microsoft.Msagl.Routing.ShapeCreator.CreateShapeWithClusterBoundaryPort(r)),!r.get_IsCollapsed())){for(l=r.get_Nodes().GetEnumerator();l.MoveNext();)i=l.get_Current(),c.AddChild(t.get_Item$$TKey(i));for(a=r.get_Clusters().GetEnumerator();a.MoveNext();)y=a.get_Current(),c.AddChild(t.get_Item$$TKey(y))}}for(v=n.get_Edges().GetEnumerator();v.MoveNext();)u=v.get_Current(),function(){var n={Value:f},i=t.TryGetValue(u.get_Source(),n);return f=n.Value,i}()&&u.get_SourcePort()!=null&&f.get_Ports().Insert(u.get_SourcePort()),function(){var n={Value:f},i=t.TryGetValue(u.get_Target(),n);return f=n.Value,i}()&&u.get_TargetPort()!=null&&f.get_Ports().Insert(u.get_TargetPort());return t.get_Values()},CreateShapeWithCenterPort:function(n){var i=new Microsoft.Msagl.Routing.RelativeShape.ctor(function(){return n.get_BoundaryCurve()}),r=new Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point(function(){return n.get_BoundaryCurve()},function(){return n.get_Center()}),u,f,e,t;for(i.get_Ports().Insert(r),u=n.get_InEdges().GetEnumerator();u.MoveNext();)t=u.get_Current(),Microsoft.Msagl.Routing.ShapeCreator.FixPortAtTarget(i,r,t);for(f=n.get_OutEdges().GetEnumerator();f.MoveNext();)t=f.get_Current(),Microsoft.Msagl.Routing.ShapeCreator.FixPortAtSource(i,r,t);for(e=n.get_SelfEdges().GetEnumerator();e.MoveNext();)t=e.get_Current(),Microsoft.Msagl.Routing.ShapeCreator.FixPortAtSource(i,r,t),Microsoft.Msagl.Routing.ShapeCreator.FixPortAtTarget(i,r,t);return i},CreateShapeWithClusterBoundaryPort:function(n){var t,r,u,f,e,i;for(System.Diagnostics.Debug.Assert$$Boolean(Is(n,Microsoft.Msagl.Core.Layout.Cluster.ctor)),t=new Microsoft.Msagl.Routing.RelativeShape.ctor(function(){return n.get_BoundaryCurve()}),r=new Microsoft.Msagl.Routing.ClusterBoundaryPort.ctor$$Func$1$ICurve$$Func$1$Point(function(){return n.get_BoundaryCurve()},function(){return n.get_Center()}),t.get_Ports().Insert(r),u=n.get_InEdges().GetEnumerator();u.MoveNext();)i=u.get_Current(),Microsoft.Msagl.Routing.ShapeCreator.FixPortAtTarget(t,r,i);for(f=n.get_OutEdges().GetEnumerator();f.MoveNext();)i=f.get_Current(),Microsoft.Msagl.Routing.ShapeCreator.FixPortAtSource(t,r,i);for(e=n.get_SelfEdges().GetEnumerator();e.MoveNext();)i=e.get_Current(),Microsoft.Msagl.Routing.ShapeCreator.FixPortAtSource(t,r,i),Microsoft.Msagl.Routing.ShapeCreator.FixPortAtTarget(t,r,i);return t.set_UserData(n.toString()),t},FixPortAtSource:function(n,t,i){i.get_SourcePort()==null?i.set_SourcePort(t):n.get_Ports().Insert(i.get_SourcePort())},FixPortAtTarget:function(n,t,i){i.get_TargetPort()==null?i.set_TargetPort(t):n.get_Ports().Insert(i.get_TargetPort())}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$ShapeCreator);Microsoft$Msagl$Routing$ShapeCreatorForRoutingToParents={fullname:"Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents",baseTypeName:"System.Object",staticDefinition:{GetShapes:function(n,t){for(var r=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Routing.Shape.ctor),f=n.GetEnumerator(),u,i;f.MoveNext();)i=f.get_Current(),Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.ProcessAncestorDescendantCouple(Cast(i.get_Target(),Microsoft.Msagl.Core.Layout.Cluster.ctor),i.get_Source(),r),Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.InsertEdgePortsToShapes(r,i);for(u=t.GetEnumerator();u.MoveNext();)i=u.get_Current(),Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.ProcessAncestorDescendantCouple(Cast(i.get_Source(),Microsoft.Msagl.Core.Layout.Cluster.ctor),i.get_Target(),r),Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.InsertEdgePortsToShapes(r,i);return Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.BindShapes(r),r.get_Values()},InsertEdgePortsToShapes:function(n,t){n.get_Item$$TKey(t.get_Target()).get_Ports().Insert(t.get_TargetPort());n.get_Item$$TKey(t.get_Source()).get_Ports().Insert(t.get_SourcePort())},BindShapes:function(n){for(var f=n.GetEnumerator(),t,i,e,r,o,u;f.MoveNext();)if(t=f.get_Current(),i=As(t.get_Key(),Microsoft.Msagl.Core.Layout.Cluster.ctor),i!=null)for(e=t.get_Value(),r=Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.Children(i).GetEnumerator();r.MoveNext();)o=r.get_Current(),function(){var t={Value:u},i=n.TryGetValue(o,t);return u=t.Value,i}()&&e.AddChild(u)},ProcessAncestorDescendantCouple:function(n,t,i){var r=Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.Parent(t),u,f;do{for(u=Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.Children(r).GetEnumerator();u.MoveNext();)f=u.get_Current(),Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.CreateShapeIfNeeeded(f,i);if(r==n)break;r=Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.Parent(r)}while(1);Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.CreateShapeIfNeeeded(r,i)},CreateShapeIfNeeeded:function(n,t){t.ContainsKey(n)||t.set_Item$$TKey(n,function(){var t=new Microsoft.Msagl.Routing.RelativeShape.ctor(function(){return n.get_BoundaryCurve()});return t.set_UserData(n.toString()),t}())},Children:function(n){return System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Clusters(),n.get_Nodes())},Parent:function(n){return System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_ClusterParents())},NumberOfActiveNodesIsUnderThreshold:function(n,t,i){for(var f=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),e=n.GetEnumerator(),u,r;e.MoveNext();)if(r=e.get_Current(),Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.SetOfActiveNodesIsLargerThanThreshold(Cast(r.get_Target(),Microsoft.Msagl.Core.Layout.Cluster.ctor),r.get_Source(),f,i))return!1;for(u=t.GetEnumerator();u.MoveNext();)if(r=u.get_Current(),Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.SetOfActiveNodesIsLargerThanThreshold(Cast(r.get_Source(),Microsoft.Msagl.Core.Layout.Cluster.ctor),r.get_Target(),f,i))return!1;return!0},SetOfActiveNodesIsLargerThanThreshold:function(n,t,i,r){var u=Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.Parent(t),f,e;do{for(f=Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.Children(u).GetEnumerator();f.MoveNext();)if(e=f.get_Current(),i.Insert(e),i.get_Count()>r)return!0;if(u==n)break;u=Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.Parent(u)}while(1);return i.Insert(u),i.get_Count()>r}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$ShapeCreatorForRoutingToParents);Microsoft$Msagl$Routing$ShapeObstacleCalculator={fullname:"Microsoft.Msagl.Routing.ShapeObstacleCalculator",baseTypeName:"System.Object",staticDefinition:{ShapeIsInsideOfPoly:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n.get_BoundaryCurve().get_Start(),t)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.tightHierarchy=null;this.coupleHierarchy=null;this._RootOfLooseHierarchy=null;this._ShapesToTightLooseCouples=null;this._TightPadding=0;this._LoosePadding=0;this._MainShape=null;this._OverlapsDetected=!1;System.Object.ctor.call(this);this.set_MainShape(n);this.set_TightPadding(t);this.set_LoosePadding(i);this.set_ShapesToTightLooseCouples(r)},RootOfLooseHierarchy$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Routing.Shape]]",get_RootOfLooseHierarchy:function(){return this._RootOfLooseHierarchy},set_RootOfLooseHierarchy:function(n){this._RootOfLooseHierarchy=n},ShapesToTightLooseCouples$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Routing.Shape],[Microsoft.Msagl.Routing.TightLooseCouple]]",get_ShapesToTightLooseCouples:function(){return this._ShapesToTightLooseCouples},set_ShapesToTightLooseCouples:function(n){this._ShapesToTightLooseCouples=n},TightPadding$$:"System.Double",get_TightPadding:function(){return this._TightPadding},set_TightPadding:function(n){this._TightPadding=n},LoosePadding$$:"System.Double",get_LoosePadding:function(){return this._LoosePadding},set_LoosePadding:function(n){this._LoosePadding=n},MainShape$$:"Microsoft.Msagl.Routing.Shape",get_MainShape:function(){return this._MainShape},set_MainShape:function(n){this._MainShape=n},OverlapsDetected$$:"System.Boolean",get_OverlapsDetected:function(){return this._OverlapsDetected},set_OverlapsDetected:function(n){this._OverlapsDetected=n},Calculate:function(){System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,this.get_MainShape().get_Children())!=0&&(this.CreateTightObstacles(),this.CreateTigthLooseCouples(),this.FillTheMapOfShapeToTightLooseCouples())},FillTheMapOfShapeToTightLooseCouples:function(){var n=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,this.get_MainShape().get_Children(),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Routing.Shape.ctor,n,n.get_BoundingBox())})));Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.TightLooseCouple.ctor,n,this.coupleHierarchy,$CreateDelegate(this,this.TryMapShapeToTightLooseCouple))},TryMapShapeToTightLooseCouple:function(n,t){Microsoft.Msagl.Routing.ShapeObstacleCalculator.ShapeIsInsideOfPoly(n,t.get_TightPolyline())&&this.get_ShapesToTightLooseCouples().set_Item$$TKey(n,t)},CreateTigthLooseCouples:function(){for(var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.TightLooseCouple.ctor),i=this.tightHierarchy.GetAllLeaves().GetEnumerator();i.MoveNext();){var n=i.get_Current(),r=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.FindMaxPaddingForTightPolyline(this.tightHierarchy,n,this.get_LoosePadding()),u=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.LoosePolylineWithFewCorners(n,r);t.Add(new Microsoft.Msagl.Routing.TightLooseCouple.ctor(n,new Microsoft.Msagl.Routing.Shape.ctor$$ICurve(u),r))}this.coupleHierarchy=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.TightLooseCouple.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,t,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Routing.TightLooseCouple.ctor,n,n.get_TightPolyline().get_BoundingBox())})))},CreateTightObstacles:function(){var n=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.get_MainShape().get_Children(),$CreateDelegate(this,this.InitialTightPolyline))),t=n.get_Count();this.tightHierarchy=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.RemovePossibleOverlapsInTightPolylinesAndCalculateHierarchy(n);this.set_OverlapsDetected(t>n.get_Count())},InitialTightPolyline:function(n){var t=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.PaddedPolylineBoundaryOfNode(n.get_BoundaryCurve(),this.get_TightPadding()),i=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,this.LoosePolylinesUnderShape(n),$CreateAnonymousDelegate(this,function(n){return n})),$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n,t)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside})));return i.length<=0?t:function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(Microsoft.Msagl.Core.Geometry.ConvexHull.CalculateConvexHull(System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Geometry.Point.ctor,t,i)));return n.set_Closed(!0),n}.call(this)},LoosePolylinesUnderShape:function(n){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n.get_Children(),$CreateAnonymousDelegate(this,function(n){return Cast(this.get_ShapesToTightLooseCouples().get_Item$$TKey(n).get_LooseShape().get_BoundaryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)}))}}};JsTypes.push(Microsoft$Msagl$Routing$ShapeObstacleCalculator);Microsoft$Msagl$Routing$Spline$Bundling$CdtThreader={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.CdtThreader",baseTypeName:"System.Object",staticDefinition:{PointLocationForTriangle:function(n,t){for(var r,u=!1,i=0;i<3;i++){if(r=Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,t.Sites.get_Item$$Int32(i).Point,t.Sites.get_Item$$Int32(i+1).Point),r<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside;r<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(u=!0)}return u?Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Boundary:Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.start=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.end=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.positiveSign=0;this.negativeSign=0;this.currentPiercedEdge=null;this.currentTriangle=null;System.Object.ctor.call(this);System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.Spline.Bundling.CdtThreader.PointLocationForTriangle(t,n)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside);this.currentTriangle=n;this.start=t;this.end=i},CurrentPiercedEdge$$:"Microsoft.Msagl.Routing.CdtEdge",get_CurrentPiercedEdge:function(){return this.currentPiercedEdge},CurrentTriangle$$:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle",get_CurrentTriangle:function(){return this.currentTriangle},Triangles:function(){for(var n=[];this.MoveNext();)n.push(this.get_CurrentTriangle());return n},FindFirstPiercedEdge:function(){var t,n,i;return(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.Spline.Bundling.CdtThreader.PointLocationForTriangle(this.start,this.currentTriangle)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside),System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.Spline.Bundling.CdtThreader.PointLocationForTriangle(this.end,this.currentTriangle)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside),t=this.GetHyperplaneSign(this.currentTriangle.Sites.get_Item$$Int32(0)),n=this.GetHyperplaneSign(this.currentTriangle.Sites.get_Item$$Int32(1)),t!=n&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.end,this.currentTriangle.Sites.get_Item$$Int32(0).Point,this.currentTriangle.Sites.get_Item$$Int32(1).Point)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise)?(this.positiveSign=t,this.negativeSign=n,this.currentTriangle.Edges.get_Item$$Int32(0)):(i=this.GetHyperplaneSign(this.currentTriangle.Sites.get_Item$$Int32(2)),n!=i&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.end,this.currentTriangle.Sites.get_Item$$Int32(1).Point,this.currentTriangle.Sites.get_Item$$Int32(2).Point)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise)?(this.positiveSign=n,this.negativeSign=i,this.currentTriangle.Edges.get_Item$$Int32(1)):(this.positiveSign=i,this.negativeSign=t,System.Diagnostics.Debug.Assert$$Boolean(this.positiveSign>this.negativeSign),this.currentTriangle.Edges.get_Item$$Int32(2))},FindNextPierced:function(){if(System.Diagnostics.Debug.Assert$$Boolean(this.negativeSign<this.positiveSign),this.currentTriangle=this.currentPiercedEdge.GetOtherTriangle$$CdtTriangle(this.currentTriangle),this.currentTriangle==null){this.currentPiercedEdge=null;return}var i=this.currentTriangle.Edges.Index(this.currentPiercedEdge),t,r=this.currentTriangle.Sites.get_Item$$Int32(i+2),n=this.GetHyperplaneSign(r);this.negativeSign==0?(System.Diagnostics.Debug.Assert$$Boolean(this.positiveSign==1),n==-1||n==0?(this.negativeSign=n,t=i+1):t=i+2):this.positiveSign==0?(System.Diagnostics.Debug.Assert$$Boolean(this.negativeSign==-1),n==1||n==0?(this.positiveSign=n,t=i+2):t=i+1):n!=this.positiveSign?(this.negativeSign=n,t=i+1):(System.Diagnostics.Debug.Assert$$Boolean(this.negativeSign!=n),this.positiveSign=n,t=i+2);this.currentPiercedEdge=Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(this.end,this.currentTriangle.Sites.get_Item$$Int32(t).Point,this.currentTriangle.Sites.get_Item$$Int32(t+1).Point)<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?this.currentTriangle.Edges.get_Item$$Int32(t):null},GetHyperplaneSign:function(n){var t=Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(this.start,n.Point,this.end);return t>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?1:t<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?-1:0},MoveNext:function(){return this.currentPiercedEdge==null?this.currentPiercedEdge=this.FindFirstPiercedEdge():this.FindNextPierced(),this.currentPiercedEdge!=null}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$CdtThreader);Microsoft$Msagl$Routing$Spline$Bundling$SdBoneEdge={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.SdBoneEdge",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.VisibilityEdge=null;this.Source=null;this.Target=null;this.numberOfPassedPaths=0;this._CrossedCdtEdges=null;System.Object.ctor.call(this);this.VisibilityEdge=n;this.Source=t;this.Target=i},TargetPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_TargetPoint:function(){return this.Target.get_Point()},SourcePoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_SourcePoint:function(){return this.Source.get_Point()},IsOccupied$$:"System.Boolean",get_IsOccupied:function(){return this.numberOfPassedPaths>0},CrossedCdtEdges$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Routing.CdtEdge]]",get_CrossedCdtEdges:function(){return this._CrossedCdtEdges},set_CrossedCdtEdges:function(n){this._CrossedCdtEdges=n},IsPassable$$:"System.Boolean",get_IsPassable:function(){return this.Target.get_IsTargetOfRouting()||this.Source.get_IsSourceOfRouting()||this.VisibilityEdge.get_IsPassable()==null||this.VisibilityEdge.get_IsPassable()()},AddOccupiedEdge:function(){this.numberOfPassedPaths++},RemoveOccupiedEdge:function(){this.numberOfPassedPaths--;System.Diagnostics.Debug.Assert$$Boolean(this.numberOfPassedPaths>=0)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$SdBoneEdge);Microsoft$Msagl$Routing$Spline$Bundling$SdVertex={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.SdVertex",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.VisibilityVertex=null;this.InBoneEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.SdBoneEdge.ctor);this.OutBoneEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.SdBoneEdge.ctor);this.Triangle=null;this.cost=0;this._PrevEdge=null;this._IsSourceOfRouting=!1;this._IsTargetOfRouting=!1;System.Object.ctor.call(this);this.VisibilityVertex=n},Prev$$:"Microsoft.Msagl.Routing.Spline.Bundling.SdVertex",get_Prev:function(){return this.get_PrevEdge()==null?null:this.get_PrevEdge().Source==this?this.get_PrevEdge().Target:this.get_PrevEdge().Source},PrevEdge$$:"Microsoft.Msagl.Routing.Spline.Bundling.SdBoneEdge",get_PrevEdge:function(){return this._PrevEdge},set_PrevEdge:function(n){this._PrevEdge=n},IsSourceOfRouting$$:"System.Boolean",get_IsSourceOfRouting:function(){return this._IsSourceOfRouting},set_IsSourceOfRouting:function(n){this._IsSourceOfRouting=n},IsTargetOfRouting$$:"System.Boolean",get_IsTargetOfRouting:function(){return this._IsTargetOfRouting},set_IsTargetOfRouting:function(n){this._IsTargetOfRouting=n},Point$$:"Microsoft.Msagl.Core.Geometry.Point",get_Point:function(){return this.VisibilityVertex.Point},Cost$$:"System.Double",get_Cost:function(){return this.get_IsSourceOfRouting()?this.cost:this.get_Prev()==null?Infinity:this.cost},set_Cost:function(n){this.cost=n},SetPreviousToNull:function(){this.set_PrevEdge(null)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$SdVertex);Microsoft$Msagl$Routing$Spline$Bundling$SdShortestPath={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.SdShortestPath",baseTypeName:"System.Object",staticDefinition:{ExtendPolylineEndToClusterBoundary:function(n,t){var i=t.ClosestParameter(n.get_End());n.AddPoint$$Point(t.get_Item$$Double(i))},ExtendPolylineStartToClusterBoundary:function(n,t){var i=t.ClosestParameter(n.get_Start());n.PrependPoint(t.get_Item$$Double(i))},CostOfCrossingCdtEdge:function(n,t,i,r){var f=i.get_LineWidth(),u;return(r.Capacity!=r.get_ResidualCapacity()&&(f+=t.get_EdgeSeparation()),u=r.get_ResidualCapacity()-f,u>=0)?0:-u*n},CalculateCdtEdgeCapacityForEdge:function(n){var t,i,r,u;n.Constrained||n.get_CwTriangle()==null||n.get_CcwTriangle()==null||(t=As(n.upperSite.get_Owner(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),i=As(n.lowerSite.get_Owner(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),t!=i&&(r=Microsoft.Msagl.Routing.Visibility.Polygon.Distance$$Polygon$$Point(new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(t),n.lowerSite.Point),u=Microsoft.Msagl.Routing.Visibility.Polygon.Distance$$Polygon$$Point(new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(i),n.upperSite.Point),n.Capacity=(r+u)/2))},CapacityOverflowPenaltyMultiplier:function(n){return n.get_CapacityOverflowCoefficient()*(n.get_PathLengthImportance()+n.get_InkImportance())}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.vertexArray=null;this.EdgesToRoutes=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,System.Collections.Generic.List$1.ctor);this.EdgesToRouteSources=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,Microsoft.Msagl.Routing.Spline.Bundling.SdVertex.ctor);this.CurrentEdgeGeometry=null;this.VisibilityVerticesToSdVerts=null;this.LengthCoefficient=0;this.Queue=null;this.LowestCostToTarget=0;this.ClosestTargetVertex=null;this.capacityOverlowPenaltyMultiplier=0;this.sourceLoosePoly=null;this.targetLoosePoly=null;this._VisibilityGraph=null;this._MakeTransparentShapesOfEdgeGeometry=null;this._BundlingSettings=null;this._EdgeGeometries=null;this._ObstacleHierarchy=null;this._Cdt=null;this._Gates=null;System.Object.ctor.call(this);this.set_MakeTransparentShapesOfEdgeGeometry(n);this.set_Cdt(t);this.set_Gates(i)},VisibilityGraph$$:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",get_VisibilityGraph:function(){return this._VisibilityGraph},set_VisibilityGraph:function(n){this._VisibilityGraph=n},MakeTransparentShapesOfEdgeGeometry$$:"System.Func`2[[Microsoft.Msagl.Core.Layout.EdgeGeometry],[System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Shape]]]]",get_MakeTransparentShapesOfEdgeGeometry:function(){return this._MakeTransparentShapesOfEdgeGeometry},set_MakeTransparentShapesOfEdgeGeometry:function(n){this._MakeTransparentShapesOfEdgeGeometry=n},BundlingSettings$$:"Microsoft.Msagl.Core.Routing.BundlingSettings",get_BundlingSettings:function(){return this._BundlingSettings},set_BundlingSettings:function(n){this._BundlingSettings=n},EdgeGeometries$$:"Microsoft.Msagl.Core.Layout.EdgeGeometry[]",get_EdgeGeometries:function(){return this._EdgeGeometries},set_EdgeGeometries:function(n){this._EdgeGeometries=n},ObstacleHierarchy$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_ObstacleHierarchy:function(){return this._ObstacleHierarchy},set_ObstacleHierarchy:function(n){this._ObstacleHierarchy=n},Cdt$$:"Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt",get_Cdt:function(){return this._Cdt},set_Cdt:function(n){this._Cdt=n},Gates$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Routing.CdtEdge]]",get_Gates:function(){return this._Gates},set_Gates:function(n){this._Gates=n},CreateGraphElements:function(){for(var f,u,n=0,i=this.vertexArray,o=i.length,r=i[n];n<o;n++,r=i[n])for(f=r.VisibilityVertex,u=f.get_InEdges().GetEnumerator();u.MoveNext();){var t=u.get_Current(),e=new Microsoft.Msagl.Routing.Spline.Bundling.SdBoneEdge.ctor(t,this.VisibilityVerticesToSdVerts.get_Item$$TKey(t.get_Source()),this.VisibilityVerticesToSdVerts.get_Item$$TKey(t.get_Target())),s=this.VisibilityVerticesToSdVerts.get_Item$$TKey(t.get_Source());r.InBoneEdges.Add(e);s.OutBoneEdges.Add(e)}},CreateRoutingGraph:function(){var r,n,t,i;for(this.vertexArray=new Array(this.get_VisibilityGraph().get_VertexCount()),r=0,this.VisibilityVerticesToSdVerts=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,Microsoft.Msagl.Routing.Spline.Bundling.SdVertex.ctor),n=this.get_VisibilityGraph().Vertices().GetEnumerator();n.MoveNext();)t=n.get_Current(),i=new Microsoft.Msagl.Routing.Spline.Bundling.SdVertex.ctor(t),this.vertexArray[r++]=i,this.VisibilityVerticesToSdVerts.set_Item$$TKey(t,i);this.CreateGraphElements()},RouteEdges:function(){this.Initialize();this.RestoreCapacities();for(var t=0,r=this.get_EdgeGeometries(),f=r.length,n=r[t];t<f;t++,n=r[t])this.EdgesToRoutes.set_Item$$TKey(n,this.RouteEdge(n));this.RerouteEdges();for(var i=0,u=this.get_EdgeGeometries(),e=u.length,n=u[i];i<e;i++,n=u[i])this.SetEdgeGeometryCurve(n)},SetEdgeGeometryCurve:function(n){var t=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,r=this.EdgesToRouteSources.get_Item$$TKey(n),u,i,f,e;for(t.AddPoint$$Point(r.get_Point()),u=this.EdgesToRoutes.get_Item$$TKey(n).GetEnumerator();u.MoveNext();)i=u.get_Current(),Microsoft.Msagl.Core.Geometry.Point.op_Equality(i.get_SourcePoint(),r.get_Point())?(t.AddPoint$$Point(i.get_TargetPoint()),r=i.Target):(t.AddPoint$$Point(i.get_SourcePoint()),r=i.Source);n.set_Curve(t);f=As(n.get_SourcePort(),Microsoft.Msagl.Routing.ClusterBoundaryPort.ctor);f!=null&&Microsoft.Msagl.Routing.Spline.Bundling.SdShortestPath.ExtendPolylineStartToClusterBoundary(t,f.get_Curve());e=As(n.get_TargetPort(),Microsoft.Msagl.Routing.ClusterBoundaryPort.ctor);e!=null&&Microsoft.Msagl.Routing.Spline.Bundling.SdShortestPath.ExtendPolylineEndToClusterBoundary(t,e.get_Curve())},RerouteEdges:function(){var r;this.RestoreCapacities();for(var n=0,t=this.get_EdgeGeometries(),u=t.length,i=t[n];n<u;n++,i=t[n])r=this.RerouteEdge(i),this.EdgesToRoutes.set_Item$$TKey(i,r)},RestoreCapacities:function(){this.get_Cdt()!=null&&this.get_Cdt().RestoreEdgeCapacities()},RerouteEdge:function(n){for(var r=this.EdgesToRoutes.get_Item$$TKey(n),t=r.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),i.RemoveOccupiedEdge();return this.RouteEdge(n)},RouteEdge:function(n){var t,i,u;for(this.CurrentEdgeGeometry=n,t=0;t<this.vertexArray.length;t++)i=this.vertexArray[t],i.SetPreviousToNull(),i.set_IsSourceOfRouting(function(n){return i.set_IsTargetOfRouting(n),n}.call(this,!1));for(var f=this.get_MakeTransparentShapesOfEdgeGeometry()(n),e=this.RouteEdgeWithGroups(),r=f.GetEnumerator();r.MoveNext();)u=r.get_Current(),u.set_IsTransparent(!1);return e},RouteEdgeWithGroups:function(){for(var i,t,n=0;n<2;n++){if(this.SetLengthCoefficient(),this.Queue=new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.SdVertex.ctor),function(){var n={Value:this.sourceLoosePoly},t=this.SetPortVerticesAndObstacles(this.CurrentEdgeGeometry.get_SourcePort(),!0,n);return this.sourceLoosePoly=n.Value,t}.call(this),function(){var n={Value:this.targetLoosePoly},t=this.SetPortVerticesAndObstacles(this.CurrentEdgeGeometry.get_TargetPort(),!1,n);return this.targetLoosePoly=n.Value,t}.call(this),i=this.RouteOnKnownSourceTargetVertices(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.CurrentEdgeGeometry.get_TargetPort().get_Location(),this.CurrentEdgeGeometry.get_SourcePort().get_Location()).Normalize(),n==0),i!=null)return i;for(t=0;t<this.vertexArray.length;t++)this.vertexArray[t].SetPreviousToNull()}throw $CreateException(new System.InvalidOperationException.ctor,new Error);},RouteOnKnownSourceTargetVertices:function(n,t){var u,r,f,i,e;for(this.LowestCostToTarget=Infinity,this.ClosestTargetVertex=null;this.Queue.get_Count()>0;)if(r=function(){var n={Value:u},t=this.Queue.Dequeue$$Double(n);return u=n.Value,t}.call(this),!(u>=this.LowestCostToTarget)){for(i=0;i<r.OutBoneEdges.get_Count();i++)f=r.OutBoneEdges.get_Item$$Int32(i),f.get_IsPassable()&&this.ProcessOutcomingBoneEdge(r,f,n,t);for(i=0;i<r.InBoneEdges.get_Count();i++)e=r.InBoneEdges.get_Item$$Int32(i),e.get_IsPassable()&&this.ProcessIncomingBoneEdge(r,e,n,t)}return this.GetPathAndUpdateRelatedCosts()},ProcessOutcomingBoneEdge:function(n,t,i,r){(System.Diagnostics.Debug.Assert$$Boolean(n==t.Source),r&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(i,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_TargetPoint(),t.get_SourcePoint()))<0)||this.ProcessBoneEdge(n,t.Target,t)},ProcessIncomingBoneEdge:function(n,t,i,r){(System.Diagnostics.Debug.Assert$$Boolean(n==t.Target),r&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(i,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_SourcePoint(),t.get_TargetPoint()))<0)||this.ProcessBoneEdge(n,t.Source,t)},ProcessBoneEdge:function(n,t,i){var r=this.GetEdgeAdditionalCost(i,n.get_Cost()),u;if(!(t.get_Cost()<=r))if(t.set_Cost(r),t.set_PrevEdge(i),this.Queue.ContainsElement(t))this.Queue.DecreasePriority(t,r);else{if(t.get_IsTargetOfRouting()){u=0;Is(this.CurrentEdgeGeometry.get_TargetPort(),Microsoft.Msagl.Routing.ClusterBoundaryPort.ctor)&&(u=this.LengthCoefficient*Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),this.CurrentEdgeGeometry.get_TargetPort().get_Location()).get_Length());r+u<this.LowestCostToTarget&&(this.LowestCostToTarget=r+u,this.ClosestTargetVertex=t);return}this.Enqueue(t)}},GetPathAndUpdateRelatedCosts:function(){var n=this.ClosestTargetVertex,t;if(n==null)return null;for(t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.SdBoneEdge.ctor);n.get_PrevEdge()!=null;)t.Add(n.get_PrevEdge()),this.RegisterPathInBoneEdge(n.get_PrevEdge()),n=n.get_Prev();return this.EdgesToRouteSources.set_Item$$TKey(this.CurrentEdgeGeometry,n),t.Reverse(),System.Diagnostics.Debug.Assert$$Boolean(t.get_Count()>0),t},RegisterPathInBoneEdge:function(n){n.AddOccupiedEdge();this.get_Cdt()!=null&&this.get_BundlingSettings().get_CapacityOverflowCoefficient()!=0&&this.UpdateResidualCostsOfCrossedCdtEdges(n)},UpdateResidualCostsOfCrossedCdtEdges:function(n){for(var i=n.get_CrossedCdtEdges().GetEnumerator(),t;i.MoveNext();)(t=i.get_Current(),this.AdjacentToSourceOrTarget(t))||(t.get_ResidualCapacity()==t.Capacity?t.set_ResidualCapacity(t.get_ResidualCapacity()-this.CurrentEdgeGeometry.get_LineWidth()):t.set_ResidualCapacity(t.get_ResidualCapacity()-(this.CurrentEdgeGeometry.get_LineWidth()+this.get_BundlingSettings().get_EdgeSeparation())))},H:function(n){return n.get_Cost()+this.LengthCoefficient*Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Point(),this.CurrentEdgeGeometry.get_TargetPort().get_Location()).get_Length()},GetEdgeAdditionalCost:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_TargetPoint(),n.get_SourcePoint()).get_Length();return this.LengthCoefficient*i+t+(n.get_IsOccupied()?0:this.get_BundlingSettings().get_InkImportance()*i)+this.CapacityOverflowCost(n)},CapacityOverflowCost:function(n){var t,i,r;if(this.get_Cdt()==null||this.get_BundlingSettings().get_CapacityOverflowCoefficient()==0)return 0;for(t=0,i=this.CrossedCdtEdgesOfBoneEdge(n).GetEnumerator();i.MoveNext();)r=i.get_Current(),t+=this.CostOfCrossingCdtEdgeLocal(this.capacityOverlowPenaltyMultiplier,this.get_BundlingSettings(),this.CurrentEdgeGeometry,r);return t},CrossedCdtEdgesOfBoneEdge:function(n){return Microsoft.Msagl.Core.DataStructures.Set$1.op_Inequality(n.get_CrossedCdtEdges(),null)?n.get_CrossedCdtEdges():(n.set_CrossedCdtEdges(this.ThreadBoneEdgeThroughCdt(n)),n.get_CrossedCdtEdges())},ThreadBoneEdgeThroughCdt:function(n){var e=n.get_SourcePoint(),r=n.Source.Triangle,t,u,f,i;if(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.PointIsInsideOfTriangle(e,r)),t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.CdtEdge.ctor),u=n.get_TargetPoint(),Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.PointIsInsideOfTriangle(u,r))return t;for(f=new Microsoft.Msagl.Routing.Spline.Bundling.CdtThreader.ctor(r,e,u);f.MoveNext();)i=f.get_CurrentPiercedEdge(),System.Diagnostics.Debug.Assert$$Boolean(i!=null),this.get_Gates().Contains$$T(i)&&t.Insert(i);return t},CostOfCrossingCdtEdgeLocal:function(n,t,i,r){return this.AdjacentToSourceOrTarget(r)?0:Microsoft.Msagl.Routing.Spline.Bundling.SdShortestPath.CostOfCrossingCdtEdge(n,t,i,r)},AdjacentToSourceOrTarget:function(n){return n.upperSite.get_Owner()==this.sourceLoosePoly||n.lowerSite.get_Owner()==this.sourceLoosePoly||n.upperSite.get_Owner()==this.targetLoosePoly||n.lowerSite.get_Owner()==this.targetLoosePoly},SetLengthCoefficient:function(){var n=this.GetIdealDistanceBetweenSourceAndTarget(this.CurrentEdgeGeometry);this.LengthCoefficient=this.get_BundlingSettings().get_PathLengthImportance()/n},GetIdealDistanceBetweenSourceAndTarget:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_SourcePort().get_Location(),n.get_TargetPort().get_Location()).get_Length()},SetPortVerticesAndObstacles:function(n,t,i){var e,o,s,h,c,r,u,l,f,a,v;if(i.Value=null,e=As(n,Microsoft.Msagl.Routing.ClusterBoundaryPort.ctor),e!=null)for(i.Value=e.get_LoosePolyline(),o=i.Value.GetEnumerator();o.MoveNext();)r=o.get_Current(),s=0,t&&(s=this.LengthCoefficient*Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,this.CurrentEdgeGeometry.get_SourcePort().get_Location()).get_Length()),this.AddAndEnqueueVertexToEnds(r,t,s);else if(h=As(n,Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor),h!=null)for(i.Value=h.get_LoosePolyline(),c=i.Value.GetEnumerator();c.MoveNext();)r=c.get_Current(),this.AddAndEnqueueVertexToEnds(r,t,0);else for(this.AddAndEnqueueVertexToEnds(n.get_Location(),t,0),u=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.get_ObstacleHierarchy().GetNodeItemsIntersectingRectangle(n.get_Curve().get_BoundingBox())),l=u[0].get_BoundingBox().get_Diagonal(),i.Value=u[0],f=1;f<u.length;f++)a=u[f],v=a.get_BoundingBox().get_Diagonal(),v<l&&(l=v,i.Value=a)},Enqueue:function(n){this.Queue.Enqueue(n,this.H(n))},AddAndEnqueueVertexToEnds:function(n,t,i){var u=this.FindVertex(n),r=this.VisibilityVerticesToSdVerts.get_Item$$TKey(u);t?(r.set_IsSourceOfRouting(!0),r.set_Cost(i),this.Enqueue(r)):r.set_IsTargetOfRouting(!0)},FindVertex:function(n){return this.get_VisibilityGraph().FindVertex(n)!=null?this.get_VisibilityGraph().FindVertex(n):this.get_VisibilityGraph().FindVertex(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n))},Initialize:function(){this.CreateRoutingGraph();this.get_Cdt()!=null&&(this.capacityOverlowPenaltyMultiplier=Microsoft.Msagl.Routing.Spline.Bundling.SdShortestPath.CapacityOverflowPenaltyMultiplier(this.get_BundlingSettings()),this.SetVertexTriangles(),this.CalculateCapacitiesOfTrianglulation())},CalculateCapacitiesOfTrianglulation:function(){for(var n=this.get_Gates().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),Microsoft.Msagl.Routing.Spline.Bundling.SdShortestPath.CalculateCdtEdgeCapacityForEdge(t)},SetVertexTriangles:function(){var r=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,this.get_Cdt().GetTriangles(),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor,n,n.BoundingBox())}))),u=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Spline.Bundling.SdVertex.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,this.vertexArray,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Routing.Spline.Bundling.SdVertex.ctor,n,new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(n.get_Point()))})));Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$2$$RectangleNode$1$$RectangleNode$1$$Action$2(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor,Microsoft.Msagl.Routing.Spline.Bundling.SdVertex.ctor,r,u,$CreateDelegate(this,this.TryToAssigenTriangleToVertex));for(var n=0,t=this.vertexArray,f=t.length,i=t[n];n<f;n++,i=t[n])System.Diagnostics.Debug.Assert$$Boolean(i.Triangle!=null)},TryToAssigenTriangleToVertex:function(n,t){t.Triangle==null&&Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.PointIsInsideOfTriangle(t.get_Point(),n)&&(t.Triangle=n)},FillCrossedCdtEdges:function(n){for(var u,o,f,e,i=0,r=this.get_EdgeGeometries(),s=r.length,t=r[i];i<s;i++,t=r[i])for(function(){var n={Value:this.sourceLoosePoly},i=this.SetPortVerticesAndObstacles(t.get_SourcePort(),!0,n);return this.sourceLoosePoly=n.Value,i}.call(this),function(){var n={Value:this.targetLoosePoly},i=this.SetPortVerticesAndObstacles(t.get_TargetPort(),!1,n);return this.targetLoosePoly=n.Value,i}.call(this),u=this.EdgesToRoutes.get_Item$$TKey(t).GetEnumerator();u.MoveNext();)for(o=u.get_Current(),f=this.CrossedCdtEdgesOfBoneEdge(o).GetEnumerator();f.MoveNext();)(e=f.get_Current(),this.AdjacentToSourceOrTarget(e))||Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.CdtEdge.ctor,Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor,n,t,e)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$SdShortestPath);Microsoft$Msagl$Routing$SingleSourceMultipleTargetsShortestPathOnVisibilityGraph={fullname:"Microsoft.Msagl.Routing.SingleSourceMultipleTargetsShortestPathOnVisibilityGraph",baseTypeName:"System.Object",staticDefinition:{IsForbidden:function(n){return n.get_IsPassable()!=null&&!n.get_IsPassable()()||Is(n,Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){var r,u;for(this.source=null,this.targets=null,this.current=null,this.closestTarget=null,this.upperBound=Infinity,this._visGraph=null,System.Object.ctor.call(this),this._visGraph=i,this._visGraph.ClearPrevEdgesTable(),r=i.Vertices().GetEnumerator();r.MoveNext();)u=r.get_Current(),u.set_Distance(Infinity);this.source=n;this.targets=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,t);this.source.set_Distance(0)},GetPath:function(){var t=new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor),i,r,n;for(this.source.set_Distance(0),t.Enqueue(this.source,0);!t.IsEmpty();){if(this.current=t.Dequeue(),this.targets.Contains$$T(this.current))break;for(i=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,this.current.get_OutEdges(),$CreateDelegate(this,this.PassableOutEdge)).GetEnumerator();i.MoveNext();)n=i.get_Current(),this.ProcessNeighbor(t,n,n.get_Target());for(r=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,this.current.get_InEdges(),$CreateDelegate(this,this.PassableInEdge)).GetEnumerator();r.MoveNext();)n=r.get_Current(),this.ProcessNeighbor(t,n,n.get_Source())}return this._visGraph.PreviosVertex(this.current)==null?null:this.CalculatePath()},PassableOutEdge:function(n){return n.get_Source()==this.source||this.targets.Contains$$T(n.get_Target())||!Microsoft.Msagl.Routing.SingleSourceMultipleTargetsShortestPathOnVisibilityGraph.IsForbidden(n)},PassableInEdge:function(n){return this.targets.Contains$$T(n.get_Source())||n.get_Target()==this.source||!Microsoft.Msagl.Routing.SingleSourceMultipleTargetsShortestPathOnVisibilityGraph.IsForbidden(n)},ProcessNeighbor:function(n,t,i){var u=t.get_Length(),r=this.current.get_Distance()+u;r>=this.upperBound||(this.targets.Contains$$T(i)&&(this.upperBound=r,this.closestTarget=i),i!=this.source&&this._visGraph.PreviosVertex(i)==null?(i.set_Distance(r),this._visGraph.SetPreviousEdge(i,t),n.Enqueue(i,r)):r<i.get_Distance()&&(i.set_Distance(r),this._visGraph.SetPreviousEdge(i,t),n.DecreasePriority(i,r)))},CalculatePath:function(){if(this.closestTarget==null)return null;var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor),t=this.closestTarget;do n.Add(t),t=this._visGraph.PreviosVertex(t);while(t!=this.source);return n.Add(this.source),n.Reverse(),n}}};JsTypes.push(Microsoft$Msagl$Routing$SingleSourceMultipleTargetsShortestPathOnVisibilityGraph);Microsoft$Msagl$Routing$Spline$Bundling$BundleBase={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.BundleBase",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this.OutgoingBundleInfo=null;this.IncomingBundleInfo=null;this.points=null;this.tangents=null;this.OrientedHubSegments=null;this.Curve=null;this.IsParent=!1;this.BelongsToRealNode=!1;this.Position=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.stationIndex=0;this.initialMidParameter=0;this.parRight=0;this.parLeft=0;this.Prev=null;this.Next=null;this.ParameterSpan=0;this._InitialMidPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._RightPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._LeftPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.BelongsToRealNode=r;this.Curve=t;this.Position=i;this.stationIndex=u;this.points=new Array(n);this.tangents=new Array(n);this.OrientedHubSegments=new Array(n);this.ParameterSpan=this.Curve.get_ParEnd()-this.Curve.get_ParStart()},CurveCenter$$:"Microsoft.Msagl.Core.Geometry.Point",get_CurveCenter:function(){return this.Curve.get_BoundingBox().get_Center()},OppositeBase$$:"Microsoft.Msagl.Routing.Spline.Bundling.BundleBase",get_OppositeBase:function(){return this.OutgoingBundleInfo!=null?this.OutgoingBundleInfo.TargetBase:this.IncomingBundleInfo.SourceBase},Count$$:"System.Int32",get_Count:function(){return this.points.length},Points$$:"Microsoft.Msagl.Core.Geometry.Point[]",get_Points:function(){return this.points},Tangents$$:"Microsoft.Msagl.Core.Geometry.Point[]",get_Tangents:function(){return this.tangents},InitialMidParameter$$:"System.Double",get_InitialMidParameter:function(){return this.initialMidParameter},set_InitialMidParameter:function(n){this.initialMidParameter=n;this.set_InitialMidPoint(this.Curve.get_Item$$Double(n))},InitialMidPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_InitialMidPoint:function(){return this._InitialMidPoint},set_InitialMidPoint:function(n){this._InitialMidPoint=n},ParRight$$:"System.Double",get_ParRight:function(){return this.parRight},set_ParRight:function(n){this.parRight=n;this.set_RightPoint(this.Curve.get_Item$$Double(this.parRight))},ParLeft$$:"System.Double",get_ParLeft:function(){return this.parLeft},set_ParLeft:function(n){this.parLeft=n;this.set_LeftPoint(this.Curve.get_Item$$Double(this.parLeft))},ParMid$$:"System.Double",get_ParMid:function(){return(this.parRight+this.parLeft)/2},RightPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_RightPoint:function(){return this._RightPoint},set_RightPoint:function(n){this._RightPoint=n},LeftPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_LeftPoint:function(){return this._LeftPoint},set_LeftPoint:function(n){this._LeftPoint=n},MidPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_MidPoint:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_RightPoint(),this.get_LeftPoint()),2)},Span$$:"System.Double",get_Span:function(){return this.SpanBetweenTwoPoints(this.parRight,this.parLeft)},SpanBetweenTwoPoints:function(n,t){return n<=t?t-n:t-n+this.ParameterSpan},RotateLeftPoint:function(n,t){return n==0?this.get_LeftPoint():this.RotatePoint(n,this.parLeft,t)},RotateRigthPoint:function(n,t){return n==0?this.get_RightPoint():this.RotatePoint(n,this.parRight,t)},RotatePoint:function(n,t,i){var r=this.ParameterSpan*i;return t=t+n*r,t=this.AdjustParam(t),this.Curve.get_Item$$Double(t)},AdjustParam:function(n){return n>this.Curve.get_ParEnd()?n=this.Curve.get_ParStart()+(n-this.Curve.get_ParEnd()):n<this.Curve.get_ParStart()&&(n=this.Curve.get_ParEnd()-(this.Curve.get_ParStart()-n)),n},RotateBy:function(n,t,i){var r=this.ParameterSpan*i;n!=0&&this.set_ParRight(this.AdjustParam(this.get_ParRight()+n*r));t!=0&&this.set_ParLeft(this.AdjustParam(this.get_ParLeft()+t*r))},Intersect$$BundleBase:function(n){return this.Intersect$$Double$$Double$$Double$$Double(this.parRight,this.parLeft,n.parRight,n.parLeft)},Intersect$$Double$$Double$$Double$$Double:function(n,t,i,r){return n>t?this.Intersect$$Double$$Double$$Double$$Double(n,this.Curve.get_ParEnd(),i,r)||this.Intersect$$Double$$Double$$Double$$Double(this.Curve.get_ParStart(),t,i,r):i>r?this.Intersect$$Double$$Double$$Double$$Double(n,t,i,this.Curve.get_ParEnd())||this.Intersect$$Double$$Double$$Double$$Double(n,t,this.Curve.get_ParStart(),r):(System.Diagnostics.Debug.Assert$$Boolean(n<=t),System.Diagnostics.Debug.Assert$$Boolean(i<=r),Microsoft.Msagl.Core.Geometry.ApproximateComparer.LessOrEqual(t,i))?!1:Microsoft.Msagl.Core.Geometry.ApproximateComparer.LessOrEqual(r,n)?!1:!0},RelativeOrderOfBasesIsPreserved:function(n,t,i){var r=this.ParameterSpan*i,u=this.parRight+n*r,f=this.parRight<this.parLeft?this.parLeft+t*r:this.parLeft+this.ParameterSpan+t*r;if(u>f||this.SpanBetweenTwoPoints(u,f)>this.ParameterSpan/2)return!1;if(this.Prev==null||this.SpanBetweenTwoPoints(this.Prev.get_ParMid(),this.get_ParMid())>r&&this.SpanBetweenTwoPoints(this.get_ParMid(),this.Next.get_ParMid())>r)return!0;var s=this.RotateLeftPoint(t,i),h=this.RotateRigthPoint(n,i),e=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(s,h),2),o=this.get_MidPoint();return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.get_CurveCenter(),this.Prev.get_MidPoint(),o)!=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.get_CurveCenter(),this.Prev.get_MidPoint(),e)?!1:Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.get_CurveCenter(),this.Next.get_MidPoint(),o)!=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.get_CurveCenter(),this.Next.get_MidPoint(),e)?!1:!0}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$BundleBase);Microsoft$Msagl$Routing$Spline$Bundling$BundleBasesCalculator={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas=[new Int32Array([1,1]),new Int32Array([0,1]),new Int32Array([-1,1]),new Int32Array([1,0]),new Int32Array([-1,0]),new Int32Array([1,-1]),new Int32Array([0,-1]),new Int32Array([-1,-1]),new Int32Array([0,0])];Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.SeparationCoeff=1;Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.SqueezeCoeff=1;Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.CenterCoeff=10;Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.AssymetryCoeff=1;Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.MaxIterations=200;Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.MaxParameterChange=.0222222222222222;Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.MinParameterChange=.000277777777777778;Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.CostThreshold=1e-5;Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.CostDeltaThreshold=.01}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.metroOrdering=null;this.metroGraphData=null;this.bundlingSettings=null;this.Bundles=null;this.externalBases=null;this.internalBases=null;this.fixedBundles=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.BundleInfo.ctor);this.stepsWithProgress=0;System.Object.ctor.call(this);this.metroOrdering=n;this.metroGraphData=t;this.bundlingSettings=i},Run:function(){this.AllocateBundleBases();this.SetBasesRightLeftParamsToTheMiddles();this.bundlingSettings.get_KeepOverlaps()?(this.UpdateSourceAndTargetBases(),this.CreateOrientedSegs()):(this.SetRightLeftParamsFeasiblySymmetrically(),this.AdjustStartEndParamsToAvoidBaseOverlaps(),this.UpdateSourceAndTargetBases(),this.CreateOrientedSegs(),this.Optimize(),this.AdjustStartEndParamsToAvoidBaseOverlaps(),this.UpdateSourceAndTargetBases())},AllocateBundleBases:function(){var f,e,n,i,r,h,s;for(this.externalBases=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Collections.Generic.List$1.ctor),this.internalBases=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Collections.Generic.List$1.ctor),this.Bundles=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.BundleInfo.ctor),f=this.metroGraphData.Stations.GetEnumerator();f.MoveNext();)n=f.get_Current(),n.BoundaryCurve==null&&(n.BoundaryCurve=new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point(n.Radius,n.Radius,n.Position));for(e=this.metroGraphData.Stations.GetEnumerator();e.MoveNext();){n=e.get_Current();for(var u=0,o=n.Neighbors,c=o.length,t=o[u];u<c;u++,t=o[u])Microsoft.Msagl.Routing.Spline.Bundling.Station.op_LessThan(n,t)&&(i=new Microsoft.Msagl.Routing.Spline.Bundling.BundleBase.ctor(this.metroGraphData.RealEdgeCount(n,t),n.BoundaryCurve,n.Position,n.IsRealNode,t.SerialNumber),n.BundleBases.set_Item$$TKey(t,i),r=new Microsoft.Msagl.Routing.Spline.Bundling.BundleBase.ctor(this.metroGraphData.RealEdgeCount(n,t),t.BoundaryCurve,t.Position,t.IsRealNode,n.SerialNumber),t.BundleBases.set_Item$$TKey(n,r),Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t.Position,n.BoundaryCurve)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside?(i.IsParent=!0,Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.BundleBase.ctor,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Collections.Generic.List$1.ctor,this.internalBases,n.BoundaryCurve,i),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.BundleBase.ctor,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Collections.Generic.List$1.ctor,this.externalBases,t.BoundaryCurve,r)):Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n.Position,t.BoundaryCurve)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside?(r.IsParent=!0,Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.BundleBase.ctor,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Collections.Generic.List$1.ctor,this.externalBases,n.BoundaryCurve,i),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.BundleBase.ctor,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Collections.Generic.List$1.ctor,this.internalBases,t.BoundaryCurve,r)):(Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.BundleBase.ctor,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Collections.Generic.List$1.ctor,this.externalBases,n.BoundaryCurve,i),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.BundleBase.ctor,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Collections.Generic.List$1.ctor,this.externalBases,t.BoundaryCurve,r)),h=this.metroGraphData.tightIntersections.ObstaclesToIgnoreForBundle(n,t),s=new Microsoft.Msagl.Routing.Spline.Bundling.BundleInfo.ctor(i,r,h,this.bundlingSettings.get_EdgeSeparation(),System.Linq.Enumerable.ToArray$1(System.Double.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor,System.Double.ctor,this.metroOrdering.GetOrder(n,t),$CreateAnonymousDelegate(this,function(n){return n.Width/2})))),i.OutgoingBundleInfo=r.IncomingBundleInfo=s,this.Bundles.Add(s))}this.SetBundleBaseNeighbors()},SetBundleBaseNeighbors:function(){for(var r=this.externalBases.get_Keys().GetEnumerator(),i,t,n;r.MoveNext();)t=r.get_Current(),n=this.externalBases.get_Item$$TKey(t),this.SortBundlesCounterClockwise(n),this.SetLeftRightBases(n);for(i=this.internalBases.get_Keys().GetEnumerator();i.MoveNext();)t=i.get_Current(),n=this.internalBases.get_Item$$TKey(t),this.SortBundlesCounterClockwise(n),this.SetLeftRightBases(n)},SortBundlesCounterClockwise:function(n){if(n.get_Count()>2){var i=n.get_Item$$Int32(0).get_OppositeBase().Position,t=n.get_Item$$Int32(0).get_CurveCenter();n.Sort$$Comparison$1($CreateAnonymousDelegate(this,function(n,r){return Microsoft.Msagl.Core.Geometry.Point.GetOrientationOf3Vectors(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_OppositeBase().Position,t),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r.get_OppositeBase().Position,t))}))}},SetLeftRightBases:function(n){var i=n.get_Count(),t;if(!(i<=1))for(t=0;t<i;t++)n.get_Item$$Int32(t).Prev=n.get_Item$$Int32((t-1+i)%i),n.get_Item$$Int32(t).Next=n.get_Item$$Int32((t+1)%i)},CreateOrientedSegs:function(){for(var n=this.metroGraphData.get_Metrolines().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.CreateOrientedSegsOnLine(t)},CreateOrientedSegsOnLine:function(n){for(var t=n.get_Polyline().get_StartPoint().get_Next();t.get_Next()!=null;t=t.get_Next())this.CreateOrientedSegsOnLineVertex(n,t)},CreateOrientedSegsOnLineVertex:function(n,t){var r=this.metroGraphData.PointToStations.get_Item$$TKey(t.get_Prev().get_Point()),i=this.metroGraphData.PointToStations.get_Item$$TKey(t.get_Point()),u=this.metroGraphData.PointToStations.get_Item$$TKey(t.get_Next().get_Point()),f=i.BundleBases.get_Item$$TKey(r),e=i.BundleBases.get_Item$$TKey(u),o=this.metroOrdering.GetLineIndexInOrder(r,i,n),s=this.metroOrdering.GetLineIndexInOrder(u,i,n),h=f.OrientedHubSegments[o]=new Microsoft.Msagl.Routing.Spline.Bundling.OrientedHubSegment.ctor(null,!1,o,f),c=e.OrientedHubSegments[s]=new Microsoft.Msagl.Routing.Spline.Bundling.OrientedHubSegment.ctor(null,!0,s,e);c.set_Other(h);h.set_Other(c)},UpdateSourceAndTargetBases:function(){for(var n=this.Bundles.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.UpdateSourceAndTargetBases(!0,!0)},SetBasesRightLeftParamsToTheMiddles:function(){for(var i=this.Bundles.GetEnumerator();i.MoveNext();){var r=i.get_Current(),n=r.SourceBase,t=r.TargetBase;n.set_ParRight(function(t){return n.set_ParLeft(t),t}.call(this,this.GetBaseMiddleParamInDirection(n,n.Position,t.Position)));t.set_ParRight(function(n){return t.set_ParLeft(n),n}.call(this,this.GetBaseMiddleParamInDirection(t,t.Position,n.Position)))}},GetBaseMiddleParamInDirection:function(n,t,i){var o=n.Curve,r=As(o,Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor),s,u,f,e;if(r!=null&&r.IsArc())return Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(r.get_AxisA(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t));for(s=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(o,new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t,i),!0),u=s.GetEnumerator();u.MoveNext();)if(f=u.get_Current(),e=f.get_IntersectionPoint(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,t),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,i))<=0)return f.get_Par0();throw $CreateException(new System.InvalidOperationException.ctor,new Error);},SetRightLeftParamsFeasiblySymmetrically:function(){for(var n=this.Bundles.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.SetParamsFeasiblySymmetrically(this.metroGraphData.get_TightTree())},AdjustStartEndParamsToAvoidBaseOverlaps:function(){for(var i=this.externalBases.get_Keys().GetEnumerator(),t,n;i.MoveNext();)n=i.get_Current(),this.AdjustCurrentBundleWidthsOnCurve(this.externalBases.get_Item$$TKey(n));for(t=this.internalBases.get_Keys().GetEnumerator();t.MoveNext();)n=t.get_Current(),this.AdjustCurrentBundleWidthsOnCurve(this.internalBases.get_Item$$TKey(n))},AdjustCurrentBundleWidthsOnCurve:function(n){var u=n.get_Count(),t,i,r;if(!(u<=1))for(t=0;t<u;t++)i=n.get_Item$$Int32(t),r=i.Next,this.ShrinkBasesToMakeTwoConsecutiveNeighborsHappy(i,r),System.Diagnostics.Debug.Assert$$Boolean(!i.Intersect$$BundleBase(r))},ShrinkBasesToMakeTwoConsecutiveNeighborsHappy:function(n,t){var e,s;if(n.Intersect$$BundleBase(t)){var i=n.get_ParRight(),u=n.get_ParLeft(),r=t.get_ParRight(),f=t.get_ParLeft(),o=t.ParameterSpan;i>u&&(i-=o);r>f&&(r-=o);r>u&&(r-=o,f-=o);i>f&&(i-=o,u-=o);System.Diagnostics.Debug.Assert$$Boolean(!(r>=u)&&!(i>=f));e=this.RegularCut(i,u,r,f,n.get_Span(),t.get_Span());s=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_CurveCenter(),t.get_OppositeBase().get_InitialMidPoint(),n.get_OppositeBase().get_InitialMidPoint());s==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise?(u=e,r=e):s==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise?(f=e,i=e):f-i>=u-r?(u=e,r=e):(f=e,i=e);System.Diagnostics.Debug.Assert$$Boolean(!n.Intersect$$Double$$Double$$Double$$Double(i,u,r,f));t.set_ParRight(t.AdjustParam(r));t.set_ParLeft(t.AdjustParam(f));n.set_ParRight(n.AdjustParam(i));n.set_ParLeft(n.AdjustParam(u))}},RegularCut:function(n,t,i,r,u,f){var e=(u*r+f*n)/(u+f),o=System.Math.Min$$Double$$Double(t,r),s=System.Math.Max$$Double$$Double(n,i);return System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.LessOrEqual(s,e)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.LessOrEqual(e,o)),e<s&&(e=s),e>o&&(e=o),e},Optimize:function(){for(var n=.0222222222222222,t=this.Cost(),i=0,r;i++<200;){if(r=t,function(){var i={Value:t},r=this.OptimizeBundles(n,i);return t=i.Value,r}.call(this),n=this.UpdateParameterChange(n,r,t),n<.000277777777777778)break;i%10==0}},UpdateParameterChange:function(n,t,i){return i+1<t?(this.stepsWithProgress++,this.stepsWithProgress>=5&&(this.stepsWithProgress=0,this.fixedBundles.Clear())):(this.stepsWithProgress=0,n*=.8,this.fixedBundles.Clear()),n},OptimizeBundles:function(n,t){for(var r=!1,u=this.Bundles.GetEnumerator(),i;u.MoveNext();)(i=u.get_Current(),this.fixedBundles.Contains(i))||(this.OptimizeBundle(i,n,t)?r=!0:this.fixedBundles.Add(i));return r},OptimizeBundle:function(n,t,i){var s=this.Cost$$BundleInfo(n),r,u;if(s<1e-5)return!1;var f=0,e=-1,o=-1;for(r=0;r<Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas.length-1;r++)u=this.DeltaWithChangedAngles(Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas[r][0],Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas[r][1],0,0,n,s,t),u>.01&&u>f&&(e=r,o=Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas.length-1,f=u),u=this.DeltaWithChangedAngles(0,0,Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas[r][0],Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas[r][1],n,s,t),u>.01&&u>f&&(e=Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas.length-1,o=r,f=u);return f<.01?!1:(i.Value-=f,n.RotateBy(Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas[e][0],Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas[e][1],Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas[o][0],Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.Deltas[o][1],t),!0)},DeltaWithChangedAngles:function(n,t,i,r,u,f,e){if(!u.RotationIsLegal(n,t,i,r,e))return 0;u.RotateBy(n,t,i,r,e);var o=this.Cost$$BundleInfo$$Double(u,f);return u.RotateBy(-n,-t,-i,-r,e),f-o},Cost$$BundleInfo:function(n){return 1*this.SeparationCost(n)+1*this.SqueezeCost(n)+1*this.AssymetryCost(n)+10*this.CenterCost$$BundleInfo(n)},Cost$$BundleInfo$$Double:function(n,t){var i=0;return(i+=10*this.CenterCost$$BundleInfo(n),i>t)?i:(i+=1*this.SeparationCost(n),i>t)?i:(i+=1*this.SqueezeCost(n),i>t)?i:i+1*this.AssymetryCost(n)},SqueezeCost:function(n){var u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.TargetBase.get_MidPoint(),n.SourceBase.get_MidPoint()).Normalize(),t=u.Rotate90Ccw(),i=System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.SourceBase.get_RightPoint(),n.SourceBase.get_LeftPoint()),t)),r=System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.TargetBase.get_RightPoint(),n.TargetBase.get_LeftPoint()),t)),f=System.Math.Abs$$Double(n.TotalRequiredWidth-i)/n.TotalRequiredWidth,e=System.Math.Abs$$Double(n.TotalRequiredWidth-r)/n.TotalRequiredWidth,o=System.Math.Abs$$Double(i-r)/n.TotalRequiredWidth,s=System.Math.Exp(f*10)-1+System.Math.Exp(e*10)-1;return s+o},CenterCost$$BundleInfo:function(n){return!n.SourceBase.BelongsToRealNode&&!n.TargetBase.BelongsToRealNode?0:this.CenterCost$$BundleBase(n.SourceBase)+this.CenterCost$$BundleBase(n.TargetBase)},CenterCost$$BundleBase:function(n){if(!n.BelongsToRealNode)return 0;var i=n.get_ParMid(),r=System.Math.Min$$Double$$Double(n.get_InitialMidParameter(),i),u=System.Math.Max$$Double$$Double(n.get_InitialMidParameter(),i),t=System.Math.Min$$Double$$Double(u-r,r+n.ParameterSpan-u);return Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_CurveCenter(),n.Position)||n.IsParent?25*t*t:500*t*t},AssymetryCost:function(n){return this.GetAssymetryCostForBase(n.SourceBase)+this.GetAssymetryCostForBase(n.TargetBase)},GetAssymetryCostForBase:function(n){var e,r;if(n.BelongsToRealNode)return 0;e=n.get_OppositeBase().BelongsToRealNode?200:500;r=0;for(var t=0,u=n.OrientedHubSegments,h=u.length,i=u[t];t<h;t++,i=u[t]){var o=i.Index,s=i.get_Other().Index,c=n.get_Points()[o],l=n.get_Tangents()[o],f=i.get_Other().BundleBase,a=f.get_Points()[s],v=f.get_Tangents()[s],y=n.get_Count()+f.get_Count();r+=this.GetAssymetryCostOnData(c,l,a,v,e)/y}return r},GetAssymetryCostOnData:function(n,t,i,r,u){var f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,i),s=f.get_Length();if(s<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return 0;f=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(f,s);var h=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,r),f),e=Microsoft.Msagl.Core.Geometry.Point.CrossProduct(f,t),o=Microsoft.Msagl.Core.Geometry.Point.CrossProduct(f,r),c=e-o,l=h*h+c*c,a=e*e+o*o;return 10*l+u*a},SeparationCost:function(n){return this.SeparationCostForBundleBase(n.SourceBase)+this.SeparationCostForBundleBase(n.TargetBase)},SeparationCostForBundleBase:function(n){return n.Prev==null?0:this.SeparationCostForAdjacentBundleBases(n,n.Prev)+this.SeparationCostForAdjacentBundleBases(n,n.Next)},SeparationCostForAdjacentBundleBases:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(n.Curve==t.Curve);var u=n.Curve,r=this.IntervalsOverlapLength(n.get_ParRight(),n.get_ParLeft(),t.get_ParRight(),t.get_ParLeft(),u),i=System.Math.Min$$Double$$Double(n.get_Span(),t.get_Span());return System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.LessOrEqual(r,i)),System.Diagnostics.Debug.Assert$$Boolean(i>0),System.Math.Exp(r/i*10)-1},IntervalsOverlapLength:function(n,t,i,r,u){var f=u.get_ParStart(),e=u.get_ParEnd();return n<t?i<r?this.IntersectRegularIntervals(n,t,i,r):this.IntersectRegularIntervals(n,t,i,e)+this.IntersectRegularIntervals(n,t,f,r):i<r?this.IntersectRegularIntervals(n,e,i,r)+this.IntersectRegularIntervals(f,t,i,r):this.IntersectRegularIntervals(n,e,i,e)+this.IntersectRegularIntervals(f,t,f,r)},IntersectRegularIntervals:function(n,t,i,r){var u=System.Math.Max$$Double$$Double(n,i),f=System.Math.Min$$Double$$Double(t,r);return u<f?f-u:0},Cost:function(){for(var t=0,i=this.Bundles.GetEnumerator();i.MoveNext();){var n=i.get_Current(),r=1*this.SeparationCost(n),u=1*this.AssymetryCost(n),f=1*this.SqueezeCost(n),e=10*this.CenterCost$$BundleInfo(n);t+=r/2+u/2+f+e;System.Diagnostics.Debug.Assert$$Boolean(t<Infinity)}return t}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$BundleBasesCalculator);Microsoft$Msagl$Routing$Spline$Bundling$BundleInfo={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.BundleInfo",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Spline.Bundling.BundleInfo.FeasibleWidthEpsilon=.1}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){var o,f,e;if(this.SourceBase=null,this.TargetBase=null,this.obstaclesToIgnore=null,this.EdgeSeparation=0,this.HalfWidthArray=null,this.longEnoughSideLength=0,this.tightObstaclesInTheBoundingBox=null,this.TotalRequiredWidth=0,System.Object.ctor.call(this),this.SourceBase=n,this.TargetBase=t,this.obstaclesToIgnore=i,this.EdgeSeparation=r,this.HalfWidthArray=u,this.TotalRequiredWidth=this.EdgeSeparation*this.HalfWidthArray.length+System.Linq.Enumerable.Sum$$IEnumerable$1$Double(this.HalfWidthArray)*2,this.longEnoughSideLength=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(n.Curve.get_BoundingBox(),t.Curve.get_BoundingBox()).get_Diagonal(),o=System.Math.Max$$Double$$Double(n.Curve.get_BoundingBox().get_Diagonal(),t.Curve.get_BoundingBox().get_Diagonal()),this.TotalRequiredWidth>o){for(f=this.TotalRequiredWidth/o,e=0;e<this.HalfWidthArray.length;e++)this.HalfWidthArray[e]/=f;this.TotalRequiredWidth/=f;this.EdgeSeparation/=f}},SetParamsFeasiblySymmetrically:function(n){this.CalculateTightObstaclesForBundle(n,this.obstaclesToIgnore);this.SetEndParamsSymmetrically()},CalculateTightObstaclesForBundle:function(n,t){var r=this.SourceBase.Curve.get_BoundingBox().get_Diagonal()/2,u=this.TargetBase.Curve.get_BoundingBox().get_Diagonal()/2,i=Microsoft.Msagl.Routing.Spline.Bundling.Intersections.Create4gon(this.SourceBase.Position,this.TargetBase.Position,r*2,u*2);this.tightObstaclesInTheBoundingBox=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n.AllHitItems$$Rectangle$$Func$2(i.get_BoundingBox(),$CreateAnonymousDelegate(this,function(n){return!t.Contains$$T(n)&&Microsoft.Msagl.Core.Geometry.Curves.Curve.ClosedCurveInteriorsIntersect(i,n)})))},SetEndParamsSymmetrically:function(){var o=this.TargetBase.Position,s=this.SourceBase.Position,f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(o,s).Normalize(),t=f.Rotate90Ccw(),h=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Addition(o,s)),i=Microsoft.Msagl.Core.Geometry.Point.op_Addition(h,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.longEnoughSideLength,f)),r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.longEnoughSideLength,f));if(this.SetRLParamsIfWidthIsFeasible$$Point$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.TotalRequiredWidth,t),2),i,r)){this.SetInitialMidParams();return}for(var u=this.TotalRequiredWidth,e=0,n=u/2;u-e>.1;)this.SetRLParamsIfWidthIsFeasible$$Point$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(n,t),2),i,r)?e=n:u=n,n=.5*(u+e);n<=.1&&(this.SetRLParamsIfWidthIsFeasible$$Point$$Point$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.2,t),2),new Microsoft.Msagl.Core.Geometry.Point.ctor,i,r)?n=.2:this.SetRLParamsIfWidthIsFeasible$$Point$$Point$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(-.2,t),2),i,r)&&(n=.2));System.Diagnostics.Debug.Assert$$Boolean(n>.1);this.SetInitialMidParams()},SetRLParamsIfWidthIsFeasible$$Point$$Point$$Point:function(n,t,i){return this.SetRLParamsIfWidthIsFeasible$$Point$$Point$$Point$$Point(n,Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(n),t,i)},SetRLParamsIfWidthIsFeasible$$Point$$Point$$Point$$Point:function(n,t,i,r){var f,e,o,s,u=function(){var t={Value:o},u={Value:e},f=this.TrimSegWithBoundaryCurves(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,n),Microsoft.Msagl.Core.Geometry.Point.op_Addition(r,n)),t,u);return o=t.Value,e=u.Value,f}.call(this);return u==null?!1:System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.tightObstaclesInTheBoundingBox,$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Routing.Spline.Bundling.Intersections.LineSegmentIntersectPolyline(u.get_Start(),u.get_End(),n)}))?!1:(u=function(){var n={Value:f},u={Value:s},e=this.TrimSegWithBoundaryCurves(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,t),Microsoft.Msagl.Core.Geometry.Point.op_Addition(r,t)),n,u);return f=n.Value,s=u.Value,e}.call(this),u==null)?!1:System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.tightObstaclesInTheBoundingBox,$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Routing.Spline.Bundling.Intersections.LineSegmentIntersectPolyline(u.get_Start(),u.get_End(),n)}))?!1:(this.SourceBase.IsParent?(this.SourceBase.set_ParRight(o),this.SourceBase.set_ParLeft(f)):(this.SourceBase.set_ParRight(f),this.SourceBase.set_ParLeft(o)),this.TargetBase.IsParent?(this.TargetBase.set_ParRight(s),this.TargetBase.set_ParLeft(e)):(this.TargetBase.set_ParRight(e),this.TargetBase.set_ParLeft(s)),!0)},SetInitialMidParams:function(){var n,t,i=function(){var i={Value:n},r={Value:t},u=this.TrimSegWithBoundaryCurves(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.TargetBase.get_CurveCenter(),this.SourceBase.get_CurveCenter()),i,r);return n=i.Value,t=r.Value,u}.call(this);i!=null?(this.SourceBase.set_InitialMidParameter(n),this.TargetBase.set_InitialMidParameter(t)):(this.SourceBase.set_InitialMidParameter(this.SourceBase.AdjustParam(this.SourceBase.get_ParRight()+this.SourceBase.get_Span()/2)),this.TargetBase.set_InitialMidParameter(this.TargetBase.AdjustParam(this.TargetBase.get_ParRight()+this.TargetBase.get_Span()/2)))},TrimSegWithBoundaryCurves:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,this.SourceBase.Curve,!0),u,f;return r.get_Count()==0?(t.Value=i.Value=0,null):(u=r.get_Count()==1?r.get_Item$$Int32(0):this.SourceBase.IsParent?r.get_Item$$Int32(0).get_Par0()<r.get_Item$$Int32(1).get_Par0()?r.get_Item$$Int32(1):r.get_Item$$Int32(0):r.get_Item$$Int32(0).get_Par0()<r.get_Item$$Int32(1).get_Par0()?r.get_Item$$Int32(0):r.get_Item$$Int32(1),r=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,this.TargetBase.Curve,!0),r.get_Count()==0)?(t.Value=i.Value=0,null):(f=r.get_Count()==1?r.get_Item$$Int32(0):this.TargetBase.IsParent?r.get_Item$$Int32(0).get_Par0()>r.get_Item$$Int32(1).get_Par0()?r.get_Item$$Int32(1):r.get_Item$$Int32(0):r.get_Item$$Int32(0).get_Par0()>r.get_Item$$Int32(1).get_Par0()?r.get_Item$$Int32(0):r.get_Item$$Int32(1),t.Value=u.get_Par1(),i.Value=f.get_Par1(),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u.get_IntersectionPoint(),f.get_IntersectionPoint()))},RotateBy:function(n,t,i,r,u){var f=n!=0||t!=0,e=i!=0||r!=0;f&&this.SourceBase.RotateBy(n,t,u);e&&this.TargetBase.RotateBy(i,r,u);this.UpdateSourceAndTargetBases(f,e)},UpdateSourceAndTargetBases:function(n,t){n&&this.UpdatePointsOnSourceBase();t&&this.UpdatePointsOnTargetBase();this.UpdateTangentsOnBases()},UpdateTangentsOnBases:function(){for(var t,r,i=this.TargetBase.get_Count(),n=0;n<i;n++)t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.TargetBase.get_Points()[n],this.SourceBase.get_Points()[i-1-n]),r=t.get_Length(),r>=Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()&&(t=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(t,r),this.TargetBase.get_Tangents()[n]=t,this.SourceBase.get_Tangents()[i-1-n]=t.Negate())},UpdatePointsOnSourceBase:function(){var r=this.SourceBase.get_Count(),i=this.SourceBase.get_Points(),u=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.SourceBase.get_RightPoint(),this.SourceBase.get_LeftPoint()),this.TotalRequiredWidth),t,n;for(i[r-1]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.SourceBase.get_LeftPoint(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.EdgeSeparation/2+this.HalfWidthArray[0],u)),t=1,n=r-2;n>=0;n--,t++)i[n]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i[n+1],Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.HalfWidthArray[t-1]+this.EdgeSeparation+this.HalfWidthArray[t],u))},UpdatePointsOnTargetBase:function(){var r=this.TargetBase.get_Count(),t=this.TargetBase.get_Points(),i=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.TargetBase.get_LeftPoint(),this.TargetBase.get_RightPoint()),this.TotalRequiredWidth),n;for(t[0]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.TargetBase.get_RightPoint(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.EdgeSeparation/2+this.HalfWidthArray[0],i)),n=1;n<r;n++)t[n]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t[n-1],Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(this.HalfWidthArray[n-1]+this.EdgeSeparation+this.HalfWidthArray[n],i))},RotationIsLegal:function(n,t,i,r,u){var o,e,f,s;if(this.SourceBase.IsParent||this.TargetBase.IsParent){if((t!=0||r!=0)&&(o=this.SourceBase.RotateLeftPoint(t,u),e=this.TargetBase.RotateLeftPoint(r,u),!this.LineIsLegal(o,e))||(n!=0||i!=0)&&(f=this.SourceBase.RotateRigthPoint(n,u),s=this.TargetBase.RotateRigthPoint(i,u),!this.LineIsLegal(f,s)))return!1}else if((t!=0||i!=0)&&(f=this.SourceBase.RotateLeftPoint(t,u),e=this.TargetBase.RotateRigthPoint(i,u),!this.LineIsLegal(f,e))||(n!=0||r!=0)&&(o=this.SourceBase.RotateRigthPoint(n,u),s=this.TargetBase.RotateLeftPoint(r,u),!this.LineIsLegal(o,s)))return!1;return(n!=0||t!=0)&&!this.SourceBase.RelativeOrderOfBasesIsPreserved(n,t,u)?!1:(i!=0||r!=0)&&!this.TargetBase.RelativeOrderOfBasesIsPreserved(i,r,u)?!1:!0},LineIsLegal:function(n,t){return System.Linq.Enumerable.All$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.tightObstaclesInTheBoundingBox,$CreateAnonymousDelegate(this,function(i){return!Microsoft.Msagl.Routing.Spline.Bundling.Intersections.LineSegmentIntersectPolyline(n,t,i)}))}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$BundleInfo);Microsoft$Msagl$Routing$Spline$Bundling$BundleRouter={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.BundleRouter",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Spline.Bundling.BundleRouter.SuperLoosePaddingCoefficient=1.1},CreateConstrainedDelaunayTriangulation:function(n){var r=n.GetAllLeaves(),i=n.get_Rectangle(),t=i.get_Diagonal()/4,u=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_LeftBottom(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-t,-t)),f=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_LeftTop(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-t,t)),e=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_RightTop(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,t)),o=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_RightBottom(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,-t)),s=[function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$Point$Array([u,f,e,o]);return n.set_Closed(!0),n}()];return Microsoft.Msagl.Routing.Spline.Bundling.BundleRouter.GetConstrainedDelaunayTriangulation(System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,r,s))},GetConstrainedDelaunayTriangulation:function(n){var t=new Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.ctor$$IEnumerable$1$Point$$IEnumerable$1$Polyline$$List$1(null,n,null);return t.Run(),t}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u,f,e,o,s,h){this.bundlingSettings=null;this.geometryGraph=null;this.regularEdges=null;this.shortestPathRouter=null;this.loosePolylineOfPort=null;this._LoosePadding=0;this._TightHierarchy=null;this._LooseHierarchy=null;this._Status=Microsoft.Msagl.Routing.Spline.Bundling.BundlingStatus.Success;this._VisibilityGraph=null;this._EdgeLooseEnterable=null;this._EdgeTightEnterable=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"geometryGraph");Microsoft.Msagl.Core.ValidateArg.IsNotNull(r,"bundlingSettings");this.geometryGraph=n;this.bundlingSettings=r;this.regularEdges=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_Edges(),$CreateAnonymousDelegate(this,function(n){return n.get_Source()!=n.get_Target()})));this.set_VisibilityGraph(i);this.shortestPathRouter=t;this.set_LoosePadding(u);this.set_LooseHierarchy(e);this.set_TightHierarchy(f);this.set_EdgeLooseEnterable(o);this.set_EdgeTightEnterable(s);this.loosePolylineOfPort=h},LoosePadding$$:"System.Double",get_LoosePadding:function(){return this._LoosePadding},set_LoosePadding:function(n){this._LoosePadding=n},TightHierarchy$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_TightHierarchy:function(){return this._TightHierarchy},set_TightHierarchy:function(n){this._TightHierarchy=n},LooseHierarchy$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_LooseHierarchy:function(){return this._LooseHierarchy},set_LooseHierarchy:function(n){this._LooseHierarchy=n},Status$$:"Microsoft.Msagl.Routing.Spline.Bundling.BundlingStatus",get_Status:function(){return this._Status},set_Status:function(n){this._Status=n},VisibilityGraph$$:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",get_VisibilityGraph:function(){return this._VisibilityGraph},set_VisibilityGraph:function(n){this._VisibilityGraph=n},ThereAreOverlaps:function(n){return Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.FindIntersectionWithProperty$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,n,Microsoft.Msagl.Core.Geometry.Curves.Curve.CurvesIntersect)},RunInternal:function(){if(this.ThereAreOverlaps(this.get_TightHierarchy())){this.set_Status(Microsoft.Msagl.Routing.Spline.Bundling.BundlingStatus.Overlaps);Microsoft.Msagl.Routing.Spline.Bundling.TimeMeasurer.DebugOutput("overlaps in edge bundling");return}if(this.FixLocationsForHookAnywherePorts(this.geometryGraph.get_Edges()),!this.RoutePathsWithSteinerDijkstra()){this.set_Status(Microsoft.Msagl.Routing.Spline.Bundling.BundlingStatus.EdgeSeparationIsTooLarge);return}if(this.FixChildParentEdges(),!this.bundlingSettings.get_StopAfterShortestPaths()){var n=new Microsoft.Msagl.Routing.Spline.Bundling.MetroGraphData.ctor(System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,this.regularEdges,$CreateAnonymousDelegate(this,function(n){return n.get_EdgeGeometry()}))),this.get_LooseHierarchy(),this.get_TightHierarchy(),this.bundlingSettings,this.shortestPathRouter.get_Cdt(),this.get_EdgeLooseEnterable(),this.get_EdgeTightEnterable(),this.loosePolylineOfPort);Microsoft.Msagl.Routing.Spline.Bundling.NodePositionsAdjuster.FixRouting(n,this.bundlingSettings);new Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.ctor(n,this.bundlingSettings).Run()}this.RouteSelfEdges();this.FixArrowheads()},FixChildParentEdges:function(){for(var i,r,u,t=0,f=this.regularEdges,e=f.length,n=f[t];t<e;t++,n=f[t])i=n.get_SourcePort(),r=n.get_TargetPort(),i.get_Curve().get_BoundingBox().Contains$$Rectangle(r.get_Curve().get_BoundingBox())&&(u=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(i.get_Curve(),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_Curve().get_Start(),n.get_Curve().get_End()),!0),Cast(n.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor).get_StartPoint().set_Point(u.get_IntersectionPoint())),r.get_Curve().get_BoundingBox().Contains$$Rectangle(i.get_Curve().get_BoundingBox())&&(u=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(r.get_Curve(),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_Curve().get_Start(),n.get_Curve().get_End()),!0),Cast(n.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor).get_EndPoint().set_Point(u.get_IntersectionPoint()))},FixLocationsForHookAnywherePorts:function(n){for(var r=n.GetEnumerator(),i,t;r.MoveNext();)i=r.get_Current(),t=As(i.get_SourcePort(),Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor),t!=null?t.SetLocation(this.FigureOutHookLocation(t.get_LoosePolyline(),i.get_TargetPort(),i.get_EdgeGeometry())):(t=As(i.get_TargetPort(),Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor),t!=null&&t.SetLocation(this.FigureOutHookLocation(t.get_LoosePolyline(),i.get_SourcePort(),i.get_EdgeGeometry())))},FigureOutHookLocation:function(n,t,i){var r=As(t,Microsoft.Msagl.Routing.ClusterBoundaryPort.ctor);return r==null?this.FigureOutHookLocationForSimpleOtherPort(n,t,i):this.FigureOutHookLocationForClusterOtherPort(n,r,i)},FigureOutHookLocationForClusterOtherPort:function(n,t,i){for(var f=this.shortestPathRouter.get_MakeTransparentShapesOfEdgeGeometry()(i),e=new Microsoft.Msagl.Routing.MultipleSourceMultipleTargetsShortestPathOnVisibilityGraph.ctor(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,t.get_LoosePolyline(),$CreateAnonymousDelegate(this,function(n){return this.get_VisibilityGraph().FindVertex(n)})),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,n,$CreateAnonymousDelegate(this,function(n){return this.get_VisibilityGraph().FindVertex(n)})),this.get_VisibilityGraph()),o=e.GetPath(),r=f.GetEnumerator(),u;r.MoveNext();)u=r.get_Current(),u.set_IsTransparent(!1);return System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,o).Point},FigureOutHookLocationForSimpleOtherPort:function(n,t,i){for(var f=t.get_Location(),e=this.shortestPathRouter.get_MakeTransparentShapesOfEdgeGeometry()(i),o=new Microsoft.Msagl.Routing.SingleSourceMultipleTargetsShortestPathOnVisibilityGraph.ctor(this.get_VisibilityGraph().FindVertex(f),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,n.get_PolylinePoints(),$CreateAnonymousDelegate(this,function(n){return this.get_VisibilityGraph().FindVertex(n.get_Point())})),this.get_VisibilityGraph()),s=o.GetPath(),r=e.GetEnumerator(),u;r.MoveNext();)u=r.get_Current(),u.set_IsTransparent(!1);return System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,s).Point},EdgeLooseEnterable$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.Layout.EdgeGeometry],[Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]]]",get_EdgeLooseEnterable:function(){return this._EdgeLooseEnterable},set_EdgeLooseEnterable:function(n){this._EdgeLooseEnterable=n},EdgeTightEnterable$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.Layout.EdgeGeometry],[Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]]]",get_EdgeTightEnterable:function(){return this._EdgeTightEnterable},set_EdgeTightEnterable:function(n){this._EdgeTightEnterable=n},RoutePathsWithSteinerDijkstra:function(){return(this.shortestPathRouter.set_VisibilityGraph(this.get_VisibilityGraph()),this.shortestPathRouter.set_BundlingSettings(this.bundlingSettings),this.shortestPathRouter.set_EdgeGeometries(System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,this.regularEdges,$CreateAnonymousDelegate(this,function(n){return n.get_EdgeGeometry()})))),this.shortestPathRouter.set_ObstacleHierarchy(this.get_LooseHierarchy()),this.shortestPathRouter.RouteEdges(),this.shortestPathRouter.get_Cdt()!=null&&!this.AnalyzeEdgeSeparation())?!1:!0},AnalyzeEdgeSeparation:function(){var r=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor),u,n;if(this.shortestPathRouter.FillCrossedCdtEdges(r),u=this.GetPathsOnCdtEdge(r),n=this.CalculateMaxAllowedEdgeSeparation(u),n>=this.bundlingSettings.get_EdgeSeparation())return!0;if(n<=.02){Microsoft.Msagl.Routing.Spline.Bundling.TimeMeasurer.DebugOutput("edge bundling can't be executed: not enough free space around obstacles");for(var t=0,i=this.regularEdges,e=i.length,f=i[t];t<e;t++,f=i[t])f.set_Curve(null);return!1}return this.bundlingSettings.set_EdgeSeparation(n),this.shortestPathRouter.RouteEdges(),!0},GetPathsOnCdtEdge:function(n){for(var r=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.CdtEdge.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor),u=n.get_Keys().GetEnumerator(),t,i,f;u.MoveNext();)for(t=u.get_Current(),i=n.get_Item$$TKey(t).GetEnumerator();i.MoveNext();)f=i.get_Current(),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,Microsoft.Msagl.Routing.CdtEdge.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor,r,f,t);return r},CalculateMaxAllowedEdgeSeparation:function(n){var i=.01,t=10,r;if(this.EdgeSeparationIsOk$$Dictionary$2$$Double(n,t))return t;while(System.Math.Abs$$Double(t-i)>.01)r=(i+t)/2,this.EdgeSeparationIsOk$$Dictionary$2$$Double(n,r)?i=r:t=r;return i},EdgeSeparationIsOk$$Dictionary$2$$Double:function(n,t){var f=n.get_Count(),i,r,u;if(f==0)return!0;for(i=0,r=n.get_Keys().GetEnumerator();r.MoveNext();)u=r.get_Current(),this.EdgeSeparationIsOk$$CdtEdge$$Set$1$EdgeGeometry$$Double(u,n.get_Item$$TKey(u),t)&&i++;return i/f>this.bundlingSettings.get_MinimalRatioOfGoodCdtEdges()},EdgeSeparationIsOk$$CdtEdge$$Set$1$EdgeGeometry$$Double:function(n,t,i){var r=System.Linq.Enumerable.Sum$$IEnumerable$1$Double(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,System.Double.ctor,t,$CreateAnonymousDelegate(this,function(n){return n.get_LineWidth()})))+(t.get_Count()-1)*i,u=n.Capacity;return r<=u},RouteSelfEdges:function(){for(var t=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,this.geometryGraph.get_Edges(),$CreateAnonymousDelegate(this,function(n){return n.get_Source()==n.get_Target()})).GetEnumerator(),n,i;t.MoveNext();)n=t.get_Current(),n.set_Curve(function(){var t={Value:i},r=Microsoft.Msagl.Core.Layout.Edge.RouteSelfEdge(n.get_Source().get_BoundaryCurve(),this.get_LoosePadding()*2,t);return i=t.Value,r}.call(this))},FixArrowheads:function(){for(var t=this.geometryGraph.get_Edges().GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(n.get_EdgeGeometry(),n.get_Source().get_BoundaryCurve(),n.get_Target().get_BoundaryCurve(),n.get_Curve(),!1,this.bundlingSettings.get_KeepOriginalSpline())}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$BundleRouter);Microsoft$Msagl$Routing$Spline$Bundling$BundlingStatus={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.BundlingStatus",staticDefinition:{Success:0,Overlaps:1,EdgeSeparationIsTooLarge:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$BundlingStatus);Microsoft$Msagl$Routing$Spline$Bundling$CdtIntersections={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.CdtIntersections",baseTypeName:"System.Object",staticDefinition:{PointLocationInsideTriangle:function(n,t){for(var r,u=!1,i=0;i<3;i++){if(r=Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,t.Sites.get_Item$$Int32(i).Point,t.Sites.get_Item$$Int32(i+1).Point),r<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside;r<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(u=!0)}return u?Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Boundary:Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside},FindPolylinePoint:function(n,t){for(var r=n.get_PolylinePoints().GetEnumerator(),i;r.MoveNext();)if(i=r.get_Current(),Microsoft.Msagl.Core.Geometry.Point.op_Equality(i.get_Point(),t))return i;throw $CreateException(new System.NotSupportedException.ctor,new Error);}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.metroGraphData=null;this.bundlingSettings=null;this.ComputeForcesForBundles=!1;System.Object.ctor.call(this);this.metroGraphData=n;this.bundlingSettings=t},BundleAvoidsObstacles:function(n,t,i,r,u,f){var s,e,o,h,c;if(f.Value=new System.Collections.Generic.List$1.ctor(System.Tuple$2.ctor),s=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(n,t),e=this.FindCloseObstaclesForBundle(t.CdtTriangle,r,i,s,u),e==null)return!1;for(o=e.GetEnumerator();o.MoveNext();)h=o.get_Current(),c=h.get_Value(),f.Value.Add(c);return!0},FindCloseObstaclesForBundle:function(n,t,i,r,u){var o=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Tuple$2.ctor),c,d,l,g,a,s,e,it;if(!function(){var u={Value:c},f=this.ThreadLineSegmentThroughTriangles(n,t,i,r,u);return c=u.Value,f}.call(this))return null;if(!this.ComputeForcesForBundles&&!this.bundlingSettings.get_HighestQuality())return o;for(d=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Routing.CdtSite.ctor),l=c.GetEnumerator();l.MoveNext();)for(g=l.get_Current(),a=g.Sites.GetEnumerator();a.MoveNext();)if((s=a.get_Current(),d.Add(s))&&(e=Cast(s.get_Owner(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),!r.Contains$$T(e))){var f=Microsoft.Msagl.Routing.Spline.Bundling.CdtIntersections.FindPolylinePoint(e,s.Point),v,y,p,w,nt=function(){var n={Value:v},r={Value:y},u=Microsoft.Msagl.Core.Geometry.Curves.LineSegment.MinDistBetweenLineSegments(f.get_Point(),f.get_NextOnPolyline().get_Point(),t,i,n,r);return v=n.Value,y=r.Value,u}.call(this),tt=function(){var n={Value:p},r={Value:w},u=Microsoft.Msagl.Core.Geometry.Curves.LineSegment.MinDistBetweenLineSegments(f.get_Point(),f.get_PrevOnPolyline().get_Point(),t,i,n,r);return p=n.Value,w=r.Value,u}.call(this),b,k,h;if(nt<tt){if(h=nt,h>u)continue;b=Microsoft.Msagl.Core.Geometry.Point.op_Addition(f.get_Point(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.get_NextOnPolyline().get_Point(),f.get_Point()),v));k=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t),y))}else{if(h=tt,h>u)continue;b=Microsoft.Msagl.Core.Geometry.Point.op_Addition(f.get_Point(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.get_PrevOnPolyline().get_Point(),f.get_Point()),p));k=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t),w))}(function(){var n={Value:it},t=o.TryGetValue(e,n);return it=n.Value,t}).call(this)||o.Add(e,new System.Tuple$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,b,k))}return o},ThreadLineSegmentThroughTriangles:function(n,t,i,r,u){var f,e,o;if(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.PointIsInsideOfTriangle(t,n)),u.Value=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.CdtTriangle.ctor),Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.PointIsInsideOfTriangle(i,n))return u.Value.Add(n),!0;for(f=new Microsoft.Msagl.Routing.Spline.Bundling.CdtThreader.ctor(n,t,i),u.Value.Add(n);f.MoveNext();)if(u.Value.Add(f.get_CurrentTriangle()),e=f.get_CurrentPiercedEdge(),e.Constrained&&(System.Diagnostics.Debug.Assert$$Boolean(e.lowerSite.get_Owner()==e.upperSite.get_Owner()),o=Cast(e.lowerSite.get_Owner(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),!r.Contains$$T(o)))return!1;return f.get_CurrentTriangle()!=null&&u.Value.Add(f.get_CurrentTriangle()),!0},EdgeIsLegal$$Station$$Station$$Point$$Point:function(n,t,i,r){var u,f=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(n,t);return function(){var t={Value:u},e=this.ThreadLineSegmentThroughTriangles(n.CdtTriangle,i,r,f,t);return u=t.Value,e}.call(this)},EdgeIsLegal$$Station$$Station$$Point$$Point$$Set$1$Polyline:function(n,t,i,r,u){var h=n.Position,e=n.CdtTriangle,o,s,f,c;if(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.PointIsInsideOfTriangle(h,e)),o=t.Position,Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.PointIsInsideOfTriangle(o,e))return!0;for(s=new Microsoft.Msagl.Routing.Spline.Bundling.CdtThreader.ctor(e,h,o);s.MoveNext();)if(f=s.get_CurrentPiercedEdge(),f.Constrained&&(System.Diagnostics.Debug.Assert$$Boolean(f.lowerSite.get_Owner()==f.upperSite.get_Owner()),c=Cast(f.lowerSite.get_Owner(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),!u.Contains$$T(c)))return!1;return!0}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$CdtIntersections);Microsoft$Msagl$Routing$Spline$Bundling$ChannelFlag={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.ChannelFlag",staticDefinition:{NotSet:0,FromRight:1,FromLeft:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$ChannelFlag);Microsoft$Msagl$Routing$Spline$Bundling$EdgeNudger={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.SqueezeBound=.2},FindCurveStart:function(n,t,i){var r=n.PointToStations.get_Item$$TKey(i.get_Polyline().get_StartPoint().get_Point()),u=n.PointToStations.get_Item$$TKey(i.get_Polyline().get_StartPoint().get_Next().get_Point()),f=r.BundleBases.get_Item$$TKey(u),e=f.IsParent?t.GetLineIndexInOrder(r,u,i):t.GetLineIndexInOrder(u,r,i);return f.get_Points()[e]},FindCurveEnd:function(n,t,i){var r=n.PointToStations.get_Item$$TKey(i.get_Polyline().get_EndPoint().get_Prev().get_Point()),u=n.PointToStations.get_Item$$TKey(i.get_Polyline().get_EndPoint().get_Point()),f=u.BundleBases.get_Item$$TKey(r),e=f.IsParent?t.GetLineIndexInOrder(u,r,i):t.GetLineIndexInOrder(r,u,i);return f.get_Points()[e]},BuildUnderlyingPolyline:function(){return null},HubSegsOfLine:function(n,t,i){for(var u=[],r=i.get_Polyline().get_StartPoint().get_Next();r.get_Next()!=null;r=r.get_Next())u.push(Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.SegOnLineVertex(n,t,i,r));return u},SegOnLineVertex:function(n,t,i,r){var o=n.PointToStations.get_Item$$TKey(r.get_Prev().get_Point()),u=n.PointToStations.get_Item$$TKey(r.get_Point()),f=u.BundleBases.get_Item$$TKey(o),e=t.GetLineIndexInOrder(o,u,i);if(f.OrientedHubSegments[e]==null||f.OrientedHubSegments[e].Segment==null){var s=n.PointToStations.get_Item$$TKey(r.get_Next().get_Point()),h=u.BundleBases.get_Item$$TKey(s),c=t.GetLineIndexInOrder(s,u,i);return new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(f.get_Points()[e],h.get_Points()[c])}return f.OrientedHubSegments[e].Segment},BiArc:function(n,t,i,r){var o,u;if(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(t.get_LengthSquared(),1)),System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(r.get_LengthSquared(),1)),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,i),o.get_Length()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return null;var y=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(o,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,r)),p=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(t),r),s=2*(p-1),f=2*y,h=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(o,o),e;if(System.Math.Abs$$Double(s)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)if(System.Math.Abs$$Double(f)>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)e=-h/f;else return null;else u=f*f-4*s*h,System.Diagnostics.Debug.Assert$$Boolean(u>=-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()),u<0&&(u=0),u=System.Math.Sqrt(u),e=(-f+u)/(2*s),e<0&&(e=(-f-u)/(2*s));var c=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(e,t)),l=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(e,r)),a=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Addition(c,l)),v=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor;return(v.AddSegs$$ICurve$$ICurve(Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.ArcOn(n,c,a),Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.ArcOn(a,l,i)),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(t,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,n))<=0&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(t,r)<=0)?Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.StandardBezier(n,t,i,r):v},ArcOn:function(n,t,i){var f,e,s;if(System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,t,i))<.0001||!function(){var r={Value:f},u=Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.FindArcCenter(n,t,i,r);return f=r.Value,u}()||(e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,f).get_Length(),s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t).get_Length(),s/e<.0001))return new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,i);var h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,f),u=System.Math.Atan2(h.get_Y(),h.get_X()),c=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,f),r=System.Math.Atan2(c.get_Y(),c.get_X()),o=r-u;if(o<0&&(o+=6.28318530717959,r+=6.28318530717959),o<=3.14159265358979)return new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Point(u,r,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,0),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,e),f);for(r>6.28318530717959&&(r-=6.28318530717959),u=3.14159265358979-u,r=3.14159265358979-r,u<0&&(u+=6.28318530717959);r<u;)r+=6.28318530717959;return o=r-u,System.Diagnostics.Debug.Assert$$Boolean(o<=3.14159265358979),new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Point(u,r,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-e,0),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,e),f)},FindArcCenter:function(n,t,i,r){var u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n).Rotate90Cw(),f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,i).Rotate90Cw();return Microsoft.Msagl.Core.Geometry.Point.LineLineIntersection(n,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,u),i,Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,f),r)},StandardBezier:function(n,t,i,r){var u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,i).get_Length()/4;return new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(n,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t,u)),Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,u)),i)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.bundlingSettings=null;this.metroGraphData=null;this.metroOrdering=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.metroGraphData=n;this.bundlingSettings=t},CreateUnderlyingPolylines$$:"System.Boolean",get_CreateUnderlyingPolylines:function(){return this.bundlingSettings.get_CreateUnderlyingPolyline()},RunInternal:function(){this.CreateMetroOrdering();this.InitRadii();this.FinalizePaths()},InitRadii:function(){new Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.ctor(this.metroGraphData,this.bundlingSettings).CreateNodeRadii()},CreateMetroOrdering:function(){this.metroOrdering=this.bundlingSettings.get_UseGreedyMetrolineOrdering()?new Microsoft.Msagl.Routing.Spline.Bundling.GeneralMetroMapOrdering.ctor(this.metroGraphData.get_Metrolines()):new Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.ctor(this.metroGraphData.get_Metrolines(),this.metroGraphData.PointToStations)},FinalizePaths:function(){this.CreateBundleBases();this.CreateSegmentsInsideHubs();this.CreateCurves()},CreateBundleBases:function(){var n=new Microsoft.Msagl.Routing.Spline.Bundling.BundleBasesCalculator.ctor(this.metroOrdering,this.metroGraphData,this.bundlingSettings);n.Run()},CreateCurves:function(){System.Diagnostics.Debug.Assert$$Boolean(this.metroGraphData.get_Metrolines().get_Count()==this.metroGraphData.get_Edges().length);for(var n=0;n<this.metroGraphData.get_Metrolines().get_Count();n++)this.CreateCurveLine(this.metroGraphData.get_Metrolines().get_Item$$Int32(n),this.metroGraphData.get_Edges()[n])},CreateCurveLine:function(n,t){for(var r=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,f=Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.FindCurveStart(this.metroGraphData,this.metroOrdering,n),u=f,e=Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.HubSegsOfLine(this.metroGraphData,this.metroOrdering,n),o=e.GetEnumerator(),i;o.MoveNext();)(i=o.get_Current(),i!=null)&&(r.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u,i.get_Start())),r.AddSegment(i),u=i.get_End());r.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u,Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.FindCurveEnd(this.metroGraphData,this.metroOrdering,n)));t.set_Curve(r);this.get_CreateUnderlyingPolylines()&&t.set_SmoothedPolyline(Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.BuildUnderlyingPolyline(f,u,e))},CreateSegmentsInsideHubs:function(){for(var n=this.metroGraphData.get_Metrolines().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.CreateOrientedSegsOnLine(t);this.bundlingSettings.get_UseCubicBezierSegmentsInsideOfHubs()&&this.FanBezierSegs()},CreateOrientedSegsOnLine:function(n){for(var t=n.get_Polyline().get_StartPoint().get_Next();t.get_Next()!=null;t=t.get_Next())this.CreateOrientedSegsOnLineVertex(n,t)},CreateOrientedSegsOnLineVertex:function(n,t){var o=this.metroGraphData.PointToStations.get_Item$$TKey(t.get_Prev().get_Point()),e=this.metroGraphData.PointToStations.get_Item$$TKey(t.get_Point()),s=this.metroGraphData.PointToStations.get_Item$$TKey(t.get_Next().get_Point()),i=e.BundleBases.get_Item$$TKey(o),r=e.BundleBases.get_Item$$TKey(s),u=this.metroOrdering.GetLineIndexInOrder(o,e,n),f=this.metroOrdering.GetLineIndexInOrder(s,e,n),h=this.bundlingSettings.get_UseCubicBezierSegmentsInsideOfHubs()?Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.StandardBezier(i.get_Points()[u],i.get_Tangents()[u],r.get_Points()[f],r.get_Tangents()[f]):Microsoft.Msagl.Routing.Spline.Bundling.EdgeNudger.BiArc(i.get_Points()[u],i.get_Tangents()[u],r.get_Points()[f],r.get_Tangents()[f]);i.OrientedHubSegments[u].Segment=h;r.OrientedHubSegments[f].Segment=h},FanBezierSegs:function(){for(var n=!0,f=0,t,r,i,u;n&&f++<5;)for(n=!1,t=this.metroGraphData.Stations.GetEnumerator();t.MoveNext();)for(r=t.get_Current(),i=r.BundleBases.get_Values().GetEnumerator();i.MoveNext();)u=i.get_Current(),n|=this.FanEdgesOfHubSegment(u)},FanEdgesOfHubSegment:function(n){for(var i=!1,t=0;t<n.get_Count()-1;t++)i|=this.FanCouple(n,t,n.get_CurveCenter(),n.Curve.get_BoundingBox().get_Diagonal()/2);return i},FanCouple:function(n,t,i,r){var u=n.OrientedHubSegments[t],f=n.OrientedHubSegments[t+1],s,e,o;return u==null?!1:function(){var n={Value:s},t=Microsoft.Msagl.Core.Geometry.Curves.LineSegment.Intersect(u.Segment.get_Start(),u.Segment.get_End(),f.Segment.get_Start(),f.Segment.get_End(),n);return s=n.Value,t}.call(this)?!1:Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(u.get_Item$$Double(0),u.get_Item$$Double(.5),u.get_Item$$Double(1))!=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(f.get_Item$$Double(0),f.get_Item$$Double(.5),f.get_Item$$Double(1))?!1:(e=this.BaseLength(u),o=this.BaseLength(f),System.Math.Abs$$Double(e-o)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon())?!1:e>o?this.AdjustLongerSeg(u,f,i,r):this.AdjustLongerSeg(f,u,i,r)},AdjustLongerSeg:function(n,t,i,r){var u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Item$$Double(0),t.get_Item$$Double(0)),f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Item$$Double(1),t.get_Item$$Double(1)),e=System.Math.Min$$Double$$Double(u.get_Length(),f.get_Length()),o=t.get_Item$$Double(.5),s=System.Math.Max$$Double$$Double(u.get_Length(),f.get_Length());return this.NicelyAligned(Cast(n.Segment,Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor),u,f,o,e,s)==0?!1:this.FitLonger(n,u,f,o,e,s,i,r)},FitLonger:function(n,t,i,r,u,f,e,o){var s=Cast(n.Segment,Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor),v=s.get_Start(),y=s.get_End(),k=0,p=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.8,s.get_Start()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.2,s.B(1))),w=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.8,s.get_End()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.2,s.B(2))),h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(2,s.B(1)),s.get_Start()),b=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(2,s.B(2)),s.get_End()),c,l,a;(function(){var n={Value:h},t=this.PullControlPointToTheCircle(s.get_Start(),n,e,o);return h=n.Value,t}).call(this);c=this.NicelyAligned(s,t,i,r,u,f);do{if(c==-1?(l=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(s.B(1),p),2),a=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(s.B(2),w),2),h=s.B(1),b=s.B(2),s=new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(v,l,a,y)):(System.Diagnostics.Debug.Assert$$Boolean(c==1),l=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(s.B(1),h),2),a=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(s.B(2),b),2),p=s.B(1),w=s.B(2),s=new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(v,l,a,y)),(c=this.NicelyAligned(s,t,i,r,u,f))==0)return n.get_Other().Segment=n.Segment=s,!0;if(k++>10)return!1}while(1)},PullControlPointToTheCircle:function(n,t,i,r){var u=Microsoft.Msagl.Core.Geometry.Point.ProjectionToLine(n,t.Value,i),f=System.Math.Sqrt(r*r-Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u,i).get_LengthSquared()),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Value,u),o=e.get_Length();o>f&&(t.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(u,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(f,e),o)))},NicelyAligned:function(n,t,i,r,u,f){var o=.001,e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Item$$Double(.5),r),s=e.get_Length();return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(t,e)<0||Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(i,e)<0?1:s<u-o?1:s>f+o?-1:0},BaseLength:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Item$$Double(0),n.get_Item$$Double(1)).get_LengthSquared()}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$EdgeNudger);Microsoft$Msagl$Routing$Spline$Bundling$FlipCollapser={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.FlipCollapser",baseTypeName:"System.Object",staticDefinition:{OrderedPair$$PolylinePoint:function(n){return Microsoft.Msagl.Routing.Spline.Bundling.FlipCollapser.OrderedPair$$PolylinePoint$$PolylinePoint(n,n.get_Next())},OrderedPair$$PolylinePoint$$PolylinePoint:function(n,t){return new Microsoft.Msagl.Core.Geometry.PointPair.ctor(n.get_Point(),t.get_Point())}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.metroGraphData=null;this.bundlingSettings=null;this.cdt=null;System.Object.ctor.call(this);this.metroGraphData=n;this.bundlingSettings=t;this.cdt=i}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$FlipCollapser);Microsoft$Msagl$Routing$Spline$Bundling$FlipSwitcher={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.FlipSwitcher",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.metroGraphData=null;this.polylineToEdgeGeom=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor);this.pathsThroughPoints=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor);this.interestingPoints=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);this.numberOfReducedCrossings=0;System.Object.ctor.call(this);this.metroGraphData=n},Polylines$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_Polylines:function(){return this.polylineToEdgeGeom.get_Keys()},Run:function(){this.Init();this.SwitchFlips()},Init:function(){for(var r,u,n=0,t=this.metroGraphData.get_Edges(),f=t.length,i=t[n];n<f;n++,i=t[n])this.polylineToEdgeGeom.set_Item$$TKey(Cast(i.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),i);for(r=this.get_Polylines().GetEnumerator();r.MoveNext();)u=r.get_Current(),this.RegisterPolylinePointInPathsThrough$$IEnumerable$1$PolylinePoint(u.get_PolylinePoints())},RegisterPolylinePointInPathsThrough$$IEnumerable$1$PolylinePoint:function(n){for(var t=n.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.RegisterPolylinePointInPathsThrough$$PolylinePoint(i)},RegisterPolylinePointInPathsThrough$$PolylinePoint:function(n){Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor,this.pathsThroughPoints,n.get_Point(),n)},UnregisterPolylinePointInPathsThrough$$IEnumerable$1$PolylinePoint:function(n){for(var t=n.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.UnregisterPolylinePointInPathsThrough$$PolylinePoint(i)},UnregisterPolylinePointInPathsThrough$$PolylinePoint:function(n){Microsoft.Msagl.Core.DataStructures.CollectionUtilities.RemoveFromMap$3(Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor,this.pathsThroughPoints,n.get_Point(),n)},SwitchFlips:function(){for(var t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.get_Polylines()),i=new System.Collections.Generic.Queue$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),u=this.get_Polylines().GetEnumerator(),f,n,r;u.MoveNext();)f=u.get_Current(),i.Enqueue(f);while(i.get_Count()>0)n=i.Dequeue(),t.Remove(n),r=this.ProcessPolyline(n),r!=null&&(t.Contains$$T(n)||(t.Insert(n),i.Enqueue(n)),t.Contains$$T(r)||(t.Insert(r),i.Enqueue(r)))},ProcessPolyline:function(n){for(var u,i,r=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor),t=n.get_StartPoint().get_Next();t!=null;t=t.get_Next())for(this.FillDepartedPolylinePoints(t,r),u=this.pathsThroughPoints.get_Item$$TKey(t.get_Point()).GetEnumerator();u.MoveNext();)if(i=u.get_Current(),r.ContainsKey(i.get_Polyline())){if(this.ProcessFlip(n,i.get_Polyline(),r.get_Item$$TKey(i.get_Polyline()).get_Point(),t.get_Point()))return i.get_Polyline();r.Remove(i.get_Polyline())}return null},FillDepartedPolylinePoints:function(n,t){for(var u=n.get_Prev().get_Point(),r=this.pathsThroughPoints.get_Item$$TKey(u).GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),this.IsNeighbor(i,n)||(System.Diagnostics.Debug.Assert$$Boolean(!t.ContainsKey(i.get_Polyline())),t.set_Item$$TKey(i.get_Polyline(),i))},ProcessFlip:function(n,t,i,r){var u,f,s,h,e,o,c,l;return this.polylineToEdgeGeom.get_Item$$TKey(n).get_LineWidth()!=this.polylineToEdgeGeom.get_Item$$TKey(t).get_LineWidth()?!1:(function(){var t={Value:u},o={Value:f},s={Value:e},h=this.FindPointsOnPolyline(n,i,r,t,o,s);return u=t.Value,f=o.Value,e=s.Value,h}.call(this),function(){var n={Value:s},u={Value:h},f={Value:o},e=this.FindPointsOnPolyline(t,i,r,n,u,f);return s=n.Value,h=u.Value,o=f.Value,e}.call(this),System.Diagnostics.Debug.Assert$$Boolean(this.PolylinePointsAreInForwardOrder(u,f)==e),System.Diagnostics.Debug.Assert$$Boolean(this.PolylinePointsAreInForwardOrder(s,h)==o),c=this.FindRelationOnFirstPoint(u,s,e,o),l=this.FindRelationOnLastPoint(f,h,e,o),c!=2&&l!=2)?!1:c==1||l==1?!1:(this.UnregisterPolylinePointInPathsThrough$$IEnumerable$1$PolylinePoint(n.get_PolylinePoints()),this.UnregisterPolylinePointInPathsThrough$$IEnumerable$1$PolylinePoint(t.get_PolylinePoints()),this.Swap(u,s,f,h,e,o),this.RegisterPolylinePointInPathsThrough$$IEnumerable$1$PolylinePoint(n.get_PolylinePoints()),this.RegisterPolylinePointInPathsThrough$$IEnumerable$1$PolylinePoint(t.get_PolylinePoints()),this.RegisterInterestingPoint(u.get_Point()),this.RegisterInterestingPoint(f.get_Point()),this.numberOfReducedCrossings++,!0)},FindPointsOnPolyline:function(n,t,i,r,u,f){r.Value=u.Value=null;f.Value=!1;for(var e=n.get_StartPoint();e!=null;e=e.get_Next())Microsoft.Msagl.Core.Geometry.Point.op_Equality(e.get_Point(),t)&&(r.Value=e),Microsoft.Msagl.Core.Geometry.Point.op_Equality(e.get_Point(),i)&&(u.Value=e),r.Value!=null&&u.Value==null&&(f.Value=!0),r.Value==null&&u.Value!=null&&(f.Value=!1);System.Diagnostics.Debug.Assert$$Boolean(r.Value!=null&&u.Value!=null)},PolylinePointsAreInForwardOrder:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(n.get_Polyline()==t.get_Polyline());for(var i=n;i!=null;i=i.get_Next())if(i==t)return!0;return!1},Next:function(n,t){return t?n.get_Next():n.get_Prev()},Prev:function(n,t){return t?n.get_Prev():n.get_Next()},FindRelationOnFirstPoint:function(n,t,i,r){var e,o,u,f;for(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Point(),t.get_Point())),e=n,o=t;;){if(u=this.Prev(n,i),f=this.Prev(t,r),u==null||f==null)return System.Diagnostics.Debug.Assert$$Boolean(u==null&&f==null),0;if(Microsoft.Msagl.Core.Geometry.Point.op_Inequality(u.get_Point(),f.get_Point()))break;n=u;t=f}return this.PolylinesIntersect(e,o,n,t,i,r)},FindRelationOnLastPoint:function(n,t,i,r){var e,o,u,f;for(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Point(),t.get_Point())),e=n,o=t;;){if(u=this.Next(n,i),f=this.Next(t,r),u==null||f==null)return System.Diagnostics.Debug.Assert$$Boolean(u==null&&f==null),0;if(Microsoft.Msagl.Core.Geometry.Point.op_Inequality(u.get_Point(),f.get_Point()))break;n=u;t=f}while(Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.Next(n,i).get_Point(),this.Prev(t,r).get_Point()))n=this.Next(n,i),t=this.Prev(t,r);return this.PolylinesIntersect(n,t,e,o,i,r)},PolylinesIntersect:function(n,t,i,r,u,f){var v=this.Prev(n,u),h=this.Next(n,u),y=this.Next(i,u),c=this.Prev(i,u),l=this.Next(t,f),a=this.Prev(r,f),o,s;if(Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Point(),i.get_Point())){var e=n.get_Point(),o=Microsoft.Msagl.Core.Geometry.Point.GetOrientationOf3Vectors(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(c.get_Point(),e),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(a.get_Point(),e),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h.get_Point(),e)),s=Microsoft.Msagl.Core.Geometry.Point.GetOrientationOf3Vectors(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(c.get_Point(),e),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(l.get_Point(),e),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h.get_Point(),e));return System.Diagnostics.Debug.Assert$$Boolean(o!=0&&s!=0),o==s?1:2}return o=Microsoft.Msagl.Core.Geometry.Point.GetOrientationOf3Vectors(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(v.get_Point(),n.get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h.get_Point(),n.get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(l.get_Point(),n.get_Point())),s=Microsoft.Msagl.Core.Geometry.Point.GetOrientationOf3Vectors(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(y.get_Point(),i.get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(a.get_Point(),i.get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(c.get_Point(),i.get_Point())),System.Diagnostics.Debug.Assert$$Boolean(o!=0&&s!=0),o==s?1:2},Swap:function(n,t,i,r,u,f){var e=this.GetRangeOnPolyline(this.Next(n,u),i,u),o=this.GetRangeOnPolyline(this.Next(t,f),r,f);this.ChangePolylineSegment(n,i,u,o);this.ChangePolylineSegment(t,r,f,e);Microsoft.Msagl.Routing.Spline.Bundling.PathFixer.RemoveSelfCyclesFromPolyline(n.get_Polyline());System.Diagnostics.Debug.Assert$$Boolean(this.PolylineIsOK(n.get_Polyline()));Microsoft.Msagl.Routing.Spline.Bundling.PathFixer.RemoveSelfCyclesFromPolyline(t.get_Polyline());System.Diagnostics.Debug.Assert$$Boolean(this.PolylineIsOK(t.get_Polyline()))},ChangePolylineSegment:function(n,t,i,r){for(var u=n,e=r.GetEnumerator(),o,f;e.MoveNext();)o=e.get_Current(),f=function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor(o.get_Point());return n.set_Polyline(u.get_Polyline()),n}.call(this),i?(f.set_Prev(u),u.set_Next(f)):(f.set_Next(u),u.set_Prev(f)),u=f;i?(u.set_Next(t),t.set_Prev(u)):(u.set_Prev(t),t.set_Next(u))},GetRangeOnPolyline:function(n,t,i){for(var u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor),r=n;r!=t;r=this.Next(r,i))u.Add(r);return u},IsNeighbor:function(n,t){return n.get_Prev()!=null&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Prev().get_Point(),t.get_Point())||n.get_Next()!=null&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Next().get_Point(),t.get_Point())},RegisterInterestingPoint:function(n){this.interestingPoints.Contains$$T(n)||this.interestingPoints.Insert(n)},GetChangedHubs:function(){return this.interestingPoints},NumberOfReducedCrossings:function(){return this.numberOfReducedCrossings},PolylineIsOK:function(n){for(var i=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),t=n.get_StartPoint();t!=null;t=t.get_Next()){if(t==n.get_StartPoint()){if(t.get_Prev()!=null)return!1}else if(t.get_Prev().get_Next()!=t)return!1;if(t==n.get_EndPoint()){if(t.get_Next()!=null)return!1}else if(t.get_Next().get_Prev()!=t)return!1;if(i.Contains(t.get_Point()))return!1;i.Add(t.get_Point())}return n.get_StartPoint().get_Prev()!=null?!1:n.get_EndPoint().get_Next()!=null?!1:!0}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$FlipSwitcher);Microsoft$Msagl$Routing$Spline$Bundling$GeneralMetroMapOrdering={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.GeneralMetroMapOrdering",baseTypeName:"System.Object",staticDefinition:{Next:function(n){return n.get_Next()},Prev:function(n){return n.get_Prev()},IsLeft:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Point.GetOrientationOf3Vectors(n,t,i)}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Routing.Spline.Bundling.IMetroMapOrderingAlgorithm"],Kind:"Class",definition:{ctor:function(n){this.Metrolines=null;this.bundles=null;System.Object.ctor.call(this);this.Metrolines=n;this.BuildOrder()},GetOrder:function(n,t){var r=[],e=new Microsoft.Msagl.Core.Geometry.PointPair.ctor(n.Position,t.Position),u=this.bundles.get_Item$$TKey(e).Metrolines,f,o,i;if(Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.Position,e.get_First()))for(f=u.GetEnumerator();f.MoveNext();)o=f.get_Current(),r.push(o);else for(i=u.get_Count()-1;i>=0;i--)r.push(u.get_Item$$Int32(i));return r},GetLineIndexInOrder:function(n,t,i){var u=new Microsoft.Msagl.Core.Geometry.PointPair.ctor(n.Position,t.Position),f=Microsoft.Msagl.Core.Geometry.Point.op_Inequality(n.Position,u.get_First()),r=this.bundles.get_Item$$TKey(u).LineIndexInOrder;return f?r.get_Count()-1-r.get_Item$$TKey(i):r.get_Item$$TKey(i)},BuildOrder:function(){var i,r,n,u,t,f,e;for(this.bundles=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.PointPair.ctor,Microsoft.Msagl.Routing.Spline.Bundling.PointPairOrder.ctor),i=this.Metrolines.GetEnumerator();i.MoveNext();)for(r=i.get_Current(),n=r.get_Polyline().get_StartPoint();n.get_Next()!=null;n=n.get_Next())u=new Microsoft.Msagl.Core.Geometry.PointPair.ctor(n.get_Point(),n.get_Next().get_Point()),function(){var n={Value:t},i=this.bundles.TryGetValue(u,n);return t=n.Value,i}.call(this)||this.bundles.set_Item$$TKey(u,t=new Microsoft.Msagl.Routing.Spline.Bundling.PointPairOrder.ctor),t.Add(r);for(f=this.bundles.GetEnumerator();f.MoveNext();)e=f.get_Current(),this.BuildOrder$$PointPair$$PointPairOrder(e.get_Key(),e.get_Value())},BuildOrder$$PointPair$$PointPairOrder:function(n,t){if(!t.orderFixed){t.Metrolines.Sort$$Comparison$1($CreateAnonymousDelegate(this,function(t,i){return this.CompareLines(t,i,n.get_First(),n.get_Second())}));t.orderFixed=!0;t.LineIndexInOrder=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor,System.Int32.ctor);for(var i=0;i<t.Metrolines.get_Count();i++)t.LineIndexInOrder.set_Item$$TKey(t.Metrolines.get_Item$$Int32(i),i)}},CompareLines:function(n,t,i,r){var c,l,a,v,y,p,o,s;(function(){var t={Value:c},u={Value:l},f={Value:a},e=this.FindStationOnLine(i,r,n,t,u,f);return c=t.Value,l=u.Value,a=f.Value,e}).call(this),function(){var n={Value:v},u={Value:y},f={Value:p},e=this.FindStationOnLine(i,r,t,n,u,f);return v=n.Value,y=u.Value,p=f.Value,e}.call(this);for(var f=c,h=v,u,e=null;(u=a(f))!=null&&(e=p(h))!=null&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(u.get_Point(),e.get_Point());){if(o=new Microsoft.Msagl.Core.Geometry.PointPair.ctor(u.get_Point(),f.get_Point()),this.bundles.get_Item$$TKey(o).orderFixed)return this.CompareOnFixedOrder(o,n,t,Microsoft.Msagl.Core.Geometry.Point.op_Inequality(u.get_Point(),o.get_First()));f=u;h=e}if(u!=null&&e!=null)return s=f.get_Point(),Microsoft.Msagl.Routing.Spline.Bundling.GeneralMetroMapOrdering.IsLeft(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(l(f).get_Point(),s),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.get_Point(),s),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e.get_Point(),s));for(f=c,h=v;(u=l(f))!=null&&(e=y(h))!=null&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(u.get_Point(),e.get_Point());){if(o=new Microsoft.Msagl.Core.Geometry.PointPair.ctor(u.get_Point(),f.get_Point()),this.bundles.get_Item$$TKey(o).orderFixed)return this.CompareOnFixedOrder(o,n,t,Microsoft.Msagl.Core.Geometry.Point.op_Inequality(f.get_Point(),o.get_First()));f=u;h=e}return u!=null&&e!=null?(s=f.get_Point(),-Microsoft.Msagl.Routing.Spline.Bundling.GeneralMetroMapOrdering.IsLeft(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(a(f).get_Point(),s),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.get_Point(),s),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e.get_Point(),s))):n.get_Index().CompareTo$$Int32(t.get_Index())},CompareOnFixedOrder:function(n,t,i,r){var u=this.bundles.get_Item$$TKey(n).LineIndexInOrder,f=r?-1:1;return f*u.get_Item$$TKey(t).CompareTo$$Int32(u.get_Item$$TKey(i))},FindStationOnLine:function(n,t,i,r,u,f){for(var e=i.get_Polyline().get_StartPoint();e.get_Next()!=null;e=e.get_Next()){if(Microsoft.Msagl.Core.Geometry.Point.op_Equality(e.get_Point(),n)&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(e.get_Next().get_Point(),t)){u.Value=Microsoft.Msagl.Routing.Spline.Bundling.GeneralMetroMapOrdering.Next;f.Value=Microsoft.Msagl.Routing.Spline.Bundling.GeneralMetroMapOrdering.Prev;r.Value=e;return}if(Microsoft.Msagl.Core.Geometry.Point.op_Equality(e.get_Point(),t)&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(e.get_Next().get_Point(),n)){f.Value=Microsoft.Msagl.Routing.Spline.Bundling.GeneralMetroMapOrdering.Next;u.Value=Microsoft.Msagl.Routing.Spline.Bundling.GeneralMetroMapOrdering.Prev;r.Value=e.get_Next();return}}throw $CreateException(new System.InvalidOperationException.ctor,new Error);}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$GeneralMetroMapOrdering);Microsoft$Msagl$Routing$Spline$Bundling$HubDebugger={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.HubDebugger",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$HubDebugger);Microsoft$Msagl$Routing$Spline$Bundling$HubRadiiCalculator={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator",baseTypeName:"System.Object",staticDefinition:{CalculateIdealHubRadius:function(n,t,i){for(var o,s,u=1,r=0,f=i.Neighbors,h=f.length,e=f[r];r<h;r++,e=f[r])o=n.GetWidth$$Station$$Station$$Double(e,i,t.get_EdgeSeparation()),s=o/2+t.get_EdgeSeparation(),u=System.Math.Max$$Double$$Double(u,s);return System.Math.Min$$Double$$Double(u,2*t.MaxHubRadius)},CalculateIdealHubRadiusWithNeighbors$$MetroGraphData$$BundlingSettings$$Station:function(n,t,i){return Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.CalculateIdealHubRadiusWithNeighbors$$MetroGraphData$$BundlingSettings$$Station$$Point(n,t,i,i.Position)},CalculateIdealHubRadiusWithNeighbors$$MetroGraphData$$BundlingSettings$$Station$$Point:function(n,t,i,r){var e=Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.CalculateIdealHubRadius(n,t,i),u,f,o,s;if(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,i.Neighbors)>1)for(u=i.Neighbors,f=0;f<u.length;f++)o=u[f],s=u[(f+1)%u.length],e=System.Math.Max$$Double$$Double(e,Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.GetMinRadiusForTwoAdjacentBundles$$Double$$Station$$Point$$Station$$Station$$MetroGraphData$$BundlingSettings(e,i,r,o,s,n,t));return System.Math.Min$$Double$$Double(e,2*t.MaxHubRadius)},CalculateIdealHubRadiusWithAdjacentEdges:function(n,t,i){for(var u=t.MaxHubRadius,r=0,f=i.Neighbors,o=f.length,e=f[r];r<o;r++,e=f[r])u=System.Math.Min$$Double$$Double(u,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.Position,e.Position).get_Length()/2);return u},GetMinRadiusForTwoAdjacentBundles$$Double$$Station$$Point$$Station$$Station$$MetroGraphData$$BundlingSettings:function(n,t,i,r,u,f,e){var o=f.GetWidth$$Station$$Station$$Double(t,r,e.get_EdgeSeparation()),s=f.GetWidth$$Station$$Station$$Double(t,u,e.get_EdgeSeparation());return Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.GetMinRadiusForTwoAdjacentBundles$$Double$$Point$$Point$$Point$$Double$$Double$$MetroGraphData$$BundlingSettings(n,i,r.Position,u.Position,o,s,f,e)},GetMinRadiusForTwoAdjacentBundles$$Double$$Point$$Point$$Point$$Double$$Double$$MetroGraphData$$BundlingSettings:function(n,t,i,r,u,f,e,o){var s;if(u<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon||f<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return n;if(s=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point$$Point(i,t,r),s=System.Math.Min$$Double$$Double(s,6.28318530717959-s),s<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return 2*o.MaxHubRadius;if(s>=1.5707963267949)return n*1.05;var a=System.Math.Sin(s),v=System.Math.Cos(s),h=u/(4*a),c=f/(4*a),l=2*System.Math.Sqrt(h*h+c*c+2*h*c*v);return l=System.Math.Min$$Double$$Double(l,2*o.MaxHubRadius),System.Math.Max$$Double$$Double(l,n)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.metroGraphData=null;this.bundlingSettings=null;System.Object.ctor.call(this);this.metroGraphData=n;this.bundlingSettings=t},CreateNodeRadii:function(){for(var i=this.metroGraphData.VirtualNodes().GetEnumerator(),t,n;i.MoveNext();)n=i.get_Current(),n.Radius=0,n.cachedIdealRadius=Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.CalculateIdealHubRadiusWithNeighbors$$MetroGraphData$$BundlingSettings$$Station(this.metroGraphData,this.bundlingSettings,n);for(this.GrowHubs(!1),this.GrowHubs(!0),t=this.metroGraphData.VirtualNodes().GetEnumerator();t.MoveNext();)n=t.get_Current(),n.Radius=System.Math.Max$$Double$$Double(n.Radius,this.bundlingSettings.MinHubRadius)},GrowHubs:function(n){for(var i=new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor),f=this.metroGraphData.VirtualNodes().GetEnumerator(),r,u,t;f.MoveNext();)t=f.get_Current(),i.Enqueue(t,-this.CalculatePotential(t,n));for(r=!1;!i.IsEmpty();){if(t=function(){var n={Value:u},t=i.Dequeue$$Double(n);return u=n.Value,t}.call(this),u>=0)break;this.TryGrowHub(t,n)&&(i.Enqueue(t,-this.CalculatePotential(t,n)),r=!0)}return r},TryGrowHub:function(n,t){var o=n.Radius,u=this.CalculateAllowedHubRadius(n),i,e,r,f;return(System.Diagnostics.Debug.Assert$$Boolean(u>0),n.Radius>=u)?!1:(i=t?Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.CalculateIdealHubRadiusWithAdjacentEdges(this.metroGraphData,this.bundlingSettings,n):n.cachedIdealRadius,System.Diagnostics.Debug.Assert$$Boolean(i>0),n.Radius>=i)?!1:(e=.05,r=e*(i-n.Radius),r<1&&(r=1),f=System.Math.Min$$Double$$Double(n.Radius+r,u),f<=n.Radius)?!1:(n.Radius=f,!0)},CalculatePotential:function(n,t){var i=t?Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.CalculateIdealHubRadiusWithAdjacentEdges(this.metroGraphData,this.bundlingSettings,n):n.cachedIdealRadius;return i<=n.Radius?0:(i-n.Radius)/i},CalculateAllowedHubRadius:function(n){for(var f,e,t=this.bundlingSettings.MaxHubRadius,r=0,u=n.Neighbors,o=u.length,i=u[r];r<o;r++,i=u[r])f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.Position,n.Position).get_Length(),System.Diagnostics.Debug.Assert$$Boolean(f-.05*(n.Radius+i.Radius)+1>=n.Radius+i.Radius),t=System.Math.Min$$Double$$Double(t,f/1.05-i.Radius);return e=this.metroGraphData.tightIntersections.GetMinimalDistanceToObstacles(n,n.Position,t),e<t&&(t=e-.001),System.Math.Max$$Double$$Double(t,.1)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$HubRadiiCalculator);Microsoft$Msagl$Routing$Spline$Bundling$IMetroMapOrderingAlgorithm={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.IMetroMapOrderingAlgorithm",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$IMetroMapOrderingAlgorithm);Microsoft$Msagl$Routing$Spline$Bundling$CostCalculator={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.Inf=1e9},InkError:function(n,t,i){return(n-t)*i.get_InkImportance()},PathLengthsError:function(n,t,i,r){return(n-t)*(r.get_PathLengthImportance()/i)},RError:function(n,t,i){if(n<=t)return 0;return i.get_HubRepulsionImportance()*(1-t/n)*(n-t)},BundleError:function(n,t,i){if(n<=t)return 0;return i.get_BundleRepulsionImportance()*(1-t/n)*(n-t)},Cost:function(n,t){var i=0,r,u;for(i+=t.get_InkImportance()*n.get_Ink(),r=n.get_Metrolines().GetEnumerator();r.MoveNext();)u=r.get_Current(),i+=t.get_PathLengthImportance()*u.get_Length()/u.get_IdealLength();return i+Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.CostOfForces(n,t)},CostOfForces:function(n){for(var t=0,u=n.VirtualNodes().GetEnumerator(),i,r;u.MoveNext();)i=u.get_Current(),t+=i.cachedRadiusCost;for(r=n.VirtualEdges().GetEnumerator();r.MoveNext();){var f=r.get_Current(),i=f.get_Item1(),e=f.get_Item2();t+=n.GetIjInfo(i,e).cachedBundleCost}return t}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.metroGraphData=null;this.bundlingSettings=null;System.Object.ctor.call(this);this.metroGraphData=n;this.bundlingSettings=t},InkGain:function(n,t){for(var f,o=this.metroGraphData.get_Ink(),r=this.metroGraphData.get_Ink(),i=0,u=n.Neighbors,s=u.length,e=u[i];i<s;i++,e=u[i])f=e.Position,r-=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,n.Position).get_Length(),r+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,t).get_Length();return Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.InkError(o,r,this.bundlingSettings)},PathLengthsGain:function(n,t){for(var r=0,u=this.metroGraphData.MetroNodeInfosOfNode(n).GetEnumerator();u.MoveNext();){var i=u.get_Current(),s=i.get_Metroline().get_Length(),f=i.get_Metroline().get_Length(),e=i.get_PolyPoint().get_Prev().get_Point(),o=i.get_PolyPoint().get_Next().get_Point();f+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(o,t).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,t).get_Length()-Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(o,n.Position).get_Length()-Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,n.Position).get_Length();r+=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.PathLengthsError(s,f,i.get_Metroline().get_IdealLength(),this.bundlingSettings)}return r},RadiusGain:function(n,t){var i=0;return i+=n.cachedRadiusCost,i-this.RadiusCost(n,t)},RadiusCost:function(n,t){var i,r,u,f,e,o;if(i=Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(n.Position,t)?n.cachedIdealRadius:Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.CalculateIdealHubRadiusWithNeighbors$$MetroGraphData$$BundlingSettings$$Station$$Point(this.metroGraphData,this.bundlingSettings,n,t),!function(){var u={Value:r},f=this.metroGraphData.looseIntersections.HubAvoidsObstacles$$Station$$Point$$Double$$List$1(n,t,i,u);return r=u.Value,f}.call(this))return 1e9;for(u=0,f=r.GetEnumerator();f.MoveNext();)e=f.get_Current(),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e.get_Item2(),t).get_Length(),u+=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.RError(i,o,this.bundlingSettings);return u},BundleGain:function(n,t){var r=0,f;r+=n.cachedBundleCost;for(var i=0,u=n.Neighbors,o=u.length,e=u[i];i<o;i++,e=u[i]){if(f=this.BundleCost(n,e,t),Microsoft.Msagl.Core.Geometry.ApproximateComparer.GreaterOrEqual(f,1e9))return-1e9;r-=f}return r},BundleCost:function(n,t,i){var e=this.metroGraphData.GetWidth$$Station$$Station$$Double(n,t,this.bundlingSettings.get_EdgeSeparation()),r,o=0,u,f,s;if(!function(){var u={Value:r},f=this.metroGraphData.cdtIntersections.BundleAvoidsObstacles(n,t,i,t.Position,e,u);return r=u.Value,f}.call(this))return 1e9;for(u=r.GetEnumerator();u.MoveNext();)f=u.get_Current(),s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.get_Item1(),f.get_Item2()).get_Length(),o+=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.BundleError(e/2,s,this.bundlingSettings);return o}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$CostCalculator);Microsoft$Msagl$Routing$Spline$Bundling$IntersectionCache={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.IntersectionCache",baseTypeName:"System.Object",staticDefinition:{Test:function(n,t){return Microsoft.Msagl.Routing.ConstrainedDelaunayTriangulation.Cdt.PointIsInsideOfTriangle(n,t)?Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.metroGraphData=null;this.bundlingSettings=null;this.costCalculator=null;this.cdt=null;System.Object.ctor.call(this);System.Diagnostics.Debug.Assert$$Boolean(r!=null);this.metroGraphData=n;this.bundlingSettings=t;this.costCalculator=i;this.cdt=r},InitializeCostCache:function(){for(var u=this.metroGraphData.VirtualNodes().GetEnumerator(),n,t;u.MoveNext();)n=u.get_Current(),n.cachedIdealRadius=Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.CalculateIdealHubRadiusWithNeighbors$$MetroGraphData$$BundlingSettings$$Station(this.metroGraphData,this.bundlingSettings,n),n.cachedRadiusCost=this.costCalculator.RadiusCost(n,n.Position),n.cachedBundleCost=0;for(t=this.metroGraphData.VirtualEdges().GetEnumerator();t.MoveNext();){var f=t.get_Current(),n=f.get_Item1(),i=f.get_Item2(),r=this.metroGraphData.GetIjInfo(n,i);r.cachedBundleCost=this.costCalculator.BundleCost(n,i,n.Position);n.cachedBundleCost+=r.cachedBundleCost;i.cachedBundleCost+=r.cachedBundleCost}},UpdateCostCache:function(n){var f=this.cdt.GetCdtTree(),i;n.CdtTriangle=f.FirstHitNode$$Point$$Func$3(n.Position,Microsoft.Msagl.Routing.Spline.Bundling.IntersectionCache.Test).get_UserData();n.cachedIdealRadius=Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.CalculateIdealHubRadiusWithNeighbors$$MetroGraphData$$BundlingSettings$$Station(this.metroGraphData,this.bundlingSettings,n);n.cachedRadiusCost=this.costCalculator.RadiusCost(n,n.Position);n.cachedBundleCost=0;for(var r=0,u=n.Neighbors,e=u.length,t=u[r];r<e;r++,t=u[r])t.IsRealNode||(t.cachedIdealRadius=Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.CalculateIdealHubRadiusWithNeighbors$$MetroGraphData$$BundlingSettings$$Station(this.metroGraphData,this.bundlingSettings,t),t.cachedRadiusCost=this.costCalculator.RadiusCost(t,t.Position)),i=this.metroGraphData.GetIjInfo(n,t),t.cachedBundleCost-=i.cachedBundleCost,i.cachedBundleCost=this.costCalculator.BundleCost(n,t,n.Position),n.cachedBundleCost+=i.cachedBundleCost,t.cachedBundleCost+=i.cachedBundleCost}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$IntersectionCache);Microsoft$Msagl$Routing$Spline$Bundling$Intersections={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.Intersections",baseTypeName:"System.Object",staticDefinition:{IntersectCircleWithTree:function(n,t,i,r,u,f){var o,e,c,s,h;if(!n.get_Rectangle().Contains$$Point$$Double(t,i))return!0;if(n.get_UserData()==null){if((o=Microsoft.Msagl.Routing.Spline.Bundling.Intersections.IntersectCircleWithTree(n.get_Left(),t,i,r,u,f),!o)||(o=Microsoft.Msagl.Routing.Spline.Bundling.Intersections.IntersectCircleWithTree(n.get_Right(),t,i,r,u,f),!o))return!1}else{if(e=n.get_UserData(),r.Contains$$T(e))return!0;if(c=Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t,e),c!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside)return!1;s=e.get_Item$$Double(e.ClosestParameter(t));h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(s,t).get_Length();h<=i&&u.Add(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,e,s));f.Value=System.Math.Min$$Double$$Double(h,f.Value)}return!0},LineSegmentIntersectPolyline:function(n,t,i){var s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),o;System.Diagnostics.Debug.Assert$$Boolean(s.get_Length()>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon);for(var r=0,u=1,h=i.get_PolylinePoints().GetEnumerator();h.MoveNext();){var f=h.get_Current(),a=f.get_PrevOnPolyline(),c=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(a.get_Point(),f.get_Point()),l=Microsoft.Msagl.Core.Geometry.Point.CrossProduct(c,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,f.get_Point())),e=-Microsoft.Msagl.Core.Geometry.Point.CrossProduct(c,s);if(System.Math.Abs$$Double(e)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()){if(l<0)return!1;continue}if(o=l/e,e<0){if(r=System.Math.Max$$Double$$Double(r,o),r>u)return!1}else if(u=System.Math.Min$$Double$$Double(u,o),r>u)return!1}return!0},Create4gon:function(n,t,i,r){var u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n).Normalize();return u=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u.get_Y(),-u.get_X()),function(){var f=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$Point$Array([Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(u,i),2)),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(u,i),2)),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(u,r),2)),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(u,r),2))]);return f.set_Closed(!0),f}()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.metroGraphData=null;this.bundlingSettings=null;this.obstaclesToIgnore=null;this._obstacleTree=null;System.Object.ctor.call(this);this.metroGraphData=n;this.obstaclesToIgnore=r;this.bundlingSettings=t;this.set_obstacleTree(i)},obstacleTree$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_obstacleTree:function(){return this._obstacleTree},set_obstacleTree:function(n){this._obstacleTree=n},ObstaclesToIgnoreForBundle:function(n,t){return n!=null&&t!=null?Microsoft.Msagl.Core.DataStructures.Set$1.op_Addition(this.obstaclesToIgnore(n),this.obstaclesToIgnore(t)):n==null&&t==null?new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor):n!=null?this.obstaclesToIgnore(n):this.obstaclesToIgnore(t)},HubAvoidsObstacles$$Station$$Point$$Double$$List$1:function(n,t,i,r){r.Value=new System.Collections.Generic.List$1.ctor(System.Tuple$2.ctor);var u=i;return function(){var f={Value:u},e=Microsoft.Msagl.Routing.Spline.Bundling.Intersections.IntersectCircleWithTree(this.get_obstacleTree(),t,i,this.obstaclesToIgnore(n),r.Value,f);return u=f.Value,e}.call(this)},HubAvoidsObstacles$$Point$$Double$$Set$1$Polyline:function(n,t,i){var r,u;return function(){var f={Value:r},e={Value:u},o=this.HubAvoidsObstacles$$Point$$Double$$Set$1$Polyline$$List$1$$Double(n,t,i,f,e);return r=f.Value,u=e.Value,o}.call(this)},GetMinimalDistanceToObstacles:function(n,t,i){var u=new System.Collections.Generic.List$1.ctor(System.Tuple$2.ctor),r=i;return function(){var f={Value:r},e=Microsoft.Msagl.Routing.Spline.Bundling.Intersections.IntersectCircleWithTree(this.get_obstacleTree(),t,i,this.obstaclesToIgnore(n),u,f);return r=f.Value,e}.call(this)?r:0},HubAvoidsObstacles$$Point$$Double$$Set$1$Polyline$$List$1$$Double:function(n,t,i,r,u){return r.Value=new System.Collections.Generic.List$1.ctor(System.Tuple$2.ctor),u.Value=t,Microsoft.Msagl.Routing.Spline.Bundling.Intersections.IntersectCircleWithTree(this.get_obstacleTree(),n,t,i,r.Value,u)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$Intersections);Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Routing.Spline.Bundling.IMetroMapOrderingAlgorithm"],Kind:"Class",definition:{ctor:function(n,t){this.MetrolinesGlobal=null;this.Metrolines=null;this.positions=null;this.order=null;this.lineIndexInOrder=null;this.nonTerminals=null;this.initialEdges=null;this.orderedAdjacent=null;this.adjacencyIndex=null;this.e2p=null;this.paths=null;System.Object.ctor.call(this);this.MetrolinesGlobal=n;this.ConvertParameters(t);this.BuildOrder()},ConvertParameters:function(n){var i,t;for(this.Metrolines=new System.Collections.Generic.List$1.ctor(Int32Array),this.positions=new Array(n.get_Count()),i=this.MetrolinesGlobal.GetEnumerator();i.MoveNext();){for(var f=i.get_Current(),r=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),u=f.get_Polyline().GetEnumerator();u.MoveNext();)t=u.get_Current(),r.Add(n.get_Item$$TKey(t).SerialNumber),this.positions[n.get_Item$$TKey(t).SerialNumber]=t;this.Metrolines.Add(r.ToArray())}},BuildOrder:function(){var n,t;for(this.Initialize(),n=this.nonTerminals.GetEnumerator();n.MoveNext();)t=n.get_Current(),this.ProcessNonTerminal(t);this.RestoreResult()},Initialize:function(){var r,u,t,n,i;for(this.nonTerminals=new System.Collections.Generic.HashSet$1.ctor(System.Int32.ctor),this.initialEdges=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor),r=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.HashSet$1.ctor),u=0;u<this.Metrolines.get_Count();u++)for(t=this.Metrolines.get_Item$$Int32(u),n=0;n+1<t.length;n++)i=Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.CreateFromTwoNodes(t[n],t[n+1]),this.initialEdges.Contains(i)||this.initialEdges.Add(i),n+2<t.length&&this.nonTerminals.Add(t[n+1]),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,System.Int32.ctor,System.Collections.Generic.HashSet$1.ctor,r,t[n],i),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,System.Int32.ctor,System.Collections.Generic.HashSet$1.ctor,r,t[n+1],i);this.InitAdjacencyData(r);this.InitPathData()},InitPathData:function(){var n,r,i,t,u,f;for(this.paths=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.LinkedList$1.ctor),this.e2p=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.PathList.ctor),n=0;n<this.Metrolines.get_Count();n++)for(r=this.Metrolines.get_Item$$Int32(n),this.paths.Add(n,new System.Collections.Generic.LinkedList$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor)),i=0;i+1<r.length;i++)t=Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.CreateFromTwoNodes(r[i],r[i+1]),this.e2p.ContainsKey(t)||(u=new Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.PathList.ctor,u.edge=t,u.paths=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.PathOnEdge.ctor),this.e2p.Add(t,u)),f=new Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.PathOnEdge.ctor,f.index=n,f.node=this.paths.get_Item$$TKey(n).AddLast$$T(t),this.e2p.get_Item$$TKey(t).paths.Add(f)},InitAdjacencyData:function(n){var i,t,r;for(this.orderedAdjacent=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.LinkedList$1.ctor),this.adjacencyIndex=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,System.Collections.Generic.LinkedListNode$1.ctor),i=n.get_Keys().GetEnumerator();i.MoveNext();)t=i.get_Current(),r=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,n.get_Item$$TKey(t)),this.orderedAdjacent.Add(t,this.SortAdjacentEdges(t,r))},SortAdjacentEdges:function(n,t){var o=System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,t),f=this.OppositeNode(o,n),i,r,u,e;for(t.Sort$$Comparison$1($CreateAnonymousDelegate(this,function(t,i){var r=this.OppositeNode(t,n),u=this.OppositeNode(i,n),e=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.positions[r],this.positions[n]),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.positions[f],this.positions[n])),o=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.positions[u],this.positions[n]),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.positions[f],this.positions[n]));return e.CompareTo$$Double(o)})),i=new System.Collections.Generic.LinkedList$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor),r=t.GetEnumerator();r.MoveNext();)u=r.get_Current(),e=i.AddLast$$T(u),this.adjacencyIndex.Add(new System.Tuple$2.ctor(System.Int32.ctor,Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,n,u),e);return i},UpdateAdjacencyData:function(n,t,i){var r=this.adjacencyIndex.get_Item$$TKey(new System.Tuple$2.ctor(System.Int32.ctor,Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,n,t)),f,e,o,u;for(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.op_Equality(r.get_Value(),t)),f=r,e=i.GetEnumerator();e.MoveNext();)o=e.get_Current(),u=o.edge,r=t.Source()==n?r.get_List().AddAfter$$LinkedListNode$1$$T(r,u):r.get_List().AddBefore$$LinkedListNode$1$$T(r,u),this.adjacencyIndex.Add(new System.Tuple$2.ctor(System.Int32.ctor,Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,n,u),r);this.adjacencyIndex.Remove(new System.Tuple$2.ctor(System.Int32.ctor,Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,n,t));f.get_List().Remove$$LinkedListNode$1(f)},RestoreResult$$MetroEdge:function(n){var i=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),r=this.e2p.get_Item$$TKey(n),u,o,f,t,e;if(r.subLists==null)for(u=r.paths.GetEnumerator();u.MoveNext();)o=u.get_Current(),i.Add(o.index);else for(f=r.subLists.GetEnumerator();f.MoveNext();)t=f.get_Current(),e=this.RestoreResult$$MetroEdge(t.edge),n.Source()==t.edge.Source()||n.Target()==t.edge.Target()||e.Reverse(),i.AddRange(e);return i},RestoreResult:function(){var t,n,u;for(this.order=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,System.Collections.Generic.List$1.ctor),this.lineIndexInOrder=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,System.Collections.Generic.Dictionary$2.ctor),t=this.initialEdges.GetEnumerator();t.MoveNext();){n=t.get_Current();this.order.Add(n,this.RestoreResult$$MetroEdge(n));for(var i=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor,System.Int32.ctor),f=0,r=this.order.get_Item$$TKey(n).GetEnumerator();r.MoveNext();)u=r.get_Current(),i.set_Item$$TKey(this.MetrolinesGlobal.get_Item$$Int32(u),f++);this.lineIndexInOrder.Add(n,i)}},ProcessNonTerminal:function(n){for(var h=this.RadixSort(n),o=this.orderedAdjacent.get_Item$$TKey(n).GetEnumerator(),t,i,f,r,u,e,s;o.MoveNext();)for(t=o.get_Current(),System.Diagnostics.Debug.Assert$$Boolean(this.e2p.ContainsKey(t)),i=h.get_Item$$TKey(t),this.e2p.get_Item$$TKey(t).paths=null,this.e2p.get_Item$$TKey(t).subLists=i,this.UpdateAdjacencyData(this.OppositeNode(t,n),t,i),f=i.GetEnumerator();f.MoveNext();)if(r=f.get_Current(),u=r.edge,!this.e2p.ContainsKey(u))for(this.e2p.Add(u,r),e=r.paths.GetEnumerator();e.MoveNext();)s=e.get_Current(),this.UpdatePath(s,n,u)},RadixSort:function(n){for(var u=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,System.Collections.Generic.List$1.ctor),a=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,System.Int32.ctor),v=this.orderedAdjacent.get_Item$$TKey(n).GetEnumerator(),s,p,h,c,t,i,f,e,r,b,o;v.MoveNext();){for(var t=v.get_Current(),k=this.e2p.get_Item$$TKey(t),y=k.paths.GetEnumerator();y.MoveNext();)s=y.get_Current(),p=this.FindNextEdgeOnPath(n,s),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.PathOnEdge.ctor,Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,System.Collections.Generic.List$1.ctor,u,p,s);a.Add(t,u.ContainsKey(t)?u.get_Item$$TKey(t).get_Count():0)}for(h=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,System.Collections.Generic.List$1.ctor),c=this.orderedAdjacent.get_Item$$TKey(n).GetEnumerator();c.MoveNext();){for(t=c.get_Current(),i=u.get_Item$$TKey(t),System.Diagnostics.Debug.Assert$$Boolean(i.get_Count()>0),f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.PathList.ctor),e=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.PathOnEdge.ctor),r=0;r<i.get_Count();r++){var l=(r+a.get_Item$$TKey(t))%i.get_Count(),w=i.get_Item$$Int32(l).node.get_Value(),d=i.get_Item$$Int32((l+1)%i.get_Count()).node.get_Value();e.Add(i.get_Item$$Int32(l));(r==i.get_Count()-1||Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.op_Inequality(w,d))&&(b=Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.CreateFromTwoEdges$$Int32$$MetroEdge$$MetroEdge(n,t,w),o=new Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.PathList.ctor,o.edge=b,o.paths=e,f.Add(o),e=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.PathOnEdge.ctor))}t.Source()==n&&f.Reverse();h.Add(t,f)}return h},FindNextEdgeOnPath:function(n,t){var i;if(t.node.get_Next()!=null&&(i=this.OppositeNode(t.node.get_Next().get_Value(),n),i!=-1))return t.node.get_Next().get_Value();if(t.node.get_Previous()!=null&&(i=this.OppositeNode(t.node.get_Previous().get_Value(),n),i!=-1))return t.node.get_Previous().get_Value();throw $CreateException(new System.NotSupportedException.ctor,new Error);},OppositeNode:function(n,t){return n.Source()==t?n.Target():n.Target()==t?n.Source():-1},UpdatePath:function(n,t,i){var r=n.node,f,u;if(System.Diagnostics.Debug.Assert$$Boolean(r.get_Value().Source()==t||r.get_Value().Target()==t),f=this.OppositeNode(r.get_Value(),t),r.get_Next()!=null&&(u=this.OppositeNode(r.get_Next().get_Value(),t))!=-1)System.Diagnostics.Debug.Assert$$Boolean(f==i.Source()||f==i.Target()),System.Diagnostics.Debug.Assert$$Boolean(u==i.Source()||u==i.Target()),r.set_Value(i),r.get_List().Remove$$LinkedListNode$1(r.get_Next());else if(r.get_Previous()!=null&&(u=this.OppositeNode(r.get_Previous().get_Value(),t))!=-1)System.Diagnostics.Debug.Assert$$Boolean(f==i.Source()||f==i.Target()),System.Diagnostics.Debug.Assert$$Boolean(u==i.Source()||u==i.Target()),r.set_Value(i),r.get_List().Remove$$LinkedListNode$1(r.get_Previous());else throw $CreateException(new System.NotSupportedException.ctor,new Error);}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering);Microsoft$Msagl$Routing$Spline$Bundling$MetroGraphData={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.MetroGraphData",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u,f,e,o){this.Stations=null;this.edgeInfoDictionary=null;this.ink=0;this.metrolines=null;this.PointToStations=null;this.regularEdges=null;this.looseIntersections=null;this.tightIntersections=null;this.cdtIntersections=null;this.LoosePolylineOfPort=null;this.Cdt=null;this.cachedEnterableLooseForEnd=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor);this._EdgeLooseEnterable=null;this._EdgeTightEnterable=null;System.Object.ctor.call(this);this.regularEdges=n;this.Cdt=u!=null?u:Microsoft.Msagl.Routing.Spline.Bundling.BundleRouter.CreateConstrainedDelaunayTriangulation(t);this.set_EdgeLooseEnterable(f);this.set_EdgeTightEnterable(e);this.LoosePolylineOfPort=o;this.looseIntersections=new Microsoft.Msagl.Routing.Spline.Bundling.Intersections.ctor(this,r,t,$CreateAnonymousDelegate(this,function(n){return n.EnterableLoosePolylines}));this.tightIntersections=new Microsoft.Msagl.Routing.Spline.Bundling.Intersections.ctor(this,r,i,$CreateAnonymousDelegate(this,function(n){return n.EnterableTightPolylines}));this.cdtIntersections=new Microsoft.Msagl.Routing.Spline.Bundling.CdtIntersections.ctor(this,r);this.Initialize(!1)},EdgeLooseEnterable$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.Layout.EdgeGeometry],[Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]]]",get_EdgeLooseEnterable:function(){return this._EdgeLooseEnterable},set_EdgeLooseEnterable:function(n){this._EdgeLooseEnterable=n},EdgeTightEnterable$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.Layout.EdgeGeometry],[Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]]]",get_EdgeTightEnterable:function(){return this._EdgeTightEnterable},set_EdgeTightEnterable:function(n){this._EdgeTightEnterable=n},Ink$$:"System.Double",get_Ink:function(){return this.ink},Edges$$:"Microsoft.Msagl.Core.Layout.EdgeGeometry[]",get_Edges:function(){return this.regularEdges},VirtualNodes:function(){return System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,this.Stations,$CreateAnonymousDelegate(this,function(n){return!n.IsRealNode}))},Metrolines$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Spline.Bundling.Metroline]]",get_Metrolines:function(){return this.metrolines},LooseTree$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_LooseTree:function(){return this.looseIntersections.get_obstacleTree()},TightTree$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_TightTree:function(){return this.tightIntersections.get_obstacleTree()},VirtualEdges:function(){return this.edgeInfoDictionary.get_Keys()},RealEdgeCount:function(n,t){var r=Microsoft.Msagl.Routing.Spline.Bundling.Station.op_LessThan(n,t)?new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,n,t):new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,t,n),i;return function(){var n={Value:i},t=this.edgeInfoDictionary.TryGetValue(r,n);return i=n.Value,t}.call(this)?i.Count:0},MetroNodeInfosOfNode:function(n){return n.MetroNodeInfos},GetIjInfo:function(n,t){var i=Microsoft.Msagl.Routing.Spline.Bundling.Station.op_LessThan(n,t)?new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,n,t):new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,t,n);return this.edgeInfoDictionary.get_Item$$TKey(i)},MoveNode:function(n,t){var r=n.Position,e,l,o;for(this.PointToStations.Remove(r),this.PointToStations.Add(t,n),n.Position=t,e=this.MetroNodeInfosOfNode(n).GetEnumerator();e.MoveNext();)l=e.get_Current(),l.get_PolyPoint().set_Point(t);for(o=this.MetroNodeInfosOfNode(n).GetEnumerator();o.MoveNext();){var s=o.get_Current(),a=s.get_Metroline(),v=s.get_PolyPoint().get_Prev().get_Point(),y=s.get_PolyPoint().get_Next().get_Point();a.set_Length(a.get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(y,t).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(v,t).get_Length()-Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(y,r).get_Length()-Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(v,r).get_Length())}for(var u=0,h=n.Neighbors,p=h.length,i=h[u];u<p;u++,i=h[u])this.ink+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,i.Position).get_Length()-Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,i.Position).get_Length();this.SortNeighbors$$Station(n);for(var f=0,c=n.Neighbors,w=c.length,i=c[f];f<w;f++,i=c[f])this.SortNeighbors$$Station(i)},GetWidth$$Station$$Station$$Double:function(n,t,i){var u=Microsoft.Msagl.Routing.Spline.Bundling.Station.op_LessThan(n,t)?new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,n,t):new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,t,n),r;return function(){var n={Value:r},t=this.edgeInfoDictionary.TryGetValue(u,n);return r=n.Value,t}.call(this)?r.Width+(r.Count-1)*i:0},GetWidth$$IEnumerable$1$Metroline$$Double:function(n,t){for(var i=0,u=n.GetEnumerator(),f,r;u.MoveNext();)f=u.get_Current(),i+=f.Width;return r=System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor,n),i+=r>0?(r-1)*t:0,System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.GreaterOrEqual(i,0)),i},Initialize:function(n){this.SimplifyRegularEdges();this.InitializeNodeData();this.InitializeEdgeData();this.InitializeVirtualGraph();this.InitializeEdgeNodeInfo(n);this.InitializeCdtInfo()},SimplifyRegularEdges:function(){for(var n=0,t=this.regularEdges,r=t.length,i=t[n];n<r;n++,i=t[n])this.SimplifyRegularEdge(i)},SimplifyRegularEdge:function(n){for(var r,i,e,o=Cast(n.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),u=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),f=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),t=o.get_EndPoint();t!=null;t=t.get_Prev())if(r=t.get_Point(),f.Contains$$T(t.get_Point())){i=t.get_Next();do if(e=u.Peek(),Microsoft.Msagl.Core.Geometry.Point.op_Inequality(e,r))f.Remove(e),u.Pop(),i=i.get_Next();else break;while(1);i.set_Prev(t.get_Prev());i.get_Prev().set_Next(i)}else u.Push(r),f.Insert(r)},InitializeNodeData:function(){var t,u;this.Stations=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor);this.PointToStations=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor);t=0;for(var n=0,i=this.regularEdges,f=i.length,r=i[n];n<f;n++,r=i[n])u=Cast(r.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),t=this.ProcessPolylinePoints(t,u)},ProcessPolylinePoints:function(n,t){var i=t.get_StartPoint();for(n=this.RegisterStation(n,i,!0),i=i.get_Next();i!=t.get_EndPoint();i=i.get_Next())n=this.RegisterStation(n,i,!1);return this.RegisterStation(n,i,!0)},RegisterStation:function(n,t,i){if(!this.PointToStations.ContainsKey(t.get_Point())){var r=new Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor(n++,i,t.get_Point());this.PointToStations.set_Item$$TKey(t.get_Point(),r);this.Stations.Insert(r)}return n},InitializeEdgeData:function(){var n,t;for(this.metrolines=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor),n=0;n<this.regularEdges.length;n++)t=this.regularEdges[n],this.InitEdgeData(t,n)},InitEdgeData:function(n,t){var i=new Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor(Cast(n.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),n.get_LineWidth(),this.EdgeSourceAndTargetFunc(n),t);this.metrolines.Add(i);this.PointToStations.get_Item$$TKey(i.get_Polyline().get_Start()).BoundaryCurve=n.get_SourcePort().get_Curve();this.PointToStations.get_Item$$TKey(i.get_Polyline().get_End()).BoundaryCurve=n.get_TargetPort().get_Curve()},EdgeSourceAndTargetFunc:function(n){return $CreateAnonymousDelegate(this,function(){return new System.Tuple$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.LoosePolylineOfPort(n.get_SourcePort()),this.LoosePolylineOfPort(n.get_TargetPort()))})},InitializeVirtualGraph:function(){for(var r=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor),o=this.metrolines.GetEnumerator(),u,t,i,n,f,e;o.MoveNext();)for(u=o.get_Current(),t=this.PointToStations.get_Item$$TKey(u.get_Polyline().get_Start()),n=u.get_Polyline().get_StartPoint();n.get_Next()!=null;n=n.get_Next(),t=i)i=this.PointToStations.get_Item$$TKey(n.get_Next().get_Point()),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor,r,t,i),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor,r,i,t);for(f=this.Stations.GetEnumerator();f.MoveNext();)e=f.get_Current(),e.Neighbors=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,r.get_Item$$TKey(e))},GetUnorderedIjInfo:function(n,t){return System.Diagnostics.Debug.Assert$$Boolean(n!=t),Microsoft.Msagl.Routing.Spline.Bundling.Station.op_LessThan(n,t)?this.GetOrderedIjInfo(n,t):this.GetOrderedIjInfo(t,n)},GetOrderedIjInfo:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.Spline.Bundling.Station.op_LessThan(n,t));var r=new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,n,t),i;return function(){var n={Value:i},t=this.edgeInfoDictionary.TryGetValue(r,n);return i=n.Value,t}.call(this)?i:(this.edgeInfoDictionary.set_Item$$TKey(r,i=new Microsoft.Msagl.Routing.Spline.Bundling.StationEdgeInfo.ctor(n.Position,t.Position)),i)},InitializeEdgeNodeInfo:function(n){var t,i;for(this.edgeInfoDictionary=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,Microsoft.Msagl.Routing.Spline.Bundling.StationEdgeInfo.ctor),this.InitMetroNodeInfos$$Boolean(n),this.SortNeighbors(),this.InitEdgeIjInfos(),this.ink=0,t=this.VirtualEdges().GetEnumerator();t.MoveNext();)i=t.get_Current(),this.ink+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Item1().Position,i.get_Item2().Position).get_Length()},InitMetroNodeInfos$$Boolean:function(n){for(var i,t=0;t<this.metrolines.get_Count();t++)i=this.metrolines.get_Item$$Int32(t),this.InitMetroNodeInfos$$Metroline(i),this.InitNodeEnterableLoosePolylines(i,this.regularEdges[t]),n&&this.InitNodeEnterableTightPolylines(i,this.regularEdges[t]),i.UpdateLengths()},InitMetroNodeInfos$$Metroline:function(n){for(var i,t=n.get_Polyline().get_StartPoint();t!=null;t=t.get_Next())i=this.PointToStations.get_Item$$TKey(t.get_Point()),i.MetroNodeInfos.Add(new Microsoft.Msagl.Routing.Spline.Bundling.MetroNodeInfo.ctor(n,i,t))},InitNodeEnterableLoosePolylines:function(n,t){for(var r,u=this.get_EdgeLooseEnterable()!=null?this.get_EdgeLooseEnterable().get_Item$$TKey(t):new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),i=n.get_Polyline().get_StartPoint().get_Next();i!=null&&i.get_Next()!=null;i=i.get_Next())r=this.PointToStations.get_Item$$TKey(i.get_Point()),r.EnterableLoosePolylines=Microsoft.Msagl.Core.DataStructures.Set$1.op_Inequality(r.EnterableLoosePolylines,null)?Microsoft.Msagl.Core.DataStructures.Set$1.op_Multiply(r.EnterableLoosePolylines,u):new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,u);this.AddLooseEnterableForMetrolineStartEndPoints(n)},AddLooseEnterableForMetrolineStartEndPoints:function(n){this.AddLooseEnterableForEnd(n.get_Polyline().get_Start());this.AddLooseEnterableForEnd(n.get_Polyline().get_End())},AddTightEnterableForMetrolineStartEndPoints:function(n){this.AddTightEnterableForEnd(n.get_Polyline().get_Start());this.AddTightEnterableForEnd(n.get_Polyline().get_End())},AddLooseEnterableForEnd:function(n){var t=this.PointToStations.get_Item$$TKey(n),i,r;if(this.cachedEnterableLooseForEnd.ContainsKey(n))t.EnterableLoosePolylines=this.cachedEnterableLooseForEnd.get_Item$$TKey(n);else{for(i=this.get_LooseTree().AllHitItems$$Point(n).GetEnumerator();i.MoveNext();)r=i.get_Current(),Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n,r)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside&&t.AddEnterableLoosePolyline(r);this.cachedEnterableLooseForEnd.Add(n,t.EnterableLoosePolylines)}},AddTightEnterableForEnd:function(n){for(var r=this.PointToStations.get_Item$$TKey(n),i=this.get_TightTree().AllHitItems$$Point(n).GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n,t)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside&&r.AddEnterableTightPolyline(t)},InitNodeEnterableTightPolylines:function(n,t){for(var r,u,f=this.get_EdgeTightEnterable()!=null?this.get_EdgeTightEnterable().get_Item$$TKey(t):new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),i=n.get_Polyline().get_StartPoint().get_Next();i!=null&&i.get_Next()!=null;i=i.get_Next())r=this.PointToStations.get_Item$$TKey(i.get_Point()),u=r.EnterableTightPolylines,r.EnterableTightPolylines=Microsoft.Msagl.Core.DataStructures.Set$1.op_Inequality(u,null)?Microsoft.Msagl.Core.DataStructures.Set$1.op_Multiply(u,f):new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,f);this.AddTightEnterableForMetrolineStartEndPoints(n)},SortNeighbors:function(){for(var n=this.Stations.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.SortNeighbors$$Station(t)},SortNeighbors$$Station:function(n){if(!(n.Neighbors.length<=2)){var i=n.Neighbors[0].Position,t=n.Position;System.Array.Sort$1$$T$Array$$Comparison$1(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,n.Neighbors,$CreateAnonymousDelegate(this,function(n,r){return Microsoft.Msagl.Core.Geometry.Point.GetOrientationOf3Vectors(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,t),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r.Position,t))}))}},InitEdgeIjInfos:function(){for(var u=this.metrolines.GetEnumerator(),n,i;u.MoveNext();){var t=u.get_Current(),e=t.get_Polyline(),f=this.PointToStations.get_Item$$TKey(e.get_Start()),r;for(n=t.get_Polyline().get_StartPoint();n.get_Next()!=null;n=n.get_Next(),f=r)r=this.PointToStations.get_Item$$TKey(n.get_Next().get_Point()),i=this.GetUnorderedIjInfo(f,r),i.Count++,i.Width+=t.Width,i.Metrolines.Add(t)}},InitializeCdtInfo:function(){for(var i=this.Cdt.GetCdtTree(),t=this.Stations.GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),n.CdtTriangle=i.FirstHitNode$$Point$$Func$3(n.Position,Microsoft.Msagl.Routing.Spline.Bundling.IntersectionCache.Test).get_UserData(),System.Diagnostics.Debug.Assert$$Boolean(n.CdtTriangle!=null)},PointIsAcceptableForEdge:function(n,t){if(this.LoosePolylineOfPort==null)return!0;var i=n.sourceAndTargetLoosePolylines();return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t,i.get_Item1())==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside&&Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t,i.get_Item2())==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$MetroGraphData);Microsoft$Msagl$Routing$Spline$Bundling$Metroline={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.Metroline",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.Width=0;this.sourceAndTargetLoosePolylines=null;this._Length=0;this._IdealLength=0;this._Polyline=null;this._Index=0;System.Object.ctor.call(this);this.Width=t;this.set_Polyline(n);this.sourceAndTargetLoosePolylines=i},Length$$:"System.Double",get_Length:function(){return this._Length},set_Length:function(n){this._Length=n},IdealLength$$:"System.Double",get_IdealLength:function(){return this._IdealLength},set_IdealLength:function(n){this._IdealLength=n},Polyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_Polyline:function(){return this._Polyline},set_Polyline:function(n){this._Polyline=n},Index$$:"System.Int32",get_Index:function(){return this._Index},set_Index:function(n){this._Index=n},UpdateLengths:function(){for(var t=0,n=this.get_Polyline().get_StartPoint();n.get_Next()!=null;n=n.get_Next())t+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Next().get_Point(),n.get_Point()).get_Length();this.set_Length(t);this.set_IdealLength(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.get_Polyline().get_End(),this.get_Polyline().get_Start()).get_Length())}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$Metroline);Microsoft$Msagl$Routing$Spline$Bundling$MetroNodeInfo={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.MetroNodeInfo",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.metroline=null;this.station=null;this.polyPoint=null;System.Object.ctor.call(this);this.metroline=n;this.station=t;this.polyPoint=i},Metroline$$:"Microsoft.Msagl.Routing.Spline.Bundling.Metroline",get_Metroline:function(){return this.metroline},PolyPoint$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_PolyPoint:function(){return this.polyPoint}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$MetroNodeInfo);Microsoft$Msagl$Routing$Spline$Bundling$NodePositionsAdjuster={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.NodePositionsAdjuster",baseTypeName:"System.Object",staticDefinition:{FixRouting:function(n,t){var i=new Microsoft.Msagl.Routing.Spline.Bundling.NodePositionsAdjuster.ctor(n,t),u,f,r;for(i.GlueConflictingNodes(),i.UnglueEdgesFromBundleToSaveInk(!0),u=0,f=10;++u<f;)if(r=i.GlueConflictingNodes(),r|=i.RelaxConstrainedEdges(),r|=u<=3&&i.UnglueEdgesFromBundleToSaveInk(!1),r|=i.GlueCollinearNeighbors$$Int32(u),r|=u==3&&i.RemoveDoublePathCrossings(),!r)break;for(n.cdtIntersections.ComputeForcesForBundles=!0,i.RemoveDoublePathCrossings(),i.UnglueEdgesFromBundleToSaveInk(!0);i.GlueConflictingNodes(););n.Initialize(!0)},GluedPolyline:function(n,t){var u,i=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor),f,r;for(i.Push(n[0]),f=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor),u=1;u<n.length-1;u++){if(r=Microsoft.Msagl.Routing.Spline.Bundling.NodePositionsAdjuster.Glued(n[u],t),f.Contains$$T(r)){while(i.Peek()!=r)f.Delete(i.Pop());continue}Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(r.Position,i.Peek().Position)||(f.Insert(r),i.Push(r))}return i.Push(n[u]),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Reverse$1(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,i),function(n){return n.Position})},Glued:function(n,t){var i;return function(){var r={Value:i},u=t.TryGetValue(n,r);return i=r.Value,u}()?i:n}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.bundlingSettings=null;this.metroGraphData=null;this.ink=0;this.polylineLength=null;System.Object.ctor.call(this);this.metroGraphData=n;this.bundlingSettings=t},GlueConflictingNodes:function(){var u=this.GetCirclesHierarchy(),n,f,t,i,e,o;if(u==null||(n=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor),f=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor),Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,u,u,$CreateAnonymousDelegate(this,function(t,i){this.TryToGlueNodes(t,i,n,f)})),n.get_Count()==0))return!1;for(t=0;t<this.metroGraphData.get_Edges().length;t++)this.RegenerateEdge(n,t);for(i=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),e=f.GetEnumerator();e.MoveNext();){o=e.get_Current();i.Add(o.Position);for(var r=0,s=o.Neighbors,c=s.length,h=s[r];r<c;r++,h=s[r])h.IsRealNode||i.Add(h.Position)}return this.metroGraphData.Initialize(!1),Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing.FixRouting$$MetroGraphData$$BundlingSettings$$HashSet$1$Point(this.metroGraphData,this.bundlingSettings,i),!0},GetCirclesHierarchy:function(){for(var t=this.metroGraphData.VirtualNodes().GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),n.Radius=this.GetCurrentHubRadius(n);return Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,null,this.metroGraphData.VirtualNodes(),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({i:n,p:n.Position})})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({x0:n,r:System.Math.Max$$Double$$Double(n.get_i().Radius,5)})})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({x1:n,del:new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_r(),n.get_r())})})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({x2:n,b:new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_x1().get_x0().get_p(),n.get_del()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_x1().get_x0().get_p(),n.get_del()))})})),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,n.get_x2().get_x1().get_x0().get_i(),n.get_b())})))},GetCurrentHubRadius:function(n){var r,t;if(n.IsRealNode)return n.BoundaryCurve.get_BoundingBox().get_Diagonal()/2;r=n.cachedIdealRadius;t=this.metroGraphData.looseIntersections.GetMinimalDistanceToObstacles(n,n.Position,r);System.Diagnostics.Debug.Assert$$Boolean(t<=r);for(var i=0,u=n.Neighbors,e=u.length,f=u[i];i<e;i++,f=u[i])t=System.Math.Min$$Double$$Double(t,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,f.Position).get_Length());return t},TryToGlueNodes:function(n,t,i,r){System.Diagnostics.Debug.Assert$$Boolean(n!=t);var u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,t.Position).get_Length(),f=System.Math.Max$$Double$$Double(n.Radius,5),e=System.Math.Max$$Double$$Double(t.Radius,5);u>=f+e||this.TryGlueOrdered(n,t,r,i)||this.TryGlueOrdered(t,n,r,i)},TryGlueOrdered:function(n,t,i,r){return!r.ContainsKey(n)&&!i.Contains$$T(n)&&this.NodeGluingIsAllowed(n,t,r)?(this.Map(n,t,i,r),!0):!1},Map:function(n,t,i,r){r.set_Item$$TKey(n,t);i.Insert(t)},NodeGluingIsAllowed:function(n,t,i){for(var u,o,s,r=0,f=n.Neighbors,h=f.length,e=f[r];r<h;r++,e=f[r])if(u=Microsoft.Msagl.Routing.Spline.Bundling.NodePositionsAdjuster.Glued(e,i),o=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(u,n),!this.metroGraphData.cdtIntersections.EdgeIsLegal$$Station$$Station$$Point$$Point$$Set$1$Polyline(u,t,u.Position,t.Position,o))return!1;return(s=this.ComputeCostDeltaAfterNodeGluing(n,t,i),s<0)?!1:!0},ComputeCostDeltaAfterNodeGluing:function(n,t,i){var l=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,t.Position).get_Length(),u,h;if(n.Radius>=l||t.Radius>=l)return 1;for(var e=0,w=this.metroGraphData.get_Ink(),o=this.metroGraphData.get_Ink()-Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Position,n.Position).get_Length(),r=0,s=n.Neighbors,b=s.length,a=s[r];r<b;r++,a=s[r])u=Microsoft.Msagl.Routing.Spline.Bundling.NodePositionsAdjuster.Glued(a,i),o-=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.Position,n.Position).get_Length(),o+=this.metroGraphData.RealEdgeCount(u,t)==0?Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.Position,t.Position).get_Length():0;for(e+=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.InkError(w,o,this.bundlingSettings),h=this.metroGraphData.MetroNodeInfosOfNode(n).GetEnumerator();h.MoveNext();){var f=h.get_Current(),k=f.get_Metroline().get_Length(),c=f.get_Metroline().get_Length(),v=f.get_PolyPoint(),y=v.get_Prev(),p=v.get_Next();c-=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(y.get_Point(),n.Position).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(p.get_Point(),n.Position).get_Length();c+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(y.get_Point(),t.Position).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(p.get_Point(),t.Position).get_Length();e+=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.PathLengthsError(k,c,f.get_Metroline().get_IdealLength(),this.bundlingSettings)}return e},RegenerateEdge:function(n,t){var i=this.metroGraphData.get_Metrolines().get_Item$$Int32(t).get_Polyline();System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,i,$CreateAnonymousDelegate(this,function(t){return n.ContainsKey(this.metroGraphData.PointToStations.get_Item$$TKey(t))}))&&this.metroGraphData.get_Edges()[t].set_Curve(new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(Microsoft.Msagl.Routing.Spline.Bundling.NodePositionsAdjuster.GluedPolyline(System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,i,$CreateAnonymousDelegate(this,function(n){return this.metroGraphData.PointToStations.get_Item$$TKey(n)}))),n)))},UnglueEdgesFromBundleToSaveInk:function(n){var f=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.PointPair.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor),u,i,e,t,h;for(this.ink=this.metroGraphData.get_Ink(),this.polylineLength=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor,System.Double.ctor),u=this.metroGraphData.get_Metrolines().GetEnumerator();u.MoveNext();)for(t=u.get_Current(),this.polylineLength.set_Item$$TKey(t,t.get_Length()),i=t.get_Polyline().get_StartPoint();i.get_Next()!=null;i=i.get_Next())e=new Microsoft.Msagl.Core.Geometry.PointPair.ctor(i.get_Point(),i.get_Next().get_Point()),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor,Microsoft.Msagl.Core.Geometry.PointPair.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor,f,e,t);for(var o=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),r=!1,s=this.metroGraphData.get_Metrolines().GetEnumerator();s.MoveNext();)t=s.get_Current(),h=Microsoft.Msagl.Core.DataStructures.Set$1.op_Multiply(this.metroGraphData.PointToStations.get_Item$$TKey(t.get_Polyline().get_Start()).EnterableLoosePolylines,this.metroGraphData.PointToStations.get_Item$$TKey(t.get_Polyline().get_End()).EnterableLoosePolylines),this.TrySeparateOnPolyline(t,f,o,h)&&(r=!0);return r&&this.metroGraphData.Initialize(!1),(n||r)&&Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing.FixRouting$$MetroGraphData$$BundlingSettings$$HashSet$1$Point(this.metroGraphData,this.bundlingSettings,n?null:o),r},TrySeparateOnPolyline:function(n,t,i,r){for(var e=!1,f=!0,u;f;){for(f=!1,u=n.get_Polyline().get_StartPoint();u.get_Next()!=null&&u.get_Next().get_Next()!=null;u=u.get_Next())this.TryShortcutPolypoint(u,t,i,r)&&(f=!0);f&&(e=!0)}return e},TryShortcutPolypoint:function(n,t,i,r){return this.SeparationShortcutAllowed(n,t,r)?(i.Add(n.get_Point()),i.Add(n.get_Next().get_Point()),i.Add(n.get_Next().get_Next().get_Point()),this.RemoveShortcuttedPolypoint(n,t),!0):!1},SeparationShortcutAllowed:function(n,t,i){var r=n.get_Point(),f=n.get_Next().get_Point(),u=n.get_Next().get_Next().get_Point(),e=this.metroGraphData.PointToStations.get_Item$$TKey(r),h=this.metroGraphData.PointToStations.get_Item$$TKey(f),o=this.metroGraphData.PointToStations.get_Item$$TKey(u),s;return this.metroGraphData.cdtIntersections.EdgeIsLegal$$Station$$Station$$Point$$Point$$Set$1$Polyline(e,o,r,u,Microsoft.Msagl.Core.DataStructures.Set$1.op_Multiply(Microsoft.Msagl.Core.DataStructures.Set$1.op_Multiply(i,h.EnterableLoosePolylines),Microsoft.Msagl.Core.DataStructures.Set$1.op_Addition(e.EnterableLoosePolylines,o.EnterableLoosePolylines)))?(s=this.GetInkgain(n,t,r,f,u),s<0)?!1:!0:!1},GetInkgain:function(n,t,i,r,u){var h,c,f,a,d;(function(){var i={Value:h},r={Value:c},u={Value:f},e=this.FindPolylines(n,t,i,r,u);return h=i.Value,c=r.Value,f=u.Value,e}).call(this);var o=0,g=this.ink,l=this.ink,y=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r).get_Length(),p=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,u).get_Length(),w=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,u).get_Length();for(h.get_Count()==f.get_Count()&&(l-=y),c.get_Count()==f.get_Count()&&(l-=p),t.ContainsKey(new Microsoft.Msagl.Core.Geometry.PointPair.ctor(i,u))&&t.get_Item$$TKey(new Microsoft.Msagl.Core.Geometry.PointPair.ctor(i,u)).get_Count()!=0||(l+=w),o+=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.InkError(g,l,this.bundlingSettings),a=f.GetEnumerator();a.MoveNext();){var v=a.get_Current(),nt=this.polylineLength.get_Item$$TKey(v),b=this.polylineLength.get_Item$$TKey(v);b-=y+p-w;o+=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.PathLengthsError(nt,b,v.get_IdealLength(),this.bundlingSettings)}var e=this.GetCurrentHubRadius(this.metroGraphData.PointToStations.get_Item$$TKey(i)),k=this.metroGraphData.GetWidth$$IEnumerable$1$Metroline$$Double(f,this.bundlingSettings.get_EdgeSeparation()),tt=this.metroGraphData.GetWidth$$IEnumerable$1$Metroline$$Double(Microsoft.Msagl.Core.DataStructures.Set$1.op_Subtraction(h,f),this.bundlingSettings.get_EdgeSeparation()),s=Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.GetMinRadiusForTwoAdjacentBundles$$Double$$Point$$Point$$Point$$Double$$Double$$MetroGraphData$$BundlingSettings(e,i,u,r,k,tt,this.metroGraphData,this.bundlingSettings);return s>e&&(o-=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.RError(s,e,this.bundlingSettings)),e=this.GetCurrentHubRadius(this.metroGraphData.PointToStations.get_Item$$TKey(u)),d=this.metroGraphData.GetWidth$$IEnumerable$1$Metroline$$Double(Microsoft.Msagl.Core.DataStructures.Set$1.op_Subtraction(c,f),this.bundlingSettings.get_EdgeSeparation()),s=Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.GetMinRadiusForTwoAdjacentBundles$$Double$$Point$$Point$$Point$$Double$$Double$$MetroGraphData$$BundlingSettings(e,u,r,i,d,k,this.metroGraphData,this.bundlingSettings),s>e&&(o-=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.RError(s,e,this.bundlingSettings)),o},RemoveShortcuttedPolypoint:function(n,t){var r=n.get_Point(),e=n.get_Next().get_Point(),u=n.get_Next().get_Next().get_Point(),o,s,f,h,c,i;(function(){var i={Value:o},r={Value:s},u={Value:f},e=this.FindPolylines(n,t,i,r,u);return o=i.Value,s=r.Value,f=u.Value,e}).call(this);var l=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,e).get_Length(),a=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,u).get_Length(),v=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,u).get_Length();for(o.get_Count()==f.get_Count()&&(this.ink-=l),s.get_Count()==f.get_Count()&&(this.ink-=a),t.ContainsKey(new Microsoft.Msagl.Core.Geometry.PointPair.ctor(r,u))&&t.get_Item$$TKey(new Microsoft.Msagl.Core.Geometry.PointPair.ctor(r,u)).get_Count()!=0||(this.ink+=v),h=f.GetEnumerator();h.MoveNext();)i=h.get_Current(),this.polylineLength.set_Item$$TKey(i,this.polylineLength.get_Item$$TKey(i)-l+a-v);for(c=f.GetEnumerator();c.MoveNext();)i=c.get_Current(),this.RemovePolypoint(System.Linq.Enumerable.First$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor,i.get_Polyline().get_PolylinePoints(),$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Point(),e)}))),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.RemoveFromMap$3(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor,Microsoft.Msagl.Core.Geometry.PointPair.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor,t,new Microsoft.Msagl.Core.Geometry.PointPair.ctor(r,e),i),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.RemoveFromMap$3(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor,Microsoft.Msagl.Core.Geometry.PointPair.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor,t,new Microsoft.Msagl.Core.Geometry.PointPair.ctor(e,u),i),Microsoft.Msagl.Core.DataStructures.CollectionUtilities.AddToMap$3(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor,Microsoft.Msagl.Core.Geometry.PointPair.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor,t,new Microsoft.Msagl.Core.Geometry.PointPair.ctor(r,u),i)},FindPolylines:function(n,t,i,r,u){var e=n.get_Point(),f=n.get_Next().get_Point(),o=n.get_Next().get_Next().get_Point();i.Value=t.get_Item$$TKey(new Microsoft.Msagl.Core.Geometry.PointPair.ctor(e,f));r.Value=t.get_Item$$TKey(new Microsoft.Msagl.Core.Geometry.PointPair.ctor(f,o));u.Value=Microsoft.Msagl.Core.DataStructures.Set$1.op_Multiply(i.Value,r.Value)},RemovePolypoint:function(n){var t=n.get_Prev(),i=n.get_Next();t.set_Next(i);i.set_Prev(t)},GlueCollinearNeighbors$$Int32:function(n){for(var i=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),t=!1,r=this.metroGraphData.Stations.GetEnumerator(),u;r.MoveNext();)u=r.get_Current(),this.GlueCollinearNeighbors$$Station$$HashSet$1$Point$$Int32(u,i,n)&&(t=!0);return t&&(this.metroGraphData.Initialize(!1),Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing.FixRouting$$MetroGraphData$$BundlingSettings$$HashSet$1$Point(this.metroGraphData,this.bundlingSettings,i)),t},GlueCollinearNeighbors$$Station$$HashSet$1$Point$$Int32:function(n,t,i){var e,r,u,o,f;if(n.Neighbors.length<=1)return!1;for(e=new System.Collections.Generic.Dictionary$2.ctor(System.Tuple$2.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor),r=n.Neighbors,u=0;u<r.length;u++)this.TryToGlueEdges(n,r[u],r[(u+1)%r.length],e,i);if(e.get_Count()==0)return!1;for(o=e.GetEnumerator();o.MoveNext();)f=o.get_Current(),this.GlueEdge(f),t.Add(f.get_Key().get_Item1().Position),t.Add(f.get_Key().get_Item2().Position),t.Add(f.get_Value());return!0},TryToGlueEdges:function(n,t,i,r,u){var s,o;if(System.Diagnostics.Debug.Assert$$Boolean(t!=i),s=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point$$Point(t.Position,n.Position,i.Position),s<this.bundlingSettings.get_AngleThreshold()){var f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Position,n.Position).get_Length(),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.Position,n.Position).get_Length(),h=System.Math.Min$$Double$$Double(f,e)/System.Math.Max$$Double$$Double(f,e);if(h<.05)return;if(f<e){if(this.EdgeGluingIsAllowed$$Station$$Station$$Station(n,t,i)){this.AddEdgeToGlue(n,i,t,t.Position,r);return}}else if(this.EdgeGluingIsAllowed$$Station$$Station$$Station(n,i,t)){this.AddEdgeToGlue(n,t,i,i.Position,r);return}u<5&&h>.5&&(o=this.ConstructGluingPoint(n,t,i),this.EdgeGluingIsAllowed$$Station$$Station$$Station$$Point(n,t,i,o)&&this.AddEdgeToGlue(n,i,t,o,r))}},ConstructGluingPoint:function(n,t,i){var r=System.Math.Min$$Double$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Position,n.Position).get_Length(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.Position,n.Position).get_Length())/2,u=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Position,n.Position).Normalize(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.Position,n.Position).Normalize());return Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.Position,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(u,r),2))},EdgeGluingIsAllowed$$Station$$Station$$Station:function(n,t,i){var r,u,f,e;return t.IsRealNode||i.IsRealNode?!1:this.metroGraphData.cdtIntersections.EdgeIsLegal$$Station$$Station$$Point$$Point(t,i,t.Position,i.Position)?(r=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(n,i),u=Microsoft.Msagl.Routing.InteractiveEdgeRouter.IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.Position,t.Position),this.metroGraphData.get_LooseTree()),!System.Linq.Enumerable.All$1(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor,u,$CreateAnonymousDelegate(this,function(n){return System.Linq.Enumerable.Contains$1$$IEnumerable$1$$TSource(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,r,n.get_Segment1())})))?!1:(f=Microsoft.Msagl.Routing.InteractiveEdgeRouter.IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.Position,i.Position),this.metroGraphData.get_LooseTree()),!System.Linq.Enumerable.All$1(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor,f,$CreateAnonymousDelegate(this,function(n){return System.Linq.Enumerable.Contains$1$$IEnumerable$1$$TSource(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,r,n.get_Segment1())})))?!1:(e=this.ComputeCostDeltaAfterEdgeGluing(n,t,i,t.Position),e<0)?!1:!0:!1},EdgeGluingIsAllowed$$Station$$Station$$Station$$Point:function(n,t,i,r){if(!this.metroGraphData.looseIntersections.HubAvoidsObstacles$$Point$$Double$$Set$1$Polyline(r,0,Microsoft.Msagl.Core.DataStructures.Set$1.op_Multiply(t.EnterableLoosePolylines,i.EnterableLoosePolylines))||!this.metroGraphData.cdtIntersections.EdgeIsLegal$$Station$$Station$$Point$$Point(n,null,n.Position,r)||!this.metroGraphData.cdtIntersections.EdgeIsLegal$$Station$$Station$$Point$$Point(t,null,t.Position,r)||!this.metroGraphData.cdtIntersections.EdgeIsLegal$$Station$$Station$$Point$$Point(i,null,i.Position,r))return!1;var u=this.ComputeCostDeltaAfterEdgeGluing(n,t,i,r);return u<0?!1:!0},ComputeCostDeltaAfterEdgeGluing:function(n,t,i,r){var u=0,v=this.metroGraphData.get_Ink(),y=this.metroGraphData.get_Ink()-Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,i.Position).get_Length()-Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,t.Position).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,r).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,t.Position).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,i.Position).get_Length(),e,o;for(u+=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.InkError(v,y,this.bundlingSettings),e=this.metroGraphData.GetIjInfo(n,i).Metrolines.GetEnumerator();e.MoveNext();){var f=e.get_Current(),h=f.get_Length(),c=f.get_Length()-Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,i.Position).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,r).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,i.Position).get_Length();u+=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.PathLengthsError(h,c,f.get_IdealLength(),this.bundlingSettings)}for(o=this.metroGraphData.GetIjInfo(n,t).Metrolines.GetEnumerator();o.MoveNext();){var f=o.get_Current(),h=f.get_Length(),c=f.get_Length()-Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,t.Position).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,r).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,t.Position).get_Length();u+=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.PathLengthsError(h,c,f.get_IdealLength(),this.bundlingSettings)}var l=n.cachedIdealRadius,s=this.GetCurrentHubRadius(n),a=Microsoft.Msagl.Routing.Spline.Bundling.HubRadiiCalculator.GetMinRadiusForTwoAdjacentBundles$$Double$$Station$$Point$$Station$$Station$$MetroGraphData$$BundlingSettings(s,n,n.Position,t,i,this.metroGraphData,this.bundlingSettings);return a>s&&(u+=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.RError(a,s,this.bundlingSettings)),l>Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,r).get_Length()&&!n.IsRealNode&&(u-=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.RError(l,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,r).get_Length(),this.bundlingSettings)),u},AddEdgeToGlue:function(n,t,i,r,u){u.ContainsKey(new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,i,n))||u.ContainsKey(new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,t,n))||u.ContainsKey(new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,n,i))||u.ContainsKey(new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,n,t))||(u.set_Item$$TKey(new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,n,i),r),u.set_Item$$TKey(new System.Tuple$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,n,t),r))},GlueEdge:function(n){for(var f=n.get_Key().get_Item1(),i=n.get_Key().get_Item2(),r=n.get_Value(),u=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Spline.Bundling.MetroNodeInfo.ctor,Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor,f.MetroNodeInfos,$CreateAnonymousDelegate(this,function(n){return n.get_PolyPoint()})).GetEnumerator(),t;u.MoveNext();)t=u.get_Current(),t.get_Next()!=null&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(t.get_Next().get_Point(),i.Position)?this.SplitPolylinePoint(t,r):t.get_Prev()!=null&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(t.get_Prev().get_Point(),i.Position)&&this.SplitPolylinePoint(t.get_Prev(),r)},SplitPolylinePoint:function(n,t){if(!Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Point(),t)&&!Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Next().get_Point(),t)){var i=function(){var i=new Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor(t);return i.set_Polyline(n.get_Polyline()),i.set_Next(n.get_Next()),i.set_Prev(n),i}.call(this);i.get_Next().set_Prev(i);i.get_Prev().set_Next(i)}},RelaxConstrainedEdges:function(){for(var i=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),n=!1,r=this.metroGraphData.VirtualEdges().GetEnumerator(),t;r.MoveNext();)t=r.get_Current(),this.RelaxConstrainedEdge(t.get_Item1(),t.get_Item2(),i)&&(n=!0);return n&&(this.metroGraphData.Initialize(!1),Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing.FixRouting$$MetroGraphData$$BundlingSettings$$HashSet$1$Point(this.metroGraphData,this.bundlingSettings,i)),n},RelaxConstrainedEdge:function(n,t,i){var v=this.metroGraphData.GetWidth$$Station$$Station$$Double(n,t,this.bundlingSettings.get_EdgeSeparation()),e,s,h,c;if(function(){var i={Value:e},r=this.metroGraphData.cdtIntersections.BundleAvoidsObstacles(n,t,n.Position,t.Position,.99*v/2,i);return e=i.Value,r}.call(this),e.get_Count()>0){for(var o=-1,u=new Microsoft.Msagl.Core.Geometry.Point.ctor,l=e.GetEnumerator();l.MoveNext();){var f=l.get_Current(),y=System.Math.Min$$Double$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,f.get_Item2()).get_Length(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Position,f.get_Item2()).get_Length()),p=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,t.Position).get_Length(),w=y/p;w<.1||(s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.get_Item1(),f.get_Item2()).get_Length(),(o==-1||s<o)&&(o=s,u=f.get_Item2()))}if(o==-1||!this.metroGraphData.looseIntersections.HubAvoidsObstacles$$Point$$Double$$Set$1$Polyline(u,0,Microsoft.Msagl.Core.DataStructures.Set$1.op_Multiply(n.EnterableLoosePolylines,t.EnterableLoosePolylines)))return!1;for(i.Add(u),i.Add(n.Position),i.Add(t.Position),h=this.metroGraphData.GetIjInfo(n,t).Metrolines.GetEnumerator();h.MoveNext();){for(var b=h.get_Current(),r=null,a=b.get_Polyline().get_PolylinePoints().GetEnumerator();a.MoveNext();)if(c=a.get_Current(),Microsoft.Msagl.Core.Geometry.Point.op_Equality(c.get_Point(),n.Position)){r=c;break}System.Diagnostics.Debug.Assert$$Boolean(r!=null);r.get_Next()!=null&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(r.get_Next().get_Point(),t.Position)?this.SplitPolylinePoint(r,u):this.SplitPolylinePoint(r.get_Prev(),u)}return!0}return!1},RemoveDoublePathCrossings:function(){var n=new Microsoft.Msagl.Routing.Spline.Bundling.PathFixer.ctor(this.metroGraphData,$CreateDelegate(this.metroGraphData,this.metroGraphData.PointIsAcceptableForEdge)).Run();return n&&(this.metroGraphData.Initialize(!1),Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing.FixRouting$$MetroGraphData$$BundlingSettings(this.metroGraphData,this.bundlingSettings)),n}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$NodePositionsAdjuster);Microsoft$Msagl$Routing$Spline$Bundling$OrientedHubSegment={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.OrientedHubSegment",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.Segment=null;this.Reversed=!1;this.Index=0;this.BundleBase=null;this._Other=null;System.Object.ctor.call(this);this.Segment=n;this.Reversed=t;this.Index=i;this.BundleBase=r},Item$$:"Microsoft.Msagl.Core.Geometry.Point",get_Item$$Double:function(n){return this.Reversed?this.Segment.get_Item$$Double(this.Segment.get_ParEnd()-n):this.Segment.get_Item$$Double(n)},Other$$:"Microsoft.Msagl.Routing.Spline.Bundling.OrientedHubSegment",get_Other:function(){return this._Other},set_Other:function(n){this._Other=n}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$OrientedHubSegment);Microsoft$Msagl$Routing$Spline$Bundling$PathFixer={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.PathFixer",baseTypeName:"System.Object",staticDefinition:{RemoveSelfCyclesFromPolyline:function(n){for(var e,i,r,f=!1,u=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor),t=n.get_StartPoint();t!=null;t=t.get_Next())if(e=t.get_Point(),function(){var n={Value:i},t=u.TryGetValue(e,n);return i=n.Value,t}()){for(r=i.get_Next();r!=t.get_Next();r=r.get_Next())u.Remove(r.get_Point());i.set_Next(t.get_Next());t.get_Next().set_Prev(i);f=!0}else u.set_Item$$TKey(t.get_Point(),t);return f}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.metroGraphData=null;this.polylineAcceptsPoint=null;this.foundCrossings=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);this.crossingsThatShouldBecomeHubs=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);this.pointsToDelete=null;System.Object.ctor.call(this);this.metroGraphData=n;this.polylineAcceptsPoint=t},Vertices:function(){return System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.metroGraphData.get_Edges(),$CreateAnonymousDelegate(this,function(n){return Cast(n.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)})),$CreateAnonymousDelegate(this,function(n){return n.get_PolylinePoints()}))},Polylines$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_Polylines:function(){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.metroGraphData.get_Edges(),$CreateAnonymousDelegate(this,function(n){return Cast(n.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)}))},Edges:function(){for(var t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.PointPair.ctor),i=this.get_Polylines().GetEnumerator(),r,n;i.MoveNext();)for(r=i.get_Current(),n=r.get_StartPoint();n.get_Next()!=null;n=n.get_Next())t.Insert(Microsoft.Msagl.Routing.Spline.Bundling.FlipCollapser.OrderedPair$$PolylinePoint(n));return t},Run:function(){var t,i,r;if(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,this.metroGraphData.get_Edges())==0)return!1;for(var n=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.PointPair.ctor,System.Collections.Generic.List$1.ctor),u=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),f=this.Vertices().GetEnumerator();f.MoveNext();)t=f.get_Current(),i=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(t.get_Point()),i.Pad$$Double(Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()),u.Add$$Rectangle$$TData(i,t.get_Point());r=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnData(this.Edges(),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n.get_First(),n.get_Second())}));Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(Microsoft.Msagl.Core.Geometry.PointPair.ctor,r,r,$CreateAnonymousDelegate(this,function(t,i){this.IntersectTwoEdges(t,i,n,u)}));this.SortInsertedPoints(n);var e=this.InsertPointsIntoPolylines(n),o=this.FixPaths(),s=this.RemoveUnimportantCrossings();return o||e||s},FixPaths:function(){var n=!1;return this.RemoveSelfCycles()&&(n=!0),this.ReduceEdgeCrossings()&&(n=!0),n},SortInsertedPoints:function(n){for(var i=n.GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),this.SortInsideSegment(t.get_Key(),t.get_Value())},SortInsideSegment:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(t.get_Count()>0,"an edge should not be present with an empty list");t.Sort$$Comparison$1($CreateAnonymousDelegate(this,function(t,i){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n.get_First()).get_Length().CompareTo$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,n.get_First()).get_Length())}))},InsertPointsIntoPolylines:function(n){for(var t=!1,i=this.metroGraphData.get_Metrolines().GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),this.InsertPointsIntoPolyline(r,n)&&(t=!0);return t},InsertPointsIntoPolyline:function(n,t){for(var r=!1,i=n.get_Polyline().get_StartPoint();i.get_Next()!=null;i=i.get_Next())this.InsertPointsOnPolypoint(i,t,n)&&(r=!0);return r},InsertPointsOnPolypoint:function(n,t,i){var s=Microsoft.Msagl.Routing.Spline.Bundling.FlipCollapser.OrderedPair$$PolylinePoint(n),h=Microsoft.Msagl.Core.Geometry.Point.op_Inequality(n.get_Point(),s.get_First()),u,e,o,r,f;if(!function(){var n={Value:u},i=t.TryGetValue(s,n);return u=n.Value,i}.call(this))return!1;if(e=n.get_Next(),o=n.get_Polyline(),h)for(r=u.get_Count()-1;r>=0;r--)(this.polylineAcceptsPoint==null||this.polylineAcceptsPoint(i,u.get_Item$$Int32(r)))&&(f=function(){var t=new Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor(u.get_Item$$Int32(r));return t.set_Prev(n),t.set_Polyline(o),t}.call(this),n.set_Next(f),n=f);else for(r=0;r<u.get_Count();r++)(this.polylineAcceptsPoint==null||this.polylineAcceptsPoint(i,u.get_Item$$Int32(r)))&&(f=function(){var t=new Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor(u.get_Item$$Int32(r));return t.set_Prev(n),t.set_Polyline(o),t}.call(this),n.set_Next(f),n=f);return n.set_Next(e),e.set_Prev(n),!0},RemoveSelfCycles:function(){for(var n=!1,t=this.get_Polylines().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),Microsoft.Msagl.Routing.Spline.Bundling.PathFixer.RemoveSelfCyclesFromPolyline(i)&&(n=!0);return n},ReduceEdgeCrossings:function(){var n=new Microsoft.Msagl.Routing.Spline.Bundling.FlipSwitcher.ctor(this.metroGraphData);return n.Run(),this.crossingsThatShouldBecomeHubs.InsertRange(n.GetChangedHubs()),n.NumberOfReducedCrossings()>0},RemoveUnimportantCrossings:function(){var t=!1,n,i;for(this.pointsToDelete=Microsoft.Msagl.Core.DataStructures.Set$1.op_Subtraction(this.foundCrossings,this.crossingsThatShouldBecomeHubs),n=this.get_Polylines().GetEnumerator();n.MoveNext();)i=n.get_Current(),this.RemoveUnimportantCrossingsFromPolyline(i)&&(t=!0);return t},RemoveUnimportantCrossingsFromPolyline:function(n){for(var i,r,u=!1,t=n.get_StartPoint().get_Next();t!=null&&t.get_Next()!=null;t=t.get_Next())this.pointsToDelete.Contains$$T(t.get_Point())&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Prev().get_Point(),t.get_Point(),t.get_Next().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear&&(i=t.get_Prev(),r=t.get_Next(),i.set_Next(r),r.set_Prev(i),t=i,u=!0);return u},IntersectTwoEdges:function(n,t,i,r){var f,u;(function(){var i={Value:f},r=Microsoft.Msagl.Core.Geometry.Curves.LineSegment.Intersect(n.get_First(),n.get_Second(),t.get_First(),t.get_Second(),i);return f=i.Value,r}).call(this)&&(u=this.FindExistingVertexOrCreateNew(r,f),this.AddVertexToSplittingList(n,i,u)|this.AddVertexToSplittingList(t,i,u)&&this.foundCrossings.Insert(u))},FindExistingVertexOrCreateNew:function(n,t){var r=n.get_RootNode().FirstHitNode$$Point(t),i;return r!=null?r.get_UserData():(i=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(t),i.Pad$$Double(Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()),n.Add$$Rectangle$$TData(i,t),t)},AddVertexToSplittingList:function(n,t,i){if(!Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(i,n.get_First())&&!Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(i,n.get_Second())){var r;if(function(){var i={Value:r},u=t.TryGetValue(n,i);return r=i.Value,u}.call(this)||t.set_Item$$TKey(n,r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor)),!r.Contains(i))return r.Add(i),!0}return!1}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$PathFixer);Microsoft$Msagl$Routing$Spline$Bundling$PointPairOrder={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.PointPairOrder",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.Metrolines=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor);this.orderFixed=!1;this.LineIndexInOrder=null;System.Object.ctor.call(this)},Add:function(n){this.Metrolines.Add(n)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$PointPairOrder);Microsoft$Msagl$Routing$Spline$Bundling$SimulatedAnnealing={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing.MaxIterations=100;Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing.MaxStep=50;Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing.MinStep=1;Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing.MinRelativeChange=.0005},FixRouting$$MetroGraphData$$BundlingSettings:function(n,t){return Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing.FixRouting$$MetroGraphData$$BundlingSettings$$HashSet$1$Point(n,t,null)},FixRouting$$MetroGraphData$$BundlingSettings$$HashSet$1$Point:function(n,t,i){return new Microsoft.Msagl.Routing.Spline.Bundling.SimulatedAnnealing.ctor(n,t).FixRouting$$HashSet$1$Point(i)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.metroGraphData=null;this.bundlingSettings=null;this.costCalculator=null;this.cache=null;this.stationsForOptimizations=null;this.stepsWithProgress=0;System.Object.ctor.call(this);this.metroGraphData=n;this.bundlingSettings=t;this.costCalculator=new Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.ctor(n,t);this.cache=new Microsoft.Msagl.Routing.Spline.Bundling.IntersectionCache.ctor(n,t,this.costCalculator,n.Cdt)},FixRouting$$HashSet$1$Point:function(n){var u,e,o;this.stationsForOptimizations=this.GetStationsForOptimizations(n);this.cache.InitializeCostCache();for(var t=50,i=Infinity,r=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,this.metroGraphData.VirtualNodes(),$CreateAnonymousDelegate(this,function(n){return n.Position}))),f=0;f++<100;){if(u=this.TryMoveNodes(),f<=1&&!u)return!1;if(!u)break;if(e=i,i=Microsoft.Msagl.Routing.Spline.Bundling.CostCalculator.Cost(this.metroGraphData,this.bundlingSettings),t=this.UpdateMaxStep(t,e,i),o=r,r=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,this.metroGraphData.VirtualNodes(),$CreateAnonymousDelegate(this,function(n){return n.Position}))),t<1||this.Converged(t,o,r))break}return!0},GetStationsForOptimizations:function(n){var t,i,r,u;if(n==null)return new System.Collections.Generic.HashSet$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,this.metroGraphData.VirtualNodes());for(t=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor),i=n.GetEnumerator();i.MoveNext();)r=i.get_Current(),this.metroGraphData.PointToStations.ContainsKey(r)&&(u=this.metroGraphData.PointToStations.get_Item$$TKey(r),u.IsRealNode||t.Add(u));return t},Converged:function(n,t,i){for(var e,u=0,f=0,r=0;r<t.get_Count();r++)u+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Item$$Int32(r),i.get_Item$$Int32(r)).get_LengthSquared(),f+=t.get_Item$$Int32(r).get_LengthSquared();return e=System.Math.Sqrt(u/f),e<.0005},UpdateMaxStep:function(n,t,i){var r=.8;return i+1<t?(this.stepsWithProgress++,this.stepsWithProgress>=5&&(this.stepsWithProgress=0,n=System.Math.Min$$Double$$Double(50,n/r))):(this.stepsWithProgress=0,n*=r),n},TryMoveNodes:function(){for(var f=!1,i=new System.Collections.Generic.HashSet$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor),e=this.stationsForOptimizations.GetEnumerator(),n;e.MoveNext();)if(n=e.get_Current(),this.TryMoveNode(n)){System.Diagnostics.Debug.Assert$$Boolean(this.stationsForOptimizations.Contains(n));f=!0;i.Add(n);for(var t=0,r=n.Neighbors,o=r.length,u=r[t];t<o;t++,u=r[t])u.IsRealNode||i.Add(u)}return this.stationsForOptimizations=i,f},TryMoveNode:function(n){var t=this.BuildDirection(n),i,u,r;return t.get_Length()==0?!1:(i=this.BuildStepLength(n,t),i<1&&(t=Microsoft.Msagl.Core.Geometry.Point.RandomPoint(),i=this.BuildStepLength(n,t),i<1))?!1:(u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t,i),r=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.Position,u),this.metroGraphData.PointToStations.ContainsKey(r))?!1:(this.metroGraphData.MoveNode(n,r),this.cache.UpdateCostCache(n),!0)},BuildDirection:function(n){var i=this.BuildForceForInk(n),r=this.BuildForceForPathLengths(n),u=this.BuildForceForRadius(n),f=this.BuildForceForBundle(n),t=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,r),u),f);return t.get_Length()<.1?new Microsoft.Msagl.Core.Geometry.Point.ctor:t.Normalize()},BuildStepLength:function(n,t){var i=1,r=this.CostGain(n,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.Position,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t,i))),u;if(r<.01)return 0;while(2*i<=50){if(u=this.CostGain(n,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.Position,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t,i),2))),u<=r)break;i*=2;r=u}return i},CostGain:function(n,t){var i=-12345678,u=this.costCalculator.RadiusGain(n,t),r,f,e;return u<i?i:(r=this.costCalculator.BundleGain(n,t),r<i)?i:(f=this.costCalculator.InkGain(n,t),e=this.costCalculator.PathLengthsGain(n,t),u+f+e+r)},BuildForceForInk:function(n){for(var u,i=new Microsoft.Msagl.Core.Geometry.Point.ctor,t=0,r=n.Neighbors,e=r.length,f=r[t];t<e;t++,f=r[t])u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.Position,n.Position),i=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(u,u.get_Length()));return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(i,this.bundlingSettings.get_InkImportance())},BuildForceForPathLengths:function(n){for(var t=new Microsoft.Msagl.Core.Geometry.Point.ctor,r=this.metroGraphData.MetroNodeInfosOfNode(n).GetEnumerator();r.MoveNext();){var i=r.get_Current(),u=i.get_Metroline(),o=i.get_PolyPoint().get_Next().get_Point(),s=i.get_PolyPoint().get_Prev().get_Point(),f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(o,n.Position),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(s,n.Position);t=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(f,f.get_Length()*u.get_IdealLength()));t=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(e,e.get_Length()*u.get_IdealLength()))}return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t,this.bundlingSettings.get_PathLengthImportance())},BuildForceForRadius:function(n){var t=new Microsoft.Msagl.Core.Geometry.Point.ctor,i=n.cachedIdealRadius,r,h=function(){var t={Value:r},u=this.metroGraphData.looseIntersections.HubAvoidsObstacles$$Station$$Point$$Double$$List$1(n,n.Position,i,t);return r=t.Value,u}.call(this),u,f,e,o,s;for(System.Diagnostics.Debug.Assert$$Boolean(h),u=r.GetEnumerator();u.MoveNext();)f=u.get_Current(),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.get_Item2(),n.Position).get_Length(),System.Diagnostics.Debug.Assert$$Boolean(e<=i),o=2*(1-e/i),s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Position,f.get_Item2()).Normalize(),t=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(s,o));return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t,this.bundlingSettings.get_HubRepulsionImportance())},BuildForceForBundle:function(n){for(var u,o,c,s,t,h,l,a,f=new Microsoft.Msagl.Core.Geometry.Point.ctor,i=0,e=n.Neighbors,v=e.length,r=e[i];i<v;i++,r=e[i])for(u=this.metroGraphData.GetWidth$$Station$$Station$$Double(n,r,this.bundlingSettings.get_EdgeSeparation()),c=function(){var t={Value:o},i=this.metroGraphData.cdtIntersections.BundleAvoidsObstacles(n,r,n.Position,r.Position,u/2,t);return o=t.Value,i}.call(this),!c,s=o.GetEnumerator();s.MoveNext();)t=s.get_Current(),h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Item1(),t.get_Item2()).get_Length(),System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.LessOrEqual(h,u/2)),l=2*(1-h/(u/2)),a=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Item1(),t.get_Item2()).Normalize()),f=Microsoft.Msagl.Core.Geometry.Point.op_Addition(f,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(a,l));return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(f,this.bundlingSettings.get_BundleRepulsionImportance())}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$SimulatedAnnealing);Microsoft$Msagl$Routing$Spline$Bundling$Station={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.Station",baseTypeName:"System.Object",staticDefinition:{op_LessThan:function(n,t){return System.Diagnostics.Debug.Assert$$Boolean(n==t||n.SerialNumber!=t.SerialNumber),n.SerialNumber<t.SerialNumber},op_GreaterThan:function(n,t){return System.Diagnostics.Debug.Assert$$Boolean(n==t||n.SerialNumber!=t.SerialNumber),n.SerialNumber>t.SerialNumber}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.SerialNumber=0;this.IsRealNode=!1;this.Radius=0;this.Position=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Neighbors=null;this.BundleBases=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Station.ctor,Microsoft.Msagl.Routing.Spline.Bundling.BundleBase.ctor);this.EnterableTightPolylines=null;this.EnterableLoosePolylines=null;this.MetroNodeInfos=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.MetroNodeInfo.ctor);this.BoundaryCurve=null;this.CdtTriangle=null;this.cachedRadiusCost=0;this.cachedBundleCost=0;this.cachedIdealRadius=0;System.Object.ctor.call(this);this.SerialNumber=n;this.IsRealNode=t;this.Position=i},AddEnterableLoosePolyline:function(n){Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(this.EnterableLoosePolylines,null)&&(this.EnterableLoosePolylines=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor));this.EnterableLoosePolylines.Insert(n)},AddEnterableTightPolyline:function(n){Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(this.EnterableTightPolylines,null)&&(this.EnterableTightPolylines=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor));this.EnterableTightPolylines.Insert(n)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$Station);Microsoft$Msagl$Routing$Spline$Bundling$StationEdgeInfo={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.StationEdgeInfo",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.Count=0;this.Width=0;this.Metrolines=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.Bundling.Metroline.ctor);this.cachedBundleCost=0;System.Object.ctor.call(this);var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),r=i.get_Length();r>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(i=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(i,r))}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$StationEdgeInfo);Microsoft$Msagl$Routing$Spline$Bundling$TimeMeasurer={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.TimeMeasurer",baseTypeName:"System.Object",staticDefinition:{DebugOutput:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$TimeMeasurer);Microsoft$Msagl$Routing$TightLooseCouple={fullname:"Microsoft.Msagl.Routing.TightLooseCouple",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this._TightPolyline=null;this._LooseShape=null;this._Distance=0;System.Object.ctor.call(this);this.set_TightPolyline(n);this.set_LooseShape(t);this.set_Distance(i)},TightPolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_TightPolyline:function(){return this._TightPolyline},set_TightPolyline:function(n){this._TightPolyline=n},LooseShape$$:"Microsoft.Msagl.Routing.Shape",get_LooseShape:function(){return this._LooseShape},set_LooseShape:function(n){this._LooseShape=n},Distance$$:"System.Double",get_Distance:function(){return this._Distance},set_Distance:function(n){this._Distance=n},GetHashCode:function(){if(this.get_TightPolyline()==null)throw $CreateException(new System.InvalidOperationException.ctor,new Error);return this.get_TightPolyline().GetHashCode()},Equals$$Object:function(n){var t=As(n,Microsoft.Msagl.Routing.TightLooseCouple.ctor);return t==null?!1:this.get_TightPolyline()==t.get_TightPolyline()},toString:function(){return(this.get_TightPolyline()==null?"null":this.get_TightPolyline().toString().substr(0,5))+","+(this.get_LooseShape()==null?"null":this.get_LooseShape().toString().substr(0,5))}}};JsTypes.push(Microsoft$Msagl$Routing$TightLooseCouple);Microsoft$Msagl$Routing$StraightLineEdges={fullname:"Microsoft.Msagl.Routing.StraightLineEdges",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},RouteEdge:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edge");var i=n.get_EdgeGeometry();i.get_SourcePort()==null&&i.set_SourcePort(function(n){return new Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point(function(){return n.get_Source().get_BoundaryCurve()},function(){return n.get_Source().get_Center()})}(n));i.get_TargetPort()==null&&i.set_TargetPort(function(n){return new Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point(function(){return n.get_Target().get_BoundaryCurve()},function(){return n.get_Target().get_Center()})}(n));Microsoft.Msagl.Routing.StraightLineEdges.ContainmentLoop(i,t)||i.set_Curve(Microsoft.Msagl.Routing.StraightLineEdges.GetEdgeLine(n));Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(i,i.get_SourcePort().get_Curve(),i.get_TargetPort().get_Curve(),n.get_Curve(),!1,!1)},ContainmentLoop:function(n,t){var u=n.get_SourcePort().get_Curve(),f=n.get_TargetPort().get_Curve();if(u==null||f==null)return!1;var i=u.get_BoundingBox(),r=f.get_BoundingBox(),e=i.Contains$$Rectangle(r),o=!e&&r.Contains$$Rectangle(i);return e||o?(n.set_Curve(Microsoft.Msagl.Routing.StraightLineEdges.CreateLoop$$Rectangle$$Rectangle$$Boolean$$Double(i,r,o,t)),!0):!1},CreateLoop$$Rectangle$$Rectangle$$Boolean$$Double:function(n,t,i,r){return i?Microsoft.Msagl.Routing.StraightLineEdges.CreateLoop$$Rectangle$$Rectangle$$Double$$Boolean(n,t,r,!1):Microsoft.Msagl.Routing.StraightLineEdges.CreateLoop$$Rectangle$$Rectangle$$Double$$Boolean(t,n,r,!0)},CreateLoop$$Rectangle$$Rectangle$$Double$$Boolean:function(n,t,i,r){var u=n.get_Center(),f=Microsoft.Msagl.Routing.StraightLineEdges.FindClosestPointOnBoxBoundary(n.get_Center(),t),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,u),y=System.Math.Abs$$Double(e.get_X())<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon,p=(y?System.Math.Min$$Double$$Double(u.get_Y()-t.get_Bottom(),t.get_Top()-u.get_Y()):System.Math.Min$$Double$$Double(u.get_X()-t.get_Left(),t.get_Right()-u.get_X()))/2,o=System.Math.Min$$Double$$Double(i,p);e.get_Length()<=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1,0));var c=e.Normalize(),s=c.Rotate(1.5707963267949),h=Microsoft.Msagl.Core.Geometry.Point.op_Addition(f,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(c,i)),l=Microsoft.Msagl.Core.Geometry.Point.op_Addition(h,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(s,o)),a=Microsoft.Msagl.Core.Geometry.Point.op_Addition(f,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(s,o)),v=Microsoft.Msagl.Core.Geometry.Point.op_Addition(u,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(s,o)),w=r?Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints([v,a,l,h,f,u]):Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints([u,f,h,l,a,v]);return w.CreateCurve()},FindClosestPointOnBoxBoundary:function(n,t){var i=n.get_X()-t.get_Left()<t.get_Right()-n.get_X()?t.get_Left():t.get_Right(),r=n.get_Y()-t.get_Bottom()<t.get_Top()-n.get_Y()?t.get_Bottom():t.get_Top();return System.Math.Abs$$Double(i-n.get_X())<System.Math.Abs$$Double(r-n.get_Y())?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i,n.get_Y()):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_X(),r)},GetEdgeLine:function(n){var u,f,e,o,t,i,r;return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edge"),n.get_SourcePort()==null?(u=n.get_Source().get_Center(),f=n.get_Source().get_BoundaryCurve()):(u=n.get_SourcePort().get_Location(),f=n.get_SourcePort().get_Curve()),n.get_TargetPort()==null?(e=n.get_Target().get_Center(),o=n.get_Target().get_BoundaryCurve()):(e=n.get_TargetPort().get_Location(),o=n.get_TargetPort().get_Curve()),t=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u,e),i=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(f,t,!1),i.get_Count()>0&&(r=Cast(t.Trim(i.get_Item$$Int32(0).get_Par1(),1),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor),r!=null&&(t=r,i=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(o,t,!1),i.get_Count()>0&&(r=Cast(t.Trim(0,i.get_Item$$Int32(0).get_Par1()),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor),r!=null&&(t=r)))),t},CreateSimpleEdgeCurveWithUnderlyingPolyline:function(n){var t,i,r,u;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edge");t=n.get_Source().get_Center();i=n.get_Target().get_Center();n.get_Source()==n.get_Target()?(r=.666666666666667*n.get_Source().get_BoundaryCurve().get_BoundingBox().get_Width(),u=n.get_Source().get_BoundingBox().get_Height()/4,n.set_UnderlyingPolyline(Microsoft.Msagl.Routing.StraightLineEdges.CreateUnderlyingPolylineForSelfEdge(t,r,u)),n.set_Curve(n.get_UnderlyingPolyline().CreateCurve())):(n.set_UnderlyingPolyline(Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints([t,i])),n.set_Curve(n.get_UnderlyingPolyline().CreateCurve()));Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(n.get_EdgeGeometry(),n.get_Source().get_BoundaryCurve(),n.get_Target().get_BoundaryCurve(),n.get_Curve(),!1,!1)},CreateUnderlyingPolylineForSelfEdge:function(n,t,i){var u=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,i)),f=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,i)),e=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,-i)),o=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,-i)),r=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Point(n),s=new Microsoft.Msagl.Core.Geometry.SmoothedPolyline.ctor(r);return r=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(r,u),r=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(r,f),r=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(r,e),r=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(r,o),new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(r,n),s},SetStraightLineEdgesWithUnderlyingPolylines:function(n){var t,i;for(Microsoft.Msagl.Routing.SplineRouter.CreatePortsIfNeeded(n.get_Edges()),t=n.get_Edges().GetEnumerator();t.MoveNext();)i=t.get_Current(),Microsoft.Msagl.Routing.StraightLineEdges.CreateSimpleEdgeCurveWithUnderlyingPolyline(i)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.edges=null;this.padding=0;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.edges=n;this.padding=t},RunInternal:function(){var n,t;for(this.StartListenToLocalProgress(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,this.edges),1),Microsoft.Msagl.Routing.SplineRouter.CreatePortsIfNeeded(this.edges),n=this.edges.GetEnumerator();n.MoveNext();)t=n.get_Current(),Microsoft.Msagl.Routing.StraightLineEdges.RouteEdge(t,this.padding),this.ProgressStep()}}};JsTypes.push(Microsoft$Msagl$Routing$StraightLineEdges);Microsoft$Msagl$Core$GraphAlgorithms$ConnectedComponentCalculator$1={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1",baseTypeName:"System.Object",staticDefinition:{GetComponents:function(n){for(var i,u,f,e,s,o=[],r=new Array(n.get_NodeCount()),t=0;t<n.get_NodeCount();t++)r[t]=!1;for(i=new System.Collections.Generic.Queue$1.ctor(System.Int32.ctor),t=0;t<n.get_NodeCount();t++)if(!r[t]){for(u=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.Enqueue(t,i,r);i.get_Count()>0;)for(f=i.Dequeue(),u.Add(f),e=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.Neighbors(n,f).GetEnumerator();e.MoveNext();)s=e.get_Current(),Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.Enqueue(s,i,r);o.push(u)}return o},Neighbors:function(n,t){for(var r=[],f=n.OutEdges(t).GetEnumerator(),u,i;f.MoveNext();)i=f.get_Current(),r.push(i.get_Target());for(u=n.InEdges(t).GetEnumerator();u.MoveNext();)i=u.get_Current(),r.push(i.get_Source());return r},Enqueue:function(n,t,i){i[n]==!1&&(t.Enqueue(n),i[n]=!0)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.TEdge=n;System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$ConnectedComponentCalculator$1);Microsoft$Msagl$Core$GraphAlgorithms$CycleRemoval$1={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval$1",baseTypeName:"System.Object",staticDefinition:{GetFeedbackSetWithConstraints:function(n,t){return Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(t,null)||t.get_Count()==0?Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval$1.GetFeedbackSet(n):Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval$1.GetFeedbackSetWithConstraintsLocal(n,t)},GetFeedbackSetWithConstraintsLocal:function(n,t){var i=new Microsoft.Msagl.Core.GraphAlgorithms.CycleRemovalWithConstraints$1.ctor(this.TEdge,n,t);return i.GetFeedbackSet()},Push:function(n,t,i,r,u){i[r]=Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval.VertStatus$1.InStack;n.Push(u);t.Push(r)},Pop:function(n,t,i,r,u){u.Value=n.Pop();r.Value=t.Pop();i[r.Value]=Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval.VertStatus$1.Visited},GetFeedbackSet:function(n){var o,i,f,t,u,h;if(n!=null&&n.get_NodeCount()>0&&n.get_Edges().get_Count()>0){for(o=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IEdge.ctor),i=new Array(n.get_NodeCount()),f=0;f<i.length;f++)i[f]=Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval.VertStatus$1.NotVisited;for(t=0;t<n.get_NodeCount();t++)if(i[t]!=Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval.VertStatus$1.Visited){System.Diagnostics.Debug.Assert$$Boolean(i[t]!=Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval.VertStatus$1.InStack);var e=new System.Collections.Generic.Stack$1.ctor(System.Collections.Generic.IEnumerator$1.ctor),s=new System.Collections.Generic.Stack$1.ctor(System.Int32.ctor),r=n.OutEdges(t).GetEnumerator();for(Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval$1.Push(e,s,i,t,r);e.get_Count()>0;)for(function(){var n={Value:t},u={Value:r},f=Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval$1.Pop(e,s,i,n,u);return t=n.Value,r=u.Value,f}();r.MoveNext();)(u=r.get_Current(),u.get_Source()!=u.get_Target())&&(h=i[u.get_Target()],h==Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval.VertStatus$1.InStack?o.Insert(u):h==Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval.VertStatus$1.NotVisited&&(Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval$1.Push(e,s,i,t,r),t=u.get_Target(),i[u.get_Target()]=Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval.VertStatus$1.Visited,r=n.OutEdges(t).GetEnumerator()))}return As(o,System.Collections.Generic.IEnumerable$1.ctor)}return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IEdge.ctor)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.TEdge=n;System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$CycleRemoval$1);Microsoft$Msagl$Core$GraphAlgorithms$CycleRemovalWithConstraints$1={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.CycleRemovalWithConstraints$1",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.TEdge=n;this.graph=null;this.graphOfConstraints=null;this.constrainedEdges=null;System.Object.ctor.call(this);this.graph=t;this.constrainedEdges=i;this.graphOfConstraints=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.constrainedEdges,t.get_NodeCount())},GetFeedbackSet:function(){for(var t=[],i=this.CreateGraphsForCycleRemoval().GetEnumerator(),r,n,u;i.MoveNext();)for(r=i.get_Current(),n=this.GetFeedbackEdgeSet(r).GetEnumerator();n.MoveNext();)u=n.get_Current(),t.push(u);return t},GetFeedbackEdgeSet:function(n){var s=[],i,r,t,f,o,e;for(n.Initialize(),i=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),r=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);!n.IsEmpty();){while(function(){var i={Value:t},r=n.TryGetSink(i);return t=i.Value,r}.call(this))n.RemoveNode(t),r.Add(t);while(function(){var i={Value:t},r=n.TryGetSource(i);return t=i.Value,r}.call(this))n.RemoveNode(t),i.Add(t);(function(){var i={Value:t},r=n.TryFindVertexWithNoIncomingConstrainedEdgeAndMaximumOutDegreeMinusInDedree(i);return t=i.Value,r}).call(this)&&(n.RemoveNode(t),i.Add(t))}for(var u=new System.Collections.Generic.Dictionary$2.ctor$$Int32(System.Int32.ctor,System.Int32.ctor,i.get_Count()+r.get_Count()),h=0,c=i.GetEnumerator();c.MoveNext();)t=c.get_Current(),u.set_Item$$TKey(t,h++);for(f=r.get_Count()-1;f>=0;f--)u.set_Item$$TKey(r.get_Item$$Int32(f),h++);for(o=n.GetOriginalIntPairs().GetEnumerator();o.MoveNext();)e=o.get_Current(),u.get_Item$$TKey(e.get_First())>u.get_Item$$TKey(e.get_Second())&&s.push(e);return s},CreateGraphsForCycleRemoval:function(){for(var n=[],t=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(this.GetCommonGraph()).GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.push(this.CreateGraphForCycleRemoval(i));return n},GetCommonGraph:function(){return new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(this.TEdge,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.graph.get_Edges(),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Source(),n.get_Target())})),this.constrainedEdges),this.graph.get_NodeCount())},CreateGraphForCycleRemoval:function(n){for(var t=new Microsoft.Msagl.Core.GraphAlgorithms.GraphForCycleRemoval.ctor,e=n.GetEnumerator(),i,r,u,f,o;e.MoveNext();){for(i=e.get_Current(),r=this.graph.OutEdges(i).GetEnumerator();r.MoveNext();)u=r.get_Current(),t.AddEdge(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(u.get_Source(),u.get_Target()));for(f=this.graphOfConstraints.OutEdges(i).GetEnumerator();f.MoveNext();)o=f.get_Current(),t.AddConstraintEdge(o)}return t}}};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$CycleRemovalWithConstraints$1);Microsoft$Msagl$Core$GraphAlgorithms$GraphForCycleRemoval={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.GraphForCycleRemoval",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.deltaDegreeBucketsForSourcesInConstrainedSubgraph=new System.Collections.Generic.SortedDictionary$2.ctor(System.Int32.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor);this.nodeInfoDictionary=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,Microsoft.Msagl.Core.GraphAlgorithms.NodeInfo.ctor);this.sources=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor);this.sinks=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor);this.edgesToKeep=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor);System.Object.ctor.call(this)},AddEdge:function(n){this.edgesToKeep.Insert(n);var t=n.get_First(),i=n.get_Second();this.GetOrCreateNodeInfo(t).AddOutEdge(i);this.GetOrCreateNodeInfo(i).AddInEdge(t)},GetOrCreateNodeInfo:function(n){var t;return function(){var i={Value:t},r=this.nodeInfoDictionary.TryGetValue(n,i);return t=i.Value,r}.call(this)||(t=new Microsoft.Msagl.Core.GraphAlgorithms.NodeInfo.ctor,this.nodeInfoDictionary.set_Item$$TKey(n,t)),t},AddConstraintEdge:function(n){var t=n.get_First(),i=n.get_Second();this.GetOrCreateNodeInfo(t).AddOutConstrainedEdge(i);this.GetOrCreateNodeInfo(i).AddInConstrainedEdge(t)},IsEmpty:function(){return this.nodeInfoDictionary.get_Count()==0},RemoveNode:function(n){var i,t;this.sources.Remove(n);this.sinks.Remove(n);this.RemoveNodeFromItsBucket(n);for(var r=this.nodeInfoDictionary.get_Item$$TKey(n),u=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(System.Int32.ctor,r.get_AllNeighbors()),f=u.GetEnumerator();f.MoveNext();)t=f.get_Current(),this.RemoveNodeFromItsBucket(t);for(this.DisconnectNodeFromGraph(n,r),i=u.GetEnumerator();i.MoveNext();)t=i.get_Current(),this.AddNodeToBucketsSourcesAndSinks(t,this.nodeInfoDictionary.get_Item$$TKey(t))},DisconnectNodeFromGraph:function(n,t){for(var e=t.get_OutEdges().GetEnumerator(),r,u,f,i;e.MoveNext();)i=e.get_Current(),this.nodeInfoDictionary.get_Item$$TKey(i).RemoveInEdge(n);for(r=t.get_OutConstrainedEdges().GetEnumerator();r.MoveNext();)i=r.get_Current(),this.nodeInfoDictionary.get_Item$$TKey(i).RemoveInConstrainedEdge(n);for(u=t.get_InEdges().GetEnumerator();u.MoveNext();)i=u.get_Current(),this.nodeInfoDictionary.get_Item$$TKey(i).RemoveOutEdge(n);for(f=t.get_InConstrainedEdges().GetEnumerator();f.MoveNext();)i=f.get_Current(),this.nodeInfoDictionary.get_Item$$TKey(i).RemoveOutConstrainedEdge(n);this.nodeInfoDictionary.Remove(n)},RemoveNodeFromItsBucket:function(n){var i=this.DeltaDegree(n),t;(function(){var n={Value:t},r=this.deltaDegreeBucketsForSourcesInConstrainedSubgraph.TryGetValue(i,n);return t=n.Value,r}).call(this)&&(t.Remove(n),t.get_Count()==0&&this.deltaDegreeBucketsForSourcesInConstrainedSubgraph.Remove(i))},DeltaDegree:function(n){return this.nodeInfoDictionary.get_Item$$TKey(n).get_DeltaDegree()},TryFindVertexWithNoIncomingConstrainedEdgeAndMaximumOutDegreeMinusInDedree:function(n){var r=this.deltaDegreeBucketsForSourcesInConstrainedSubgraph.GetEnumerator(),t,i;return r.MoveNext()?(t=r.get_Current().get_Value(),System.Diagnostics.Debug.Assert$$Boolean(t.get_Count()>0),i=t.GetEnumerator(),i.MoveNext(),n.Value=i.get_Current(),!0):(n.Value=-1,!1)},TryGetSource:function(n){var t=this.sources.GetEnumerator();return t.MoveNext()?(n.Value=t.get_Current(),!0):(n.Value=-1,!1)},TryGetSink:function(n){var t=this.sinks.GetEnumerator();return t.MoveNext()?(n.Value=t.get_Current(),!0):(n.Value=-1,!1)},GetOriginalIntPairs:function(){return this.edgesToKeep},Initialize:function(){for(var t=this.nodeInfoDictionary.GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),this.AddNodeToBucketsSourcesAndSinks(n.get_Key(),n.get_Value())},AddNodeToBucketsSourcesAndSinks:function(n,t){t.get_InDegree()==0?this.sources.Insert(n):t.get_OutDegree()==0?this.sinks.Insert(n):t.get_InDegreeOfConstrainedEdges()==0&&this.GetOrCreateBucket(t.get_DeltaDegree()).Insert(n)},GetOrCreateBucket:function(n){var t;return function(){var i={Value:t},r=this.deltaDegreeBucketsForSourcesInConstrainedSubgraph.TryGetValue(n,i);return t=i.Value,r}.call(this)?t:function(t){return this.deltaDegreeBucketsForSourcesInConstrainedSubgraph.set_Item$$TKey(n,t),t}.call(this,new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor))}}};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$GraphForCycleRemoval);Microsoft$Msagl$Core$GraphAlgorithms$NodeInfo={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.NodeInfo",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.outEdges=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor);this.inEdges=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor);this.outConstrainedEdges=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor);this.inConstrainedEdges=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor);System.Object.ctor.call(this)},OutEdges$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[System.Int32]]",get_OutEdges:function(){return this.outEdges},InEdges$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[System.Int32]]",get_InEdges:function(){return this.inEdges},OutConstrainedEdges$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[System.Int32]]",get_OutConstrainedEdges:function(){return this.outConstrainedEdges},InConstrainedEdges$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[System.Int32]]",get_InConstrainedEdges:function(){return this.inConstrainedEdges},DeltaDegree$$:"System.Int32",get_DeltaDegree:function(){return this.get_InDegree()-this.get_OutDegree()},AddOutEdge:function(n){this.outEdges.Insert(n)},RemoveOutEdge:function(n){this.outEdges.Remove(n)},AddInEdge:function(n){this.inEdges.Insert(n)},RemoveInEdge:function(n){this.inEdges.Remove(n)},AddOutConstrainedEdge:function(n){this.outConstrainedEdges.Insert(n)},RemoveOutConstrainedEdge:function(n){this.outConstrainedEdges.Remove(n)},AddInConstrainedEdge:function(n){this.inConstrainedEdges.Insert(n)},RemoveInConstrainedEdge:function(n){this.inConstrainedEdges.Remove(n)},OutDegree$$:"System.Int32",get_OutDegree:function(){return this.outEdges.get_Count()+this.outConstrainedEdges.get_Count()},InDegreeOfConstrainedEdges$$:"System.Int32",get_InDegreeOfConstrainedEdges:function(){return this.inConstrainedEdges.get_Count()},InDegree$$:"System.Int32",get_InDegree:function(){return this.inEdges.get_Count()+this.inConstrainedEdges.get_Count()},AllNeighbors$$:"System.Collections.Generic.IEnumerable`1[[System.Int32]]",get_AllNeighbors:function(){for(var t=[],f=this.get_OutConstrainedEdges().GetEnumerator(),i,r,u,n;f.MoveNext();)n=f.get_Current(),t.push(n);for(i=this.get_InConstrainedEdges().GetEnumerator();i.MoveNext();)n=i.get_Current(),t.push(n);for(r=this.get_OutEdges().GetEnumerator();r.MoveNext();)n=r.get_Current(),t.push(n);for(u=this.get_InEdges().GetEnumerator();u.MoveNext();)n=u.get_Current(),t.push(n);return t}}};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$NodeInfo);Microsoft$Msagl$Layout$Layered$LayeredLayout={fullname:"Microsoft.Msagl.Layout.Layered.LayeredLayout",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},PreRunTransform:function(n,t){var r,u,o,f,i,e;if(!t.get_IsIdentity()){for(r=t.get_Inverse(),u=n.get_Nodes().GetEnumerator();u.MoveNext();)o=u.get_Current(),o.Transform(r);for(f=n.get_Edges().GetEnumerator();f.MoveNext();)i=f.get_Current(),i.get_Label()!=null&&(i.set_OriginalLabelWidth(i.get_Label().get_Width()),i.set_OriginalLabelHeight(i.get_Label().get_Height()),e=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(r,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0)),Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(r,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i.get_Label().get_Width(),i.get_Label().get_Height()))),i.get_Label().set_Width(e.get_Width()),i.get_Label().set_Height(e.get_Height()));n.UpdateBoundingBox()}},PostRunTransform:function(n,t){var e=!t.get_IsIdentity(),r,f,u,i;if(e){for(r=n.get_Nodes().GetEnumerator();r.MoveNext();)f=r.get_Current(),f.Transform(t);for(u=n.get_Edges().GetEnumerator();u.MoveNext();)i=u.get_Current(),i.get_Label()!=null&&(i.get_Label().set_Width(i.get_OriginalLabelWidth()),i.get_Label().set_Height(i.get_OriginalLabelHeight()));Microsoft.Msagl.Layout.Layered.LayeredLayout.TransformCurves(n,t)}n.UpdateBoundingBox()},TransformCurves:function(n,t){var r,i;for(n.set_BoundingBox(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(t,n.get_LeftBottom()),Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(t,n.get_RightTop()))),r=n.get_Edges().GetEnumerator();r.MoveNext();)i=r.get_Current(),i.get_Label()!=null&&i.get_Label().set_Center(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(t,i.get_Label().get_Center())),Microsoft.Msagl.Layout.Layered.LayeredLayout.TransformEdgeCurve(t,i)},TransformEdgeCurve:function(n,t){if(t.get_Curve()!=null){t.set_Curve(t.get_Curve().Transform(n));var i=t.get_EdgeGeometry();i.get_SourceArrowhead()!=null&&i.get_SourceArrowhead().set_TipPosition(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,i.get_SourceArrowhead().get_TipPosition()));i.get_TargetArrowhead()!=null&&i.get_TargetArrowhead().set_TipPosition(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,i.get_TargetArrowhead().get_TipPosition()));Microsoft.Msagl.Layout.Layered.LayeredLayout.TransformUnderlyingPolyline(t,n)}},TransformUnderlyingPolyline:function(n,t){if(n.get_UnderlyingPolyline()!=null)for(var i=n.get_UnderlyingPolyline().get_HeadSite();i!=null;i=i.get_Next())i.set_Point(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(t,i.get_Point()))},RecoverAlgorithmData:function(n){var t=new Microsoft.Msagl.Layout.Layered.RecoveryLayeredLayoutEngine.ctor(n);n.AlgorithmData=t.GetEngine()},IncrementalLayout:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"geometryGraph");var i=As(n.AlgorithmData,Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.ctor);i!=null&&(Microsoft.Msagl.Layout.Layered.LayeredLayout.PreRunTransform(n,i.get_SugiyamaSettings().get_Transformation()),i.IncrementalRun(t),Microsoft.Msagl.Layout.Layered.LayeredLayout.PostRunTransform(n,i.get_SugiyamaSettings().get_Transformation()))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.geometryGraph=null;this.settings=null;this.engine=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.geometryGraph=n;this.settings=t;this.engine=new Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.ctor$$GeometryGraph$$SugiyamaLayoutSettings(n,t)},EstimateAspectRatio:function(){var n=this.engine.CalculateApproximateDimensions();return System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_X()>0,"The estimated width of the layered layout should be greater than 0"),System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_Y()>0,"The estimated width of the layered layout should be greater than 0"),n.get_X()/n.get_Y()},RunInternal:function(){Microsoft.Msagl.Layout.Layered.LayeredLayout.PreRunTransform(this.geometryGraph,this.settings.get_Transformation());this.engine.Run();this.geometryGraph.AlgorithmData=this.engine;Microsoft.Msagl.Layout.Layered.LayeredLayout.PostRunTransform(this.geometryGraph,this.settings.get_Transformation())}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$LayeredLayout);Microsoft$Msagl$Layout$MDS$AllPairsDistances={fullname:"Microsoft.Msagl.Layout.MDS.AllPairsDistances",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},Stress:function(n){var t,i,s;if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"graph"),t=0,n.get_Edges().get_Count()==0)return t;i=new Microsoft.Msagl.Layout.MDS.AllPairsDistances.ctor(n,!1);i.Run();for(var c=i.get_Result(),l=System.Linq.Enumerable.Average$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_Edges(),function(n){return n.get_Length()}),r=0,e=n.get_Nodes().GetEnumerator();e.MoveNext();){for(var a=e.get_Current(),u=0,o=n.get_Nodes().GetEnumerator();o.MoveNext();){if(s=o.get_Current(),r!=u){var v=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(a.get_Center(),s.get_Center()).get_Length(),f=l*c[r][u],h=f-v;t+=h*h/(f*f)}++u}++r}return t}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.graph=null;this.directed=!1;this._Result=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.graph=n;this.directed=t},Result$$:"System.Double[][]",get_Result:function(){return this._Result},set_Result:function(n){this._Result=n},RunInternal:function(){var n,t,r,i;for(this.StartListenToLocalProgress(this.graph.get_Nodes().get_Count(),1),this.set_Result(new Array(this.graph.get_Nodes().get_Count())),n=0,t=this.graph.get_Nodes().GetEnumerator();t.MoveNext();)r=t.get_Current(),i=new Microsoft.Msagl.Layout.MDS.SingleSourceDistances.ctor(this.graph,r,this.directed),i.Run(),this.get_Result()[n]=i.get_Result(),++n,this.ProgressStep()}}};JsTypes.push(Microsoft$Msagl$Layout$MDS$AllPairsDistances);Microsoft$Msagl$Layout$MDS$PivotDistances={fullname:"Microsoft.Msagl.Layout.MDS.PivotDistances",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.graph=null;this.directed=!1;this.pivotArray=null;this._Result=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.graph=n;this.directed=t;this.pivotArray=i},Result$$:"System.Double[][]",get_Result:function(){return this._Result},set_Result:function(n){this._Result=n},RunInternal:function(){var u,i,f,n,e,r,t;for(this.set_Result(new Array(this.pivotArray.length)),u=new Array(this.graph.get_Nodes().get_Count()),this.graph.get_Nodes().CopyTo(u,0),i=new Float64Array(this.graph.get_Nodes().get_Count()),n=0;n<i.length;n++)i[n]=Infinity;for(f=u[0],this.pivotArray[0]=0,n=0;;n++)if(e=new Microsoft.Msagl.Layout.MDS.SingleSourceDistances.ctor(this.graph,f,this.directed),e.Run(),this.get_Result()[n]=e.get_Result(),n+1<this.pivotArray.length){for(r=0,t=0;t<this.get_Result()[n].length;t++)i[t]=System.Math.Min$$Double$$Double(i[t],this.get_Result()[n][t]),i[t]>i[r]&&(r=t);f=u[r];this.pivotArray[n+1]=r}else break}}};JsTypes.push(Microsoft$Msagl$Layout$MDS$PivotDistances);Microsoft$Msagl$Layout$Incremental$AxisSolver={fullname:"Microsoft.Msagl.Layout.Incremental.AxisSolver",baseTypeName:"System.Object",staticDefinition:{DebugVerifyRectContains:function(n,t,i,r,u){t.PadWidth(i/2-u);t.PadHeight(r/2-u);System.Diagnostics.Debug.Assert$$Boolean$$String(n.Contains$$Rectangle(t),"Inner Node/Cluster rectangle is not contained within outer Cluster")},DebugVerifyRectsDisjoint:function(n,t,i,r,u){n.PadWidth(i/2-u);n.PadHeight(r/2-u);t.PadWidth(i/2-u);t.PadHeight(r/2-u);System.Diagnostics.Debug.Assert$$Boolean(!n.Intersects(t))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u,f){this.structuralConstraints=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Incremental.IConstraint.ctor);this.ConstraintLevel=0;this.OverlapRemovalParameters=null;this.avoidOverlaps=!1;this.nodes=null;this.clusterHierarchies=null;this.clusterSettings=null;this.solver=null;this.cg=null;this._IsHorizontal=!1;System.Object.ctor.call(this);this.set_IsHorizontal(n);this.nodes=t;this.clusterHierarchies=i;this.avoidOverlaps=r;this.ConstraintLevel=u;this.clusterSettings=f},IsHorizontal$$:"System.Boolean",get_IsHorizontal:function(){return this._IsHorizontal},set_IsHorizontal:function(n){this._IsHorizontal=n},NeedSolve$$:"System.Boolean",get_NeedSolve:function(){return this.avoidOverlaps&&this.ConstraintLevel>=2||this.structuralConstraints.get_Count()>0&&this.ConstraintLevel>=1},AddStructuralConstraint:function(n){this.structuralConstraints.Add(n)},Initialize:function(n,t,i,r,u){var e,o,h,s,f;for(this.cg=new Microsoft.Msagl.Core.Geometry.ConstraintGenerator.ctor$$Boolean$$Double$$Double$$Double$$Double(this.get_IsHorizontal(),this.get_IsHorizontal()?n:t,this.get_IsHorizontal()?t:n,this.get_IsHorizontal()?i:r,this.get_IsHorizontal()?r:i),this.solver=new Microsoft.Msagl.Core.ProjectionSolver.Solver.ctor,e=this.nodes.GetEnumerator();e.MoveNext();)f=e.get_Current(),f.SetOlapNode(this.get_IsHorizontal(),null);if(this.avoidOverlaps&&this.clusterHierarchies!=null)for(o=this.clusterHierarchies.GetEnumerator();o.MoveNext();)h=o.get_Current(),this.AddOlapClusters(this.cg,null,h,u);for(s=this.nodes.GetEnumerator();s.MoveNext();)f=s.get_Current(),f.getOlapNode(this.get_IsHorizontal())==null&&this.AddOlapNode(this.cg,this.cg.get_DefaultClusterHierarchy(),f,u),f.getOlapNode(this.get_IsHorizontal()).CreateVariable(this.solver);this.avoidOverlaps&&this.ConstraintLevel>=2&&this.cg.Generate(this.solver,this.OverlapRemovalParameters);this.AddStructuralConstraints()},Solve:function(){var u=this.cg.Solve(this.solver,null,!1),n,i,t,r;if(this.avoidOverlaps&&this.clusterHierarchies!=null)for(n=this.clusterHierarchies.GetEnumerator();n.MoveNext();)i=n.get_Current(),this.UpdateOlapClusters(i.get_Clusters());for(t=this.nodes.GetEnumerator();t.MoveNext();)r=t.get_Current(),r.UpdatePos(this.get_IsHorizontal());return u},SetDesiredPositions:function(){for(var n=this.nodes.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.SetVariableDesiredPos(this.get_IsHorizontal());this.solver.UpdateVariables()},AddStructuralConstraints:function(){for(var f=this.structuralConstraints.GetEnumerator(),i,n,t,r,u;f.MoveNext();)i=f.get_Current(),this.ConstraintLevel>=i.get_Level()&&(n=As(i,Microsoft.Msagl.Layout.Incremental.HorizontalSeparationConstraint.ctor),n!=null&&this.get_IsHorizontal()&&(r=Cast(n.get_LeftNode().AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor),u=Cast(n.get_RightNode().AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor),this.solver.AddConstraint$$Variable$$Variable$$Double$$Boolean(r.getOlapNode(this.get_IsHorizontal()).get_Variable(),u.getOlapNode(this.get_IsHorizontal()).get_Variable(),n.get_Separation(),n.get_IsEquality())),t=As(i,Microsoft.Msagl.Layout.Incremental.VerticalSeparationConstraint.ctor),t==null||this.get_IsHorizontal()||(r=Cast(t.get_TopNode().AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor),u=Cast(t.get_BottomNode().AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor),this.solver.AddConstraint$$Variable$$Variable$$Double$$Boolean(r.getOlapNode(this.get_IsHorizontal()).get_Variable(),u.getOlapNode(this.get_IsHorizontal()).get_Variable(),t.get_Separation(),t.get_IsEquality())))},AddOlapClusters:function(n,t,i,r){var f=this.clusterSettings(i),s=f.get_NodeSeparation(),h=f.get_NodeSeparation()+.0001,c=f.get_ClusterMargin(),l=f.get_ClusterMargin()+.0001,u=i.get_RectangularBoundary(),a,v,e,y,o,p;for(this.get_IsHorizontal()?(u.olapCluster=n.AddCluster$$OverlapRemovalCluster$$Object$$Double$$Double$$BorderInfo$$BorderInfo$$BorderInfo$$BorderInfo(t,i,u.get_MinWidth(),u.get_MinHeight(),u.get_LeftBorderInfo(),u.get_RightBorderInfo(),u.get_BottomBorderInfo(),u.get_TopBorderInfo()),u.olapCluster.set_NodePadding(s),u.olapCluster.set_NodePaddingP(h),u.olapCluster.set_ClusterPadding(c),u.olapCluster.set_ClusterPaddingP(l)):(a=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(u.get_LeftBorderInfo().get_InnerMargin(),u.get_Rect().get_Left(),u.get_LeftBorderInfo().get_Weight()),v=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(u.get_RightBorderInfo().get_InnerMargin(),u.get_Rect().get_Right(),u.get_RightBorderInfo().get_Weight()),u.olapCluster=n.AddCluster$$OverlapRemovalCluster$$Object$$Double$$Double$$BorderInfo$$BorderInfo$$BorderInfo$$BorderInfo(t,i,u.get_MinHeight(),u.get_MinWidth(),u.get_BottomBorderInfo(),u.get_TopBorderInfo(),a,v),u.olapCluster.set_NodePadding(h),u.olapCluster.set_NodePaddingP(s),u.olapCluster.set_ClusterPadding(l),u.olapCluster.set_ClusterPaddingP(c)),u.olapCluster.set_TranslateChildren(u.get_GenerateFixedConstraints()),e=i.get_Nodes().GetEnumerator();e.MoveNext();)y=e.get_Current(),this.AddOlapNode(n,u.olapCluster,Cast(y.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor),r);for(o=i.get_Clusters().GetEnumerator();o.MoveNext();)p=o.get_Current(),this.AddOlapClusters(n,u.olapCluster,p,r)},AddOlapNode:function(n,t,i,r){if(null!=i.getOlapNode(this.get_IsHorizontal())){n.AddNodeToCluster(t,i.getOlapNode(this.get_IsHorizontal()));return}var u=r(i);this.get_IsHorizontal()?i.mOlapNodeX=n.AddNode(t,i,u.get_X(),u.get_Y(),i.Width,i.Height,i.stayWeight):i.mOlapNodeY=n.AddNode(t,i,u.get_Y(),u.get_X(),i.Height,i.Width,i.stayWeight)},UpdateOlapClusters:function(n){for(var r=n.GetEnumerator(),i,t;r.MoveNext();)i=r.get_Current(),t=i.get_RectangularBoundary(),this.get_IsHorizontal()?(t.rectangle.set_Left(t.olapCluster.get_Position()-t.olapCluster.get_Size()/2),t.rectangle.set_Right(t.olapCluster.get_Position()+t.olapCluster.get_Size()/2),t.get_LeftBorderInfo().get_IsFixedPosition()&&t.set_LeftBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(t.get_LeftBorderInfo().get_InnerMargin(),t.rectangle.get_Left(),t.get_LeftBorderInfo().get_Weight())),t.get_RightBorderInfo().get_IsFixedPosition()&&t.set_RightBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(t.get_RightBorderInfo().get_InnerMargin(),t.rectangle.get_Right(),t.get_RightBorderInfo().get_Weight()))):(t.rectangle.set_Bottom(t.olapCluster.get_Position()-t.olapCluster.get_Size()/2),t.rectangle.set_Top(t.olapCluster.get_Position()+t.olapCluster.get_Size()/2),t.get_TopBorderInfo().get_IsFixedPosition()&&t.set_TopBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(t.get_TopBorderInfo().get_InnerMargin(),t.rectangle.get_Top(),t.get_TopBorderInfo().get_Weight())),t.get_BottomBorderInfo().get_IsFixedPosition()&&t.set_BottomBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(t.get_BottomBorderInfo().get_InnerMargin(),t.rectangle.get_Bottom(),t.get_BottomBorderInfo().get_Weight()))),t.olapCluster=null,this.UpdateOlapClusters(i.get_Clusters())},DebugVerifyClusterHierarchy:function(n){var t,i;if(this.avoidOverlaps&&null!=this.clusterHierarchies&&0!=n.get_NumberOfUnsatisfiableConstraints())for(t=this.clusterHierarchies.GetEnumerator();t.MoveNext();)i=t.get_Current()},DebugVerifyClusters:function(n,t,i){for(var r=.0001,u=t.get_RectangularBoundary().rectangle,p=t.get_Nodes().GetEnumerator(),o,s,k,g,h,nt,c,l,a,f,e,v,y,tt;p.MoveNext();){var w=p.get_Current(),d=Cast(w.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor),b=d.mNode.get_BoundaryCurve().get_BoundingBox();if(this.get_IsHorizontal())t!=i&&(f=b.get_Left()-u.get_Left()-n.get_Padding(),e=u.get_Right()-b.get_Right()-n.get_Padding(),System.Diagnostics.Debug.Assert$$Boolean$$String(f>=-r&&e>=-r,"Node is not within parent Cluster"));else{for(t!=i,o=t.get_Nodes().GetEnumerator();o.MoveNext();)(s=o.get_Current(),s!=w)&&(k=Cast(s.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor),g=k.mNode.get_BoundaryCurve().get_BoundingBox());for(h=t.get_Clusters().GetEnumerator();h.MoveNext();)nt=h.get_Current()}}for(c=t.get_Clusters().GetEnumerator();c.MoveNext();)if(l=c.get_Current(),a=l.get_RectangularBoundary().rectangle,this.get_IsHorizontal())t!=i&&(f=a.get_Left()-u.get_Left()-n.get_Padding(),e=u.get_Right()-a.get_Right()-n.get_Padding(),System.Diagnostics.Debug.Assert$$Boolean$$String(f>=-r&&e>=-r,"Cluster is not within parent Cluster"));else for(t!=i,v=t.get_Clusters().GetEnumerator();v.MoveNext();)(y=v.get_Current(),y!=l)&&(tt=y.get_RectangularBoundary().rectangle)}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$AxisSolver);Microsoft$Msagl$Core$Geometry$Disc={fullname:"Microsoft.Msagl.Core.Geometry.Disc",baseTypeName:"System.Object",staticDefinition:{midPoint:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double((t.get_X()+n.get_X())/2,(t.get_Y()+n.get_Y())/2)},centre:function(n,t,i){var u,f,r;return System.Diagnostics.Debug.Assert$$Boolean(t.get_X()!=n.get_X()),System.Diagnostics.Debug.Assert$$Boolean(i.get_X()!=t.get_X()),u=(t.get_Y()-n.get_Y())/(t.get_X()-n.get_X()),f=(i.get_Y()-t.get_Y())/(i.get_X()-t.get_X()),System.Diagnostics.Debug.Assert$$Boolean(f!=u),r=new Microsoft.Msagl.Core.Geometry.Point.ctor,r.set_X(u*f*(n.get_Y()-i.get_Y())+f*(n.get_X()+t.get_X())-u*(t.get_X()+i.get_X())),r.set_X(r.get_X()/2*(f-u)),System.Math.Abs$$Double(u)>System.Math.Abs$$Double(f)?r.set_Y((n.get_Y()+t.get_Y())/2-(r.get_X()-(n.get_X()+t.get_X())/2)/u):r.set_Y((t.get_Y()+i.get_Y())/2-(r.get_X()-(t.get_X()+i.get_X())/2)/f),r},Collinear:function(n,t,i){return n.get_X()*(t.get_Y()-i.get_Y())+t.get_X()*(i.get_Y()-n.get_Y())+i.get_X()*(n.get_Y()-t.get_Y())==0}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Point:function(n){this.c=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.r=0;this.r2=0;System.Object.ctor.call(this);this.c=n;this.r2=this.r=0},Center$$:"Microsoft.Msagl.Core.Geometry.Point",get_Center:function(){return this.c},Radius$$:"System.Double",get_Radius:function(){return this.r},Distance2:function(n){var t=this.c.get_X()-n.get_X(),i=this.c.get_Y()-n.get_Y();return t*t+i*i},Contains$$Point:function(n){return this.Distance2(n)-1e-7<=this.r2},Contains$$Point$Array$$Int32$Array:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"points");for(var i=0;i<n.length;++i)if(!System.Linq.Enumerable.Contains$1$$IEnumerable$1$$TSource(System.Int32.ctor,t,i)&&!this.Contains$$Point(n[i]))return!1;return!0},ctor$$Point$$Point:function(n,t){this.c=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.r=0;this.r2=0;System.Object.ctor.call(this);this.c=Microsoft.Msagl.Core.Geometry.Disc.midPoint(n,t);this.r2=this.Distance2(n);this.r=System.Math.Sqrt(this.r2);System.Diagnostics.Debug.Assert$$Boolean(this.OnBoundary(n));System.Diagnostics.Debug.Assert$$Boolean(this.OnBoundary(t))},OnBoundary:function(n){var t=this.Distance2(n);return System.Math.Abs$$Double(t-this.r2)/(t+this.r2)<1e-5},ctor$$Point$$Point$$Point:function(n,t,i){var u,r;if(this.c=new Microsoft.Msagl.Core.Geometry.Point.ctor,this.r=0,this.r2=0,System.Object.ctor.call(this),Microsoft.Msagl.Core.Geometry.Disc.Collinear(n,t,i))u=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Min$$Double$$Double(n.get_X(),System.Math.Min$$Double$$Double(t.get_X(),i.get_X())),System.Math.Min$$Double$$Double(n.get_Y(),System.Math.Max$$Double$$Double(t.get_Y(),i.get_Y()))),r=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Max$$Double$$Double(n.get_X(),System.Math.Max$$Double$$Double(t.get_X(),i.get_X())),System.Math.Max$$Double$$Double(n.get_Y(),System.Math.Max$$Double$$Double(t.get_Y(),i.get_Y()))),this.c=Microsoft.Msagl.Core.Geometry.Disc.midPoint(u,r),this.r2=this.Distance2(r),this.r=System.Math.Sqrt(this.r2);else{var e=t.get_X()-n.get_X(),f=i.get_X()-t.get_X(),o=i.get_X()-n.get_X();e!=0?f!=0?this.c=Microsoft.Msagl.Core.Geometry.Disc.centre(n,t,i):(System.Diagnostics.Debug.Assert$$Boolean(o!=0),this.c=Microsoft.Msagl.Core.Geometry.Disc.centre(t,n,i)):(System.Diagnostics.Debug.Assert$$Boolean(f!=0),this.c=Microsoft.Msagl.Core.Geometry.Disc.centre(t,i,n));this.r2=this.Distance2(n);this.r=System.Math.Sqrt(this.r2);System.Diagnostics.Debug.Assert$$Boolean(this.OnBoundary(n));System.Diagnostics.Debug.Assert$$Boolean(this.OnBoundary(t));System.Diagnostics.Debug.Assert$$Boolean(this.OnBoundary(i))}}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Disc);Microsoft$Msagl$Layout$MDS$PivotMDS={fullname:"Microsoft.Msagl.Layout.MDS.PivotMDS",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.graph=null;this._Scale=0;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.graph=n;this.set_Scale(1)},Scale$$:"System.Double",get_Scale:function(){return this._Scale},set_Scale:function(n){this._Scale=n},RunInternal:function(){for(var r=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,l=this.graph.get_Nodes().GetEnumerator(),f,e,o,u,i,s,v,h,n,y,p,c,t,w;l.MoveNext();)t=l.get_Current(),System.Diagnostics.Debug.Assert$$Boolean(!Is(t,Microsoft.Msagl.Core.Layout.Cluster.ctor)),i=function(){var n=new Microsoft.Msagl.Core.Layout.Node.ctor$$ICurve(t.get_BoundaryCurve().Clone());return n.set_UserData(t),n}.call(this),t.AlgorithmData=new Microsoft.Msagl.Layout.MDS.PivotMDS.PivotMDSNodeWrap.ctor(i),r.get_Nodes().Add(i);for(f=0,e=this.graph.get_Edges().GetEnumerator();e.MoveNext();)if(n=e.get_Current(),f+=n.get_Length(),!Is(n.get_Source(),Microsoft.Msagl.Core.Layout.Cluster.ctor)&&!Is(n.get_Target(),Microsoft.Msagl.Core.Layout.Cluster.ctor)){var i=As(n.get_Source().AlgorithmData,Microsoft.Msagl.Layout.MDS.PivotMDS.PivotMDSNodeWrap.ctor),t=As(n.get_Target().AlgorithmData,Microsoft.Msagl.Layout.MDS.PivotMDS.PivotMDSNodeWrap.ctor),a=function(){var r=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(i.node,t.node);return r.set_Length(n.get_Length()),r}.call(this);r.get_Edges().Add(a)}for(this.graph.get_Edges().get_Count()!=0?f/=this.graph.get_Edges().get_Count():f=100,o=this.graph.get_RootCluster().AllClustersDepthFirst().GetEnumerator();o.MoveNext();)if(u=o.get_Current(),u!=this.graph.get_RootCluster())for(i=new Microsoft.Msagl.Core.Layout.Node.ctor$$ICurve(Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRectangle$$Double$$Double$$Point(10,10,new Microsoft.Msagl.Core.Geometry.Point.ctor)),i.set_UserData(u),u.AlgorithmData=new Microsoft.Msagl.Layout.MDS.PivotMDS.PivotMDSNodeWrap.ctor(i),r.get_Nodes().Add(i),s=System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,u.get_Nodes(),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,u.get_Clusters(),$CreateAnonymousDelegate(this,function(n){return n}))).GetEnumerator();s.MoveNext();)t=s.get_Current(),v=As(t.AlgorithmData,Microsoft.Msagl.Layout.MDS.PivotMDS.PivotMDSNodeWrap.ctor),r.get_Edges().Add(function(){var n=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(i,v.node);return n.set_Length(f),n}.call(this));for(h=this.graph.get_Edges().GetEnumerator();h.MoveNext();)if(n=h.get_Current(),Is(n.get_Source(),Microsoft.Msagl.Core.Layout.Cluster.ctor)||Is(n.get_Target(),Microsoft.Msagl.Core.Layout.Cluster.ctor)){var i=As(n.get_Source().AlgorithmData,Microsoft.Msagl.Layout.MDS.PivotMDS.PivotMDSNodeWrap.ctor),t=As(n.get_Target().AlgorithmData,Microsoft.Msagl.Layout.MDS.PivotMDS.PivotMDSNodeWrap.ctor),a=function(){var r=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(i.node,t.node);return r.set_Length(n.get_Length()),r}.call(this);r.get_Edges().Add(a)}for(y=function(){var n=new Microsoft.Msagl.Layout.MDS.MdsLayoutSettings.ctor;return n.set_ScaleX(this.get_Scale()),n.set_ScaleY(this.get_Scale()),n.set_IterationsWithMajorization(0),n.set_RemoveOverlaps(!1),n.set_AdjustScale(!1),n}.call(this),p=new Microsoft.Msagl.Layout.MDS.MdsGraphLayout.ctor(y,r),this.RunChildAlgorithm(p,1),r.UpdateBoundingBox(),c=this.graph.get_Nodes().GetEnumerator();c.MoveNext();)t=c.get_Current(),w=As(t.AlgorithmData,Microsoft.Msagl.Layout.MDS.PivotMDS.PivotMDSNodeWrap.ctor),t.set_Center(w.node.get_Center())}}};JsTypes.push(Microsoft$Msagl$Layout$MDS$PivotMDS);Microsoft$Msagl$Core$Layout$Cluster={fullname:"Microsoft.Msagl.Core.Layout.Cluster",baseTypeName:"Microsoft.Msagl.Core.Layout.Node",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.isCollapsed=!1;this.Barycenter=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.collapsedBoundary=null;this.clusters=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor);this.nodes=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor);this.isInInitialLayoutState=!1;this.layoutDoneEvent=null;this.LayoutDoneEvent=null;this._RectangularBoundary=null;this._Weight=0;Microsoft.Msagl.Core.Layout.Cluster.ctor$$Point.call(this,new Microsoft.Msagl.Core.Geometry.Point.ctor)},IsCollapsed$$:"System.Boolean",get_IsCollapsed:function(){return this.isCollapsed},set_IsCollapsed:function(n){this.isCollapsed=n},BoundaryCurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_BoundaryCurve:function(){return this.get_IsCollapsed()?this.get_CollapsedBoundary():Microsoft.Msagl.Core.Layout.Node.commonPrototype.get_BoundaryCurve.call(this)},set_BoundaryCurve:function(n){Microsoft.Msagl.Core.Layout.Node.commonPrototype.set_BoundaryCurve.call(this,n)},add_layoutDoneEvent:function(n){this.layoutDoneEvent=$CombineDelegates(this.layoutDoneEvent,n)},remove_layoutDoneEvent:function(n){this.layoutDoneEvent=$RemoveDelegate(this.layoutDoneEvent,n)},add_LayoutDoneEvent:function(n){this.add_layoutDoneEvent(n)},remove_LayoutDoneEvent:function(n){this.remove_layoutDoneEvent(n)},CollapsedBoundary$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_CollapsedBoundary:function(){return this.collapsedBoundary},set_CollapsedBoundary:function(n){this.collapsedBoundary=n},ctor$$Point:function(n){this.isCollapsed=!1;this.Barycenter=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.collapsedBoundary=null;this.clusters=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor);this.nodes=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor);this.isInInitialLayoutState=!1;this.layoutDoneEvent=null;this.LayoutDoneEvent=null;this._RectangularBoundary=null;this._Weight=0;Microsoft.Msagl.Core.Layout.Node.ctor.call(this);this.set_Weight(0);this.Barycenter=n},ctor$$IEnumerable$1$Node:function(n){var t,i;for(this.isCollapsed=!1,this.Barycenter=new Microsoft.Msagl.Core.Geometry.Point.ctor,this.collapsedBoundary=null,this.clusters=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor),this.nodes=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),this.isInInitialLayoutState=!1,this.layoutDoneEvent=null,this.LayoutDoneEvent=null,this._RectangularBoundary=null,this._Weight=0,Microsoft.Msagl.Core.Layout.Cluster.ctor.call(this),Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"nodes"),t=n.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.AddNode(i)},ctor$$IEnumerable$1$Node$$IEnumerable$1$Cluster:function(n,t){var i,r;for(this.isCollapsed=!1,this.Barycenter=new Microsoft.Msagl.Core.Geometry.Point.ctor,this.collapsedBoundary=null,this.clusters=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor),this.nodes=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),this.isInInitialLayoutState=!1,this.layoutDoneEvent=null,this.LayoutDoneEvent=null,this._RectangularBoundary=null,this._Weight=0,Microsoft.Msagl.Core.Layout.Cluster.ctor$$IEnumerable$1$Node.call(this,n),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"clusters"),i=t.GetEnumerator();i.MoveNext();)r=i.get_Current(),this.AddCluster(r)},RectangularBoundary$$:"Microsoft.Msagl.Core.Geometry.RectangularClusterBoundary",get_RectangularBoundary:function(){return this._RectangularBoundary},set_RectangularBoundary:function(n){this._RectangularBoundary=n},Nodes$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Node]]",get_Nodes:function(){return this.nodes},Clusters$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Cluster]]",get_Clusters:function(){return this.clusters},Weight$$:"System.Double",get_Weight:function(){return this._Weight},set_Weight:function(n){this._Weight=n},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){return!this.get_IsCollapsed()||this.get_CollapsedBoundary()==null?this.get_RectangularBoundary()!=null?this.get_RectangularBoundary().get_Rect():new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$IEnumerable$1$Rectangle(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Geometry.Rectangle.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,this.nodes,this.clusters),$CreateAnonymousDelegate(this,function(n){return n.get_BoundingBox()}))):this.get_CollapsedBoundary().get_BoundingBox()},set_BoundingBox:function(n){this.FitBoundaryCurveToTarget(n)},AddChild:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"child");System.Diagnostics.Debug.Assert$$Boolean(n!=this);var t=As(n,Microsoft.Msagl.Core.Layout.Cluster.ctor);t!=null?this.clusters.Add(t):this.nodes.Add(n);n.AddClusterParent(this)},ClearClusters:function(){this.clusters.Clear()},ComputeWeight:function(){var n,t;for(this.set_Weight(this.nodes.get_Count()),n=this.clusters.GetEnumerator();n.MoveNext();)t=n.get_Current(),this.set_Weight(this.get_Weight()+t.ComputeWeight());return this.get_Weight()},SetBarycenter:function(){var n,r,t,i;if(this.Barycenter=new Microsoft.Msagl.Core.Geometry.Point.ctor,(0!=this.nodes.get_Count()||0!=this.clusters.get_Count())&&(0==this.get_Weight()&&this.ComputeWeight(),0!=this.get_Weight())){for(n=this.nodes.GetEnumerator();n.MoveNext();)r=n.get_Current(),this.Barycenter=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.Barycenter,r.get_Center());for(t=this.clusters.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.Barycenter=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.Barycenter,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(i.SetBarycenter(),i.get_Weight()));this.Barycenter=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(this.Barycenter,this.get_Weight())}return System.Diagnostics.Debug.Assert$$Boolean(!System.Double.IsNaN(this.Barycenter.get_X())&&!System.Double.IsNaN(this.Barycenter.get_Y())),this.Barycenter},AllClustersDepthFirst:function(){for(var n=[],i=this.clusters.GetEnumerator(),r,t,u;i.MoveNext();)for(r=i.get_Current(),t=r.AllClustersDepthFirst().GetEnumerator();t.MoveNext();)u=t.get_Current(),n.push(u);return n.push(this),n},AllSuccessorsWidthFirst:function(){for(var n=[],f=this.get_Nodes().GetEnumerator(),i,r,u,t;f.MoveNext();)t=f.get_Current(),n.push(t);for(i=this.clusters.GetEnumerator();i.MoveNext();)for(r=i.get_Current(),n.push(r),u=r.AllSuccessorsWidthFirst().GetEnumerator();u.MoveNext();)t=u.get_Current(),n.push(t);return n},AllClustersDepthFirstExcludingSelf:function(){for(var t=[],i=this.clusters.GetEnumerator(),r,n,u;i.MoveNext();)for(r=i.get_Current(),n=r.AllClustersDepthFirst().GetEnumerator();n.MoveNext();)u=n.get_Current(),t.push(u);return t},ForEachNode:function(n){for(var i=this.nodes.GetEnumerator(),r,t,u;i.MoveNext();)r=i.get_Current(),n(r);for(t=this.clusters.GetEnumerator();t.MoveNext();)u=t.get_Current(),u.ForEachNode(n)},RemoveCluster:function(n){this.clusters.Remove(n)},DeepContentsTranslation:function(n,t){for(var o=this.AllClustersDepthFirst().GetEnumerator(),r,u,i,f,e,s;o.MoveNext();)for(r=o.get_Current(),u=System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,r.get_Nodes(),System.Linq.Enumerable.Cast$1(Microsoft.Msagl.Core.Layout.Node.ctor,r.get_Clusters())).GetEnumerator();u.MoveNext();)if(i=u.get_Current(),f=As(i,Microsoft.Msagl.Core.Layout.Cluster.ctor),f!=null&&f.get_RectangularBoundary().TranslateRectangle(n),i.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Center(),n)),t)for(e=this.EdgesIncomingToNodeWithDescendantSource(i).GetEnumerator();e.MoveNext();)s=e.get_Current(),s.Translate(n)},ChildEdges:function(){return System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,this.get_Nodes(),this.get_Clusters()),$CreateDelegate(this,this.EdgesIncomingToNodeWithChildSource))},EdgesIncomingToNodeWithDescendantSource:function(n){return System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_InEdges(),n.get_SelfEdges()),$CreateAnonymousDelegate(this,function(n){return n.get_Source().IsDescendantOf(this)}))},EdgesIncomingToNodeWithChildSource:function(n){return System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_InEdges(),n.get_SelfEdges()),$CreateAnonymousDelegate(this,function(n){return System.Linq.Enumerable.Contains$1$$IEnumerable$1$$TSource(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_Source().get_ClusterParents(),this)}))},DeepTranslation:function(n,t){this.DeepContentsTranslation(n,t);this.get_RectangularBoundary().TranslateRectangle(n);this.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_Center(),n))},CalculateBoundsFromChildren:function(n){var t=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$IEnumerable$1$Rectangle(System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Geometry.Rectangle.ctor,this.get_Nodes(),$CreateAnonymousDelegate(this,function(n){return n.get_BoundingBox()})),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,Microsoft.Msagl.Core.Geometry.Rectangle.ctor,this.get_Clusters(),$CreateAnonymousDelegate(this,function(n){return n.get_BoundingBox()}))));t.Pad$$Double(n);this.UpdateBoundary(t)},UpdateBoundary:function(n){var t=n,i,r;this.get_RectangularBoundary()!=null&&(t=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(t.get_Left()-this.get_RectangularBoundary().get_LeftMargin(),t.get_Bottom()-this.get_RectangularBoundary().get_BottomMargin(),t.get_Right()+this.get_RectangularBoundary().get_RightMargin(),t.get_Top()+this.get_RectangularBoundary().get_TopMargin()),i=(this.get_RectangularBoundary().get_MinWidth()-t.get_Width())/2,i>0&&t.PadWidth(i),r=(this.get_RectangularBoundary().get_MinHeight()-t.get_Height())/2,r>0&&t.PadHeight(r),this.get_RectangularBoundary().set_Rect(t));this.set_BoundingBox(t)},IsInInitialLayoutState$$:"System.Boolean",get_IsInInitialLayoutState:function(){return this.isInInitialLayoutState},SetInitialLayoutState:function(n){if(this.isInInitialLayoutState=!0,this.get_RectangularBoundary()!=null){this.get_RectangularBoundary().StoreDefaultMargin();var t=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$IEnumerable$1$Rectangle(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Geometry.Rectangle.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,this.get_Nodes(),this.get_Clusters()),$CreateAnonymousDelegate(this,function(n){return n.get_BoundingBox()})));t.Pad$$Double(n);this.get_RectangularBoundary().set_LeftMargin(t.get_Left()-this.get_RectangularBoundary().get_Rect().get_Left());this.get_RectangularBoundary().set_RightMargin(this.get_RectangularBoundary().get_Rect().get_Right()-t.get_Right());this.get_RectangularBoundary().set_BottomMargin(t.get_Bottom()-this.get_RectangularBoundary().get_Rect().get_Bottom());this.get_RectangularBoundary().set_TopMargin(this.get_RectangularBoundary().get_Rect().get_Top()-t.get_Top())}},UnsetInitialLayoutState:function(){this.isInInitialLayoutState=!1;var n=this.get_RectangularBoundary();n!=null&&n.RestoreDefaultMargin()},UnsetInitialLayoutStateIncludingAncestors:function(){var n,t;for(this.UnsetInitialLayoutState(),n=this.get_AllClusterAncestors().GetEnumerator();n.MoveNext();)t=n.get_Current(),t.UnsetInitialLayoutState()},AllClustersWideFirstExcludingSelf:function(){for(var u=[],n=new System.Collections.Generic.Queue$1.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor),f=this.get_Clusters().GetEnumerator(),i,r,t;f.MoveNext();)t=f.get_Current(),n.Enqueue(t);while(n.get_Count()>0)for(i=n.Dequeue(),u.push(i),r=i.get_Clusters().GetEnumerator();r.MoveNext();)t=r.get_Current(),n.Enqueue(t);return u},AllClustersWidthFirstExcludingSelfAvoidingChildrenOfCollapsed:function(){for(var u=[],n=new System.Collections.Generic.Queue$1.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor),f=this.get_Clusters().GetEnumerator(),i,r,t;f.MoveNext();)t=f.get_Current(),n.Enqueue(t);while(n.get_Count()>0)if(i=n.Dequeue(),u.push(i),!i.get_IsCollapsed())for(r=i.get_Clusters().GetEnumerator();r.MoveNext();)t=r.get_Current(),n.Enqueue(t);return u},AddNode:function(n){n.AddClusterParent(this);this.nodes.Add(n)},AddCluster:function(n){n.AddClusterParent(this);this.clusters.Add(n)},AddRangeOfCluster:function(n){for(var i=n.GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),t.AddClusterParent(this),this.clusters.Add(t)},toString:function(){return this.get_UserData()!=null?this.get_UserData().toString():Microsoft.Msagl.Core.Layout.Node.commonPrototype.toString.call(this)},RaiseLayoutDoneEvent:function(){this.layoutDoneEvent!=null&&this.layoutDoneEvent(this,null)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$Cluster);Microsoft$Msagl$Layout$Incremental$Feasibility={fullname:"Microsoft.Msagl.Layout.Incremental.Feasibility",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.Incremental.Feasibility.Pad=.0001},Enforce:function(n,t,i,r,u,f,e){for(var c=n.locks.GetEnumerator(),l,o,s,h;c.MoveNext();)l=c.get_Current(),l.Project();Microsoft.Msagl.Layout.Incremental.Feasibility.ResetPositions(i);var a=n.get_NodeSeparation()+.0001,v=n.get_NodeSeparation(),y=n.get_ClusterMargin()+.0001,p=n.get_ClusterMargin();for(o=n.get_MinConstraintLevel();o<=t;++o)s=new Microsoft.Msagl.Layout.Incremental.AxisSolver.ctor(!0,i,f,o>=2&&n.get_AvoidOverlaps(),o,e),s.structuralConstraints=r,s.OverlapRemovalParameters=function(){var t=new Microsoft.Msagl.Core.Geometry.OverlapRemovalParameters.ctor;return t.set_AllowDeferToVertical(!0),t.set_ConsiderProportionalOverlap(n.get_IdealEdgeLength().get_EdgeDirectionConstraints()!=Microsoft.Msagl.Core.Geometry.Directions.None),t}(),s.Initialize(v,a,p,y,function(n){return n.get_Center()}),s.SetDesiredPositions(),s.Solve(),Microsoft.Msagl.Layout.Incremental.Feasibility.ResetPositions(i),h=new Microsoft.Msagl.Layout.Incremental.AxisSolver.ctor(!1,i,f,o>=2&&n.get_AvoidOverlaps(),o,e),h.structuralConstraints=u,h.Initialize(v,a,p,y,function(n){return n.get_Center()}),h.SetDesiredPositions(),h.Solve(),Microsoft.Msagl.Layout.Incremental.Feasibility.ResetPositions(i)},ResetPositions:function(n){for(var i=n.GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),t.previousCenter=t.desiredPosition=t.mNode.get_Center()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$Feasibility);Microsoft$Msagl$Layout$Incremental$TNode={fullname:"Microsoft.Msagl.Layout.Incremental.TNode",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.stackNode=null;this.v=null;this.visited=!1;this.outNeighbours=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Incremental.TNode.ctor);this.inNeighbours=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Incremental.TNode.ctor);System.Object.ctor.call(this);this.v=n}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$TNode);Microsoft$Msagl$Layout$Incremental$EdgeConstraintGenerator={fullname:"Microsoft.Msagl.Layout.Incremental.EdgeConstraintGenerator",baseTypeName:"System.Object",staticDefinition:{GenerateEdgeConstraints:function(n,t,i,r){if(t.get_EdgeDirectionConstraints()!=Microsoft.Msagl.Core.Geometry.Directions.None){var u=new Microsoft.Msagl.Layout.Incremental.EdgeConstraintGenerator.ctor(n,t,i,r);u.GenerateSeparationConstraints()}}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){var f,e,o,s,u;for(this.settings=new Microsoft.Msagl.Core.Layout.IdealEdgeLengthSettings.ctor,this.edges=null,this.nodeMap=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Layout.Incremental.TNode.ctor),this.stack=new System.Collections.Generic.LinkedList$1.ctor(Microsoft.Msagl.Layout.Incremental.TNode.ctor),this.component=null,this.horizontalSolver=null,this.verticalSolver=null,this.cyclicComponents=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.DataStructures.Set$1.ctor),this.addConstraint=null,System.Object.ctor.call(this),this.edges=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,n,$CreateAnonymousDelegate(this,function(n){return n.get_Source()!=n.get_Target()})),this.settings=t,this.horizontalSolver=i,this.verticalSolver=r,f=this.edges.GetEnumerator();f.MoveNext();){var h=f.get_Current(),c=this.CreateTNode(h.get_Source()),u=this.CreateTNode(h.get_Target());c.outNeighbours.Add(u);u.inNeighbours.Add(c)}for(e=this.nodeMap.get_Values().GetEnumerator();e.MoveNext();)u=e.get_Current(),u.stackNode==null&&this.DFS(u);while(this.stack.get_Count()>0)if(this.component=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Incremental.TNode.ctor),this.RDFS(this.stack.get_Last().get_Value()),this.component.get_Count()>1){for(o=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),s=this.component.GetEnumerator();s.MoveNext();)u=s.get_Current(),o.Insert(u.v);this.cyclicComponents.Add(o)}switch(t.get_EdgeDirectionConstraints()){case Microsoft.Msagl.Core.Geometry.Directions.South:this.addConstraint=$CreateDelegate(this,this.AddSConstraint);break;case Microsoft.Msagl.Core.Geometry.Directions.North:this.addConstraint=$CreateDelegate(this,this.AddNConstraint);break;case Microsoft.Msagl.Core.Geometry.Directions.West:this.addConstraint=$CreateDelegate(this,this.AddWConstraint);break;case Microsoft.Msagl.Core.Geometry.Directions.East:this.addConstraint=$CreateDelegate(this,this.AddEConstraint)}},AddSConstraint:function(n,t){this.verticalSolver.AddStructuralConstraint(new Microsoft.Msagl.Layout.Incremental.VerticalSeparationConstraint.ctor$$Node$$Node$$Double(n,t,(n.get_Height()+t.get_Height())/2+this.settings.get_ConstrainedEdgeSeparation()))},AddNConstraint:function(n,t){this.verticalSolver.AddStructuralConstraint(new Microsoft.Msagl.Layout.Incremental.VerticalSeparationConstraint.ctor$$Node$$Node$$Double(t,n,(n.get_Height()+t.get_Height())/2+this.settings.get_ConstrainedEdgeSeparation()))},AddEConstraint:function(n,t){this.horizontalSolver.AddStructuralConstraint(new Microsoft.Msagl.Layout.Incremental.HorizontalSeparationConstraint.ctor$$Node$$Node$$Double(t,n,(n.get_Width()+t.get_Width())/2+this.settings.get_ConstrainedEdgeSeparation()))},AddWConstraint:function(n,t){this.horizontalSolver.AddStructuralConstraint(new Microsoft.Msagl.Layout.Incremental.HorizontalSeparationConstraint.ctor$$Node$$Node$$Double(n,t,(n.get_Width()+t.get_Width())/2+this.settings.get_ConstrainedEdgeSeparation()))},GenerateSeparationConstraints:function(){for(var t=this.edges.GetEnumerator(),n;t.MoveNext();){for(var i=t.get_Current(),r=!1,u=i.get_Source(),f=i.get_Target(),e=this.cyclicComponents.GetEnumerator();e.MoveNext();)if(n=e.get_Current(),n.Contains$$T(u)&&n.Contains$$T(f)){r=!0;break}r||this.addConstraint(u,f)}},CyclicComponents$$:"System.Collections.Generic.IEnumerable`1[[System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Node]]]]",get_CyclicComponents:function(){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.DataStructures.Set$1.ctor,System.Collections.Generic.IEnumerable$1.ctor,this.cyclicComponents,$CreateAnonymousDelegate(this,function(n){return System.Linq.Enumerable.AsEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,n)}))},DFS:function(n){var t,i;for(n.visited=!0,t=n.outNeighbours.GetEnumerator();t.MoveNext();)i=t.get_Current(),i.visited||this.DFS(i);this.PushStack(n)},RDFS:function(n){var t,i;for(this.component.Add(n),this.PopStack(n),t=n.inNeighbours.GetEnumerator();t.MoveNext();)i=t.get_Current(),i.stackNode!=null&&this.RDFS(i)},CreateTNode:function(n){var t;return this.nodeMap.ContainsKey(n)?t=this.nodeMap.get_Item$$TKey(n):(t=new Microsoft.Msagl.Layout.Incremental.TNode.ctor(n),this.nodeMap.set_Item$$TKey(n,t)),t},PushStack:function(n){n.stackNode=this.stack.AddLast$$T(n)},PopStack:function(n){this.stack.Remove$$LinkedListNode$1(n.stackNode);n.stackNode=null}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$EdgeConstraintGenerator);Microsoft$Msagl$Layout$Incremental$FastIncrementalLayout={fullname:"Microsoft.Msagl.Layout.Incremental.FastIncrementalLayout",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},CalculateMultiPorts:function(n){var r=n.source.get_Center(),u=n.target.get_Center(),i=As(n.mEdge.get_SourcePort(),Microsoft.Msagl.Core.Layout.MultiLocationFloatingPort.ctor),t;i!=null&&i.SetClosestLocation(u);t=As(n.mEdge.get_TargetPort(),Microsoft.Msagl.Core.Layout.MultiLocationFloatingPort.ctor);t!=null&&t.SetClosestLocation(r)},AddGravityForce:function(n,t,i){i.force=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.force,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.0001*t,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,i.get_Center())))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){var e,o,s,h,u,c,l,a,f,v,b;for(this.basicGraph=null,this.components=null,this.constraints=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.List$1.ctor),this.edges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Incremental.FiEdge.ctor),this.energy=0,this.graph=null,this.horizontalSolver=null,this.nodes=null,this.progress=0,this.settings=null,this.stepSize=0,this.verticalSolver=null,this.clusterSettings=null,this.clusterEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor),this.currentConstraintLevel=0,Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this),this.graph=n,this.settings=t,this.clusterSettings=r,e=0,o=this.graph.get_Nodes(),this.nodes=new Array(o.get_Count()),s=o.GetEnumerator();s.MoveNext();)f=s.get_Current(),f.AlgorithmData=this.nodes[e]=new Microsoft.Msagl.Layout.Incremental.FiNode.ctor(e,f),e++;for(this.clusterEdges.Clear(),this.edges.Clear(),h=this.graph.get_Edges().GetEnumerator();h.MoveNext();)for(u=h.get_Current(),Is(u.get_Source(),Microsoft.Msagl.Core.Layout.Cluster.ctor)||Is(u.get_Target(),Microsoft.Msagl.Core.Layout.Cluster.ctor)?this.clusterEdges.Add(u):this.edges.Add(new Microsoft.Msagl.Layout.Incremental.FiEdge.ctor(u)),c=u.get_Labels().GetEnumerator();c.MoveNext();)l=c.get_Current(),l.set_InnerPoints(function(n){return l.set_OuterPoints(n),n}.call(this,null));if(this.SetLockNodeWeights(),this.components=new System.Collections.Generic.List$1.ctor(Array),t.get_InterComponentForces())this.components.Add(this.nodes);else for(this.basicGraph=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Layout.Incremental.FiEdge.ctor,this.edges,this.nodes.length),a=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(this.basicGraph).GetEnumerator();a.MoveNext();){for(var y=a.get_Current(),p=new Array(System.Linq.Enumerable.Count$1$$IEnumerable$1(System.Int32.ctor,y)),k=0,w=y.GetEnumerator();w.MoveNext();)f=w.get_Current(),p[k++]=this.nodes[f];this.components.Add(p)}for(this.horizontalSolver=function(){var i=new Microsoft.Msagl.Layout.Incremental.AxisSolver.ctor(!0,this.nodes,[n.get_RootCluster()],t.get_AvoidOverlaps(),t.get_MinConstraintLevel(),r);return i.OverlapRemovalParameters=function(){var n=new Microsoft.Msagl.Core.Geometry.OverlapRemovalParameters.ctor;return n.set_AllowDeferToVertical(!0),n.set_ConsiderProportionalOverlap(t.get_ApplyForces()),n}.call(this),i}.call(this),this.verticalSolver=new Microsoft.Msagl.Layout.Incremental.AxisSolver.ctor(!1,this.nodes,[n.get_RootCluster()],t.get_AvoidOverlaps(),t.get_MinConstraintLevel(),r),this.SetupConstraints(),n.get_RootCluster().ComputeWeight(),v=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_RootCluster().AllClustersDepthFirst(),$CreateAnonymousDelegate(this,function(n){return n.get_RectangularBoundary()==null})).GetEnumerator();v.MoveNext();)b=v.get_Current(),b.set_RectangularBoundary(new Microsoft.Msagl.Core.Geometry.RectangularClusterBoundary.ctor);this.set_CurrentConstraintLevel(i)},SetupConstraints:function(){var t,n;for(this.AddConstraintLevel(0),this.settings.get_AvoidOverlaps()&&this.AddConstraintLevel(2),t=this.settings.get_StructuralConstraints().GetEnumerator();t.MoveNext();)n=t.get_Current(),this.AddConstraintLevel(n.get_Level()),Is(n,Microsoft.Msagl.Layout.Incremental.VerticalSeparationConstraint.ctor)?this.verticalSolver.AddStructuralConstraint(n):Is(n,Microsoft.Msagl.Layout.Incremental.HorizontalSeparationConstraint.ctor)?this.horizontalSolver.AddStructuralConstraint(n):this.AddConstraint(n);Microsoft.Msagl.Layout.Incremental.EdgeConstraintGenerator.GenerateEdgeConstraints(this.graph.get_Edges(),this.settings.get_IdealEdgeLength(),this.horizontalSolver,this.verticalSolver)},CurrentConstraintLevel$$:"System.Int32",get_CurrentConstraintLevel:function(){return this.currentConstraintLevel},set_CurrentConstraintLevel:function(n){this.currentConstraintLevel=n;this.horizontalSolver.ConstraintLevel=n;this.verticalSolver.ConstraintLevel=n;Microsoft.Msagl.Layout.Incremental.Feasibility.Enforce(this.settings,n,this.nodes,this.horizontalSolver.structuralConstraints,this.verticalSolver.structuralConstraints,[this.graph.get_RootCluster()],this.clusterSettings);this.settings.Unconverge()},AddConstraint:function(n){this.constraints.ContainsKey(n.get_Level())||this.constraints.set_Item$$TKey(n.get_Level(),new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Incremental.IConstraint.ctor));this.constraints.get_Item$$TKey(n.get_Level()).Add(n)},AddConstraintLevel:function(n){this.constraints.ContainsKey(n)||this.constraints.set_Item$$TKey(n,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Incremental.IConstraint.ctor))},SetLockNodeWeights:function(){for(var n=this.settings.locks.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.SetLockNodeWeight()},ResetNodePositions:function(){for(var i,e,r,u,n=0,t=this.nodes,o=t.length,f=t[n];n<o;n++,f=t[n])f.ResetBounds();for(i=this.edges.GetEnumerator();i.MoveNext();)for(e=i.get_Current(),r=e.mEdge.get_Labels().GetEnumerator();r.MoveNext();)u=r.get_Current(),u.set_InnerPoints(function(n){return u.set_OuterPoints(n),n}.call(this,null))},AddRepulsiveForce:function(n,t){n.force=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(10*this.settings.get_RepulsiveForceConstant(),t)},AddLogSpringForces:function(n,t,i){var r=t.get_Length(),u=.0007*this.settings.get_AttractiveForceConstant()*r*System.Math.Log$$Double((r+.1)/(i+.1));n.source.force=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.source.force,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(u,t));n.target.force=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.target.force,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(u,t))},AddSquaredSpringForces:function(n,t,i){var u=t.get_Length(),f=i*i+.1,r=this.settings.get_AttractiveForceConstant()*(u-i)/f;n.source.force=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.source.force,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(r,t));n.target.force=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.target.force,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(r,t))},AddSpringForces:function(n){var t,i;if(this.settings.get_RespectEdgePorts()){var r=n.source.get_Center(),u=n.target.get_Center(),f=As(n.mEdge.get_SourcePort(),Microsoft.Msagl.Core.Layout.FloatingPort.ctor);f!=null&&(r=f.get_Location());i=As(n.mEdge.get_TargetPort(),Microsoft.Msagl.Core.Layout.FloatingPort.ctor);i!=null&&(u=i.get_Location());t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,u)}else t=n.vector();this.settings.get_LogScaleEdgeForces()?this.AddLogSpringForces(n,t,n.mEdge.get_Length()):this.AddSquaredSpringForces(n,t,n.mEdge.get_Length())},ComputeRepulsiveForces:function(n){var e=n.length,c,t,u;if(e>16&&this.settings.get_ApproximateRepulsion()){var o=new Array(n.length),s=0,l=6.28318530717959/e;for(t=0;t<e;++t)o[t]=new Microsoft.Msagl.Layout.Incremental.KDTree.Particle.ctor(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n[t].get_Center(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1e-5,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Cos(s),System.Math.Sin(s))))),s+=l;for(c=new Microsoft.Msagl.Layout.Incremental.KDTree.ctor(o,8),c.ComputeForces(5),t=0;t<n.length;++t)this.AddRepulsiveForce(n[t],o[t].force)}else for(var i=0,a=n.length,r=n[i];i<a;i++,r=n[i]){u=new Microsoft.Msagl.Core.Geometry.Point.ctor;for(var f=0,v=n.length,h=n[f];f<v;f++,h=n[f])r!=h&&(u=Microsoft.Msagl.Core.Geometry.Point.op_Addition(u,Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Force(r.get_Center(),h.get_Center())));this.AddRepulsiveForce(r,u)}},AddClusterForces:function(n){var o,c,e;if(n!=null){for(n.SetBarycenter(),o=this.clusterEdges.GetEnumerator();o.MoveNext();){var i=o.get_Current(),r=As(i.get_Source(),Microsoft.Msagl.Core.Layout.Cluster.ctor),u=As(i.get_Target(),Microsoft.Msagl.Core.Layout.Cluster.ctor),s=As(i.get_Source().AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor),h=As(i.get_Target().AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor),a=r!=null?r.Barycenter:s.get_Center(),v=u!=null?u.Barycenter:h.get_Center(),t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(a,v),l=t.get_Length(),f=1e-8*this.settings.get_AttractiveInterClusterForceConstant()*l*System.Math.Log$$Double(l+.1);r!=null?r.ForEachNode($CreateAnonymousDelegate(this,function(n){var i=As(n.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor);i.force=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.force,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(f,t))})):s.force=Microsoft.Msagl.Core.Geometry.Point.op_Addition(s.force,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(f,t));u!=null?u.ForEachNode($CreateAnonymousDelegate(this,function(n){var i=As(n.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor);i.force=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.force,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(f,t))})):h.force=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h.force,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(f,t))}for(c=n.AllClustersDepthFirst().GetEnumerator();c.MoveNext();)e=c.get_Current(),e!=n&&e.ForEachNode($CreateAnonymousDelegate(this,function(n){Microsoft.Msagl.Layout.Incremental.FastIncrementalLayout.AddGravityForce(e.Barycenter,this.settings.get_ClusterGravity(),Cast(n.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor))}))}},ComputeForces:function(){var f,t,i,r,u,n;for(this.components!=null?this.components.ForEach($CreateDelegate(this,this.ComputeRepulsiveForces)):this.ComputeRepulsiveForces(this.nodes),this.edges.ForEach($CreateDelegate(this,this.AddSpringForces)),f=this.components.GetEnumerator();f.MoveNext();){for(t=f.get_Current(),i=new Microsoft.Msagl.Core.Geometry.Point.ctor,n=0;n<t.length;++n)i=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,t[n].get_Center());for(i=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(i,t.length),r=-Infinity,n=0;n<t.length;++n)u=t[n],Microsoft.Msagl.Layout.Incremental.FastIncrementalLayout.AddGravityForce(i,this.settings.get_GravityConstant(),u),u.force.get_Length()>r&&(r=u.force.get_Length());if(r>100)for(n=0;n<t.length;++n)t[n].force=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t[n].force,100/r)}this.AddClusterForces(this.graph.get_RootCluster())},SatisfyConstraints:function(){for(var i,r,u,f,e,o,s,h,n,c,t=0;t<this.settings.get_ProjectionIterations();++t){for(i=this.constraints.get_Keys().GetEnumerator();i.MoveNext();){if(r=i.get_Current(),r>this.get_CurrentConstraintLevel())break;for(u=this.constraints.get_Item$$TKey(r).GetEnumerator();u.MoveNext();)for(f=u.get_Current(),f.Project(),e=f.get_Nodes().GetEnumerator();e.MoveNext();)n=e.get_Current(),Cast(n.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor).set_Center(n.get_Center())}for(o=this.settings.locks.GetEnumerator();o.MoveNext();)for(s=o.get_Current(),s.Project(),h=s.get_Nodes().GetEnumerator();h.MoveNext();)n=h.get_Current(),c=As(n.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor),c!=null&&n.AlgorithmData!=null&&c.ResetBounds()}},NeedSolve:function(){return this.horizontalSolver.get_NeedSolve()||this.verticalSolver.get_NeedSolve()},VerletIntegration:function(){var r=this.energy,t,n,i;for(this.energy=this.ComputeDescentDirection(1),this.UpdateStepSize(r),this.SolveSeparationConstraints(),t=0,n=0;n<this.nodes.length;++n)i=this.nodes[n],t+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Center(),i.previousCenter).get_LengthSquared();return t},SolveSeparationConstraints:function(){var f,e;if(this.NeedSolve()){for(var t=this.settings.get_NodeSeparation(),o=t+.0001,i=this.settings.get_ClusterMargin(),s=i+.0001,n=0,r=this.nodes,h=r.length,u=r[n];n<h;n++,u=r[n])u.desiredPosition=u.get_Center();for(this.horizontalSolver.Initialize(o,t,s,i,$CreateAnonymousDelegate(this,function(n){return n.previousCenter})),this.horizontalSolver.SetDesiredPositions(),this.horizontalSolver.Solve(),this.verticalSolver.Initialize(o,t,s,i,$CreateAnonymousDelegate(this,function(n){return n.get_Center()})),this.verticalSolver.SetDesiredPositions(),this.verticalSolver.Solve(),f=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Incremental.LockPosition.ctor,this.settings.locks,$CreateAnonymousDelegate(this,function(n){return!n.get_Sticky()})).GetEnumerator();f.MoveNext();)e=f.get_Current(),e.set_Bounds(e.node.get_BoundingBox())}},ComputeDescentDirection:function(n){var f,i,r;this.ResetForceVectors();this.settings.get_ApplyForces()&&this.ComputeForces();f=0;for(var u=0,e=this.nodes,o=e.length,t=e[u];u<o;u++,t=e[u])f+=t.force.get_LengthSquared(),i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Center(),t.previousCenter),t.previousCenter=t.get_Center(),i=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(i,this.settings.get_Friction()),r=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(-this.stepSize*n,t.force),System.Diagnostics.Debug.Assert$$Boolean$$String(!System.Double.IsNaN(r.get_X()),"!double.IsNaN(a.X)"),System.Diagnostics.Debug.Assert$$Boolean$$String(!System.Double.IsNaN(r.get_Y()),"!double.IsNaN(a.Y)"),System.Diagnostics.Debug.Assert$$Boolean$$String(!System.Double.IsInfinity(r.get_X()),"!double.IsInfinity(a.X)"),System.Diagnostics.Debug.Assert$$Boolean$$String(!System.Double.IsInfinity(r.get_Y()),"!double.IsInfinity(a.Y)"),i=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,r),i=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(i,t.stayWeight),t.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Center(),i));return this.SatisfyConstraints(),f},ResetForceVectors:function(){for(var n=0,t=this.nodes,r=t.length,i=t[n];n<r;n++,i=t[n])i.force=new Microsoft.Msagl.Core.Geometry.Point.ctor},UpdateStepSize:function(n){this.energy<n?++this.progress>=3&&(this.progress=0,this.stepSize/=this.settings.get_Decay()):(this.progress=0,this.stepSize*=this.settings.get_Decay())},RungeKuttaIntegration:function(){var t=new Array(this.nodes.length),r=new Array(this.nodes.length),u=new Array(this.nodes.length),f=new Array(this.nodes.length),e=new Array(this.nodes.length),s=this.energy,i,n,o;for(this.SatisfyConstraints(),n=0;n<this.nodes.length;++n)t[n]=this.nodes[n].previousCenter=this.nodes[n].get_Center();for(i=3,this.ComputeDescentDirection(i),n=0;n<this.nodes.length;++n)r[n]=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.nodes[n].get_Center(),this.nodes[n].previousCenter),this.nodes[n].set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t[n],Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,r[n])));for(this.ComputeDescentDirection(i),n=0;n<this.nodes.length;++n)u[n]=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.nodes[n].get_Center(),this.nodes[n].previousCenter),this.nodes[n].previousCenter=t[n],this.nodes[n].set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t[n],Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,u[n])));for(this.ComputeDescentDirection(i),n=0;n<this.nodes.length;++n)f[n]=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.nodes[n].get_Center(),this.nodes[n].previousCenter),this.nodes[n].previousCenter=t[n],this.nodes[n].set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t[n],f[n]));for(this.energy=this.ComputeDescentDirection(i),n=0;n<this.nodes.length;++n)e[n]=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.nodes[n].get_Center(),this.nodes[n].previousCenter),this.nodes[n].previousCenter=t[n],o=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(r[n],Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(2,u[n])),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(2,f[n])),e[n]),6),this.nodes[n].set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t[n],o));return this.UpdateStepSize(s),this.SolveSeparationConstraints(),System.Linq.Enumerable.Sum$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Incremental.FiNode.ctor,this.nodes,$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Center(),n.previousCenter).get_LengthSquared()}))},RunInternal:function(){var n,t;for(this.settings.set_Converged(!1),this.settings.set_EdgeRoutesUpToDate(!1),this.settings.set_Iterations(this.settings.get_Iterations()+1)==0&&(this.stepSize=this.settings.get_InitialStepSize(),this.energy=3402823e32,this.progress=0),this.StartListenToLocalProgress(this.settings.get_MinorIterations(),1),n=0;n<this.settings.get_MinorIterations();++n){if(this.settings.get_RespectEdgePorts()&&this.edges.ForEach(Microsoft.Msagl.Layout.Incremental.FastIncrementalLayout.CalculateMultiPorts),t=this.settings.get_RungeKuttaIntegration()?this.RungeKuttaIntegration():this.VerletIntegration(),t<this.settings.get_DisplacementThreshold()||this.settings.get_Iterations()>this.settings.get_MaxIterations()){this.settings.set_Converged(!0);this.ProgressComplete();break}this.ProgressStep()}this.FinalizeClusterBoundaries()},FinalizeClusterBoundaries:function(){for(var t=this.graph.get_RootCluster().AllClustersDepthFirst().GetEnumerator(),n;t.MoveNext();)(n=t.get_Current(),n!=this.graph.get_RootCluster())&&(!this.NeedSolve()&&this.settings.get_UpdateClusterBoundariesFromChildren()?n.CalculateBoundsFromChildren(this.settings.get_ClusterMargin()):n.set_BoundingBox(n.get_RectangularBoundary().get_Rect()),n.RaiseLayoutDoneEvent())}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$FastIncrementalLayout);Microsoft$Msagl$Layout$Incremental$FiEdge={fullname:"Microsoft.Msagl.Layout.Incremental.FiEdge",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.GraphAlgorithms.IEdge"],Kind:"Class",definition:{ctor:function(n){this.mEdge=null;this.source=null;this.target=null;System.Object.ctor.call(this);this.mEdge=n;this.source=Cast(n.get_Source().AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor);this.target=Cast(n.get_Target().AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor)},Source$$:"System.Int32",get_Source:function(){return this.source.index},set_Source:function(){},Target$$:"System.Int32",get_Target:function(){return this.target.index},set_Target:function(){},vector:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.source.mNode.get_Center(),this.target.mNode.get_Center())}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$FiEdge);Microsoft$Msagl$Layout$Incremental$FiNode={fullname:"Microsoft.Msagl.Layout.Incremental.FiNode",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.desiredPosition=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.force=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.index=0;this.mNode=null;this.mOlapNodeX=null;this.mOlapNodeY=null;this.previousCenter=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.center=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.stayWeight=1;this.Width=0;this.Height=0;System.Object.ctor.call(this);this.index=n;this.mNode=t;this.ResetBounds()},Center$$:"Microsoft.Msagl.Core.Geometry.Point",get_Center:function(){return this.center},set_Center:function(n){this.center=function(n){return this.mNode.set_Center(n),n}.call(this,n)},ResetBounds:function(){this.center=this.previousCenter=this.mNode.get_Center();this.Width=this.mNode.get_Width();this.Height=this.mNode.get_Height()},getOlapNode:function(n){return n?this.mOlapNodeX:this.mOlapNodeY},SetOlapNode:function(n,t){n?this.mOlapNodeX=t:this.mOlapNodeY=t},SetVariableDesiredPos:function(n){n?this.mOlapNodeX.get_Variable().set_DesiredPos(this.desiredPosition.get_X()):this.mOlapNodeY.get_Variable().set_DesiredPos(this.desiredPosition.get_Y())},UpdatePos:function(n){n?this.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.getOlapNode(!0).get_Position(),this.previousCenter.get_Y())):this.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Center().get_X(),this.getOlapNode(!1).get_Position()))},toString:function(){return"FINode("+this.index+"):"+this.mNode}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$FiNode);Microsoft$Msagl$Layout$Incremental$HorizontalSeparationConstraint={fullname:"Microsoft.Msagl.Layout.Incremental.HorizontalSeparationConstraint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.Incremental.IConstraint"],Kind:"Class",definition:{ctor$$Node$$Node$$Double:function(n,t,i){this.equality=!1;this.u=null;this.v=null;this.separation=0;System.Object.ctor.call(this);this.u=n;this.v=t;this.separation=i},IsEquality$$:"System.Boolean",get_IsEquality:function(){return this.equality},LeftNode$$:"Microsoft.Msagl.Core.Layout.Node",get_LeftNode:function(){return this.u},RightNode$$:"Microsoft.Msagl.Core.Layout.Node",get_RightNode:function(){return this.v},Separation$$:"System.Double",get_Separation:function(){return this.separation},set_Separation:function(n){this.separation=n},ctor$$Node$$Node$$Double$$Boolean:function(n,t,i,r){this.equality=!1;this.u=null;this.v=null;this.separation=0;System.Object.ctor.call(this);this.equality=r;this.u=n;this.v=t;this.separation=i},Project:function(){var u=this.v.get_Center().get_X()-this.u.get_Center().get_X(),n=this.separation-u;if(n>0){var t=Cast(this.u.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor).stayWeight,i=Cast(this.v.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor).stayWeight,r=n/(t+i);return this.u.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.u.get_Center().get_X()-i*r,this.u.get_Center().get_Y())),this.v.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.v.get_Center().get_X()+t*r,this.v.get_Center().get_Y())),n}return 0},Level$$:"System.Int32",get_Level:function(){return 0},Nodes$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Node]]",get_Nodes:function(){return[this.u,this.v]}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$HorizontalSeparationConstraint);Microsoft$Msagl$Layout$Incremental$IConstraint={fullname:"Microsoft.Msagl.Layout.Incremental.IConstraint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Layout$Incremental$IConstraint);Microsoft$Msagl$Layout$Incremental$LockPosition={fullname:"Microsoft.Msagl.Layout.Incremental.LockPosition",baseTypeName:"System.Object",staticDefinition:{SetFINodeWeight:function(n,t){var i=As(n.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor);i!=null&&(i.stayWeight=t)}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.Incremental.IConstraint"],Kind:"Class",definition:{ctor$$Node$$Rectangle:function(n,t){this.weight=1e6;this.node=null;this.listNode=null;this._Bounds=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._Sticky=!1;System.Object.ctor.call(this);this.node=n;this.set_Bounds(t)},ctor$$Node$$Rectangle$$Double:function(n,t,i){this.weight=1e6;this.node=null;this.listNode=null;this._Bounds=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._Sticky=!1;Microsoft.Msagl.Layout.Incremental.LockPosition.ctor$$Node$$Rectangle.call(this,n,t);this.set_Weight(i)},Weight$$:"System.Double",get_Weight:function(){return this.weight},set_Weight:function(n){if(n>1e20)throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String("value","must be < 1e10 or we run out of precision"),new Error);if(n<.001)throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String("value","must be > 1e-3 or we run out of precision"),new Error);this.weight=n},Bounds$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_Bounds:function(){return this._Bounds},set_Bounds:function(n){this._Bounds=n},Sticky$$:"System.Boolean",get_Sticky:function(){return this._Sticky},set_Sticky:function(n){this._Sticky=n},Project:function(){var t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.get_Bounds().get_LeftBottom(),this.node.get_BoundingBox().get_LeftBottom()),o=t.get_Length(),s=o,i=As(this.node,Microsoft.Msagl.Core.Layout.Cluster.ctor),r,n,u,f,e;if(i!=null)for(r=i.AllClustersDepthFirst().GetEnumerator();r.MoveNext();){for(n=r.get_Current(),u=n.get_Nodes().GetEnumerator();u.MoveNext();)f=u.get_Current(),f.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(f.get_Center(),t)),s+=o;n==i?i.get_RectangularBoundary().set_Rect(this.get_Bounds()):(e=n.get_RectangularBoundary().get_Rect(),n.get_RectangularBoundary().set_Rect(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(e.get_LeftBottom(),t),Microsoft.Msagl.Core.Geometry.Point.op_Addition(e.get_RightTop(),t))))}else this.node.set_BoundingBox(this.get_Bounds());return s},Level$$:"System.Int32",get_Level:function(){return 0},SetLockNodeWeight:function(){var t=As(this.node,Microsoft.Msagl.Core.Layout.Cluster.ctor),e,i,r,u,o,f,n;if(t!=null)for(e=t.get_RectangularBoundary(),e.Lock$$Double$$Double$$Double$$Double(this.get_Bounds().get_Left(),this.get_Bounds().get_Right(),this.get_Bounds().get_Top(),this.get_Bounds().get_Bottom()),i=t.AllClustersDepthFirst().GetEnumerator();i.MoveNext();)for(r=i.get_Current(),r.get_RectangularBoundary().set_GenerateFixedConstraints(!0),u=r.get_Nodes().GetEnumerator();u.MoveNext();)o=u.get_Current(),Microsoft.Msagl.Layout.Incremental.LockPosition.SetFINodeWeight(o,this.weight);else Microsoft.Msagl.Layout.Incremental.LockPosition.SetFINodeWeight(this.node,this.weight);for(f=this.node.get_AllClusterAncestors().GetEnumerator();f.MoveNext();)n=f.get_Current(),n.get_RectangularBoundary()!=null&&n.get_RectangularBoundary().set_GenerateFixedConstraints(!1),n.UnsetInitialLayoutState()},RestoreNodeWeight:function(){var i=As(this.node,Microsoft.Msagl.Core.Layout.Cluster.ctor),r,t,u,f,n;if(i!=null)for(i.get_RectangularBoundary().Unlock(),r=i.AllClustersDepthFirst().GetEnumerator();r.MoveNext();)for(t=r.get_Current(),t.get_RectangularBoundary().set_GenerateFixedConstraints(t.get_RectangularBoundary().get_GenerateFixedConstraintsDefault()),u=t.get_Nodes().GetEnumerator();u.MoveNext();)f=u.get_Current(),Microsoft.Msagl.Layout.Incremental.LockPosition.SetFINodeWeight(f,1);else Microsoft.Msagl.Layout.Incremental.LockPosition.SetFINodeWeight(this.node,1);for(n=System.Linq.Enumerable.FirstOrDefault$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,this.node.get_ClusterParents());n!=null;)n.get_RectangularBoundary()!=null&&n.get_RectangularBoundary().set_GenerateFixedConstraints(n.get_RectangularBoundary().get_GenerateFixedConstraintsDefault()),n=System.Linq.Enumerable.FirstOrDefault$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_ClusterParents())},Nodes$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Node]]",get_Nodes:function(){var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),t=As(this.node,Microsoft.Msagl.Core.Layout.Cluster.ctor);return t!=null?t.ForEachNode($CreateDelegate(n,n.Add)):n.Add(this.node),n}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$LockPosition);Microsoft$Msagl$Layout$Incremental$MaxSeparationConstraint={fullname:"Microsoft.Msagl.Layout.Incremental.MaxSeparationConstraint",baseTypeName:"Microsoft.Msagl.Layout.Incremental.StickConstraint",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){Microsoft.Msagl.Layout.Incremental.StickConstraint.ctor.call(this,n,t,i)},Project:function(){var n=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.v.get_Center(),this.u.get_Center());return n.get_Length()>this.separation?Microsoft.Msagl.Layout.Incremental.StickConstraint.commonPrototype.Project.call(this):0}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$MaxSeparationConstraint);Microsoft$Msagl$Layout$Incremental$MinSeparationConstraint={fullname:"Microsoft.Msagl.Layout.Incremental.MinSeparationConstraint",baseTypeName:"Microsoft.Msagl.Layout.Incremental.StickConstraint",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){Microsoft.Msagl.Layout.Incremental.StickConstraint.ctor.call(this,n,t,i)},Project:function(){var n=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.v.get_Center(),this.u.get_Center());return n.get_Length()<this.separation?Microsoft.Msagl.Layout.Incremental.StickConstraint.commonPrototype.Project.call(this):0}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$MinSeparationConstraint);Microsoft$Msagl$Layout$Incremental$KDTree={fullname:"Microsoft.Msagl.Layout.Incremental.KDTree",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){var f,r,i,u;for(this.particles=null,this.root=null,this.leaves=null,System.Object.ctor.call(this),this.particles=n,f=[this.particlesBy(Microsoft.Msagl.Layout.Incremental.KDTree.Particle.Dim.Horizontal),this.particlesBy(Microsoft.Msagl.Layout.Incremental.KDTree.Particle.Dim.Vertical)],this.leaves=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Incremental.KDTree.LeafKdNode.ctor),r=new Microsoft.Msagl.Layout.Incremental.KDTree.LeafKdNode.ctor(f),this.leaves.Add(r),this.root=function(){var n={Value:i},t=r.Split(n);return i=n.Value,t}.call(this),this.leaves.Add(i),u=new Microsoft.Msagl.Layout.Incremental.KDTree.SplitQueue.ctor(t),u.Enqueue$$LeafKdNode$$LeafKdNode(r,i);u.get_Count()>0;)r=u.Dequeue(),function(){var n={Value:i},t=r.Split(n);return i=n.Value,t}.call(this),this.leaves.Add(i),u.Enqueue$$LeafKdNode$$LeafKdNode(r,i)},particlesBy:function(n){return System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Layout.Incremental.KDTree.Particle.ctor,System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Incremental.KDTree.Particle.ctor,System.Double.ctor,System.Linq.Enumerable.Cast$1(Microsoft.Msagl.Layout.Incremental.KDTree.Particle.ctor,this.particles),$CreateAnonymousDelegate(this,function(t){return t.pos(n)})))},ComputeForces:function(n){var s,r,i,u,c,y;for(this.root.computeMultipoleCoefficients(n),s=this.leaves.GetEnumerator();s.MoveNext();)for(r=s.get_Current(),r.ComputeForces(),i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Incremental.KDTree.KdNode.ctor),i.Add(this.root);i.get_Count()>0;)if(u=System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Layout.Incremental.KDTree.KdNode.ctor,i),i.RemoveAt(i.get_Count()-1),r.intersects(u))if(c=As(u,Microsoft.Msagl.Layout.Incremental.KDTree.LeafKdNode.ctor),c!=null)for(var e=0,l=r.particles[0],w=l.length,t=l[e];e<w;e++,t=l[e])for(var o=0,a=c.particles[0],b=a.length,v=a[o];o<b;o++,v=a[o])t!=v&&(t.force=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.force,Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Force(t.point,v.point)));else y=As(u,Microsoft.Msagl.Layout.Incremental.KDTree.InternalKdNode.ctor),i.Add(y.leftChild),i.Add(y.rightChild);else for(var f=0,h=r.particles[0],p=h.length,t=h[f];f<p;f++,t=h[f])t.force=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.force,u.multipoleCoefficients.ApproximateForce(t.point))}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$KDTree);Microsoft$Msagl$Layout$Incremental$FastIncrementalLayoutSettings={fullname:"Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings",baseTypeName:"Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings",staticDefinition:{CreateFastIncrementalLayoutSettings:function(){return function(){var n=new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor;return n.set_ApplyForces(!1),n.set_ApproximateRepulsion(!0),n.set_ApproximateRouting(!0),n.set_AttractiveForceConstant(1),n.set_AttractiveInterClusterForceConstant(1),n.set_AvoidOverlaps(!0),n.set_ClusterGravity(1),n.set_Decay(.9),n.set_DisplacementThreshold(5e-8),n.set_Friction(.8),n.set_GravityConstant(1),n.set_InitialStepSize(2),n.set_InterComponentForces(!1),n.set_Iterations(0),n.set_LogScaleEdgeForces(!1),n.set_MaxConstraintLevel(2),n.set_MaxIterations(20),n.set_MinConstraintLevel(0),n.set_MinorIterations(1),n.set_ProjectionIterations(5),n.set_RepulsiveForceConstant(2),n.set_RespectEdgePorts(!1),n.set_RouteEdges(!1),n.set_RungeKuttaIntegration(!0),n.set_UpdateClusterBoundariesFromChildren(!0),n.set_NodeSeparation(20),n}()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.maxIterations=100;this.minorIterations=3;this.iterations=0;this.projectionIterations=5;this.approximateRepulsion=!0;this.initialStepSize=1.4;this.decay=.9;this.friction=.8;this.repulsiveForceConstant=1;this.attractiveForceConstant=1;this.gravity=1;this.interComponentForces=!0;this.applyForces=!0;this.algorithm=null;this.locks=new System.Collections.Generic.LinkedList$1.ctor(Microsoft.Msagl.Layout.Incremental.LockPosition.ctor);this.structuralConstraints=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Incremental.IConstraint.ctor);this.approximateRouting=!0;this.logScaleEdgeForces=!0;this.displacementThreshold=.1;this.converged=!1;this.maxConstraintLevel=2;this.minConstraintLevel=0;this.attractiveInterClusterForceConstant=1;this.clusterGravity=1;this.updateClusterBoundaries=!0;this._RungeKuttaIntegration=!1;this._AvoidOverlaps=!1;this._RespectEdgePorts=!1;this._RouteEdges=!1;this._EdgeRoutesUpToDate=!1;this._IdealEdgeLength=new Microsoft.Msagl.Core.Layout.IdealEdgeLengthSettings.ctor;Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings.ctor.call(this)},MaxIterations$$:"System.Int32",get_MaxIterations:function(){return this.maxIterations},set_MaxIterations:function(n){this.maxIterations=n},MinorIterations$$:"System.Int32",get_MinorIterations:function(){return this.minorIterations},set_MinorIterations:function(n){this.minorIterations=n},Iterations$$:"System.Int32",get_Iterations:function(){return this.iterations},set_Iterations:function(n){this.iterations=n},ProjectionIterations$$:"System.Int32",get_ProjectionIterations:function(){return this.projectionIterations},set_ProjectionIterations:function(n){this.projectionIterations=n},ApproximateRepulsion$$:"System.Boolean",get_ApproximateRepulsion:function(){return this.approximateRepulsion},set_ApproximateRepulsion:function(n){this.approximateRepulsion=n},RungeKuttaIntegration$$:"System.Boolean",get_RungeKuttaIntegration:function(){return this._RungeKuttaIntegration},set_RungeKuttaIntegration:function(n){this._RungeKuttaIntegration=n},InitialStepSize$$:"System.Double",get_InitialStepSize:function(){return this.initialStepSize},set_InitialStepSize:function(n){if(n<=0||n>2)throw $CreateException(new System.ArgumentException.ctor$$String("ForceScalar should be greater than 0 and less than 2 (if we let you set it to 0 nothing would happen, greater than 2 would most likely be very unstable!)"),new Error);this.initialStepSize=n},Decay$$:"System.Double",get_Decay:function(){return this.decay},set_Decay:function(n){if(n<.1||n>1)throw $CreateException(new System.ArgumentException.ctor$$String("Setting decay too small gives no progress.  1==no decay, 0.1==minimum allowed value"),new Error);this.decay=n},Friction$$:"System.Double",get_Friction:function(){return this.friction},set_Friction:function(n){if(n<0||n>1)throw $CreateException(new System.ArgumentException.ctor$$String("Setting friction less than 0 or greater than 1 would just be strange.  1==no friction, 0==no conservation of velocity"),new Error);this.friction=n},RepulsiveForceConstant$$:"System.Double",get_RepulsiveForceConstant:function(){return this.repulsiveForceConstant},set_RepulsiveForceConstant:function(n){this.repulsiveForceConstant=n},AttractiveForceConstant$$:"System.Double",get_AttractiveForceConstant:function(){return this.attractiveForceConstant},set_AttractiveForceConstant:function(n){this.attractiveForceConstant=n},GravityConstant$$:"System.Double",get_GravityConstant:function(){return this.gravity},set_GravityConstant:function(n){this.gravity=n},InterComponentForces$$:"System.Boolean",get_InterComponentForces:function(){return this.interComponentForces},set_InterComponentForces:function(n){this.interComponentForces=n},ApplyForces$$:"System.Boolean",get_ApplyForces:function(){return this.applyForces},set_ApplyForces:function(n){this.applyForces=n},CreateLock$$Node$$Rectangle:function(n,t){var i=new Microsoft.Msagl.Layout.Incremental.LockPosition.ctor$$Node$$Rectangle(n,t);return i.listNode=this.locks.AddLast$$T(i),i},CreateLock$$Node$$Rectangle$$Double:function(n,t,i){var r=new Microsoft.Msagl.Layout.Incremental.LockPosition.ctor$$Node$$Rectangle$$Double(n,t,i);return r.listNode=this.locks.AddLast$$T(r),r},ClearLocks:function(){this.locks.Clear()},RemoveLock:function(n){if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"lockPosition"),n.listNode!=null){n.RestoreNodeWeight();try{this.locks.Remove$$LinkedListNode$1(n.listNode)}catch(t){System.Console.WriteLine$$String("Problem in FastIncrementalLayoutSettings.RemoveLock "+t.get_Message())}n.listNode=null}},ResetLayout:function(){this.Unconverge();this.algorithm!=null&&(this.algorithm.ResetNodePositions(),this.algorithm.SetLockNodeWeights())},Unconverge:function(){this.iterations=0;this.converged=!1},InitializeLayout$$GeometryGraph$$Int32:function(n,t){this.InitializeLayout$$GeometryGraph$$Int32$$Func$2$Cluster$LayoutAlgorithmSettings(n,t,$CreateAnonymousDelegate(this,function(){return this}))},InitializeLayout$$GeometryGraph$$Int32$$Func$2$Cluster$LayoutAlgorithmSettings:function(n,t,i){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"graph");this.algorithm=new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayout.ctor(n,this,t,i);this.ResetLayout()},Uninitialize:function(){this.algorithm=null},IsInitialized$$:"System.Boolean",get_IsInitialized:function(){return this.algorithm!=null},IncrementalRun$$GeometryGraph:function(n){this.IncrementalRun$$GeometryGraph$$Func$2$Cluster$LayoutAlgorithmSettings(n,$CreateAnonymousDelegate(this,function(){return this}))},SetupIncrementalRun:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"graph");this.get_IsInitialized()?this.get_IsDone()&&this.ResetLayout():this.InitializeLayout$$GeometryGraph$$Int32$$Func$2$Cluster$LayoutAlgorithmSettings(n,this.get_MaxConstraintLevel(),t)},IncrementalRun$$GeometryGraph$$Func$2$Cluster$LayoutAlgorithmSettings:function(n,t){this.SetupIncrementalRun(n,t);this.algorithm.Run();n.UpdateBoundingBox()},IncrementalRun$$CancelToken$$GeometryGraph$$Func$2$Cluster$LayoutAlgorithmSettings:function(n,t,i){n!=null&&n.ThrowIfCanceled();this.SetupIncrementalRun(t,i);this.algorithm.Run$$CancelToken(n);t.UpdateBoundingBox()},Clone:function(){return As(this.MemberwiseClone(),Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings.ctor)},StructuralConstraints$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Layout.Incremental.IConstraint]]",get_StructuralConstraints:function(){return this.structuralConstraints},AddStructuralConstraint:function(n){this.structuralConstraints.Add(n)},ClearConstraints:function(){this.locks.Clear();this.structuralConstraints.Clear()},ClearStructuralConstraints:function(){this.structuralConstraints.Clear()},AvoidOverlaps$$:"System.Boolean",get_AvoidOverlaps:function(){return this._AvoidOverlaps},set_AvoidOverlaps:function(n){this._AvoidOverlaps=n},RespectEdgePorts$$:"System.Boolean",get_RespectEdgePorts:function(){return this._RespectEdgePorts},set_RespectEdgePorts:function(n){this._RespectEdgePorts=n},RouteEdges$$:"System.Boolean",get_RouteEdges:function(){return this._RouteEdges},set_RouteEdges:function(n){this._RouteEdges=n},ApproximateRouting$$:"System.Boolean",get_ApproximateRouting:function(){return this.approximateRouting},set_ApproximateRouting:function(n){this.approximateRouting=n},LogScaleEdgeForces$$:"System.Boolean",get_LogScaleEdgeForces:function(){return this.logScaleEdgeForces},set_LogScaleEdgeForces:function(n){this.logScaleEdgeForces=n},DisplacementThreshold$$:"System.Double",get_DisplacementThreshold:function(){return this.displacementThreshold},set_DisplacementThreshold:function(n){this.displacementThreshold=n},Converged$$:"System.Boolean",get_Converged:function(){return this.converged},set_Converged:function(n){this.converged=n},PercentDone$$:"System.Int32",get_PercentDone:function(){return this.get_Converged()?100:100*this.iterations/this.get_MaxIterations()|0},IsDone$$:"System.Boolean",get_IsDone:function(){return this.get_Converged()||this.iterations>=this.get_MaxIterations()},Energy$$:"System.Single",get_Energy:function(){return this.algorithm!=null?this.algorithm.energy:0},EdgeRoutesUpToDate$$:"System.Boolean",get_EdgeRoutesUpToDate:function(){return this._EdgeRoutesUpToDate},set_EdgeRoutesUpToDate:function(n){this._EdgeRoutesUpToDate=n},MaxConstraintLevel$$:"System.Int32",get_MaxConstraintLevel:function(){return this.maxConstraintLevel},set_MaxConstraintLevel:function(n){this.maxConstraintLevel!=n&&(this.maxConstraintLevel=n,this.get_IsInitialized()&&this.Uninitialize())},MinConstraintLevel$$:"System.Int32",get_MinConstraintLevel:function(){return this.minConstraintLevel},set_MinConstraintLevel:function(n){this.minConstraintLevel=n},CurrentConstraintLevel$$:"System.Int32",get_CurrentConstraintLevel:function(){return this.algorithm.get_CurrentConstraintLevel()},set_CurrentConstraintLevel:function(n){this.algorithm.set_CurrentConstraintLevel(n)},AttractiveInterClusterForceConstant$$:"System.Double",get_AttractiveInterClusterForceConstant:function(){return this.attractiveInterClusterForceConstant},set_AttractiveInterClusterForceConstant:function(n){this.attractiveInterClusterForceConstant=n},ctor$$FastIncrementalLayoutSettings:function(n){this.maxIterations=100;this.minorIterations=3;this.iterations=0;this.projectionIterations=5;this.approximateRepulsion=!0;this.initialStepSize=1.4;this.decay=.9;this.friction=.8;this.repulsiveForceConstant=1;this.attractiveForceConstant=1;this.gravity=1;this.interComponentForces=!0;this.applyForces=!0;this.algorithm=null;this.locks=new System.Collections.Generic.LinkedList$1.ctor(Microsoft.Msagl.Layout.Incremental.LockPosition.ctor);this.structuralConstraints=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Incremental.IConstraint.ctor);this.approximateRouting=!0;this.logScaleEdgeForces=!0;this.displacementThreshold=.1;this.converged=!1;this.maxConstraintLevel=2;this.minConstraintLevel=0;this.attractiveInterClusterForceConstant=1;this.clusterGravity=1;this.updateClusterBoundaries=!0;this._RungeKuttaIntegration=!1;this._AvoidOverlaps=!1;this._RespectEdgePorts=!1;this._RouteEdges=!1;this._EdgeRoutesUpToDate=!1;this._IdealEdgeLength=new Microsoft.Msagl.Core.Layout.IdealEdgeLengthSettings.ctor;Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings.ctor.call(this);Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"previousSettings");this.maxIterations=n.maxIterations;this.minorIterations=n.minorIterations;this.projectionIterations=n.projectionIterations;this.approximateRepulsion=n.approximateRepulsion;this.initialStepSize=n.initialStepSize;this.set_RungeKuttaIntegration(n.get_RungeKuttaIntegration());this.decay=n.decay;this.friction=n.friction;this.repulsiveForceConstant=n.repulsiveForceConstant;this.attractiveForceConstant=n.attractiveForceConstant;this.gravity=n.gravity;this.interComponentForces=n.interComponentForces;this.applyForces=n.applyForces;this.set_IdealEdgeLength(n.get_IdealEdgeLength());this.set_AvoidOverlaps(n.get_AvoidOverlaps());this.set_RespectEdgePorts(n.get_RespectEdgePorts());this.set_RouteEdges(n.get_RouteEdges());this.approximateRouting=n.approximateRouting;this.logScaleEdgeForces=n.logScaleEdgeForces;this.displacementThreshold=n.displacementThreshold;this.minConstraintLevel=n.minConstraintLevel;this.maxConstraintLevel=n.maxConstraintLevel;this.attractiveInterClusterForceConstant=n.attractiveInterClusterForceConstant;this.clusterGravity=n.clusterGravity;this.set_PackingAspectRatio(n.get_PackingAspectRatio());this.set_NodeSeparation(n.get_NodeSeparation());this.set_ClusterMargin(n.get_ClusterMargin())},ClusterGravity$$:"System.Double",get_ClusterGravity:function(){return this.clusterGravity},set_ClusterGravity:function(n){this.clusterGravity=n},IdealEdgeLength$$:"Microsoft.Msagl.Core.Layout.IdealEdgeLengthSettings",get_IdealEdgeLength:function(){return this._IdealEdgeLength},set_IdealEdgeLength:function(n){this._IdealEdgeLength=n},UpdateClusterBoundariesFromChildren$$:"System.Boolean",get_UpdateClusterBoundariesFromChildren:function(){return this.updateClusterBoundaries},set_UpdateClusterBoundariesFromChildren:function(n){this.updateClusterBoundaries=n}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$FastIncrementalLayoutSettings);Microsoft$Msagl$Core$Geometry$MoveToFront={fullname:"Microsoft.Msagl.Core.Geometry.MoveToFront",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){var t,i;for(this.L=null,this.ps=null,this.disc=null,this.boundary=null,System.Object.ctor.call(this),Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"ps"),this.ps=n,this.L=new System.Collections.Generic.LinkedList$1.ctor(System.Int32.ctor),t=0;t<n.length;++t)this.L.AddLast$$T(t);i=this.mtf_md(null,new System.Collections.Generic.List$1.ctor(System.Int32.ctor));this.disc=i.disc;this.boundary=i.boundary},collinear3:function(n){return n.get_Count()==3?Microsoft.Msagl.Core.Geometry.Disc.Collinear(this.ps[n.get_Item$$Int32(0)],this.ps[n.get_Item$$Int32(1)],this.ps[n.get_Item$$Int32(2)]):!1},mtf_md:function(n,t){var r,i,e,f,u;if(System.Diagnostics.Debug.Assert$$Boolean(t.get_Count()<=3),r=new Microsoft.Msagl.Core.Geometry.MoveToFront.MinDisc.ctor(this.ps,t),t.get_Count()==3)return r;for(i=this.L.get_First();i!=null&&i!=n;)e=i.get_Next(),f=i.get_Value(),r.contains(this.ps[f])||(u=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(System.Int32.ctor,t),u.Add(f),System.Diagnostics.Debug.Assert$$Boolean$$String(!this.collinear3(u),"Collinear points on boundary of minimal enclosing disc"),r=this.mtf_md(i,u),this.L.Remove$$LinkedListNode$1(i),this.L.AddFirst$$LinkedListNode$1(i)),i=e;return r}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$MoveToFront);Microsoft$Msagl$Core$Geometry$MinimumEnclosingDisc={fullname:"Microsoft.Msagl.Core.Geometry.MinimumEnclosingDisc",baseTypeName:"System.Object",staticDefinition:{LinearComputation:function(n){var t=new Microsoft.Msagl.Core.Geometry.MoveToFront.ctor(n);return t.disc},SlowComputation:function(n){var t,i,f,r,e;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"points");var o=n.length,u=null,s=null;for(t=0;t<o;++t)for(i=0;i<o;++i)for(t!=i&&(f=new Microsoft.Msagl.Core.Geometry.Disc.ctor$$Point$$Point(n[t],n[i]),f.Contains$$Point$Array$$Int32$Array(n,new Int32Array([t,i]))&&(u==null||u.get_Radius()>f.get_Radius())&&(u=f,s=new Int32Array([t,i]))),r=0;r<o;++r)r==t||r==i||Microsoft.Msagl.Core.Geometry.Disc.Collinear(n[t],n[i],n[r])||(e=new Microsoft.Msagl.Core.Geometry.Disc.ctor$$Point$$Point$$Point(n[t],n[i],n[r]),e.Contains$$Point$Array$$Int32$Array(n,new Int32Array([t,i,r]))&&(u==null||u.get_Radius()>e.get_Radius())&&(u=e,s=new Int32Array([t,i,r])));return System.Diagnostics.Debug.Assert$$Boolean(s!=null),u}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$MinimumEnclosingDisc);Microsoft$Msagl$Layout$Incremental$MultipoleCoefficients={fullname:"Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients",baseTypeName:"System.Object",staticDefinition:{factorial:function(n){for(var i=1,t=2;t<=n;++t)i*=t;return i},binomial:function(n,t){return Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.factorial(n)/(Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.factorial(t)*Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.factorial(n-t))},Force:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),r=i.get_LengthSquared();return r<.1?r!=0?Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(i,.1):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1,0):Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(i,r)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Int32$$Point$$Point$Array:function(n,t,i){this.z0=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor;this.a=null;this.p=0;System.Object.ctor.call(this);this.p=n;this.z0=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double$$Double(t.get_X(),t.get_Y());this.a=new Array(n);for(var r=0;r<n;++r)this.a[r]=this.compute(r,i)},ctor$$Point$$MultipoleCoefficients$$MultipoleCoefficients:function(n,t,i){var u,f,r;for(this.z0=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor,this.a=null,this.p=0,System.Object.ctor.call(this),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"m1"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(i,"m2"),System.Diagnostics.Debug.Assert$$Boolean(t.p==i.p),this.p=t.p,this.z0=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double$$Double(n.get_X(),n.get_Y()),u=t.shift(this.z0),f=i.shift(this.z0),this.a=new Array(this.p),r=0;r<this.p;++r)this.a[r]=Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Addition(u[r],f[r])},sum:function(n,t){for(var u,r=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double(0),i=1;i<=n;++i)u=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double(Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.binomial(n-1,i-1)),r=Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Addition(r,Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Multiply$$Complex$$Complex(Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Multiply$$Complex$$Complex(this.a[i],Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.Pow(t,n-i)),u));return r},shift:function(n){for(var u,i=new Array(this.p),f=i[0]=this.a[0],r=Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Subtraction(this.z0,n),t=1;t<this.p;++t)u=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double(t),i[t]=Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Addition(Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Division(Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Multiply$$Complex$$Complex(Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_UnaryNegation(f),Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.Pow(r,t)),u),this.sum(t,r));return i},compute:function(n,t){var f=t.length,i=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double(0),r,u,e;if(n==0)i.re=f;else{for(r=0;r<f;++r)u=t[r],e=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double$$Double(u.get_X(),u.get_Y()),i=Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Subtraction(i,Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.Pow(Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Subtraction(e,this.z0),n));i.divideBy(n)}return i},ApproximateForce:function(n){for(var f=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double$$Double(n.get_X(),n.get_Y()),r=Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Subtraction(f,this.z0),t=Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Division(this.a[0],r),u=r,i=0;;){if(t=Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Subtraction(t,Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Division(Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Multiply$$Complex$$Double(this.a[i],i),u)),++i,i==this.p)break;u=Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Multiply$$Complex$$Complex(u,r)}return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.re,-t.im)}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$MultipoleCoefficients);Microsoft$Msagl$Layout$Incremental$ProcrustesCircleConstraint={fullname:"Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint",baseTypeName:"System.Object",staticDefinition:{matrixProduct:function(n,t){for(var r=new Array(2),u=0,f=0,e=0,o=0,i=0;i<n.length;++i)u+=n[i].get_X()*t[i].get_X(),f+=n[i].get_X()*t[i].get_Y(),e+=n[i].get_Y()*t[i].get_X(),o+=n[i].get_Y()*t[i].get_Y();return r[0]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,f),r[1]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,o),r},matrixProductNoTranspose:function(n,t){var i=new Array(2);return i[0]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[0].get_X()*t[0].get_X()+n[0].get_Y()*t[1].get_X(),n[0].get_X()*t[0].get_Y()+n[0].get_Y()*t[1].get_Y()),i[1]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[1].get_X()*t[0].get_X()+n[1].get_Y()*t[1].get_X(),n[1].get_X()*t[0].get_Y()+n[1].get_Y()*t[1].get_Y()),i},MatrixTimesVector:function(n,t){var i=n[0].get_X(),r=n[0].get_Y(),u=n[1].get_X(),f=n[1].get_Y();return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i*t.get_X()+r*t.get_Y(),u*t.get_X()+f*t.get_Y())},eigenSystem2:function(n,t){for(var e,u,o,f,r=new Array(n.length),i=0;i<n.length;i++)r[i]=new Float64Array(2),r[i][0]=n[i].get_X(),r[i][1]=n[i].get_Y();return function(){var n={Value:u},t={Value:e},i={Value:f},s={Value:o},h=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.SpectralDecomposition$$Double$Array$Array$$Double$Array$$Double$$Double$Array$$Double$$Int32$$Double(r,n,t,i,s,300,1e-8);return u=n.Value,e=t.Value,f=i.Value,o=s.Value,h}(),t.Value=[new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u[0],u[1]),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(f[0],f[1])],new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,o)},SingularValueDecomposition:function(n,t,i){var f=Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.matrixProduct(n,n),u=Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.eigenSystem2(f,i),r=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Sqrt(u.get_X()),System.Math.Sqrt(u.get_Y()));return t.Value=Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.matrixProductNoTranspose(n,i.Value),t.Value=Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.matrixProductNoTranspose(t.Value,[new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1/r.get_X(),0),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,1/r.get_Y())]),r},PrintMatrix:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"points");System.Console.Write$$String("{");for(var t=0;t<n.length;)System.Console.Write$$String$$Object$$Object("{{{0},{1}}}",n[t].get_X(),n[t].get_Y()),++t!=n.length&&System.Console.Write$$String(",");System.Console.WriteLine$$String("};")},Transpose:function(n){return[new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[0].get_X(),n[1].get_X()),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[0].get_Y(),n[1].get_Y())]},Test:function(){throw $CreateException(new System.InvalidOperationException.ctor,new Error);},FindTransform:function(n,t,i,r,u){var c=n.length,l=Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.matrixProduct(n,t),e,o,s,h,f;for(function(){var n={Value:e},t={Value:o},i=Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.SingularValueDecomposition(l,n,t);return e=n.Value,o=t.Value,i}(),i.Value=Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.matrixProductNoTranspose(o,Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.Transpose(e)),s=Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.matrixProductNoTranspose(l,i.Value),h=Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.matrixProduct(t,t),r.Value=s[0].get_X()+s[1].get_Y(),r.Value/=h[0].get_X()+h[1].get_Y(),u.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,f=0;f<c;++f)u.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(u.Value,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n[f],Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(r.Value,Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.MatrixTimesVector(i.Value,t[f]))));u.Value=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(u.Value,c)}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.Incremental.IConstraint"],Kind:"Class",definition:{ctor$$IEnumerable$1$Node:function(n){var u,i,t,r;for(this.V=null,this.n=0,this.X=null,this.Y=null,System.Object.ctor.call(this),this.V=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,n),this.n=this.V.length,this.X=new Array(this.n),this.Y=new Array(this.n),u=6.28318530717959/this.n,i=10*this.n,t=0;t<this.n;++t)r=u*t,this.Y[t]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i*System.Math.Cos(r),i*System.Math.Sin(r))},ctor$$IEnumerable$1$Node$$IEnumerable$1$Point:function(n,t){var u;this.V=null;this.n=0;this.X=null;this.Y=null;System.Object.ctor.call(this);Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"nodes");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"targetConfiguration");this.V=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,n);this.n=this.V.length;this.X=new Array(this.n);this.Y=new Array(this.n);for(var i=0,r=new Microsoft.Msagl.Core.Geometry.Point.ctor,f=t.GetEnumerator();f.MoveNext();)u=f.get_Current(),this.Y[i++]=u,r=Microsoft.Msagl.Core.Geometry.Point.op_Addition(r,u);for(r=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(r,this.n),i=0;i<this.n;++i)this.Y[i]=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.Y[i],r)},Project:function(){for(var i,t,r,e,u,f,n=0;n<this.n;++n)this.X[n]=this.V[n].get_Center();for(function(){var n={Value:i},u={Value:t},f={Value:r},e=Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.FindTransform(this.X,this.Y,n,u,f);return i=n.Value,t=u.Value,r=f.Value,e}.call(this),e=Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.Transpose(i),u=0,n=0;n<this.n;++n)f=this.V[n],f.set_Center(System.Double.IsNaN(t)?this.Y[n]:Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,Microsoft.Msagl.Layout.Incremental.ProcrustesCircleConstraint.MatrixTimesVector(e,this.Y[n])),r)),u+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.get_Center(),this.X[n]).get_Length();return u},Level$$:"System.Int32",get_Level:function(){return 1},Nodes$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Node]]",get_Nodes:function(){return System.Linq.Enumerable.AsEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,this.V)}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$ProcrustesCircleConstraint);Microsoft$Msagl$Core$Geometry$RectangularClusterBoundary={fullname:"Microsoft.Msagl.Core.Geometry.RectangularClusterBoundary",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.rectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.olapCluster=null;this.generateFixedConstraintsDefault=!1;this.defaultMargin=null;this._LeftBorderInfo=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._RightBorderInfo=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._TopBorderInfo=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._BottomBorderInfo=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._GenerateFixedConstraints=!1;this._RadiusX=0;this._RadiusY=0;this._MinWidth=0;this._MinHeight=0;System.Object.ctor.call(this);this.set_LeftBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0));this.set_RightBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0));this.set_TopBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0));this.set_BottomBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0))},LeftMargin$$:"System.Double",get_LeftMargin:function(){return this.get_LeftBorderInfo().get_InnerMargin()},set_LeftMargin:function(n){this.set_LeftBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(n,this.get_LeftBorderInfo().get_FixedPosition(),this.get_LeftBorderInfo().get_Weight()))},RightMargin$$:"System.Double",get_RightMargin:function(){return this.get_RightBorderInfo().get_InnerMargin()},set_RightMargin:function(n){this.set_RightBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(n,this.get_RightBorderInfo().get_FixedPosition(),this.get_RightBorderInfo().get_Weight()))},TopMargin$$:"System.Double",get_TopMargin:function(){return this.get_TopBorderInfo().get_InnerMargin()},set_TopMargin:function(n){this.set_TopBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(n,this.get_TopBorderInfo().get_FixedPosition(),this.get_TopBorderInfo().get_Weight()))},BottomMargin$$:"System.Double",get_BottomMargin:function(){return this.get_BottomBorderInfo().get_InnerMargin()},set_BottomMargin:function(n){this.set_BottomBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(n,this.get_BottomBorderInfo().get_FixedPosition(),this.get_BottomBorderInfo().get_Weight()))},LeftBorderInfo$$:"Microsoft.Msagl.Core.Geometry.BorderInfo",get_LeftBorderInfo:function(){return this._LeftBorderInfo},set_LeftBorderInfo:function(n){this._LeftBorderInfo=n},RightBorderInfo$$:"Microsoft.Msagl.Core.Geometry.BorderInfo",get_RightBorderInfo:function(){return this._RightBorderInfo},set_RightBorderInfo:function(n){this._RightBorderInfo=n},TopBorderInfo$$:"Microsoft.Msagl.Core.Geometry.BorderInfo",get_TopBorderInfo:function(){return this._TopBorderInfo},set_TopBorderInfo:function(n){this._TopBorderInfo=n},BottomBorderInfo$$:"Microsoft.Msagl.Core.Geometry.BorderInfo",get_BottomBorderInfo:function(){return this._BottomBorderInfo},set_BottomBorderInfo:function(n){this._BottomBorderInfo=n},GenerateFixedConstraints$$:"System.Boolean",get_GenerateFixedConstraints:function(){return this._GenerateFixedConstraints},set_GenerateFixedConstraints:function(n){this._GenerateFixedConstraints=n},GenerateFixedConstraintsDefault$$:"System.Boolean",get_GenerateFixedConstraintsDefault:function(){return this.generateFixedConstraintsDefault},set_GenerateFixedConstraintsDefault:function(n){this.set_GenerateFixedConstraints(this.generateFixedConstraintsDefault=n)},RectangularHull:function(){return System.Diagnostics.Debug.Assert$$Boolean(this.rectangle.get_Bottom()<=this.rectangle.get_Top()),this.get_RadiusX()>0||this.get_RadiusY()>0?Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRectangleWithRoundedCorners$$Double$$Double$$Double$$Double$$Point(this.rectangle.get_Width(),this.rectangle.get_Height(),this.get_RadiusX(),this.get_RadiusY(),this.rectangle.get_Center()):Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRectangle$$Double$$Double$$Point(this.rectangle.get_Width(),this.rectangle.get_Height(),this.rectangle.get_Center())},Rect$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_Rect:function(){return this.rectangle},set_Rect:function(n){this.rectangle=n},InnerRect$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_InnerRect:function(){var n=this.get_Rect();return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(n.get_Left()+this.get_LeftMargin(),n.get_Bottom()+this.get_BottomMargin(),n.get_Right()-this.get_RightMargin(),n.get_Top()-this.get_TopMargin())},DefaultMarginIsSet$$:"System.Boolean",get_DefaultMarginIsSet:function(){return this.defaultMargin!=null},DefaultLeftMargin$$:"System.Double",get_DefaultLeftMargin:function(){return this.defaultMargin.Left},DefaultTopMargin$$:"System.Double",get_DefaultTopMargin:function(){return this.defaultMargin.Top},DefaultRightMargin$$:"System.Double",get_DefaultRightMargin:function(){return this.defaultMargin.Right},DefaultBottomMargin$$:"System.Double",get_DefaultBottomMargin:function(){return this.defaultMargin.Bottom},StoreDefaultMargin:function(){this.defaultMargin=function(){var n=new Microsoft.Msagl.Core.Geometry.RectangularClusterBoundary.Margin.ctor;return n.Left=this.get_LeftMargin(),n.Right=this.get_RightMargin(),n.Bottom=this.get_BottomMargin(),n.Top=this.get_TopMargin(),n}.call(this)},StoreDefaultMargin$$Double$$Double$$Double$$Double:function(n,t,i,r){this.defaultMargin=function(){var u=new Microsoft.Msagl.Core.Geometry.RectangularClusterBoundary.Margin.ctor;return u.Left=n,u.Right=t,u.Bottom=i,u.Top=r,u}.call(this)},RestoreDefaultMargin:function(){this.defaultMargin!=null&&(this.set_LeftMargin(this.defaultMargin.Left),this.set_RightMargin(this.defaultMargin.Right),this.set_TopMargin(this.defaultMargin.Top),this.set_BottomMargin(this.defaultMargin.Bottom))},TranslateRectangle:function(n){this.rectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Point(this.rectangle.get_Left()+n.get_X(),this.rectangle.get_Bottom()+n.get_Y(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.rectangle.get_Width(),this.rectangle.get_Height()))},RadiusX$$:"System.Double",get_RadiusX:function(){return this._RadiusX},set_RadiusX:function(n){this._RadiusX=n},RadiusY$$:"System.Double",get_RadiusY:function(){return this._RadiusY},set_RadiusY:function(n){this._RadiusY=n},Lock$$Double$$Double$$Double$$Double:function(n,t,i,r){var u=1e4;this.set_LeftBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(this.get_LeftBorderInfo().get_InnerMargin(),n,u));this.set_RightBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(this.get_RightBorderInfo().get_InnerMargin(),t,u));this.set_TopBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(this.get_TopBorderInfo().get_InnerMargin(),i,u));this.set_BottomBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double$$Double$$Double(this.get_BottomBorderInfo().get_InnerMargin(),r,u))},Unlock:function(){this.set_LeftBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(this.get_LeftBorderInfo().get_InnerMargin()));this.set_RightBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(this.get_RightBorderInfo().get_InnerMargin()));this.set_TopBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(this.get_TopBorderInfo().get_InnerMargin()));this.set_BottomBorderInfo(new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(this.get_BottomBorderInfo().get_InnerMargin()))},Lock:function(){this.Lock$$Double$$Double$$Double$$Double(this.rectangle.get_Left(),this.rectangle.get_Right(),this.rectangle.get_Top(),this.rectangle.get_Bottom())},MinWidth$$:"System.Double",get_MinWidth:function(){return this._MinWidth},set_MinWidth:function(n){this._MinWidth=n},MinHeight$$:"System.Double",get_MinHeight:function(){return this._MinHeight},set_MinHeight:function(n){this._MinHeight=n}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$RectangularClusterBoundary);Microsoft$Msagl$Layout$Initial$InitialLayout={fullname:"Microsoft.Msagl.Layout.Initial.InitialLayout",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.graph=null;this.settings=null;this.componentCount=0;this._SingleComponent=!1;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"graph");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"settings");this.graph=n;this.settings=new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayoutSettings.ctor$$FastIncrementalLayoutSettings(t);this.settings.set_ApplyForces(!0);this.settings.set_InterComponentForces(!0);this.settings.set_RungeKuttaIntegration(!1);this.settings.set_RespectEdgePorts(!1)},SingleComponent$$:"System.Boolean",get_SingleComponent:function(){return this._SingleComponent},set_SingleComponent:function(n){this._SingleComponent=n},RunInternal:function(){var u,n,i,f,c,e,o,s,r,t,h;if(this.get_SingleComponent())this.componentCount=1,this.LayoutComponent(this.graph);else{for(u=this.graph.get_RootCluster().AllClustersDepthFirst().GetEnumerator();u.MoveNext();)(n=u.get_Current(),n!=this.graph.get_RootCluster()&&n.get_RectangularBoundary()!=null)&&n.get_RectangularBoundary().set_GenerateFixedConstraints(!1);for(i=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.GetClusteredConnectedComponents(this.graph)),this.componentCount=i.get_Count(),f=i.GetEnumerator();f.MoveNext();)c=f.get_Current(),this.LayoutComponent(c);for(this.graph.set_BoundingBox(Microsoft.Msagl.Layout.MDS.MdsGraphLayout.PackGraphs(i,this.settings)),this.ProgressComplete(),e=this.graph.get_Nodes().GetEnumerator();e.MoveNext();)o=e.get_Current(),t=As(o.AlgorithmData,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap.ctor),System.Diagnostics.Debug.Assert$$Boolean(t!=null),o.set_Center(t.node.get_Center());for(s=this.graph.get_Edges().GetEnumerator();s.MoveNext();)r=s.get_Current(),t=As(r.AlgorithmData,Microsoft.Msagl.Core.Layout.Edge.ctor),t!=null&&(r.set_EdgeGeometry(t.get_EdgeGeometry()),r.get_EdgeGeometry().set_Curve(t.get_Curve()));for(h=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,this.graph.get_RootCluster().AllClustersDepthFirst(),$CreateAnonymousDelegate(this,function(n){return n!=this.graph.get_RootCluster()})).GetEnumerator();h.MoveNext();){var n=h.get_Current(),t=As(n.AlgorithmData,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap.ctor),l=As(t.node,Microsoft.Msagl.Core.Layout.Cluster.ctor);System.Diagnostics.Debug.Assert$$Boolean(l!=null);n.set_RectangularBoundary(l.get_RectangularBoundary());n.get_RectangularBoundary().set_GenerateFixedConstraints(n.get_RectangularBoundary().get_GenerateFixedConstraintsDefault());n.set_BoundingBox(n.get_RectangularBoundary().get_Rect());n.RaiseLayoutDoneEvent()}}},LayoutComponent:function(n){var u,i,r,t;if(n.get_Nodes().get_Count()>1||System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_RootCluster().get_Clusters()))for(this.settings.set_MaxIterations(Microsoft.Msagl.Core.Layout.LayoutAlgorithmHelpers.NegativeLinearInterpolation(n.get_Nodes().get_Count(),50,500,5,10)),this.settings.set_MinorIterations(Microsoft.Msagl.Core.Layout.LayoutAlgorithmHelpers.NegativeLinearInterpolation(n.get_Nodes().get_Count(),50,500,3,20)),this.settings.get_MinConstraintLevel()==0&&(u=function(){var t=new Microsoft.Msagl.Layout.MDS.PivotMDS.ctor(n);return t.set_Scale(2),t}.call(this),this.RunChildAlgorithm(u,.5/this.componentCount)),i=new Microsoft.Msagl.Layout.Incremental.FastIncrementalLayout.ctor(n,this.settings,this.settings.get_MinConstraintLevel(),$CreateAnonymousDelegate(this,function(){return this.settings})),System.Diagnostics.Debug.Assert$$Boolean(this.settings.get_Iterations()==0),r=this.GetConstraintLevels(n).GetEnumerator();r.MoveNext();){if(t=r.get_Current(),t>this.settings.get_MaxConstraintLevel())break;t>this.settings.get_MinConstraintLevel()&&i.set_CurrentConstraintLevel(t);do i.Run();while(!this.settings.get_IsDone())}n.set_Margins(this.settings.get_NodeSeparation());n.UpdateBoundingBox();n.Translate(Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(n.get_BoundingBox().get_LeftBottom()))},GetConstraintLevels:function(n){var t=System.Linq.Enumerable.ToList$1(System.Int32.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Incremental.IConstraint.ctor,System.Int32.ctor,this.settings.get_StructuralConstraints(),$CreateAnonymousDelegate(this,function(n){return n.get_Level()})));return t.Add(0),this.settings.get_IdealEdgeLength().get_EdgeDirectionConstraints()!=Microsoft.Msagl.Core.Geometry.Directions.None&&t.Add(1),this.settings.get_AvoidOverlaps()&&n.get_Nodes().get_Count()<2e3&&t.Add(2),System.Linq.Enumerable.Distinct$1$$IEnumerable$1(System.Int32.ctor,t)}}};JsTypes.push(Microsoft$Msagl$Layout$Initial$InitialLayout);Microsoft$Msagl$Layout$Incremental$StickConstraint={fullname:"Microsoft.Msagl.Layout.Incremental.StickConstraint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.Incremental.IConstraint"],Kind:"Class",definition:{ctor:function(n,t,i){this.u=null;this.v=null;this.separation=0;System.Object.ctor.call(this);this.u=n;this.v=t;this.separation=i},Project:function(){var n=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.v.get_Center(),this.u.get_Center()),t=this.separation-n.get_Length(),i=Cast(this.u.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor).stayWeight,r=Cast(this.v.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor).stayWeight,u=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,n.Normalize()),i+r);return this.u.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.u.get_Center(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(r,u))),this.v.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.v.get_Center(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,u))),System.Math.Abs$$Double(t)},Level$$:"System.Int32",get_Level:function(){return 0},Nodes$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Node]]",get_Nodes:function(){return[this.u,this.v]}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$StickConstraint);Microsoft$Msagl$Layout$Incremental$VerticalSeparationConstraint={fullname:"Microsoft.Msagl.Layout.Incremental.VerticalSeparationConstraint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.Incremental.IConstraint"],Kind:"Class",definition:{ctor$$Node$$Node$$Double:function(n,t,i){this.equality=!1;this.u=null;this.v=null;this.separation=0;System.Object.ctor.call(this);this.u=n;this.v=t;this.separation=i},IsEquality$$:"System.Boolean",get_IsEquality:function(){return this.equality},TopNode$$:"Microsoft.Msagl.Core.Layout.Node",get_TopNode:function(){return this.u},BottomNode$$:"Microsoft.Msagl.Core.Layout.Node",get_BottomNode:function(){return this.v},Separation$$:"System.Double",get_Separation:function(){return this.separation},set_Separation:function(n){this.separation=n},ctor$$Node$$Node$$Double$$Boolean:function(n,t,i,r){this.equality=!1;this.u=null;this.v=null;this.separation=0;System.Object.ctor.call(this);this.equality=r;this.u=n;this.v=t;this.separation=i},Project:function(){var u=this.v.get_Center().get_Y()-this.u.get_Center().get_Y(),n=this.separation-u;if(n>0){var t=Cast(this.u.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor).stayWeight,i=Cast(this.v.AlgorithmData,Microsoft.Msagl.Layout.Incremental.FiNode.ctor).stayWeight,r=n/(t+i);return this.u.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.u.get_Center().get_X(),this.u.get_Center().get_Y()-i*r)),this.v.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.v.get_Center().get_X(),this.v.get_Center().get_Y()+t*r)),n}return 0},Level$$:"System.Int32",get_Level:function(){return 0},Nodes$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Node]]",get_Nodes:function(){return[this.u,this.v]}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$VerticalSeparationConstraint);Microsoft$Msagl$Core$DataStructures$BinaryHeapPriorityQueue={fullname:"Microsoft.Msagl.Core.DataStructures.BinaryHeapPriorityQueue",baseTypeName:"System.Object",staticDefinition:{Test:function(){var n=new Microsoft.Msagl.Core.DataStructures.BinaryHeapPriorityQueue.ctor(10),t;for(n.Enqueue(2,2),n.Enqueue(1,1),n.Enqueue(9,9),n.Enqueue(8,8),n.Enqueue(5,5),n.Enqueue(3,3),n.Enqueue(4,4),n.Enqueue(7,7),n.Enqueue(6,6),n.Enqueue(0,0),t=0;t<10;t++)System.Console.WriteLine$$Int32(n.Dequeue())}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this._heap=null;this._reverse_heap=null;this._priors=null;this.heapSize=0;System.Object.ctor.call(this);this._priors=new Float64Array(n);this._heap=new Int32Array(n+1);this._reverse_heap=new Int32Array(n)},Count$$:"System.Int32",get_Count:function(){return this.heapSize},SwapWithParent:function(n){var t=this._heap[n>>1];this.PutAtI(n>>1,this._heap[n]);this.PutAtI(n,t)},Enqueue:function(n,t){this.heapSize++;var i=this.heapSize;for(this._priors[n]=t,this.PutAtI(i,n);i>1&&this._priors[this._heap[i>>1]]>t;)this.SwapWithParent(i),i>>=1},PutAtI:function(n,t){this._heap[n]=t;this._reverse_heap[t]=n},Dequeue:function(){var u,t,n,i,r;if(this.heapSize==0)throw $CreateException(new System.InvalidOperationException.ctor,new Error);if(u=this._heap[1],this.heapSize>1)for(this.PutAtI(1,this._heap[this.heapSize]),t=1;;){if(n=t,i=t<<1,i<=this.heapSize&&this._priors[this._heap[i]]<this._priors[this._heap[t]]&&(n=i),r=i+1,r<=this.heapSize&&this._priors[this._heap[r]]<this._priors[this._heap[n]]&&(n=r),n!=t)this.SwapWithParent(n);else break;t=n}return this.heapSize--,u},DecreasePriority:function(n,t){this._priors[n]=t;for(var i=this._reverse_heap[n];i>1;){if(this._priors[this._heap[i]]<this._priors[this._heap[i>>1]])this.SwapWithParent(i);else break;i>>=1}}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$BinaryHeapPriorityQueue);Microsoft$Msagl$Core$DataStructures$BinaryHeapWithComparer$1={fullname:"Microsoft.Msagl.Core.DataStructures.BinaryHeapWithComparer$1",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.DataStructures.BinaryHeapWithComparer$1.initialHeapCapacity=16}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.T=n;this.A=null;this.heapSize=0;this.comparer=null;System.Object.ctor.call(this);this.A=new Array(17);this.comparer=t},Enqueue:function(n){var r,t,i,u,f;for(this.heapSize==this.A.length-1&&(r=new Array(this.A.length*2),System.Array.Copy(this.A,1,r,1,this.heapSize),this.A=r),t=this.heapSize+1,this.A[t]=n,this.heapSize++,i=t>>1;t>1&&this.Less(f=this.A[t],u=this.A[i]);)this.A[i]=f,this.A[t]=u,t=i,i=t>>1},Dequeue:function(){if(this.heapSize<1)throw $CreateException(new System.InvalidOperationException.ctor,new Error);var n=this.A[1],t=this.A[this.heapSize];return this.heapSize--,this.ChangeMinimum(t),n},ChangeMinimum:function(n){var r;this.A[1]=n;for(var i=1,t=2,u=!1;t<this.heapSize&&!u;){u=!0;var r=this.A[t],f=this.A[t+1],e=this.comparer.Compare(r,f);e<0?this.comparer.Compare(r,n)<0&&(this.A[i]=r,this.A[t]=n,u=!1,i=t,t=i<<1):this.comparer.Compare(f,n)<0&&(this.A[i]=f,this.A[t+1]=n,u=!1,i=t+1,t=i<<1)}t==this.heapSize&&(r=this.A[t],this.comparer.Compare(r,n)<0&&(this.A[i]=r,this.A[t]=n))},Count$$:"System.Int32",get_Count:function(){return this.heapSize},Less:function(n,t){return this.comparer.Compare(n,t)<0},GetMinimum:function(){return this.A[1]}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$BinaryHeapWithComparer$1);Microsoft$Msagl$Core$Layout$GraphConnectedComponents={fullname:"Microsoft.Msagl.Core.Layout.GraphConnectedComponents",baseTypeName:"System.Object",staticDefinition:{CreateComponents:function(n,t){var e,o,p,u,h,i,r;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"nodes");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"edges");for(var f=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Int32.ctor),c=0,l=n.GetEnumerator();l.MoveNext();)u=l.get_Current(),f.set_Item$$TKey(u,c++);for(e=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor),o=t.GetEnumerator();o.MoveNext();)i=o.get_Current(),e.Add(function(){var n=new Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor;return n.set_Source(f.get_Item$$TKey(i.get_Source())),n.set_Target(f.get_Item$$TKey(i.get_Target())),n}());for(var w=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.SimpleIntEdge.ctor,e,c)),s=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.GeometryGraph.ctor),a=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor),v=w.GetEnumerator();v.MoveNext();){for(var b=v.get_Current(),r=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,y=b.GetEnumerator();y.MoveNext();)p=y.get_Current(),u=n.get_Item$$Int32(p),r.get_Nodes().Add(u),s.set_Item$$TKey(u,r);a.Add(r)}for(h=t.GetEnumerator();h.MoveNext();)i=h.get_Current(),r=s.get_Item$$TKey(i.get_Source()),System.Diagnostics.Debug.Assert$$Boolean$$String(s.get_Item$$TKey(i.get_Target())==r,"source and target of edge are not in the same graph"),r.get_Edges().Add(i);return a},GetClusteredConnectedComponents:function(n){for(var f=Microsoft.Msagl.Core.Layout.GraphConnectedComponents.FlatGraph(n),d=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataEdgeWrap.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataEdgeWrap.ctor,f.get_Edges(),function(n){return Cast(n.AlgorithmData,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataEdgeWrap.ctor)}),f.get_Nodes().get_Count()),g=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Node.ctor,f.get_Nodes()),a=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor),v=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(d).GetEnumerator(),o,s,h,b,c,t,u,l;v.MoveNext();){for(var nt=v.get_Current(),i=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,e=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor),y=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),p=nt.GetEnumerator();p.MoveNext();){var tt=p.get_Current(),t=g.get_Item$$Int32(tt),u=Cast(t.get_UserData(),Microsoft.Msagl.Core.Layout.Node.ctor),w=Cast(u.AlgorithmData,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap.ctor).TopLevel;Is(t.get_UserData(),Microsoft.Msagl.Core.Layout.Cluster.ctor)?w&&e.Add(Cast(u,Microsoft.Msagl.Core.Layout.Cluster.ctor)):(t.ClearEdges(),i.get_Nodes().Add(t),w&&y.Add(t))}if(o=i.get_Nodes().get_Count(),e.get_Count()!=0){for(s=new Microsoft.Msagl.Core.Layout.Cluster.ctor$$IEnumerable$1$Node(y),h=e.GetEnumerator();h.MoveNext();)b=h.get_Current(),s.AddChild(function(){var n={Value:o},t=Microsoft.Msagl.Core.Layout.GraphConnectedComponents.CopyCluster(b,n);return o=n.Value,t}());i.set_RootCluster(s)}for(c=i.GetFlattenedNodesAndClusters().GetEnumerator();c.MoveNext();)for(t=c.get_Current(),u=As(t.get_UserData(),Microsoft.Msagl.Core.Layout.Node.ctor),System.Diagnostics.Debug.Assert$$Boolean(u!=null),l=u.get_InEdges().GetEnumerator();l.MoveNext();){var r=l.get_Current(),it=Microsoft.Msagl.Core.Layout.GraphConnectedComponents.GetCopy(r.get_Source()),rt=Microsoft.Msagl.Core.Layout.GraphConnectedComponents.GetCopy(r.get_Target()),k=function(){var n=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(it,rt);return n.set_Length(r.get_Length()),n.set_UserData(r),n.set_EdgeGeometry(r.get_EdgeGeometry()),n}();r.AlgorithmData=k;i.get_Edges().Add(k)}a.Add(i)}return a},GetCopy:function(n){return Cast(n.AlgorithmData,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap.ctor).node},CopyCluster:function(n,t){var i=function(){var t=new Microsoft.Msagl.Core.Layout.Cluster.ctor$$IEnumerable$1$Node(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes(),function(n){return Microsoft.Msagl.Core.Layout.GraphConnectedComponents.GetCopy(n)}));return t.set_UserData(n),t.set_RectangularBoundary(n.get_RectangularBoundary()),t.set_BoundaryCurve(n.get_BoundaryCurve().Clone()),t.set_CollapsedBoundary(n.get_CollapsedBoundary()==null?null:n.get_CollapsedBoundary().Clone()),t}(),r,u;for(n.AlgorithmData=new Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap.ctor(t.Value++,i),r=n.get_Clusters().GetEnumerator();r.MoveNext();)u=r.get_Current(),i.AddChild(Microsoft.Msagl.Core.Layout.GraphConnectedComponents.CopyCluster(u,t));return i},FlatGraph:function(n){for(var u=new Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,p=n.get_Nodes().GetEnumerator(),o,f,s,e,h,r,c,l,a,v,t,y,i;p.MoveNext();)t=p.get_Current(),System.Diagnostics.Debug.Assert$$Boolean(!Is(t,Microsoft.Msagl.Core.Layout.Cluster.ctor)),o=function(){var n=new Microsoft.Msagl.Core.Layout.Node.ctor$$ICurve(t.get_BoundaryCurve().Clone());return n.set_UserData(t),n}(),t.AlgorithmData=new Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap.ctor(u.get_Nodes().get_Count(),o),u.get_Nodes().Add(o);for(f=0,s=n.get_Edges().GetEnumerator();s.MoveNext();)(i=s.get_Current(),f+=i.get_Length(),Is(i.get_Source(),Microsoft.Msagl.Core.Layout.Cluster.ctor)||Is(i.get_Target(),Microsoft.Msagl.Core.Layout.Cluster.ctor))||u.get_Edges().Add(Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataEdgeWrap.MakeEdge(i));for(n.get_Edges().get_Count()!=0?f/=n.get_Edges().get_Count():f=100,e=n.get_RootCluster(),h=e.AllClustersDepthFirst().GetEnumerator();h.MoveNext();)if(r=h.get_Current(),r!=e)for(r.get_BoundaryCurve()==null&&r.set_BoundaryCurve(Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRectangleWithRoundedCorners$$Double$$Double$$Double$$Double$$Point(10,10,1,1,new Microsoft.Msagl.Core.Geometry.Point.ctor)),c=function(){var n=new Microsoft.Msagl.Core.Layout.Node.ctor$$ICurve(r.get_BoundaryCurve().Clone());return n.set_UserData(r),n}(),l=new Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap.ctor(u.get_Nodes().get_Count(),c),r.AlgorithmData=l,u.get_Nodes().Add(c),a=System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,r.get_Nodes(),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,r.get_Clusters(),function(n){return n})).GetEnumerator();a.MoveNext();)t=a.get_Current(),u.get_Edges().Add(Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataEdgeWrap.MakeDummyEdgeFromNodeToItsCluster(As(t.AlgorithmData,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap.ctor),l,f));for(v=System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.Node.ctor,e.get_Nodes(),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,e.get_Clusters(),function(n){return n})).GetEnumerator();v.MoveNext();)t=v.get_Current(),Cast(t.AlgorithmData,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap.ctor).TopLevel=!0;for(y=n.get_Edges().GetEnumerator();y.MoveNext();)i=y.get_Current(),(Is(i.get_Source(),Microsoft.Msagl.Core.Layout.Cluster.ctor)||Is(i.get_Target(),Microsoft.Msagl.Core.Layout.Cluster.ctor))&&u.get_Edges().Add(Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataEdgeWrap.MakeEdge(i));return u}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$GraphConnectedComponents);Microsoft$Msagl$Core$Layout$PortEntryOnCurve={fullname:"Microsoft.Msagl.Core.Layout.PortEntryOnCurve",baseTypeName:"System.Object",staticDefinition:{MiddlePoint:function(n){return n.get_Item$$Double((n.get_ParStart()+n.get_ParEnd())/2)},SpanPointsFromCurveSegments:function(n){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_Segments(),Microsoft.Msagl.Core.Layout.PortEntryOnCurve.MiddlePoint)},SpanPointsFromPolyline:function(n,t){for(var r=[],u=Cast(n.TrimWithWrap(t.get_Item1(),t.get_Item2()),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),i=u.get_StartPoint();i.get_Next()!=null;i=i.get_Next())r.push(Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Point(),i.get_Next().get_Point()),2));return r}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Layout.IPortEntry"],Kind:"Class",definition:{ctor:function(n,t){this.allowedRects=null;this._Spans=null;this._EntryCurve=null;System.Object.ctor.call(this);this.set_EntryCurve(n);this.set_Spans(t)},AllowedRectangles$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Rectangle]]",get_AllowedRectangles:function(){return this.allowedRects==null&&(this.allowedRects=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,Microsoft.Msagl.Core.Geometry.Rectangle.ctor,this.get_Spans(),$CreateAnonymousDelegate(this,function(n){return this.TrimEntryCurve(n).get_BoundingBox()})))),this.allowedRects},TrimEntryCurve:function(n){var t=n.get_Item1(),i=n.get_Item2(),r;return t<i?this.get_EntryCurve().Trim(t,i):Is(this.get_EntryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)||Is(this.get_EntryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor)||Is(this.get_EntryCurve(),Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor)?this.get_EntryCurve().TrimWithWrap(t,i):Is(this.get_EntryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor)?(r=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,r.AddSegment(this.get_EntryCurve().Trim(t,this.get_EntryCurve().get_ParEnd())),r.AddSegment(this.get_EntryCurve().Trim(this.get_EntryCurve().get_ParStart(),i)),r):this.get_EntryCurve().Trim(i,t)},Spans$$:"System.Collections.Generic.IEnumerable`1[[System.Tuple`2[[System.Double],[System.Double]]]]",get_Spans:function(){return this._Spans},set_Spans:function(n){this._Spans=n},EntryCurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_EntryCurve:function(){return this._EntryCurve},set_EntryCurve:function(n){this._EntryCurve=n},GetEntryPoints:function(){return System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,this.get_Spans(),$CreateDelegate(this,this.SpanPoints))},SpanPoints:function(n){var t,i;return n.get_Item1()==this.get_EntryCurve().get_ParStart()&&n.get_Item2()==this.get_EntryCurve().get_ParEnd()||n.get_Item2()==this.get_EntryCurve().get_ParStart()&&n.get_Item1()==this.get_EntryCurve().get_ParEnd()?[Microsoft.Msagl.Core.Layout.PortEntryOnCurve.MiddlePoint(this.get_EntryCurve())]:(t=As(this.get_EntryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),t!=null)?Microsoft.Msagl.Core.Layout.PortEntryOnCurve.SpanPointsFromPolyline(t,n):(Is(this.get_EntryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)||Is(this.get_EntryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor)||Is(this.get_EntryCurve(),Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor))&&(i=As(this.TrimEntryCurve(n),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),i!=null)?Microsoft.Msagl.Core.Layout.PortEntryOnCurve.SpanPointsFromCurveSegments(i):[this.get_EntryCurve().get_Item$$Double(this.MiddleOfSpan(n))]},MiddleOfSpan:function(n){if(n.get_Item1()<n.get_Item2())return.5*(n.get_Item1()+n.get_Item2());var i=this.GetSpanLength(n)/2,t=n.get_Item1()+i;return t<=this.get_EntryCurve().get_ParEnd()?t:t-this.get_EntryCurve().get_ParStart()},GetSpanLength:function(n){return n.get_Item1()<n.get_Item2()?n.get_Item2()-n.get_Item1():this.get_EntryCurve().get_ParEnd()-n.get_Item1()+n.get_Item2()}}};JsTypes.push(Microsoft$Msagl$Core$Layout$PortEntryOnCurve);Microsoft$Msagl$Core$ProgressChangedEventArgs={fullname:"Microsoft.Msagl.Core.ProgressChangedEventArgs",baseTypeName:"System.EventArgs",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Double:function(n){this.algorithmDescription=null;this.ratioComplete=0;Microsoft.Msagl.Core.ProgressChangedEventArgs.ctor$$Double$$String.call(this,n,null)},ctor$$Double$$String:function(n,t){this.algorithmDescription=null;this.ratioComplete=0;System.EventArgs.ctor.call(this);this.ratioComplete=n;this.algorithmDescription=t},AlgorithmDescription$$:"System.String",get_AlgorithmDescription:function(){return this.algorithmDescription},RatioComplete$$:"System.Double",get_RatioComplete:function(){return this.ratioComplete}}};JsTypes.push(Microsoft$Msagl$Core$ProgressChangedEventArgs);Microsoft$Msagl$Core$Routing$EdgeRoutingSettings={fullname:"Microsoft.Msagl.Core.Routing.EdgeRoutingSettings",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.edgeRoutingMode=Microsoft.Msagl.Core.Routing.EdgeRoutingMode.SugiyamaSplines;this.coneAngle=.523598775598299;this.padding=3;this.polylinePadding=1.5;this.routingToParentConeAngle=.523598775598299;this.simpleSelfLoopsForParentEdgesThreshold=200;this.incrementalRoutingThreshold=5e6;this.routeMultiEdgesAsBundles=!0;this._CornerRadius=0;this._BendPenalty=0;this._BundlingSettings=null;this._UseObstacleRectangles=!1;this._KeepOriginalSpline=!1;System.Object.ctor.call(this)},EdgeRoutingMode$$:"Microsoft.Msagl.Core.Routing.EdgeRoutingMode",get_EdgeRoutingMode:function(){return this.edgeRoutingMode},set_EdgeRoutingMode:function(n){this.edgeRoutingMode=n},ConeAngle$$:"System.Double",get_ConeAngle:function(){return this.coneAngle},set_ConeAngle:function(n){this.coneAngle=n},Padding$$:"System.Double",get_Padding:function(){return this.padding},set_Padding:function(n){this.padding=n},PolylinePadding$$:"System.Double",get_PolylinePadding:function(){return this.polylinePadding},set_PolylinePadding:function(n){this.polylinePadding=n},CornerRadius$$:"System.Double",get_CornerRadius:function(){return this._CornerRadius},set_CornerRadius:function(n){this._CornerRadius=n},BendPenalty$$:"System.Double",get_BendPenalty:function(){return this._BendPenalty},set_BendPenalty:function(n){this._BendPenalty=n},BundlingSettings$$:"Microsoft.Msagl.Core.Routing.BundlingSettings",get_BundlingSettings:function(){return this._BundlingSettings},set_BundlingSettings:function(n){this._BundlingSettings=n},UseObstacleRectangles$$:"System.Boolean",get_UseObstacleRectangles:function(){return this._UseObstacleRectangles},set_UseObstacleRectangles:function(n){this._UseObstacleRectangles=n},RoutingToParentConeAngle$$:"System.Double",get_RoutingToParentConeAngle:function(){return this.routingToParentConeAngle},set_RoutingToParentConeAngle:function(n){this.routingToParentConeAngle=n},SimpleSelfLoopsForParentEdgesThreshold$$:"System.Int32",get_SimpleSelfLoopsForParentEdgesThreshold:function(){return this.simpleSelfLoopsForParentEdgesThreshold},set_SimpleSelfLoopsForParentEdgesThreshold:function(n){this.simpleSelfLoopsForParentEdgesThreshold=n},IncrementalRoutingThreshold$$:"System.Int32",get_IncrementalRoutingThreshold:function(){return this.incrementalRoutingThreshold},set_IncrementalRoutingThreshold:function(n){this.incrementalRoutingThreshold=n},KeepOriginalSpline$$:"System.Boolean",get_KeepOriginalSpline:function(){return this._KeepOriginalSpline},set_KeepOriginalSpline:function(n){this._KeepOriginalSpline=n},RouteMultiEdgesAsBundles$$:"System.Boolean",get_RouteMultiEdgesAsBundles:function(){return this.routeMultiEdgesAsBundles},set_RouteMultiEdgesAsBundles:function(n){this.routeMultiEdgesAsBundles=n}}};JsTypes.push(Microsoft$Msagl$Core$Routing$EdgeRoutingSettings);Microsoft$Msagl$Core$Geometry$RTree$1={fullname:"Microsoft.Msagl.Core.Geometry.RTree$1",baseTypeName:"System.Object",staticDefinition:{GetNodeRects:function(n){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(this.TData,n.get_Value(),n.get_Key())})},AddNodeToTreeRecursive:function(n,t){var i,r,u,f;t.get_IsLeaf()?(t.set_Left(new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(this.TData,t.get_UserData(),t.get_Rectangle())),t.set_Right(n),t.set_Count(2),t.set_UserData(Default(this.TData))):(t.set_Count(t.get_Count()+1),2*t.get_Left().get_Count()<t.get_Right().get_Count()?(Microsoft.Msagl.Core.Geometry.RTree$1.AddNodeToTreeRecursive(n,t.get_Left()),t.get_Left().set_Rectangle(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(t.get_Left().get_Rectangle(),n.get_Rectangle()))):2*t.get_Right().get_Count()<t.get_Left().get_Count()?(Microsoft.Msagl.Core.Geometry.RTree$1.AddNodeToTreeRecursive(n,t.get_Right()),t.get_Right().set_Rectangle(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(t.get_Right().get_Rectangle(),n.get_Rectangle()))):(i=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(t.get_Left().get_Rectangle(),n.get_Rectangle()),u=i.get_Area()-t.get_Left().get_Rectangle().get_Area(),r=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(t.get_Right().get_Rectangle(),n.get_Rectangle()),f=r.get_Area()-t.get_Right().get_Rectangle().get_Area(),u<f?(Microsoft.Msagl.Core.Geometry.RTree$1.AddNodeToTreeRecursive(n,t.get_Left()),t.get_Left().set_Rectangle(i)):u>f?(Microsoft.Msagl.Core.Geometry.RTree$1.AddNodeToTreeRecursive(n,t.get_Right()),t.get_Right().set_Rectangle(r)):i.get_Area()<r.get_Area()?(Microsoft.Msagl.Core.Geometry.RTree$1.AddNodeToTreeRecursive(n,t.get_Left()),t.get_Left().set_Rectangle(i)):(Microsoft.Msagl.Core.Geometry.RTree$1.AddNodeToTreeRecursive(n,t.get_Right()),t.get_Right().set_Rectangle(r))));t.set_Rectangle(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(t.get_Left().get_Rectangle(),t.get_Right().get_Rectangle()))},UpdateParent:function(n){for(var t=n.get_Parent();t!=null;t=t.get_Parent())t.set_Count(t.get_Count()-1),t.set_Rectangle(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(t.get_Left().get_Rectangle(),t.get_Right().get_Rectangle()))},TransferFromSibling:function(n,t){n.set_UserData(t.get_UserData());n.set_Left(t.get_Left());n.set_Right(t.get_Right());n.set_Count(n.get_Count()-1);n.set_Rectangle(t.get_Rectangle())},RebuildUnderNodeWithoutLeaf:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(t.get_IsLeaf());System.Diagnostics.Debug.Assert$$Boolean(!n.get_IsLeaf());var i=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n.GetAllLeafNodes(),function(n){return!n.Equals$$Object(t)}));n.set_Count(i.get_Count());n.set_Left(i.get_Left());n.set_Right(i.get_Right());n.set_Rectangle(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(i.get_Left().rectangle,i.get_Right().rectangle))},FindTopUnbalancedNode:function(n){for(var t=n.get_Parent();t!=null;t=t.get_Parent())if(!Microsoft.Msagl.Core.Geometry.RTree$1.Balanced(t))return t;return null},Balanced:function(n){return 2*n.get_Left().get_Count()>=n.get_Right().get_Count()&&2*n.get_Right().get_Count()>=n.get_Left().get_Count()},NumberOfIntersectedIsLessThanBoundOnNode:function(n,t,i,r){return(System.Diagnostics.Debug.Assert$$Boolean(i.Value>0),!n.get_Rectangle().Intersects(t))?!0:n.get_IsLeaf()?r(n.get_UserData())?--i.Value!=0:!0:Microsoft.Msagl.Core.Geometry.RTree$1.NumberOfIntersectedIsLessThanBoundOnNode(n.get_Left(),t,i,r)&&Microsoft.Msagl.Core.Geometry.RTree$1.NumberOfIntersectedIsLessThanBoundOnNode(n.get_Right(),t,i,r)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$IEnumerable$1:function(n,t){this.TData=n;this._rootNode=null;System.Object.ctor.call(this);this._rootNode=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(Microsoft.Msagl.Core.Geometry.RTree$1.GetNodeRects(t))},RootNode$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[`0]]",get_RootNode:function(){return this._rootNode},set_RootNode:function(n){this._rootNode=n},ctor$$RectangleNode$1:function(n,t){this.TData=n;this._rootNode=null;System.Object.ctor.call(this);this._rootNode=t},ctor:function(n){this.TData=n;this._rootNode=null;System.Object.ctor.call(this)},Count$$:"System.Int32",get_Count:function(){return this._rootNode==null?0:this._rootNode.get_Count()},Add$$Rectangle$$TData:function(n,t){this.Add$$RectangleNode$1(new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(this.TData,t,n))},Add$$RectangleNode$1:function(n){this._rootNode==null?this._rootNode=n:this.get_Count()<=2?this._rootNode=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,this._rootNode.GetAllLeafNodes(),[n])):Microsoft.Msagl.Core.Geometry.RTree$1.AddNodeToTreeRecursive(n,this._rootNode)},Rebuild:function(){this._rootNode=Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(this._rootNode.GetAllLeafNodes())},GetAllLeaves:function(){return this._rootNode!=null&&this.get_Count()>0?this._rootNode.GetAllLeaves():new Array(0)},GetAllIntersecting:function(n){return this._rootNode==null||this.get_Count()==0?new Array(0):System.Linq.Enumerable.ToArray$1(this.TData,this._rootNode.GetNodeItemsIntersectingRectangle(n))},OneIntersecting:function(n,t){if(this._rootNode==null||this.get_Count()==0)return t.Value=Default(this.TData),!1;var i=this._rootNode.FirstIntersectedNode(n);return i==null?(t.Value=Default(this.TData),!1):(t.Value=i.get_UserData(),!0)},GetAllLeavesIntersectingRectangle:function(n){return this._rootNode==null||this.get_Count()==0?new Array(0):this._rootNode.GetLeafRectangleNodesIntersectingRectangle(n)},IsIntersecting:function(n){return System.Linq.Enumerable.Any$1$$IEnumerable$1(this.TData,this.GetAllIntersecting(n))},Contains:function(n,t){return this._rootNode==null?!1:System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,this._rootNode.GetLeafRectangleNodesIntersectingRectangle(n),$CreateAnonymousDelegate(this,function(n){return n.get_UserData().Equals$$Object(t)}))},Remove:function(n,t){if(this._rootNode==null)return Default(this.TData);var i=System.Linq.Enumerable.FirstOrDefault$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,this._rootNode.GetLeafRectangleNodesIntersectingRectangle(n),$CreateAnonymousDelegate(this,function(n){return n.get_UserData().Equals$$Object(t)}));return i==null?Default(this.TData):(this.get_RootNode().get_Count()==1?this.set_RootNode(null):this.RemoveLeaf(i),i.get_UserData())},RemoveLeaf:function(n){var i,t;System.Diagnostics.Debug.Assert$$Boolean(n.get_IsLeaf());i=Microsoft.Msagl.Core.Geometry.RTree$1.FindTopUnbalancedNode(n);i!=null?(Microsoft.Msagl.Core.Geometry.RTree$1.RebuildUnderNodeWithoutLeaf(i,n),Microsoft.Msagl.Core.Geometry.RTree$1.UpdateParent(i)):(t=n.get_Parent(),t==null?(System.Diagnostics.Debug.Assert$$Boolean(this._rootNode==n),this._rootNode=new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor(this.TData)):(Microsoft.Msagl.Core.Geometry.RTree$1.TransferFromSibling(t,n.get_IsLeftChild()?t.get_Right():t.get_Left()),Microsoft.Msagl.Core.Geometry.RTree$1.UpdateParent(t)))},Clear:function(){this.set_RootNode(null)},NumberOfIntersectedIsLessThanBound:function(n,t,i){return function(){var r={Value:t},u=Microsoft.Msagl.Core.Geometry.RTree$1.NumberOfIntersectedIsLessThanBoundOnNode(this._rootNode,n,r,i);return t=r.Value,u}.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$RTree$1);Microsoft$Msagl$Core$CancelToken={fullname:"Microsoft.Msagl.Core.CancelToken",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.canceled=!1;System.Object.ctor.call(this)},Canceled$$:"System.Boolean",get_Canceled:function(){return this.canceled},set_Canceled:function(n){this.canceled=n},ThrowIfCanceled:function(){if(this.get_Canceled())throw $CreateException(new System.OperationCanceledException.ctor,new Error);}}};JsTypes.push(Microsoft$Msagl$Core$CancelToken);Microsoft$Msagl$Core$Routing$EdgeRoutingMode={fullname:"Microsoft.Msagl.Core.Routing.EdgeRoutingMode",staticDefinition:{Spline:0,SplineBundling:1,StraightLine:2,SugiyamaSplines:3,Rectilinear:4,RectilinearToCenter:5,None:6},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Routing$EdgeRoutingMode);Microsoft$Msagl$DebugHelpers$DebugShape={fullname:"Microsoft.Msagl.DebugHelpers.DebugShape",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._Pen=0;this._Color=null;this._FillColor=null;System.Object.ctor.call(this)},Pen$$:"System.Int32",get_Pen:function(){return this._Pen},set_Pen:function(n){this._Pen=n},Color$$:"System.String",get_Color:function(){return this._Color},set_Color:function(n){this._Color=n},FillColor$$:"System.String",get_FillColor:function(){return this._FillColor},set_FillColor:function(n){this._FillColor=n}}};JsTypes.push(Microsoft$Msagl$DebugHelpers$DebugShape);Microsoft$Msagl$DebugHelpers$DebugEllipse={fullname:"Microsoft.Msagl.DebugHelpers.DebugEllipse",baseTypeName:"Microsoft.Msagl.DebugHelpers.DebugShape",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._Ellipse=null;Microsoft.Msagl.DebugHelpers.DebugShape.ctor.call(this)},Ellipse$$:"Microsoft.Msagl.Core.Geometry.Curves.Ellipse",get_Ellipse:function(){return this._Ellipse},set_Ellipse:function(n){this._Ellipse=n}}};JsTypes.push(Microsoft$Msagl$DebugHelpers$DebugEllipse);Microsoft$Msagl$Core$Layout$EdgeGeometry={fullname:"Microsoft.Msagl.Core.Layout.EdgeGeometry",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.curve=null;this.smoothedPolyline=null;this.LayoutChangeEvent=null;this._SourceArrowhead=null;this._TargetArrowhead=null;this._SourcePort=null;this._TargetPort=null;this._Waypoints=null;this._LineWidth=0;System.Object.ctor.call(this)},ctor$$Port$$Port:function(n,t){this.curve=null;this.smoothedPolyline=null;this.LayoutChangeEvent=null;this._SourceArrowhead=null;this._TargetArrowhead=null;this._SourcePort=null;this._TargetPort=null;this._Waypoints=null;this._LineWidth=0;System.Object.ctor.call(this);this.set_SourcePort(n);this.set_TargetPort(t)},SourceArrowhead$$:"Microsoft.Msagl.Core.Layout.Arrowhead",get_SourceArrowhead:function(){return this._SourceArrowhead},set_SourceArrowhead:function(n){this._SourceArrowhead=n},TargetArrowhead$$:"Microsoft.Msagl.Core.Layout.Arrowhead",get_TargetArrowhead:function(){return this._TargetArrowhead},set_TargetArrowhead:function(n){this._TargetArrowhead=n},SourcePort$$:"Microsoft.Msagl.Core.Layout.Port",get_SourcePort:function(){return this._SourcePort},set_SourcePort:function(n){this._SourcePort=n},TargetPort$$:"Microsoft.Msagl.Core.Layout.Port",get_TargetPort:function(){return this._TargetPort},set_TargetPort:function(n){this._TargetPort=n},Waypoints$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_Waypoints:function(){return this._Waypoints},set_Waypoints:function(n){this._Waypoints=n},HasWaypoints$$:"System.Boolean",get_HasWaypoints:function(){return this.get_Waypoints()!=null&&System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,this.get_Waypoints())},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0}->{1}",[this.get_SourcePort().get_Location(),this.get_TargetPort().get_Location()])},LineWidth$$:"System.Double",get_LineWidth:function(){return this._LineWidth},set_LineWidth:function(n){this._LineWidth=n},Curve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Curve:function(){return this.curve},set_Curve:function(n){this.RaiseLayoutChangeEvent(n);this.curve=n},SmoothedPolyline$$:"Microsoft.Msagl.Core.Geometry.SmoothedPolyline",get_SmoothedPolyline:function(){return this.smoothedPolyline},set_SmoothedPolyline:function(n){this.smoothedPolyline=n},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){var n=this.get_Curve().get_BoundingBox(),t,i;return this.get_SourceArrowhead()!=null&&n.Add$$Point(this.get_SourceArrowhead().get_TipPosition()),this.get_TargetArrowhead()!=null&&n.Add$$Point(this.get_TargetArrowhead().get_TipPosition()),t=.5*this.get_LineWidth(),i=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-t,t),n.Add$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_LeftTop(),i)),n.Add$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_RightBottom(),i)),n},SetSmoothedPolylineAndCurve:function(n){this.set_SmoothedPolyline(n);this.set_Curve(n.CreateCurve())},Translate:function(n){if(n.get_X()!=0||n.get_Y()!=0){if(this.RaiseLayoutChangeEvent(n),this.get_Curve()!=null&&this.get_Curve().Translate(n),this.get_SmoothedPolyline()!=null)for(var t=this.get_SmoothedPolyline().get_HeadSite(),i=this.get_SmoothedPolyline().get_HeadSite();t!=null;t=t.get_Next(),i=i.get_Next())t.set_Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Point(),n));this.get_SourceArrowhead()!=null&&this.get_SourceArrowhead().set_TipPosition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_SourceArrowhead().get_TipPosition(),n));this.get_TargetArrowhead()!=null&&this.get_TargetArrowhead().set_TipPosition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_TargetArrowhead().get_TipPosition(),n))}},GetMaxArrowheadLength:function(){var n=0;return(this.get_SourceArrowhead()!=null&&(n=this.get_SourceArrowhead().get_Length()),this.get_TargetArrowhead()!=null&&this.get_TargetArrowhead().get_Length()>n)?this.get_TargetArrowhead().get_Length():n},add_LayoutChangeEvent:function(n){this.LayoutChangeEvent=$CombineDelegates(this.LayoutChangeEvent,n)},remove_LayoutChangeEvent:function(n){this.LayoutChangeEvent=$RemoveDelegate(this.LayoutChangeEvent,n)},RaiseLayoutChangeEvent:function(n){this.LayoutChangeEvent!=null&&this.LayoutChangeEvent(this,function(){var t=new Microsoft.Msagl.Core.Layout.LayoutChangeEventArgs.ctor;return t.DataAfterChange=n,t}.call(this))}}};JsTypes.push(Microsoft$Msagl$Core$Layout$EdgeGeometry);Microsoft$Msagl$Core$Layout$FloatingPort={fullname:"Microsoft.Msagl.Core.Layout.FloatingPort",baseTypeName:"Microsoft.Msagl.Core.Layout.Port",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.curve=null;this.location=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Core.Layout.Port.ctor.call(this);this.curve=n;this.location=t.Clone()},Location$$:"Microsoft.Msagl.Core.Geometry.Point",get_Location:function(){return this.location},Translate:function(n){this.location=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.location,n)},Curve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Curve:function(){return this.curve},set_Curve:function(n){this.curve=n},toString:function(){return this.get_Location().toString()}}};JsTypes.push(Microsoft$Msagl$Core$Layout$FloatingPort);Microsoft$Msagl$Core$Layout$GeometryGraph={fullname:"Microsoft.Msagl.Core.Layout.GeometryGraph",baseTypeName:"Microsoft.Msagl.Core.Layout.GeometryObject",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.nodes=null;this.edges=null;this.rootCluster=null;this.boundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.margins=0;this._MinimalWidth=0;this._MinimalHeight=0;this._LgData=null;Microsoft.Msagl.Core.Layout.GeometryObject.ctor.call(this);this.nodes=new Microsoft.Msagl.Core.Layout.NodeCollection.ctor(this);this.edges=new Microsoft.Msagl.Core.Layout.EdgeCollection.ctor(this);this.rootCluster=new Microsoft.Msagl.Core.Layout.Cluster.ctor},RootCluster$$:"Microsoft.Msagl.Core.Layout.Cluster",get_RootCluster:function(){return this.rootCluster},set_RootCluster:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"value");this.rootCluster=n},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){return this.boundingBox},set_BoundingBox:function(n){this.boundingBox=n},Margins$$:"System.Double",get_Margins:function(){return this.margins},set_Margins:function(n){this.margins=n},Width$$:"System.Double",get_Width:function(){return this.get_BoundingBox().get_RightBottom().get_X()-this.get_BoundingBox().get_LeftTop().get_X()},Height$$:"System.Double",get_Height:function(){return this.get_BoundingBox().get_Height()},Left$$:"System.Double",get_Left:function(){return this.get_BoundingBox().get_Left()},Right$$:"System.Double",get_Right:function(){return this.get_BoundingBox().get_Right()},LeftBottom$$:"Microsoft.Msagl.Core.Geometry.Point",get_LeftBottom:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_BoundingBox().get_Left(),this.get_BoundingBox().get_Bottom())},RightTop$$:"Microsoft.Msagl.Core.Geometry.Point",get_RightTop:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Right(),this.get_Top())},Bottom$$:"System.Double",get_Bottom:function(){return this.get_BoundingBox().get_Bottom()},Top$$:"System.Double",get_Top:function(){return this.get_BoundingBox().get_Bottom()+this.get_BoundingBox().get_Height()},Nodes$$:"System.Collections.Generic.IList`1[[Microsoft.Msagl.Core.Layout.Node]]",get_Nodes:function(){return this.nodes},set_Nodes:function(n){this.nodes=n},Edges$$:"Microsoft.Msagl.Core.Layout.EdgeCollection",get_Edges:function(){return this.edges},set_Edges:function(n){this.edges=n},CollectAllLabels:function(){return System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Layout.Label.ctor,System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.Layout.Label.ctor,this.get_Edges(),$CreateAnonymousDelegate(this,function(n){return n.get_Labels()})))},Transform:function(n){for(var i=this.get_Nodes().GetEnumerator(),r,t,u;i.MoveNext();)r=i.get_Current(),r.Transform(n);for(t=this.get_Edges().GetEnumerator();t.MoveNext();)u=t.get_Current(),u.Transform(n);this.UpdateBoundingBox()},PumpTheBoxToTheGraphWithMargins:function(){var n=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox(),t;return function(){var t={Value:n},i=this.PumpTheBoxToTheGraph(t);return n=t.Value,i}.call(this),t=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Margins(),-this.get_Margins()),n.set_RightBottom(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_RightBottom(),t)),n.set_LeftTop(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_LeftTop(),t)),n.set_Width(System.Math.Max$$Double$$Double(n.get_Width(),this.get_MinimalWidth())),n.set_Height(System.Math.Max$$Double$$Double(n.get_Height(),this.get_MinimalHeight())),n},MinimalWidth$$:"System.Double",get_MinimalWidth:function(){return this._MinimalWidth},set_MinimalWidth:function(n){this._MinimalWidth=n},MinimalHeight$$:"System.Double",get_MinimalHeight:function(){return this._MinimalHeight},set_MinimalHeight:function(n){this._MinimalHeight=n},PumpTheBoxToTheGraph:function(n){for(var s=this.get_Edges().GetEnumerator(),i,r,u,h,f,e,o,t;s.MoveNext();)if(i=s.get_Current(),!i.UnderCollapsedCluster())for(i.get_Curve()!=null&&(r=i.get_Curve().get_BoundingBox().Clone(),r.Pad$$Double(i.get_LineWidth()),n.Value.Add$$Rectangle(r)),u=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Label.ctor,i.get_Labels(),$CreateAnonymousDelegate(this,function(n){return n!=null})).GetEnumerator();u.MoveNext();)h=u.get_Current(),n.Value.Add$$Rectangle(h.get_BoundingBox());for(f=this.get_Nodes().GetEnumerator();f.MoveNext();)(e=f.get_Current(),e.UnderCollapsedCluster())||n.Value.Add$$Rectangle(e.get_BoundingBox());for(o=this.get_RootCluster().get_Clusters().GetEnumerator();o.MoveNext();)t=o.get_Current(),t.get_BoundaryCurve()==null&&t.get_RectangularBoundary()!=null&&t.set_BoundaryCurve(t.get_RectangularBoundary().RectangularHull()),t.get_BoundaryCurve()!=null&&n.Value.Add$$Rectangle(t.get_BoundaryCurve().get_BoundingBox())},Translate:function(n){for(var h=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,this.get_Nodes()),o=this.get_Nodes().GetEnumerator(),i,r,t,u,f,e,s;o.MoveNext();)i=o.get_Current(),i.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Center(),n));for(r=this.get_RootCluster().AllClustersDepthFirstExcludingSelf().GetEnumerator();r.MoveNext();){for(t=r.get_Current(),u=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,t.get_Nodes(),$CreateAnonymousDelegate(this,function(n){return!h.Contains$$T(n)})).GetEnumerator();u.MoveNext();)f=u.get_Current(),f.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(f.get_Center(),n));t.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Center(),n));t.get_RectangularBoundary().TranslateRectangle(n)}for(e=this.edges.GetEnumerator();e.MoveNext();)s=e.get_Current(),s.Translate(n);this.set_BoundingBox(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Point(this.get_BoundingBox().get_Left()+n.get_X(),this.get_BoundingBox().get_Bottom()+n.get_Y(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_BoundingBox().get_Width(),this.get_BoundingBox().get_Height())))},UpdateBoundingBox:function(){this.set_BoundingBox(this.PumpTheBoxToTheGraphWithMargins())},GetFlattenedNodesAndClusters:function(){for(var n=[],r=this.get_Nodes().GetEnumerator(),u,t,i;r.MoveNext();)u=r.get_Current(),n.push(u);for(t=this.get_RootCluster().AllClustersDepthFirst().GetEnumerator();t.MoveNext();)i=t.get_Current(),i!=this.get_RootCluster()&&n.push(i);return n},FindNodeByUserData:function(n){return System.Linq.Enumerable.FirstOrDefault$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,this.get_Nodes(),$CreateAnonymousDelegate(this,function(t){return t.get_UserData().Equals$$Object(n)}))},LgData$$:"Microsoft.Msagl.Layout.LargeGraphLayout.LgData",get_LgData:function(){return this._LgData},set_LgData:function(n){this._LgData=n}}};JsTypes.push(Microsoft$Msagl$Core$Layout$GeometryGraph);Microsoft$Msagl$Core$Layout$GeometryObject={fullname:"Microsoft.Msagl.Core.Layout.GeometryObject",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.geometryParent=null;this.AlgorithmData=null;this.beforeLayoutChangeEvent=null;this.BeforeLayoutChangeEvent=null;this._UserData=null;this._BoundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;System.Object.ctor.call(this)},GeometryParent$$:"Microsoft.Msagl.Core.Layout.GeometryObject",get_GeometryParent:function(){return this.geometryParent},set_GeometryParent:function(n){this.geometryParent=n},UserData$$:"System.Object",get_UserData:function(){return this._UserData},set_UserData:function(n){this._UserData=n},add_beforeLayoutChangeEvent:function(n){this.beforeLayoutChangeEvent=$CombineDelegates(this.beforeLayoutChangeEvent,n)},remove_beforeLayoutChangeEvent:function(n){this.beforeLayoutChangeEvent=$RemoveDelegate(this.beforeLayoutChangeEvent,n)},add_BeforeLayoutChangeEvent:function(n){this.add_beforeLayoutChangeEvent(n)},remove_BeforeLayoutChangeEvent:function(n){this.remove_beforeLayoutChangeEvent(n)},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){return this._BoundingBox},set_BoundingBox:function(n){this._BoundingBox=n},RaiseLayoutChangeEvent:function(n){this.beforeLayoutChangeEvent!=null&&this.beforeLayoutChangeEvent(this,function(){var t=new Microsoft.Msagl.Core.Layout.LayoutChangeEventArgs.ctor;return t.DataAfterChange=n,t}.call(this))}}};JsTypes.push(Microsoft$Msagl$Core$Layout$GeometryObject);Microsoft$Msagl$Core$DataStructures$GenericHeapElement$1={fullname:"Microsoft.Msagl.Core.DataStructures.GenericHeapElement$1",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.T=n;this.indexToA=0;this.priority=0;this.v=null;System.Object.ctor.call(this);this.indexToA=t;this.priority=i;this.v=r}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$GenericHeapElement$1);Microsoft$Msagl$Layout$Layered$HorizontalConstraintsForSugiyama={fullname:"Microsoft.Msagl.Layout.Layered.HorizontalConstraintsForSugiyama",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.leftRightConstraints=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Tuple$2.ctor);this.leftRightNeighbors=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Tuple$2.ctor);this.nodeToBlockRoot=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor);this.upDownVerticalConstraints=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Tuple$2.ctor);this.BlockRootToBlock=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.List$1.ctor);this.LeftRighInts=null;this.LeftRightIntNeibs=null;this.VerticalInts=null;this.nodeIdToIndex=null;System.Object.ctor.call(this)},LeftRightNeighbors$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[System.Tuple`2[[Microsoft.Msagl.Core.Layout.Node],[Microsoft.Msagl.Core.Layout.Node]]]]",get_LeftRightNeighbors:function(){return this.leftRightNeighbors},UpDownVerticalConstraints$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[System.Tuple`2[[Microsoft.Msagl.Core.Layout.Node],[Microsoft.Msagl.Core.Layout.Node]]]]",get_UpDownVerticalConstraints:function(){return this.upDownVerticalConstraints},LeftRightConstraints$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[System.Tuple`2[[Microsoft.Msagl.Core.Layout.Node],[Microsoft.Msagl.Core.Layout.Node]]]]",get_LeftRightConstraints:function(){return this.leftRightConstraints},IsEmpty$$:"System.Boolean",get_IsEmpty:function(){return this.get_LeftRightNeighbors().get_Count()==0&&this.get_UpDownVerticalConstraints().get_Count()==0&&this.get_LeftRightConstraints().get_Count()==0},Clear:function(){},AddSameLayerNeighbors:function(n){for(var t=0;t<n.get_Count()-1;t++)this.AddSameLayerNeighborsPair(n.get_Item$$Int32(t),n.get_Item$$Int32(t+1))},AddSameLayerNeighborsPair:function(n,t){this.get_LeftRightNeighbors().Insert(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n,t))},NodeToBlockRootSoft:function(n){var t;return function(){var i={Value:t},r=this.nodeToBlockRoot.TryGetValue(n,i);return t=i.Value,r}.call(this)?t:n},CreateMappingOfNeibBlocks:function(){for(var r,t,u,i=this.BasicGraphFromLeftRightIntNeibs(),n=0;n<i.get_NodeCount();n++)if(i.InEdges(n).get_Count()==0&&!this.nodeToBlockRoot.ContainsKey(n)){for(r=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),t=n,u=i.OutEdges(t);u.get_Count()>0;u=i.OutEdges(t))t=u.get_Item$$Int32(0).get_Second(),r.Add(t),this.nodeToBlockRoot.set_Item$$TKey(t,n);r.get_Count()>0&&this.BlockRootToBlock.set_Item$$TKey(n,r)}},BasicGraphFromLeftRightIntNeibs:function(){return new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.LeftRightIntNeibs,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Item1(),n.get_Item2())})))},NodeIndex:function(n){var t;return function(){var i={Value:t},r=this.nodeIdToIndex.TryGetValue(n,i);return t=i.Value,r}.call(this)?t:-1},PrepareForOrdering:function(n,t){this.nodeIdToIndex=n;this.MapNodesToToIntegers(t);this.CreateMappingOfNeibBlocks();this.LiftLeftRightRelationsToNeibBlocks()},LiftLeftRightRelationsToNeibBlocks:function(){var i,n,t;for(this.LeftRighInts=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(System.Tuple$2.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,System.Tuple$2.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,null,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,null,this.leftRightConstraints,$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({p:n,ip:new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,this.NodeIndex(n.get_Item1()),this.NodeIndex(n.get_Item2()))})})),$CreateAnonymousDelegate(this,function(n){return n.get_ip().get_Item1()!=-1&&n.get_ip().get_Item2()!=-1})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({x1:n,ipb:new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,this.NodeToBlockRootSoft(n.get_ip().get_Item1()),this.NodeToBlockRootSoft(n.get_ip().get_Item2()))})})),$CreateAnonymousDelegate(this,function(n){return n.get_ipb().get_Item1()!=n.get_ipb().get_Item2()})),$CreateAnonymousDelegate(this,function(n){return n.get_ipb()}))),i=Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval$1.GetFeedbackSet(new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.LeftRighInts,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Item1(),n.get_Item2())})))),n=i.GetEnumerator();n.MoveNext();)t=n.get_Current(),this.LeftRighInts.Remove(new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,t.get_First(),t.get_Second()))},MapNodesToToIntegers:function(n){this.LeftRightIntNeibs=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(System.Tuple$2.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,System.Tuple$2.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,null,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,null,this.get_LeftRightNeighbors(),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({p:n,left:this.NodeIndex(n.get_Item1())})})),$CreateAnonymousDelegate(this,function(n){return n.get_left()!=-1})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({x5:n,right:this.NodeIndex(n.get_p().get_Item2())})})),$CreateAnonymousDelegate(this,function(n){return n.get_right()!=-1})),$CreateAnonymousDelegate(this,function(n){return new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,n.get_x5().get_left(),n.get_right())})));this.VerticalInts=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(System.Tuple$2.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,System.Tuple$2.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,null,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,null,this.get_UpDownVerticalConstraints(),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({p:n,upper:this.NodeIndex(n.get_Item1())})})),$CreateAnonymousDelegate(this,function(n){return n.get_upper()!=-1})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({x9:n,lower:this.NodeIndex(n.get_p().get_Item2())})})),$CreateAnonymousDelegate(this,function(n){return n.get_lower()!=-1})),$CreateAnonymousDelegate(this,function(t){return n[t.get_x9().get_upper()]>n[t.get_lower()]})),$CreateAnonymousDelegate(this,function(n){return new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,n.get_x9().get_upper(),n.get_lower())})))}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$HorizontalConstraintsForSugiyama);Microsoft$Msagl$Core$GraphAlgorithms$IEdge={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.IEdge",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$IEdge);Microsoft$Msagl$Core$Layout$ILabeledObject={fullname:"Microsoft.Msagl.Core.Layout.ILabeledObject",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Core$Layout$ILabeledObject);Microsoft$Msagl$Core$DataStructures$GenericBinaryHeapPriorityQueue$1={fullname:"Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.InitialHeapCapacity=16},Test:function(){var n=new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.ctor(System.Int32.ctor);for(n.Enqueue(2,2),n.Enqueue(1,1),n.Enqueue(9,9),n.Enqueue(8,8),n.Enqueue(5,5),n.Enqueue(3,3),n.Enqueue(4,4),n.Enqueue(7,7),n.Enqueue(6,6),n.Enqueue(0,0),n.DecreasePriority(4,2.5);n.IsEmpty()==!1;)System.Console.WriteLine$$Int32(n.Dequeue())}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor:function(n){this.T=n;this.A=null;this.cache=null;this.heapSize=0;System.Object.ctor.call(this);this.cache=new System.Collections.Generic.Dictionary$2.ctor(this.T,Microsoft.Msagl.Core.DataStructures.GenericHeapElement$1.ctor);this.A=new Array(17)},Count$$:"System.Int32",get_Count:function(){return this.heapSize},ContainsElement:function(n){return this.cache.ContainsKey(n)},SwapWithParent:function(n){var t=this.A[n>>1];this.PutAtI(n>>1,this.A[n]);this.PutAtI(n,t)},Enqueue:function(n,t){var r,i,u;for(this.heapSize==this.A.length-1&&(r=new Array(this.A.length*2),System.Array.Copy(this.A,1,r,1,this.heapSize),this.A=r),this.heapSize++,i=this.heapSize,this.A[i]=function(t){return this.cache.set_Item$$TKey(n,t),t}.call(this,u=new Microsoft.Msagl.Core.DataStructures.GenericHeapElement$1.ctor(this.T,i,t,n));i>1&&this.A[i>>1].priority.CompareTo$$Double(t)>0;)this.SwapWithParent(i),i>>=1},IsEmpty:function(){return this.heapSize==0},PutAtI:function(n,t){this.A[n]=t;t.indexToA=n},Dequeue:function(){if(this.heapSize==0)throw $CreateException(new System.InvalidOperationException.ctor,new Error);var n=this.A[1].v;return this.MoveQueueOneStepForward(n),n},Dequeue$$Double:function(n){if(this.heapSize==0)throw $CreateException(new System.InvalidOperationException.ctor,new Error);var t=this.A[1].v;return n.Value=this.A[1].priority,this.MoveQueueOneStepForward(t),t},MoveQueueOneStepForward:function(n){var i,t,r,u;for(this.cache.Remove(n),this.PutAtI(1,this.A[this.heapSize]),i=1;;){if(t=i,r=i<<1,r<=this.heapSize&&this.A[r].priority.CompareTo$$Double(this.A[i].priority)<0&&(t=r),u=r+1,u<=this.heapSize&&this.A[u].priority.CompareTo$$Double(this.A[t].priority)<0&&(t=u),t!=i)this.SwapWithParent(t);else break;i=t}this.heapSize--},DecreasePriority:function(n,t){var r,i;if(function(){var t={Value:r},i=this.cache.TryGetValue(n,t);return r=t.Value,i}.call(this))for(r.priority=t,i=r.indexToA;i>1;){if(this.A[i].priority.CompareTo$$Double(this.A[i>>1].priority)<0)this.SwapWithParent(i);else break;i>>=1}},GetEnumerator:function(){for(var t=[],n=1;n<=this.heapSize;n++)t.push(this.A[n].v);return t.GetEnumerator()},Peek:function(n){return this.get_Count()==0?(n.Value=0,Default(this.T)):(n.Value=this.A[1].priority,this.A[1].v)}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$GenericBinaryHeapPriorityQueue$1);Microsoft$Msagl$Core$Layout$Label={fullname:"Microsoft.Msagl.Core.Layout.Label",baseTypeName:"Microsoft.Msagl.Core.Layout.GeometryObject",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Double$$Double$$GeometryObject:function(n,t,i){this.boundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.attachmentSegmentStart=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.edgeAttachmentPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.placementStrategyPriority=[Microsoft.Msagl.Core.Layout.Label.PlacementStrategy.Horizontal,Microsoft.Msagl.Core.Layout.Label.PlacementStrategy.AlongCurve];this.placementOffset=.5;this._Side=Microsoft.Msagl.Core.Layout.Label.PlacementSide.Any;this._InnerPoints=null;this._OuterPoints=null;this._PlacementResult=Microsoft.Msagl.Core.Layout.LabelPlacementResult.OverlapsOtherLabels;Microsoft.Msagl.Core.Layout.GeometryObject.ctor.call(this);this.set_Width(n);this.set_Height(t);this.set_GeometryParent(i);this.set_PlacementStrategyPriority([Microsoft.Msagl.Core.Layout.Label.PlacementStrategy.AlongCurve,Microsoft.Msagl.Core.Layout.Label.PlacementStrategy.Horizontal])},Center$$:"Microsoft.Msagl.Core.Geometry.Point",get_Center:function(){return this.boundingBox.get_Center()},set_Center:function(n){this.RaiseLayoutChangeEvent(n);this.boundingBox.set_Center(n)},Width$$:"System.Double",get_Width:function(){return this.boundingBox.get_Width()},set_Width:function(n){this.RaiseLayoutChangeEvent(n);this.boundingBox.set_Width(n)},Height$$:"System.Double",get_Height:function(){return this.boundingBox.get_Height()},set_Height:function(n){this.RaiseLayoutChangeEvent(n);this.boundingBox.set_Height(n)},ctor:function(){this.boundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.attachmentSegmentStart=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.edgeAttachmentPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.placementStrategyPriority=[Microsoft.Msagl.Core.Layout.Label.PlacementStrategy.Horizontal,Microsoft.Msagl.Core.Layout.Label.PlacementStrategy.AlongCurve];this.placementOffset=.5;this._Side=Microsoft.Msagl.Core.Layout.Label.PlacementSide.Any;this._InnerPoints=null;this._OuterPoints=null;this._PlacementResult=Microsoft.Msagl.Core.Layout.LabelPlacementResult.OverlapsOtherLabels;Microsoft.Msagl.Core.Layout.GeometryObject.ctor.call(this)},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){return this.boundingBox},set_BoundingBox:function(n){this.RaiseLayoutChangeEvent(n);this.boundingBox=n},ctor$$GeometryObject:function(n){this.boundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.attachmentSegmentStart=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.edgeAttachmentPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.placementStrategyPriority=[Microsoft.Msagl.Core.Layout.Label.PlacementStrategy.Horizontal,Microsoft.Msagl.Core.Layout.Label.PlacementStrategy.AlongCurve];this.placementOffset=.5;this._Side=Microsoft.Msagl.Core.Layout.Label.PlacementSide.Any;this._InnerPoints=null;this._OuterPoints=null;this._PlacementResult=Microsoft.Msagl.Core.Layout.LabelPlacementResult.OverlapsOtherLabels;Microsoft.Msagl.Core.Layout.GeometryObject.ctor.call(this);this.set_GeometryParent(n)},AttachmentSegmentStart$$:"Microsoft.Msagl.Core.Geometry.Point",get_AttachmentSegmentStart:function(){return this.attachmentSegmentStart},set_AttachmentSegmentStart:function(n){this.RaiseLayoutChangeEvent(n);this.attachmentSegmentStart=n},AttachmentSegmentEnd$$:"Microsoft.Msagl.Core.Geometry.Point",get_AttachmentSegmentEnd:function(){return this.edgeAttachmentPoint},set_AttachmentSegmentEnd:function(n){n.get_X()==0&&System.Console.WriteLine();this.RaiseLayoutChangeEvent(n);this.edgeAttachmentPoint=n},PlacementOffset$$:"System.Double",get_PlacementOffset:function(){return this.placementOffset},set_PlacementOffset:function(n){this.placementOffset=n},Side$$:"Microsoft.Msagl.Core.Layout.Label+PlacementSide",get_Side:function(){return this._Side},set_Side:function(n){this._Side=n},PlacementStrategyPriority$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Label+PlacementStrategy]]",get_PlacementStrategyPriority:function(){return this.placementStrategyPriority},set_PlacementStrategyPriority:function(n){this.placementStrategyPriority=n},InnerPoints$$:"System.Collections.Generic.IList`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_InnerPoints:function(){return this._InnerPoints},set_InnerPoints:function(n){this._InnerPoints=n},OuterPoints$$:"System.Collections.Generic.IList`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_OuterPoints:function(){return this._OuterPoints},set_OuterPoints:function(n){this._OuterPoints=n},PlacementResult$$:"Microsoft.Msagl.Core.Layout.LabelPlacementResult",get_PlacementResult:function(){return this._PlacementResult},set_PlacementResult:function(n){this._PlacementResult=n},Translate:function(n){var t;if(this.RaiseLayoutChangeEvent(n),this.get_InnerPoints()!=null)for(t=0;t<this.get_InnerPoints().get_Count();++t)this.get_InnerPoints().set_Item$$Int32(t,Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_InnerPoints().get_Item$$Int32(t),n));if(this.get_OuterPoints()!=null)for(t=0;t<this.get_OuterPoints().get_Count();++t)this.get_OuterPoints().set_Item$$Int32(t,Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_OuterPoints().get_Item$$Int32(t),n));this.boundingBox=Microsoft.Msagl.Core.Geometry.Rectangle.Translate(this.boundingBox,n)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$Label);Microsoft$Msagl$Core$Layout$MultiLocationFloatingPort={fullname:"Microsoft.Msagl.Core.Layout.MultiLocationFloatingPort",baseTypeName:"Microsoft.Msagl.Core.Layout.RelativeFloatingPort",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.PossibleOffsets=null;this._ActiveOffsetIndex=0;Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point.call(this,n,t);this.PossibleOffsets=i},LocationOffsets$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_LocationOffsets:function(){return this.PossibleOffsets},ActiveOffsetIndex$$:"System.Int32",get_ActiveOffsetIndex:function(){return this._ActiveOffsetIndex},set_ActiveOffsetIndex:function(n){this._ActiveOffsetIndex=n},LocationOffset$$:"Microsoft.Msagl.Core.Geometry.Point",get_LocationOffset:function(){return this.PossibleOffsets.get_Item$$Int32(this.get_ActiveOffsetIndex())},SetClosestLocation:function(n){var i,u,t,f,r;for(this.set_ActiveOffsetIndex(0),i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,this.get_Location()).get_LengthSquared(),u=this.PossibleOffsets.get_Count(),t=1;t<u;++t)f=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.PossibleOffsets.get_Item$$Int32(t),this.get_CenterDelegate()()),r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,f).get_LengthSquared(),r<i&&(i=r,this.set_ActiveOffsetIndex(t))},toString:function(){var n=new System.Text.StringBuilder.ctor,t,i,r;for(n.Append$$Object(this.get_CenterDelegate()()),n.Append$$String(" ["),t=!1,i=this.get_LocationOffsets().GetEnumerator();i.MoveNext();)r=i.get_Current(),t&&(n.Append$$String(", "),t=!1),n.Append$$String(r.toString());return n.Append$$String("]"),n.toString()}}};JsTypes.push(Microsoft$Msagl$Core$Layout$MultiLocationFloatingPort);Microsoft$Msagl$Layout$Layered$NetworkEdge={fullname:"Microsoft.Msagl.Layout.Layered.NetworkEdge",baseTypeName:"Microsoft.Msagl.Layout.Layered.IntEdge",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.Layered.NetworkEdge.Infinity=2147483647}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.inTree=!1;this.cut=2147483647;Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32.call(this,n.get_Source(),n.get_Target());this.set_Weight(n.get_Weight());this.set_Separation(n.get_Separation())},Cut$$:"System.Int32",get_Cut:function(){return this.cut},set_Cut:function(n){this.cut=n}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$NetworkEdge);Microsoft$Msagl$Layout$Layered$NetworkSimplexForGeneralGraph={fullname:"Microsoft.Msagl.Layout.Layered.NetworkSimplexForGeneralGraph",baseTypeName:"System.Object",staticDefinition:{GetMapsToComponent:function(n){for(var t=new System.Collections.Generic.List$1.ctor(System.Collections.Generic.Dictionary$2.ctor),i=n.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.Add(Microsoft.Msagl.Layout.Layered.NetworkSimplexForGeneralGraph.MapForComp(r));return t},MapForComp:function(n){for(var u=0,t=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor),i=n.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.set_Item$$TKey(r,u++);return t}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.Layered.LayerCalculator"],Kind:"Class",definition:{ctor:function(n,t){this.graph=null;this._Cancel=null;System.Object.ctor.call(this);this.graph=n;this.set_Cancel(t)},Cancel$$:"Microsoft.Msagl.Core.CancelToken",get_Cancel:function(){return this._Cancel},set_Cancel:function(n){this._Cancel=n},GetLayers:function(){var t=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(System.Collections.Generic.IEnumerable$1.ctor,Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(this.graph)),r,u,n,f,i;if(t.get_Count()==1)return i=new Microsoft.Msagl.Layout.Layered.NetworkSimplex.ctor(this.graph,this.get_Cancel()),i.GetLayers();for(r=Microsoft.Msagl.Layout.Layered.NetworkSimplexForGeneralGraph.GetMapsToComponent(t),u=new Array(t.get_Count()),n=0;n<t.get_Count();n++)f=this.ShrunkComponent(r.get_Item$$Int32(n)),i=new Microsoft.Msagl.Layout.Layered.NetworkSimplex.ctor(f,this.get_Cancel()),u[n]=i.GetLayers();return this.UniteLayerings(u,r)},ShrunkComponent:function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$2.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,System.Linq.Enumerable.SelectMany$3$$IEnumerable$1$$Func$2$$Func$3(null,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,null,n,$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({p:n,v:n.get_Key()})})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({x0:n,newEdgeSource:n.get_p().get_Value()})})),$CreateAnonymousDelegate(this,function(n){return this.graph.OutEdges(n.get_x0().get_v())}),$CreateAnonymousDelegate(this,function(t,i){return function(){var r=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(t.get_newEdgeSource(),n.get_Item$$TKey(i.get_Target()));return r.set_Separation(i.get_Separation()),r.set_Weight(i.get_Weight()),r}.call(this)})),n.get_Count())},UniteLayerings:function(n,t){for(var u,i,f=new Int32Array(this.graph.get_NodeCount()),r=0;r<n.length;r++){for(var e=n[r],o=t.get_Item$$Int32(r),s=new Int32Array(o.get_Count()),h=o.GetEnumerator();h.MoveNext();)u=h.get_Current(),s[u.get_Value()]=u.get_Key();for(i=0;i<e.length;i++)f[s[i]]=e[i]}return f}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$NetworkSimplexForGeneralGraph);Microsoft$Msagl$Core$Geometry$Point={fullname:"Microsoft.Msagl.Core.Geometry.Point",baseTypeName:"System.ValueType",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Geometry.Point.rnd=new System.Random.ctor$$Int32(1)},P:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,t)},op_Equality:function(n,t){return n.get_X()==t.get_X()&&n.get_Y()==t.get_Y()},op_LessThan:function(n,t){return n.CompareTo(t)<0},op_LessThanOrEqual:function(n,t){return n.CompareTo(t)<=0},op_GreaterThanOrEqual:function(n,t){return n.CompareTo(t)>=0},op_GreaterThan:function(n,t){return n.CompareTo(t)>0},op_Inequality:function(n,t){return!Microsoft.Msagl.Core.Geometry.Point.op_Equality(n,t)},op_UnaryNegation:function(n){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-n.get_X(),-n.get_Y())},op_Addition:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_X()+t.get_X(),n.get_Y()+t.get_Y())},Add:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,t)},op_Subtraction:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_X()-t.get_X(),n.get_Y()-t.get_Y())},Subtract:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t)},op_Multiply$$Point$$Point:function(n,t){return n.get_X()*t.get_X()+n.get_Y()*t.get_Y()},CrossProduct:function(n,t){return n.get_X()*t.get_Y()-n.get_Y()*t.get_X()},Scale:function(n,t,i){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n*i.get_X(),t*i.get_Y())},op_Multiply$$Double$$Point:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n*t.get_X(),n*t.get_Y())},op_Multiply$$Point$$Double:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t*n.get_X(),t*n.get_Y())},Multiply$$Double$$Point:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n*t.get_X(),n*t.get_Y())},Multiply$$Point$$Double:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t*n.get_X(),t*n.get_Y())},op_Division$$Point$$Double:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_X()/t,n.get_Y()/t)},op_Division$$Double$$Point:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X()/n,t.get_Y()/n)},Divide$$Point$$Double:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_X()/t,n.get_Y()/t)},Divide$$Double$$Point:function(n,t){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X()/n,t.get_Y()/n)},DoubleToString:function(n){return System.Math.Abs$$Double(n)<1e-11?"0":n.ToString$$String$$IFormatProvider("#.##########",System.Globalization.CultureInfo.get_InvariantCulture())},ParallelWithinEpsilon:function(n,t,i){var r=n.get_Length(),u=t.get_Length();return r<i||u<i?!0:(n=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(n,r),t=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(t,u),System.Math.Abs$$Double(-n.get_X()*t.get_Y()+n.get_Y()*t.get_X())<i)},Angle$$Point$$Point$$Point:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t))},Dot:function(n,t){return n.get_X()*t.get_X()+n.get_Y()*t.get_Y()},Angle$$Point$$Point:function(n,t){var f=n.get_X(),e=n.get_Y(),o=t.get_X(),s=t.get_Y(),i=f*s-e*o,r=f*o+e*s,u;return System.Math.Abs$$Double(r)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?System.Math.Abs$$Double(i)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?0:i<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?4.71238898038469:1.5707963267949:System.Math.Abs$$Double(i)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?r<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?3.14159265358979:0:(u=System.Math.Atan2(i,r),i>=-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())?u:6.28318530717959+u},GetOrientationOf3Vectors:function(n,t,i){var f=1e3;n=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(n,f);t=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t,f);i=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(i,f);var r=Microsoft.Msagl.Core.Geometry.Point.CrossProduct(n,i),e=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(n,i),u=Microsoft.Msagl.Core.Geometry.Point.CrossProduct(n,t),o=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(n,t);return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(u,0)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.GreaterOrEqual(o,0)?Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(r,0)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.GreaterOrEqual(e,0)?0:1:Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(r,0)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.GreaterOrEqual(e,0)?-1:Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(u,0)||Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(r,0)||u*r>0?Microsoft.Msagl.Core.Geometry.ApproximateComparer.Compare(Microsoft.Msagl.Core.Geometry.Point.CrossProduct(i,t),0):-Microsoft.Msagl.Core.Geometry.ApproximateComparer.Compare(System.Math.Sign$$Double(u),0)},SignedDoubledTriangleArea:function(n,t,i){return(t.get_X()-n.get_X())*(i.get_Y()-n.get_Y())-(i.get_X()-n.get_X())*(t.get_Y()-n.get_Y())},GetTriangleOrientation:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,t,i);return r>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise:r<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise:Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear},GetTriangleOrientationWithIntersectionEpsilon:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,t,i);return r>Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()?Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise:r<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()?Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise:Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear},GetTriangleOrientationWithNoEpsilon:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,t,i);return r>0?Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise:r<0?Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise:Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear},CanProject:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t),f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t),u;return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,r)<0?!1:(u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,i),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,r)>0)?!1:!0},IntervalIntersectsRay:function(n,t,i,r,u){if(!Microsoft.Msagl.Core.Geometry.Point.LineLineIntersection(n,t,i,Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,r),u))return!1;var f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,u.Value),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.Value,t);return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,e)<=0?!1:Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.Value,i),r)<0?!1:Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,f)>Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_SquareOfDistanceEpsilon()&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(e,e)>=Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_SquareOfDistanceEpsilon()},RayIntersectsRayInteriors:function(n,t,i,r,u){return Microsoft.Msagl.Core.Geometry.Point.LineLineIntersection(n,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,t),i,Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,r),u)&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.Value,n),t)/t.get_L1()>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.Value,i),r)/r.get_L1()>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon},ProjectionToLine:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),f=r.get_Length(),e,u;return f<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?n:(r=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(r,f),e=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,n),r),u=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(e,r)),System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,u),r))<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon),u)},DistToLineSegment:function(n,t,i,r){var u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t),f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t),e,o;return(e=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,f))<=0+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?(r.Value=0,f.get_Length()):(o=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,u))<=e+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?(r.Value=1,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,i).get_Length()):(r.Value=e/o,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(r.Value,u)).get_Length())},ClosestPointAtLineSegment:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t),u,f,e;return(u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,o))<=0+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?t:(f=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,r))<=u+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?i:(e=u/f,Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(e,r)))},ClosestParameterOnLineSegment:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t),u,f;return(u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,e))<=0+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?0:(f=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,r))<=u+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?1:u/f},LineLineIntersection:function(n,t,i,r,u){var f,o,e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r),h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,n),c=function(){var n={Value:f},t={Value:o},i=Microsoft.Msagl.Core.Geometry.Curves.LinearSystem2.Solve(e.get_X(),s.get_X(),h.get_X(),e.get_Y(),s.get_Y(),h.get_Y(),n,t);return f=n.Value,o=t.Value,i}();return c?(u.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(f,e)),!0):(u.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,!1)},SegmentSegmentIntersection:function(n,t,i,r,u){var f,e,s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r),c=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,n),l=function(){var n={Value:f},t={Value:e},i=Microsoft.Msagl.Core.Geometry.Curves.LinearSystem2.Solve(s.get_X(),h.get_X(),c.get_X(),s.get_Y(),h.get_Y(),c.get_Y(),n,t);return f=n.Value,e=t.Value,i}(),o=Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance();return l&&f>-o&&f<1+o&&e>-o&&e<1+o?(u.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(f,s)),!0):(u.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,!1)},PointToTheLeftOfLineOrOnLine:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,t,i)>=0},PointToTheLeftOfLine:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,t,i)>0},PointToTheRightOfLineOrOnLine:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(t,i,n)<=0},PointToTheRightOfLine:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(t,i,n)<0},PointIsInsideCone:function(n,t,i,r){return Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLineOrOnLine(n,t,i)&&Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(n,t,r)},RandomPoint:function(){var n=-1+2*Microsoft.Msagl.Core.Geometry.Point.rnd.NextDouble(),t=-1+2*Microsoft.Msagl.Core.Geometry.Point.rnd.NextDouble();return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,t).Normalize()}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.IComparable$1"],Kind:"Struct",definition:{ctor$$Double$$Double:function(n,t){this.m_X=0;this.m_Y=0;this._hashKey=null;System.ValueType.ctor.call(this);this.m_X=n;this.m_Y=t;this._hashKey=null;this.UpdateHashKey()},Equals$$Object:function(n){return Is(n,Microsoft.Msagl.Core.Geometry.Point.ctor)?Microsoft.Msagl.Core.Geometry.Point.op_Equality(Cast(n,Microsoft.Msagl.Core.Geometry.Point.ctor),this):!1},GetHashCode:function(){var n=this.get_X().GetHashCode()|0;return(n<<5|n>>27)+this.get_Y().GetHashCode()|0},Length$$:"System.Double",get_Length:function(){return System.Math.Sqrt(this.get_X()*this.get_X()+this.get_Y()*this.get_Y())},LengthSquared$$:"System.Double",get_LengthSquared:function(){return this.get_X()*this.get_X()+this.get_Y()*this.get_Y()},Negate:function(){return Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(this)},toString:function(){return"("+Microsoft.Msagl.Core.Geometry.Point.DoubleToString(this.get_X())+","+Microsoft.Msagl.Core.Geometry.Point.DoubleToString(this.get_Y())+")"},X$$:"System.Double",get_X:function(){return this.m_X},set_X:function(n){this.m_X=n;this.UpdateHashKey()},Y$$:"System.Double",get_Y:function(){return this.m_Y},set_Y:function(n){this.m_Y=n;this.UpdateHashKey()},UpdateHashKey:function(){this._hashKey="("+this.get_X()+","+this.get_Y()+")"},Clone:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.m_X,this.m_Y)},Rotate:function(n){var t=System.Math.Cos(n),i=System.Math.Sin(n);return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t*this.get_X()-i*this.get_Y(),i*this.get_X()+t*this.get_Y())},Normalize:function(){var n=this.get_Length();if(n<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())throw $CreateException(new System.InvalidOperationException.ctor,new Error);return Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(this,n)},CompareTo:function(n){var t=this.get_X().CompareTo$$Double(n.get_X());return t!=0?t:this.get_Y().CompareTo$$Double(n.get_Y())},CompassDirection$$:"Microsoft.Msagl.Core.Geometry.Directions",get_CompassDirection:function(){return Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point(this)},L1$$:"System.Double",get_L1:function(){return System.Math.Abs$$Double(this.get_X())+System.Math.Abs$$Double(this.get_Y())},Rotate90Ccw:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-this.get_Y(),this.get_X())},Rotate90Cw:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Y(),-this.get_X())},ctor:function(){this.m_X=0;this.m_Y=0;this._hashKey=null;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Point);Microsoft$Msagl$Core$Layout$Port={fullname:"Microsoft.Msagl.Core.Layout.Port",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._Curve=null;this._PortEntry=null;System.Object.ctor.call(this)},Location$$:"Microsoft.Msagl.Core.Geometry.Point",Curve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Curve:function(){return this._Curve},set_Curve:function(n){this._Curve=n},PortEntry$$:"Microsoft.Msagl.Core.Layout.IPortEntry",get_PortEntry:function(){return this._PortEntry},set_PortEntry:function(n){this._PortEntry=n},toString:function(){return this.get_Location().toString()}}};JsTypes.push(Microsoft$Msagl$Core$Layout$Port);Microsoft$Msagl$Core$Layout$IPortEntry={fullname:"Microsoft.Msagl.Core.Layout.IPortEntry",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Core$Layout$IPortEntry);Microsoft$Msagl$Core$DataStructures$DefaultComperer$1={fullname:"Microsoft.Msagl.Core.DataStructures.DefaultComperer$1",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.T=n;System.Object.ctor.call(this)},Compare:function(n,t){return n.CompareTo(t)}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$DefaultComperer$1);Microsoft$Msagl$Core$DataStructures$RBColor={fullname:"Microsoft.Msagl.Core.DataStructures.RBColor",staticDefinition:{Red:0,Black:1},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$DataStructures$RBColor);Microsoft$Msagl$Core$DataStructures$RBNode$1={fullname:"Microsoft.Msagl.Core.DataStructures.RBNode$1",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$RBColor:function(n,t){this.T=n;this.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red;this.Item=null;this.parent=null;this.left=null;this.right=null;System.Object.ctor.call(this);this.color=t},ctor$$RBColor$$T$$RBNode$1$$RBNode$1$$RBNode$1:function(n,t,i,r,u,f){this.T=n;this.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red;this.Item=null;this.parent=null;this.left=null;this.right=null;System.Object.ctor.call(this);this.color=t;this.parent=r;this.left=u;this.right=f;this.Item=i},toString:function(){return this.Item.toString()}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$RBNode$1);Microsoft$Msagl$Core$DataStructures$RbTree$1={fullname:"Microsoft.Msagl.Core.DataStructures.RbTree$1",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor:function(n){this.T=n;this.comparer=null;this.nil=null;this.root=null;this.count=0;System.Object.ctor.call(this);this.comparer=new Microsoft.Msagl.Core.DataStructures.DefaultComperer$1.ctor(this.T);this.root=this.nil=new Microsoft.Msagl.Core.DataStructures.RBNode$1.ctor$$RBColor(this.T,Microsoft.Msagl.Core.DataStructures.RBColor.Black)},FindFirst$$Func$2:function(n){return this.FindFirst$$RBNode$1$$Func$2(this.root,n)},FindFirst$$RBNode$1$$Func$2:function(n,t){if(n==this.nil)return null;for(var i=null;n!=this.nil;)n=t(n.Item)?(i=n).left:n.right;return i},FindLast$$Func$2:function(n){return this.FindLast$$RBNode$1$$Func$2(this.root,n)},FindLast$$RBNode$1$$Func$2:function(n,t){if(n==this.nil)return null;for(var i=null;n!=this.nil;)n=t(n.Item)?(i=n).right:n.left;return i},Comparer$$:"System.Collections.Generic.IComparer`1[[`0]]",get_Comparer:function(){return this.comparer},GetEnumerator:function(){return new Microsoft.Msagl.Core.DataStructures.RBTreeEnumerator$1.ctor(this.T,this)},Nil$$:"Microsoft.Msagl.Core.DataStructures.RBNode`1[[`0]]",get_Nil:function(){return this.nil},Root$$:"Microsoft.Msagl.Core.DataStructures.RBNode`1[[`0]]",get_Root:function(){return this.root},Next:function(n){if(n.right!=this.nil)return this.TreeMinimum$$RBNode$1(n.right);for(var t=n.parent;t!=this.nil&&n==t.right;)n=t,t=t.parent;return this.ToNull(t)},ToNull:function(n){return n!=this.nil?n:null},Previous:function(n){if(n.left!=this.nil)return this.TreeMaximum$$RBNode$1(n.left);for(var t=n.parent;t!=this.nil&&n==t.left;)n=t,t=t.parent;return this.ToNull(t)},TreeMinimum$$RBNode$1:function(n){while(n.left!=this.nil)n=n.left;return this.ToNull(n)},TreeMinimum:function(){return this.TreeMinimum$$RBNode$1(this.root)},TreeMaximum$$RBNode$1:function(n){while(n.right!=this.nil)n=n.right;return this.ToNull(n)},TreeMaximum:function(){return this.TreeMaximum$$RBNode$1(this.root)},toString:function(){for(var n="{",t=0,i=this.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),n+=r.toString(),t!=this.count-1&&(n+=","),t++;return n+"}"},DeleteSubtree:function(n){var t,i;if(System.Diagnostics.Debug.Assert$$Boolean(n!=this.nil),n.left==this.nil||n.right==this.nil)t=n;else for(t=n.right;t.left!=this.nil;)t=t.left;return i=t.left!=this.nil?t.left:t.right,i.parent=t.parent,t.parent==this.nil?this.root=i:t==t.parent.left?t.parent.left=i:t.parent.right=i,t!=n&&(n.Item=t.Item),t.color==Microsoft.Msagl.Core.DataStructures.RBColor.Black&&this.DeleteFixup(i),this.ToNull(n)},Count$$:"System.Int32",get_Count:function(){return this.count},Remove:function(n){var t=this.Find$$T(n);return t!=null?(this.count--,this.DeleteSubtree(t)):null},DeleteNodeInternal:function(n){this.count--;this.DeleteSubtree(n)},Find$$RBNode$1$$T:function(n,t){for(var i;n!=this.nil&&(i=this.get_Comparer().Compare(t,n.Item))!=0;)n=i<0?n.left:n.right;return this.ToNull(n)},Find$$T:function(n){return this.Find$$RBNode$1$$T(this.root,n)},DeleteFixup:function(n){for(var t;n!=this.root&&n.color==Microsoft.Msagl.Core.DataStructures.RBColor.Black;)n==n.parent.left?(t=n.parent.right,t.color==Microsoft.Msagl.Core.DataStructures.RBColor.Red&&(t.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,n.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red,this.LeftRotate(n.parent),t=n.parent.right),t.left.color==Microsoft.Msagl.Core.DataStructures.RBColor.Black&&t.right.color==Microsoft.Msagl.Core.DataStructures.RBColor.Black?(t.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red,n=n.parent):(t.right.color==Microsoft.Msagl.Core.DataStructures.RBColor.Black&&(t.left.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,t.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red,this.RightRotate(t),t=n.parent.right),t.color=n.parent.color,n.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,t.right.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,this.LeftRotate(n.parent),n=this.root)):(t=n.parent.left,t.color==Microsoft.Msagl.Core.DataStructures.RBColor.Red&&(t.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,n.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red,this.RightRotate(n.parent),t=n.parent.left),t.right.color==Microsoft.Msagl.Core.DataStructures.RBColor.Black&&t.left.color==Microsoft.Msagl.Core.DataStructures.RBColor.Black?(t.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red,n=n.parent):(t.left.color==Microsoft.Msagl.Core.DataStructures.RBColor.Black&&(t.right.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,t.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red,this.LeftRotate(t),t=n.parent.left),t.color=n.parent.color,n.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,t.left.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,this.RightRotate(n.parent),n=this.root));n.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black},IsEmpty:function(){return this.root==this.nil},TreeInsert:function(n){for(var i=this.nil,t=this.root,u=0,r;t!=this.nil;)i=t,u=this.get_Comparer().Compare(n,t.Item),t=u<0?t.left:t.right;return r=new Microsoft.Msagl.Core.DataStructures.RBNode$1.ctor$$RBColor$$T$$RBNode$1$$RBNode$1$$RBNode$1(this.T,Microsoft.Msagl.Core.DataStructures.RBColor.Black,n,i,this.nil,this.nil),i==this.nil?this.root=r:u<0?i.left=r:i.right=r,this.ToNull(r)},InsertPrivate:function(n){var t;for(this.count++,n.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red;n!=this.root&&n.parent.color==Microsoft.Msagl.Core.DataStructures.RBColor.Red;)n.parent==n.parent.parent.left?(t=n.parent.parent.right,t.color==Microsoft.Msagl.Core.DataStructures.RBColor.Red?(n.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,t.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,n.parent.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red,n=n.parent.parent):(n==n.parent.right&&(n=n.parent,this.LeftRotate(n)),n.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,n.parent.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red,this.RightRotate(n.parent.parent))):(t=n.parent.parent.left,t.color==Microsoft.Msagl.Core.DataStructures.RBColor.Red?(n.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,t.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,n.parent.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red,n=n.parent.parent):(n==n.parent.left&&(n=n.parent,this.RightRotate(n)),n.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black,n.parent.parent.color=Microsoft.Msagl.Core.DataStructures.RBColor.Red,this.LeftRotate(n.parent.parent)));this.root.color=Microsoft.Msagl.Core.DataStructures.RBColor.Black},Insert:function(n){var t=this.TreeInsert(n);return this.InsertPrivate(t),this.ToNull(t)},LeftRotate:function(n){var t=n.right;n.right=t.left;t.left!=this.nil&&(t.left.parent=n);t.parent=n.parent;n.parent==this.nil?this.root=t:n==n.parent.left?n.parent.left=t:n.parent.right=t;t.left=n;n.parent=t},RightRotate:function(n){var t=n.left;n.left=t.right;t.right!=this.nil&&(t.right.parent=n);t.parent=n.parent;n.parent==this.nil?this.root=t:n==n.parent.right?n.parent.right=t:n.parent.left=t;t.right=n;n.parent=t},ctor$$Func$3:function(n,t){this.T=n;this.comparer=null;this.nil=null;this.root=null;this.count=0;Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1.call(this,this.T,new Microsoft.Msagl.Core.DataStructures.ComparerOnDelegate$1.ctor(this.T,t))},ctor$$IComparer$1:function(n,t){this.T=n;this.comparer=null;this.nil=null;this.root=null;this.count=0;System.Object.ctor.call(this);this.Clear();this.comparer=t},Clear:function(){this.root=this.nil=new Microsoft.Msagl.Core.DataStructures.RBNode$1.ctor$$RBColor(this.T,Microsoft.Msagl.Core.DataStructures.RBColor.Black)}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$RbTree$1);Microsoft$Msagl$Core$DataStructures$RBTreeEnumerator$1={fullname:"Microsoft.Msagl.Core.DataStructures.RBTreeEnumerator$1",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerator$1"],Kind:"Class",definition:{ctor:function(n,t){this.T=n;this.initialState=!1;this.tree=null;this.c=null;System.Object.ctor.call(this);this.tree=t;this.Reset()},Current$$:"`0",get_Current:function(){return this.c.Item},Reset:function(){this.initialState=!0},MoveNext:function(){return this.tree.IsEmpty()?!1:(this.initialState==!0?(this.initialState=!1,this.c=this.tree.TreeMinimum()):this.c=this.tree.Next(this.c),this.c!=null)},Dispose:function(){System.GC.SuppressFinalize(this)}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$RBTreeEnumerator$1);Microsoft$Msagl$Core$DataStructures$RealNumberSpan={fullname:"Microsoft.Msagl.Core.DataStructures.RealNumberSpan",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._IsEmpty=!1;this._Min=0;this._Max=0;System.Object.ctor.call(this);this.set_IsEmpty(!0)},IsEmpty$$:"System.Boolean",get_IsEmpty:function(){return this._IsEmpty},set_IsEmpty:function(n){this._IsEmpty=n},AddValue:function(n){this.get_IsEmpty()?(this.set_Min(function(n){return this.set_Max(n),n}.call(this,n)),this.set_IsEmpty(!1)):n<this.get_Min()?this.set_Min(n):n>this.get_Max()&&this.set_Max(n)},Min$$:"System.Double",get_Min:function(){return this._Min},set_Min:function(n){this._Min=n},Max$$:"System.Double",get_Max:function(){return this._Max},set_Max:function(n){this._Max=n},Length$$:"System.Double",get_Length:function(){return this.get_Max()-this.get_Min()}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$RealNumberSpan);Microsoft$Msagl$Core$Layout$RelativeFloatingPort={fullname:"Microsoft.Msagl.Core.Layout.RelativeFloatingPort",baseTypeName:"Microsoft.Msagl.Core.Layout.FloatingPort",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Func$1$ICurve$$Func$1$Point$$Point:function(n,t,i){this._CenterDelegate=null;this._CurveDelegate=null;this._LocationOffset=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Core.Layout.FloatingPort.ctor.call(this,null,Microsoft.Msagl.Core.Geometry.Point.op_Addition(t(),i));this.set_LocationOffset(i);this.set_CurveDelegate(n);this.set_CenterDelegate(t)},CenterDelegate$$:"System.Func`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_CenterDelegate:function(){return this._CenterDelegate},set_CenterDelegate:function(n){this._CenterDelegate=n},CurveDelegate$$:"System.Func`1[[Microsoft.Msagl.Core.Geometry.Curves.ICurve]]",get_CurveDelegate:function(){return this._CurveDelegate},set_CurveDelegate:function(n){this._CurveDelegate=n},LocationOffset$$:"Microsoft.Msagl.Core.Geometry.Point",get_LocationOffset:function(){return this._LocationOffset},set_LocationOffset:function(n){this._LocationOffset=n},ctor$$Func$1$ICurve$$Func$1$Point:function(n,t){this._CenterDelegate=null;this._CurveDelegate=null;this._LocationOffset=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point$$Point.call(this,n,t,new Microsoft.Msagl.Core.Geometry.Point.ctor)},Location$$:"Microsoft.Msagl.Core.Geometry.Point",get_Location:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_CenterDelegate()(),this.get_LocationOffset())},Curve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Curve:function(){return this.get_CurveDelegate()()}}};JsTypes.push(Microsoft$Msagl$Core$Layout$RelativeFloatingPort);Microsoft$Msagl$Core$Geometry$SmoothedPolyline={fullname:"Microsoft.Msagl.Core.Geometry.SmoothedPolyline",baseTypeName:"System.Object",staticDefinition:{FromPoints:function(n){var r,i;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"points");for(var u=null,t=null,f=n.GetEnumerator();f.MoveNext();)r=f.get_Current(),t==null?(t=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Point(r),u=new Microsoft.Msagl.Core.Geometry.SmoothedPolyline.ctor(t)):(i=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Point(r),i.set_Previous(t),t.set_Next(i),t=i);return u},CreateBezierSegOnSite:function(n){var t=n.get_PreviousBezierSegmentFitCoefficient(),i=n.get_NextBezierSegmentFitCoefficient(),f=n.get_Previous(),e=n.get_Next(),r=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,f.get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1-t,n.get_Point())),u=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,e.get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1-i,n.get_Point())),o=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,n.get_PreviousTangentCoefficient()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1-n.get_PreviousTangentCoefficient(),n.get_Point())),s=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(u,n.get_NextTangentCoefficient()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1-n.get_NextTangentCoefficient(),n.get_Point()));return new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(r,o,s,u)}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor:function(n){this.headSite=null;System.Object.ctor.call(this);this.headSite=n},HeadSite$$:"Microsoft.Msagl.Core.Geometry.Site",get_HeadSite:function(){return this.headSite},Clone:function(){for(var n,t=this.headSite,i=null,r=null;t!=null;)n=t.Clone(),n.set_Previous(i),i!=null?i.set_Next(n):r=n,t=t.get_Next(),i=n;return new Microsoft.Msagl.Core.Geometry.SmoothedPolyline.ctor(r)},LastSite$$:"Microsoft.Msagl.Core.Geometry.Site",get_LastSite:function(){for(var n=this.headSite;n.get_Next()!=null;)n=n.get_Next();return n},CreateCurve:function(){for(var t=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,n=this.get_HeadSite(),r,f,i,u;function(){var t={Value:r},i={Value:f},u=Microsoft.Msagl.Core.Geometry.Curves.Curve.FindCorner(n,t,i);return r=t.Value,f=i.Value,u}.call(this);)i=Microsoft.Msagl.Core.Geometry.SmoothedPolyline.CreateBezierSegOnSite(r),t.get_Segments().get_Count()==0?Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(n.get_Point(),i.get_Start())||Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Point$$Point(t,n.get_Point(),i.get_Start()):Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(t.get_End(),i.get_Start())||Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Point(t,i.get_Start()),t.AddSegment(i),n=r;return System.Diagnostics.Debug.Assert$$Boolean(n.get_Next().get_Next()==null),t.get_Segments().get_Count()==0?Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(n.get_Point(),n.get_Next().get_Point())?(u=5,t.get_Segments().Add(new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(n.get_Point(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Point(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,u)),Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Point(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-u,u)),r.get_Point()))):Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Point$$Point(t,n.get_Point(),n.get_Next().get_Point()):Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(t.get_End(),n.get_Next().get_Point())||Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Point(t,n.get_Next().get_Point()),t},GetEnumerator:function(){return new Microsoft.Msagl.Core.Geometry.PointNodesList.ctor$$Site(this.headSite)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$SmoothedPolyline);Microsoft$Msagl$Core$Geometry$TriangleOrientation={fullname:"Microsoft.Msagl.Core.Geometry.TriangleOrientation",staticDefinition:{Clockwise:0,Counterclockwise:1,Collinear:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Geometry$TriangleOrientation);Microsoft$Msagl$Layout$Layered$VerticalConstraintsForSugiyama={fullname:"Microsoft.Msagl.Layout.Layered.VerticalConstraintsForSugiyama",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._maxLayerOfGeomGraph=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor);this._minLayerOfGeomGraph=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor);this.sameLayerConstraints=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Tuple$2.ctor);this.upDownConstraints=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Tuple$2.ctor);this.gluedUpDownIntConstraints=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor);this.nodeIdToIndex=null;this.intGraph=null;this.gluedIntGraph=null;this.maxRepresentative=0;this.minRepresentative=0;this.sameLayerDictionaryOfRepresentatives=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor);this.representativeToItsLayer=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.IEnumerable$1.ctor);this.maxLayerInt=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);this.minLayerInt=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);this.sameLayerInts=new System.Collections.Generic.List$1.ctor(System.Tuple$2.ctor);this.upDownInts=new System.Collections.Generic.List$1.ctor(System.Tuple$2.ctor);System.Object.ctor.call(this)},MaxLayerOfGeomGraph$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Layout.Node]]",get_MaxLayerOfGeomGraph:function(){return this._maxLayerOfGeomGraph},MinLayerOfGeomGraph$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Layout.Node]]",get_MinLayerOfGeomGraph:function(){return this._minLayerOfGeomGraph},SameLayerConstraints$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[System.Tuple`2[[Microsoft.Msagl.Core.Layout.Node],[Microsoft.Msagl.Core.Layout.Node]]]]",get_SameLayerConstraints:function(){return this.sameLayerConstraints},UpDownConstraints$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[System.Tuple`2[[Microsoft.Msagl.Core.Layout.Node],[Microsoft.Msagl.Core.Layout.Node]]]]",get_UpDownConstraints:function(){return this.upDownConstraints},PinNodeToMaxLayer:function(n){this.get_MaxLayerOfGeomGraph().Insert(n)},PinNodeToMinLayer:function(n){System.Diagnostics.Debug.Assert$$Boolean(n!=null);this.get_MinLayerOfGeomGraph().Insert(n)},IsEmpty$$:"System.Boolean",get_IsEmpty:function(){return this.get_MaxLayerOfGeomGraph().get_Count()==0&&this.get_MinLayerOfGeomGraph().get_Count()==0&&this.get_SameLayerConstraints().get_Count()==0&&this.get_UpDownConstraints().get_Count()==0},Clear:function(){this.get_MaxLayerOfGeomGraph().Clear();this.get_MinLayerOfGeomGraph().Clear();this.get_SameLayerConstraints().Clear();this.get_UpDownConstraints().Clear()},GluedUpDownIntConstraints$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.GraphAlgorithms.IntPair]]",get_GluedUpDownIntConstraints:function(){return this.gluedUpDownIntConstraints},set_GluedUpDownIntConstraints:function(n){this.gluedUpDownIntConstraints=n},GetFeedbackSet$$BasicGraph$2$Node$IntEdge$$Dictionary$2$Node$Int32:function(n,t){return this.nodeIdToIndex=t,this.intGraph=n,this.maxRepresentative=-1,this.minRepresentative=-1,this.CreateIntegerConstraints(),this.GlueTogetherSameConstraintsMaxAndMin(),this.AddMaxMinConstraintsToGluedConstraints(),this.RemoveCyclesFromGluedConstraints(),this.GetFeedbackSet()},RemoveCyclesFromGluedConstraints:function(){for(var i=Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval$1.GetFeedbackSetWithConstraints(new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.get_GluedUpDownIntConstraints(),this.intGraph.get_NodeCount()),null),n=i.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.get_GluedUpDownIntConstraints().Remove(t)},AddMaxMinConstraintsToGluedConstraints:function(){var n,t;if(this.maxRepresentative!=-1)for(n=0;n<this.intGraph.get_NodeCount();n++)t=this.NodeToRepr(n),t!=this.maxRepresentative&&this.get_GluedUpDownIntConstraints().Insert(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(this.maxRepresentative,t));if(this.minRepresentative!=-1)for(n=0;n<this.intGraph.get_NodeCount();n++)t=this.NodeToRepr(n),t!=this.minRepresentative&&this.get_GluedUpDownIntConstraints().Insert(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(t,this.minRepresentative))},GlueTogetherSameConstraintsMaxAndMin:function(){this.CreateDictionaryOfSameLayerRepresentatives();this.set_GluedUpDownIntConstraints(new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.get_UpDownInts(),$CreateAnonymousDelegate(this,function(n){return this.GluedIntPair$$Tuple$2$Int32$Int32(n)}))))},GluedIntPair$$Tuple$2$Int32$Int32:function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(this.NodeToRepr(n.get_Item1()),this.NodeToRepr(n.get_Item2()))},GluedIntPair$$IntEdge:function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(this.NodeToRepr(n.get_Source()),this.NodeToRepr(n.get_Target()))},GluedIntPair$$IntPair:function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(this.NodeToRepr(n.get_First()),this.NodeToRepr(n.get_Second()))},GluedIntEdge:function(n){var i=this.NodeToRepr(n.get_Source()),r=this.NodeToRepr(n.get_Target()),t=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(i,r);return t.set_Separation(n.get_Separation()),t.set_Weight(0),t.set_Edge(n.get_Edge()),t},NodeToRepr:function(n){var t;return function(){var i={Value:t},r=this.sameLayerDictionaryOfRepresentatives.TryGetValue(n,i);return t=i.Value,r}.call(this)?t:n},CreateDictionaryOfSameLayerRepresentatives:function(){for(var i=this.CreateGraphOfSameLayers(),n=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(i).GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.GlueSameLayerNodesOfALayer(t)},CreateGraphOfSameLayers:function(){return new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.CreateEdgesOfSameLayers(),this.intGraph.get_NodeCount())},CreateEdgesOfSameLayers:function(){var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor);return this.maxRepresentative!=-1&&n.AddRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Int32.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Int32.ctor,this.maxLayerInt,$CreateAnonymousDelegate(this,function(n){return n!=this.maxRepresentative})),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(this.maxRepresentative,n)}))),this.minRepresentative!=-1&&n.AddRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Int32.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Int32.ctor,this.minLayerInt,$CreateAnonymousDelegate(this,function(n){return n!=this.minRepresentative})),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(this.minRepresentative,n)}))),n.AddRange(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.get_SameLayerInts(),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Item1(),n.get_Item2())}))),n},GlueSameLayerNodesOfALayer:function(n){var t,r,u,f,i;if(System.Linq.Enumerable.Count$1$$IEnumerable$1(System.Int32.ctor,n)>1){if(t=-1,this.ComponentsIsMaxLayer(n))for(r=n.GetEnumerator();r.MoveNext();)i=r.get_Current(),this.sameLayerDictionaryOfRepresentatives.set_Item$$TKey(i,t=this.maxRepresentative);else if(this.ComponentIsMinLayer(n))for(u=n.GetEnumerator();u.MoveNext();)i=u.get_Current(),this.sameLayerDictionaryOfRepresentatives.set_Item$$TKey(i,t=this.minRepresentative);else for(f=n.GetEnumerator();f.MoveNext();)i=f.get_Current(),t==-1&&(t=i),this.sameLayerDictionaryOfRepresentatives.set_Item$$TKey(i,t);this.representativeToItsLayer.set_Item$$TKey(t,n)}},ComponentIsMinLayer:function(n){return System.Linq.Enumerable.Contains$1$$IEnumerable$1$$TSource(System.Int32.ctor,n,this.minRepresentative)},ComponentsIsMaxLayer:function(n){return System.Linq.Enumerable.Contains$1$$IEnumerable$1$$TSource(System.Int32.ctor,n,this.maxRepresentative)},SameLayerInts$$:"System.Collections.Generic.List`1[[System.Tuple`2[[System.Int32],[System.Int32]]]]",get_SameLayerInts:function(){return this.sameLayerInts},set_SameLayerInts:function(n){this.sameLayerInts=n},UpDownInts$$:"System.Collections.Generic.List`1[[System.Tuple`2[[System.Int32],[System.Int32]]]]",get_UpDownInts:function(){return this.upDownInts},set_UpDownInts:function(n){this.upDownInts=n},CreateIntegerConstraints:function(){this.CreateMaxIntConstraints();this.CreateMinIntConstraints();this.CreateUpDownConstraints();this.CreateSameLayerConstraints()},CreateSameLayerConstraints:function(){this.set_SameLayerInts(this.CreateIntConstraintsFromStringCouples(this.get_SameLayerConstraints()))},CreateUpDownConstraints:function(){this.set_UpDownInts(this.CreateIntConstraintsFromStringCouples(this.get_UpDownConstraints()))},CreateIntConstraintsFromStringCouples:function(n){return new System.Collections.Generic.List$1.ctor$$IEnumerable$1(System.Tuple$2.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,System.Tuple$2.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,null,n,$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({couple:n,t:new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,this.NodeIndex(n.get_Item1()),this.NodeIndex(n.get_Item2()))})})),$CreateAnonymousDelegate(this,function(n){return n.get_t().get_Item1()!=-1&&n.get_t().get_Item2()!=-1})),$CreateAnonymousDelegate(this,function(n){return n.get_t()})))},CreateMinIntConstraints:function(){this.minLayerInt=this.CreateIntConstraintsFromExtremeLayer(this.get_MinLayerOfGeomGraph());this.minLayerInt.get_Count()>0&&(this.minRepresentative=this.minLayerInt.get_Item$$Int32(0))},CreateMaxIntConstraints:function(){this.maxLayerInt=this.CreateIntConstraintsFromExtremeLayer(this.get_MaxLayerOfGeomGraph());this.maxLayerInt.get_Count()>0&&(this.maxRepresentative=this.maxLayerInt.get_Item$$Int32(0))},CreateIntConstraintsFromExtremeLayer:function(n){return new System.Collections.Generic.List$1.ctor$$IEnumerable$1(System.Int32.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,System.Int32.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,null,n,$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({node:n,index:this.NodeIndex(n)})})),$CreateAnonymousDelegate(this,function(n){return n.get_index()!=-1})),$CreateAnonymousDelegate(this,function(n){return n.get_index()})))},NodeIndex:function(n){var t;return function(){var i={Value:t},r=this.nodeIdToIndex.TryGetValue(n,i);return t=i.Value,r}.call(this)?t:-1},GetFeedbackSet:function(){return this.gluedIntGraph=this.CreateGluedGraph(),this.UnglueIntPairs(Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval$1.GetFeedbackSetWithConstraints(this.gluedIntGraph,this.get_GluedUpDownIntConstraints()))},UnglueIntPairs:function(n){for(var i=[],r=n.GetEnumerator(),u,t,f;r.MoveNext();)for(u=r.get_Current(),t=this.UnglueEdge(u).GetEnumerator();t.MoveNext();)f=t.get_Current(),i.push(f);return i},UnglueEdge:function(n){for(var r=[],u=this.UnglueNode(n.get_Source()).GetEnumerator(),f,t,i;u.MoveNext();)for(f=u.get_Current(),t=this.intGraph.OutEdges(f).GetEnumerator();t.MoveNext();)i=t.get_Current(),this.NodeToRepr(i.get_Target())==n.get_Target()&&r.push(i);return r},CreateGluedGraph:function(){return new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.intGraph.get_Edges(),$CreateAnonymousDelegate(this,function(n){return this.GluedIntPair$$IntEdge(n)}))),this.intGraph.get_NodeCount())},UnglueNode:function(n){var t;return function(){var i={Value:t},r=this.representativeToItsLayer.TryGetValue(n,i);return t=i.Value,r}.call(this)?t:new Int32Array([n])},GetGluedNodeCounts:function(){for(var n=new Int32Array(this.nodeIdToIndex.get_Count()),t=0;t<n.length;t++)n[this.NodeToRepr(t)]++;return n}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$VerticalConstraintsForSugiyama);Microsoft$Msagl$Layout$MDS$MdsLayoutSettings={fullname:"Microsoft.Msagl.Layout.MDS.MdsLayoutSettings",baseTypeName:"Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.pivotNumber=50;this.iterationsWithMajorization=30;this.scaleX=200;this.scaleY=200;this.exponent=-2;this.rotationAngle=0;this.removeOverlaps=!0;this.overlapMethod=Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.OverlapRemovalMethod.MinimalSpanningTree;this.RunInParallel=!1;this._callIterationsWithMajorizationThreshold=3e3;this._IdealEdgeLength=new Microsoft.Msagl.Core.Layout.IdealEdgeLengthSettings.ctor;this._AdjustScale=!1;Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings.ctor.call(this)},RemoveOverlaps$$:"System.Boolean",get_RemoveOverlaps:function(){return this.removeOverlaps},set_RemoveOverlaps:function(n){this.removeOverlaps=n},PivotNumber$$:"System.Int32",get_PivotNumber:function(){return this.pivotNumber},set_PivotNumber:function(n){this.pivotNumber=n},IterationsWithMajorization$$:"System.Int32",get_IterationsWithMajorization:function(){return this.iterationsWithMajorization},set_IterationsWithMajorization:function(n){this.iterationsWithMajorization=n},ScaleX$$:"System.Double",get_ScaleX:function(){return this.scaleX},set_ScaleX:function(n){this.scaleX=n},ScaleY$$:"System.Double",get_ScaleY:function(){return this.scaleY},set_ScaleY:function(n){this.scaleY=n},Exponent$$:"System.Double",get_Exponent:function(){return this.exponent},set_Exponent:function(n){this.exponent=n},RotationAngle$$:"System.Double",get_RotationAngle:function(){return this.rotationAngle},set_RotationAngle:function(n){this.rotationAngle=n%360},Clone:function(){return As(this.MemberwiseClone(),Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings.ctor)},IdealEdgeLength$$:"Microsoft.Msagl.Core.Layout.IdealEdgeLengthSettings",get_IdealEdgeLength:function(){return this._IdealEdgeLength},set_IdealEdgeLength:function(n){this._IdealEdgeLength=n},AdjustScale$$:"System.Boolean",get_AdjustScale:function(){return this._AdjustScale},set_AdjustScale:function(n){this._AdjustScale=n},OverlapRemovalMethod$$:"Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.OverlapRemovalMethod",get_OverlapRemovalMethod:function(){return this.overlapMethod},set_OverlapRemovalMethod:function(n){this.overlapMethod=n},GetNumberOfIterationsWithMajorization:function(n){return n>this.get_CallIterationsWithMajorizationThreshold()?0:this.get_IterationsWithMajorization()},CallIterationsWithMajorizationThreshold$$:"System.Int32",get_CallIterationsWithMajorizationThreshold:function(){return this._callIterationsWithMajorizationThreshold},set_CallIterationsWithMajorizationThreshold:function(n){this._callIterationsWithMajorizationThreshold=n}}};JsTypes.push(Microsoft$Msagl$Layout$MDS$MdsLayoutSettings);Microsoft$Msagl$Core$Geometry$MultidimensionalScaling={fullname:"Microsoft.Msagl.Core.Geometry.MultidimensionalScaling",baseTypeName:"System.Object",staticDefinition:{DoubleCenter:function(n){var t,i;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"matrix");var u=new Float64Array(n.length),f=new Float64Array(n[0].length),r=0;for(t=0;t<n.length;t++)for(i=0;i<n[0].length;i++)u[t]+=n[t][i],f[i]+=n[t][i],r+=n[t][i];for(t=0;t<n.length;t++)u[t]/=n.length;for(i=0;i<n[0].length;i++)f[i]/=n[0].length;for(r/=n.length,r/=n[0].length,t=0;t<n.length;t++)for(i=0;i<n[0].length;i++)n[t][i]-=u[t]+f[i]-r},SquareEntries:function(n){var t,i;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"matrix"),t=0;t<n.length;t++)for(i=0;i<n[0].length;i++)n[t][i]=System.Math.Pow(n[t][i],2)},Multiply$$Double$Array$Array$$Double:function(n,t){var i,r;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"matrix"),i=0;i<n.length;i++)for(r=0;r<n[0].length;r++)n[i][r]*=t},Multiply$$Double$Array$Array$$Double$Array:function(n,t){var u,i,r;if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"A"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"x"),n[0].length!=t.length)return null;for(u=new Float64Array(t.length),i=0;i<n.length;i++)for(r=0;r<n[0].length;r++)u[i]+=n[i][r]*t[r];return u},Norm:function(n){var i,t;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"x"),i=0,t=0;t<n.length;t++)i+=System.Math.Pow(n[t],2);return System.Math.Sqrt(i)},Normalize:function(n){var t,i;if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"x"),t=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.Norm(n),t<=0)return 0;for(i=0;i<n.length;i++)n[i]/=t;return t},RandomUnitLengthVector:function(n,t){for(var i=new Float64Array(n),u=new System.Random.ctor$$Int32(t),r=0;r<n;r++)i[r]=u.NextDouble();return Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.Normalize(i),i},SpectralDecomposition$$Double$Array$Array$$Double$Array$$Double$$Double$Array$$Double:function(n,t,i,r,u){Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.SpectralDecomposition$$Double$Array$Array$$Double$Array$$Double$$Double$Array$$Double$$Int32$$Double(n,t,i,r,u,30,1e-6)},SpectralDecomposition$$Double$Array$Array$$Double$Array$$Double$$Double$Array$$Double$$Int32$$Double:function(n,t,i,r,u,f,e){var h,c,a,l,s,o;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"A"),h=n[0].length,t.Value=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.RandomUnitLengthVector(h,0),i.Value=0,r.Value=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.RandomUnitLengthVector(h,1),u.Value=0,c=0,a=1-e,l=0;l<f&&c<a;l++)s=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.Multiply$$Double$Array$Array$$Double$Array(n,t.Value),o=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.Multiply$$Double$Array$Array$$Double$Array(n,r.Value),i.Value=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.Normalize(s),u.Value=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.Normalize(o),Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.MakeOrthogonal(o,s),Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.Normalize(o),c=System.Math.Min$$Double$$Double(Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.DotProduct(t.Value,s),Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.DotProduct(r.Value,o)),t.Value=s,r.Value=o},DotProduct:function(n,t){var r,i;if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"x"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"y"),n.length!=t.length)return 0;for(r=0,i=0;i<n.length;i++)r+=n[i]*t[i];return r},MakeOrthogonal:function(n,t){var r,i;if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"x"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"y"),n.length==t.length)for(r=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.DotProduct(n,t)/Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.DotProduct(t,t),i=0;i<n.length;i++)n[i]-=r*t[i]},ClassicalScaling:function(n,t,i){var u,f,e,r;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"d"),u=new Array(n.length),r=0;r<n.length;r++)u[r]=new Float64Array(n[0].length),n[r].CopyTo(u[r],0);for(Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.SquareEntries(u),Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.DoubleCenter(u),Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.Multiply$$Double$Array$Array$$Double(u,-.5),function(){var n={Value:f},r={Value:e},o=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.SpectralDecomposition$$Double$Array$Array$$Double$Array$$Double$$Double$Array$$Double(u,t,n,i,r);return f=n.Value,e=r.Value,o}(),f=System.Math.Sqrt(System.Math.Abs$$Double(f)),e=System.Math.Sqrt(System.Math.Abs$$Double(e)),r=0;r<t.Value.length;r++)t.Value[r]*=f,i.Value[r]*=e},DistanceScalingSubset:function(n,t,i,r,u){var c,a,f,v,y,e,s;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"d");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"x");Microsoft.Msagl.Core.ValidateArg.IsNotNull(i,"y");Microsoft.Msagl.Core.ValidateArg.IsNotNull(r,"w");var l=t.length,h=n.length,o=new Int32Array(h);for(f=0;f<h;f++)for(e=0;e<l;e++)n[f][e]==0&&(o[f]=e);for(c=new Float64Array(h),f=0;f<h;f++)for(e=0;e<l;e++)o[f]!=e&&(c[f]+=r[f][e]);for(a=0;a<u;a++)for(f=0;f<h;f++){for(v=0,y=0,e=0;e<l;e++)f!=e&&(s=System.Math.Sqrt(System.Math.Pow(t[o[f]]-t[e],2)+System.Math.Pow(i[o[f]]-i[e],2)),s>0&&(s=1/s),v+=r[f][e]*(t[e]+n[f][e]*(t[o[f]]-t[e])*s),y+=r[f][e]*(i[e]+n[f][e]*(i[o[f]]-i[e])*s));t[o[f]]=v/c[f];i[o[f]]=y/c[f]}},DistanceScaling:function(n,t,i,r,u){var o,h,c,f,l,a,e,s;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"d"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"x"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(i,"y"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(r,"w"),o=t.length,h=new Float64Array(o),f=0;f<o;f++)for(e=0;e<o;e++)f!=e&&(h[f]+=r[f][e]);for(System.Console.Write$$String("distance scaling "),c=0;c<u;c++)for(f=0;f<o;f++){for(l=0,a=0,e=0;e<o;e++)f!=e&&(s=System.Math.Sqrt(System.Math.Pow(t[f]-t[e],2)+System.Math.Pow(i[f]-i[e],2)),s>0&&(s=1/s),l+=r[f][e]*(t[e]+n[f][e]*(t[f]-t[e])*s),a+=r[f][e]*(i[e]+n[f][e]*(i[f]-i[e])*s));t[f]=l/h[f];i[f]=a/h[f]}},ExponentialWeightMatrix:function(n,t){var u,i,r;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"d"),u=new Array(n.length),i=0;i<n.length;i++)for(u[i]=new Float64Array(n[i].length),r=0;r<n[i].length;r++)n[i][r]>0&&(u[i][r]=System.Math.Pow(n[i][r],t));return u},EuclideanDistanceMatrix:function(n,t){var u,i,r;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"x"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"y"),u=new Array(n.length),i=0;i<n.length;i++)for(u[i]=new Float64Array(n.length),r=0;r<n.length;r++)u[i][r]=System.Math.Sqrt(System.Math.Pow(n[i]-n[r],2)+System.Math.Pow(t[i]-t[r],2));return u},LandmarkClassicalScaling:function(n,t,i,r){for(var o,c,l,s,h,f,e=new Array(n.length),u=0;u<n.length;u++)for(e[u]=new Float64Array(n.length),f=0;f<n.length;f++)e[u][f]=n[u][r[f]];for(Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.SquareEntries(e),o=new Float64Array(n.length),u=0;u<n.length;u++){for(f=0;f<n.length;f++)o[u]+=e[u][f];o[u]/=n.length}for(Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.DoubleCenter(e),Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.Multiply$$Double$Array$Array$$Double(e,-.5),function(){var n={Value:c},t={Value:s},i={Value:l},r={Value:h},u=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.SpectralDecomposition$$Double$Array$Array$$Double$Array$$Double$$Double$Array$$Double(e,n,t,i,r);return c=n.Value,s=t.Value,l=i.Value,h=r.Value,u}(),s=System.Math.Sqrt(System.Math.Abs$$Double(s)),h=System.Math.Sqrt(System.Math.Abs$$Double(h)),t.Value=new Float64Array(n[0].length),i.Value=new Float64Array(n[0].length),u=0;u<t.Value.length;u++)for(f=0;f<e.length;f++)t.Value[u]-=c[f]*(System.Math.Pow(n[f][u],2)-o[f])/2,i.Value[u]-=l[f]*(System.Math.Pow(n[f][u],2)-o[f])/2}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$MultidimensionalScaling);Microsoft$Msagl$Layout$MDS$SingleSourceDistances={fullname:"Microsoft.Msagl.Layout.MDS.SingleSourceDistances",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.graph=null;this.source=null;this.directed=!1;this._Result=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.graph=n;this.source=t;this.directed=i},Result$$:"System.Double[]",get_Result:function(){return this._Result},set_Result:function(n){this._Result=n},RunInternal:function(){var e,o,i,s,u,h,c,n,f;this.StartListenToLocalProgress(this.graph.get_Nodes().get_Count(),1);this.set_Result(new Float64Array(this.graph.get_Nodes().get_Count()));for(var r=new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.ctor(Microsoft.Msagl.Core.Layout.Node.ctor),t=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Double.ctor),l=this.graph.get_Nodes().GetEnumerator();l.MoveNext();)e=l.get_Current(),r.Enqueue(e,Infinity),t.set_Item$$TKey(e,Infinity);for(r.DecreasePriority(this.source,0);r.get_Count()>0;)for(this.ProgressStep(),i=function(){var n={Value:o},t=r.Dequeue$$Double(n);return o=n.Value,t}.call(this),t.set_Item$$TKey(i,o),s=this.directed?i.get_OutEdges().GetEnumerator():i.get_Edges().GetEnumerator();s.MoveNext();)u=s.get_Current(),n=u.get_Target(),i==n&&(n=u.get_Source()),t.get_Item$$TKey(n)>t.get_Item$$TKey(i)+u.get_Length()&&(t.set_Item$$TKey(n,t.get_Item$$TKey(i)+u.get_Length()),r.DecreasePriority(n,t.get_Item$$TKey(n)));for(h=0,c=this.graph.get_Nodes().GetEnumerator();c.MoveNext();)n=c.get_Current(),function(){var i={Value:f},r=t.TryGetValue(n,i);return f=i.Value,r}.call(this)||(f=Infinity),this.get_Result()[h]=f,h++}}};JsTypes.push(Microsoft$Msagl$Layout$MDS$SingleSourceDistances);Microsoft$Msagl$Layout$MDS$MdsGraphLayout={fullname:"Microsoft.Msagl.Layout.MDS.MdsGraphLayout",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},ScaleToAverageEdgeLength:function(n,t,i){for(var f=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,System.Int32.ctor),s=0,h=n.get_Nodes().GetEnumerator(),c,r;h.MoveNext();)c=h.get_Current(),f.Add(c,s),s++;for(var u=0,e=0,l=n.get_Edges().GetEnumerator();l.MoveNext();){var o=l.get_Current(),r=f.get_Item$$TKey(o.get_Source()),a=f.get_Item$$TKey(o.get_Target());u+=System.Math.Sqrt(System.Math.Pow(t[r]-t[a],2)+System.Math.Pow(i[r]-i[a],2));e+=o.get_Length()}if(e>0&&(u/=e),u>0)for(r=0;r<t.length;r++)t[r]/=u,i[r]/=u},LayoutGraphWithMds:function(n,t,i,r){var h,u,f,c;if(i.Value=new Float64Array(n.get_Nodes().get_Count()),r.Value=new Float64Array(n.get_Nodes().get_Count()),n.get_Nodes().get_Count()!=0){if(n.get_Nodes().get_Count()==1){i.Value[0]=r.Value[0]=0;return}var l=System.Math.Min$$Int32$$Int32(t.get_PivotNumber(),n.get_Nodes().get_Count()),e=t.GetNumberOfIterationsWithMajorization(n.get_Nodes().get_Count()),a=t.get_Exponent(),o=new Int32Array(l),s=new Microsoft.Msagl.Layout.MDS.PivotDistances.ctor(n,!1,o);s.Run();h=s.get_Result();Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.LandmarkClassicalScaling(h,i,r,o);Microsoft.Msagl.Layout.MDS.MdsGraphLayout.ScaleToAverageEdgeLength(n,i.Value,r.Value);e>0&&(u=new Microsoft.Msagl.Layout.MDS.AllPairsDistances.ctor(n,!1),u.Run(),f=u.get_Result(),c=Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.ExponentialWeightMatrix(f,a),Microsoft.Msagl.Core.Geometry.MultidimensionalScaling.DistanceScalingSubset(f,i.Value,r.Value,c,e))}},UpdateTree:function(n){n.get_IsLeaf()?n.set_Rectangle(n.get_UserData().get_BoundingBox()):(Microsoft.Msagl.Layout.MDS.MdsGraphLayout.UpdateTree(n.get_Left()),Microsoft.Msagl.Layout.MDS.MdsGraphLayout.UpdateTree(n.get_Right()),n.rectangle=n.get_Left().rectangle,n.rectangle.Add$$Rectangle(n.get_Right().rectangle))},NumberOfHits:function(n,t,i,r){for(var e,u=0,f=0;f<n;f++)if(e=function(){var n={Value:i.rectangle},r=Microsoft.Msagl.Layout.MDS.MdsGraphLayout.RandomPointFromBox(t,n);return i.rectangle=n.Value,r}(),i.FirstHitNode$$Point$$Func$3(e,function(){return Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop})!=null&&u++,u==r)return r;return u},BuildNodeTree:function(n){return Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Core.Layout.Node.ctor,n,n.get_BoundingBox())}))},RandomPointFromBox:function(n,t){var i=n.NextDouble(),r=n.NextDouble();return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.Value.get_Left()+t.Value.get_Width()*i,t.Value.get_Bottom()+t.Value.get_Height()*r)},PackGraphs:function(n,t){var i=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Geometry.RectangleToPack$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,Microsoft.Msagl.Core.Geometry.RectangleToPack$1.ctor,n,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleToPack$1.ctor(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,n.get_BoundingBox(),n)})),r,u;if(i.get_Count()>1){for(r=t.get_PackingMethod()==Microsoft.Msagl.Core.Layout.PackingMethod.Compact?new Microsoft.Msagl.Core.Geometry.OptimalRectanglePacking$1.ctor(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,i,t.get_PackingAspectRatio()):new Microsoft.Msagl.Core.Geometry.OptimalColumnPacking$1.ctor(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,i,t.get_PackingAspectRatio()),r.Run(),u=i.GetEnumerator();u.MoveNext();){var f=u.get_Current(),e=f.get_Data(),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.get_Rectangle().get_LeftBottom(),e.boundingBox.get_LeftBottom());e.Translate(o)}return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(0,0,r.get_PackedWidth(),r.get_PackedHeight())}return i.get_Count()==1?i.get_Item$$Int32(0).get_Rectangle():Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.graph=null;this.settings=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.settings=n;this.graph=t},RunInternal:function(){this.LayoutConnectedComponents();this.SetGraphBoundingBox()},SetGraphBoundingBox:function(){this.graph.set_BoundingBox(this.graph.PumpTheBoxToTheGraphWithMargins())},LayoutConnectedComponents:function(){var n=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.CreateComponents(this.graph.get_Nodes(),this.graph.get_Edges())),r,t,i,u;if(this.settings.RunInParallel)r=new System.Threading.Tasks.ParallelOptions.ctor,System.Threading.Tasks.Parallel.ForEach$1$$IEnumerable$1$$ParallelOptions$$Action$1(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,n,r,$CreateDelegate(this,this.LayoutConnectedGraphWithMds));else for(t=0;t<n.length;t++)System.Console.WriteLine$$String$$Object("laying out {0} connected component",t),this.LayoutConnectedGraphWithMds(n[t]);if(n.length>1)for(System.Console.WriteLine$$String("packing"),Microsoft.Msagl.Layout.MDS.MdsGraphLayout.PackGraphs(n,this.settings),System.Console.WriteLine$$String("done packing"),i=System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.GeometryGraph.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n,$CreateAnonymousDelegate(this,function(n){return n.get_Nodes()})).GetEnumerator();i.MoveNext();)u=i.get_Current(),u.set_GeometryParent(this.graph);System.Console.WriteLine$$String("done with LayoutConnectedComponents")},LayoutConnectedGraphWithMds:function(n){var t,i,f;System.Console.WriteLine$$String$$Object$$Object("LayoutConnectedGraphWithMds: nodes {0} edges {1}",System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes()),System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,n.get_Edges())),function(){var r={Value:t},u={Value:i},f=Microsoft.Msagl.Layout.MDS.MdsGraphLayout.LayoutGraphWithMds(n,this.settings,r,u);return t=r.Value,i=u.Value,f}.call(this);this.settings.get_RotationAngle()!=0&&Microsoft.Msagl.Layout.MDS.Transform.Rotate(t,i,this.settings.get_RotationAngle());for(var e=this.settings.get_ScaleX(),o=this.settings.get_ScaleY(),r=0,u=n.get_Nodes().GetEnumerator();u.MoveNext();)f=u.get_Current(),f.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t[r]*e,i[r]*o)),r++,r%100==0&&this.ProgressStep();if(this.settings.get_AdjustScale()&&this.AdjustScale(n.get_Nodes()),this.settings.get_RemoveOverlaps())switch(this.settings.get_OverlapRemovalMethod()){case Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.OverlapRemovalMethod.Prism:Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.ProximityOverlapRemoval.RemoveOverlaps$$GeometryGraph$$Double(n,this.settings.get_NodeSeparation());break;case Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.OverlapRemovalMethod.MinimalSpanningTree:Microsoft.Msagl.Core.Layout.ProximityOverlapRemoval.MinimumSpanningTree.GTreeOverlapRemoval.RemoveOverlaps$$Node$Array$$Double(System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Node.ctor,n.get_Nodes()),this.settings.get_NodeSeparation());break;default:throw $CreateException(new System.ArgumentOutOfRangeException.ctor,new Error);}n.set_BoundingBox(n.PumpTheBoxToTheGraphWithMargins())},AdjustScale:function(n){if(!(n.get_Count()<=5)){var e=10,t=1,i=.5,r=Microsoft.Msagl.Layout.MDS.MdsGraphLayout.BuildNodeTree(n),o=new System.Random.ctor$$Int32(1);do{var u=15,f=Microsoft.Msagl.Layout.MDS.MdsGraphLayout.NumberOfHits(100,o,r,u);if(f<6)t/=1+i;else if(f>u)t*=1+i;else return;if(i/=2,this.ScaleNodes(n,t),e--==0)return;Microsoft.Msagl.Layout.MDS.MdsGraphLayout.UpdateTree(r)}while(1)}},ScaleNodes:function(n,t){for(var r=0,u=n.GetEnumerator(),i;u.MoveNext();)i=u.get_Current(),i.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(i.get_Center(),t)),r++,r%100==0&&this.ProgressStep()}}};JsTypes.push(Microsoft$Msagl$Layout$MDS$MdsGraphLayout);Microsoft$Msagl$Layout$MDS$Transform={fullname:"Microsoft.Msagl.Layout.MDS.Transform",baseTypeName:"System.Object",staticDefinition:{Rotate:function(n,t,i){for(var e,o,u=System.Math.Sin(i*3.14159265358979/180),f=System.Math.Cos(i*3.14159265358979/180),r=0;r<n.length;r++)e=f*n[r]+u*t[r],o=f*t[r]-u*n[r],n[r]=e,t[r]=o}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Layout$MDS$Transform);Microsoft$Msagl$Layout$Layered$AdjacentSwapsWithConstraints={fullname:"Microsoft.Msagl.Layout.Layered.AdjacentSwapsWithConstraints",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.Layered.AdjacentSwapsWithConstraints.maxNumberOfAdjacentExchanges=50},MaxNumberOfAdjacentExchanges$$:"System.Int32",get_MaxNumberOfAdjacentExchanges:function(){return 50}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.hasCrossWeights=!1;this.layerInfos=null;this.layering=null;this.layers=null;this.properLayeredGraph=null;this.random=new System.Random.ctor$$Int32(1);this.X=null;this.inCrossingCount=null;this.outCrossingCount=null;this.P=null;this.POrder=null;this.S=null;this.SOrder=null;System.Object.ctor.call(this);this.X=n.get_X();this.layering=n.Y;this.layers=n.get_Layers();this.properLayeredGraph=i;this.hasCrossWeights=t;this.layerInfos=r},ExchangeWithGainWithNoDisturbance:function(n){var t=!1,i;do i=this.ExchangeWithGain(n),t=t||i;while(i);return t},CanSwap:function(n,t){if(this.IsVirtualNode(n)||this.IsVirtualNode(t))return!0;var i=this.layerInfos[this.layering[n]];return i==null?!0:Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.BelongsToNeighbBlock(n,i)||Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.BelongsToNeighbBlock(t,i)||i.constrainedFromAbove.ContainsKey(n)||i.constrainedFromBelow.ContainsKey(t)?!1:i.leftRight.Contains$$T(new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,n,t))?!1:!0},IsVirtualNode:function(n){return this.properLayeredGraph.IsVirtualNode(n)},SwapWithGain:function(n,t){var i=this.SwapGain(n,t);return i>0?(this.Swap(n,t),!0):!1},SwapGain:function(n,t){if(!this.CanSwap(n,t))return-1;var i,r;return function(){var u={Value:i},f={Value:r},e=this.CalcPair(n,t,u,f);return i=u.Value,r=f.Value,e}.call(this),i-r},CalcPair:function(n,t,i,r){var u=this.S[n],f=this.S[t],e=this.P[n],o=this.P[t];if(this.hasCrossWeights){var s=this.outCrossingCount[n],h=this.outCrossingCount[t],c=this.inCrossingCount[n],l=this.inCrossingCount[t];i.Value=this.CountOnArrays$$List$1$Int32$$List$1$Int32$$Dictionary$2$Int32$Int32$$Dictionary$2$Int32$Int32(u,f,s,h)+this.CountOnArrays$$List$1$Int32$$List$1$Int32$$Dictionary$2$Int32$Int32$$Dictionary$2$Int32$Int32(e,o,c,l);r.Value=this.CountOnArrays$$List$1$Int32$$List$1$Int32$$Dictionary$2$Int32$Int32$$Dictionary$2$Int32$Int32(f,u,h,s)+this.CountOnArrays$$List$1$Int32$$List$1$Int32$$Dictionary$2$Int32$Int32$$Dictionary$2$Int32$Int32(o,e,l,c)}else i.Value=this.CountOnArrays$$List$1$Int32$$List$1$Int32(u,f)+this.CountOnArrays$$List$1$Int32$$List$1$Int32(e,o),r.Value=this.CountOnArrays$$List$1$Int32$$List$1$Int32(f,u)+this.CountOnArrays$$List$1$Int32$$List$1$Int32(o,e)},CountOnArrays$$List$1$Int32$$List$1$Int32:function(n,t){for(var r=0,s=t.get_Count()-1,i=-1,u=0,f=n.GetEnumerator(),e,o;f.MoveNext();){for(e=f.get_Current(),o=this.X[e];i<s&&this.X[t.get_Item$$Int32(i+1)]<o;i++)u++;r+=u}return r},CountOnArrays$$List$1$Int32$$List$1$Int32$$Dictionary$2$Int32$Int32$$Dictionary$2$Int32$Int32:function(n,t,i,r){for(var e=0,l=t.get_Count()-1,u=-1,o=0,s=n.GetEnumerator(),f,h,c;s.MoveNext();){for(f=s.get_Current(),h=this.X[f];u<l&&this.X[c=t.get_Item$$Int32(u+1)]<h;u++)o+=r.get_Item$$TKey(c);e+=o*i.get_Item$$TKey(f)}return e},Swap:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(this.UAndVAreOnSameLayer(n,t));System.Diagnostics.Debug.Assert$$Boolean(this.UIsToTheLeftOfV(n,t));System.Diagnostics.Debug.Assert$$Boolean(this.CanSwap(n,t));var i=this.X[n],r=this.X[t],f=this.layering[n],u=this.layers[f];u[i]=t;u[r]=n;this.X[n]=r;this.X[t]=i;this.UpdateSsContainingUV(n,t);this.UpdatePsContainingUV(n,t)},ExchangeWithGain:function(n){for(var t=0;t<n.length-1;t++)if(this.SwapWithGain(n[t],n[t+1]))return this.SwapToTheLeft(n,t),this.SwapToTheRight(n,t+1),!0;return!1},HeadOfTheCoin:function(){return this.random.Next$$Int32(2)==0},DoSwaps:function(){var i,t,n;for(this.InitArrays(),i=0,t=!0;t&&i++<Microsoft.Msagl.Layout.Layered.AdjacentSwapsWithConstraints.get_MaxNumberOfAdjacentExchanges();){for(t=!1,n=0;n<this.layers.length;n++)t=this.AdjExchangeLayer(n)||t;for(n=this.layers.length-2;n>=0;n--)t=this.AdjExchangeLayer(n)||t}System.Diagnostics.Debug.Assert$$Boolean(this.SPAreCorrect())},SPAreCorrect:function(){for(var t=this.properLayeredGraph.get_NodeCount(),n=0;n<t;n++)if(!this.SIsCorrect(n))return!1;return!0},SIsCorrect:function(n){for(var u,r,f,i=this.S[n],e=this.SOrder[n],t=0;t<i.get_Count();t++)if((r=i.get_Item$$Int32(t),u=0,function(){var n={Value:u},t=e.TryGetValue(r,n);return u=n.Value,t}.call(this)==!1)||u!=t)return!1;for(t=0;t<i.get_Count()-1;t++)if(r=i.get_Item$$Int32(t),f=i.get_Item$$Int32(t+1),!this.UIsToTheLeftOfV(r,f))return!1;return!0},InitArrays:function(){var n;for(this.S==null&&this.AllocArrays(),n=0;n<this.properLayeredGraph.get_NodeCount();n++)this.POrder[n].Clear(),this.SOrder[n].Clear(),this.S[n].Clear(),this.P[n].Clear();for(n=0;n<this.layers.length;n++)this.InitPSArraysForLayer(this.layers[n])},DisturbLayer:function(n){for(var t=0;t<n.length-1;t++)this.AdjacentSwapToTheRight(n,t)},AdjExchangeLayer:function(n){var t=this.layers[n],i=this.ExchangeWithGainWithNoDisturbance(t);return i?!0:(this.DisturbLayer(t),this.ExchangeWithGainWithNoDisturbance(t))},AllocArrays:function(){var t=this.properLayeredGraph.get_NodeCount(),n,i,e,u,o,f,r;for(this.P=new Array(t),this.S=new Array(t),this.POrder=new Array(t),this.SOrder=new Array(t),this.hasCrossWeights&&(this.outCrossingCount=new Array(t),this.inCrossingCount=new Array(t)),n=0;n<t;n++){if(i=this.properLayeredGraph.InEdgesCount(n),this.P[n]=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),this.hasCrossWeights)for(e=this.inCrossingCount[n]=new System.Collections.Generic.Dictionary$2.ctor$$Int32(System.Int32.ctor,System.Int32.ctor,i),u=this.properLayeredGraph.InEdges(n).GetEnumerator();u.MoveNext();)r=u.get_Current(),e.set_Item$$TKey(r.get_Source(),r.get_CrossingWeight());if(this.POrder[n]=new System.Collections.Generic.Dictionary$2.ctor$$Int32(System.Int32.ctor,System.Int32.ctor,i),i=this.properLayeredGraph.OutEdgesCount(n),this.S[n]=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),this.SOrder[n]=new System.Collections.Generic.Dictionary$2.ctor$$Int32(System.Int32.ctor,System.Int32.ctor,i),this.hasCrossWeights)for(o=this.outCrossingCount[n]=new System.Collections.Generic.Dictionary$2.ctor$$Int32(System.Int32.ctor,System.Int32.ctor,i),f=this.properLayeredGraph.OutEdges(n).GetEnumerator();f.MoveNext();)r=f.get_Current(),o.set_Item$$TKey(r.get_Target(),r.get_CrossingWeight())}},UpdatePsContainingUV:function(n,t){var e,o,u,i,r,f;if(this.S[n].get_Count()<=this.S[t].get_Count())for(e=this.S[n].GetEnumerator();e.MoveNext();)u=e.get_Current(),i=this.POrder[u],i.ContainsKey(t)&&(r=i.get_Item$$TKey(t),f=this.P[u],f.set_Item$$Int32(r-1,t),f.set_Item$$Int32(r,n),i.set_Item$$TKey(t,r-1),i.set_Item$$TKey(n,r));else for(o=this.S[t].GetEnumerator();o.MoveNext();)u=o.get_Current(),i=this.POrder[u],i.ContainsKey(n)&&(r=i.get_Item$$TKey(t),f=this.P[u],f.set_Item$$Int32(r-1,t),f.set_Item$$Int32(r,n),i.set_Item$$TKey(t,r-1),i.set_Item$$TKey(n,r))},SwapToTheRight:function(n,t){for(var i=t;i<n.length-1;i++)this.AdjacentSwapToTheRight(n,i)},SwapToTheLeft:function(n,t){for(var i=t-1;i>=0;i--)this.AdjacentSwapToTheRight(n,i)},AdjacentSwapToTheRight:function(n,t){var i=n[t],r=n[t+1],u=this.SwapGain(i,r);if(u>0||u==0&&this.HeadOfTheCoin()){this.Swap(i,r);return}},InitPSArraysForLayer:function(n){for(var f,e,r,h,o,s,u,c,i=0,l=n.length,t=n[i];i<l;i++,t=n[i]){for(f=this.properLayeredGraph.Pred(t).GetEnumerator();f.MoveNext();)(e=f.get_Current(),r=this.SOrder[e],r.ContainsKey(t))||(h=r.get_Count(),this.S[e].Add(t),r.set_Item$$TKey(t,h));for(o=this.properLayeredGraph.Succ(t).GetEnumerator();o.MoveNext();)(s=o.get_Current(),u=this.POrder[s],u.ContainsKey(t))||(c=u.get_Count(),this.P[s].Add(t),u.set_Item$$TKey(t,c))}},UpdateSsContainingUV:function(n,t){var e,o,u,i,r,f;if(this.P[n].get_Count()<=this.P[t].get_Count())for(e=this.P[n].GetEnumerator();e.MoveNext();)u=e.get_Current(),i=this.SOrder[u],i.ContainsKey(t)&&(r=i.get_Item$$TKey(t),f=this.S[u],f.set_Item$$Int32(r-1,t),f.set_Item$$Int32(r,n),i.set_Item$$TKey(t,r-1),i.set_Item$$TKey(n,r));else for(o=this.P[t].GetEnumerator();o.MoveNext();)u=o.get_Current(),i=this.SOrder[u],i.ContainsKey(n)&&(r=i.get_Item$$TKey(t),f=this.S[u],f.set_Item$$Int32(r-1,t),f.set_Item$$Int32(r,n),i.set_Item$$TKey(t,r-1),i.set_Item$$TKey(n,r))},UAndVAreOnSameLayer:function(n,t){return this.layering[n]==this.layering[t]},UIsToTheLeftOfV:function(n,t){return this.X[n]<this.X[t]}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$AdjacentSwapsWithConstraints);Microsoft$Msagl$Layout$Layered$ConstrainedOrdering={fullname:"Microsoft.Msagl.Layout.Layered.ConstrainedOrdering",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.MaxNumberOfNoGainSteps=5;Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.ConstrainedVarWeight=1e7;Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.PositionOverBaricenterWeight=5},ExistsShortMultiEdge:function(n,t){return System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,t,function(t){return t.get_Value().get_Count()>2&&n[t.get_Key().x]==1+n[t.get_Key().y]})},ExistsShortLabeledEdge:function(n,t){return System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,t,function(t){return n[t.get_Source()]==n[t.get_Target()]+1&&t.get_Edge().get_Label()!=null})},CreateComponentRootsToComponentsMap:function(n){for(var i=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.List$1.ctor),r=n.GetEnumerator();r.MoveNext();){var u=r.get_Current(),e=u.get_Key(),f=u.get_Value(),t;(function(){var n={Value:t},r=i.TryGetValue(f,n);return t=n.Value,r})()||i.set_Item$$TKey(f,t=new System.Collections.Generic.List$1.ctor(System.Int32.ctor));t.Add(e)}return i},GetFromDictionaryOrIdentical:function(n,t){var i;return function(){var r={Value:i},u=n.TryGetValue(t,r);return i=r.Value,u}()?i:t},NodeToBlockRootSoftOnLayerInfo:function(n,t){var i;return function(){var r={Value:i},u=n.nodeToBlockRoot.TryGetValue(t,r);return i=r.Value,u}()?i:t},AddGoalToKeepFlatEdgesShortOnBlockLevel:function(n,t){var i;if(n!=null)for(i=n.flatEdges.GetEnumerator();i.MoveNext();){var r=i.get_Current(),u=Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.NodeToBlockRootSoftOnLayerInfo(n,r.get_Item1()),f=Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.NodeToBlockRootSoftOnLayerInfo(n,r.get_Item2());u!=f&&t.AddGoalTwoVariablesAreClose$$Int32$$Int32(u,f)}},NodeIsConstrainedBelow:function(n,t){return t==null?!1:t.constrainedFromBelow.ContainsKey(n)},NodeIsConstrainedAbove:function(n,t){return t==null?!1:t.constrainedFromAbove.ContainsKey(n)},BelongsToNeighbBlock:function(n,t){return t!=null&&(t.nodeToBlockRoot.ContainsKey(n)||t.neigBlocks.ContainsKey(n))},NodesAreConstrainedBelow:function(n,t,i){return Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.NodeIsConstrainedBelow(n,i)&&Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.NodeIsConstrainedBelow(t,i)},NodesAreConstrainedAbove:function(n,t,i){return Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.NodeIsConstrainedAbove(n,i)&&Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.NodeIsConstrainedAbove(t,i)},CreateSolver:function(){return new Microsoft.Msagl.Core.ProjectionSolver.SolverShell.ctor},TryGetBlockRoot:function(n,t,i){return i.nodeToBlockRoot.TryGetValue(n,t)?!0:i.neigBlocks.ContainsKey(n)?(t.Value=n,!0):!1},VertConstrainedNodesOfLayer:function(n){var i=[],r,u,t;if(n!=null){for(r=n.constrainedFromAbove.get_Keys().GetEnumerator();r.MoveNext();)t=r.get_Current(),i.push(t);for(u=n.constrainedFromBelow.get_Keys().GetEnumerator();u.MoveNext();)t=u.get_Current(),i.push(t)}return i}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u,f){if(this.geometryGraph=null,this.intGraph=null,this.ProperLayeredGraph=null,this.initialLayering=null,this.layerInfos=null,this.LayerArrays=null,this.horizontalConstraints=null,this.numberOfNodesOfProperGraph=0,this.database=null,this.xPositions=null,this.yetBestLayers=null,this.verticalEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Layered.IntEdge.ctor),this.adjSwapper=null,this.settings=null,this.numberOfLayers=-1,this.noGainSteps=0,this._LayersAreDoubled=!1,System.Object.ctor.call(this),this.settings=f,this.horizontalConstraints=f.get_HorizontalConstraints(),this.horizontalConstraints.PrepareForOrdering(r,i),this.geometryGraph=n,this.database=u,this.intGraph=t,this.initialLayering=i,this.NeedToInsertLayers(i)){for(var e=0;e<i.length;e++)i[e]*=2;this.set_LayersAreDoubled(!0);this.numberOfLayers=-1}this.PrepareProperLayeredGraphAndFillLayerInfos();this.adjSwapper=new Microsoft.Msagl.Layout.Layered.AdjacentSwapsWithConstraints.ctor(this.LayerArrays,this.HasCrossWeights(),this.ProperLayeredGraph,this.layerInfos)},NumberOfLayers$$:"System.Int32",get_NumberOfLayers:function(){return this.numberOfLayers>0?this.numberOfLayers:this.numberOfLayers=System.Linq.Enumerable.Max$1$$IEnumerable$1$$Func$2(System.Int32.ctor,this.initialLayering,$CreateAnonymousDelegate(this,function(n){return n+1}))},NodeSeparation:function(){return this.settings.get_NodeSeparation()},LayersAreDoubled$$:"System.Boolean",get_LayersAreDoubled:function(){return this._LayersAreDoubled},set_LayersAreDoubled:function(n){this._LayersAreDoubled=n},NeedToInsertLayers:function(n){return Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.ExistsShortLabeledEdge(n,this.intGraph.get_Edges())||Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.ExistsShortMultiEdge(n,this.database.get_Multiedges())},Calculate:function(){this.AllocateXPositions();var n=As(this.intGraph.get_Nodes().get_Item$$Int32(0).get_GeometryParent(),Microsoft.Msagl.Core.Layout.GeometryGraph.ctor);(function(){var t={Value:this.database.anchors},i=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.CalculateAnchorSizes(this.database,t,this.ProperLayeredGraph,n,this.intGraph,this.settings);return this.database.anchors=t.Value,i}).call(this);Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.CalcInitialYAnchorLocations(this.LayerArrays,500,this.geometryGraph,this.database,this.intGraph,this.settings,this.get_LayersAreDoubled());this.Order()},CreateMeasure:function(){return new Microsoft.Msagl.Layout.Layered.ConstrainedOrderMeasure.ctor(Microsoft.Msagl.Layout.Layered.Ordering.GetCrossingsTotal(this.ProperLayeredGraph,this.LayerArrays))},HasCrossWeights:function(){return System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Layered.LayerEdge.ctor,this.ProperLayeredGraph.get_Edges(),$CreateAnonymousDelegate(this,function(n){return n.get_CrossingWeight()!=1}))},AllocateXPositions:function(){this.xPositions=new Array(this.get_NumberOfLayers());for(var n=0;n<this.get_NumberOfLayers();n++)this.xPositions[n]=new Float64Array(this.LayerArrays.get_Layers()[n].length)},Order:function(){var i,n,t;for(this.CreateInitialOrderInLayers(),this.TryPushingOutStrangersFromHorizontalBlocks(),i=5,n=null;i-->0&&this.noGainSteps<=5;)this.SetXPositions(),t=this.CreateMeasure(),n==null||Microsoft.Msagl.Layout.Layered.ConstrainedOrderMeasure.op_LessThan(t,n)?(this.noGainSteps=0,function(){var n={Value:this.yetBestLayers},t=Microsoft.Msagl.Layout.Layered.Ordering.CloneLayers(this.LayerArrays.get_Layers(),n);return this.yetBestLayers=n.Value,t}.call(this),n=t):(this.noGainSteps++,this.RestoreState())},SetXPositions:function(){var t=this.InitSolverWithoutOrder(),n;for(this.ImproveWithAdjacentSwaps(),this.PutLayerNodeSeparationsIntoSolver(t),t.Solve(),this.SortLayers(t),n=0;n<this.LayerArrays.Y.length;n++)this.database.get_Anchors()[n].set_X(t.GetVariableResolvedPosition(n))},InitSolverWithoutOrder:function(){var n=Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.CreateSolver();return this.InitSolverVars(n),this.PutLeftRightConstraintsIntoSolver(n),this.PutVerticalConstraintsIntoSolver(n),this.AddGoalsToKeepProperEdgesShort(n),this.AddGoalsToKeepFlatEdgesShort(n),n},SortLayers:function(n){for(var t=0;t<this.LayerArrays.get_Layers().length;t++)this.SortLayerBasedOnSolution(this.LayerArrays.get_Layers()[t],n)},AddGoalsToKeepFlatEdgesShort:function(n){for(var t=0,i=this.layerInfos,u=i.length,r=i[t];t<u;t++,r=i[t])Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.AddGoalToKeepFlatEdgesShortOnBlockLevel(r,n)},InitSolverVars:function(n){for(var t=0;t<this.LayerArrays.Y.length;t++)n.AddVariableWithIdealPosition$$Int32$$Double(t,0)},AddGoalsToKeepProperEdgesShort:function(n){for(var i=this.ProperLayeredGraph.get_Edges().GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),n.AddGoalTwoVariablesAreClose$$Int32$$Int32$$Double(t.get_Source(),t.get_Target(),5)},PutVerticalConstraintsIntoSolver:function(n){for(var i=this.horizontalConstraints.VerticalInts.GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),n.AddGoalTwoVariablesAreClose$$Int32$$Int32$$Double(t.get_Item1(),t.get_Item2(),1e7)},PutLeftRightConstraintsIntoSolver:function(n){for(var i=this.horizontalConstraints.LeftRighInts.GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),n.AddLeftRightSeparationConstraint$$Int32$$Int32$$Double(t.get_Item1(),t.get_Item2(),this.SimpleGapBetweenTwoNodes(t.get_Item1(),t.get_Item2()))},PutLayerNodeSeparationsIntoSolver:function(n){for(var t,f,e,i=0,u=this.LayerArrays.get_Layers(),o=u.length,r=u[i];i<o;i++,r=u[i])for(t=0;t<r.length-1;t++)f=r[t],e=r[t+1],n.AddLeftRightSeparationConstraint$$Int32$$Int32$$Double(f,e,this.SimpleGapBetweenTwoNodes(f,e))},ImproveWithAdjacentSwaps:function(){this.adjSwapper.DoSwaps()},TryPushingOutStrangersFromHorizontalBlocks:function(){},CreateInitialOrderInLayers:function(){var n=this.CreateVerticalComponents(),t=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.LiftLeftRightRelationsToComponentRoots(n)),i=Microsoft.Msagl.Core.GraphAlgorithms.TopologicalSort.GetOrderOnEdges$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,t);this.FillLayersWithVerticalComponentsOrder(i,n);this.LayerArrays.UpdateXFromLayers()},FillLayersWithVerticalComponentsOrder:function(n,t){for(var i,o=Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.CreateComponentRootsToComponentsMap(t),u=new Array(this.LayerArrays.Y.length),f=new Int32Array(this.LayerArrays.get_Layers().length),r=0,s=n.length,e=n[r];r<s;r++,e=n[r])this.PutVerticalComponentIntoLayers(this.EnumerateVertComponent(o,e),f,u);for(i=0;i<this.ProperLayeredGraph.get_NodeCount();i++)u[i]==!1&&this.AddVertToLayers(i,f,u)},EnumerateVertComponent:function(n,t){var i=[],r,u,f;if(function(){var i={Value:r},u=n.TryGetValue(t,i);return r=i.Value,u}.call(this))for(u=r.GetEnumerator();u.MoveNext();)f=u.get_Current(),i.push(f);else i.push(t);return i},PutVerticalComponentIntoLayers:function(n,t,i){for(var r=n.GetEnumerator(),u;r.MoveNext();)u=r.get_Current(),this.AddVertToLayers(u,t,i)},AddVertToLayers:function(n,t,i){var e,o,r;if(!i[n]){var u=this.LayerArrays.Y[n],f=t[u],s=this.LayerArrays.get_Layers()[u];if(s[f++]=n,i[n]=!0,function(){var t={Value:e},i=this.horizontalConstraints.BlockRootToBlock.TryGetValue(n,t);return e=t.Value,i}.call(this))for(o=e.GetEnumerator();o.MoveNext();)(r=o.get_Current(),i[r])||(s[f++]=r,i[r]=!0);t[u]=f}},LiftLeftRightRelationsToComponentRoots:function(n){for(var i=[],u=this.horizontalConstraints.LeftRighInts.GetEnumerator(),r,t;u.MoveNext();)t=u.get_Current(),i.push(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.GetFromDictionaryOrIdentical(n,t.get_Item1()),Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.GetFromDictionaryOrIdentical(n,t.get_Item2())));for(r=this.horizontalConstraints.LeftRightIntNeibs.GetEnumerator();r.MoveNext();)t=r.get_Current(),i.push(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.GetFromDictionaryOrIdentical(n,t.get_Item1()),Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.GetFromDictionaryOrIdentical(n,t.get_Item2())));return i},CreateVerticalComponents:function(){for(var o=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.horizontalConstraints.VerticalInts,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(n.get_Item1(),n.get_Item2())}))),s=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(o),u=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor),f=s.GetEnumerator(),t,e,n,i,r;f.MoveNext();)if(t=f.get_Current(),e=System.Linq.Enumerable.ToArray$1(System.Int32.ctor,t),e.length!=1)for(n=-1,i=t.GetEnumerator();i.MoveNext();)r=i.get_Current(),n==-1&&(n=r),u.set_Item$$TKey(r,n);return u},RestoreState:function(){this.LayerArrays.UpdateLayers(this.yetBestLayers)},SortLayerBasedOnSolution:function(n,t){for(var e,o=n.length,f=new Float64Array(o),s=0,i=0,h=n.length,r=n[i];i<h;i++,r=n[i])f[s++]=t.GetVariableResolvedPosition(r);System.Array.Sort$2$$TKey$Array$$TValue$Array(System.Double.ctor,System.Int32.ctor,f,n);e=0;for(var u=0,c=n.length,r=n[u];u<c;u++,r=n[u])this.LayerArrays.get_X()[r]=e++},GetGapFromNodeNodesConstrainedBelow:function(n,t,i,r){var u=this.SimpleGapBetweenTwoNodes(n,t);return(n=i.constrainedFromBelow.get_Item$$TKey(n),t=i.constrainedFromBelow.get_Item$$TKey(t),r--,i=this.layerInfos[r],r>0&&Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.NodesAreConstrainedBelow(n,t,i))?System.Math.Max$$Double$$Double(u,this.GetGapFromNodeNodesConstrainedBelow(n,t,i,r)):System.Math.Max$$Double$$Double(u,this.SimpleGapBetweenTwoNodes(n,t))},GetGapFromNodeNodesConstrainedAbove:function(n,t,i,r){var u=this.SimpleGapBetweenTwoNodes(n,t);return(n=i.constrainedFromAbove.get_Item$$TKey(n),t=i.constrainedFromAbove.get_Item$$TKey(t),r++,i=this.layerInfos[r],r<this.LayerArrays.get_Layers().length-1&&Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.NodesAreConstrainedAbove(n,t,i))?System.Math.Max$$Double$$Double(u,this.GetGapFromNodeNodesConstrainedAbove(n,t,i,r)):System.Math.Max$$Double$$Double(u,this.SimpleGapBetweenTwoNodes(n,t))},SimpleGapBetweenTwoNodes:function(n,t){return this.database.anchors[n].get_RightAnchor()+this.NodeSeparation()+this.database.anchors[t].get_LeftAnchor()},PrepareProperLayeredGraphAndFillLayerInfos:function(){this.layerInfos=new Array(this.get_NumberOfLayers());this.CreateProperLayeredGraph();this.CreateExtendedLayerArrays();this.FillBlockRootToBlock();this.FillLeftRightPairs();this.FillFlatEdges();this.FillAboveBelow();this.FillBlockRootToVertConstrainedNode()},FillBlockRootToVertConstrainedNode:function(){for(var r,u,f,n=0,i=this.layerInfos,e=i.length,t=i[n];n<e;n++,t=i[n])for(r=Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.VertConstrainedNodesOfLayer(t).GetEnumerator();r.MoveNext();)u=r.get_Current(),function(){var n={Value:f},i=Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.TryGetBlockRoot(u,n,t);return f=n.Value,i}.call(this)&&t.blockRootToVertConstrainedNodeOfBlock.set_Item$$TKey(f,u)},CreateExtendedLayerArrays:function(){var r=new Int32Array(this.numberOfNodesOfProperGraph),u,n,t,f,i;for(System.Array.Copy(this.initialLayering,r,this.initialLayering.length),u=this.ProperLayeredGraph.BaseGraph.get_Edges().GetEnumerator();u.MoveNext();)if(n=u.get_Current(),t=n.get_LayerEdges()instanceof Array||n.get_LayerEdges()==null?n.get_LayerEdges():function(){throw new Error("InvalidCastException");}(),t!=null&&t.length>1)for(f=this.initialLayering[n.get_Source()]-1,i=0;i<t.length-1;i++)r[t[i].get_Target()]=f--;this.LayerArrays=new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(r)},CreateProperLayeredGraph:function(){var n=this.CreatePathEdgesOnIntGraph(),t=System.Math.Max$$Int32$$Int32(this.intGraph.get_NodeCount(),Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.VertexCount(n)),i=function(){var i=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$2.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,n,t);return i.set_Nodes(this.intGraph.get_Nodes()),i}.call(this);this.ProperLayeredGraph=new Microsoft.Msagl.Layout.Layered.ProperLayeredGraph.ctor(i)},CreatePathEdgesOnIntGraph:function(){var t,i,n;for(this.numberOfNodesOfProperGraph=this.intGraph.get_NodeCount(),t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Layered.IntEdge.ctor),i=this.intGraph.get_Edges().GetEnumerator();i.MoveNext();)n=i.get_Current(),this.initialLayering[n.get_Source()]>this.initialLayering[n.get_Target()]&&(this.CreateLayerEdgesUnderIntEdge(n),t.Add(n),this.horizontalConstraints.VerticalInts.Contains$$T(new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,n.get_Source(),n.get_Target()))&&this.verticalEdges.Add(n));return t},CreateLayerEdgesUnderIntEdge:function(n){var r=n.get_Source(),u=n.get_Target(),t=Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.EdgeSpan(this.initialLayering,n),i;if(n.set_LayerEdges(new Array(t)),System.Diagnostics.Debug.Assert$$Boolean(t>0),t==1)n.get_LayerEdges().set_Item$$Int32(0,new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(n.get_Source(),n.get_Target(),n.get_CrossingWeight()));else{for(n.get_LayerEdges().set_Item$$Int32(0,new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(r,this.numberOfNodesOfProperGraph,n.get_CrossingWeight())),i=0;i<t-2;i++)n.get_LayerEdges().set_Item$$Int32(i+1,new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(this.numberOfNodesOfProperGraph++,this.numberOfNodesOfProperGraph,n.get_CrossingWeight()));n.get_LayerEdges().set_Item$$Int32(t-1,new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(this.numberOfNodesOfProperGraph++,u,n.get_CrossingWeight()))}},FillAboveBelow:function(){for(var r=this.verticalEdges.GetEnumerator(),u,n,t,i;r.MoveNext();)for(u=r.get_Current(),n=u.get_LayerEdges().GetEnumerator();n.MoveNext();){var f=n.get_Current(),e=f.get_Source(),o=f.get_Target();this.RegisterAboveBelowOnConstrainedUpperLower(e,o)}for(t=this.horizontalConstraints.VerticalInts.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.RegisterAboveBelowOnConstrainedUpperLower(i.get_Item1(),i.get_Item2())},RegisterAboveBelowOnConstrainedUpperLower:function(n,t){var i=this.GetOrCreateLayerInfo(this.LayerArrays.Y[n]),r=this.GetOrCreateLayerInfo(this.LayerArrays.Y[t]);i.constrainedFromBelow.set_Item$$TKey(n,t);r.constrainedFromAbove.set_Item$$TKey(t,n)},FillFlatEdges:function(){for(var i=this.intGraph.get_Edges().GetEnumerator(),n,t;i.MoveNext();)n=i.get_Current(),t=this.initialLayering[n.get_Source()],t==this.initialLayering[n.get_Target()]&&this.GetOrCreateLayerInfo(t).flatEdges.Insert(new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,n.get_Source(),n.get_Target()))},FillLeftRightPairs:function(){for(var t=this.horizontalConstraints.LeftRighInts.GetEnumerator(),n,i;t.MoveNext();)n=t.get_Current(),i=this.GetOrCreateLayerInfo(this.initialLayering[n.get_Item1()]),i.leftRight.Insert(n)},GetOrCreateLayerInfo:function(n){return this.layerInfos[n]!=null?this.layerInfos[n]:this.layerInfos[n]=new Microsoft.Msagl.Layout.Layered.LayerInfo.ctor},FillBlockRootToBlock:function(){for(var r=this.horizontalConstraints.BlockRootToBlock.GetEnumerator(),n,t,i,u;r.MoveNext();)for(n=r.get_Current(),t=this.GetOrCreateLayerInfo(this.initialLayering[n.get_Key()]),t.neigBlocks.set_Item$$TKey(n.get_Key(),n.get_Value()),i=n.get_Value().GetEnumerator();i.MoveNext();)u=i.get_Current(),t.nodeToBlockRoot.set_Item$$TKey(u,n.get_Key())}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$ConstrainedOrdering);Microsoft$Msagl$Layout$Layered$ConstrainedOrderMeasure={fullname:"Microsoft.Msagl.Layout.Layered.ConstrainedOrderMeasure",baseTypeName:"System.Object",staticDefinition:{op_LessThan:function(n,t){return n.numberOfCrossings<t.numberOfCrossings},op_GreaterThan:function(n,t){return Microsoft.Msagl.Layout.Layered.ConstrainedOrderMeasure.op_LessThan(t,n)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.numberOfCrossings=0;System.Object.ctor.call(this);this.numberOfCrossings=n}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$ConstrainedOrderMeasure);Microsoft$Msagl$Layout$Layered$MetroMapOrdering={fullname:"Microsoft.Msagl.Layout.Layered.MetroMapOrdering",baseTypeName:"System.Object",staticDefinition:{UpdateLayerArrays$$ProperLayeredGraph$$LayerArrays$$Dictionary$2$Int32$Point:function(n,t,i){new Microsoft.Msagl.Layout.Layered.MetroMapOrdering.ctor(n,t,i).UpdateLayerArrays()},UpdateLayerArrays$$ProperLayeredGraph$$LayerArrays:function(n,t){var i=Microsoft.Msagl.Layout.Layered.MetroMapOrdering.BuildInitialNodePositions(n,t);Microsoft.Msagl.Layout.Layered.MetroMapOrdering.UpdateLayerArrays$$ProperLayeredGraph$$LayerArrays$$Dictionary$2$Int32$Point(n,t,i)},BuildInitialNodePositions:function(n,t){for(var u,i,f,e=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor),r=0;r<t.get_Layers().length;r++)for(u=0,i=0;i<t.get_Layers()[r].length;){while(i<t.get_Layers()[r].length&&n.IsVirtualNode(t.get_Layers()[r][i]))i++;for(f=u;f<i;f++)e.set_Item$$TKey(t.get_Layers()[r][f],new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r,u));i<t.get_Layers()[r].length&&e.set_Item$$TKey(t.get_Layers()[r][i],new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r,i));i++;u=i}return e}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.layerArrays=null;this.nodePositions=null;this.properLayeredGraph=null;System.Object.ctor.call(this);this.properLayeredGraph=n;this.layerArrays=t;this.nodePositions=i},UpdateLayerArrays:function(){var n=this.CreateInitialOrdering();n=this.BuildOrdering(n);this.RestoreLayerArrays(n)},CreateInitialOrdering:function(){for(var r,n,t=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Collections.Generic.List$1.ctor),i=0;i<this.layerArrays.get_Layers().length;i++)for(r=0;r<this.layerArrays.get_Layers()[i].length;r++)n=this.layerArrays.get_Layers()[i][r],t.ContainsKey(this.nodePositions.get_Item$$TKey(n))||t.set_Item$$TKey(this.nodePositions.get_Item$$TKey(n),new System.Collections.Generic.List$1.ctor(System.Int32.ctor)),t.get_Item$$TKey(this.nodePositions.get_Item$$TKey(n)).Add(n);return t},BuildOrdering:function(n){for(var i,r,u=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Collections.Generic.List$1.ctor),f=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor),t=0;t<this.layerArrays.get_Layers().length;t++)for(i=0;i<this.layerArrays.get_Layers()[t].length;i++)(r=this.layerArrays.get_Layers()[t][i],u.ContainsKey(this.nodePositions.get_Item$$TKey(r)))||u.set_Item$$TKey(this.nodePositions.get_Item$$TKey(r),this.BuildNodeOrdering(n.get_Item$$TKey(this.nodePositions.get_Item$$TKey(r)),f));return u},BuildNodeOrdering:function(n,t){var r=n,i;for(r.Sort$$Comparison$1(this.Comparison(t)),i=0;i<r.get_Count();i++)t.set_Item$$TKey(r.get_Item$$Int32(i),i);return r},Comparison:function(n){return $CreateAnonymousDelegate(this,function(t,i){var s,h;System.Diagnostics.Debug.Assert$$Boolean(this.properLayeredGraph.IsVirtualNode(t)&&this.properLayeredGraph.IsVirtualNode(i));var o=System.Linq.Enumerable.ElementAt$1(System.Int32.ctor,this.properLayeredGraph.Succ(t),0),c=System.Linq.Enumerable.ElementAt$1(System.Int32.ctor,this.properLayeredGraph.Succ(i),0),r=System.Linq.Enumerable.ElementAt$1(System.Int32.ctor,this.properLayeredGraph.Pred(t),0),u=System.Linq.Enumerable.ElementAt$1(System.Int32.ctor,this.properLayeredGraph.Pred(i),0),l=this.nodePositions.get_Item$$TKey(o),a=this.nodePositions.get_Item$$TKey(c),f=this.nodePositions.get_Item$$TKey(r),e=this.nodePositions.get_Item$$TKey(u);if(Microsoft.Msagl.Core.Geometry.Point.op_Inequality(l,a))return Microsoft.Msagl.Core.Geometry.Point.op_Inequality(f,e)?f.CompareTo(e):l.CompareTo(a);if(this.properLayeredGraph.IsVirtualNode(o))return Microsoft.Msagl.Core.Geometry.Point.op_Inequality(f,e)?f.CompareTo(e):(s=n.get_Item$$TKey(o),h=n.get_Item$$TKey(c),System.Diagnostics.Debug.Assert$$Boolean(s!=-1&&h!=-1),s.CompareTo$$Int32(h));while(Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.nodePositions.get_Item$$TKey(r),this.nodePositions.get_Item$$TKey(u))&&this.properLayeredGraph.IsVirtualNode(r))r=System.Linq.Enumerable.ElementAt$1(System.Int32.ctor,this.properLayeredGraph.Pred(r),0),u=System.Linq.Enumerable.ElementAt$1(System.Int32.ctor,this.properLayeredGraph.Pred(u),0);return Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.nodePositions.get_Item$$TKey(r),this.nodePositions.get_Item$$TKey(u))?t.CompareTo$$Int32(i):this.nodePositions.get_Item$$TKey(r).CompareTo(this.nodePositions.get_Item$$TKey(u))})},RestoreLayerArrays:function(n){for(var u,i,r,t=0;t<this.layerArrays.get_Layers().length;t++)for(u=0,i=0;i<this.layerArrays.get_Layers()[t].length;){while(i<this.layerArrays.get_Layers()[t].length&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.nodePositions.get_Item$$TKey(this.layerArrays.get_Layers()[t][u]),this.nodePositions.get_Item$$TKey(this.layerArrays.get_Layers()[t][i])))i++;for(r=u;r<i;r++)this.layerArrays.get_Layers()[t][r]=n.get_Item$$TKey(this.nodePositions.get_Item$$TKey(this.layerArrays.get_Layers()[t][r])).get_Item$$Int32(r-u);u=i}this.layerArrays.UpdateXFromLayers()}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$MetroMapOrdering);Microsoft$Msagl$Layout$Layered$EdgeComparerBySource={fullname:"Microsoft.Msagl.Layout.Layered.EdgeComparerBySource",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.X=null;System.Object.ctor.call(this);this.X=n},Compare:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"a");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"b");var i=this.X[n.get_Source()]-this.X[t.get_Source()];return i!=0?i:this.X[n.get_Target()]-this.X[t.get_Target()]}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$EdgeComparerBySource);Microsoft$Msagl$Layout$Layered$EdgeComparerByTarget={fullname:"Microsoft.Msagl.Layout.Layered.EdgeComparerByTarget",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.X=null;System.Object.ctor.call(this);this.X=n},Compare:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"a");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"b");var i=this.X[n.get_Target()]-this.X[t.get_Target()];return i!=0?i:this.X[n.get_Source()]-this.X[t.get_Source()]}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$EdgeComparerByTarget);Microsoft$Msagl$Core$ProjectionSolver$ISolverShell={fullname:"Microsoft.Msagl.Core.ProjectionSolver.ISolverShell",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$ISolverShell);Microsoft$Msagl$Layout$Layered$LayerInfo={fullname:"Microsoft.Msagl.Layout.Layered.LayerInfo",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.leftRight=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Tuple$2.ctor);this.flatEdges=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Tuple$2.ctor);this.neigBlocks=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.List$1.ctor);this.constrainedFromAbove=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor);this.constrainedFromBelow=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor);this.nodeToBlockRoot=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor);this.blockRootToVertConstrainedNodeOfBlock=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Int32.ctor);System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$LayerInfo);Microsoft$Msagl$Core$ProjectionSolver$SolverShell={fullname:"Microsoft.Msagl.Core.ProjectionSolver.SolverShell",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.ProjectionSolver.SolverShell.FixedVarWeight=1e9;Microsoft.Msagl.Core.ProjectionSolver.SolverShell.FailToAdjustEpsilon=.001},Close:function(n,t){return System.Math.Abs$$Double(n-t)<.0005}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.ProjectionSolver.ISolverShell"],Kind:"Class",definition:{ctor:function(){this.variables=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,Microsoft.Msagl.Core.ProjectionSolver.Variable.ctor);this.solver=null;this.solution=null;this.fixedVars=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Double.ctor);System.Object.ctor.call(this);this.InitSolver()},AddVariableWithIdealPosition$$Int32$$Double$$Double:function(n,t,i){this.variables.Add(n,this.solver.AddVariable$$Object$$Double$$Double(n,t,i))},AddVariableWithIdealPosition$$Int32$$Double:function(n,t){this.AddVariableWithIdealPosition$$Int32$$Double$$Double(n,t,1)},AddLeftRightSeparationConstraint$$Int32$$Int32$$Double$$Boolean:function(n,t,i,r){var f=this.GetVariable(n),u;f!=null&&(u=this.GetVariable(t),u!=null)&&this.solver.AddConstraint$$Variable$$Variable$$Double$$Boolean(f,u,i,r)},AddLeftRightSeparationConstraint$$Int32$$Int32$$Double:function(n,t,i){this.AddLeftRightSeparationConstraint$$Int32$$Int32$$Double$$Boolean(n,t,i,!1)},AddGoalTwoVariablesAreClose$$Int32$$Int32$$Double:function(n,t,i){var u=this.GetVariable(n),r;u!=null&&(r=this.GetVariable(t),r!=null)&&this.solver.AddNeighborPair(u,r,i)},AddGoalTwoVariablesAreClose$$Int32$$Int32:function(n,t){this.AddGoalTwoVariablesAreClose$$Int32$$Int32$$Double(n,t,1)},GetVariable:function(n){var t;return function(){var i={Value:t},r=this.variables.TryGetValue(n,i);return t=i.Value,r}.call(this)?t:null},Solve:function(){this.Solve$$Object(null)},Solve$$Object:function(n){var t;(function(){var i={Value:t},r=this.Solve$$Object$$Boolean(n,i);return t=i.Value,r}).call(this)},Solve$$Object$$Boolean:function(n,t){var r,i;do{if(this.solution=null,i=null,null!=n&&(i=As(n,Microsoft.Msagl.Core.ProjectionSolver.Parameters.ctor),i==null))throw $CreateException(new System.ArgumentException.ctor$$String("parameters"),new Error);this.solution=this.solver.Solve$$Parameters(i);t.Value=this.solution.get_ExecutionLimitExceeded();r=this.AdjustConstraintsForMovedFixedVars()}while(r&&this.solution.get_ExecutionLimitExceeded()==!1);return this.solution.get_ExecutionLimitExceeded()==!1},AdjustConstraintsForMovedFixedVars:function(){var n=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(System.Int32.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,System.Int32.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,this.fixedVars,$CreateAnonymousDelegate(this,function(n){return!Microsoft.Msagl.Core.ProjectionSolver.SolverShell.Close(n.get_Value(),this.GetVariableResolvedPosition(n.get_Key()))})),$CreateAnonymousDelegate(this,function(n){return n.get_Key()})));return n.get_Count()==0?!1:this.AdjustConstraintsForMovedFixedVarSet(n)},AdjustConstraintsForMovedFixedVarSet:function(n){while(n.get_Count()>0){var t=System.Linq.Enumerable.First$1$$IEnumerable$1(System.Int32.ctor,n);if(!function(){var i={Value:n},r=this.AdjustSubtreeOfFixedVar(t,i);return n=i.Value,r}.call(this))return!1}return!0},AdjustSubtreeOfFixedVar:function(n,t){var i,u=function(){var t={Value:i},r=this.AdjustConstraintsOfNeighborsOfFixedVariable(n,t);return i=t.Value,r}.call(this),r,f;if(!i||!System.Linq.Enumerable.Any$1$$IEnumerable$1(System.Int32.ctor,u))return!1;for(r=u.GetEnumerator();r.MoveNext();)f=r.get_Current(),t.Value.Remove(f);return!0},AdjustConstraintsOfNeighborsOfFixedVariable:function(n,t){for(var u=this.variables.get_Item$$TKey(n).get_Block().get_Variables(),e=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,f=new Microsoft.Msagl.Core.DataStructures.RealNumberSpan.ctor,i=1,o=u.GetEnumerator(),r;o.MoveNext();)(r=o.get_Current(),this.fixedVars.ContainsKey(r.get_UserData()))&&(e.AddValue(r.get_ActualPos()),f.AddValue(r.get_DesiredPos()),f.get_Length()>0&&(i=System.Math.Max$$Double$$Double(i,e.get_Length()/f.get_Length())));return i==1&&(i=2),t.Value=this.FixActiveConstraints(u,i),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.ProjectionSolver.Variable.ctor,System.Int32.ctor,u,$CreateAnonymousDelegate(this,function(n){return n.get_UserData()}))},FixActiveConstraints:function(n,t){for(var r=!1,u=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.ProjectionSolver.Constraint.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.SelectMany$3$$IEnumerable$1$$Func$2$$Func$3(Microsoft.Msagl.Core.ProjectionSolver.Variable.ctor,Microsoft.Msagl.Core.ProjectionSolver.Constraint.ctor,null,n,$CreateAnonymousDelegate(this,function(n){return n.get_LeftConstraints()}),$CreateAnonymousDelegate(this,function(n,t){return $CreateAnonymousObject({v:n,c:t})})),$CreateAnonymousDelegate(this,function(n){return n.get_c().get_IsActive()})),$CreateAnonymousDelegate(this,function(n){return n.get_c()})).GetEnumerator(),i;u.MoveNext();)i=u.get_Current(),i.get_Gap()>.001&&(r=!0),this.solver.SetConstraintUpdate(i,i.get_Gap()/t);return r},GetVariableResolvedPosition:function(n){var t=this.GetVariable(n);return t==null?0:t.get_ActualPos()},InitSolver:function(){this.solver=new Microsoft.Msagl.Core.ProjectionSolver.Solver.ctor;this.variables.Clear()},AddFixedVariable:function(n,t){this.AddVariableWithIdealPosition$$Int32$$Double$$Double(n,t,1e9);this.fixedVars.set_Item$$TKey(n,t)},ContainsVariable:function(n){return this.variables.ContainsKey(n)},GetVariableIdealPosition:function(n){return this.variables.get_Item$$TKey(n).get_DesiredPos()},Solution$$:"System.Object",get_Solution:function(){return this.solution}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$SolverShell);Microsoft$Msagl$Layout$Layered$SweepMode={fullname:"Microsoft.Msagl.Layout.Layered.SweepMode",staticDefinition:{ComingFromBelow:0,ComingFromAbove:1,Starting:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Layout$Layered$SweepMode);Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster={fullname:"Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster",baseTypeName:"Microsoft.Msagl.Core.Geometry.OverlapRemovalNode",staticDefinition:{NumInternalNodes$$:"System.UInt32",get_NumInternalNodes:function(){return 3},DefaultBorderWidth$$:"System.Double",get_DefaultBorderWidth:function(){return.001},CalcBorderWidth:function(n){return n>0?n:Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.get_DefaultBorderWidth()},ProcessClusterHierarchy:function(n,t){var i=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ClusterItem.ctor),r,f,u,e;for(i.Push(new Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ClusterItem.ctor(n));i.get_Count()>0;){if(r=i.Peek(),f=i.get_Count(),!r.ChildrenHaveBeenPushed){for(r.ChildrenHaveBeenPushed=!0,u=r.Cluster.get_Clusters().GetEnumerator();u.MoveNext();)e=u.get_Current(),i.Push(new Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ClusterItem.ctor(e));if(i.get_Count()>f)continue}System.Diagnostics.Debug.Assert$$Boolean$$String(i.Peek()==r,"stack.Peek() should be 'item'");i.Pop();t(r.Cluster)}},GetLeftConstraintNode:function(n){var t=As(n,Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor);return null!=t?t.get_RightBorderNode():n},GetRightConstraintNode:function(n){var t=As(n,Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor);return null!=t?t.get_LeftBorderNode():n}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$UInt32$$OverlapRemovalCluster$$Object$$Double$$Double:function(n,t,i,r,u){this.nodeList=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.ctor);this.clusterList=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor);this._TranslateChildren=!1;this._LeftBorderNode=null;this._RightBorderNode=null;this._IsInSolver=!1;this._OpenBorderInfo=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._CloseBorderInfo=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._OpenBorderInfoP=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._CloseBorderInfoP=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._MinimumSize=0;this._MinimumSizeP=0;this._NodePadding=0;this._NodePaddingP=0;this._ClusterPadding=0;this._ClusterPaddingP=0;this._ParentCluster=null;Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor$$UInt32$$OverlapRemovalCluster$$Object$$Double$$Double$$Double$$Double$$Double$$Double$$BorderInfo$$BorderInfo$$BorderInfo$$BorderInfo.call(this,n,t,i,0,0,r,u,0,0,new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0),new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0),new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0),new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0))},IsEmpty$$:"System.Boolean",get_IsEmpty:function(){return 0==this.nodeList.get_Count()},TranslateChildren$$:"System.Boolean",get_TranslateChildren:function(){return this._TranslateChildren},set_TranslateChildren:function(n){this._TranslateChildren=n},LeftBorderNode$$:"Microsoft.Msagl.Core.Geometry.OverlapRemovalNode",get_LeftBorderNode:function(){return this._LeftBorderNode},set_LeftBorderNode:function(n){this._LeftBorderNode=n},RightBorderNode$$:"Microsoft.Msagl.Core.Geometry.OverlapRemovalNode",get_RightBorderNode:function(){return this._RightBorderNode},set_RightBorderNode:function(n){this._RightBorderNode=n},IsInSolver$$:"System.Boolean",get_IsInSolver:function(){return this._IsInSolver},set_IsInSolver:function(n){this._IsInSolver=n},OpenBorderInfo$$:"Microsoft.Msagl.Core.Geometry.BorderInfo",get_OpenBorderInfo:function(){return this._OpenBorderInfo},set_OpenBorderInfo:function(n){this._OpenBorderInfo=n},CloseBorderInfo$$:"Microsoft.Msagl.Core.Geometry.BorderInfo",get_CloseBorderInfo:function(){return this._CloseBorderInfo},set_CloseBorderInfo:function(n){this._CloseBorderInfo=n},OpenBorderInfoP$$:"Microsoft.Msagl.Core.Geometry.BorderInfo",get_OpenBorderInfoP:function(){return this._OpenBorderInfoP},set_OpenBorderInfoP:function(n){this._OpenBorderInfoP=n},CloseBorderInfoP$$:"Microsoft.Msagl.Core.Geometry.BorderInfo",get_CloseBorderInfoP:function(){return this._CloseBorderInfoP},set_CloseBorderInfoP:function(n){this._CloseBorderInfoP=n},MinimumSize$$:"System.Double",get_MinimumSize:function(){return this._MinimumSize},set_MinimumSize:function(n){this._MinimumSize=n},MinimumSizeP$$:"System.Double",get_MinimumSizeP:function(){return this._MinimumSizeP},set_MinimumSizeP:function(n){this._MinimumSizeP=n},NodePadding$$:"System.Double",get_NodePadding:function(){return this._NodePadding},set_NodePadding:function(n){this._NodePadding=n},NodePaddingP$$:"System.Double",get_NodePaddingP:function(){return this._NodePaddingP},set_NodePaddingP:function(n){this._NodePaddingP=n},ClusterPadding$$:"System.Double",get_ClusterPadding:function(){return this._ClusterPadding},set_ClusterPadding:function(n){this._ClusterPadding=n},ClusterPaddingP$$:"System.Double",get_ClusterPaddingP:function(){return this._ClusterPaddingP},set_ClusterPaddingP:function(n){this._ClusterPaddingP=n},IsRootCluster$$:"System.Boolean",get_IsRootCluster:function(){return null==this.get_ParentCluster()},ParentCluster$$:"Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster",get_ParentCluster:function(){return this._ParentCluster},set_ParentCluster:function(n){this._ParentCluster=n},ctor$$UInt32$$OverlapRemovalCluster$$Object$$Double$$Double$$Double$$Double$$Double$$Double$$BorderInfo$$BorderInfo$$BorderInfo$$BorderInfo:function(n,t,i,r,u,f,e,o,s,h,c,l,a){this.nodeList=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.ctor);this.clusterList=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor);this._TranslateChildren=!1;this._LeftBorderNode=null;this._RightBorderNode=null;this._IsInSolver=!1;this._OpenBorderInfo=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._CloseBorderInfo=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._OpenBorderInfoP=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._CloseBorderInfoP=new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor;this._MinimumSize=0;this._MinimumSizeP=0;this._NodePadding=0;this._NodePaddingP=0;this._ClusterPadding=0;this._ClusterPaddingP=0;this._ParentCluster=null;Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.ctor$$UInt32$$Object.call(this,n,i);this.set_MinimumSize(r);this.set_MinimumSizeP(u);this.set_NodePadding(f);this.set_NodePaddingP(e);this.set_ClusterPadding(o);this.set_ClusterPaddingP(s);this.set_ParentCluster(t);this.set_OpenBorderInfo(h);this.get_OpenBorderInfo().EnsureWeight();this.set_CloseBorderInfo(c);this.get_CloseBorderInfo().EnsureWeight();this.set_OpenBorderInfoP(l);this.get_OpenBorderInfoP().EnsureWeight();this.set_CloseBorderInfoP(a);this.get_CloseBorderInfoP().EnsureWeight();this.CreateBorderNodes()},CreateBorderNodes:function(){if(!this.get_IsRootCluster())this.set_LeftBorderNode(new Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.ctor$$UInt32$$Object(this.get_Id()+1,null)),this.set_RightBorderNode(new Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.ctor$$UInt32$$Object(this.get_Id()+2,null))},Clusters$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster]]",get_Clusters:function(){return this.clusterList},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"Cluster '{0}': id {1} p {2:F5} s {3:F5} pP {4:F5} sP {5:F5}",[this.get_UserDataString(),this.get_Id(),this.get_Position(),this.get_Size(),this.get_PositionP(),this.get_SizeP()])},AddNode:function(n){this.nodeList.Add(n);var t=As(n,Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor);null!=t&&this.clusterList.Add(t)},AddEvents:function(n,t){t.Add(new Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.Event.ctor(!0,n,n.get_OpenP()-this.get_NodePaddingP()/2));t.Add(new Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.Event.ctor(!1,n,n.get_CloseP()+this.get_NodePaddingP()/2))},Generate:function(n,t,i){Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ProcessClusterHierarchy(this,$CreateAnonymousDelegate(this,function(r){r.set_IsInSolver(r.GenerateWorker(n,t,i))}));Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ProcessClusterHierarchy(this,$CreateAnonymousDelegate(this,function(n){n.SqueezeNonFixedBorderPositions()}))},SqueezeNonFixedBorderPositions:function(){if(!this.get_IsEmpty()&&!this.get_IsRootCluster()&&this.get_IsInSolver()){var n=this.get_LeftBorderNode().get_Position(),t=this.get_RightBorderNode().get_Position();this.get_OpenBorderInfo().get_IsFixedPosition()||this.get_LeftBorderNode().get_Variable().set_DesiredPos(t);this.get_CloseBorderInfo().get_IsFixedPosition()||this.get_RightBorderNode().get_Variable().set_DesiredPos(n)}},GenerateWorker:function(n,t,i){var e=function(){var n=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;return n.set_Left(1.79769313486232E+308),n.set_Right(-1.79769313486232E+308),n.set_Bottom(1.79769313486232E+308),n.set_Top(-1.79769313486232E+308),n}.call(this),r,u,f;return this.get_IsEmpty()?!1:(r=function(){var t={Value:e},i=this.CreateEvents(n,t);return e=t.Value,i}.call(this),0==r.get_Count()&&!this.get_TranslateChildren())?!1:(u=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.get_DefaultBorderWidth(),f=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.get_DefaultBorderWidth(),this.get_IsRootCluster()||function(){var t={Value:u},i={Value:f},o=this.CalculateBorderWidths(n,r,e,t,i);return u=t.Value,f=i.Value,o}.call(this),this.GenerateFromEvents(n,t,r,i),this.get_IsRootCluster()||this.AdjustFixedBorderPositions(n,u,f,i),!0)},CreateEvents:function(n,t){for(var i,u,f,e,o=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.Event.ctor),c=this.nodeList.get_Count(),l=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.CalcBorderWidth(this.get_OpenBorderInfo().get_InnerMargin()),a=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.CalcBorderWidth(this.get_CloseBorderInfo().get_InnerMargin()),v=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.CalcBorderWidth(this.get_OpenBorderInfoP().get_InnerMargin()),y=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.CalcBorderWidth(this.get_CloseBorderInfoP().get_InnerMargin()),r=0;r<c;++r){if(i=this.nodeList.get_Item$$Int32(r),u=As(i,Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor),null!=u){if(!u.get_IsInSolver())continue}else i.CreateVariable(n);if(this.AddEvents(i,o),!this.get_IsRootCluster()){var s=i.get_Size()/2+this.get_ClusterPadding(),h=i.get_SizeP()/2+this.get_ClusterPaddingP(),p=i.get_Position()-s-l,w=i.get_Position()+s+a,b=i.get_PositionP()-h-v,k=i.get_PositionP()+h+y;t.Value.set_Left(System.Math.Min$$Double$$Double(t.Value.get_Left(),p));t.Value.set_Right(System.Math.Max$$Double$$Double(t.Value.get_Right(),w));t.Value.set_Bottom(System.Math.Min$$Double$$Double(t.Value.get_Bottom(),b));t.Value.set_Top(System.Math.Max$$Double$$Double(t.Value.get_Top(),k))}}return this.get_IsRootCluster()||(f=this.get_MinimumSize()-t.Value.get_Width(),f>0&&t.Value.PadWidth(f/2),e=this.get_MinimumSizeP()-t.Value.get_Height(),e>0&&t.Value.PadHeight(e/2)),o},CalculateBorderWidths:function(n,t,i,r,u){r.Value=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.CalcBorderWidth(this.get_OpenBorderInfo().get_InnerMargin());u.Value=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.CalcBorderWidth(this.get_CloseBorderInfo().get_InnerMargin());this.set_Size(i.get_Width());this.set_Position(i.get_Center().get_X());this.set_SizeP(i.get_Height());this.set_PositionP(i.get_Center().get_Y());this.get_LeftBorderNode().set_Position(i.get_Left()+r.Value/2);this.get_LeftBorderNode().set_Size(r.Value);this.get_LeftBorderNode().set_Weight(this.get_OpenBorderInfo().get_Weight());this.get_LeftBorderNode().set_PositionP(this.get_PositionP());this.get_LeftBorderNode().set_SizeP(this.get_SizeP());this.get_LeftBorderNode().CreateVariable(n);this.AddEvents(this.get_LeftBorderNode(),t);this.get_RightBorderNode().set_Position(i.get_Right()-u.Value/2);this.get_RightBorderNode().set_Size(u.Value);this.get_RightBorderNode().set_Weight(this.get_CloseBorderInfo().get_Weight());this.get_RightBorderNode().set_PositionP(this.get_PositionP());this.get_RightBorderNode().set_SizeP(this.get_SizeP());this.get_RightBorderNode().CreateVariable(n);this.AddEvents(this.get_RightBorderNode(),t)},AdjustFixedBorderPositions:function(n,t,i,r){var e,u,f;this.get_OpenBorderInfo().get_IsFixedPosition()&&this.get_CloseBorderInfo().get_IsFixedPosition()?(this.get_LeftBorderNode().UpdateDesiredPosition(this.get_OpenBorderInfo().get_FixedPosition()+t/2),this.get_RightBorderNode().UpdateDesiredPosition(this.get_CloseBorderInfo().get_FixedPosition()-i/2),this.set_Size(this.get_CloseBorderInfo().get_FixedPosition()-this.get_OpenBorderInfo().get_FixedPosition()),this.set_Position(this.get_OpenBorderInfo().get_FixedPosition()+this.get_Size()/2)):(this.get_OpenBorderInfo().get_IsFixedPosition()||this.get_CloseBorderInfo().get_IsFixedPosition())&&(this.get_OpenBorderInfo().get_IsFixedPosition()?(this.get_LeftBorderNode().UpdateDesiredPosition(this.get_OpenBorderInfo().get_FixedPosition()+t/2),this.set_Position(this.get_OpenBorderInfo().get_FixedPosition()+this.get_Size()/2)):(this.get_RightBorderNode().UpdateDesiredPosition(this.get_CloseBorderInfo().get_FixedPosition()-i/2),this.set_Position(this.get_CloseBorderInfo().get_FixedPosition()-this.get_Size()/2)));this.get_MinimumSize()>0&&(e=n.AddConstraint$$Variable$$Variable$$Double(this.get_LeftBorderNode().get_Variable(),this.get_RightBorderNode().get_Variable(),this.get_MinimumSize()-t/2-i/2),System.Diagnostics.Debug.Assert$$Boolean$$String(null!=e,"Minimum Cluster size: unexpected null cst"));(this.get_OpenBorderInfoP().get_IsFixedPosition()||this.get_CloseBorderInfoP().get_IsFixedPosition())&&(this.get_OpenBorderInfoP().get_IsFixedPosition()&&this.get_CloseBorderInfoP().get_IsFixedPosition()?(this.set_SizeP(this.get_CloseBorderInfoP().get_FixedPosition()-this.get_OpenBorderInfoP().get_FixedPosition()),this.set_PositionP(this.get_OpenBorderInfoP().get_FixedPosition()+this.get_SizeP()/2),this.get_SizeP()<0&&this.set_SizeP(-this.get_SizeP())):(u=this.get_PositionP()-this.get_SizeP()/2,f=this.get_PositionP()+this.get_SizeP()/2,this.get_OpenBorderInfoP().get_IsFixedPosition()?r?this.set_PositionP(this.get_PositionP()+this.get_OpenBorderInfoP().get_FixedPosition()-u):(this.set_SizeP(f-this.get_OpenBorderInfoP().get_FixedPosition()),this.set_PositionP(this.get_OpenBorderInfoP().get_FixedPosition()+this.get_SizeP()/2)):r?this.set_PositionP(this.get_PositionP()+this.get_CloseBorderInfoP().get_FixedPosition()-f):(this.set_SizeP(this.get_CloseBorderInfoP().get_FixedPosition()-u),this.set_PositionP(u+this.get_SizeP()/2))),this.get_LeftBorderNode().set_PositionP(this.get_PositionP()),this.get_LeftBorderNode().set_SizeP(this.get_SizeP()),this.get_RightBorderNode().set_PositionP(this.get_PositionP()),this.get_RightBorderNode().set_SizeP(this.get_SizeP()))},GenerateFromEvents:function(n,t,i,r){var c,b,k,u,d,g,s,l,y,e,tt,f,nt,o,p,h,w;for(i.Sort(),c=new Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ScanLine.ctor,b=i.GetEnumerator();b.MoveNext();)if(k=b.get_Current(),u=k.get_Node(),k.get_IsForOpen()){for(c.Insert(u),u.set_LeftNeighbors(this.GetLeftNeighbours(t,c,u,r)),u.set_RightNeighbors(this.GetRightNeighbours(t,c,u,r)),d=u.get_LeftNeighbors().get_Count(),g=u.get_RightNeighbors().get_Count(),f=0;f<d;++f){for(e=u.get_LeftNeighbors().get_Item$$Int32(f),s=0;s<g;++s)l=u.get_RightNeighbors().get_Item$$Int32(s),e.get_RightNeighbors().Remove(l);e.get_RightNeighbors().Add(u)}for(f=0;f<g;++f){for(o=u.get_RightNeighbors().get_Item$$Int32(f),s=0;s<d;++s)l=u.get_LeftNeighbors().get_Item$$Int32(s),o.get_LeftNeighbors().Remove(l);o.get_LeftNeighbors().Add(u)}}else{if(null==u.get_LeftNeighbors()){System.Diagnostics.Debug.Assert$$Boolean$$String(null!=u.get_LeftNeighbors(),"LeftNeighbors should not be null for a Close event");continue}var a=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.GetLeftConstraintNode(u),v=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.GetRightConstraintNode(u),it=u.get_LeftNeighbors().get_Count();for(f=0;f<it;++f)y=u.get_LeftNeighbors().get_Item$$Int32(f),y.get_RightNeighbors().Remove(u),e=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.GetLeftConstraintNode(y),System.Diagnostics.Debug.Assert$$Boolean$$String(e.get_OpenP()==y.get_OpenP(),"leftNeighborNode.OpenP must == origLeftNeighborNode.OpenP"),System.Diagnostics.Debug.Assert$$Boolean$$String(r||u.get_CloseP()+this.get_NodePaddingP()-e.get_OpenP()>t.get_SolverParameters().get_GapTolerance()-1e-6,"LeftNeighbors: unexpected close/open overlap"),p=e==this.get_LeftBorderNode()||v==this.get_RightBorderNode()?this.get_ClusterPadding():this.get_NodePadding(),h=(e.get_Size()+v.get_Size())/2+p,this.get_TranslateChildren()&&(h=System.Math.Max$$Double$$Double(h,v.get_Position()-e.get_Position())),w=n.AddConstraint$$Variable$$Variable$$Double(e.get_Variable(),v.get_Variable(),h),System.Diagnostics.Debug.Assert$$Boolean$$String(null!=w,"LeftNeighbors: unexpected null cst");for(tt=u.get_RightNeighbors().get_Count(),f=0;f<tt;++f)nt=u.get_RightNeighbors().get_Item$$Int32(f),nt.get_LeftNeighbors().Remove(u),o=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.GetRightConstraintNode(nt),System.Diagnostics.Debug.Assert$$Boolean$$String(r||u.get_CloseP()+this.get_NodePaddingP()-o.get_OpenP()>t.get_SolverParameters().get_GapTolerance()-1e-6,"RightNeighbors: unexpected close/open overlap"),p=a==this.get_LeftBorderNode()||o==this.get_RightBorderNode()?this.get_ClusterPadding():this.get_NodePadding(),h=(a.get_Size()+o.get_Size())/2+p,this.get_TranslateChildren()&&(h=System.Math.Max$$Double$$Double(h,o.get_Position()-a.get_Position())),w=n.AddConstraint$$Variable$$Variable$$Double(a.get_Variable(),o.get_Variable(),h),System.Diagnostics.Debug.Assert$$Boolean$$String(null!=w,"RightNeighbors: unexpected null cst");c.Remove(u)}},GetLeftNeighbours:function(n,t,i,r){for(var f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.ctor),u=t.NextLeft(i);null!=u;u=t.NextLeft(u))if(!this.AddNeighbour(n,i,u,f,!0,r)&&!u.get_DeferredLeftNeighborToV())break;return f},GetRightNeighbours:function(n,t,i,r){for(var f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.ctor),u=t.NextRight(i);null!=u;u=t.NextRight(u))if(!this.AddNeighbour(n,i,u,f,!1,r)&&!u.get_DeferredRightNeighborToV())break;return f},AddNeighbour:function(n,t,i,r,u,f){var e,o,s;if(System.Diagnostics.Debug.Assert$$Boolean$$String(t!=(u?this.get_LeftBorderNode():this.get_RightBorderNode()),"currentNode must != BorderNode"),e=Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.Overlap(t,i,this.get_NodePadding()),e<=0)return!f&&Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.OverlapP(t,i,this.get_NodePaddingP())<=n.get_SolverParameters().get_GapTolerance()?!0:(r.Add(i),!1);if(f){if(n.get_AllowDeferToVertical()&&(o=Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.OverlapP(t,i,this.get_NodePaddingP()),s=n.get_ConsiderProportionalOverlap()?e/(t.get_Size()+i.get_Size())>o/(t.get_SizeP()+i.get_SizeP()):e>o,s&&t!=this.get_LeftBorderNode()&&t!=this.get_RightBorderNode()&&i!=this.get_LeftBorderNode()&&i!=this.get_RightBorderNode()))return u?(t.set_DeferredLeftNeighborToV(!0),i.set_DeferredRightNeighborToV(!0)):(t.set_DeferredRightNeighborToV(!0),i.set_DeferredLeftNeighborToV(!0)),!0}else if(Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.OverlapP(t,i,this.get_NodePaddingP())<=n.get_SolverParameters().get_GapTolerance())return!0;return r.Add(i),!0},UpdateFromVariable:function(){Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ProcessClusterHierarchy(this,$CreateAnonymousDelegate(this,function(n){n.UpdateFromVariableWorker()}))},UpdateFromVariableWorker:function(){var t,r,u,n,i;if(!this.get_IsRootCluster()){if(this.get_IsEmpty()||null==this.get_LeftBorderNode().get_Variable())return;this.get_LeftBorderNode().UpdateFromVariable();this.get_RightBorderNode().UpdateFromVariable();t=this.get_LeftBorderNode().get_Position()-this.get_LeftBorderNode().get_Size()/2;r=this.get_RightBorderNode().get_Position()+this.get_RightBorderNode().get_Size()/2;this.set_Size(r-t);this.set_Position(t+this.get_Size()/2)}for(u=this.nodeList.get_Count(),n=0;n<u;++n)i=this.nodeList.get_Item$$Int32(n),Is(i,Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor)||i.UpdateFromVariable()}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster);Microsoft$Msagl$Core$Geometry$OverlapRemovalGlobalConfiguration={fullname:"Microsoft.Msagl.Core.Geometry.OverlapRemovalGlobalConfiguration",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Geometry.OverlapRemovalGlobalConfiguration.ClusterDefaultFreeWeight=1e-6;Microsoft.Msagl.Core.Geometry.OverlapRemovalGlobalConfiguration.ClusterDefaultFixedWeight=1e8;Microsoft.Msagl.Core.Geometry.OverlapRemovalGlobalConfiguration.ClusterDefaultBorderWidth=.001;Microsoft.Msagl.Core.Geometry.OverlapRemovalGlobalConfiguration.EventComparisonEpsilon=1e-6}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OverlapRemovalGlobalConfiguration);Microsoft$Msagl$Core$Geometry$OverlapRemovalParameters={fullname:"Microsoft.Msagl.Core.Geometry.OverlapRemovalParameters",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.ICloneable"],Kind:"Class",definition:{ctor:function(){this._AllowDeferToVertical=!1;this._ConsiderProportionalOverlap=!1;this._SolverParameters=null;Microsoft.Msagl.Core.Geometry.OverlapRemovalParameters.ctor$$Parameters.call(this,new Microsoft.Msagl.Core.ProjectionSolver.Parameters.ctor)},AllowDeferToVertical$$:"System.Boolean",get_AllowDeferToVertical:function(){return this._AllowDeferToVertical},set_AllowDeferToVertical:function(n){this._AllowDeferToVertical=n},ConsiderProportionalOverlap$$:"System.Boolean",get_ConsiderProportionalOverlap:function(){return this._ConsiderProportionalOverlap},set_ConsiderProportionalOverlap:function(n){this._ConsiderProportionalOverlap=n},SolverParameters$$:"Microsoft.Msagl.Core.ProjectionSolver.Parameters",get_SolverParameters:function(){return this._SolverParameters},set_SolverParameters:function(n){this._SolverParameters=n},ctor$$Parameters:function(n){this._AllowDeferToVertical=!1;this._ConsiderProportionalOverlap=!1;this._SolverParameters=null;System.Object.ctor.call(this);this.set_SolverParameters(n);this.set_AllowDeferToVertical(!0)},ctor$$Boolean$$Parameters:function(n,t){this._AllowDeferToVertical=!1;this._ConsiderProportionalOverlap=!1;this._SolverParameters=null;System.Object.ctor.call(this);this.set_AllowDeferToVertical(n);this.set_SolverParameters(t)},Clone:function(){var n=Cast(this.MemberwiseClone(),Microsoft.Msagl.Core.Geometry.OverlapRemovalParameters.ctor);return n.set_SolverParameters(Cast(this.get_SolverParameters().Clone(),Microsoft.Msagl.Core.ProjectionSolver.Parameters.ctor)),n}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OverlapRemovalParameters);Microsoft$Msagl$DebugHelpers$ClusterWithChildLists={fullname:"Microsoft.Msagl.DebugHelpers.ClusterWithChildLists",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.ChildClusters=new System.Collections.Generic.List$1.ctor(System.String.ctor);this.ChildNodes=new System.Collections.Generic.List$1.ctor(System.String.ctor);this.Cluster=null;System.Object.ctor.call(this);this.Cluster=n}}};JsTypes.push(Microsoft$Msagl$DebugHelpers$ClusterWithChildLists);Microsoft$Msagl$DebugHelpers$GeometryToken={fullname:"Microsoft.Msagl.DebugHelpers.GeometryToken",staticDefinition:{Clusters:0,Force:1,Barycenter:2,Cluster:3,Width:4,Height:5,Label:6,MsaglGeometryGraph:7,Header:8,AspectRatio:9,Transform:10,TransformElement:11,NodeSeparation:12,LayerSeparation:13,Margins:14,MinNodeHeight:15,MinNodeWidth:16,Nodes:17,Edges:18,Node:19,Edge:20,Id:21,Padding:22,ICurve:23,Ellipse:24,Curve:25,LineSegment:26,CubicBezierSegment:27,AxisA:28,AxisB:29,Center:30,Point:31,XCoordinate:32,YCoordinate:33,SourceNodeId:34,TargetNodeId:35,LabelWidth:36,LabelHeight:37,LabelCenter:38,LineWidth:39,ArrowheadAtSource:40,ArrowheadPosition:41,ArrowheadAtTarget:42,Weight:43,Separation:44,Start:45,End:46,B0:47,B1:48,B2:49,B3:50,UnderlyingPolyline:51,UnderlyingPolylineIsNull:52,PolylineSite:53,SiteK:54,SiteV:55,ParStart:56,ParEnd:57,Reporting:58,RandomSeedForOrdering:59,NoGainStepsBound:60,MaxNumberOfPassesInOrdering:61,Demotion:62,GroupSplit:63,LabelCornersPreserveCoefficient:64,SplineCalculationDuration:65,BrandesThreshold:66,LayoutAlgorithmSettings:67,SugiyamaLayoutSettings:68,MdsLayoutSettings:69,RankingLayoutSetting:70,LayoutAlgorithmType:71,RepetitionCoefficientForOrdering:72,Exponent:73,IterationsWithMajorization:74,PivotNumber:75,RotationAngle:76,ScaleX:77,ScaleY:78,OmegaX:79,OmegaY:80,EdgeRoutingMode:81,UseSparseVisibilityGraph:82,UseKdHull:83,ClusterIndex:84,ChildClusters:85,ChildNodes:86,RectangularBoundary:87,Polyline:88,Closed:89,PolylinePoints:90,CurveData:91,Cx:92,Cy:93,Ry:94,Rx:95,ArrowheadPositionAtSource:96,ArrowheadPositionAtTarget:97,Polygon:98,MsaglGeometryFile:99,Error:100,Rect:101,X:102,Y:103,Points:104,T:105,S:106,As:107,At:108,Graph:109,Asl:110,Atl:111,RectangularClusterBoundary:112,RightBorderInfo:113,LeftBorderInfo:114,BottomBorderInfo:115,TopBorderInfo:116,LeftMargin:117,RightMargin:118,BottomMargin:119,TopMargin:120,GenerateFixedConstraints:121,GenerateFixedConstraintsDefault:122,DefaultBottomMargin:123,DefaultTopMargin:124,DefaultRightMargin:125,DefaultLeftMargin:126,InnerMargin:127,FixedPosition:128,LgData:129,SortedLgInfos:130,LgNodeInfo:131,Rail:132,LgLevels:133,LgNodeInfos:134,Rank:135,Level:136,NodeCountOnLevel:137,Rails:138,Arrowhead:139,CurveAttachmentPoint:140,RailsPerEdge:141,EdgeRails:142,RailId:143,EdgeId:144,LgEdgeInfos:145,LgEdgeInfo:146,Zoomlevel:147,SkeletonLevel:148,LgSkeletonLevels:149,MinPassingEdgeZoomLevel:150,LabelVisibleFromScale:151,LabelOffset:152,LabelWidthToHeightRatio:153,Unknown:154},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$DebugHelpers$GeometryToken);Microsoft$Msagl$Layout$Layered$ProperLayeredGraph={fullname:"Microsoft.Msagl.Layout.Layered.ProperLayeredGraph",baseTypeName:"System.Object",staticDefinition:{ExistVirtualNodes:function(n){for(var i=n.GetEnumerator(),t;i.MoveNext();)if(t=i.get_Current(),t.get_LayerEdges()!=null&&t.get_LayerEdges().get_Count()>1)return!0;return!1},LastEdge:function(n){return n.get_LayerEdges().get_Item$$Int32(n.get_LayerEdges().get_Count()-1)},FirstEdge:function(n){return n.get_LayerEdges().get_Item$$Int32(0)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.BaseGraph=null;this.virtualNodesToInEdges=null;this.virtualNodesToOutEdges=null;this.totalNumberOfNodes=0;this.firstVirtualNode=0;System.Object.ctor.call(this);this.Initialize(n)},FirstVirtualNode$$:"System.Int32",get_FirstVirtualNode:function(){return this.firstVirtualNode},Initialize:function(n){var r,u,i,f,t;for(this.BaseGraph=n,this.BaseGraph.get_Edges().get_Count()>0?(r=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.BaseGraph.get_Edges(),$CreateAnonymousDelegate(this,function(n){return n.get_LayerEdges()!=null})),this.totalNumberOfNodes=System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,r)?System.Linq.Enumerable.Max$$IEnumerable$1$Int32(System.Linq.Enumerable.SelectMany$3$$IEnumerable$1$$Func$2$$Func$3(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,Microsoft.Msagl.Layout.Layered.LayerEdge.ctor,System.Int32.ctor,r,$CreateAnonymousDelegate(this,function(n){return n.get_LayerEdges()}),$CreateAnonymousDelegate(this,function(n,t){return System.Math.Max$$Int32$$Int32(t.get_Source(),t.get_Target())+1}))):n.get_NodeCount()):this.totalNumberOfNodes=n.get_NodeCount(),Microsoft.Msagl.Layout.Layered.ProperLayeredGraph.ExistVirtualNodes(this.BaseGraph.get_Edges())?this.firstVirtualNode=System.Linq.Enumerable.Min$$IEnumerable$1$Int32(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,System.Int32.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,null,System.Linq.Enumerable.SelectMany$3$$IEnumerable$1$$Func$2$$Func$3(null,Microsoft.Msagl.Layout.Layered.LayerEdge.ctor,null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,null,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.BaseGraph.get_Edges(),$CreateAnonymousDelegate(this,function(n){return n.get_LayerEdges()!=null&&n.get_LayerEdges().get_Count()>1})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({edge:n,source:n.get_Source()})})),$CreateAnonymousDelegate(this,function(n){return n.get_edge().get_LayerEdges()}),$CreateAnonymousDelegate(this,function(n,t){return $CreateAnonymousObject({x1:n,layerEdge:t})})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({x2:n,layerEdgeSource:n.get_layerEdge().get_Source()})})),$CreateAnonymousDelegate(this,function(n){return n.get_x2().get_layerEdge().get_Source()!=n.get_x2().get_x1().get_source()})),$CreateAnonymousDelegate(this,function(n){return n.get_layerEdgeSource()}))):(this.firstVirtualNode=this.BaseGraph.get_NodeCount(),this.totalNumberOfNodes=this.BaseGraph.get_NodeCount()),this.virtualNodesToInEdges=new Array(this.totalNumberOfNodes-this.get_FirstVirtualNode()),this.virtualNodesToOutEdges=new Array(this.totalNumberOfNodes-this.get_FirstVirtualNode()),u=this.BaseGraph.get_Edges().GetEnumerator();u.MoveNext();)if(i=u.get_Current(),i.get_LayerSpan()>0)for(f=i.get_LayerEdges().GetEnumerator();f.MoveNext();)t=f.get_Current(),t.get_Target()!=i.get_Target()&&(this.virtualNodesToInEdges[t.get_Target()-this.get_FirstVirtualNode()]=t),t.get_Source()!=i.get_Source()&&(this.virtualNodesToOutEdges[t.get_Source()-this.get_FirstVirtualNode()]=t)},Edges$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Layout.Layered.LayerEdge]]",get_Edges:function(){for(var i=[],r=this.BaseGraph.get_Edges().GetEnumerator(),n,t,u;r.MoveNext();)if(n=r.get_Current(),n.get_LayerSpan()>0)for(t=n.get_LayerEdges().GetEnumerator();t.MoveNext();)u=t.get_Current(),i.push(u);return i},InEdges:function(n){var i=[],r,t;if(n<this.BaseGraph.get_NodeCount())for(r=this.BaseGraph.InEdges(n).GetEnumerator();r.MoveNext();)t=r.get_Current(),t.get_Source()!=t.get_Target()&&t.get_LayerEdges()!=null&&i.push(Microsoft.Msagl.Layout.Layered.ProperLayeredGraph.LastEdge(t));else n>=this.firstVirtualNode&&i.push(this.InEdgeOfVirtualNode(n));return i},InEdgeOfVirtualNode:function(n){return this.virtualNodesToInEdges[n-this.get_FirstVirtualNode()]},OutEdges:function(n){var i=[],r,t;if(n<this.BaseGraph.get_NodeCount())for(r=this.BaseGraph.OutEdges(n).GetEnumerator();r.MoveNext();)t=r.get_Current(),t.get_Source()!=t.get_Target()&&t.get_LayerEdges()!=null&&i.push(Microsoft.Msagl.Layout.Layered.ProperLayeredGraph.FirstEdge(t));else n>=this.get_FirstVirtualNode()&&i.push(this.OutEdgeOfVirtualNode(n));return i},OutEdgeOfVirtualNode:function(n){return this.virtualNodesToOutEdges[n-this.get_FirstVirtualNode()]},InEdgesCount:function(n){return this.RealInEdgesCount(n)},RealInEdgesCount:function(n){return n<this.BaseGraph.get_NodeCount()?System.Linq.Enumerable.Count$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.BaseGraph.InEdges(n),$CreateAnonymousDelegate(this,function(n){return n.get_LayerEdges()!=null})):1},OutEdgesCount:function(n){return this.RealOutEdgesCount(n)},RealOutEdgesCount:function(n){return n<this.BaseGraph.get_NodeCount()?System.Linq.Enumerable.Count$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.BaseGraph.OutEdges(n),$CreateAnonymousDelegate(this,function(n){return n.get_LayerEdges()!=null})):1},NodeCount$$:"System.Int32",get_NodeCount:function(){return this.totalNumberOfNodes},IsRealNode:function(n){return n<this.BaseGraph.get_NodeCount()},IsVirtualNode:function(n){return!this.IsRealNode(n)},ReversedClone:function(){var n=this.CreateReversedEdges();return new Microsoft.Msagl.Layout.Layered.ProperLayeredGraph.ctor(new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$2.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,n,this.BaseGraph.get_NodeCount()))},CreateReversedEdges:function(){for(var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Layered.IntEdge.ctor),i=this.BaseGraph.get_Edges().GetEnumerator(),n;i.MoveNext();)n=i.get_Current(),n.SelfEdge()||t.Add(n.ReversedClone());return t},Succ:function(n){for(var t=[],i=this.OutEdges(n).GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.push(r.get_Target());return t},Pred:function(n){for(var t=[],i=this.InEdges(n).GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.push(r.get_Source());return t}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$ProperLayeredGraph);Microsoft$Msagl$Layout$Layered$LayerCalculator={fullname:"Microsoft.Msagl.Layout.Layered.LayerCalculator",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Layout$Layered$LayerCalculator);Microsoft$Msagl$Core$GraphAlgorithms$TopologicalSort={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.TopologicalSort",baseTypeName:"System.Object",staticDefinition:{GetOrder$1:function(n,t){for(var i,e,f=new Array(t.get_NodeCount()),o=new System.Collections.Generic.Stack$1.ctor(System.Int32.ctor),h=new System.Collections.Generic.Stack$1.ctor(System.Collections.Generic.IEnumerator$1.ctor),s=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),r,u=0;u<t.get_NodeCount();u++)if(!f[u]){i=u;f[i]=!0;r=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(n,System.Int32.ctor,t.OutEdges(u),function(n){return n.get_Target()}).GetEnumerator();do{while(r.MoveNext())e=r.get_Current(),f[e]||(f[e]=!0,o.Push(i),h.Push(r),i=e,r=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(n,System.Int32.ctor,t.OutEdges(i),function(n){return n.get_Target()}).GetEnumerator());if(s.Add(i),o.get_Count()>0)r=h.Pop(),i=o.Pop();else break}while(1)}return s.Reverse(),s.ToArray()},GetOrderOnEdges$1:function(n,t){for(var i=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Boolean.ctor),s=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Collections.Generic.List$1.ctor),w=t.GetEnumerator(),o,v,f,a,e,r;w.MoveNext();)o=w.get_Current(),i.set_Item$$TKey(o.get_Source(),function(n){return i.set_Item$$TKey(o.get_Target(),n),n}(!1)),v=o.get_Source(),function(){var n={Value:r},t=s.TryGetValue(v,n);return r=n.Value,t}()||s.set_Item$$TKey(v,r=new System.Collections.Generic.List$1.ctor(System.Int32.ctor)),r.Add(o.get_Target());for(var y=new System.Collections.Generic.Stack$1.ctor(System.Int32.ctor),b=new System.Collections.Generic.Stack$1.ctor(System.Collections.Generic.IEnumerator$1.ctor),h=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),u,c=0,p=System.Linq.Enumerable.ToArray$1(System.Int32.ctor,i.get_Keys()),k=p.length,l=p[c];c<k;c++,l=p[c])if(!i.get_Item$$TKey(l)&&(f=l,i.set_Item$$TKey(f,!0),function(){var n={Value:a},t=s.TryGetValue(l,n);return a=n.Value,t}())&&a!=null){u=a.GetEnumerator();do{while(u.MoveNext())if(e=u.get_Current(),!i.get_Item$$TKey(e)){if(i.set_Item$$TKey(e,!0),!function(){var n={Value:r},t=s.TryGetValue(e,n);return r=n.Value,t}()){h.Add(e);continue}y.Push(f);b.Push(u);f=e;u=r.GetEnumerator()}if(h.Add(f),y.get_Count()>0)u=b.Pop(),f=y.Pop();else break}while(1)}return h.Reverse(),h.ToArray()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$TopologicalSort);Microsoft$Msagl$Layout$Layered$LongestPathLayering={fullname:"Microsoft.Msagl.Layout.Layered.LongestPathLayering",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.Layered.LayerCalculator"],Kind:"Class",definition:{ctor:function(n){this.graph=null;System.Object.ctor.call(this);this.graph=n},GetLayers:function(){for(var o=Microsoft.Msagl.Layout.Layered.IntEdge.GetOrder(this.graph),n=new Int32Array(this.graph.get_NodeCount()),r=this.graph.get_NodeCount(),t,i;r-->0;)for(t=o[r],i=this.graph.InEdges(t).GetEnumerator();i.MoveNext();){var u=i.get_Current(),f=u.get_Source(),e=n[t]+u.get_Separation();n[f]<e&&(n[f]=e)}return n}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$LongestPathLayering);Microsoft$Msagl$Layout$Layered$NetworkSimplex={fullname:"Microsoft.Msagl.Layout.Layered.NetworkSimplex",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},CreateGraphWithIEEdges:function(n){for(var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Layered.IntEdge.ctor),i=n.get_Edges().GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.Add(new Microsoft.Msagl.Layout.Layered.NetworkEdge.ctor(r));return new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,t,n.get_NodeCount())}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Layout.Layered.LayerCalculator"],Kind:"Class",definition:{ctor:function(n,t){this.layers=null;this.lim=null;this.low=null;this.parent=null;this.leaves=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);this.treeVertices=new System.Collections.Generic.List$1.ctor(System.Int32.ctor);this.inTree=null;this.random=new System.Random.ctor$$Int32(1);this.graph=null;this.NetworkCancelToken=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.graph=Microsoft.Msagl.Layout.Layered.NetworkSimplex.CreateGraphWithIEEdges(n);this.inTree=new Array(n.get_NodeCount());this.NetworkCancelToken=t},GetLayers:function(){return this.layers==null&&this.Run$$CancelToken(this.NetworkCancelToken),this.layers},ShiftLayerToZero:function(){for(var i=2147483647,t=0,r=this.layers,u=r.length,n=r[t];t<u;t++,n=r[t])n<i&&(i=n);for(n=0;n<this.graph.get_NodeCount();n++)this.layers[n]-=i},FeasibleTree:function(){var t,n,i,r;for(this.InitLayer();this.TightTree()<this.graph.get_NodeCount();){if(t=this.GetNonTreeEdgeIncidentToTheTreeWithMinimalAmountOfSlack(),t==null)break;if(n=this.Slack(t),n==0)throw $CreateException(new System.InvalidOperationException.ctor,new Error);for(this.inTree[t.get_Source()]&&(n=-n),i=this.treeVertices.GetEnumerator();i.MoveNext();)r=i.get_Current(),this.layers[r]+=n}this.InitCutValues()},VertexSourceTargetVal:function(n,t){var i=t.get_Source(),r=t.get_Target();return this.lim[i]>this.lim[r]?this.lim[n]<=this.lim[r]&&this.low[r]<=this.lim[n]?0:1:this.lim[n]<=this.lim[i]&&this.low[i]<=this.lim[n]?1:0},IncidentEdges:function(n){return new Microsoft.Msagl.Layout.Layered.NetworkSimplex.IncEdges.ctor(n,this)},AllLowCutsHaveBeenDone:function(n){for(var i=this.IncidentEdges(n).GetEnumerator(),t;i.MoveNext();)if(t=i.get_Current(),t.inTree&&t.get_Cut()==2147483647&&t!=this.parent[n])return!1;return!0},EdgeSourceTargetVal:function(n,t){return this.VertexSourceTargetVal(n.get_Source(),t)-this.VertexSourceTargetVal(n.get_Target(),t)},InitCutValues:function(){var i,e,c,f,r,n,u,o,t,s,l,a,h,v;for(this.InitLimLowAndParent(),i=new System.Collections.Generic.Stack$1.ctor(System.Int32.ctor),e=this.leaves.GetEnumerator();e.MoveNext();)c=e.get_Current(),i.Push(c);for(f=new System.Collections.Generic.Stack$1.ctor(System.Int32.ctor);i.get_Count()>0;){while(i.get_Count()>0)if(r=i.Pop(),n=this.parent[r],n!=null){for(u=0,o=this.IncidentEdges(r).GetEnumerator();o.MoveNext();)t=o.get_Current(),t.inTree==!1?(s=this.EdgeSourceTargetVal(t,n),s!=0&&(u+=s*t.get_Weight())):t==n?u+=t.get_Weight():(l=n.get_Source()==t.get_Target()||n.get_Target()==t.get_Source()?1:-1,a=this.EdgeContribution(t,r),u+=a*l);n.set_Cut(u);h=n.get_Source()==r?n.get_Target():n.get_Source();this.AllLowCutsHaveBeenDone(h)&&f.Push(h)}v=i;i=f;f=v}},EdgeContribution:function(n,t){for(var r=n.get_Cut()-n.get_Weight(),f=this.IncidentEdges(t).GetEnumerator(),i,u;f.MoveNext();)i=f.get_Current(),i.inTree==!1&&(u=this.EdgeSourceTargetVal(i,n),u==-1?r+=i.get_Weight():u==1&&(r-=i.get_Weight()));return r},InitLimLowAndParent:function(){this.lim=new Int32Array(this.graph.get_NodeCount());this.low=new Int32Array(this.graph.get_NodeCount());this.parent=new Array(this.graph.get_NodeCount());var n=1,t=0;(function(){var i={Value:n},r={Value:t},u=this.InitLowLimParentAndLeavesOnSubtree(i,r);return n=i.Value,t=r.Value,u}).call(this)},InitLowLimParentAndLeavesOnSubtree:function(n,t){var f=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Layout.Layered.NetworkSimplex.StackStruct.ctor),r=this.graph.OutEdges(t.Value).GetEnumerator(),u=this.graph.InEdges(t.Value).GetEnumerator(),e,o,i;for(f.Push(new Microsoft.Msagl.Layout.Layered.NetworkSimplex.StackStruct.ctor$$Int32$$IEnumerator$$IEnumerator(t.Value,r,u)),this.low[t.Value]=n.Value;f.get_Count()>0;){e=f.Pop();t.Value=e.v;r=e.outEnum;u=e.inEnum;this.ProgressStep();do{for(o=!0;r.MoveNext();)(i=As(r.get_Current(),Microsoft.Msagl.Layout.Layered.NetworkEdge.ctor),!i.inTree||this.low[i.get_Target()]>0)||(f.Push(new Microsoft.Msagl.Layout.Layered.NetworkSimplex.StackStruct.ctor$$Int32$$IEnumerator$$IEnumerator(t.Value,r,u)),t.Value=i.get_Target(),this.parent[t.Value]=i,this.low[t.Value]=n.Value,r=this.graph.OutEdges(t.Value).GetEnumerator(),u=this.graph.InEdges(t.Value).GetEnumerator());while(u.MoveNext())if(i=As(u.get_Current(),Microsoft.Msagl.Layout.Layered.NetworkEdge.ctor),i.inTree&&!(this.low[i.get_Source()]>0)){f.Push(new Microsoft.Msagl.Layout.Layered.NetworkSimplex.StackStruct.ctor$$Int32$$IEnumerator$$IEnumerator(t.Value,r,u));t.Value=i.get_Source();this.low[t.Value]=n.Value;this.parent[t.Value]=i;r=this.graph.OutEdges(t.Value).GetEnumerator();u=this.graph.InEdges(t.Value).GetEnumerator();o=!1;break}}while(!o);this.lim[t.Value]=n.Value++;this.lim[t.Value]==this.low[t.Value]&&this.leaves.Add(t.Value)}},UpdateLimLowLeavesAndParentsUnderNode:function(n){var i=this.low[n],u=this.lim[n],t,r;for(this.leaves.Clear(),t=0;t<this.graph.get_NodeCount();t++)i<=this.lim[t]&&this.lim[t]<=u?this.low[t]=0:this.low[t]==this.lim[t]&&this.leaves.Add(t);r=n,function(){var n={Value:i},t={Value:r},u=this.InitLowLimParentAndLeavesOnSubtree(n,t);return i=n.Value,r=t.Value,u}.call(this)},Slack:function(n){return this.layers[n.get_Source()]-this.layers[n.get_Target()]-n.get_Separation()},GetNonTreeEdgeIncidentToTheTreeWithMinimalAmountOfSlack:function(){for(var r=null,i=2147483647,o=this.treeVertices.GetEnumerator(),u,f,e,n,t;o.MoveNext();){for(u=o.get_Current(),f=this.graph.OutEdges(u).GetEnumerator();f.MoveNext();)if((n=f.get_Current(),!this.inTree[n.get_Source()]||!this.inTree[n.get_Target()])&&(t=this.Slack(n),t<i&&(r=n,i=t,t==1)))return n;for(e=this.graph.InEdges(u).GetEnumerator();e.MoveNext();)if((n=e.get_Current(),!this.inTree[n.get_Source()]||!this.inTree[n.get_Target()])&&(t=this.Slack(n),t<i&&(r=n,i=t,t==1)))return n}return As(r,Microsoft.Msagl.Layout.Layered.NetworkEdge.ctor)},TightTree:function(){var r,o,i,t,u,f,e,n;for(this.treeVertices.Clear(),r=this.graph.get_Edges().GetEnumerator();r.MoveNext();)o=r.get_Current(),o.inTree=!1;for(i=1;i<this.inTree.length;i++)this.inTree[i]=!1;for(this.inTree[0]=!0,this.treeVertices.Add(0),t=new System.Collections.Generic.Stack$1.ctor(System.Int32.ctor),t.Push(0);t.get_Count()>0;){for(u=t.Pop(),f=this.graph.OutEdges(u).GetEnumerator();f.MoveNext();)(n=f.get_Current(),this.inTree[n.get_Target()])||this.layers[n.get_Source()]-this.layers[n.get_Target()]==n.get_Separation()&&(t.Push(n.get_Target()),this.inTree[n.get_Target()]=!0,this.treeVertices.Add(n.get_Target()),n.inTree=!0);for(e=this.graph.InEdges(u).GetEnumerator();e.MoveNext();)(n=e.get_Current(),this.inTree[n.get_Source()])||this.layers[n.get_Source()]-this.layers[n.get_Target()]==n.get_Separation()&&(t.Push(n.get_Source()),this.inTree[n.get_Source()]=!0,this.treeVertices.Add(n.get_Source()),n.inTree=!0)}return this.treeVertices.get_Count()},LeaveEnterEdge:function(){for(var i=null,e=null,o=0,s=this.graph.get_Edges().GetEnumerator(),n,t,u;s.MoveNext();)n=s.get_Current(),n.inTree&&n.get_Cut()<o&&(o=n.get_Cut(),i=n);if(i==null)return null;for(var f=!1,r=2147483647,h=this.graph.get_Edges().GetEnumerator();h.MoveNext();)if(t=h.get_Current(),u=this.Slack(t),t.inTree==!1&&this.EdgeSourceTargetVal(t,i)==-1&&(u<r||u==r&&(f=this.random.Next$$Int32(2)==1))){if(r=u,e=t,r==0&&!f)break;f=!1}return new System.Tuple$2.ctor(Microsoft.Msagl.Layout.Layered.NetworkEdge.ctor,Microsoft.Msagl.Layout.Layered.NetworkEdge.ctor,i,e)},Exchange:function(n,t){var i=this.CommonPredecessorOfSourceAndTargetOfF(t);this.CreatePathForCutUpdates(n,t,i);this.UpdateLimLowLeavesAndParentsUnderNode(i);this.UpdateCuts(n);this.UpdateLayersUnderNode(i)},UpdateLayersUnderNode:function(n){var u=new System.Collections.Generic.Stack$1.ctor(System.Int32.ctor),t,f,e,i,o,r;for(u.Push(n),t=0;t<this.graph.get_NodeCount();t++)this.low[n]<=this.lim[t]&&this.lim[t]<=this.lim[n]&&t!=n&&(this.layers[t]=2147483647);while(u.get_Count()>0){for(f=u.Pop(),e=this.graph.OutEdges(f).GetEnumerator();e.MoveNext();)i=e.get_Current(),i.inTree&&this.layers[i.get_Target()]==2147483647&&(this.layers[i.get_Target()]=this.layers[f]-i.get_Separation(),u.Push(i.get_Target()));for(o=this.graph.InEdges(f).GetEnumerator();o.MoveNext();)r=o.get_Current(),r.inTree&&this.layers[r.get_Source()]==2147483647&&(this.layers[r.get_Source()]=this.layers[f]+r.get_Separation(),u.Push(r.get_Source()))}},UpdateCuts:function(n){var r=new System.Collections.Generic.Stack$1.ctor(System.Int32.ctor),e=new System.Collections.Generic.Stack$1.ctor(System.Int32.ctor),u,t,f,o,i,s,c,l,h,a;for(r.Push(n.get_Source()),r.Push(n.get_Target());r.get_Count()>0;){while(r.get_Count()>0)if((u=r.Pop(),this.ProgressStep(),t=this.parent[u],t!=null)&&t.get_Cut()==2147483647){for(f=0,o=this.IncidentEdges(u).GetEnumerator();o.MoveNext();)i=o.get_Current(),i.inTree==!1?(s=this.EdgeSourceTargetVal(i,t),s!=0&&(f+=s*i.get_Weight())):i==t?f+=i.get_Weight():(c=t.get_Source()==i.get_Target()||t.get_Target()==i.get_Source()?1:-1,l=this.EdgeContribution(i,u),f+=l*c);t.set_Cut(f);h=t.get_Source()==u?t.get_Target():t.get_Source();this.AllLowCutsHaveBeenDone(h)&&e.Push(h)}a=r;r=e;e=a}},CreatePathForCutUpdates:function(n,t,i){for(var u=t.get_Target(),r;u!=i;)r=this.parent[u],r.set_Cut(2147483647),u=r.get_Source()==u?r.get_Target():r.get_Source();t.set_Cut(2147483647);n.inTree=!1;t.inTree=!0},CommonPredecessorOfSourceAndTargetOfF:function(n){var r,u,t,i;for(this.lim[n.get_Source()]<this.lim[n.get_Target()]?(r=this.lim[n.get_Source()],u=this.lim[n.get_Target()]):(r=this.lim[n.get_Target()],u=this.lim[n.get_Source()]),t=n.get_Source();(this.low[t]<=r&&u<=this.lim[t])==!1;)i=this.parent[t],i.set_Cut(2147483647),t=i.get_Source()==t?i.get_Target():i.get_Source();return t},InitLayer:function(){var n=new Microsoft.Msagl.Layout.Layered.LongestPathLayering.ctor(this.graph);this.layers=n.GetLayers()},RunInternal:function(){this.graph.get_Edges().get_Count()==0&&this.graph.get_NodeCount()==0&&(this.layers=new Int32Array(0));this.FeasibleTree();for(var n;(n=this.LeaveEnterEdge())!=null;)this.ProgressStep(),this.Exchange(n.get_Item1(),n.get_Item2());this.ShiftLayerToZero()}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$NetworkSimplex);Microsoft$Msagl$Layout$Layered$Ordering={fullname:"Microsoft.Msagl.Layout.Layered.Ordering",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.Layered.Ordering.MaxNumberOfAdjacentExchanges=50},OrderLayers:function(n,t,i,r,u,f){for(var e=!1,o=n.get_Edges().GetEnumerator(),s,h;o.MoveNext();)if(s=o.get_Current(),s.get_CrossingWeight()!=1){e=!0;break}h=new Microsoft.Msagl.Layout.Layered.Ordering.ctor(n,!0,t,i,r,e,u);h.Run$$CancelToken(f)},CloneLayers:function(n,t){var i;if(t.Value==null)for(t.Value=n.Clone()instanceof Array||n.Clone()==null?n.Clone():function(){throw new Error("InvalidCastException");}(),i=0;i<n.length;i++)t.Value[i]=n[i].Clone()instanceof Int32Array||n[i].Clone()==null?n[i].Clone():function(){throw new Error("InvalidCastException");}();else for(i=0;i<n.length;i++)n[i].CopyTo(t.Value[i],0)},GetCrossingsTotal:function(n,t){for(var r=0,i=0;i<t.get_Layers().length-1;i++)r+=Microsoft.Msagl.Layout.Layered.Ordering.GetCrossingCountFromStrip(i,n,t);return r},GetCrossingCountFromStrip:function(n,t,i){var u=i.get_Layers()[n+1],r=i.get_Layers()[n];return r.length<=u.length?Microsoft.Msagl.Layout.Layered.Ordering.GetCrossingCountFromStripWhenBottomLayerIsShorter(r,t,i):Microsoft.Msagl.Layout.Layered.Ordering.GetCrossingCountFromStripWhenTopLayerIsShorter(u,r,t,i)},GetCrossingCountFromStripWhenTopLayerIsShorter:function(n,t,i,r){var e=Microsoft.Msagl.Layout.Layered.Ordering.EdgesOfStrip(t,i),f,o,c,u,h;for(System.Array.Sort$1$$T$Array$$IComparer$1(Microsoft.Msagl.Layout.Layered.LayerEdge.ctor,e,new Microsoft.Msagl.Layout.Layered.EdgeComparerByTarget.ctor(r.get_X())),f=1;f<n.length;)f*=2;o=new Int32Array(2*f-1);f--;c=0;for(var s=0,a=e.length,l=e[s];s<a;s++,l=e[s])for(u=f+r.get_X()[l.get_Source()],h=l.get_CrossingWeight(),o[u]+=h;u>0;)u%2!=0&&(c+=h*o[u+1]),u=(u-1)/2|0,o[u]+=h;return c},GetCrossingCountFromStripWhenBottomLayerIsShorter:function(n,t,i){var f=Microsoft.Msagl.Layout.Layered.Ordering.EdgesOfStrip(n,t),u,e,h,r,s;for(System.Array.Sort$1$$T$Array$$IComparer$1(Microsoft.Msagl.Layout.Layered.LayerEdge.ctor,f,new Microsoft.Msagl.Layout.Layered.EdgeComparerBySource.ctor(i.get_X())),u=1;u<n.length;)u*=2;e=new Int32Array(2*u-1);u--;h=0;for(var o=0,l=f.length,c=f[o];o<l;o++,c=f[o])for(r=u+i.get_X()[c.get_Target()],s=c.get_CrossingWeight(),e[r]+=s;r>0;)r%2!=0&&(h+=s*e[r+1]),r=(r-1)/2|0,e[r]+=s;return h},EdgesOfStrip:function(n,t){return System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Layout.Layered.LayerEdge.ctor,System.Linq.Enumerable.SelectMany$3$$IEnumerable$1$$Func$2$$Func$3(System.Int32.ctor,Microsoft.Msagl.Layout.Layered.LayerEdge.ctor,Microsoft.Msagl.Layout.Layered.LayerEdge.ctor,n,function(n){return t.InEdges(n)},function(n,t){return t}))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u,f,e){this.predecessors=null;this.pOrder=null;this.successors=null;this.sOrder=null;this.inCrossingCount=null;this.outCrossingCount=null;this.balanceVirtAndOrigNodes=!1;this.hasCrossWeights=!1;this.layerArrays=null;this.layerArraysCopy=null;this.layering=null;this.layers=null;this.measure=null;this.nOfLayers=0;this.optimalOriginalGroupSize=null;this.optimalVirtualGroupSize=null;this.properLayeredGraph=null;this.random=null;this.settings=null;this.startOfVirtNodes=0;this.tryReverse=!0;this.X=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.tryReverse=t;this.startOfVirtNodes=r;this.layerArrays=i;this.layering=i.Y;this.nOfLayers=i.get_Layers().length;this.layers=i.get_Layers();this.balanceVirtAndOrigNodes=u;this.properLayeredGraph=n;this.hasCrossWeights=f;this.settings=e;this.random=new System.Random.ctor$$Int32(this.get_SeedOfRandom())},HeadOfTheCoin:function(){return this.random.Next$$Int32(2)==0},AdjacentExchangeWithBalancingVirtOrigNodes:function(){var i,t,n;for(this.InitArrays(),i=0,t=!0;t&&i++<50;){for(t=!1,n=0;n<this.layers.length;n++)t=this.AdjExchangeLayerWithBalance(n)||t;for(n=this.layers.length-2;n>=0;n--)t=this.AdjExchangeLayerWithBalance(n)||t}},AdjacentExchange:function(){var i,t,n;for(this.InitArrays(),i=0,t=!0;t&&i++<50;){for(t=!1,n=0;n<this.layers.length;n++)t=this.AdjExchangeLayer(n)||t;for(n=this.layers.length-2;n>=0;n--)t=this.AdjExchangeLayer(n)||t}},AllocArrays:function(){var i=this.properLayeredGraph.get_NodeCount(),n,t,e,u,o,f,r;for(this.predecessors=new Array(i),this.successors=new Array(i),this.pOrder=new Array(i),this.sOrder=new Array(i),this.hasCrossWeights&&(this.outCrossingCount=new Array(i),this.inCrossingCount=new Array(i)),n=0;n<i;n++){if(t=this.properLayeredGraph.InEdgesCount(n),this.predecessors[n]=new Int32Array(t),this.hasCrossWeights)for(e=this.inCrossingCount[n]=new System.Collections.Generic.Dictionary$2.ctor$$Int32(System.Int32.ctor,System.Int32.ctor,t),u=this.properLayeredGraph.InEdges(n).GetEnumerator();u.MoveNext();)r=u.get_Current(),e.set_Item$$TKey(r.get_Source(),r.get_CrossingWeight());if(this.pOrder[n]=new System.Collections.Generic.Dictionary$2.ctor$$Int32(System.Int32.ctor,System.Int32.ctor,t),t=this.properLayeredGraph.OutEdgesCount(n),this.successors[n]=new Int32Array(t),this.sOrder[n]=new System.Collections.Generic.Dictionary$2.ctor$$Int32(System.Int32.ctor,System.Int32.ctor,t),this.hasCrossWeights)for(o=this.outCrossingCount[n]=new System.Collections.Generic.Dictionary$2.ctor$$Int32(System.Int32.ctor,System.Int32.ctor,t),f=this.properLayeredGraph.OutEdges(n).GetEnumerator();f.MoveNext();)r=f.get_Current(),o.set_Item$$TKey(r.get_Target(),r.get_CrossingWeight())}},InitArrays:function(){var n;for(this.successors==null&&this.AllocArrays(),n=0;n<this.properLayeredGraph.get_NodeCount();n++)this.pOrder[n].Clear(),this.sOrder[n].Clear();for(var t=0,i=this.layers,u=i.length,r=i[t];t<u;t++,r=i[t])this.InitPsArraysForLayer(r)},CalcPair:function(n,t,i,r){var u=this.successors[n],f=this.successors[t],e=this.predecessors[n],o=this.predecessors[t];if(this.hasCrossWeights){var s=this.outCrossingCount[n],h=this.outCrossingCount[t],c=this.inCrossingCount[n],l=this.inCrossingCount[t];i.Value=this.CountOnArrays$$Int32$Array$$Int32$Array$$Dictionary$2$Int32$Int32$$Dictionary$2$Int32$Int32(u,f,s,h)+this.CountOnArrays$$Int32$Array$$Int32$Array$$Dictionary$2$Int32$Int32$$Dictionary$2$Int32$Int32(e,o,c,l);r.Value=this.CountOnArrays$$Int32$Array$$Int32$Array$$Dictionary$2$Int32$Int32$$Dictionary$2$Int32$Int32(f,u,h,s)+this.CountOnArrays$$Int32$Array$$Int32$Array$$Dictionary$2$Int32$Int32$$Dictionary$2$Int32$Int32(o,e,l,c)}else i.Value=this.CountOnArrays$$Int32$Array$$Int32$Array(u,f)+this.CountOnArrays$$Int32$Array$$Int32$Array(e,o),r.Value=this.CountOnArrays$$Int32$Array$$Int32$Array(f,u)+this.CountOnArrays$$Int32$Array$$Int32$Array(o,e)},InitPsArraysForLayer:function(n){var r,u;this.ProgressStep();for(var i=0,l=n.length,t=n[i];i<l;i++,t=n[i]){for(r=this.properLayeredGraph.Pred(t).GetEnumerator();r.MoveNext();){var f=r.get_Current(),e=this.sOrder[f],o=e.get_Count();this.successors[f][o]=t;e.set_Item$$TKey(t,o)}for(u=this.properLayeredGraph.Succ(t).GetEnumerator();u.MoveNext();){var s=u.get_Current(),h=this.pOrder[s],c=h.get_Count();this.predecessors[s][c]=t;h.set_Item$$TKey(t,c)}}},CountOnArrays$$Int32$Array$$Int32$Array:function(n,t){for(var o,u=0,s=t.length-1,r=-1,f=0,i=0,h=n.length,e=n[i];i<h;i++,e=n[i]){for(o=this.X[e];r<s&&this.X[t[r+1]]<o;r++)f++;u+=f}return u},CountOnArrays$$Int32$Array$$Int32$Array$$Dictionary$2$Int32$Int32$$Dictionary$2$Int32$Int32:function(n,t,i,r){for(var h,c,o=0,l=t.length-1,f=-1,s=0,u=0,a=n.length,e=n[u];u<a;u++,e=n[u]){for(h=this.X[e];f<l&&this.X[c=t[f+1]]<h;f++)s+=r.get_Item$$TKey(c);o+=s*i.get_Item$$TKey(e)}return o},AdjExchangeLayer:function(n){this.ProgressStep();var t=this.layers[n],i=this.ExchangeWithGainWithNoDisturbance(t);return i?!0:(this.DisturbLayer(t),this.ExchangeWithGainWithNoDisturbance(t))},AdjExchangeLayerWithBalance:function(n){this.ProgressStep();var t=this.layers[n],i=this.ExchangeWithGainWithNoDisturbanceWithBalance(t);return i?!0:(this.DisturbLayerWithBalance(t),this.ExchangeWithGainWithNoDisturbanceWithBalance(t))},Swap:function(n,t){var i=this.X[n],r=this.X[t],f=this.layering[n],u=this.layers[f];u[i]=t;u[r]=n;this.X[n]=r;this.X[t]=i;this.UpdateSsContainingUv(n,t);this.UpdatePsContainingUv(n,t)},UpdatePsContainingUv:function(n,t){var i,r,f;if(this.successors[n].length<=this.successors[t].length)for(var e=0,s=this.successors[n],c=s.length,u=s[e];e<c;e++,u=s[e])i=this.pOrder[u],i.ContainsKey(t)&&(r=i.get_Item$$TKey(t),f=this.predecessors[u],f[r-1]=t,f[r]=n,i.set_Item$$TKey(t,r-1),i.set_Item$$TKey(n,r));else for(var o=0,h=this.successors[t],l=h.length,u=h[o];o<l;o++,u=h[o])i=this.pOrder[u],i.ContainsKey(n)&&(r=i.get_Item$$TKey(t),f=this.predecessors[u],f[r-1]=t,f[r]=n,i.set_Item$$TKey(t,r-1),i.set_Item$$TKey(n,r))},UpdateSsContainingUv:function(n,t){var i,r,f;if(this.predecessors[n].length<=this.predecessors[t].length)for(var e=0,s=this.predecessors[n],c=s.length,u=s[e];e<c;e++,u=s[e])i=this.sOrder[u],i.ContainsKey(t)&&(r=i.get_Item$$TKey(t),f=this.successors[u],f[r-1]=t,f[r]=n,i.set_Item$$TKey(t,r-1),i.set_Item$$TKey(n,r));else for(var o=0,h=this.predecessors[t],l=h.length,u=h[o];o<l;o++,u=h[o])i=this.sOrder[u],i.ContainsKey(n)&&(r=i.get_Item$$TKey(t),f=this.successors[u],f[r-1]=t,f[r]=n,i.set_Item$$TKey(t,r-1),i.set_Item$$TKey(n,r))},DisturbLayer:function(n){for(var t=0;t<n.length-1;t++)this.AdjacentSwapToTheRight(n,t)},DisturbLayerWithBalance:function(n){for(var t=0;t<n.length-1;t++)this.AdjacentSwapToTheRightWithBalance(n,t)},ExchangeWithGainWithNoDisturbance:function(n){var t=!1,i;do i=this.ExchangeWithGain(n),t=t||i;while(i);return t},ExchangeWithGainWithNoDisturbanceWithBalance:function(n){var t=!1,i;do i=this.ExchangeWithGainWithBalance(n),t=t||i;while(i);return t},ExchangeWithGain:function(n){for(var t=0;t<n.length-1;t++)if(this.SwapWithGain(n[t],n[t+1]))return this.SwapToTheLeft(n,t),this.SwapToTheRight(n,t+1),!0;return!1},ExchangeWithGainWithBalance:function(n){for(var t=0;t<n.length-1;t++)if(this.SwapWithGainWithBalance(n[t],n[t+1]))return this.SwapToTheLeftWithBalance(n,t),this.SwapToTheRightWithBalance(n,t+1),!0;return!1},SwapToTheLeft:function(n,t){for(var i=t-1;i>=0;i--)this.AdjacentSwapToTheRight(n,i)},SwapToTheRight:function(n,t){for(var i=t;i<n.length-1;i++)this.AdjacentSwapToTheRight(n,i)},SwapToTheLeftWithBalance:function(n,t){for(var i=t-1;i>=0;i--)this.AdjacentSwapToTheRightWithBalance(n,i)},SwapToTheRightWithBalance:function(n,t){for(var i=t;i<n.length-1;i++)this.AdjacentSwapToTheRightWithBalance(n,i)},AdjacentSwapToTheRight:function(n,t){var i=n[t],r=n[t+1],u=this.SwapGain(i,r);(u>0||u==0&&this.HeadOfTheCoin())&&this.Swap(i,r)},AdjacentSwapToTheRightWithBalance:function(n,t){var i=n[t],r=n[t+1],u=this.SwapGainWithBalance(i,r);(u>0||u==0&&this.HeadOfTheCoin())&&this.Swap(i,r)},SwapGain:function(n,t){var i,r;return function(){var u={Value:i},f={Value:r},e=this.CalcPair(n,t,u,f);return i=u.Value,r=f.Value,e}.call(this),i-r},SwapGainWithBalance:function(n,t){var i,r,u;return(function(){var u={Value:i},f={Value:r},e=this.CalcPair(n,t,u,f);return i=u.Value,r=f.Value,e}.call(this),u=i-r,u!=0&&this.UvAreOfSameKind(n,t))?u:this.SwapGroupGain(n,t)},UvAreOfSameKind:function(n,t){return n<this.startOfVirtNodes&&t<this.startOfVirtNodes||n>=this.startOfVirtNodes&&t>=this.startOfVirtNodes},SwapGroupGain:function(n,t){var u=this.layerArrays.Y[n],e=this.layers[u],f,r,i;return this.NeighborsForbidTheSwap(n,t)?-1:(f=this.X[n],r=this.IsOriginal(n)?this.optimalOriginalGroupSize[u]==1:this.optimalVirtualGroupSize[u]==1,i=this.CalcDeltaBetweenGroupsToTheLeftAndToTheRightOfTheSeparator(e,r?f:f+1,r?n:t),r)?i<-1?1:i==-1?0:-1:i>1?1:i==1?0:-1},NeighborsForbidTheSwap:function(n,t){return this.UpperNeighborsForbidTheSwap(n,t)||this.LowerNeighborsForbidTheSwap(n,t)},LowerNeighborsForbidTheSwap:function(n,t){var i,r;return(i=this.properLayeredGraph.OutEdgesCount(n))==0||(r=this.properLayeredGraph.OutEdgesCount(t))==0?!1:this.X[this.successors[n][i>>1]]<this.X[this.successors[t][r>>1]]},UpperNeighborsForbidTheSwap:function(n,t){var i=this.properLayeredGraph.InEdgesCount(n),r=this.properLayeredGraph.InEdgesCount(t);return i==0||r==0?!1:this.X[this.predecessors[n][i>>1]]<this.X[this.predecessors[t][r>>1]]},CalcDeltaBetweenGroupsToTheLeftAndToTheRightOfTheSeparator:function(n,t,i){for(var u,f=this.GetKindDelegate(i),e=0,r=t-1;r>=0&&!f(n[r]);r--)e++;for(u=0,r=t+1;r<n.length&&!f(n[r]);r++)u++;return e-u},IsOriginal:function(n){return n<this.startOfVirtNodes},IsVirtual:function(n){return n>=this.startOfVirtNodes},GetKindDelegate:function(n){return this.IsVirtual(n)?$CreateDelegate(this,this.IsVirtual):$CreateDelegate(this,this.IsOriginal)},SwapWithGain:function(n,t){var i=this.SwapGain(n,t);return i>0?(this.Swap(n,t),!0):!1},SwapWithGainWithBalance:function(n,t){var i=this.SwapGainWithBalance(n,t);return i>0?(this.Swap(n,t),!0):!1},NoGainStepsBound$$:"System.Int32",get_NoGainStepsBound:function(){return this.get_SugiyamaLayoutSettings().get_NoGainAdjacentSwapStepsBound()*this.get_SugiyamaLayoutSettings().get_RepetitionCoefficientForOrdering()},SugiyamaLayoutSettings$$:"Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings",get_SugiyamaLayoutSettings:function(){return this.settings},SeedOfRandom$$:"System.Int32",get_SeedOfRandom:function(){return this.get_SugiyamaLayoutSettings().get_RandomSeedForOrdering()},MaxOfIterations$$:"System.Int32",get_MaxOfIterations:function(){return this.get_SugiyamaLayoutSettings().get_MaxNumberOfPassesInOrdering()*this.get_SugiyamaLayoutSettings().get_RepetitionCoefficientForOrdering()},RunInternal:function(){var t,i,n;if(this.Calculate(),this.tryReverse&&(t=this.layerArrays.ReversedClone(),i=new Microsoft.Msagl.Layout.Layered.Ordering.ctor(this.properLayeredGraph.ReversedClone(),!1,t,this.startOfVirtNodes,this.balanceVirtAndOrigNodes,this.hasCrossWeights,this.settings),i.Run(),Microsoft.Msagl.Layout.Layered.OrderingMeasure.op_LessThan(i.measure,this.measure))){for(n=0;n<this.nOfLayers;n++)t.get_Layers()[n].CopyTo(this.layerArrays.get_Layers()[this.nOfLayers-1-n],0);this.layerArrays.UpdateXFromLayers()}},Calculate:function(){var n,t,r,i;for(this.Init(),function(){var n={Value:this.layerArraysCopy},t=Microsoft.Msagl.Layout.Layered.Ordering.CloneLayers(this.layers,n);return this.layerArraysCopy=n.Value,t}.call(this),n=0,this.measure=new Microsoft.Msagl.Layout.Layered.OrderingMeasure.ctor(this.layerArraysCopy,Microsoft.Msagl.Layout.Layered.Ordering.GetCrossingsTotal(this.properLayeredGraph,this.layerArrays),this.startOfVirtNodes,this.optimalOriginalGroupSize,this.optimalVirtualGroupSize),t=0;t<this.get_MaxOfIterations()&&n<this.get_NoGainStepsBound()&&!this.measure.IsPerfect();t++)this.ProgressStep(),r=t%2==0,this.LayerByLayerSweep(r),this.balanceVirtAndOrigNodes?this.AdjacentExchangeWithBalancingVirtOrigNodes():this.AdjacentExchange(),i=new Microsoft.Msagl.Layout.Layered.OrderingMeasure.ctor(this.layerArrays.get_Layers(),Microsoft.Msagl.Layout.Layered.Ordering.GetCrossingsTotal(this.properLayeredGraph,this.layerArrays),this.startOfVirtNodes,this.optimalOriginalGroupSize,this.optimalVirtualGroupSize),Microsoft.Msagl.Layout.Layered.OrderingMeasure.op_LessThan(this.measure,i)?(this.Restore(),n++):(Microsoft.Msagl.Layout.Layered.OrderingMeasure.op_LessThan(i,this.measure)||this.HeadOfTheCoin())&&(n=0,function(){var n={Value:this.layerArraysCopy},t=Microsoft.Msagl.Layout.Layered.Ordering.CloneLayers(this.layers,n);return this.layerArraysCopy=n.Value,t}.call(this),this.measure=i)},Restore:function(){this.layerArrays.UpdateLayers(this.layerArraysCopy)},LayerByLayerSweep:function(n){var t;if(n)for(t=1;t<this.nOfLayers;t++)this.SweepLayer(t,!0);else for(t=this.nOfLayers-2;t>=0;t--)this.SweepLayer(t,!1)},SweepLayer:function(n,t){var u,r,f,i;for(this.ProgressStep(),u=this.layers[n],r=new Float32Array(u.length),i=0;i<r.length;i++)r[i]=this.WMedian(u[i],t);for(this.Sort(n,r),f=this.layerArrays.get_Layers()[n],i=0;i<f.length;i++)this.layerArrays.get_X()[f[i]]=i},Sort:function(n,t){for(var c,y,l,a,f,i,v,u,o=new System.Collections.Generic.SortedDictionary$2.ctor(System.Single.ctor,System.Object.ctor),s=this.layers[n],r=0,h=0,p=t.length,e=t[h];h<p;h++,e=t[h])(u=s[r++],e!=-1)&&(o.ContainsKey(e)?(f=o.get_Item$$TKey(e),i=As(f,System.Collections.Generic.List$1.ctor),i!=null?this.HeadOfTheCoin()?i.Add(u):(c=this.random.Next$$Int32(i.get_Count()),y=i.get_Item$$Int32(c),i.set_Item$$Int32(c,u),i.Add(y)):(l=f,i=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),o.set_Item$$TKey(e,i),this.HeadOfTheCoin()?(i.Add(l),i.Add(u)):(i.Add(u),i.Add(l)))):o.set_Item$$TKey(e,u));for(a=o.GetEnumerator(),r=0;r<s.length;)if(t[r]!=-1)if(a.MoveNext(),f=a.get_Current().get_Value(),f.GetType()==Typeof(System.Int32.ctor))s[r++]=f;else for(i=As(f,System.Collections.Generic.List$1.ctor),v=i.GetEnumerator();v.MoveNext();){for(u=v.get_Current();t[r]==-1;)r++;s[r++]=u}else r++},WMedian:function(n,t){var f,r,i,o,s,h,e,u,c,l;if(t?(f=this.properLayeredGraph.OutEdges(n),r=this.properLayeredGraph.OutEdgesCount(n)):(f=this.properLayeredGraph.InEdges(n),r=this.properLayeredGraph.InEdgesCount(n)),r==0)return-1;if(i=new Int32Array(r),o=0,t)for(s=f.GetEnumerator();s.MoveNext();)e=s.get_Current(),i[o++]=this.X[e.get_Target()];else for(h=f.GetEnumerator();h.MoveNext();)e=h.get_Current(),i[o++]=this.X[e.get_Source()];return(System.Array.Sort$1$$T$Array(System.Int32.ctor,i),u=r/2|0,r%2==1)?i[u]:r==2?.5*(i[0]+i[1]):(c=i[u-1]-i[0],l=i[r-1]-i[u],(i[u-1]*c+i[u]*l)/(c+l))},Init:function(){for(var e,n,t,o,u,f=new Int32Array(this.nOfLayers),i=new System.Collections.Generic.Stack$1.ctor(System.Int32.ctor),r=0;r<this.properLayeredGraph.get_NodeCount();r++)this.properLayeredGraph.InEdgesCount(r)==0&&i.Push(r);for(e=new Array(this.properLayeredGraph.get_NodeCount());i.get_Count()>0;)for(n=i.Pop(),t=this.layerArrays.Y[n],this.layerArrays.get_Layers()[t][f[t]]=n,this.layerArrays.get_X()[n]=f[t],f[t]++,o=this.properLayeredGraph.Succ(n).GetEnumerator();o.MoveNext();)u=o.get_Current(),e[u]||(e[u]=!0,i.Push(u));this.X=this.layerArrays.get_X();this.balanceVirtAndOrigNodes&&this.InitOptimalGroupSizes()},InitOptimalGroupSizes:function(){this.optimalOriginalGroupSize=new Float64Array(this.nOfLayers);this.optimalVirtualGroupSize=new Float64Array(this.nOfLayers);for(var n=0;n<this.nOfLayers;n++)this.InitOptimalGroupSizesForLayer(n)},InitOptimalGroupSizesForLayer:function(n){for(var r,t=0,i=0,u=this.layers[n],e=u.length,f=u[i];i<e;i++,f=u[i])f<this.startOfVirtNodes&&t++;r=this.layers[n].length-t;t<r?(this.optimalOriginalGroupSize[n]=1,this.optimalVirtualGroupSize[n]=r/(t+1)):(this.optimalVirtualGroupSize[n]=1,this.optimalOriginalGroupSize[n]=t/(r+1))}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$Ordering);Microsoft$Msagl$Layout$Layered$EdgePathsInserter={fullname:"Microsoft.Msagl.Layout.Layered.EdgePathsInserter",baseTypeName:"System.Object",staticDefinition:{InsertPaths$$ProperLayeredGraph$$LayerArrays$$Database$$BasicGraph$2$Node$IntEdge:function(n,t,i,r){var u=new Microsoft.Msagl.Layout.Layered.EdgePathsInserter.ctor(n.Value,t.Value,i,r);u.InsertPaths();n.Value=u.get_NLayeredGraph();t.Value=u.get_Nla()},GetTarget:function(n,t,i,r){return i<r-1?n.Value:t.get_Target()},GetSource:function(n,t,i){return i==0?t.get_Source():n.Value++}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.database=null;this.intGraph=null;this.layeredGraph=null;this.nLayeredGraph=null;this.virtNodesToIntEdges=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor);this.la=null;this.nla=null;System.Object.ctor.call(this);this.la=t;this.database=i;this.layeredGraph=n;this.intGraph=r},NLayeredGraph$$:"Microsoft.Msagl.Layout.Layered.ProperLayeredGraph",get_NLayeredGraph:function(){return this.nLayeredGraph},Nla$$:"Microsoft.Msagl.Layout.Layered.LayerArrays",get_Nla:function(){return this.nla},NLayering$$:"System.Int32[]",get_NLayering:function(){return this.nla.Y},InsertPaths:function(){this.CreateFullLayeredGraph();this.InitNewLayering();this.MapVirtualNodesToEdges();this.WidenOriginalLayers()},WidenOriginalLayers:function(){for(var u,n,i,e,s,r=0;r<this.la.get_Layers().length;r++){u=this.nla.get_Layers()[r];n=0;for(var f=0,o=this.la.get_Layers()[r],c=o.length,t=o[f];f<c;f++,t=o[f])if(function(){var n={Value:i},r=this.virtNodesToIntEdges.TryGetValue(t,n);return i=n.Value,r}.call(this),i!=null)for(var l=this.get_NLayering()[i.get_Source()]-this.get_NLayering()[t],a=this.database.get_Multiedges().get_Item$$TKey(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(i.get_Source(),i.get_Target())),h=a.GetEnumerator();h.MoveNext();)e=h.get_Current(),this.EdgeIsFlat(e)||(e!=i?(s=e.get_LayerEdges().get_Item$$Int32(l).get_Source(),u[n]=s,this.nla.get_X()[s]=n++):(u[n]=t,this.nla.get_X()[t]=n++));else u[n]=t,this.nla.get_X()[t]=n++}},EdgeIsFlat:function(n){return this.la.Y[n.get_Source()]==this.la.Y[n.get_Target()]},MapVirtualNodesToEdges:function(){for(var u=this.database.get_RegularMultiedges().GetEnumerator(),f,t,n,i,r;u.MoveNext();)for(f=u.get_Current(),t=f.GetEnumerator();t.MoveNext();)if(n=t.get_Current(),!this.EdgeIsFlat(n))for(i=n.get_LayerEdges().GetEnumerator();i.MoveNext();)r=i.get_Current(),r.get_Target()!=n.get_Target()&&this.virtNodesToIntEdges.set_Item$$TKey(r.get_Target(),n)},CreateFullLayeredGraph:function(){for(var r=this.layeredGraph.get_NodeCount(),f=this.database.get_Multiedges().GetEnumerator(),u,n,t,s,h;f.MoveNext();)if(u=f.get_Current(),u.get_Key().x!=u.get_Key().y)for(var c=u.get_Value(),e=!0,i=0,o=c.GetEnumerator();o.MoveNext();){if(n=o.get_Current(),e)e=!1,i=n.get_LayerSpan();else if(n.set_LayerEdges(new Array(i)),i==1)n.get_LayerEdges().set_Item$$Int32(0,new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(n.get_Source(),n.get_Target(),n.get_CrossingWeight()));else for(t=0;t<i;t++)s=function(){var i={Value:r},u=Microsoft.Msagl.Layout.Layered.EdgePathsInserter.GetSource(i,n,t);return r=i.Value,u}.call(this),h=function(){var u={Value:r},f=Microsoft.Msagl.Layout.Layered.EdgePathsInserter.GetTarget(u,n,t,i);return r=u.Value,f}.call(this),n.get_LayerEdges().set_Item$$Int32(t,new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(s,h,n.get_CrossingWeight()));Microsoft.Msagl.Layout.Layered.LayerInserter.RegisterDontStepOnVertex(this.database,n)}this.nLayeredGraph=new Microsoft.Msagl.Layout.Layered.ProperLayeredGraph.ctor(this.intGraph)},InitNewLayering:function(){var f,t,e,a,o,v,i,r,n;for(this.nla=new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(new Int32Array(this.get_NLayeredGraph().get_NodeCount())),n=0;n<this.layeredGraph.get_NodeCount();n++)this.get_NLayering()[n]=this.la.Y[n];for(f=this.database.get_Multiedges().GetEnumerator();f.MoveNext();)if(t=f.get_Current(),t.get_Key().get_First()!=t.get_Key().get_Second()&&this.la.Y[t.get_Key().get_First()]!=this.la.Y[t.get_Key().get_Second()])for(var h=0,c=!0,p=t.get_Value(),l=p.GetEnumerator();l.MoveNext();)for(e=l.get_Current(),c&&(c=!1,h=this.la.Y[e.get_Source()]),a=h-1,o=e.get_LayerEdges().GetEnumerator();o.MoveNext();)v=o.get_Current(),this.get_NLayering()[v.get_Target()]=a--;i=new Array(this.la.get_Layers().length);r=new Int32Array(i.length);for(var u=0,s=this.get_NLayering(),w=s.length,y=s[u];u<w;u++,y=s[u])r[y]++;for(n=0;n<r.length;n++)i[n]=new Int32Array(r[n]);this.nla=new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(this.get_NLayering());this.nla.set_Layers(i)}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$EdgePathsInserter);Microsoft$Msagl$Layout$Layered$LayerInserter={fullname:"Microsoft.Msagl.Layout.Layered.LayerInserter",baseTypeName:"System.Object",staticDefinition:{InsertLayers$$ProperLayeredGraph$$LayerArrays$$Database$$BasicGraph$2$Node$IntEdge:function(n,t,i,r){var u=new Microsoft.Msagl.Layout.Layered.LayerInserter.ctor(n.Value,t.Value,i,r);u.InsertLayers();n.Value=u.get_NLayeredGraph();t.Value=u.get_Nla().DropEmptyLayers()},RegisterDontStepOnVertex:function(n,t){if(n.get_Multiedges().get_Item$$TKey(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(t.get_Source(),t.get_Target())).get_Count()>1){var i=t.get_LayerEdges().get_Item$$Int32(t.get_LayerEdges().get_Count()/2|0);n.get_MultipleMiddles().Insert(i.get_Source())}}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.intGraph=null;this.database=null;this.layeredGraph=null;this.nLayeredGraph=null;this.virtNodesToIntEdges=null;this.la=null;this.nla=null;this.totalNodes=0;System.Object.ctor.call(this);this.la=t;this.database=i;this.layeredGraph=n;this.intGraph=r},NLayeredGraph$$:"Microsoft.Msagl.Layout.Layered.ProperLayeredGraph",get_NLayeredGraph:function(){return this.nLayeredGraph},Nla$$:"Microsoft.Msagl.Layout.Layered.LayerArrays",get_Nla:function(){return this.nla},NLayering$$:"System.Int32[]",get_NLayering:function(){return this.nla.Y},InsertLayers:function(){this.EditOldLayering();this.CreateFullLayeredGraph();this.InitNewLayering();this.MapVirtualNodesToEdges();this.FillUnsortedNewOddLayers();this.WidenOriginalLayers();this.SortNewOddLayers()},EditOldLayering:function(){for(var n=this.intGraph.get_NodeCount(),f=this.database.get_RegularMultiedges().GetEnumerator(),r,u;f.MoveNext();){var e=f.get_Current(),t=0,i=e.get_Item$$Int32(0);if(t=i.get_LayerSpan()*2,t>0){for(r=i.get_LayerEdges().GetEnumerator();r.MoveNext();)u=r.get_Current(),u.get_Target()!=i.get_Target()&&(n++,this.UpdateOldLayer(n++,u.get_Target()));n+=(t-1)*(e.get_Count()-1)+1}}},UpdateOldLayer:function(n,t){var i=this.la.get_X()[t],r=this.la.Y[t],u=this.la.get_Layers()[r];u[i]=n},WidenOriginalLayers:function(){for(var u,n,i,o,s,r=0;r<this.la.get_Layers().length;r++){u=this.nla.get_Layers()[r*2];n=0;for(var f=0,e=this.la.get_Layers()[r],c=e.length,t=e[f];f<c;f++,t=e[f])if(i=this.virtNodesToIntEdges[t],i!=null)for(var l=this.get_NLayering()[i.get_Source()]-this.get_NLayering()[t],a=this.database.get_Multiedges().get_Item$$TKey(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(i.get_Source(),i.get_Target())),h=a.GetEnumerator();h.MoveNext();)o=h.get_Current(),o!=i?(s=o.get_LayerEdges().get_Item$$Int32(l).get_Source(),u[n]=s,this.nla.get_X()[s]=n++):(u[n]=t,this.nla.get_X()[t]=n++);else u[n]=t,this.nla.get_X()[t]=n++}},FillUnsortedNewOddLayers:function(){for(var t,i=new Int32Array(this.nla.get_Layers().length),n=this.intGraph.get_NodeCount();n<this.nLayeredGraph.get_NodeCount();n++)t=this.get_NLayering()[n],t%2==1&&(this.nla.get_Layers()[t][i[t]++]=n)},MapVirtualNodesToEdges:function(){var t,n,i,r;for(this.virtNodesToIntEdges=new Array(this.get_NLayering().length),t=this.database.get_AllIntEdges().GetEnumerator();t.MoveNext();)if(n=t.get_Current(),n.get_Source()!=n.get_Target()&&n.get_LayerEdges()!=null)for(i=n.get_LayerEdges().GetEnumerator();i.MoveNext();)r=i.get_Current(),r.get_Target()!=n.get_Target()&&(this.virtNodesToIntEdges[r.get_Target()]=n)},CreateFullLayeredGraph:function(){var r,n,t,e,o;for(this.totalNodes=this.intGraph.get_NodeCount(),r=this.database.get_RegularMultiedges().GetEnumerator();r.MoveNext();)for(var s=r.get_Current(),i=0,u=!0,f=s.GetEnumerator();f.MoveNext();)if(n=f.get_Current(),u&&(u=!1,i=n.get_LayerSpan()*2),i>0){for(n.set_LayerEdges(new Array(i)),t=0;t<i;t++)e=function(){var i={Value:this.totalNodes},r=Microsoft.Msagl.Layout.Layered.EdgePathsInserter.GetSource(i,n,t);return this.totalNodes=i.Value,r}.call(this),o=function(){var r={Value:this.totalNodes},u=Microsoft.Msagl.Layout.Layered.EdgePathsInserter.GetTarget(r,n,t,i);return this.totalNodes=r.Value,u}.call(this),n.get_LayerEdges().set_Item$$Int32(t,new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(e,o,n.get_CrossingWeight()));Microsoft.Msagl.Layout.Layered.LayerInserter.RegisterDontStepOnVertex(this.database,n)}this.nLayeredGraph=new Microsoft.Msagl.Layout.Layered.ProperLayeredGraph.ctor(this.intGraph)},SortNewOddLayers:function(){for(var i,t,c,l,a,v,s,u,h,r,y,p,n,w,b,f,e=1;e<this.nla.get_Layers().length;e+=2){i=new System.Collections.Generic.SortedDictionary$2.ctor(System.Int32.ctor,System.Object.ctor);t=this.nla.get_Layers()[e];for(var o=0,k=t.length,n=t[o];o<k;o++,n=t[o]){for(c=-1,l=this.nLayeredGraph.InEdges(n).GetEnumerator();l.MoveNext();)s=l.get_Current(),c=s.get_Source();for(a=-1,v=this.nLayeredGraph.OutEdges(n).GetEnumerator();v.MoveNext();)s=v.get_Current(),a=s.get_Target();u=this.nla.get_X()[c]+this.nla.get_X()[a];i.ContainsKey(u)?(h=i.get_Item$$TKey(u),h.GetType()==Typeof(System.Int32.ctor)?(r=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),r.Add(h),r.Add(n),i.set_Item$$TKey(u,r)):(r=As(h,System.Collections.Generic.List$1.ctor),r.Add(n))):i.set_Item$$TKey(u,n)}for(y=0,p=i.get_Values().GetEnumerator();p.MoveNext();)if(n=p.get_Current(),n.GetType()==Typeof(System.Int32.ctor))t[y++]=n;else for(w=As(n,System.Collections.Generic.List$1.ctor).GetEnumerator();w.MoveNext();)b=w.get_Current(),t[y++]=b;for(f=0;f<t.length;f++)this.nla.get_X()[t[f]]=f}},InitNewLayering:function(){var f,e,t,c,o,s,i,r,n;for(this.nla=new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(new Int32Array(this.totalNodes)),n=0;n<this.layeredGraph.get_NodeCount();n++)this.get_NLayering()[n]=this.la.Y[n]*2;for(f=this.database.get_Multiedges().GetEnumerator();f.MoveNext();)if(e=f.get_Current(),t=e.get_Key(),t.get_First()!=t.get_Second()&&this.la.Y[t.get_First()]!=this.la.Y[t.get_Second()])for(c=this.la.Y[t.x]*2,o=e.get_Value().GetEnumerator();o.MoveNext();)for(var l=o.get_Current(),y=c-1,a=l.get_LayerEdges().GetEnumerator();a.MoveNext();)s=a.get_Current(),s.get_Target()!=l.get_Target()&&(this.get_NLayering()[s.get_Target()]=y--);i=new Array(2*this.la.get_Layers().length-1);r=new Int32Array(i.length);for(var u=0,h=this.get_NLayering(),p=h.length,v=h[u];u<p;u++,v=h[u])r[v]++;for(n=0;n<r.length;n++)i[n]=new Int32Array(r[n]);this.nla=new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(this.get_NLayering());this.nla.set_Layers(i)}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$LayerInserter);Microsoft$Msagl$Layout$Layered$Balancing={fullname:"Microsoft.Msagl.Layout.Layered.Balancing",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},Balance:function(n,t,i,r){var u=new Microsoft.Msagl.Layout.Layered.Balancing.ctor(n,t,i);u.Run$$CancelToken(r)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.jumpers=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor);this.possibleJumperFeasibleIntervals=null;this.vertsCounts=null;this.dag=null;this.layering=null;this.nodeCount=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.nodeCount=i;this.dag=n;this.layering=t;this.Init()},RunInternal:function(){while(this.jumpers.get_Count()>0)this.Jump(this.ChooseJumper())},Init:function(){this.CalculateLayerCounts();this.InitJumpers()},Jump:function(n){var r,t,i,u;this.ProgressStep();this.jumpers.Delete(n);r=this.possibleJumperFeasibleIntervals.get_Item$$TKey(n),function(){var u={Value:t},f={Value:i},e=this.CalcJumpInfo(r.x,r.y,n,u,f);return t=u.Value,i=f.Value,e}.call(this)&&(this.layering[n]=i,u=this.nodeCount[n],this.vertsCounts[t]-=u,this.vertsCounts[i]+=u,this.UpdateRegionsForPossibleJumpersAndInsertJumpers(t,n))},IsJumper:function(n){return this.possibleJumperFeasibleIntervals.ContainsKey(n)},UpdateRegionsForPossibleJumpersAndInsertJumpers:function(n,t){for(var u=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor),h=new Microsoft.Msagl.Layout.Layered.Pred.ctor(this.dag,t).GetEnumerator(),f,e,o,r,s,i;h.MoveNext();)i=h.get_Current(),this.IsJumper(i)&&(this.CalculateRegionAndInsertJumper(i),u.Insert(i));for(f=new Microsoft.Msagl.Layout.Layered.Succ.ctor(this.dag,t).GetEnumerator();f.MoveNext();)i=f.get_Current(),this.IsJumper(i)&&(this.CalculateRegionAndInsertJumper(i),u.Insert(i));for(e=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),o=this.possibleJumperFeasibleIntervals.GetEnumerator();o.MoveNext();)r=o.get_Current(),u.Contains$$T(r.get_Key())||r.get_Value().x>n&&r.get_Value().y<n&&e.Add(r.get_Key());for(s=e.GetEnumerator();s.MoveNext();)i=s.get_Current(),this.CalculateRegionAndInsertJumper(i)},InitJumpers:function(){for(var i=new Int32Array(this.dag.get_NodeCount()),r=this.dag.get_Edges().GetEnumerator(),n,t;r.MoveNext();)n=r.get_Current(),i[n.get_Source()]-=n.get_Weight(),i[n.get_Target()]+=n.get_Weight();for(this.possibleJumperFeasibleIntervals=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor),t=0;t<this.dag.get_NodeCount();t++)i[t]==0&&this.CalculateRegionAndInsertJumper(t)},CalculateRegionAndInsertJumper:function(n){var t=new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(this.Up(n),this.Down(n));this.possibleJumperFeasibleIntervals.set_Item$$TKey(n,t);this.InsertJumper(t.x,t.y,n)},InsertJumper:function(n,t,i){var r,u;(function(){var f={Value:r},e={Value:u},o=this.CalcJumpInfo(n,t,i,f,e);return r=f.Value,u=e.Value,o}).call(this)&&this.jumpers.Insert(i)},CalcJumpInfo:function(n,t,i,r,u){var e,f;for(r.Value=this.layering[i],u.Value=-1,e=this.vertsCounts[r.Value]-2*this.nodeCount[i],f=n-1;f>r.Value;f--)this.vertsCounts[f]<e&&(e=this.vertsCounts[f],u.Value=f);for(f=r.Value-1;f>t;f--)this.vertsCounts[f]<e&&(e=this.vertsCounts[f],u.Value=f);return u.Value!=-1},Up:function(n){for(var t=2147483647,u=this.dag.InEdges(n).GetEnumerator(),i,r;u.MoveNext();)i=u.get_Current(),r=this.layering[i.get_Source()]-i.get_Separation()+1,r<t&&(t=r);return t==2147483647&&(t=this.layering[n]+1),t},Down:function(n){for(var t=-2147483647,u=this.dag.OutEdges(n).GetEnumerator(),i,r;u.MoveNext();)i=u.get_Current(),r=this.layering[i.get_Target()]+i.get_Separation()-1,r>t&&(t=r);return t==-2147483647&&(t=this.layering[n]-1),t},CalculateLayerCounts:function(){this.vertsCounts=new Int32Array(System.Linq.Enumerable.Max$$IEnumerable$1$Int32(this.layering)+1);for(var n=0,t=this.layering,r=t.length,i=t[n];n<r;n++,i=t[n])this.vertsCounts[i]+=this.nodeCount[i]},ChooseJumper:function(){for(var n=this.jumpers.GetEnumerator();n.MoveNext();)return n.get_Current();return System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"there are no jumpers to choose"),0}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$Balancing);Microsoft$Msagl$Core$GraphAlgorithms$BasicGraph$2={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$2",baseTypeName:"Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.TNode=n;this.TEdge=t;this.nodes=null;Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor.call(this,this.TEdge)},ctor$$IEnumerable$1:function(n,t,i){this.TNode=n;this.TEdge=t;this.nodes=null;Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32.call(this,this.TEdge,i,Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.VertexCount(i))},ctor$$IEnumerable$1$$Int32:function(n,t,i,r){this.TNode=n;this.TEdge=t;this.nodes=null;Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32.call(this,this.TEdge,i,r)},Nodes$$:"System.Collections.Generic.IList`1[[`0]]",get_Nodes:function(){return this.nodes},set_Nodes:function(n){this.nodes=n}}};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$BasicGraph$2);Microsoft$Msagl$Core$GraphAlgorithms$BasicGraph$1={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1",baseTypeName:"System.Object",staticDefinition:{FillArraySkippingTheEdge:function(n,t,i){for(var r=0,u=0;r<t.length;r++)t[r]!=n?i[r-u]=t[r]:u=1},VertexCount:function(n){for(var t=0,r=n.GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),i.get_Source()>=t&&(t=i.get_Source()+1),i.get_Target()>=t&&(t=i.get_Target()+1);return t},Enqueue:function(n,t,i){t.Enqueue(i);n.Insert(i)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.TEdge=n;this.edges=null;this.inEdges=null;this.numberOfVertices=0;this.outEdges=null;this.selfEdges=null;System.Object.ctor.call(this);this.SetEdges(new System.Collections.Generic.List$1.ctor(this.TEdge),0)},ctor$$IEnumerable$1:function(n,t){this.TEdge=n;this.edges=null;this.inEdges=null;this.numberOfVertices=0;this.outEdges=null;this.selfEdges=null;Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32.call(this,this.TEdge,t,Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.VertexCount(t))},ctor$$IEnumerable$1$$Int32:function(n,t,i){this.TEdge=n;this.edges=null;this.inEdges=null;this.numberOfVertices=0;this.outEdges=null;this.selfEdges=null;System.Object.ctor.call(this);this.SetEdges(t,i)},NodeCount$$:"System.Int32",get_NodeCount:function(){return this.numberOfVertices},Edges$$:"System.Collections.Generic.ICollection`1[[`0]]",get_Edges:function(){return this.edges},RemoveEdge:function(n){if(this.edges.Remove(n),n.get_Source()!=n.get_Target()){var t=this.outEdges[n.get_Source()],i=new Array(t.length-1);Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.FillArraySkippingTheEdge(n,t,i);this.outEdges[n.get_Source()]=i;t=this.inEdges[n.get_Target()];i=new Array(t.length-1);Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.FillArraySkippingTheEdge(n,t,i);this.inEdges[n.get_Target()]=i}},OutEdges:function(n){return this.outEdges[n]},SelfEdges:function(n){return this.selfEdges[n]},InEdges:function(n){return this.inEdges[n]},SetEdges:function(n,t){var s,r,i,h;this.edges=As(n,System.Collections.Generic.List$1.ctor)!=null?As(n,System.Collections.Generic.List$1.ctor):new System.Collections.Generic.List$1.ctor$$IEnumerable$1(this.TEdge,n);this.numberOfVertices=t;var f=new Int32Array(this.numberOfVertices),e=new Int32Array(this.numberOfVertices),o=new Int32Array(this.numberOfVertices);for(this.outEdges=new Array(this.numberOfVertices),this.inEdges=new Array(this.numberOfVertices),this.selfEdges=new Array(this.numberOfVertices),s=this.edges.GetEnumerator();s.MoveNext();)r=s.get_Current(),r.get_Source()!=r.get_Target()?(f[r.get_Source()]++,e[r.get_Target()]++):o[r.get_Source()]++;for(i=0;i<this.numberOfVertices;i++)this.outEdges[i]=new Array(f[i]),f[i]=0,this.inEdges[i]=new Array(e[i]),e[i]=0,this.selfEdges[i]=new Array(o[i]),o[i]=0;for(h=this.edges.GetEnumerator();h.MoveNext();){var r=h.get_Current(),u=r.get_Source(),c=r.get_Target();u!=c?(this.outEdges[u][f[u]++]=r,this.inEdges[c][e[c]++]=r):this.selfEdges[u][o[u]++]=r}},InEdgesCount:function(n){return this.InEdges(n).get_Count()},OutEdgesCount:function(n){return this.OutEdges(n).get_Count()},AddEdge:function(n){this.get_Edges().Add(n);this.AddEdgeToInEdges(n,n.get_Target());this.AddEdgeToOutEdges(n,n.get_Source())},AddEdgeToOutEdges:function(n,t){var r=this.outEdges[t],i=new Array(r.length+1);r.CopyTo(i,1);i[0]=n;this.outEdges[t]=i},AddEdgeToInEdges:function(n,t){var r=this.inEdges[t],i=new Array(r.length+1);r.CopyTo(i,1);i[0]=n;this.inEdges[t]=i},NodesOfConnectedGraph:function(){var u=[],n;if(this.edges.get_Count()>0){var t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor),i=new System.Collections.Generic.Queue$1.ctor(System.Int32.ctor),r=this.edges.get_Item$$Int32(0).get_Source();for(Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.Enqueue(t,i,r),u.push(r);i.get_Count()>0;){r=i.Dequeue();for(var f=0,s=this.outEdges[r],c=s.length,e=s[f];f<c;f++,e=s[f])n=e.get_Target(),t.Contains$$T(n)||(Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.Enqueue(t,i,n),u.push(n));for(var o=0,h=this.inEdges[r],l=h.length,e=h[o];o<l;o++,e=h[o])n=e.get_Source(),t.Contains$$T(n)||(Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.Enqueue(t,i,n),u.push(n))}}return u}}};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$BasicGraph$1);Microsoft$Msagl$Layout$Layered$Database={fullname:"Microsoft.Msagl.Layout.Layered.Database",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.multipleMiddles=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Int32.ctor);this.multiedges=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Collections.Generic.List$1.ctor);this.anchors=null;System.Object.ctor.call(this)},MultipleMiddles$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[System.Int32]]",get_MultipleMiddles:function(){return this.multipleMiddles},AllIntEdges$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Layout.Layered.IntEdge]]",get_AllIntEdges:function(){for(var t=[],i=this.get_Multiedges().get_Values().GetEnumerator(),r,n,u;i.MoveNext();)for(r=i.get_Current(),n=r.GetEnumerator();n.MoveNext();)u=n.get_Current(),t.push(u);return t},Anchors$$:"Microsoft.Msagl.Layout.Layered.Anchor[]",get_Anchors:function(){return this.anchors},set_Anchors:function(n){this.anchors=n},AddFeedbackSet:function(n){for(var u=n.GetEnumerator(),o;u.MoveNext();){for(var t=u.get_Current(),f=new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(t.get_Source(),t.get_Target()),i=new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(t.get_Target(),t.get_Source()),r=this.multiedges.get_Item$$TKey(f),e=r.GetEnumerator();e.MoveNext();)o=e.get_Current(),o.Revert();this.multiedges.ContainsKey(i)?this.multiedges.get_Item$$TKey(i).AddRange(r):this.multiedges.set_Item$$TKey(i,r);this.multiedges.Remove(f)}},RegularMultiedges$$:"System.Collections.Generic.IEnumerable`1[[System.Collections.Generic.List`1[[Microsoft.Msagl.Layout.Layered.IntEdge]]]]",get_RegularMultiedges:function(){for(var t=[],i=this.get_Multiedges().GetEnumerator(),n;i.MoveNext();)n=i.get_Current(),n.get_Key().x!=n.get_Key().y&&t.push(n.get_Value());return t},Multiedges$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.GraphAlgorithms.IntPair],[System.Collections.Generic.List`1[[Microsoft.Msagl.Layout.Layered.IntEdge]]]]",get_Multiedges:function(){return this.multiedges},GetMultiedge$$Int32$$Int32:function(n,t){return this.GetMultiedge$$IntPair(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n,t))},GetMultiedge$$IntPair:function(n){return this.multiedges.ContainsKey(n)?this.multiedges.get_Item$$TKey(n):new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Layered.IntEdge.ctor)},RegisterOriginalEdgeInMultiedges:function(n){var t=new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Source(),n.get_Target()),i;this.multiedges.ContainsKey(t)==!1?this.multiedges.set_Item$$TKey(t,i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Layered.IntEdge.ctor)):i=this.multiedges.get_Item$$TKey(t);i.Add(n)},SkeletonEdges:function(){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,this.get_Multiedges(),$CreateAnonymousDelegate(this,function(n){return n.get_Key().x!=n.get_Key().y})),$CreateAnonymousDelegate(this,function(n){return n.get_Value().get_Item$$Int32(0)}))}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$Database);Microsoft$Msagl$Core$Layout$Edge={fullname:"Microsoft.Msagl.Core.Layout.Edge",baseTypeName:"Microsoft.Msagl.Core.Layout.GeometryObject",staticDefinition:{RouteSelfEdge:function(n,t,i){var u=n.get_BoundingBox().get_Width(),f=n.get_BoundingBox().get_Height(),r=n.get_BoundingBox().get_Center(),e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r.get_X()-u/4,r.get_Y()),o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r.get_X()-u/4,r.get_Y()-f/2-t),s=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r.get_X()+u/4,r.get_Y()-f/2-t),h=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r.get_X()+u/4,r.get_Y());return i.Value=Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints([e,o,s,h]),i.Value.CreateCurve()}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Layout.ILabeledObject"],Kind:"Class",definition:{ctor$$Node$$Node$$Double$$Double$$Double:function(n,t,i,r,u){this.labels=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Label.ctor);this.source=null;this.sourceAnchorNumber=0;this.target=null;this.targetAnchorNumber=0;this.length=1;this.weight=1;this.separation=1;this.edgeGeometry=new Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor;this.Color=null;this.BeforeLayoutChangeEvent=null;this._OriginalLabelWidth=0;this._OriginalLabelHeight=0;Microsoft.Msagl.Core.Layout.GeometryObject.ctor.call(this);this.source=n;this.target=t;i>0&&this.set_Label(new Microsoft.Msagl.Core.Layout.Label.ctor$$Double$$Double$$GeometryObject(i,r,this));this.set_LineWidth(u)},SourcePort$$:"Microsoft.Msagl.Core.Layout.Port",get_SourcePort:function(){return this.get_EdgeGeometry().get_SourcePort()},set_SourcePort:function(n){this.get_EdgeGeometry().set_SourcePort(n)},TargetPort$$:"Microsoft.Msagl.Core.Layout.Port",get_TargetPort:function(){return this.get_EdgeGeometry().get_TargetPort()},set_TargetPort:function(n){this.get_EdgeGeometry().set_TargetPort(n)},Label$$:"Microsoft.Msagl.Core.Layout.Label",get_Label:function(){return this.labels.get_Count()==0?null:this.labels.get_Item$$Int32(0)},set_Label:function(n){this.labels.get_Count()==0?this.labels.Add(n):this.labels.set_Item$$Int32(0,n)},Labels$$:"System.Collections.Generic.IList`1[[Microsoft.Msagl.Core.Layout.Label]]",get_Labels:function(){return this.labels},Source$$:"Microsoft.Msagl.Core.Layout.Node",get_Source:function(){return this.source},set_Source:function(n){this.source=n},SourceAnchorNumber$$:"System.Int32",get_SourceAnchorNumber:function(){return this.sourceAnchorNumber},set_SourceAnchorNumber:function(n){this.sourceAnchorNumber=n},Target$$:"Microsoft.Msagl.Core.Layout.Node",get_Target:function(){return this.target},set_Target:function(n){this.target=n},TargetAnchorNumber$$:"System.Int32",get_TargetAnchorNumber:function(){return this.targetAnchorNumber},set_TargetAnchorNumber:function(n){this.targetAnchorNumber=n},OriginalLabelWidth$$:"System.Double",get_OriginalLabelWidth:function(){return this._OriginalLabelWidth},set_OriginalLabelWidth:function(n){this._OriginalLabelWidth=n},OriginalLabelHeight$$:"System.Double",get_OriginalLabelHeight:function(){return this._OriginalLabelHeight},set_OriginalLabelHeight:function(n){this._OriginalLabelHeight=n},ctor$$Node$$Node:function(n,t){this.labels=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Label.ctor);this.source=null;this.sourceAnchorNumber=0;this.target=null;this.targetAnchorNumber=0;this.length=1;this.weight=1;this.separation=1;this.edgeGeometry=new Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor;this.Color=null;this.BeforeLayoutChangeEvent=null;this._OriginalLabelWidth=0;this._OriginalLabelHeight=0;Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node$$Double$$Double$$Double.call(this,n,t,0,0,1)},ctor:function(){this.labels=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Label.ctor);this.source=null;this.sourceAnchorNumber=0;this.target=null;this.targetAnchorNumber=0;this.length=1;this.weight=1;this.separation=1;this.edgeGeometry=new Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor;this.Color=null;this.BeforeLayoutChangeEvent=null;this._OriginalLabelWidth=0;this._OriginalLabelHeight=0;Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node.call(this,null,null)},LabelBBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_LabelBBox:function(){return this.get_Label().get_BoundingBox()},Length$$:"System.Double",get_Length:function(){return this.length},set_Length:function(n){this.length=n},Weight$$:"System.Int32",get_Weight:function(){return this.weight},set_Weight:function(n){this.weight=n},Separation$$:"System.Int32",get_Separation:function(){return this.separation},set_Separation:function(n){this.separation=n},toString:function(){return this.source+"->"+this.target},LineWidth$$:"System.Double",get_LineWidth:function(){return this.get_EdgeGeometry().get_LineWidth()},set_LineWidth:function(n){this.get_EdgeGeometry().set_LineWidth(n)},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){var n=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox(),i,r,t;if(this.get_UnderlyingPolyline()!=null)for(i=this.get_UnderlyingPolyline().GetEnumerator();i.MoveNext();)r=i.get_Current(),n.Add$$Point(r);return this.get_Curve()!=null&&n.Add$$Rectangle(this.get_Curve().get_BoundingBox()),this.get_EdgeGeometry()!=null&&(this.get_EdgeGeometry().get_SourceArrowhead()!=null&&n.Add$$Point(this.get_EdgeGeometry().get_SourceArrowhead().get_TipPosition()),this.get_EdgeGeometry().get_TargetArrowhead()!=null&&n.Add$$Point(this.get_EdgeGeometry().get_TargetArrowhead().get_TipPosition())),t=this.get_LineWidth(),n.set_Left(n.get_Left()-t),n.set_Top(n.get_Top()+t),n.set_Right(n.get_Right()+t),n.set_Bottom(n.get_Bottom()-t),n},set_BoundingBox:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},EdgeGeometry$$:"Microsoft.Msagl.Core.Layout.EdgeGeometry",get_EdgeGeometry:function(){return this.edgeGeometry},set_EdgeGeometry:function(n){this.edgeGeometry=n},UnderlyingPolyline$$:"Microsoft.Msagl.Core.Geometry.SmoothedPolyline",get_UnderlyingPolyline:function(){return this.edgeGeometry.get_SmoothedPolyline()},set_UnderlyingPolyline:function(n){this.edgeGeometry.set_SmoothedPolyline(n)},Curve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Curve:function(){return this.edgeGeometry!=null?this.edgeGeometry.get_Curve():null},set_Curve:function(n){this.RaiseLayoutChangeEvent(n);this.edgeGeometry.set_Curve(n)},Transform:function(n){var t,u,i,r;if(this.get_Curve()!=null){if(this.set_Curve(this.get_Curve().Transform(n)),this.get_UnderlyingPolyline()!=null)for(t=this.get_UnderlyingPolyline().get_HeadSite(),u=this.get_UnderlyingPolyline().get_HeadSite();t!=null;t=t.get_Next(),u=u.get_Next())t.set_Point(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,t.get_Point()));i=this.edgeGeometry.get_SourceArrowhead();i!=null&&i.set_TipPosition(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,i.get_TipPosition()));r=this.edgeGeometry.get_TargetArrowhead();r!=null&&r.set_TipPosition(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,r.get_TipPosition()));this.get_Label()!=null&&this.get_Label().set_Center(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,this.get_LabelBBox().get_Center()))}},Translate:function(n){var t,i;for(this.get_EdgeGeometry()!=null&&this.get_EdgeGeometry().Translate(n),t=this.get_Labels().GetEnumerator();t.MoveNext();)i=t.get_Current(),i.Translate(n)},TransformRelativeTo:function(n,t){var i,r;if(this.get_EdgeGeometry()!=null){var u=new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(1,0,-n.get_Left(),0,1,-n.get_Bottom()),f=new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(t.get_Width()/n.get_Width(),0,0,0,t.get_Height()/n.get_Height(),0),e=new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(1,0,t.get_Left(),0,1,t.get_Bottom());this.Transform(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$PlaneTransformation(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$PlaneTransformation(e,f),u))}for(i=this.get_Labels().GetEnumerator();i.MoveNext();)r=i.get_Current(),r.Translate(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_LeftBottom(),n.get_LeftBottom()))},ArrowheadAtSource$$:"System.Boolean",get_ArrowheadAtSource:function(){return this.get_EdgeGeometry()!=null&&this.get_EdgeGeometry().get_SourceArrowhead()!=null},ArrowheadAtTarget$$:"System.Boolean",get_ArrowheadAtTarget:function(){return this.get_EdgeGeometry()!=null&&this.get_EdgeGeometry().get_TargetArrowhead()!=null},RaiseLayoutChangeEvent:function(n){this.edgeGeometry.RaiseLayoutChangeEvent(n)},add_BeforeLayoutChangeEvent:function(n){this.edgeGeometry.add_LayoutChangeEvent(n)},remove_BeforeLayoutChangeEvent:function(n){this.edgeGeometry.remove_LayoutChangeEvent(n)},UnderCollapsedCluster:function(){return this.get_Source().UnderCollapsedCluster()||this.get_Target().UnderCollapsedCluster()}}};JsTypes.push(Microsoft$Msagl$Core$Layout$Edge);Microsoft$Msagl$Layout$Layered$IntEdge={fullname:"Microsoft.Msagl.Layout.Layered.IntEdge",baseTypeName:"System.Object",staticDefinition:{GetOrder:function(n){for(var t,f,u=new Array(n.get_NodeCount()),e=new System.Collections.Generic.Stack$1.ctor(System.Int32.ctor),s=new System.Collections.Generic.Stack$1.ctor(System.Collections.Generic.IEnumerator$1.ctor),o=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),i,r=0;r<n.get_NodeCount();r++)if(!u[r]){t=r;u[t]=!0;i=new Microsoft.Msagl.Layout.Layered.Succ.ctor(n,r).GetEnumerator();do{while(i.MoveNext())f=i.get_Current(),u[f]||(u[f]=!0,e.Push(t),s.Push(i),t=f,i=new Microsoft.Msagl.Layout.Layered.Succ.ctor(n,t).GetEnumerator());if(o.Add(t),e.get_Count()>0)i=s.Pop(),t=e.Pop();else break}while(1)}return o.Reverse(),o.ToArray()}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerable$1","Microsoft.Msagl.Core.GraphAlgorithms.IEdge"],Kind:"Class",definition:{ctor$$Int32$$Int32:function(n,t){this.source=0;this.target=0;this.reversed=!1;this._hashKey=null;this.weight=1;this.crossingWeight=1;this.separation=0;this.layerEdges=null;this._IsVirtualEdge=!1;this._Edge=null;System.Object.ctor.call(this);this.source=n;this.target=t;this.UpdateHashKey()},Source$$:"System.Int32",get_Source:function(){return this.source},set_Source:function(n){this.source=n;this.UpdateHashKey()},Target$$:"System.Int32",get_Target:function(){return this.target},set_Target:function(n){this.target=n;this.UpdateHashKey()},Reversed$$:"System.Boolean",get_Reversed:function(){return this.reversed},IsVirtualEdge$$:"System.Boolean",get_IsVirtualEdge:function(){return this._IsVirtualEdge},set_IsVirtualEdge:function(n){this._IsVirtualEdge=n},HasLabel$$:"System.Boolean",get_HasLabel:function(){return this.get_Edge().get_Label()!=null},LabelWidth$$:"System.Double",get_LabelWidth:function(){return this.get_Edge().get_Label().get_Width()},LabelHeight$$:"System.Double",get_LabelHeight:function(){return this.get_Edge().get_Label().get_Height()},Revert:function(){var n=this.source;this.source=this.target;this.target=n;this.reversed=!this.reversed;this.UpdateHashKey()},Edge$$:"Microsoft.Msagl.Core.Layout.Edge",get_Edge:function(){return this._Edge},set_Edge:function(n){this._Edge=n},ctor$$Int32$$Int32$$Edge:function(n,t,i){this.source=0;this.target=0;this.reversed=!1;this._hashKey=null;this.weight=1;this.crossingWeight=1;this.separation=0;this.layerEdges=null;this._IsVirtualEdge=!1;this._Edge=null;System.Object.ctor.call(this);this.source=n;this.target=t;this.set_Edge(i);i!=null&&(this.set_Separation(i.get_Separation()),this.set_Weight(i.get_Weight()));this.UpdateHashKey()},Equals$$Object:function(n){var t=As(n,Microsoft.Msagl.Layout.Layered.IntEdge.ctor);return t==null?!1:t.source==this.source&&t.target==this.target},UpdateHashKey:function(){this._hashKey=""+this.source+","+this.target},GetHashCode:function(){var n=this.source.GetHashCode()|0;return(n<<5|n>>27)+this.target|0},toString:function(){return"Edge("+this.source+"->"+this.target+")"},Curve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Curve:function(){return this.get_Edge().get_Curve()},set_Curve:function(n){this.get_Edge().set_Curve(n)},UnderlyingPolyline$$:"Microsoft.Msagl.Core.Geometry.SmoothedPolyline",get_UnderlyingPolyline:function(){return this.get_Edge().get_UnderlyingPolyline()},set_UnderlyingPolyline:function(n){this.get_Edge().set_UnderlyingPolyline(n)},Weight$$:"System.Int32",get_Weight:function(){return this.weight},set_Weight:function(n){this.weight=n},CrossingWeight$$:"System.Int32",get_CrossingWeight:function(){return this.crossingWeight},Separation$$:"System.Int32",get_Separation:function(){return this.separation},set_Separation:function(n){this.separation=n},LayerSpan$$:"System.Int32",get_LayerSpan:function(){return this.layerEdges!=null?this.layerEdges.length:0},LayerEdges$$:"System.Collections.Generic.IList`1[[Microsoft.Msagl.Layout.Layered.LayerEdge]]",get_LayerEdges:function(){return this.layerEdges},set_LayerEdges:function(n){this.layerEdges=n instanceof Array||n==null?n:function(){throw new Error("InvalidCastException");}()},SelfEdge:function(){return this.source==this.target},ReversedClone:function(){var n=new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32$$Edge(this.target,this.source,this.get_Edge()),i,t,r;if(this.layerEdges!=null){for(i=this.layerEdges.length,n.layerEdges=new Array(i),t=0;t<i;t++)r=this.layerEdges[i-1-t],n.layerEdges[t]=new Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32(r.get_Target(),r.get_Source(),r.get_CrossingWeight());n.layerEdges[0].set_Source(this.target);n.layerEdges[this.layerEdges.length-1].set_Target(this.source)}return n.UpdateHashKey(),n},Item$$:"Microsoft.Msagl.Layout.Layered.LayerEdge",get_Item$$Int32:function(n){return this.layerEdges[n]},Count$$:"System.Int32",get_Count:function(){return this.layerEdges.length},UpdateEdgeLabelPosition:function(n){if(this.get_Edge().get_Label()!=null){var t=this.layerEdges.length/2|0,i=this.layerEdges[t];Microsoft.Msagl.Layout.Layered.Routing.UpdateLabel(this.get_Edge(),n[i.get_Source()])}},GetEnumerator:function(){var t=[];t.push(this.layerEdges[0].get_Source());for(var n=0,i=this.layerEdges,u=i.length,r=i[n];n<u;n++,r=i[n])t.push(r.get_Target());return t.GetEnumerator()}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$IntEdge);Microsoft$Msagl$Core$GraphAlgorithms$IntPair={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.IntPair",baseTypeName:"System.Object",staticDefinition:{op_LessThan:function(n,t){if(n!=null&&t!=null)return n.x<t.x||n.x==t.x&&n.y<t.y;throw $CreateException(new System.InvalidOperationException.ctor,new Error);},op_GreaterThan:function(n,t){return Microsoft.Msagl.Core.GraphAlgorithms.IntPair.op_LessThan(t,n)},Compare:function(n,t){return Microsoft.Msagl.Core.GraphAlgorithms.IntPair.op_LessThan(n,t)?1:n==t?0:-1}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.GraphAlgorithms.IEdge"],Kind:"Class",definition:{ctor:function(n,t){this.x=0;this.y=0;this._hashKey=null;System.Object.ctor.call(this);this.x=n;this.y=t;this.UpdateHashKey()},First$$:"System.Int32",get_First:function(){return this.x},set_First:function(n){this.x=n;this.UpdateHashKey()},Second$$:"System.Int32",get_Second:function(){return this.y},set_Second:function(n){this.y=n;this.UpdateHashKey()},Equals$$Object:function(n){var t=As(n,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor);return t==null?!1:this.x==t.x&&this.y==t.y},UpdateHashKey:function(){this._hashKey=""+this.x+","+this.y},GetHashCode:function(){var n=this.x.GetHashCode()|0;return(n<<5|n>>27)+this.y|0},toString:function(){return"("+this.x+","+this.y+")"},Source$$:"System.Int32",get_Source:function(){return this.x},set_Source:function(n){this.x=n;this.UpdateHashKey()},Target$$:"System.Int32",get_Target:function(){return this.y},set_Target:function(n){this.y=n;this.UpdateHashKey()}}};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$IntPair);Microsoft$Msagl$Layout$Layered$LayerArrays={fullname:"Microsoft.Msagl.Layout.Layered.LayerArrays",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.Y=null;this.verticesToX=null;this.layers=null;System.Object.ctor.call(this);this.Initialize(n)},Initialize:function(n){this.Y=n;this.verticesToX=null;this.layers=null},DropEmptyLayers:function(){for(var i,u,f,r=new Int32Array(this.get_Layers().length),t=0,n=0;n<this.get_Layers().length;n++)r[n]=t,this.get_Layers()[n].length==0&&t++;if(t==0)return this;for(i=new Int32Array(this.Y.length),n=0;n<i.length;n++)i[n]=this.Y[n]-r[this.Y[n]];for(u=new Array(this.layers.length-t),n=0;n<this.layers.length;n++)this.layers[n].length>0&&(u[n-r[n]]=this.layers[n].Clone()instanceof Int32Array||this.layers[n].Clone()==null?this.layers[n].Clone():function(){throw new Error("InvalidCastException");}());return f=new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(i),f.layers=u,f},UpdateLayers:function(n){this.layers==null&&this.InitLayers();for(var t=0;t<this.layers.length;t++)n[t].CopyTo(this.layers[t],0);this.UpdateXFromLayers()},UpdateXFromLayers:function(){var u;this.layers==null&&this.InitLayers();this.verticesToX==null&&(this.verticesToX=new Int32Array(this.Y.length));for(var n=0,r=this.layers,e=r.length,t=r[n];n<e;n++,t=r[n]){u=0;for(var i=0,o=t.length,f=t[i];i<o;i++,f=t[i])this.verticesToX[f]=u++}},X$$:"System.Int32[]",get_X:function(){return this.verticesToX!=null?this.verticesToX:(this.verticesToX=new Int32Array(this.Y.length),this.UpdateXFromLayers(),this.verticesToX)},ReversedClone:function(){for(var t=new Int32Array(this.Y.length),i=this.get_Layers().length-1,n=0;n<this.Y.length;n++)t[n]=i-this.Y[n];return new Microsoft.Msagl.Layout.Layered.LayerArrays.ctor(t)},Layers$$:"System.Int32[][]",get_Layers:function(){return this.layers!=null?this.layers:(this.InitLayers(),this.layers)},set_Layers:function(n){this.layers=n},InitLayers:function(){for(var r,n,i=0,u=0,e=this.Y,s=e.length,t=e[u];u<s;u++,t=e[u])t+1>i&&(i=t+1);r=new Int32Array(i);for(var f=0,o=this.Y,h=o.length,t=o[f];f<h;f++,t=o[f])r[t]++;for(this.layers=new Array(i),n=0;n<i;n++)this.layers[n]=new Int32Array(r[n]),r[n]=0;for(n=0;n<this.Y.length;n++)t=this.Y[n],this.layers[t][r[t]++]=n}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$LayerArrays);Microsoft$Msagl$Layout$Layered$SnapToGridByY={fullname:"Microsoft.Msagl.Layout.Layered.SnapToGridByY",staticDefinition:{None:0,Top:1,Bottom:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Layout$Layered$SnapToGridByY);Microsoft$Msagl$Layout$Layered$SugiyamaLayoutSettings={fullname:"Microsoft.Msagl.Layout.Layered.SugiyamaLayoutSettings",baseTypeName:"Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings",staticDefinition:{CalculateLayout:function(n,t,i){var r=new Microsoft.Msagl.Layout.Layered.LayeredLayoutEngine.ctor$$GeometryGraph$$SugiyamaLayoutSettings(n,t);return r.Run$$CancelToken(i),r}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.yLayerSep=30;this.verticalConstraints=new Microsoft.Msagl.Layout.Layered.VerticalConstraintsForSugiyama.ctor;this.horizontalConstraints=new Microsoft.Msagl.Layout.Layered.HorizontalConstraintsForSugiyama.ctor;this.repetitionCoefficentForOrdering=1;this.randomSeedForOrdering=1;this.noGainStepsBound=5;this.maxNumberOfPassesInOrdering=24;this.groupSplit=2;this.labelCornersPreserveCoefficient=.1;this.brandesThreshold=600;this.minimalWidth=0;this.minimalHeight=0;this.minNodeHeight=9;this.minNodeWidth=13.5;this.transformation=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.get_UnitTransformation();this.aspectRatio=0;this.maxAspectRatioEccentricity=5;this.snapToGridByY=Microsoft.Msagl.Layout.Layered.SnapToGridByY.None;this.gridSizeByY=0;this.gridSizeByX=0;this._LayeringOnly=!1;this._FallbackLayoutSettings=null;Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings.ctor.call(this);this.get_EdgeRoutingSettings().set_EdgeRoutingMode(Microsoft.Msagl.Core.Routing.EdgeRoutingMode.SugiyamaSplines)},LayerSeparation$$:"System.Double",get_LayerSeparation:function(){return this.yLayerSep},set_LayerSeparation:function(n){this.yLayerSep=System.Math.Max$$Double$$Double(10,n)},AddLeftRightConstraint:function(n,t){this.get_HorizontalConstraints().get_LeftRightConstraints().Insert(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n,t))},RemoveLeftRightConstraint:function(n,t){this.get_HorizontalConstraints().get_LeftRightConstraints().Remove(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n,t))},VerticalConstraints$$:"Microsoft.Msagl.Layout.Layered.VerticalConstraintsForSugiyama",get_VerticalConstraints:function(){return this.verticalConstraints},HorizontalConstraints$$:"Microsoft.Msagl.Layout.Layered.HorizontalConstraintsForSugiyama",get_HorizontalConstraints:function(){return this.horizontalConstraints},PinNodesToMaxLayer:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"nodes");for(var t=0;t<n.length;t++)this.get_VerticalConstraints().PinNodeToMaxLayer(n[t])},PinNodesToMinLayer:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"nodes");for(var t=0;t<n.length;t++)this.get_VerticalConstraints().PinNodeToMinLayer(n[t])},PinNodesToSameLayer:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"nodes");for(var t=1;t<n.length;t++)this.get_VerticalConstraints().get_SameLayerConstraints().Insert(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n[0],n[t]))},AddSameLayerNeighbors$$Node$Array:function(n){this.AddSameLayerNeighbors$$IEnumerable$1$Node(new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,n))},AddSameLayerNeighbors$$IEnumerable$1$Node:function(n){var i=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Node.ctor,n),t;for(this.get_HorizontalConstraints().AddSameLayerNeighbors(i),t=0;t<i.get_Count()-1;t++)this.get_VerticalConstraints().get_SameLayerConstraints().Insert(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,i.get_Item$$Int32(t),i.get_Item$$Int32(t+1)))},AddSameLayerNeighbors$$Node$$Node:function(n,t){this.get_HorizontalConstraints().AddSameLayerNeighborsPair(n,t);this.get_VerticalConstraints().get_SameLayerConstraints().Insert(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n,t))},RemoveAllConstraints:function(){this.get_HorizontalConstraints().Clear();this.get_VerticalConstraints().Clear()},AddUpDownConstraint:function(n,t){this.get_VerticalConstraints().get_UpDownConstraints().Insert(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n,t))},AddUpDownVerticalConstraint:function(n,t){this.get_VerticalConstraints().get_UpDownConstraints().Insert(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n,t));this.get_HorizontalConstraints().get_UpDownVerticalConstraints().Insert(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Core.Layout.Node.ctor,n,t))},AddUpDownVerticalConstraints:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"upDownNodes");for(var t=1;t<n.length;t++)this.AddUpDownVerticalConstraint(n[t-1],n[t])},LayeringOnly$$:"System.Boolean",get_LayeringOnly:function(){return this._LayeringOnly},set_LayeringOnly:function(n){this._LayeringOnly=n},RepetitionCoefficientForOrdering$$:"System.Int32",get_RepetitionCoefficientForOrdering:function(){return this.repetitionCoefficentForOrdering},set_RepetitionCoefficientForOrdering:function(n){this.repetitionCoefficentForOrdering=System.Math.Max$$Int32$$Int32(n,1)},RandomSeedForOrdering$$:"System.Int32",get_RandomSeedForOrdering:function(){return this.randomSeedForOrdering},set_RandomSeedForOrdering:function(n){this.randomSeedForOrdering=n},NoGainAdjacentSwapStepsBound$$:"System.Int32",get_NoGainAdjacentSwapStepsBound:function(){return this.noGainStepsBound},set_NoGainAdjacentSwapStepsBound:function(n){this.noGainStepsBound=n},MaxNumberOfPassesInOrdering$$:"System.Int32",get_MaxNumberOfPassesInOrdering:function(){return this.maxNumberOfPassesInOrdering},set_MaxNumberOfPassesInOrdering:function(n){this.maxNumberOfPassesInOrdering=n},GroupSplit$$:"System.Int32",get_GroupSplit:function(){return this.groupSplit},set_GroupSplit:function(n){this.groupSplit=n},LabelCornersPreserveCoefficient$$:"System.Double",get_LabelCornersPreserveCoefficient:function(){return this.labelCornersPreserveCoefficient},set_LabelCornersPreserveCoefficient:function(n){this.labelCornersPreserveCoefficient=n},BrandesThreshold$$:"System.Int32",get_BrandesThreshold:function(){return this.brandesThreshold},set_BrandesThreshold:function(n){this.brandesThreshold=n},Clone:function(){return As(this.MemberwiseClone(),Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings.ctor)},MinimalWidth$$:"System.Double",get_MinimalWidth:function(){return this.minimalWidth},set_MinimalWidth:function(n){this.minimalWidth=System.Math.Max$$Double$$Double(n,0)},MinimalHeight$$:"System.Double",get_MinimalHeight:function(){return this.minimalHeight},set_MinimalHeight:function(n){this.minimalHeight=System.Math.Max$$Double$$Double(n,0)},MinNodeHeight$$:"System.Double",get_MinNodeHeight:function(){return this.minNodeHeight},set_MinNodeHeight:function(n){this.minNodeHeight=System.Math.Max$$Double$$Double(.4,n)},MinNodeWidth$$:"System.Double",get_MinNodeWidth:function(){return this.minNodeWidth},set_MinNodeWidth:function(n){this.minNodeWidth=System.Math.Max$$Double$$Double(.8,n)},Transformation$$:"Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation",get_Transformation:function(){return this.transformation},set_Transformation:function(n){this.transformation=n},AspectRatio$$:"System.Double",get_AspectRatio:function(){return this.aspectRatio},set_AspectRatio:function(n){this.aspectRatio=n},ActualLayerSeparation:function(n){return n?this.get_LayerSeparation()/2:this.get_LayerSeparation()},MaxAspectRatioEccentricity$$:"System.Double",get_MaxAspectRatioEccentricity:function(){return this.maxAspectRatioEccentricity},set_MaxAspectRatioEccentricity:function(n){this.maxAspectRatioEccentricity=n},FallbackLayoutSettings$$:"Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings",get_FallbackLayoutSettings:function(){return this._FallbackLayoutSettings},set_FallbackLayoutSettings:function(n){this._FallbackLayoutSettings=n},SnapToGridByY$$:"Microsoft.Msagl.Layout.Layered.SnapToGridByY",get_SnapToGridByY:function(){return this.snapToGridByY},set_SnapToGridByY:function(n){this.snapToGridByY=n},GridSizeByY$$:"System.Double",get_GridSizeByY:function(){return this.gridSizeByY},set_GridSizeByY:function(n){this.gridSizeByY=n},GridSizeByX$$:"System.Double",get_GridSizeByX:function(){return this.gridSizeByX},set_GridSizeByX:function(n){this.gridSizeByX=n}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$SugiyamaLayoutSettings);Microsoft$Msagl$Core$Layout$LayoutAlgorithmSettings={fullname:"Microsoft.Msagl.Core.Layout.LayoutAlgorithmSettings",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.edgeRoutingSettings=new Microsoft.Msagl.Core.Routing.EdgeRoutingSettings.ctor;this.packingAspectRatio=Microsoft.Msagl.Core.Geometry.PackingConstants.GoldenRatio;this.packingMethod=Microsoft.Msagl.Core.Layout.PackingMethod.Compact;this.nodeSeparation=10;this.clusterMargin=10;this.liftCrossEdges=!0;System.Object.ctor.call(this)},EdgeRoutingSettings$$:"Microsoft.Msagl.Core.Routing.EdgeRoutingSettings",get_EdgeRoutingSettings:function(){return this.edgeRoutingSettings},set_EdgeRoutingSettings:function(n){this.edgeRoutingSettings=n},PackingAspectRatio$$:"System.Double",get_PackingAspectRatio:function(){return this.packingAspectRatio},set_PackingAspectRatio:function(n){this.packingAspectRatio=n},PackingMethod$$:"Microsoft.Msagl.Core.Layout.PackingMethod",get_PackingMethod:function(){return this.packingMethod},set_PackingMethod:function(n){this.packingMethod=n},NodeSeparation$$:"System.Double",get_NodeSeparation:function(){return this.nodeSeparation},set_NodeSeparation:function(n){this.nodeSeparation=n},ClusterMargin$$:"System.Double",get_ClusterMargin:function(){return this.clusterMargin},set_ClusterMargin:function(n){this.clusterMargin=n},LiftCrossEdges$$:"System.Boolean",get_LiftCrossEdges:function(){return this.liftCrossEdges},set_LiftCrossEdges:function(n){this.liftCrossEdges=n}}};JsTypes.push(Microsoft$Msagl$Core$Layout$LayoutAlgorithmSettings);Microsoft$Msagl$Core$Layout$Node={fullname:"Microsoft.Msagl.Core.Layout.Node",baseTypeName:"Microsoft.Msagl.Core.Layout.GeometryObject",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.padding=1;this.boundaryCurve=null;this.inEdges_=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.outEdges_=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.selfEdges_=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.clusterParents=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor);this._DebugId=null;Microsoft.Msagl.Core.Layout.GeometryObject.ctor.call(this)},DebugId$$:"System.Object",get_DebugId:function(){return this._DebugId},set_DebugId:function(n){this._DebugId=n},Padding$$:"System.Double",get_Padding:function(){return this.padding},set_Padding:function(n){this.padding=n},BoundaryCurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_BoundaryCurve:function(){return this.boundaryCurve},set_BoundaryCurve:function(n){this.RaiseLayoutChangeEvent(n);this.boundaryCurve=n},ctor$$ICurve:function(n){this.padding=1;this.boundaryCurve=null;this.inEdges_=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.outEdges_=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.selfEdges_=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.clusterParents=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor);this._DebugId=null;Microsoft.Msagl.Core.Layout.GeometryObject.ctor.call(this);this.boundaryCurve=n},ctor$$ICurve$$Object:function(n,t){this.padding=1;this.boundaryCurve=null;this.inEdges_=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.outEdges_=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.selfEdges_=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor);this.clusterParents=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Cluster.ctor);this._DebugId=null;Microsoft.Msagl.Core.Layout.GeometryObject.ctor.call(this);this.boundaryCurve=n;this.set_UserData(t)},toString:function(){return this.get_UserData()!=null?this.get_UserData().toString():System.Object.commonPrototype.toString.call(this)},InEdges$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Edge]]",get_InEdges:function(){return this.inEdges_},set_InEdges:function(n){this.inEdges_=Cast(n,Microsoft.Msagl.Core.DataStructures.Set$1.ctor)},OutEdges$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Edge]]",get_OutEdges:function(){return this.outEdges_},set_OutEdges:function(n){this.outEdges_=Cast(n,Microsoft.Msagl.Core.DataStructures.Set$1.ctor)},SelfEdges$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Edge]]",get_SelfEdges:function(){return this.selfEdges_},set_SelfEdges:function(n){this.selfEdges_=Cast(n,Microsoft.Msagl.Core.DataStructures.Set$1.ctor)},ClusterParents$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Cluster]]",get_ClusterParents:function(){return this.clusterParents},set_ClusterParents:function(n){this.clusterParents=Cast(n,System.Collections.Generic.List$1.ctor)},AllClusterAncestors$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Cluster]]",get_AllClusterAncestors:function(){for(var t=[],n=System.Linq.Enumerable.FirstOrDefault$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,this.get_ClusterParents());n!=null;)t.push(n),n=System.Linq.Enumerable.FirstOrDefault$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,n.get_ClusterParents());return t},AddClusterParent:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"parent");System.Diagnostics.Debug.Assert$$Boolean(n!=this);this.clusterParents.Add(n)},RemoveSelfEdge:function(n){return this.selfEdges_.Remove(n)},AddOutEdge:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edge");System.Diagnostics.Debug.Assert$$Boolean(n.get_Source()!=n.get_Target());System.Diagnostics.Debug.Assert$$Boolean(n.get_Source()==this);this.outEdges_.Insert(n)},AddInEdge:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edge");System.Diagnostics.Debug.Assert$$Boolean(n.get_Source()!=n.get_Target());System.Diagnostics.Debug.Assert$$Boolean(n.get_Target()==this);this.inEdges_.Insert(n)},AddSelfEdge:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edge");System.Diagnostics.Debug.Assert$$Boolean(n.get_Target()==this&&n.get_Source()==this);this.selfEdges_.Insert(n)},Edges$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.Edge]]",get_Edges:function(){for(var t=[],u=this.outEdges_.GetEnumerator(),i,r,n;u.MoveNext();)n=u.get_Current(),t.push(n);for(i=this.inEdges_.GetEnumerator();i.MoveNext();)n=i.get_Current(),t.push(n);for(r=this.selfEdges_.GetEnumerator();r.MoveNext();)n=r.get_Current(),t.push(n);return t},Center$$:"Microsoft.Msagl.Core.Geometry.Point",get_Center:function(){return this.get_BoundaryCurve().get_BoundingBox().get_Center()},set_Center:function(n){var t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,this.get_Center());(t.get_X()!=0||t.get_Y()!=0)&&(this.RaiseLayoutChangeEvent(n),this.get_BoundaryCurve().Translate(t))},FitBoundaryCurveToTarget:function(n){var t,i,r;this.get_BoundaryCurve()!=null&&(t=As(this.get_BoundaryCurve(),Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor),t==null?(System.Diagnostics.Debug.Assert$$Boolean(this.get_BoundaryCurve().get_BoundingBox().get_Width()>0),System.Diagnostics.Debug.Assert$$Boolean(this.get_BoundaryCurve().get_BoundingBox().get_Height()>0),i=n.get_Width()/this.get_BoundaryCurve().get_BoundingBox().get_Width(),r=n.get_Height()/this.get_BoundaryCurve().get_BoundingBox().get_Height(),this.get_BoundaryCurve().Translate(Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(this.get_BoundaryCurve().get_BoundingBox().get_LeftBottom())),this.set_BoundaryCurve(this.get_BoundaryCurve().ScaleFromOrigin(i,r)),this.get_BoundaryCurve().Translate(n.get_LeftBottom())):this.set_BoundaryCurve(t.FitTo(n)),System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Rectangle$$Rectangle$$Double(this.get_BoundaryCurve().get_BoundingBox(),n,Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_UserDefinedTolerance()),"FitToBounds didn't succeed in scaling/translating to target bounds"))},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){return this.get_BoundaryCurve()!=null?this.get_BoundaryCurve().get_BoundingBox():Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox()},set_BoundingBox:function(n){System.Math.Abs$$Double(n.get_Width()-this.get_Width())<.01&&System.Math.Abs$$Double(n.get_Height()-this.get_Height())<.01?this.set_Center(n.get_Center()):this.FitBoundaryCurveToTarget(n)},Width$$:"System.Double",get_Width:function(){return this.get_BoundaryCurve().get_BoundingBox().get_Width()},Height$$:"System.Double",get_Height:function(){return this.get_BoundaryCurve().get_BoundingBox().get_Height()},Degree$$:"System.Int32",get_Degree:function(){return System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,this.get_OutEdges())+System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,this.get_InEdges())+System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Edge.ctor,this.get_SelfEdges())},RemoveInEdge:function(n){return this.inEdges_.Remove(n)},RemoveOutEdge:function(n){return this.outEdges_.Remove(n)},ClearEdges:function(){this.inEdges_.Clear();this.outEdges_.Clear()},Transform:function(n){this.get_BoundaryCurve()!=null&&this.set_BoundaryCurve(this.get_BoundaryCurve().Transform(n))},IsDescendantOf:function(n){for(var t=new System.Collections.Generic.Queue$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Cluster.ctor,this.get_ClusterParents()),i,r,u;t.get_Count()>0;){if(i=t.Dequeue(),i==n)return!0;for(r=i.get_ClusterParents().GetEnumerator();r.MoveNext();)u=r.get_Current(),t.Enqueue(u)}return!1},UnderCollapsedCluster:function(){return System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Cluster.ctor,this.get_ClusterParents(),$CreateAnonymousDelegate(this,function(n){return n.get_IsCollapsed()}))}}};JsTypes.push(Microsoft$Msagl$Core$Layout$Node);Microsoft$Msagl$Layout$Layered$Anchor={fullname:"Microsoft.Msagl.Layout.Layered.Anchor",baseTypeName:"System.Object",staticDefinition:{Pad:function(n,t){return t==0?n:Microsoft.Msagl.Layout.Layered.Anchor.CurveIsConvex(n)?Microsoft.Msagl.Layout.Layered.Anchor.PadConvexCurve(n,t):Microsoft.Msagl.Layout.Layered.Anchor.PadConvexCurve(Microsoft.Msagl.Core.Geometry.Curves.Curve.StandardRectBoundary(n),t)},PadCorner:function(n,t,i,r,u){var f,e,o=function(){var n={Value:f},o={Value:e},s=Microsoft.Msagl.Layout.Layered.Anchor.GetPaddedCorner(t,i,r,n,o,u);return f=n.Value,e=o.Value,s}();n.AddPoint$$Point(f);o==2&&n.AddPoint$$Point(e)},PadConvexCurve:function(n,t){var r=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,i;for(Microsoft.Msagl.Layout.Layered.Anchor.PadCorner(r,n.get_EndPoint().get_Prev(),n.get_EndPoint(),n.get_StartPoint(),t),Microsoft.Msagl.Layout.Layered.Anchor.PadCorner(r,n.get_EndPoint(),n.get_StartPoint(),n.get_StartPoint().get_Next(),t),i=n.get_StartPoint();i.get_Next().get_Next()!=null;i=i.get_Next())Microsoft.Msagl.Layout.Layered.Anchor.PadCorner(r,i,i.get_Next(),i.get_Next().get_Next(),t);return r.set_Closed(!0),r},GetPaddedCorner:function(n,t,i,r,u,f){var c=n.get_Point(),e=t.get_Point(),v=i.get_Point(),s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,c).Rotate(1.5707963267949).Normalize(),l=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,c).Normalize(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,v).Normalize());if(l.get_Length()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon())return r.Value=u.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(e,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(f,s)),1;var o=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(l.Normalize(),f),h=o.Rotate(1.5707963267949),a=(f-Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(o,s))/Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(h,s);return r.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(o,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(a,h)),e),u.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(o,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(a,h)),e),2},CurveIsConvex:function(n){var i=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n.get_EndPoint().get_Point(),n.get_StartPoint().get_Point(),n.get_StartPoint().get_Next().get_Point()),t;if(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n.get_EndPoint().get_Prev().get_Point(),n.get_EndPoint().get_Point(),n.get_StartPoint().get_Point())!=i)return!1;for(t=n.get_StartPoint();t.get_Next().get_Next()!=null;){if(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Point(),t.get_Next().get_Point(),t.get_Next().get_Next().get_Point())!=i)return!1;t=t.get_Next()}return!0}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Double:function(n){this.la=0;this.ra=0;this.ta=0;this.ba=0;this.labelCornersPreserveCoefficient=0;this.node=null;this.x=0;this.y=0;this.alreadySitsOnASpline=!1;this.labelIsToTheLeftOfTheSpline=!1;this.labelIsToTheRightOfTheSpline=!1;this.polygonalBoundary=null;this.padding=0;System.Object.ctor.call(this);this.labelCornersPreserveCoefficient=n},toString:function(){return"la:ra "+this.la.ToString$$String$$IFormatProvider("#.##",System.Globalization.CultureInfo.get_InvariantCulture())+" "+this.ra.ToString$$String$$IFormatProvider("#.##",System.Globalization.CultureInfo.get_InvariantCulture())+" ta:ba "+this.ta.ToString$$String$$IFormatProvider("#.##",System.Globalization.CultureInfo.get_InvariantCulture())+" "+this.ba.ToString$$String$$IFormatProvider("#.##",System.Globalization.CultureInfo.get_InvariantCulture())+" x:y "+this.x.ToString$$String$$IFormatProvider("#.##",System.Globalization.CultureInfo.get_InvariantCulture())+" "+this.y.ToString$$String$$IFormatProvider("#.##",System.Globalization.CultureInfo.get_InvariantCulture())},LeftAnchor$$:"System.Double",get_LeftAnchor:function(){return this.la},set_LeftAnchor:function(n){this.la=System.Math.Max$$Double$$Double(n,0)},RightAnchor$$:"System.Double",get_RightAnchor:function(){return this.ra},set_RightAnchor:function(n){this.ra=System.Math.Max$$Double$$Double(n,0)},TopAnchor$$:"System.Double",get_TopAnchor:function(){return this.ta},set_TopAnchor:function(n){this.ta=System.Math.Max$$Double$$Double(n,0)},BottomAnchor$$:"System.Double",get_BottomAnchor:function(){return this.ba},set_BottomAnchor:function(n){this.ba=System.Math.Max$$Double$$Double(n,0)},Left$$:"System.Double",get_Left:function(){return this.x-this.la},Right$$:"System.Double",get_Right:function(){return this.x+this.ra},Top$$:"System.Double",get_Top:function(){return this.y+this.ta},set_Top:function(n){this.y+=n-this.get_Top()},Bottom$$:"System.Double",get_Bottom:function(){return this.y-this.ba},set_Bottom:function(n){this.y+=n-this.get_Bottom()},LeftTop$$:"Microsoft.Msagl.Core.Geometry.Point",get_LeftTop:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Left(),this.get_Top())},LeftBottom$$:"Microsoft.Msagl.Core.Geometry.Point",get_LeftBottom:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Left(),this.get_Bottom())},RightBottom$$:"Microsoft.Msagl.Core.Geometry.Point",get_RightBottom:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Right(),this.get_Bottom())},Node$$:"Microsoft.Msagl.Core.Layout.Node",get_Node:function(){return this.node},set_Node:function(n){this.node=n;this.polygonalBoundary=null},RightTop$$:"Microsoft.Msagl.Core.Geometry.Point",get_RightTop:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Right(),this.get_Top())},ctor$$Double$$Double$$Double$$Double$$Node$$Double:function(n,t,i,r,u,f){this.la=0;this.ra=0;this.ta=0;this.ba=0;this.labelCornersPreserveCoefficient=0;this.node=null;this.x=0;this.y=0;this.alreadySitsOnASpline=!1;this.labelIsToTheLeftOfTheSpline=!1;this.labelIsToTheRightOfTheSpline=!1;this.polygonalBoundary=null;this.padding=0;System.Object.ctor.call(this);this.la=n;this.ra=t;this.ta=i;this.ba=r;this.set_Node(u);this.labelCornersPreserveCoefficient=f},X$$:"System.Double",get_X:function(){return this.x},set_X:function(n){this.polygonalBoundary=null;this.x=n},Y$$:"System.Double",get_Y:function(){return this.y},set_Y:function(n){this.polygonalBoundary=null;this.y=n},Origin$$:"Microsoft.Msagl.Core.Geometry.Point",get_Origin:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.x,this.y)},AlreadySitsOnASpline$$:"System.Boolean",get_AlreadySitsOnASpline:function(){return this.alreadySitsOnASpline},set_AlreadySitsOnASpline:function(n){this.alreadySitsOnASpline=n},Width$$:"System.Double",get_Width:function(){return this.la+this.ra},Height$$:"System.Double",get_Height:function(){return this.ta+this.ba},RepresentsLabel$$:"System.Boolean",get_RepresentsLabel:function(){return this.get_LabelToTheRightOfAnchorCenter()||this.get_LabelToTheLeftOfAnchorCenter()},LabelToTheLeftOfAnchorCenter$$:"System.Boolean",get_LabelToTheLeftOfAnchorCenter:function(){return this.labelIsToTheLeftOfTheSpline},set_LabelToTheLeftOfAnchorCenter:function(n){this.labelIsToTheLeftOfTheSpline=n},LabelToTheRightOfAnchorCenter$$:"System.Boolean",get_LabelToTheRightOfAnchorCenter:function(){return this.labelIsToTheRightOfTheSpline},set_LabelToTheRightOfAnchorCenter:function(n){this.labelIsToTheRightOfTheSpline=n},HasLabel$$:"System.Boolean",get_HasLabel:function(){return this.get_LabelToTheRightOfAnchorCenter()||this.get_LabelToTheLeftOfAnchorCenter()},LabelWidth$$:"System.Double",get_LabelWidth:function(){if(this.get_LabelToTheLeftOfAnchorCenter())return this.get_LeftAnchor();if(this.get_LabelToTheRightOfAnchorCenter())return this.get_RightAnchor();throw $CreateException(new System.InvalidOperationException.ctor,new Error);},PolygonalBoundary$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_PolygonalBoundary:function(){return this.polygonalBoundary!=null?this.polygonalBoundary:this.polygonalBoundary=Microsoft.Msagl.Layout.Layered.Anchor.Pad(this.CreatPolygonalBoundaryWithoutPadding(),this.get_Padding())},CreatPolygonalBoundaryWithoutPadding:function(){return this.get_HasLabel()?this.get_LabelToTheLeftOfAnchorCenter()?this.PolygonOnLeftLabel():this.PolygonOnRightLabel():this.get_NodeBoundary()==null?this.StandardRectBoundary():Microsoft.Msagl.Core.Geometry.Curves.Curve.PolylineAroundClosedCurve(this.get_NodeBoundary())},StandardRectBoundary:function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor;return n.AddPoint$$Point(this.get_LeftTop()),n.AddPoint$$Point(this.get_RightTop()),n.AddPoint$$Point(this.get_RightBottom()),n.AddPoint$$Point(this.get_LeftBottom()),n.set_Closed(!0),n},PolygonOnLeftLabel:function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,t=this.get_Left()+(1-this.labelCornersPreserveCoefficient)*this.get_LabelWidth();return n.AddPoint$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,this.get_Top())),n.AddPoint$$Point(this.get_RightTop()),n.AddPoint$$Point(this.get_RightBottom()),n.AddPoint$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,this.get_Bottom())),n.AddPoint$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Left(),this.get_Y())),n.set_Closed(!0),n},PolygonOnRightLabel:function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,t=this.get_Right()-(1-this.labelCornersPreserveCoefficient)*this.get_LabelWidth();return n.AddPoint$$Double$$Double(t,this.get_Top()),n.AddPoint$$Double$$Double(this.get_Right(),this.get_Y()),n.AddPoint$$Double$$Double(t,this.get_Bottom()),n.AddPoint$$Double$$Double(this.get_Left(),this.get_Bottom()),n.AddPoint$$Double$$Double(this.get_Left(),this.get_Top()),n.set_Closed(!0),n},NodeBoundary$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_NodeBoundary:function(){return this.get_Node()!=null?this.get_Node().get_BoundaryCurve():null},Padding$$:"System.Double",get_Padding:function(){return this.padding},set_Padding:function(n){this.padding=n},Move:function(n){this.set_X(this.get_X()+n.get_X());this.set_Y(this.get_Y()+n.get_Y())}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$Anchor);Microsoft$Msagl$Core$DataStructures$Set$1={fullname:"Microsoft.Msagl.Core.DataStructures.Set$1",baseTypeName:"System.MarshalByRefObject",staticDefinition:{op_Addition:function(n,t){var i,r,u;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"set1"),i=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(this.T,n),r=t.GetEnumerator();r.MoveNext();)u=r.get_Current(),i.Insert(u);return i},op_Subtraction:function(n,t){var i,r,u;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"set1"),i=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(this.T,n),r=t.GetEnumerator();r.MoveNext();)u=r.get_Current(),i.Remove(u);return i},op_Equality:function(n,t){var r,u,i;if(n==null&&t==null)return!0;if(n==null&&t!=null||t==null&&n!=null)return!1;for(r=n.GetEnumerator();r.MoveNext();)if(i=r.get_Current(),!t.Contains$$T(i))return!1;for(u=t.GetEnumerator();u.MoveNext();)if(i=u.get_Current(),!n.Contains$$T(i))return!1;return!0},op_Inequality:function(n,t){return!Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(n,t)},op_Multiply:function(n,t){return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"set0"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"set1"),new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(this.T,n.get_Count()<t.get_Count()?System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(this.T,n,function(n){return t.Contains$$T(n)}):System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(this.T,t,function(t){return n.Contains$$T(t)}))}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.ICollection$1"],Kind:"Class",definition:{ctor$$IEnumerable$1:function(n,t){var i,r;for(this.T=n,this.hashSet=new System.Collections.Generic.HashSet$1.ctor(this.T),this._hashKey=null,System.MarshalByRefObject.ctor.call(this),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"enumerableCollection"),i=t.GetEnumerator();i.MoveNext();)r=i.get_Current(),this.Insert(r);this.UpdateHashKey()},Insert:function(n){this.hashSet.Add(n);this.UpdateHashKey()},Contains$$T:function(n){return this.hashSet.Contains(n)},Delete:function(n){this.hashSet.Remove(n);this.UpdateHashKey()},Remove:function(n){var t=this.hashSet.Remove(n);return this.UpdateHashKey(),t},Count$$:"System.Int32",get_Count:function(){return this.hashSet.get_Count()},GetEnumerator:function(){return this.hashSet.GetEnumerator()},IsReadOnly$$:"System.Boolean",get_IsReadOnly:function(){return!1},CopyTo:function(n,t){this.hashSet.CopyTo$$T$Array$$Int32(n,t)},toString:function(){for(var n="{",t=0,i=this.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),n+=r.toString(),t++,t<this.get_Count()&&(n+=",");return n+"}"},Clear:function(){this.hashSet.Clear();this.UpdateHashKey()},Clone:function(){for(var n=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(this.T),t=this.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.Insert(i);return n},ctor:function(n){this.T=n;this.hashSet=new System.Collections.Generic.HashSet$1.ctor(this.T);this._hashKey=null;System.MarshalByRefObject.ctor.call(this)},ToArray:function(n){for(var t=System.Array.CreateInstance(n,this.get_Count()),u=0,i=this.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.SetValue(r,u++);return t},Equals$$Object:function(n){var t=As(n,Microsoft.Msagl.Core.DataStructures.Set$1.ctor);return Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(t,null)?!1:Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(t,this)},GetHashCode:function(){for(var n=0,t=this.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n|=i.GetHashCode();return n},Add:function(n,t){return Microsoft.Msagl.Core.DataStructures.Set$1.op_Addition(n,t)},InsertRange:function(n){var t,i;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"elements"),t=n.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.Insert(i)},IsContained:function(n){return System.Linq.Enumerable.All$1(this.T,this,$CreateAnonymousDelegate(this,function(t){return n.Contains$$T(t)}))},Contains$$Set$1:function(n){return System.Linq.Enumerable.All$1(this.T,n,$CreateAnonymousDelegate(this,function(n){return this.Contains$$T(n)}))},UpdateHashKey:function(){this._hashKey=this.GetHashCode().toString()}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$Set$1);Microsoft$Msagl$Layout$Layered$LayerEdge={fullname:"Microsoft.Msagl.Layout.Layered.LayerEdge",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Int32$$Int32$$Int32$$Int32:function(n,t,i,r){this.Weight=1;this.source=0;this.target=0;this.crossingWeight=1;System.Object.ctor.call(this);this.set_Source(n);this.set_Target(t);this.crossingWeight=i;this.Weight=r},ctor$$Int32$$Int32$$Int32:function(n,t,i){this.Weight=1;this.source=0;this.target=0;this.crossingWeight=1;Microsoft.Msagl.Layout.Layered.LayerEdge.ctor$$Int32$$Int32$$Int32$$Int32.call(this,n,t,i,1)},Source$$:"System.Int32",get_Source:function(){return this.source},set_Source:function(n){this.source=n},Target$$:"System.Int32",get_Target:function(){return this.target},set_Target:function(n){this.target=n},Equals$$Object:function(n){var t=As(n,Microsoft.Msagl.Layout.Layered.LayerEdge.ctor);return t.source==this.source&&t.target==this.target},GetHashCode:function(){var n=this.source.GetHashCode()|0;return(n<<5|n>>27)+this.target|0},CrossingWeight$$:"System.Int32",get_CrossingWeight:function(){return this.crossingWeight},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0}->{1}",[this.source,this.target])}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$LayerEdge);Microsoft$Msagl$Layout$Layered$SuccEnumerator={fullname:"Microsoft.Msagl.Layout.Layered.SuccEnumerator",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerator$1"],Kind:"Class",definition:{ctor:function(n){this.edges=null;System.Object.ctor.call(this);this.edges=n},Reset:function(){this.edges.Reset()},Dispose:function(){System.GC.SuppressFinalize(this)},MoveNext:function(){return this.edges.MoveNext()},Current$$:"System.Int32",get_Current:function(){return Cast(this.edges.get_Current(),Microsoft.Msagl.Layout.Layered.IntEdge.ctor).get_Target()}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$SuccEnumerator);Microsoft$Msagl$Layout$Layered$PredEnumerator={fullname:"Microsoft.Msagl.Layout.Layered.PredEnumerator",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerator$1"],Kind:"Class",definition:{ctor:function(n){this.edges=null;System.Object.ctor.call(this);this.edges=n},Dispose:function(){System.GC.SuppressFinalize(this)},Reset:function(){this.edges.Reset()},Current$$:"System.Int32",get_Current:function(){return Cast(this.edges.get_Current(),Microsoft.Msagl.Layout.Layered.IntEdge.ctor).get_Source()},MoveNext:function(){return this.edges.MoveNext()}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$PredEnumerator);Microsoft$Msagl$Layout$Layered$EmptyEnumerator={fullname:"Microsoft.Msagl.Layout.Layered.EmptyEnumerator",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerator$1"],Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)},MoveNext:function(){return!1},Current$$:"System.Int32",get_Current:function(){return 0},Dispose:function(){System.GC.SuppressFinalize(this)}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$EmptyEnumerator);Microsoft$Msagl$Layout$Layered$Pred={fullname:"Microsoft.Msagl.Layout.Layered.Pred",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor:function(n,t){this.graph=null;this.vert=0;System.Object.ctor.call(this);this.graph=n;this.vert=t},GetEnumerator:function(){var n=this.graph.InEdges(this.vert);return n==null?new Microsoft.Msagl.Layout.Layered.EmptyEnumerator.ctor:new Microsoft.Msagl.Layout.Layered.PredEnumerator.ctor(n.GetEnumerator())}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$Pred);Microsoft$Msagl$Layout$Layered$Succ={fullname:"Microsoft.Msagl.Layout.Layered.Succ",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.graph=null;this.vert=0;System.Object.ctor.call(this);this.graph=n;this.vert=t},GetEnumerator:function(){return new Microsoft.Msagl.Layout.Layered.SuccEnumerator.ctor(this.graph.OutEdges(this.vert).GetEnumerator())}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$Succ);Microsoft$Msagl$Layout$Layered$XLayoutGraph={fullname:"Microsoft.Msagl.Layout.Layered.XLayoutGraph",baseTypeName:"Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this.layeredGraph=null;this.layerArrays=null;this.virtualVerticesStart=0;this.virtualVerticesEnd=0;this.weightMultiplierOfOriginalOriginal=1;this.weightMultOfOneVirtual=3;this.weightMultiplierOfTwoVirtual=8;Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor.call(this,Microsoft.Msagl.Layout.Layered.IntEdge.ctor);this.SetEdges(r,u);this.virtualVerticesStart=n.get_NodeCount();this.virtualVerticesEnd=t.get_NodeCount()-1;this.layeredGraph=t;this.layerArrays=i},EdgeWeightMultiplier:function(n){var t=n.get_Source(),e=n.get_Target(),i,f;if(t<this.layeredGraph.get_NodeCount()&&this.layerArrays.Y[t]==this.layerArrays.Y[e]&&this.layerArrays.get_X()[t]==this.layerArrays.get_X()[e]+1)return 0;i=0;System.Diagnostics.Debug.Assert$$Boolean(t>=this.layeredGraph.get_NodeCount());for(var r=-1,u=-1,o=this.OutEdges(t).GetEnumerator();o.MoveNext();)f=o.get_Current(),r==-1?r=f.get_Target():u=f.get_Target();return r>=this.virtualVerticesStart&&r<=this.virtualVerticesEnd&&i++,u>=this.virtualVerticesStart&&u<=this.virtualVerticesEnd&&i++,i==0?this.weightMultiplierOfOriginalOriginal:i==1?this.weightMultOfOneVirtual:this.weightMultiplierOfTwoVirtual},SetEdgeWeights:function(){for(var t=this.get_Edges().GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),n.set_Weight(n.get_Weight()*this.EdgeWeightMultiplier(n))}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$XLayoutGraph);Microsoft$Msagl$Layout$Layered$OrderingMeasure={fullname:"Microsoft.Msagl.Layout.Layered.OrderingMeasure",baseTypeName:"System.Object",staticDefinition:{op_LessThan:function(n,t){return n.numberOfCrossings<t.numberOfCrossings?!0:n.numberOfCrossings>t.numberOfCrossings?!1:n.layerGroupDisbalance|0<t.layerGroupDisbalance|0},op_GreaterThan:function(n,t){return n.numberOfCrossings>t.numberOfCrossings?!0:n.numberOfCrossings<t.numberOfCrossings?!1:n.layerGroupDisbalance|0>t.layerGroupDisbalance|0}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this.numberOfCrossings=0;this.layerGroupDisbalance=0;this.la=null;this.virtVertexStart=0;this.optimalOriginalGroupSize=null;this.optimalVirtualGroupSize=null;System.Object.ctor.call(this);this.numberOfCrossings=t;this.la=n;this.virtVertexStart=i;this.optimalVirtualGroupSize=u;this.optimalOriginalGroupSize=r;this.optimalOriginalGroupSize!=null&&this.CalculateLayerGroupDisbalance()},CalculateLayerGroupDisbalance:function(){for(var n=0;n<this.la.length;n++)this.layerGroupDisbalance+=this.LayerGroupDisbalance(this.la[n],this.optimalOriginalGroupSize[n],this.optimalVirtualGroupSize[n])},LayerGroupDisbalance:function(n,t,i){return t==1?this.LayerGroupDisbalanceWithOrigSeparators(n,i):this.LayerGroupDisbalanceWithVirtSeparators(n,t)},LayerGroupDisbalanceWithVirtSeparators:function(n,t){for(var r=0,i=0;i<n.length;)r+=function(){var r={Value:i},u=this.CurrentOrigGroupDelta(r,n,t);return i=r.Value,u}.call(this);return r},CurrentOrigGroupDelta:function(n,t,i){for(var u=0,r=n.Value;r<t.length&&t[r]<this.virtVertexStart;r++)u++;return n.Value=r+1,System.Math.Abs$$Double(i-u)},LayerGroupDisbalanceWithOrigSeparators:function(n,t){for(var r=0,i=0;i<n.length;)r+=function(){var r={Value:i},u=this.CurrentVirtGroupDelta(r,n,t);return i=r.Value,u}.call(this);return r},CurrentVirtGroupDelta:function(n,t,i){for(var u=0,r=n.Value;r<t.length&&t[r]>=this.virtVertexStart;r++)u++;return n.Value=r+1,System.Math.Abs$$Double(i-u)},IsPerfect:function(){return this.numberOfCrossings==0&&this.layerGroupDisbalance==0}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$OrderingMeasure);Microsoft$Msagl$Core$ProjectionSolver$Block={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Block",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.sumAd=0;this.sumAb=0;this.sumA2=0;this.constraintPath=null;this.pathTargetVariable=null;this.idDfDv=0;this.allConstraints=null;this.dfDvDummyParentNode=null;this._Variables=null;this._ReferencePos=0;this._Scale=0;this._VectorIndex=0;System.Object.ctor.call(this);this.set_Variables(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.Variable.ctor));null!=n&&this.AddVariable(n);this.allConstraints=t},Variables$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.ProjectionSolver.Variable]]",get_Variables:function(){return this._Variables},set_Variables:function(n){this._Variables=n},ReferencePos$$:"System.Double",get_ReferencePos:function(){return this._ReferencePos},set_ReferencePos:function(n){this._ReferencePos=n},Scale$$:"System.Double",get_Scale:function(){return this._Scale},set_Scale:function(n){this._Scale=n},VectorIndex$$:"System.Int32",get_VectorIndex:function(){return this._VectorIndex},set_VectorIndex:function(n){this._VectorIndex=n},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"[Block: nvars = {0} refpos = {1:F5} scale = {2:F5}]",[this.get_Variables().get_Count(),this.get_ReferencePos(),this.get_Scale()])},DebugVerifyFinalDfDvValue:function(n,t){var i=System.Math.Max$$Double$$Double(this.sumAd,System.Math.Max$$Double$$Double(this.sumAb,this.sumA2));System.Diagnostics.Debug.Assert$$Boolean$$String(System.Math.Abs$$Double(n)/i<.001,t)},ComputeDfDv:function(n){var u,o,t,c,r;for(System.Diagnostics.Debug.Assert$$Boolean$$String(0!=this.idDfDv,"idDfDv should not be 0"),System.Diagnostics.Debug.Assert$$Boolean$$String(0==this.allConstraints.DfDvStack.get_Count(),"Leftovers in ComputeDfDvStack"),this.allConstraints.DfDvStack.Clear(),u=new Microsoft.Msagl.Core.ProjectionSolver.Constraint.ctor$$Variable(n),this.dfDvDummyParentNode=new Microsoft.Msagl.Core.ProjectionSolver.DfDvNode.ctor$$Constraint(u),o=this.GetDfDvNode(this.dfDvDummyParentNode,u,n,null),this.allConstraints.DfDvStack.Push(o);;){if(t=this.allConstraints.DfDvStack.Peek(),c=this.allConstraints.DfDvStack.get_Count(),!t.get_ChildrenHaveBeenPushed()){t.set_ChildrenHaveBeenPushed(!0);for(var f=0,s=t.get_VariableToEval().get_LeftConstraints(),l=s.length,i=s[f];f<l;f++,i=s[f])System.Diagnostics.Debug.Assert$$Boolean$$String(!i.get_IsActive()||!(t.get_IsLeftToRight()&&i.get_Right()==t.get_VariableDoneEval()),"this cycle should not happen"),i.get_IsActive()&&i.get_Right()!=t.get_VariableDoneEval()&&(r=this.GetDfDvNode(t,i,i.get_Right(),t.get_VariableToEval()),1==i.get_Right().get_ActiveConstraintCount()?this.ProcessDfDvLeafNodeDirectly(r):this.PushDfDvNode(r));for(var e=0,h=t.get_VariableToEval().get_RightConstraints(),a=h.length,i=h[e];e<a;e++,i=h[e])System.Diagnostics.Debug.Assert$$Boolean$$String(!i.get_IsActive()||!(!t.get_IsLeftToRight()&&i.get_Left()==t.get_VariableDoneEval()),"this cycle should not happen"),i.get_IsActive()&&i.get_Left()!=t.get_VariableDoneEval()&&(r=this.GetDfDvNode(t,i,i.get_Left(),t.get_VariableToEval()),1==i.get_Left().get_ActiveConstraintCount()?this.ProcessDfDvLeafNodeDirectly(r):this.PushDfDvNode(r));if(this.allConstraints.DfDvStack.get_Count()>c)continue}if(System.Diagnostics.Debug.Assert$$Boolean$$String(this.allConstraints.DfDvStack.Peek()==t,"DfDvStack.Peek() should be 'node'"),this.allConstraints.DfDvStack.Pop(),this.ProcessDfDvLeafNode(t),t==o){System.Diagnostics.Debug.Assert$$Boolean$$String(0==this.allConstraints.DfDvStack.get_Count(),"Leftovers in DfDvStack on completion of loop");break}}this.DebugVerifyFinalDfDvValue(u.get_Lagrangian()/2,System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"nonzero final ComputeDfDv value ({0})",[u.get_Lagrangian()]))},ProcessDfDvLeafNode:function(n){var t=n.get_VariableToEval().get_DfDv();n.get_IsLeftToRight()?(n.get_ConstraintToEval().set_Lagrangian(n.get_ConstraintToEval().get_Lagrangian()+t),n.get_Parent().get_ConstraintToEval().set_Lagrangian(n.get_Parent().get_ConstraintToEval().get_Lagrangian()+n.get_ConstraintToEval().get_Lagrangian())):(n.get_ConstraintToEval().set_Lagrangian(-(n.get_ConstraintToEval().get_Lagrangian()+t)),n.get_Parent().get_ConstraintToEval().set_Lagrangian(n.get_Parent().get_ConstraintToEval().get_Lagrangian()-n.get_ConstraintToEval().get_Lagrangian()));this.CheckForConstraintPathTarget(n);this.Debug_CheckForViolatedActiveConstraint(n.get_ConstraintToEval());this.allConstraints.RecycleDfDvNode(n)},Debug_CheckForViolatedActiveConstraint:function(n){n.get_Violation()>this.allConstraints.SolverParameters.get_GapTolerance()&&System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"Violated active constraint should never be encountered")},ProcessDfDvLeafNodeDirectly:function(n){this.Debug_MarkForCycleCheck(n.get_ConstraintToEval());this.ProcessDfDvLeafNode(n)},GetDfDvNode:function(n,t,i,r){var u=this.allConstraints.DfDvRecycleStack.get_Count()>0?this.allConstraints.DfDvRecycleStack.Pop().Set(n,t,i,r):new Microsoft.Msagl.Core.ProjectionSolver.DfDvNode.ctor$$DfDvNode$$Constraint$$Variable$$Variable(n,t,i,r);return u.set_Depth(u.get_Parent().get_Depth()+1),this.allConstraints.MaxConstraintTreeDepth<u.get_Depth()&&(this.allConstraints.MaxConstraintTreeDepth=u.get_Depth()),u},PushDfDvNode:function(n){this.Debug_CycleCheck(n.get_ConstraintToEval());this.PushOnDfDvStack(n)},Debug_CycleCheck:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(this.idDfDv!=n.get_IdDfDv(),"Cycle detected someplace other than null minLagrangian")},Debug_MarkForCycleCheck:function(n){n.set_IdDfDv(this.idDfDv)},AddVariableAndPushDfDvNode:function(n,t){this.Debug_CycleCheck(t.get_ConstraintToEval());n.Add(t.get_VariableToEval());this.PushOnDfDvStack(t)},PushOnDfDvStack:function(n){this.Debug_MarkForCycleCheck(n.get_ConstraintToEval());this.allConstraints.DfDvStack.Push(n)},CheckForConstraintPathTarget:function(n){if(this.pathTargetVariable==n.get_VariableToEval()){while(n.get_Parent()!=this.dfDvDummyParentNode)this.constraintPath.Add(new Microsoft.Msagl.Core.ProjectionSolver.Block.ConstraintDirectionPair.ctor$$Constraint$$Boolean(n.get_ConstraintToEval(),n.get_IsLeftToRight())),n=n.get_Parent();this.pathTargetVariable=null}},Debug_ClearDfDv:function(n){var u,t,f;if(n||2147483647==this.idDfDv)for(this.idDfDv=1,u=this.get_Variables().get_Count(),t=0;t<u;++t){f=this.get_Variables().get_Item$$Int32(t);for(var i=0,r=f.get_LeftConstraints(),o=r.length,e=r[i];i<o;i++,e=r[i])e.ClearDfDv()}else++this.idDfDv},Expand:function(n){var t,f,i,r,e,o,u;if(this.Debug_ClearDfDv(!1),null==this.constraintPath&&(this.constraintPath=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.Block.ConstraintDirectionPair.ctor)),this.constraintPath.Clear(),this.pathTargetVariable=n.get_Right(),this.ComputeDfDv(n.get_Left()),t=null,this.constraintPath.get_Count()>0){for(f=this.constraintPath.GetEnumerator();f.MoveNext();)i=f.get_Current(),i.IsForward&&(null==t||i.Constraint.get_Lagrangian()<t.get_Lagrangian())&&(i.Constraint.get_IsEquality()||(t=i.Constraint));null!=t&&this.allConstraints.DeactivateConstraint(t)}if(this.constraintPath.Clear(),this.pathTargetVariable=null,null==t){System.Diagnostics.Debug.Assert$$Boolean$$String(!n.get_IsUnsatisfiable(),"An already-unsatisfiable constraint should not have been attempted");n.set_IsUnsatisfiable(!0);++this.allConstraints.NumberOfUnsatisfiableConstraints;return}for(r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.Variable.ctor),this.GetConnectedVariables(r,n.get_Right(),n.get_Left()),e=n.get_Violation(),o=r.get_Count(),u=0;u<o;++u)r.get_Item$$Int32(u).set_OffsetInBlock(r.get_Item$$Int32(u).get_OffsetInBlock()+e);this.allConstraints.ActivateConstraint(n);n.ClearDfDv();this.UpdateReferencePos()},Split:function(n){var i,f,o,r;if(n&&this.UpdateReferencePos(),this.get_Variables().get_Count()<2)return null;for(i=null,this.Debug_ClearDfDv(!1),this.ComputeDfDv(this.get_Variables().get_Item$$Int32(0)),f=this.allConstraints.SolverParameters.get_Advanced().get_MinSplitLagrangianThreshold(),o=this.get_Variables().get_Count(),r=0;r<o;++r)for(var u=0,e=this.get_Variables().get_Item$$Int32(r).get_LeftConstraints(),s=e.length,t=e[u];u<s;u++,t=e[u])t.get_IsActive()&&!t.get_IsEquality()&&t.get_Lagrangian()<f&&(System.Diagnostics.Debug.Assert$$Boolean$$String(t.get_IdDfDv()==this.idDfDv,"stale constraint.Lagrangian"),i=t,f=t.get_Lagrangian());return null==i?null:this.SplitOnConstraint(i)},SplitOnConstraint:function(n){this.allConstraints.DeactivateConstraint(n);var t=new Microsoft.Msagl.Core.ProjectionSolver.Block.ctor(null,this.allConstraints);return this.DebugVerifyBlockConnectivity(),this.TransferConnectedVariables(t,n.get_Right(),n.get_Left()),t.get_Variables().get_Count()>0?(this.UpdateReferencePos(),t.UpdateReferencePos(),this.DebugVerifyBlockConnectivity(),t.DebugVerifyBlockConnectivity()):t=null,t},DebugVerifyBlockConnectivity:function(){for(var e=this.get_Variables().GetEnumerator(),r;e.MoveNext();){r=e.get_Current();for(var t=0,u=r.get_LeftConstraints(),o=u.length,n=u[t];t<o;t++,n=u[t])System.Diagnostics.Debug.Assert$$Boolean$$String(!n.get_IsActive()||n.get_Left().get_Block()==n.get_Right().get_Block(),"LeftConstraint outside of Block");for(var i=0,f=r.get_RightConstraints(),s=f.length,n=f[i];i<s;i++,n=f[i])System.Diagnostics.Debug.Assert$$Boolean$$String(!n.get_IsActive()||n.get_Left().get_Block()==n.get_Right().get_Block(),"RightConstraint outside of Block")}},DebugVerifyReferencePos:function(){},AddVariable:function(n){this.get_Variables().Add(n);n.set_Block(this);1==this.get_Variables().get_Count()?(this.set_Scale(n.get_Scale()),this.set_ReferencePos(n.get_ActualPos()),this.sumAd=n.get_ActualPos()*n.get_Weight(),this.sumAb=0,this.sumA2=n.get_Weight(),n.set_OffsetInBlock(0)):this.AddVariableToBlockSums(n)},UpdateReferencePos:function(){var t,n;for(this.set_Scale(this.get_Variables().get_Item$$Int32(0).get_Scale()),this.sumAd=0,this.sumAb=0,this.sumA2=0,t=this.get_Variables().get_Count(),n=0;n<t;++n)this.AddVariableToBlockSums(this.get_Variables().get_Item$$Int32(n));this.UpdateReferencePosFromSums()},AddVariableToBlockSums:function(n){var i=this.get_Scale()/n.get_Scale(),r=n.get_OffsetInBlock()/n.get_Scale(),t=i*n.get_Weight();this.sumAd+=t*n.get_DesiredPos();this.sumAb+=t*r;this.sumA2+=t*i},UpdateReferencePosFromSums:function(){if(System.Double.IsInfinity(this.sumAd)||System.Double.IsInfinity(this.sumAb)||System.Double.IsInfinity(this.sumA2))throw $CreateException(new System.OverflowException.ctor$$String("Block Reference Position component is infinite"),new Error);this.set_ReferencePos((this.sumAd-this.sumAb)/this.sumA2);this.UpdateVariablePositions()},UpdateVariablePositions:function(){for(var n,i=this.get_Scale()*this.get_ReferencePos(),r=this.get_Variables().get_Count(),t=0;t<r;++t)n=this.get_Variables().get_Item$$Int32(t),n.set_ActualPos((i+n.get_OffsetInBlock())/n.get_Scale())},GetConnectedVariables:function(n,t,i){this.Debug_ClearDfDv(!1);this.RecurseGetConnectedVariables(n,t,i)},RecurseGetConnectedVariables:function(n,t,i){var o,u,c;for(System.Diagnostics.Debug.Assert$$Boolean$$String(0==this.allConstraints.DfDvStack.get_Count(),"Leftovers in ComputeDfDvStack"),this.allConstraints.DfDvStack.Clear(),System.Diagnostics.Debug.Assert$$Boolean$$String(0==n.get_Count(),"Leftovers in lstVars"),o=new Microsoft.Msagl.Core.ProjectionSolver.Constraint.ctor$$Variable(t),this.dfDvDummyParentNode=new Microsoft.Msagl.Core.ProjectionSolver.DfDvNode.ctor$$Constraint(o),this.allConstraints.DfDvStack.Push(this.GetDfDvNode(this.dfDvDummyParentNode,o,t,i)),n.Add(t);this.allConstraints.DfDvStack.get_Count()>0;){if(u=this.allConstraints.DfDvStack.Peek(),c=this.allConstraints.DfDvStack.get_Count(),!u.get_ChildrenHaveBeenPushed()){u.set_ChildrenHaveBeenPushed(!0);for(var f=0,s=u.get_VariableToEval().get_LeftConstraints(),l=s.length,r=s[f];f<l;f++,r=s[f])r.get_IsActive()&&r.get_Right()!=u.get_VariableDoneEval()&&(1==r.get_Right().get_ActiveConstraintCount()?(this.Debug_CycleCheck(r),this.Debug_MarkForCycleCheck(r),n.Add(r.get_Right())):this.AddVariableAndPushDfDvNode(n,this.GetDfDvNode(u,r,r.get_Right(),u.get_VariableToEval())));for(var e=0,h=u.get_VariableToEval().get_RightConstraints(),a=h.length,r=h[e];e<a;e++,r=h[e])r.get_IsActive()&&r.get_Left()!=u.get_VariableDoneEval()&&(1==r.get_Left().get_ActiveConstraintCount()?(this.Debug_CycleCheck(r),this.Debug_MarkForCycleCheck(r),n.Add(r.get_Left())):this.AddVariableAndPushDfDvNode(n,this.GetDfDvNode(u,r,r.get_Left(),u.get_VariableToEval())))}this.allConstraints.DfDvStack.get_Count()>c||(System.Diagnostics.Debug.Assert$$Boolean$$String(this.allConstraints.DfDvStack.Peek()==u,"DfDvStack.Peek() should be 'node'"),this.allConstraints.RecycleDfDvNode(this.allConstraints.DfDvStack.Pop()))}},TransferConnectedVariables:function(n,t,i){var e,u,f,s,r,o;for(this.GetConnectedVariables(n.get_Variables(),t,i),e=n.get_Variables().get_Count(),n.Debug_ClearDfDv(!0),r=0;r<e;++r)n.get_Variables().get_Item$$Int32(r).set_Block(n);for(u=this.get_Variables().get_Count()-1,f=this.get_Variables().get_Count()-1;f>=0;--f)s=this.get_Variables().get_Item$$Int32(f),s.get_Block()==n&&(f<u&&this.get_Variables().set_Item$$Int32(f,this.get_Variables().get_Item$$Int32(u)),--u);if(System.Diagnostics.Debug.Assert$$Boolean$$String(e==this.get_Variables().get_Count()-u-1,"variable should not be found twice (probable cycle-detection problem"),this.get_Variables().RemoveRange(u+1,this.get_Variables().get_Count()-u-1),0==this.get_Variables().get_Count()){for(r=0;r<e;++r)o=n.get_Variables().get_Item$$Int32(r),this.get_Variables().Add(o),o.set_Block(this);n.get_Variables().Clear()}},Debug_PostMerge:function(n){n.idDfDv>this.idDfDv&&(this.idDfDv=n.idDfDv)}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Block);Microsoft$Msagl$Core$ProjectionSolver$BlockVector={fullname:"Microsoft.Msagl.Core.ProjectionSolver.BlockVector",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._Vector=null;System.Object.ctor.call(this);this.set_Vector(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.Block.ctor))},Vector$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.ProjectionSolver.Block]]",get_Vector:function(){return this._Vector},set_Vector:function(n){this._Vector=n},Count$$:"System.Int32",get_Count:function(){return this.get_Vector().get_Count()},Item$$:"Microsoft.Msagl.Core.ProjectionSolver.Block",get_Item$$Int32:function(n){return this.get_Vector().get_Item$$Int32(n)},Add:function(n){n.set_VectorIndex(this.get_Vector().get_Count());this.get_Vector().Add(n);System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_Vector().get_Item$$Int32(n.get_VectorIndex())==n,"Inconsistent block.VectorIndex")},Remove:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_Vector().get_Item$$Int32(n.get_VectorIndex())==n,"Inconsistent block.VectorIndex");var t=this.get_Vector().get_Item$$Int32(this.get_Vector().get_Count()-1);this.get_Vector().set_Item$$Int32(n.get_VectorIndex(),t);t.set_VectorIndex(n.get_VectorIndex());this.get_Vector().RemoveAt(this.get_Vector().get_Count()-1);System.Diagnostics.Debug.Assert$$Boolean$$String(0==this.get_Vector().get_Count()||n==t||this.get_Vector().get_Item$$Int32(t.get_VectorIndex())==t,"Inconsistent swapBlock.VectorIndex");System.Diagnostics.Debug.Assert$$Boolean$$String(0==this.get_Vector().get_Count()||this.get_Vector().get_Item$$Int32(this.get_Vector().get_Count()-1).get_VectorIndex()==this.get_Vector().get_Count()-1,"Inconsistent finalBlock.VectorIndex")},toString:function(){return this.get_Vector().toString()}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$BlockVector);Microsoft$Msagl$Core$ProjectionSolver$Constraint={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Constraint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.IComparable$1"],Kind:"Class",definition:{ctor$$Variable$$Variable$$Double$$Boolean:function(n,t,i,r){this._Left=null;this._Right=null;this._Gap=0;this._IsEquality=!1;this._Lagrangian=0;this._IsActive=!1;this._IdDfDv=0;this._IsUnsatisfiable=!1;this._VectorIndex=0;System.Object.ctor.call(this);this.set_Left(n);this.set_Right(t);this.set_Gap(i);this.set_IsEquality(r);this.set_Lagrangian(0);this.set_IsActive(!1)},Left$$:"Microsoft.Msagl.Core.ProjectionSolver.Variable",get_Left:function(){return this._Left},set_Left:function(n){this._Left=n},Right$$:"Microsoft.Msagl.Core.ProjectionSolver.Variable",get_Right:function(){return this._Right},set_Right:function(n){this._Right=n},Gap$$:"System.Double",get_Gap:function(){return this._Gap},set_Gap:function(n){this._Gap=n},IsEquality$$:"System.Boolean",get_IsEquality:function(){return this._IsEquality},set_IsEquality:function(n){this._IsEquality=n},Lagrangian$$:"System.Double",get_Lagrangian:function(){return this._Lagrangian},set_Lagrangian:function(n){this._Lagrangian=n},IsActive$$:"System.Boolean",get_IsActive:function(){return this._IsActive},set_IsActive:function(n){this._IsActive=n},IdDfDv$$:"System.Int32",get_IdDfDv:function(){return this._IdDfDv},set_IdDfDv:function(n){this._IdDfDv=n},IsUnsatisfiable$$:"System.Boolean",get_IsUnsatisfiable:function(){return this._IsUnsatisfiable},set_IsUnsatisfiable:function(n){this._IsUnsatisfiable=n},VectorIndex$$:"System.Int32",get_VectorIndex:function(){return this._VectorIndex},set_VectorIndex:function(n){this._VectorIndex=n},SetActiveState:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_IsActive()!=n,"Constraint is already set to activationState");this.set_IsActive(n);this.set_VectorIndex(t);this.get_IsActive()?(this.get_Left().set_ActiveConstraintCount(this.get_Left().get_ActiveConstraintCount()+1),this.get_Right().set_ActiveConstraintCount(this.get_Right().get_ActiveConstraintCount()+1)):(this.get_Left().set_ActiveConstraintCount(this.get_Left().get_ActiveConstraintCount()-1),this.get_Right().set_ActiveConstraintCount(this.get_Right().get_ActiveConstraintCount()-1))},SetVectorIndex:function(n){this.set_VectorIndex(n)},Reinitialize:function(){this.set_IsActive(!1);this.set_IsUnsatisfiable(!1);this.ClearDfDv()},UpdateGap:function(n){this.set_Gap(n)},ctor$$Variable:function(n){this._Left=null;this._Right=null;this._Gap=0;this._IsEquality=!1;this._Lagrangian=0;this._IsActive=!1;this._IdDfDv=0;this._IsUnsatisfiable=!1;this._VectorIndex=0;System.Object.ctor.call(this);this.set_Left(function(n){return this.set_Right(n),n}.call(this,n))},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"  Cst: [{0}] [{1}] {2} {3:F5} vio {4:F5} Lm {5:F5}/{6:F5} {7}actv",[this.get_Left(),this.get_Right(),this.get_IsEquality()?"==":">=",this.get_Gap(),this.get_Violation(),this.get_Lagrangian(),this.get_Lagrangian()*2,this.get_IsActive()?"+":this.get_IsUnsatisfiable()?"!":"-"])},Violation$$:"System.Double",get_Violation:function(){return this.get_Left().get_ActualPos()*this.get_Left().get_Scale()+this.get_Gap()-this.get_Right().get_ActualPos()*this.get_Right().get_Scale()},ClearDfDv:function(){this.set_IdDfDv(0);this.set_Lagrangian(0)},CompareTo:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"other");var t=this.get_Left().CompareTo(n.get_Left());return 0==t&&(t=this.get_Right().CompareTo(n.get_Right())),0==t&&(t=this.get_Gap().CompareTo$$Double(n.get_Gap())),t}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Constraint);Microsoft$Msagl$Core$ProjectionSolver$ConstraintVector={fullname:"Microsoft.Msagl.Core.ProjectionSolver.ConstraintVector",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.nextConstraintIndex=0;this.firstActiveConstraintIndex=0;this.SolverParameters=null;this.DfDvStack=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.DfDvNode.ctor);this.DfDvRecycleStack=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.DfDvNode.ctor);this.MaxConstraintTreeDepth=0;this.NumberOfUnsatisfiableConstraints=0;this._Vector=null;System.Object.ctor.call(this)},Vector$$:"Microsoft.Msagl.Core.ProjectionSolver.Constraint[]",get_Vector:function(){return this._Vector},set_Vector:function(n){this._Vector=n},IsEmpty$$:"System.Boolean",get_IsEmpty:function(){return null==this.get_Vector()},Create:function(n){this.set_Vector(new Array(n));this.firstActiveConstraintIndex=n},Add:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(!n.get_IsActive(),"Constraint should not be active");n.SetVectorIndex(this.nextConstraintIndex);this.get_Vector()[this.nextConstraintIndex++]=n},ActivateConstraint:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(!n.get_IsActive(),"Constraint is already active");System.Diagnostics.Debug.Assert$$Boolean$$String(this.firstActiveConstraintIndex>0,"All constraints are already active");--this.firstActiveConstraintIndex;System.Diagnostics.Debug.Assert$$Boolean$$String(!this.get_Vector()[this.firstActiveConstraintIndex].get_IsActive(),"Constraint in inactive region is active");this.SwapConstraint(n)},DeactivateConstraint:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_IsActive(),"Constraint is not active");System.Diagnostics.Debug.Assert$$Boolean$$String(this.firstActiveConstraintIndex<this.get_Vector().length,"All constraints are already inactive");System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_Vector()[this.firstActiveConstraintIndex].get_IsActive(),"Constraint in active region is not active");this.SwapConstraint(n);++this.firstActiveConstraintIndex},SwapConstraint:function(n){var t=this.get_Vector()[this.firstActiveConstraintIndex];t.SetVectorIndex(n.get_VectorIndex());this.get_Vector()[n.get_VectorIndex()]=t;this.get_Vector()[this.firstActiveConstraintIndex]=n;n.SetActiveState(!n.get_IsActive(),this.firstActiveConstraintIndex)},Reinitialize:function(){if(null!=this.get_Vector()){for(var n=0,t=this.get_Vector(),r=t.length,i=t[n];n<r;n++,i=t[n])i.Reinitialize();this.firstActiveConstraintIndex=this.get_Vector().length}},Debug_AssertIsFull:function(){System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_Vector().length==this.nextConstraintIndex,"AllConstraints.Vector is not full");this.Debug_AssertConsistency()},Debug_AssertConsistency:function(){for(var t,n=0;n<this.get_Vector().length;++n)t=this.get_Vector()[n],System.Diagnostics.Debug.Assert$$Boolean$$String(t.get_VectorIndex()==n,"Inconsistent constraint.VectorIndex"),t.get_IsActive()?System.Diagnostics.Debug.Assert$$Boolean$$String(t.get_VectorIndex()>=this.firstActiveConstraintIndex,"Active constraint is in Inactive region"):System.Diagnostics.Debug.Assert$$Boolean$$String(t.get_VectorIndex()<this.firstActiveConstraintIndex,"Inactive constraint is in Active region")},RecycleDfDvNode:function(n){this.DfDvRecycleStack.get_Count()<1024&&this.DfDvRecycleStack.Push(n)},toString:function(){return this.get_Vector().toString()}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$ConstraintVector);Microsoft$Msagl$Core$ProjectionSolver$DfDvNode={fullname:"Microsoft.Msagl.Core.ProjectionSolver.DfDvNode",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$DfDvNode$$Constraint$$Variable$$Variable:function(n,t,i,r){this._Parent=null;this._ConstraintToEval=null;this._VariableToEval=null;this._VariableDoneEval=null;this._Depth=0;this._ChildrenHaveBeenPushed=!1;System.Object.ctor.call(this);this.Set(n,t,i,r)},Parent$$:"Microsoft.Msagl.Core.ProjectionSolver.DfDvNode",get_Parent:function(){return this._Parent},set_Parent:function(n){this._Parent=n},ConstraintToEval$$:"Microsoft.Msagl.Core.ProjectionSolver.Constraint",get_ConstraintToEval:function(){return this._ConstraintToEval},set_ConstraintToEval:function(n){this._ConstraintToEval=n},VariableToEval$$:"Microsoft.Msagl.Core.ProjectionSolver.Variable",get_VariableToEval:function(){return this._VariableToEval},set_VariableToEval:function(n){this._VariableToEval=n},VariableDoneEval$$:"Microsoft.Msagl.Core.ProjectionSolver.Variable",get_VariableDoneEval:function(){return this._VariableDoneEval},set_VariableDoneEval:function(n){this._VariableDoneEval=n},Depth$$:"System.Int32",get_Depth:function(){return this._Depth},set_Depth:function(n){this._Depth=n},ChildrenHaveBeenPushed$$:"System.Boolean",get_ChildrenHaveBeenPushed:function(){return this._ChildrenHaveBeenPushed},set_ChildrenHaveBeenPushed:function(n){this._ChildrenHaveBeenPushed=n},ctor$$Constraint:function(n){this._Parent=null;this._ConstraintToEval=null;this._VariableToEval=null;this._VariableDoneEval=null;this._Depth=0;this._ChildrenHaveBeenPushed=!1;System.Object.ctor.call(this);this.set_ConstraintToEval(n);this.set_Depth(-1)},Set:function(n,t,i,r){return this.set_Parent(n),this.set_ConstraintToEval(t),this.set_VariableToEval(i),this.set_VariableDoneEval(r),this.set_Depth(0),this.set_ChildrenHaveBeenPushed(!1),t.set_Lagrangian(0),this},IsLeftToRight$$:"System.Boolean",get_IsLeftToRight:function(){return this.get_VariableToEval()==this.get_ConstraintToEval().get_Right()},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0} {1}{2} - {3}{4} ({5})",["",this.get_IsLeftToRight()?"":"*",this.get_ConstraintToEval().get_Left().get_Name(),this.get_IsLeftToRight()?"*":"",this.get_ConstraintToEval().get_Right().get_Name(),this.get_Depth()])}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$DfDvNode);Microsoft$Msagl$Core$ProjectionSolver$GlobalConfiguration={fullname:"Microsoft.Msagl.Core.ProjectionSolver.GlobalConfiguration",baseTypeName:"System.ValueType",assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor:function(){System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$GlobalConfiguration);Microsoft$Msagl$Core$ProjectionSolver$Parameters={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Parameters",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.ICloneable"],Kind:"Class",definition:{ctor:function(){this._GapTolerance=0;this._QpscConvergenceEpsilon=0;this._QpscConvergenceQuotient=0;this._OuterProjectIterationsLimit=0;this._InnerProjectIterationsLimit=0;this._TimeLimit=0;this._Advanced=null;System.Object.ctor.call(this);this.set_GapTolerance(.0001);this.set_QpscConvergenceEpsilon(1e-5);this.set_QpscConvergenceQuotient(1e-6);this.set_OuterProjectIterationsLimit(-1);this.set_InnerProjectIterationsLimit(-1);this.set_TimeLimit(-1);this.set_Advanced(new Microsoft.Msagl.Core.ProjectionSolver.AdvancedParameters.ctor)},GapTolerance$$:"System.Double",get_GapTolerance:function(){return this._GapTolerance},set_GapTolerance:function(n){this._GapTolerance=n},QpscConvergenceEpsilon$$:"System.Double",get_QpscConvergenceEpsilon:function(){return this._QpscConvergenceEpsilon},set_QpscConvergenceEpsilon:function(n){this._QpscConvergenceEpsilon=n},QpscConvergenceQuotient$$:"System.Double",get_QpscConvergenceQuotient:function(){return this._QpscConvergenceQuotient},set_QpscConvergenceQuotient:function(n){this._QpscConvergenceQuotient=n},OuterProjectIterationsLimit$$:"System.Int32",get_OuterProjectIterationsLimit:function(){return this._OuterProjectIterationsLimit},set_OuterProjectIterationsLimit:function(n){this._OuterProjectIterationsLimit=n},InnerProjectIterationsLimit$$:"System.Int32",get_InnerProjectIterationsLimit:function(){return this._InnerProjectIterationsLimit},set_InnerProjectIterationsLimit:function(n){this._InnerProjectIterationsLimit=n},TimeLimit$$:"System.Int32",get_TimeLimit:function(){return this._TimeLimit},set_TimeLimit:function(n){this._TimeLimit=n},Advanced$$:"Microsoft.Msagl.Core.ProjectionSolver.AdvancedParameters",get_Advanced:function(){return this._Advanced},set_Advanced:function(n){this._Advanced=n},Clone:function(){var n=Cast(this.MemberwiseClone(),Microsoft.Msagl.Core.ProjectionSolver.Parameters.ctor);return n.set_Advanced(Cast(this.get_Advanced().Clone(),Microsoft.Msagl.Core.ProjectionSolver.AdvancedParameters.ctor)),n}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Parameters);Microsoft$Msagl$Core$ProjectionSolver$AdvancedParameters={fullname:"Microsoft.Msagl.Core.ProjectionSolver.AdvancedParameters",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.ICloneable"],Kind:"Class",definition:{ctor:function(){this._ForceQpsc=!1;this._ScaleInQpsc=!1;this._MinSplitLagrangianThreshold=0;this._UseViolationCache=!1;this._ViolationCacheMinBlocksDivisor=0;this._ViolationCacheMinBlocksCount=0;System.Object.ctor.call(this);this.set_ForceQpsc(!1);this.set_ScaleInQpsc(!0);this.set_MinSplitLagrangianThreshold(-1e-7);this.set_UseViolationCache(!0);this.set_ViolationCacheMinBlocksDivisor(10);this.set_ViolationCacheMinBlocksCount(100)},ForceQpsc$$:"System.Boolean",get_ForceQpsc:function(){return this._ForceQpsc},set_ForceQpsc:function(n){this._ForceQpsc=n},ScaleInQpsc$$:"System.Boolean",get_ScaleInQpsc:function(){return this._ScaleInQpsc},set_ScaleInQpsc:function(n){this._ScaleInQpsc=n},MinSplitLagrangianThreshold$$:"System.Double",get_MinSplitLagrangianThreshold:function(){return this._MinSplitLagrangianThreshold},set_MinSplitLagrangianThreshold:function(n){this._MinSplitLagrangianThreshold=n},UseViolationCache$$:"System.Boolean",get_UseViolationCache:function(){return this._UseViolationCache},set_UseViolationCache:function(n){this._UseViolationCache=n},ViolationCacheMinBlocksDivisor$$:"System.Int32",get_ViolationCacheMinBlocksDivisor:function(){return this._ViolationCacheMinBlocksDivisor},set_ViolationCacheMinBlocksDivisor:function(n){this._ViolationCacheMinBlocksDivisor=n},ViolationCacheMinBlocksCount$$:"System.Int32",get_ViolationCacheMinBlocksCount:function(){return this._ViolationCacheMinBlocksCount},set_ViolationCacheMinBlocksCount:function(n){this._ViolationCacheMinBlocksCount=n},Clone:function(){return this.MemberwiseClone()}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$AdvancedParameters);Microsoft$Msagl$Core$ProjectionSolver$Qpsc={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Qpsc",baseTypeName:"System.Object",staticDefinition:{VectorVectorMultiply:function(n,t){for(var r=0,i=0;i<n.length;++i)r+=n[i]*t[i];return r},VectorVectorAdd:function(n,t,i){for(var r=0;r<n.length;++r)i[r]=n[r]+t[r]},VectorVectorSubtract:function(n,t,i){for(var r=0;r<n.length;++r)i[r]=n[r]-t[r]},VectorScaledVectorSubtract:function(n,t,i,r){for(var u=0;u<n.length;++u)r[u]=n[u]-t*i[u]},VectorCopy:function(n,t){for(var i=0;i<t.length;++i)n[i]=t[i]}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.solverParameters=null;this.matrixQ=null;this.vectorWiDi=null;this.vectorQpscVars=null;this.newMatrixRow=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.Qpsc.MatrixCell.ctor);this.gradientVector=null;this.vectorQg=null;this.vectorPrevY=null;this.vectorCurY=null;this.isFirstProjectCall=!1;this.previousFunctionValue=1.79769313486232E+308;System.Object.ctor.call(this);this.solverParameters=n;this.matrixQ=new Array(t);this.vectorWiDi=new Float64Array(t);this.vectorQpscVars=new Array(t);this.gradientVector=new Float64Array(t);this.vectorQg=new Float64Array(t);this.vectorPrevY=new Float64Array(t);this.vectorCurY=new Float64Array(t)},AddVariable:function(n){var r,i,t;if(System.Diagnostics.Debug.Assert$$Boolean$$String(null==this.matrixQ[n.get_Ordinal()]&&null==this.vectorQpscVars[n.get_Ordinal()].Variable,"variable.Ordinal already exists"),this.isFirstProjectCall=!0,this.vectorWiDi[n.get_Ordinal()]=-2*n.get_Weight()*n.get_DesiredPos(),this.vectorPrevY[n.get_Ordinal()]=n.get_Weight(),null!=n.get_Neighbors())for(r=n.get_Neighbors().GetEnumerator();r.MoveNext();)i=r.get_Current(),System.Diagnostics.Debug.Assert$$Boolean$$String(i.get_Neighbor().get_Ordinal()!=n.get_Ordinal(),"self-neighbors are not allowed"),this.vectorPrevY[n.get_Ordinal()]+=i.get_Weight(),this.vectorPrevY[i.get_Neighbor().get_Ordinal()]-=i.get_Weight();for(t=0;t<this.vectorPrevY.length;++t)0!=this.vectorPrevY[t]&&(System.Diagnostics.Debug.Assert$$Boolean$$String(t==n.get_Ordinal()==this.vectorPrevY[t]>0,"Diagonal must be > 0.0"),this.newMatrixRow.Add(new Microsoft.Msagl.Core.ProjectionSolver.Qpsc.MatrixCell.ctor$$Double$$UInt32(this.vectorPrevY[t]*2,t)),this.vectorPrevY[t]=0);this.matrixQ[n.get_Ordinal()]=this.newMatrixRow.ToArray();this.newMatrixRow.Clear();this.vectorQpscVars[n.get_Ordinal()]=new Microsoft.Msagl.Core.ProjectionSolver.Qpsc.QpscVar.ctor$$Variable(n);n.set_Weight(1)},VariablesComplete:function(){for(var n,i,r,t,u=0,e=this.vectorQpscVars,c=e.length,h=e[u];u<c;u++,h=e[u]){n=h.Variable;for(var f=0,o=this.matrixQ[n.get_Ordinal()],l=o.length,s=o[f];f<l;f++,s=o[f])s.Column==n.get_Ordinal()&&(this.solverParameters.get_Advanced().get_ScaleInQpsc()&&(n.set_Scale(1/System.Math.Sqrt(System.Math.Abs$$Double(s.Value))),System.Double.IsInfinity(n.get_Scale())&&n.set_Scale(1),n.set_ActualPos(n.get_ActualPos()/n.get_Scale()),this.vectorWiDi[n.get_Ordinal()]*=n.get_Scale()),this.vectorCurY[n.get_Ordinal()]=n.get_ActualPos(),n.set_DesiredPos(n.get_ActualPos()))}if(this.solverParameters.get_Advanced().get_ScaleInQpsc())for(i=0;i<this.matrixQ.length;++i)for(r=this.matrixQ[i],t=0;t<r.length;++t)r[t].Column==i?r[t].Value=1:r[t].Value*=this.vectorQpscVars[i].Variable.get_Scale()*this.vectorQpscVars[r[t].Column].Variable.get_Scale()},PreProject:function(){var f,i,e,n;if(this.isFirstProjectCall)for(var t=0,r=this.vectorQpscVars,o=r.length,u=r[t];t<o;t++,u=r[t])this.vectorCurY[u.Variable.get_Ordinal()]=u.Variable.get_ActualPos();if((this.MatrixVectorMultiply(this.vectorCurY,this.gradientVector),this.HasConverged())||(Microsoft.Msagl.Core.ProjectionSolver.Qpsc.VectorVectorAdd(this.gradientVector,this.vectorWiDi,this.gradientVector),f=Microsoft.Msagl.Core.ProjectionSolver.Qpsc.VectorVectorMultiply(this.gradientVector,this.gradientVector),i=0,0!=f&&(this.MatrixVectorMultiply(this.gradientVector,this.vectorQg),i=Microsoft.Msagl.Core.ProjectionSolver.Qpsc.VectorVectorMultiply(this.vectorQg,this.gradientVector)),0==i))return!1;for(e=f/i,Microsoft.Msagl.Core.ProjectionSolver.Qpsc.VectorCopy(this.vectorPrevY,this.vectorCurY),Microsoft.Msagl.Core.ProjectionSolver.Qpsc.VectorScaledVectorSubtract(this.vectorPrevY,e,this.gradientVector,this.vectorCurY),n=0;n<this.vectorCurY.length;++n)this.vectorQpscVars[n].Variable.set_DesiredPos(this.vectorCurY[n]);return!0},PostProject:function(){for(var u,n,f,t=0,i=this.vectorQpscVars,e=i.length,r=i[t];t<e;t++,r=i[t])this.vectorCurY[r.Variable.get_Ordinal()]=r.Variable.get_ActualPos();return Microsoft.Msagl.Core.ProjectionSolver.Qpsc.VectorVectorSubtract(this.vectorPrevY,this.vectorCurY,this.vectorCurY),u=Microsoft.Msagl.Core.ProjectionSolver.Qpsc.VectorVectorMultiply(this.gradientVector,this.vectorCurY),n=0,0!=u&&(this.MatrixVectorMultiply(this.vectorCurY,this.vectorQg),f=Microsoft.Msagl.Core.ProjectionSolver.Qpsc.VectorVectorMultiply(this.vectorQg,this.vectorCurY),n=0==f?1:u/f,n>1?n=1:n<0&&(n=0)),Microsoft.Msagl.Core.ProjectionSolver.Qpsc.VectorScaledVectorSubtract(this.vectorPrevY,n,this.vectorCurY,this.vectorCurY),this.isFirstProjectCall=!1,n>0},QpscComplete:function(){for(var t=0,i=this.vectorQpscVars,r=i.length,n=i[t];t<r;t++,n=i[t])n.Variable.set_Weight(n.OrigWeight),n.Variable.set_DesiredPos(n.OrigDesiredPos),this.solverParameters.get_Advanced().get_ScaleInQpsc()&&(n.Variable.set_ActualPos(n.Variable.get_ActualPos()*n.Variable.get_Scale()),n.Variable.set_Scale(n.OrigScale));return this.previousFunctionValue},HasConverged:function(){var t=this.GetFunctionValue(this.vectorCurY),r=!1,n,i,u;return this.isFirstProjectCall||(n=this.previousFunctionValue-t,i=0,n!=0&&(u=0!=this.previousFunctionValue?this.previousFunctionValue:t,i=System.Math.Abs$$Double(n/u)),(System.Math.Abs$$Double(n)<this.solverParameters.get_QpscConvergenceEpsilon()||System.Math.Abs$$Double(i)<this.solverParameters.get_QpscConvergenceQuotient())&&(r=!0)),this.previousFunctionValue=t,r},GetFunctionValue:function(n){var t=Microsoft.Msagl.Core.ProjectionSolver.Qpsc.VectorVectorMultiply(this.gradientVector,n)/2;return t+Microsoft.Msagl.Core.ProjectionSolver.Qpsc.VectorVectorMultiply(this.vectorWiDi,n)},MatrixVectorMultiply:function(n,t){for(var e,s=0,i=0,f=this.matrixQ,h=f.length,r=f[i];i<h;i++,r=f[i]){e=0;for(var u=0,c=r.length,o=r[u];u<c;u++,o=r[u])e+=o.Value*n[o.Column];t[s++]=e}}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Qpsc);Microsoft$Msagl$Core$ProjectionSolver$Solution={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Solution",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.ICloneable"],Kind:"Class",definition:{ctor:function(){this._NumberOfUnsatisfiableConstraints=0;this._OuterProjectIterations=0;this._InnerProjectIterationsTotal=0;this._MinInnerProjectIterations=0;this._MaxInnerProjectIterations=0;this._MaxConstraintTreeDepth=0;this._GoalFunctionValue=0;this._AlgorithmUsed=Microsoft.Msagl.Core.ProjectionSolver.SolverAlgorithm.ProjectOnly;this._TimeLimitExceeded=!1;this._OuterProjectIterationsLimitExceeded=!1;this._InnerProjectIterationsLimitExceeded=!1;System.Object.ctor.call(this)},NumberOfUnsatisfiableConstraints$$:"System.Int32",get_NumberOfUnsatisfiableConstraints:function(){return this._NumberOfUnsatisfiableConstraints},set_NumberOfUnsatisfiableConstraints:function(n){this._NumberOfUnsatisfiableConstraints=n},OuterProjectIterations$$:"System.Int32",get_OuterProjectIterations:function(){return this._OuterProjectIterations},set_OuterProjectIterations:function(n){this._OuterProjectIterations=n},InnerProjectIterationsTotal$$:"System.Int64",get_InnerProjectIterationsTotal:function(){return this._InnerProjectIterationsTotal},set_InnerProjectIterationsTotal:function(n){this._InnerProjectIterationsTotal=n},MinInnerProjectIterations$$:"System.Int32",get_MinInnerProjectIterations:function(){return this._MinInnerProjectIterations},set_MinInnerProjectIterations:function(n){this._MinInnerProjectIterations=n},MaxInnerProjectIterations$$:"System.Int32",get_MaxInnerProjectIterations:function(){return this._MaxInnerProjectIterations},set_MaxInnerProjectIterations:function(n){this._MaxInnerProjectIterations=n},MaxConstraintTreeDepth$$:"System.Int32",get_MaxConstraintTreeDepth:function(){return this._MaxConstraintTreeDepth},set_MaxConstraintTreeDepth:function(n){this._MaxConstraintTreeDepth=n},GoalFunctionValue$$:"System.Double",get_GoalFunctionValue:function(){return this._GoalFunctionValue},set_GoalFunctionValue:function(n){this._GoalFunctionValue=n},AlgorithmUsed$$:"Microsoft.Msagl.Core.ProjectionSolver.SolverAlgorithm",get_AlgorithmUsed:function(){return this._AlgorithmUsed},set_AlgorithmUsed:function(n){this._AlgorithmUsed=n},TimeLimitExceeded$$:"System.Boolean",get_TimeLimitExceeded:function(){return this._TimeLimitExceeded},set_TimeLimitExceeded:function(n){this._TimeLimitExceeded=n},OuterProjectIterationsLimitExceeded$$:"System.Boolean",get_OuterProjectIterationsLimitExceeded:function(){return this._OuterProjectIterationsLimitExceeded},set_OuterProjectIterationsLimitExceeded:function(n){this._OuterProjectIterationsLimitExceeded=n},InnerProjectIterationsLimitExceeded$$:"System.Boolean",get_InnerProjectIterationsLimitExceeded:function(){return this._InnerProjectIterationsLimitExceeded},set_InnerProjectIterationsLimitExceeded:function(n){this._InnerProjectIterationsLimitExceeded=n},ExecutionLimitExceeded$$:"System.Boolean",get_ExecutionLimitExceeded:function(){return this.get_TimeLimitExceeded()||this.get_OuterProjectIterationsLimitExceeded()||this.get_InnerProjectIterationsLimitExceeded()},Clone:function(){return this.MemberwiseClone()}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Solution);Microsoft$Msagl$Core$ProjectionSolver$Solver={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Solver",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.allBlocks=new Microsoft.Msagl.Core.ProjectionSolver.BlockVector.ctor;this.allConstraints=new Microsoft.Msagl.Core.ProjectionSolver.ConstraintVector.ctor;this.numberOfConstraints=0;this.numberOfVariables=0;this.equalityConstraints=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.Constraint.ctor);this.loadedVariablesAndConstraintLists=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.ProjectionSolver.Variable.ctor,Microsoft.Msagl.Core.ProjectionSolver.Solver.ConstraintListForVariable.ctor);this.emptyConstraintList=new Array(0);this.updatedConstraints=new System.Collections.Generic.List$1.ctor(System.Collections.Generic.KeyValuePair$2.ctor);this.violationCache=new Microsoft.Msagl.Core.ProjectionSolver.ViolationCache.ctor;this.lastModifiedBlock=null;this.violationCacheMinBlockCutoff=0;this.hasNeighbourPairs=!1;this.nextVariableOrdinal=0;this.solverParams=new Microsoft.Msagl.Core.ProjectionSolver.Parameters.ctor;this.solverSolution=new Microsoft.Msagl.Core.ProjectionSolver.Solution.ctor;this.timeoutStopwatch=null;System.Object.ctor.call(this)},IsQpsc$$:"System.Boolean",get_IsQpsc:function(){return this.hasNeighbourPairs||this.solverParams.get_Advanced().get_ForceQpsc()},AddVariable$$Object$$Double:function(n,t){return this.AddVariable$$Object$$Double$$Double$$Double(n,t,1,1)},AddVariable$$Object$$Double$$Double:function(n,t,i){return this.AddVariable$$Object$$Double$$Double$$Double(n,t,i,1)},AddVariable$$Object$$Double$$Double$$Double:function(n,t,i,r){if(!this.allConstraints.get_IsEmpty())throw $CreateException(new System.InvalidOperationException.ctor$$String("Cannot add Variables or Constraints once Solve() has been called"),new Error);var u=new Microsoft.Msagl.Core.ProjectionSolver.Variable.ctor(this.nextVariableOrdinal++,n,t,i,r),f=new Microsoft.Msagl.Core.ProjectionSolver.Block.ctor(u,this.allConstraints);return u.set_Block(f),this.allBlocks.Add(f),++this.numberOfVariables,this.loadedVariablesAndConstraintLists.set_Item$$TKey(u,new Microsoft.Msagl.Core.ProjectionSolver.Solver.ConstraintListForVariable.ctor$$List$1$Constraint$$Int32(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.Constraint.ctor),0)),u},UpdateVariables:function(){for(var n=this.allBlocks.get_Vector().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.UpdateReferencePos()},Variables$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.ProjectionSolver.Variable]]",get_Variables:function(){return System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.ProjectionSolver.Block.ctor,Microsoft.Msagl.Core.ProjectionSolver.Variable.ctor,this.allBlocks.get_Vector(),$CreateAnonymousDelegate(this,function(n){return n.get_Variables()}))},VariableCount$$:"System.Int32",get_VariableCount:function(){return this.numberOfVariables},Constraints$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.ProjectionSolver.Constraint]]",get_Constraints:function(){var u=[],e,o,i,s,r,n;if(this.allConstraints.get_IsEmpty()){for(e=this.loadedVariablesAndConstraintLists.get_Keys().GetEnumerator();e.MoveNext();)if(o=e.get_Current(),i=this.loadedVariablesAndConstraintLists.get_Item$$TKey(o),null!=i.Constraints)for(s=i.Constraints.get_Count(),r=0;r<s;++r)n=i.Constraints.get_Item$$Int32(r),o==n.get_Left()&&u.push(n)}else for(var t=0,f=this.allConstraints.get_Vector(),h=f.length,n=f[t];t<h;t++,n=f[t])u.push(n);return u},ConstraintCount$$:"System.Int32",get_ConstraintCount:function(){return this.numberOfConstraints},AddEqualityConstraint:function(n,t,i){return this.AddConstraint$$Variable$$Variable$$Double$$Boolean(n,t,i,!0)},AddConstraint$$Variable$$Variable$$Double$$Boolean:function(n,t,i,r){if(!this.allConstraints.get_IsEmpty())throw $CreateException(new System.InvalidOperationException.ctor$$String("Cannot add Variables or Constraints once Solve() has been called"),new Error);if(n==t)throw $CreateException(new System.ArgumentException.ctor$$String("Cannot add a constraint between a variable and itself"),new Error);var f=this.loadedVariablesAndConstraintLists.get_Item$$TKey(n),e=this.loadedVariablesAndConstraintLists.get_Item$$TKey(t),u=new Microsoft.Msagl.Core.ProjectionSolver.Constraint.ctor$$Variable$$Variable$$Double$$Boolean(n,t,i,r);return this.loadedVariablesAndConstraintLists.set_Item$$TKey(n,new Microsoft.Msagl.Core.ProjectionSolver.Solver.ConstraintListForVariable.ctor$$List$1$Constraint$$Int32(f.Constraints,f.NumberOfLeftConstraints+1)),f.Constraints.Add(u),e.Constraints.Add(u),++this.numberOfConstraints,r&&this.equalityConstraints.Add(u),u},AddConstraint$$Variable$$Variable$$Double:function(n,t,i){return this.AddConstraint$$Variable$$Variable$$Double$$Boolean(n,t,i,!1)},SetConstraintUpdate:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"constraint");t!=n.get_Gap()&&this.updatedConstraints.Add(new System.Collections.Generic.KeyValuePair$2.ctor$$TKey$$TValue(Microsoft.Msagl.Core.ProjectionSolver.Constraint.ctor,System.Double.ctor,n,t))},AddNeighborPair:function(n,t,i){if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"variable1"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"variable2"),i<=0||System.Double.IsNaN(i)||System.Double.IsInfinity(i))throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String("relationshipWeight","Invalid Neighbor Weight"),new Error);if(n==t)throw $CreateException(new System.InvalidOperationException.ctor$$String("Cannot make a Variable a neighbor of itself"),new Error);n.AddNeighbor(t,i);t.AddNeighbor(n,i);this.hasNeighbourPairs=!0},Solve:function(){return this.Solve$$Parameters(null)},Solve$$Parameters:function(n){null!=n&&(this.solverParams=Cast(n.Clone(),Microsoft.Msagl.Core.ProjectionSolver.Parameters.ctor));this.solverParams.get_OuterProjectIterationsLimit()<0&&this.solverParams.set_OuterProjectIterationsLimit(100*((System.Math.Log$$Double$$Double(this.numberOfVariables,2)|0)+1));this.solverParams.get_InnerProjectIterationsLimit()<0&&this.solverParams.set_InnerProjectIterationsLimit(this.numberOfConstraints*2+100*((System.Math.Log$$Double$$Double(this.numberOfConstraints,2)|0)+1));var t=!this.allConstraints.get_IsEmpty();if(this.CheckForUpdatedConstraints(),this.solverSolution=function(){var n=new Microsoft.Msagl.Core.ProjectionSolver.Solution.ctor;return n.set_MinInnerProjectIterations(2147483647),n}.call(this),this.allConstraints.MaxConstraintTreeDepth=0,this.allConstraints.SolverParameters=this.solverParams,0==this.numberOfConstraints){if(!this.get_IsQpsc())return Cast(this.solverSolution.Clone(),Microsoft.Msagl.Core.ProjectionSolver.Solution.ctor)}else t||this.SetupConstraints();return this.allConstraints.NumberOfUnsatisfiableConstraints=0,this.MergeEqualityConstraints(),this.solverParams.get_TimeLimit()>0&&(this.timeoutStopwatch=new System.Diagnostics.Stopwatch.ctor,this.timeoutStopwatch.Start()),this.get_IsQpsc()?this.SolveQpsc():(this.SolveByStandaloneProject(),this.CalculateStandaloneProjectGoalFunctionValue()),this.solverSolution.get_MinInnerProjectIterations()>this.solverSolution.get_MaxInnerProjectIterations()&&this.solverSolution.set_MinInnerProjectIterations(this.solverSolution.get_MaxInnerProjectIterations()),this.solverSolution.set_NumberOfUnsatisfiableConstraints(this.allConstraints.NumberOfUnsatisfiableConstraints),this.solverSolution.set_MaxConstraintTreeDepth(this.allConstraints.MaxConstraintTreeDepth),Cast(this.solverSolution.Clone(),Microsoft.Msagl.Core.ProjectionSolver.Solution.ctor)},CheckForUpdatedConstraints:function(){var n,i,r,t;if(0!=this.updatedConstraints.get_Count()){for(System.Diagnostics.Debug.Assert$$Boolean$$String(!this.allConstraints.get_IsEmpty(),"Cannot have updated constraints if AllConstraints is empty."),n=this.get_IsQpsc(),i=this.updatedConstraints.GetEnumerator();i.MoveNext();){if(r=i.get_Current(),t=r.get_Key(),t.UpdateGap(r.get_Value()),!n&&!t.get_IsEquality()){this.SplitOnConstraintIfActive(t);continue}n=!0}this.updatedConstraints.Clear();n&&this.ReinitializeBlocks()}},SplitOnConstraintIfActive:function(n){if(n.get_IsActive()){var t=n.get_Left().get_Block().SplitOnConstraint(n);null!=t&&this.allBlocks.Add(t)}},SetupConstraints:function(){var s,r,u,l,a,f,e;for(this.allConstraints.Create(this.numberOfConstraints),s=this.loadedVariablesAndConstraintLists.get_Keys().GetEnumerator();s.MoveNext();){var t=s.get_Current(),y=this.loadedVariablesAndConstraintLists.get_Item$$TKey(t),h=y.Constraints,c=0,n=0,i=0;for(null!=h&&(c=h.get_Count(),n=y.NumberOfLeftConstraints,i=c-n),r=this.emptyConstraintList,0!=n&&(r=new Array(n)),u=this.emptyConstraintList,0!=i&&(u=new Array(i)),t.SetConstraints(r,u),l=0,a=0,f=0;f<c;++f)e=h.get_Item$$Int32(f),t==e.get_Left()?r[l++]=e:u[a++]=e;System.Diagnostics.Debug.Assert$$Boolean$$String(l==n,"leftConstraintIndex must == numLeftConstraints");System.Diagnostics.Debug.Assert$$Boolean$$String(a==i,"rightConstraintIndex must == numRightConstraints");for(var o=0,v=t.get_LeftConstraints(),w=v.length,p=v[o];o<w;o++,p=v[o])this.allConstraints.Add(p)}this.allConstraints.Debug_AssertIsFull();this.loadedVariablesAndConstraintLists.Clear();this.loadedVariablesAndConstraintLists=null;this.violationCacheMinBlockCutoff=2147483647;this.solverParams.get_Advanced().get_UseViolationCache()&&this.solverParams.get_Advanced().get_ViolationCacheMinBlocksDivisor()>0&&(this.violationCacheMinBlockCutoff=System.Math.Min$$Int32$$Int32(this.allBlocks.get_Count()/this.solverParams.get_Advanced().get_ViolationCacheMinBlocksDivisor()|0,this.solverParams.get_Advanced().get_ViolationCacheMinBlocksCount()))},SolveByStandaloneProject:function(){for(;;){var n;if(!function(){var t={Value:n},i=this.RunProject(t);return n=t.Value,i}.call(this))return;if(!this.SplitBlocks())break}},RunProject:function(n){return this.solverSolution.set_OuterProjectIterations(this.solverSolution.get_OuterProjectIterations()+1),n.Value=this.Project(),!this.CheckForLimitsExceeded()},CheckForLimitsExceeded:function(){return null!=this.timeoutStopwatch&&this.timeoutStopwatch.get_ElapsedMilliseconds()>=this.solverParams.get_TimeLimit()?(this.solverSolution.set_TimeLimitExceeded(!0),!0):this.solverParams.get_OuterProjectIterationsLimit()>0&&this.solverSolution.get_OuterProjectIterations()>=this.solverParams.get_OuterProjectIterationsLimit()?(this.solverSolution.set_OuterProjectIterationsLimitExceeded(!0),!0):this.solverSolution.get_InnerProjectIterationsLimitExceeded()?!0:!1},CalculateStandaloneProjectGoalFunctionValue:function(){var u,t,r,f,i,n;for(this.solverSolution.set_GoalFunctionValue(0),u=this.allBlocks.get_Count(),t=0;t<u;++t)for(r=this.allBlocks.get_Item$$Int32(t),f=r.get_Variables().get_Count(),i=0;i<f;++i)n=r.get_Variables().get_Item$$Int32(i),this.solverSolution.set_GoalFunctionValue(this.solverSolution.get_GoalFunctionValue()+n.get_Weight()*n.get_ActualPos()*n.get_ActualPos()),this.solverSolution.set_GoalFunctionValue(this.solverSolution.get_GoalFunctionValue()-2*n.get_Weight()*n.get_DesiredPos()*n.get_ActualPos())},SolveQpsc:function(){var n,r,f,u,e,i,t;if(this.solverSolution.set_AlgorithmUsed(this.solverParams.get_Advanced().get_ScaleInQpsc()?Microsoft.Msagl.Core.ProjectionSolver.SolverAlgorithm.QpscWithScaling:Microsoft.Msagl.Core.ProjectionSolver.SolverAlgorithm.QpscWithoutScaling),this.QpscMakeFeasible()){for(n=new Microsoft.Msagl.Core.ProjectionSolver.Qpsc.ctor(this.solverParams,this.numberOfVariables),r=this.allBlocks.get_Vector().GetEnumerator();r.MoveNext();)for(f=r.get_Current(),u=f.get_Variables().GetEnumerator();u.MoveNext();)e=u.get_Current(),n.AddVariable(e);for(n.VariablesComplete(),this.ReinitializeBlocks(),this.MergeEqualityConstraints(),this.VerifyConstraintsAreFeasible(),i=!1,t=!1;;){if(!n.PreProject()&&!i&&!t)break;if(i=this.SplitBlocks(),!function(){var n={Value:t},i=this.RunProject(n);return t=n.Value,i}.call(this))break;if(!n.PostProject()&&!i&&!t)break}this.solverSolution.set_GoalFunctionValue(n.QpscComplete())}},QpscMakeFeasible:function(){var n;return function(){var t={Value:n},i=this.RunProject(t);return n=t.Value,i}.call(this)},VerifyConstraintsAreFeasible:function(){},ReinitializeBlocks:function(){var t=this.allBlocks.get_Vector().ToArray(),i,r,f;this.allBlocks.get_Vector().Clear();for(var n=0,e=t.length,u=t[n];n<e;n++,u=t[n])for(i=u.get_Variables().GetEnumerator();i.MoveNext();)r=i.get_Current(),r.Reinitialize(),f=new Microsoft.Msagl.Core.ProjectionSolver.Block.ctor(r,this.allConstraints),this.allBlocks.Add(f);this.allConstraints.Reinitialize();this.violationCache.Clear()},MergeEqualityConstraints:function(){for(var t=this.equalityConstraints.GetEnumerator(),n;t.MoveNext();){if(n=t.get_Current(),n.get_Left().get_Block()==n.get_Right().get_Block()){System.Math.Abs$$Double(n.get_Violation())>this.solverParams.get_GapTolerance()&&(n.set_IsUnsatisfiable(!0),++this.allConstraints.NumberOfUnsatisfiableConstraints);continue}this.MergeBlocks(n)}},Project:function(){if(0==this.numberOfConstraints)return!1;this.violationCache.Clear();this.lastModifiedBlock=null;var i=this.allBlocks.get_Count()>this.violationCacheMinBlockCutoff,t=1,r,n=function(){var n={Value:r},t=this.GetMaxViolatedConstraint(n,i);return r=n.Value,t}.call(this);if(null==n)return!1;while(null!=n){if(System.Diagnostics.Debug.Assert$$Boolean$$String(!n.get_IsUnsatisfiable(),"maxViolatedConstraint should not be unsatisfiable"),System.Diagnostics.Debug.Assert$$Boolean$$String(!n.get_IsEquality(),"maxViolatedConstraint should not be equality"),n.get_Left().get_Block()==n.get_Right().get_Block()?(n.get_Left().get_Block().Expand(n),n.get_IsUnsatisfiable()&&this.violationCache.Clear(),this.lastModifiedBlock=n.get_Left().get_Block()):this.lastModifiedBlock=this.MergeBlocks(n),this.solverParams.get_InnerProjectIterationsLimit()>0&&t>=this.solverParams.get_InnerProjectIterationsLimit()){this.solverSolution.set_InnerProjectIterationsLimitExceeded(!0);break}i=this.allBlocks.get_Count()>this.violationCacheMinBlockCutoff;i||this.violationCache.Clear();++t;n=function(){var n={Value:r},t=this.GetMaxViolatedConstraint(n,i);return r=n.Value,t}.call(this)}return this.solverSolution.set_InnerProjectIterationsTotal(this.solverSolution.get_InnerProjectIterationsTotal()+t),this.solverSolution.get_MaxInnerProjectIterations()<t&&this.solverSolution.set_MaxInnerProjectIterations(t),this.solverSolution.get_MinInnerProjectIterations()>t&&this.solverSolution.set_MinInnerProjectIterations(t),this.allConstraints.Debug_AssertConsistency(),!0},MergeBlocks:function(n){var t=n.get_Left().get_Block(),i=n.get_Right().get_Block(),r,e,u,f;for(System.Diagnostics.Debug.Assert$$Boolean$$String(t!=i,"Merging of constraints in the same block is not allowed"),r=n.get_Left().get_OffsetInBlock()+n.get_Gap()-n.get_Right().get_OffsetInBlock(),i.get_Variables().get_Count()>t.get_Variables().get_Count()&&(t=n.get_Right().get_Block(),i=n.get_Left().get_Block(),r=-r),e=i.get_Variables().get_Count(),u=0;u<e;++u)f=i.get_Variables().get_Item$$Int32(u),f.set_OffsetInBlock(f.get_OffsetInBlock()+r),t.AddVariable(f);return t.UpdateReferencePosFromSums(),t.DebugVerifyReferencePos(),t.Debug_PostMerge(i),this.allConstraints.ActivateConstraint(n),this.allBlocks.Remove(i),t},SplitBlocks:function(){for(var r,u,t,i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.Block.ctor),f=this.allBlocks.get_Count(),n=0;n<f;++n)t=this.allBlocks.get_Item$$Int32(n),System.Diagnostics.Debug.Assert$$Boolean$$String(0!=t.get_Variables().get_Count(),"block must have nonzero variable count"),r=t.Split(this.get_IsQpsc()),null!=r&&i.Add(r);for(u=i.get_Count(),n=0;n<u;++n)t=i.get_Item$$Int32(n),this.allBlocks.Add(t);return 0!=i.get_Count()},GetMaxViolatedConstraint:function(n,t){n.Value=this.solverParams.get_GapTolerance();var i=this.SearchViolationCache(n.Value);return null!=i?i:this.SearchAllConstraints(n.Value,t)},SearchViolationCache:function(n){var i=null,l,u,o,r,c;if(null!=this.lastModifiedBlock&&this.lastModifiedBlock.get_Variables().get_Count()<this.numberOfVariables>>1&&this.violationCache.FilterBlock(this.lastModifiedBlock)){for(l=this.lastModifiedBlock.get_Variables().get_Count(),u=0;u<l;++u){o=this.lastModifiedBlock.get_Variables().get_Item$$Int32(u);for(var f=0,s=o.get_LeftConstraints(),a=s.length,t=s[f];f<a;f++,t=s[f])t.get_IsActive()||t.get_IsUnsatisfiable()||(r=t.get_Left().get_ActualPos()*t.get_Left().get_Scale()+t.get_Gap()-t.get_Right().get_ActualPos()*t.get_Right().get_Scale(),System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(t.get_Violation(),r),"LeftConstraints: constraint.Violation must == violation"),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Greater(r,n)&&(null!=i&&n>this.violationCache.get_LowViolation()&&this.violationCache.Insert(i,n),n=t.get_Violation(),i=t));for(var e=0,h=o.get_RightConstraints(),v=h.length,t=h[e];e<v;e++,t=h[e])t.get_IsActive()||t.get_IsUnsatisfiable()||t.get_Left().get_Block()==this.lastModifiedBlock||(r=t.get_Left().get_ActualPos()*t.get_Left().get_Scale()+t.get_Gap()-t.get_Right().get_ActualPos()*t.get_Right().get_Scale(),System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(t.get_Violation(),r),"LeftConstraints: constraint.Violation must == violation"),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Greater(r,n)&&(null!=i&&n>this.violationCache.get_LowViolation()&&this.violationCache.Insert(i,n),n=r,i=t))}c=this.violationCache.FindIfGreater(n);null!=c&&(null!=i&&n>this.violationCache.get_LowViolation()&&this.violationCache.Insert(i,n),i=c)}return i},SearchAllConstraints:function(n,t){var e=null,r,u,f;this.violationCache.Clear();for(var o=0,s=this.allConstraints.get_Vector(),h=s.length,i=s[o];o<h;o++,i=s[o]){if(i.get_IsActive())break;i.get_IsUnsatisfiable()||(r=i.get_Left().get_ActualPos()*i.get_Left().get_Scale()+i.get_Gap()-i.get_Right().get_ActualPos()*i.get_Right().get_Scale(),System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(i.get_Violation(),r),"constraint.Violation must == violation"),u=null,f=0,Microsoft.Msagl.Core.Geometry.ApproximateComparer.Greater(r,n)&&(n>this.violationCache.get_LowViolation()&&(u=e,f=n),n=r,e=i),t&&(null==u&&i!=e&&(!this.violationCache.get_IsFull()||r>this.violationCache.get_LowViolation())&&(u=i,f=r),null!=u&&f>this.violationCache.get_LowViolation()&&this.violationCache.Insert(u,f)))}return e}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Solver);Microsoft$Msagl$Core$ProjectionSolver$Variable={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Variable",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.IComparable$1"],Kind:"Class",definition:{ctor:function(n,t,i,r,u){if(this.activeConstraintCount=0,this._UserData=null,this._DesiredPos=0,this._Weight=0,this._Scale=0,this._ActualPos=0,this._OffsetInBlock=0,this._Block=null,this._Ordinal=0,this._LeftConstraints=null,this._RightConstraints=null,this._Neighbors=null,System.Object.ctor.call(this),r<=0)throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String("weight","Variable Weight must be greater than zero"),new Error);if(u<=0)throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String("scale","Variable Scale must be greater than zero"),new Error);var f=i*r;if(System.Double.IsInfinity(f)||System.Double.IsNaN(f))throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String("desiredPos","Invalid Variable DesiredPosition * Weight"),new Error);if(f=i*u,System.Double.IsInfinity(f)||System.Double.IsNaN(f))throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String("desiredPos","Invalid Variable DesiredPosition * Scale"),new Error);this.set_Ordinal(n);this.set_UserData(t);this.set_DesiredPos(i);this.set_Weight(r);this.set_Scale(u);this.set_OffsetInBlock(0);this.set_ActualPos(this.get_DesiredPos())},UserData$$:"System.Object",get_UserData:function(){return this._UserData},set_UserData:function(n){this._UserData=n},DesiredPos$$:"System.Double",get_DesiredPos:function(){return this._DesiredPos},set_DesiredPos:function(n){this._DesiredPos=n},Weight$$:"System.Double",get_Weight:function(){return this._Weight},set_Weight:function(n){this._Weight=n},Scale$$:"System.Double",get_Scale:function(){return this._Scale},set_Scale:function(n){this._Scale=n},ActualPos$$:"System.Double",get_ActualPos:function(){return this._ActualPos},set_ActualPos:function(n){this._ActualPos=n},DfDv$$:"System.Double",get_DfDv:function(){return 2*this.get_Weight()*(this.get_ActualPos()-this.get_DesiredPos())/this.get_Scale()},OffsetInBlock$$:"System.Double",get_OffsetInBlock:function(){return this._OffsetInBlock},set_OffsetInBlock:function(n){this._OffsetInBlock=n},Block$$:"Microsoft.Msagl.Core.ProjectionSolver.Block",get_Block:function(){return this._Block},set_Block:function(n){this._Block=n},Ordinal$$:"System.UInt32",get_Ordinal:function(){return this._Ordinal},set_Ordinal:function(n){this._Ordinal=n},LeftConstraints$$:"Microsoft.Msagl.Core.ProjectionSolver.Constraint[]",get_LeftConstraints:function(){return this._LeftConstraints},set_LeftConstraints:function(n){this._LeftConstraints=n},RightConstraints$$:"Microsoft.Msagl.Core.ProjectionSolver.Constraint[]",get_RightConstraints:function(){return this._RightConstraints},set_RightConstraints:function(n){this._RightConstraints=n},ActiveConstraintCount$$:"System.Int32",get_ActiveConstraintCount:function(){return this.activeConstraintCount},set_ActiveConstraintCount:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(n>=0,"ActiveConstraintCount must be >= 0");this.activeConstraintCount=n},Neighbors$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.ProjectionSolver.Variable+NeighborAndWeight]]",get_Neighbors:function(){return this._Neighbors},set_Neighbors:function(n){this._Neighbors=n},Reinitialize:function(){this.set_ActiveConstraintCount(0);this.set_OffsetInBlock(0);this.set_ActualPos(this.get_DesiredPos())},AddNeighbor:function(n,t){null==this.get_Neighbors()&&this.set_Neighbors(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.Variable.NeighborAndWeight.ctor));this.get_Neighbors().Add(new Microsoft.Msagl.Core.ProjectionSolver.Variable.NeighborAndWeight.ctor$$Variable$$Double(n,t))},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0} {1:F5} ({2:F5}) {3:F5} {4:F5}",[this.get_Name(),this.get_ActualPos(),this.get_DesiredPos(),this.get_Weight(),this.get_Scale()])},Name$$:"System.String",get_Name:function(){return null==this.get_UserData()?"-0-":this.get_UserData().toString()},SetConstraints:function(n,t){this.set_LeftConstraints(n);this.set_RightConstraints(t)},CompareTo:function(n){return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"other"),this.get_Ordinal().CompareTo$$UInt32(n.get_Ordinal())}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Variable);Microsoft$Msagl$Core$ProjectionSolver$ViolationCache={fullname:"Microsoft.Msagl.Core.ProjectionSolver.ViolationCache",baseTypeName:"System.ValueType",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.ProjectionSolver.ViolationCache.MaxConstraints=20}},assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor:function(){this.constraints=null;this.numConstraints=0;this._LowViolation=0;System.ValueType.ctor.call(this)},LowViolation$$:"System.Double",get_LowViolation:function(){return this._LowViolation},set_LowViolation:function(n){this._LowViolation=n},IsFull$$:"System.Boolean",get_IsFull:function(){return this.numConstraints==20},Clear:function(){this.set_LowViolation(0);this.numConstraints=0;null==this.constraints&&(this.constraints=new Array(20))},FilterBlock:function(n){var u,i,t,r;for(this.set_LowViolation(1.79769313486232E+308),u=this.numConstraints>0,i=this.numConstraints-1;i>=0;--i)t=this.constraints[i],t.get_Left().get_Block()==n||t.get_Right().get_Block()==n||t.get_IsActive()||t.get_IsUnsatisfiable()?(i<this.numConstraints-1&&(this.constraints[i]=this.constraints[this.numConstraints-1]),--this.numConstraints):(r=t.get_Left().get_ActualPos()*t.get_Left().get_Scale()+t.get_Gap()-t.get_Right().get_ActualPos()*t.get_Right().get_Scale(),System.Diagnostics.Debug.Assert$$Boolean$$String(t.get_Violation()==r,"LeftConstraints: constraint.Violation must == violation"),r<this.get_LowViolation()&&this.set_LowViolation(r));return 0==this.numConstraints&&this.set_LowViolation(0),u},FindIfGreater:function(n){for(var t,i,u=null,r=0;r<this.numConstraints;++r)t=this.constraints[r],i=t.get_Left().get_ActualPos()*t.get_Left().get_Scale()+t.get_Gap()-t.get_Right().get_ActualPos()*t.get_Right().get_Scale(),System.Diagnostics.Debug.Assert$$Boolean$$String(t.get_Violation()==i,"constraint.Violation must == violation"),i>n&&(n=i,u=t);return u},Insert:function(n,t){var u,i,r;System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_Violation()>this.get_LowViolation(),"constraintToInsert.Violation must be > LowViolation");System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_Violation()==t,"constraintToInsert.Violation must == insertViolation");var o=0,f=t,e=t;for(u=0;u<this.numConstraints;++u)i=this.constraints[u],r=i.get_Left().get_ActualPos()*i.get_Left().get_Scale()+i.get_Gap()-i.get_Right().get_ActualPos()*i.get_Right().get_Scale(),System.Diagnostics.Debug.Assert$$Boolean$$String(i.get_Violation()==r,"constraint.Violation must == cacheViolation"),r<f?(e=f,o=u,f=r):r<e&&(e=r);this.get_IsFull()?(this.constraints[o]=n,this.set_LowViolation(e)):(this.constraints[this.numConstraints++]=n,this.get_IsFull()&&this.set_LowViolation(f))}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$ViolationCache);Microsoft$Msagl$Core$Geometry$ConstraintGenerator={fullname:"Microsoft.Msagl.Core.Geometry.ConstraintGenerator",baseTypeName:"System.Object",staticDefinition:{DefaultPadding$$:"System.Double",get_DefaultPadding:function(){return 7}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Boolean:function(n){this.clusterHierarchies=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor);this.nextNodeId=0;this._Padding=0;this._PaddingP=0;this._ClusterPadding=0;this._ClusterPaddingP=0;this._IsHorizontal=!1;Microsoft.Msagl.Core.Geometry.ConstraintGenerator.ctor$$Boolean$$Double$$Double.call(this,n,Microsoft.Msagl.Core.Geometry.ConstraintGenerator.get_DefaultPadding(),Microsoft.Msagl.Core.Geometry.ConstraintGenerator.get_DefaultPadding())},ClusterHierarchies$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster]]",get_ClusterHierarchies:function(){return this.clusterHierarchies},DefaultClusterHierarchy$$:"Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster",get_DefaultClusterHierarchy:function(){return this.clusterHierarchies.get_Item$$Int32(0)},Padding$$:"System.Double",get_Padding:function(){return this._Padding},set_Padding:function(n){this._Padding=n},PaddingP$$:"System.Double",get_PaddingP:function(){return this._PaddingP},set_PaddingP:function(n){this._PaddingP=n},ClusterPadding$$:"System.Double",get_ClusterPadding:function(){return this._ClusterPadding},set_ClusterPadding:function(n){this._ClusterPadding=n},ClusterPaddingP$$:"System.Double",get_ClusterPaddingP:function(){return this._ClusterPaddingP},set_ClusterPaddingP:function(n){this._ClusterPaddingP=n},IsHorizontal$$:"System.Boolean",get_IsHorizontal:function(){return this._IsHorizontal},set_IsHorizontal:function(n){this._IsHorizontal=n},ctor$$Boolean$$Double$$Double$$Double$$Double:function(n,t,i,r,u){this.clusterHierarchies=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor);this.nextNodeId=0;this._Padding=0;this._PaddingP=0;this._ClusterPadding=0;this._ClusterPaddingP=0;this._IsHorizontal=!1;System.Object.ctor.call(this);Microsoft.Msagl.Core.ValidateArg.IsPositive(t,"padding");this.set_IsHorizontal(n);this.set_Padding(t);this.set_PaddingP(i);this.set_ClusterPadding(r);this.set_ClusterPaddingP(u);this.clusterHierarchies.Add(new Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor$$UInt32$$OverlapRemovalCluster$$Object$$Double$$Double(0,null,0,this.get_Padding(),this.get_PaddingP()));this.nextNodeId+=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.get_NumInternalNodes()},ctor$$Boolean$$Double$$Double:function(n,t,i){this.clusterHierarchies=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor);this.nextNodeId=0;this._Padding=0;this._PaddingP=0;this._ClusterPadding=0;this._ClusterPaddingP=0;this._IsHorizontal=!1;Microsoft.Msagl.Core.Geometry.ConstraintGenerator.ctor$$Boolean$$Double$$Double$$Double$$Double.call(this,n,t,i,t,i)},AddNode:function(n,t,i,r,u,f,e){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"initialCluster");System.Diagnostics.Debug.Assert$$Boolean$$String(null!=n,"initialCluster must not be null");var o=new Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.ctor$$UInt32$$Object$$Double$$Double$$Double$$Double$$Double(this.nextNodeId++,t,i,r,u,f,e);return n.AddNode(o),o},AddCluster$$OverlapRemovalCluster$$Object$$BorderInfo$$BorderInfo$$BorderInfo$$BorderInfo:function(n,t,i,r,u,f){return this.AddCluster$$OverlapRemovalCluster$$Object$$Double$$Double$$BorderInfo$$BorderInfo$$BorderInfo$$BorderInfo(n,t,0,0,i,r,u,f)},AddCluster$$OverlapRemovalCluster$$Object$$Double$$Double$$BorderInfo$$BorderInfo$$BorderInfo$$BorderInfo:function(n,t,i,r,u,f,e,o){var s=new Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor$$UInt32$$OverlapRemovalCluster$$Object$$Double$$Double$$Double$$Double$$Double$$Double$$BorderInfo$$BorderInfo$$BorderInfo$$BorderInfo(this.nextNodeId,n,t,i,r,this.get_Padding(),this.get_PaddingP(),this.get_ClusterPadding(),this.get_ClusterPaddingP(),u,f,e,o);return this.nextNodeId+=Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.get_NumInternalNodes(),null==n?this.clusterHierarchies.Add(s):n.AddNode(s),s},AddCluster$$OverlapRemovalCluster$$Object:function(n,t){return this.AddCluster$$OverlapRemovalCluster$$Object$$BorderInfo$$BorderInfo$$BorderInfo$$BorderInfo(n,t,new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0),new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0),new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0),new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0))},AddCluster$$OverlapRemovalCluster$$Object$$Double$$Double:function(n,t,i,r){return this.AddCluster$$OverlapRemovalCluster$$Object$$Double$$Double$$BorderInfo$$BorderInfo$$BorderInfo$$BorderInfo(n,t,i,r,new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0),new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0),new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0),new Microsoft.Msagl.Core.Geometry.BorderInfo.ctor$$Double(0))},AddNodeToCluster:function(n,t){if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"cluster"),Is(t,Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ctor))throw $CreateException(new System.InvalidOperationException.ctor$$String("Argument 'node' must not be a Cluster"),new Error);n.AddNode(t)},Generate:function(n,t){var i,r;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"solver"),null==t&&(t=new Microsoft.Msagl.Core.Geometry.OverlapRemovalParameters.ctor),i=this.clusterHierarchies.GetEnumerator();i.MoveNext();)r=i.get_Current(),r.Generate(n,t,this.get_IsHorizontal());n.UpdateVariables()},Solve:function(n,t,i){var u,r,f;for(null==n&&(n=new Microsoft.Msagl.Core.ProjectionSolver.Solver.ctor),null==t&&(t=new Microsoft.Msagl.Core.Geometry.OverlapRemovalParameters.ctor),i&&this.Generate(n,t),u=n.Solve$$Parameters(t.get_SolverParameters()),r=this.clusterHierarchies.GetEnumerator();r.MoveNext();)f=r.get_Current(),f.UpdateFromVariable();return u}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$ConstraintGenerator);Microsoft$Msagl$Core$Geometry$OverlapRemovalNode={fullname:"Microsoft.Msagl.Core.Geometry.OverlapRemovalNode",baseTypeName:"System.Object",staticDefinition:{Overlap:function(n,t,i){return(n.get_Size()+t.get_Size())/2+i-System.Math.Abs$$Double(n.get_Position()-t.get_Position())},OverlapP:function(n,t,i){return(n.get_SizeP()+t.get_SizeP())/2+i-System.Math.Abs$$Double(n.get_PositionP()-t.get_PositionP())}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.IComparable$1","System.IComparable"],Kind:"Class",definition:{ctor$$UInt32$$Object$$Double$$Double$$Double$$Double$$Double:function(n,t,i,r,u,f,e){if(this._UserData=null,this._Variable=null,this._LeftNeighbors=null,this._RightNeighbors=null,this._DeferredLeftNeighborToV=!1,this._DeferredRightNeighborToV=!1,this._Position=0,this._PositionP=0,this._Size=0,this._SizeP=0,this._Weight=0,this._Id=0,System.Object.ctor.call(this),Microsoft.Msagl.Core.ValidateArg.IsPositive(u,"size"),Microsoft.Msagl.Core.ValidateArg.IsPositive(u,"sizeP"),Microsoft.Msagl.Core.ValidateArg.IsPositive(e,"weight"),e<=0)throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String("weight","Invalid node properties"),new Error);var o=(System.Math.Abs$$Double(i)+u)*e;if(System.Double.IsInfinity(o)||System.Double.IsNaN(o))throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String("position","Invalid node properties"),new Error);if(o=(System.Math.Abs$$Double(r)+f)*e,System.Double.IsInfinity(o)||System.Double.IsNaN(o))throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String("positionP","Invalid node properties"),new Error);this.set_Id(n);this.set_UserData(t);this.set_Position(i);this.set_PositionP(r);this.set_Size(u);this.set_SizeP(f);this.set_Weight(e)},UserData$$:"System.Object",get_UserData:function(){return this._UserData},set_UserData:function(n){this._UserData=n},UserDataString$$:"System.String",get_UserDataString:function(){return null==this.get_UserData()?"-0-":this.get_UserData().toString()},Variable$$:"Microsoft.Msagl.Core.ProjectionSolver.Variable",get_Variable:function(){return this._Variable},set_Variable:function(n){this._Variable=n},LeftNeighbors$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Geometry.OverlapRemovalNode]]",get_LeftNeighbors:function(){return this._LeftNeighbors},set_LeftNeighbors:function(n){this._LeftNeighbors=n},RightNeighbors$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Geometry.OverlapRemovalNode]]",get_RightNeighbors:function(){return this._RightNeighbors},set_RightNeighbors:function(n){this._RightNeighbors=n},DeferredLeftNeighborToV$$:"System.Boolean",get_DeferredLeftNeighborToV:function(){return this._DeferredLeftNeighborToV},set_DeferredLeftNeighborToV:function(n){this._DeferredLeftNeighborToV=n},DeferredRightNeighborToV$$:"System.Boolean",get_DeferredRightNeighborToV:function(){return this._DeferredRightNeighborToV},set_DeferredRightNeighborToV:function(n){this._DeferredRightNeighborToV=n},Position$$:"System.Double",get_Position:function(){return this._Position},set_Position:function(n){this._Position=n},PositionP$$:"System.Double",get_PositionP:function(){return this._PositionP},set_PositionP:function(n){this._PositionP=n},Size$$:"System.Double",get_Size:function(){return this._Size},set_Size:function(n){this._Size=n},SizeP$$:"System.Double",get_SizeP:function(){return this._SizeP},set_SizeP:function(n){this._SizeP=n},Open$$:"System.Double",get_Open:function(){return this.get_Position()-this.get_Size()/2},Close$$:"System.Double",get_Close:function(){return this.get_Position()+this.get_Size()/2},OpenP$$:"System.Double",get_OpenP:function(){return this.get_PositionP()-this.get_SizeP()/2},CloseP$$:"System.Double",get_CloseP:function(){return this.get_PositionP()+this.get_SizeP()/2},Weight$$:"System.Double",get_Weight:function(){return this._Weight},set_Weight:function(n){this._Weight=n},Id$$:"System.UInt32",get_Id:function(){return this._Id},set_Id:function(n){this._Id=n},ctor$$UInt32$$Object:function(n,t){this._UserData=null;this._Variable=null;this._LeftNeighbors=null;this._RightNeighbors=null;this._DeferredLeftNeighborToV=!1;this._DeferredRightNeighborToV=!1;this._Position=0;this._PositionP=0;this._Size=0;this._SizeP=0;this._Weight=0;this._Id=0;Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.ctor$$UInt32$$Object$$Double$$Double$$Double$$Double$$Double.call(this,n,t,0,0,0,0,Microsoft.Msagl.Core.Geometry.BorderInfo.get_DefaultFreeWeight())},CreateVariable:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"solver");null==this.get_Variable()?this.set_Variable(n.AddVariable$$Object$$Double$$Double(this,this.get_Position(),this.get_Weight())):this.UpdateDesiredPosition(this.get_Position())},UpdateFromVariable:function(){null!=this.get_Variable()&&(this.set_Position(this.get_Variable().get_ActualPos()),this.set_Variable(null))},UpdateDesiredPosition:function(n){this.set_Position(n);this.get_Variable().set_DesiredPos(n)},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"Nod '{0}': id {1} p {2:F5} s {3:F5} pP {4:F5} sP {5:F5}",[this.get_UserDataString(),this.get_Id(),this.get_Position(),this.get_Size(),this.get_PositionP(),this.get_SizeP()])},CompareTo$$OverlapRemovalNode:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"other");var t=this.get_Position().CompareTo$$Double(n.get_Position());return 0==t&&(t=this.get_Id().CompareTo$$UInt32(n.get_Id())),t},CompareTo$$Object:function(n){var t=As(n,Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.ctor);if(null==t)throw $CreateException(new System.InvalidOperationException.ctor$$String("Argument 'obj' must be a Node"),new Error);return this.CompareTo$$OverlapRemovalNode(t)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OverlapRemovalNode);Microsoft$Msagl$Core$Geometry$NodeComparer={fullname:"Microsoft.Msagl.Core.Geometry.NodeComparer",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)},Compare:function(n,t){return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"lhs"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"rhs"),n.CompareTo$$OverlapRemovalNode(t)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$NodeComparer);Microsoft$Msagl$Routing$Rectilinear$Nudging$SegWithIndex={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.Points=null;this.I=0;this._hashKey=null;System.Object.ctor.call(this);System.Diagnostics.Debug.Assert$$Boolean(t<n.length&&t>=0);this.Points=n;this.I=t;this.UpdateHashKey()},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.Points[this.I]},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.Points[this.I+1]},Equals$$Object:function(n){var t=Cast(n,Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor);return t.Points==this.Points&&t.I==this.I},GetHashCode:function(){return this.Points.GetHashCode()*397^this.I},UpdateHashKey:function(){this._hashKey=this.GetHashCode().toString()}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$SegWithIndex);Microsoft$Msagl$Routing$Rectilinear$Nudging$StaircaseRemover={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.StaircaseRemover",baseTypeName:"System.Object",staticDefinition:{RemoveStaircases:function(n,t){var i=new Microsoft.Msagl.Routing.Rectilinear.Nudging.StaircaseRemover.ctor(n,t);i.Calculate()},GetFlippedPoint:function(n,t){var i=Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n[t].get_Y(),n[t+1].get_Y());return i?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[t+4].get_X(),n[t].get_Y()):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n[t].get_X(),n[t+4].get_Y())},IsCrossing:function(n,t,i){return System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor,t.GetAllIntersecting(n.get_BoundingBox()),function(n){return!System.Linq.Enumerable.Contains$1$$IEnumerable$1$$TSource(Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor,i,n)}))},Rect:function(n){return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n.get_Start(),n.get_End())}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.segTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor);this.crossedOutPaths=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor);this._Paths=null;this._HierarchyOfObstacles=null;System.Object.ctor.call(this);this.set_HierarchyOfObstacles(new Microsoft.Msagl.Core.Geometry.RTree$1.ctor$$RectangleNode$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,t));this.set_Paths(n)},Paths$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.Path]]",get_Paths:function(){return this._Paths},set_Paths:function(n){this._Paths=n},HierarchyOfObstacles$$:"Microsoft.Msagl.Core.Geometry.RTree`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_HierarchyOfObstacles:function(){return this._HierarchyOfObstacles},set_HierarchyOfObstacles:function(n){this._HierarchyOfObstacles=n},Calculate:function(){var n,t,i;this.InitHierarchies();do for(n=!1,t=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,this.get_Paths(),$CreateAnonymousDelegate(this,function(n){return!this.crossedOutPaths.Contains$$T(n)})).GetEnumerator();t.MoveNext();)i=t.get_Current(),n|=this.ProcessPath(i);while(n)},ProcessPath:function(n){var t=n.get_PathPoints()instanceof Array||n.get_PathPoints()==null?n.get_PathPoints():function(){throw new Error("InvalidCastException");}(),i;return function(){var n={Value:t},r={Value:i},u=this.ProcessPoints(n,r);return t=n.Value,i=r.Value,u}.call(this)?(n.set_PathPoints(t),!0):(i||this.crossedOutPaths.Insert(n),!1)},ProcessPoints:function(n,t){var i=this.FindStaircaseStart(n.Value,t);return i<0?!1:(n.Value=this.RemoveStaircase$$Point$Array$$Int32(n.Value,i),!0)},FindStaircaseStart:function(n,t){var u,r,i,f;if(t.Value=!1,n.length<5)return-1;for(u=[new Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor(n,0),new Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor(n,1),new Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor(n,2),new Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor(n,3)],r=0,i=0;;){if(function(){var t={Value:f},r=this.IsStaircase(n,i,u,t);return f=t.Value,r}.call(this))return t.Value=!0,i;if(t.Value=t.Value||f,i++,n.length<i+5)return-1;u[r]=new Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor(n,i+3);r+=1;r%=4}},Crossing:function(n,t,i){return Microsoft.Msagl.Routing.Rectilinear.Nudging.StaircaseRemover.IsCrossing(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t),this.segTree,i)},IntersectObstacleHierarchy$$Point$$Point$$Point:function(n,t,i){return this.IntersectObstacleHierarchy$$LineSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t))||this.IntersectObstacleHierarchy$$LineSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t,i))},IntersectObstacleHierarchy$$LineSegment:function(n){return System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.get_HierarchyOfObstacles().GetAllIntersecting(n.get_BoundingBox()),$CreateAnonymousDelegate(this,function(t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(n,t,!1)!=null}))},IsStaircase:function(n,t,i,r){var o=n[t],f=n[t+1],u=n[t+2],e=n[t+3],s=n[t+4];return(r.Value=!1,Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(o,f)!=Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(u,e)||Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(f,u)!=Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(e,s))?!1:(u=Microsoft.Msagl.Routing.Rectilinear.Nudging.StaircaseRemover.GetFlippedPoint(n,t),this.IntersectObstacleHierarchy$$Point$$Point$$Point(f,u,e))?!1:(r.Value=!0,!this.Crossing(f,u,i))},RemoveStaircase$$Point$Array$$Int32:function(n,t){var i=n[t],r=n[t+1],u=System.Math.Abs$$Double(i.get_Y()-r.get_Y())<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon/2;return this.RemoveStaircase$$Point$Array$$Int32$$Boolean(n,t,u)},RemoveStaircase$$Point$Array$$Int32$$Boolean:function(n,t,i){var r,u,f;return this.RemoveSegs(n),r=new Array(n.length-2),System.Array.Copy(n,r,t+1),u=n[t+1],f=n[t+3],r[t+1]=i?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(f.get_X(),u.get_Y()):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u.get_X(),f.get_Y()),System.Array.Copy(n,t+4,r,t+2,r.length-t-2),this.InsertNewSegs(r,t),r},RemoveSegs:function(n){for(var t=0;t<n.length-1;t++)this.RemoveSeg(new Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor(n,t))},RemoveSeg:function(n){this.segTree.Remove(Microsoft.Msagl.Routing.Rectilinear.Nudging.StaircaseRemover.Rect(n),n)},InsertNewSegs:function(n,t){this.InsSeg(n,t);this.InsSeg(n,t+1)},InitHierarchies:function(){for(var n=this.get_Paths().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.InsertPathSegs(t)},InsertPathSegs:function(n){this.InsertSegs(n.get_PathPoints()instanceof Array||n.get_PathPoints()==null?n.get_PathPoints():function(){throw new Error("InvalidCastException");}())},InsertSegs:function(n){for(var t=0;t<n.length-1;t++)this.InsSeg(n,t)},InsSeg:function(n,t){var i=new Microsoft.Msagl.Routing.Rectilinear.Nudging.SegWithIndex.ctor(n,t);this.segTree.Add$$Rectangle$$TData(Microsoft.Msagl.Routing.Rectilinear.Nudging.StaircaseRemover.Rect(i),i)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$StaircaseRemover);Microsoft$Msagl$Routing$Rectilinear$GroupBoundaryCrossing={fullname:"Microsoft.Msagl.Routing.Rectilinear.GroupBoundaryCrossing",baseTypeName:"System.Object",staticDefinition:{BoundaryWidth$$:"System.Double",get_BoundaryWidth:function(){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this._Group=null;this._DirectionToInside=Microsoft.Msagl.Core.Geometry.Directions.None;System.Object.ctor.call(this);System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(t),"Impure direction");this.set_Group(n);this.set_DirectionToInside(t)},Group$$:"Microsoft.Msagl.Routing.Rectilinear.Obstacle",get_Group:function(){return this._Group},set_Group:function(n){this._Group=n},DirectionToInside$$:"Microsoft.Msagl.Core.Geometry.Directions",get_DirectionToInside:function(){return this._DirectionToInside},set_DirectionToInside:function(n){this._DirectionToInside=n},GetInteriorVertexPoint:function(n){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.CompassVector.ToPoint$$Directions(this.get_DirectionToInside()),Microsoft.Msagl.Routing.Rectilinear.GroupBoundaryCrossing.get_BoundaryWidth())))},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0} {1}",[this.get_DirectionToInside(),this.get_Group()])}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$GroupBoundaryCrossing);Microsoft$Msagl$Routing$Rectilinear$GroupBoundaryCrossingMap={fullname:"Microsoft.Msagl.Routing.Rectilinear.GroupBoundaryCrossingMap",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.pointCrossingMap=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Collections.Generic.List$1.ctor);this.pointList=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);System.Object.ctor.call(this)},AddIntersection:function(n,t,i){var r,o,u,f,e;for(function(){var t={Value:r},i=this.pointCrossingMap.TryGetValue(n,t);return r=t.Value,i}.call(this)||(r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.GroupBoundaryCrossing.ctor),this.pointCrossingMap.set_Item$$TKey(n,r)),o=r.get_Count(),u=0;u<o;++u)if(f=r.get_Item$$Int32(u),f.get_Group()==t)return System.Diagnostics.Debug.Assert$$Boolean$$String(i==f.get_DirectionToInside(),"Mismatched dirToInside"),f;return e=new Microsoft.Msagl.Routing.Rectilinear.GroupBoundaryCrossing.ctor(t,i),r.Add(e),e},Clear:function(){this.pointCrossingMap.Clear()},GetOrderedListBetween:function(n,t){var o,u,i,f,s,r,e;if(0==this.pointCrossingMap.get_Count())return null;for(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(n,t)>0&&(o=n,n=t,t=o),this.pointList.Clear(),u=this.pointCrossingMap.get_Keys().GetEnumerator();u.MoveNext();)i=u.get_Current(),Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(i,n)>=0&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(i,t)<=0&&this.pointList.Add(i);for(this.pointList.Sort(),f=new Microsoft.Msagl.Routing.Rectilinear.PointAndCrossingsList.ctor,s=this.pointList.get_Count(),r=0;r<s;++r)e=this.pointList.get_Item$$Int32(r),f.Add(e,this.pointCrossingMap.get_Item$$TKey(e));return f},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0}",[this.pointCrossingMap.get_Count()])}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$GroupBoundaryCrossingMap);Microsoft$Msagl$Routing$Rectilinear$PointAndCrossings={fullname:"Microsoft.Msagl.Routing.Rectilinear.PointAndCrossings",baseTypeName:"System.ValueType",assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Point$$List$1$GroupBoundaryCrossing:function(n,t){this._Location=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._Crossings=null;Microsoft.Msagl.Routing.Rectilinear.PointAndCrossings.ctor.call(this);this.set_Location(n);this.set_Crossings(t)},Location$$:"Microsoft.Msagl.Core.Geometry.Point",get_Location:function(){return this._Location},set_Location:function(n){this._Location=n},Crossings$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.GroupBoundaryCrossing]]",get_Crossings:function(){return this._Crossings},set_Crossings:function(n){this._Crossings=n},ctor:function(){this._Location=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._Crossings=null;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$PointAndCrossings);Microsoft$Msagl$Routing$Rectilinear$PointAndCrossingsList={fullname:"Microsoft.Msagl.Routing.Rectilinear.PointAndCrossingsList",baseTypeName:"System.Object",staticDefinition:{ToCrossingArray:function(n,t){for(var u,e,r=0,f=n.get_Count(),i=0;i<f;++i)n.get_Item$$Int32(i).get_DirectionToInside()==t&&++r;if(0==r)return null;for(u=new Array(r),e=0,i=0;i<f;++i)n.get_Item$$Int32(i).get_DirectionToInside()==t&&(u[e++]=n.get_Item$$Int32(i));return u}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.index=0;this._ListOfPointsAndCrossings=null;System.Object.ctor.call(this);this.set_ListOfPointsAndCrossings(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.PointAndCrossings.ctor))},ListOfPointsAndCrossings$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.PointAndCrossings]]",get_ListOfPointsAndCrossings:function(){return this._ListOfPointsAndCrossings},set_ListOfPointsAndCrossings:function(n){this._ListOfPointsAndCrossings=n},Count$$:"System.Int32",get_Count:function(){return this.get_ListOfPointsAndCrossings().get_Count()},Add:function(n,t){this.get_ListOfPointsAndCrossings().Add(new Microsoft.Msagl.Routing.Rectilinear.PointAndCrossings.ctor$$Point$$List$1$GroupBoundaryCrossing(n,t))},Pop:function(){return System.Diagnostics.Debug.Assert$$Boolean$$String(this.index<this.get_ListOfPointsAndCrossings().get_Count(),"Unexpected call to Next()"),this.get_ListOfPointsAndCrossings().get_Item$$Int32(this.index++)},CurrentIsBeforeOrAt:function(n){return this.index>=this.get_ListOfPointsAndCrossings().get_Count()?!1:Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(this.get_ListOfPointsAndCrossings().get_Item$$Int32(this.index).get_Location(),n)<=0},First$$:"Microsoft.Msagl.Routing.Rectilinear.PointAndCrossings",get_First:function(){return this.get_ListOfPointsAndCrossings().get_Item$$Int32(0)},Last$$:"Microsoft.Msagl.Routing.Rectilinear.PointAndCrossings",get_Last:function(){return this.get_ListOfPointsAndCrossings().get_Item$$Int32(this.get_ListOfPointsAndCrossings().get_Count()-1)},Reset:function(){this.index=0},MergeFrom:function(n){if(this.Reset(),null!=n&&0!=n.get_ListOfPointsAndCrossings().get_Count()){if(0==this.get_ListOfPointsAndCrossings().get_Count()&&this.get_ListOfPointsAndCrossings().AddRange(n.get_ListOfPointsAndCrossings()),null==this.get_ListOfPointsAndCrossings()){this.set_ListOfPointsAndCrossings(new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Rectilinear.PointAndCrossings.ctor,n.get_ListOfPointsAndCrossings()));return}for(var t=0,f=this.get_ListOfPointsAndCrossings().get_Count(),i=0,e=n.get_ListOfPointsAndCrossings().get_Count(),r=new System.Collections.Generic.List$1.ctor$$Int32(Microsoft.Msagl.Routing.Rectilinear.PointAndCrossings.ctor,this.get_ListOfPointsAndCrossings().get_Count());t<f||i<e;){if(t>=f){r.Add(n.get_ListOfPointsAndCrossings().get_Item$$Int32(i++));continue}if(i>=e){r.Add(this.get_ListOfPointsAndCrossings().get_Item$$Int32(t++));continue}var u=this.get_ListOfPointsAndCrossings().get_Item$$Int32(t),o=n.get_ListOfPointsAndCrossings().get_Item$$Int32(i),s=Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(u.get_Location(),o.get_Location());0==s?(r.Add(u),++t,++i):-1==s?(r.Add(u),++t):(r.Add(o),++i)}this.set_ListOfPointsAndCrossings(r)}},Trim:function(n,t){(this.Reset(),null!=this.get_ListOfPointsAndCrossings()&&0!=this.get_ListOfPointsAndCrossings().get_Count())&&this.set_ListOfPointsAndCrossings(new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Rectilinear.PointAndCrossings.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.PointAndCrossings.ctor,this.get_ListOfPointsAndCrossings(),$CreateAnonymousDelegate(this,function(i){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(i.get_Location(),n)>=0&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(i.get_Location(),t)<=0}))))},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0} [{1}]",[this.get_ListOfPointsAndCrossings().get_Count(),this.index])}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$PointAndCrossingsList);Microsoft$Msagl$Routing$Rectilinear$ObstacleTree={fullname:"Microsoft.Msagl.Routing.Rectilinear.ObstacleTree",baseTypeName:"System.Object",staticDefinition:{CalculateHierarchy:function(n){var t=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,n,n.get_VisibilityBoundingBox())}));return Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnListOfNodes(t)},FirstRectangleContainsACornerOfTheOther:function(n,t){return n.Contains$$Point(t.get_LeftBottom())||n.Contains$$Point(t.get_LeftTop())||n.Contains$$Point(t.get_RightTop())||n.Contains$$Point(t.get_RightBottom())},FirstPolylineStartIsInsideSecondPolyline:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n.get_Start(),t)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside},ResolveGroupAndGroupOverlap:function(n,t){return t.get_IsGroup()?(n.get_VisibilityPolyline().get_BoundingBox().get_Area()>t.get_VisibilityPolyline().get_BoundingBox().get_Area()?Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.ResolveGroupAndObstacleOverlap(n,t):Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.ResolveGroupAndObstacleOverlap(t,n),!0):!1},ResolveGroupAndObstacleOverlap:function(n,t){var i=t.get_LooseVisibilityPolyline(),r,u;for(Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.GrowGroupAroundLoosePolyline(n,i);function(){var i={Value:r},f={Value:u},e=Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.ObstaclesIntersect(t,n,i,f);return r=i.Value,u=f.Value,e}()||!r;)i=Microsoft.Msagl.Routing.Rectilinear.Obstacle.CreateLoosePolyline(i),Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.GrowGroupAroundLoosePolyline(n,i);return},GrowGroupAroundLoosePolyline:function(n,t){var i=System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_VisibilityPolyline(),function(n){return n}),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,t,function(n){return n}));n.SetConvexHull(new Microsoft.Msagl.Routing.Rectilinear.OverlapConvexHull.ctor(Microsoft.Msagl.Core.Geometry.ConvexHull.CreateConvexHullAsClosedPolyline(i),[n]))},ObstaclesIntersect:function(n,t,i,r){return Microsoft.Msagl.Core.Geometry.Curves.Curve.CurvesIntersect(n.get_VisibilityPolyline(),t.get_VisibilityPolyline())?(i.Value=!1,r.Value=!1,!0):(i.Value=Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.FirstPolylineStartIsInsideSecondPolyline(n.get_VisibilityPolyline(),t.get_VisibilityPolyline()),r.Value=!i.Value&&Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.FirstPolylineStartIsInsideSecondPolyline(t.get_VisibilityPolyline(),n.get_VisibilityPolyline()),n.get_IsRectangle()&&t.get_IsRectangle())?!1:Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.ObstaclesAreCloseEnoughToBeConsideredTouching(n,t,i.Value,r.Value)?(i.Value=!1,r.Value=!1,!0):!1},ObstaclesAreCloseEnoughToBeConsideredTouching:function(n,t,i,r){var u,o;if(!i&&!r)return Microsoft.Msagl.Core.Geometry.Curves.Curve.CurvesIntersect(n.get_LooseVisibilityPolyline(),t.get_VisibilityPolyline());for(var s=i?n.get_LooseVisibilityPolyline():t.get_LooseVisibilityPolyline(),f=i?t.get_VisibilityPolyline():n.get_VisibilityPolyline(),e=s.GetEnumerator();e.MoveNext();)if(u=e.get_Current(),Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(u,f)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside&&(o=Microsoft.Msagl.Core.Geometry.Curves.Curve.ClosestPoint(f,u),!Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(u,o)))return!0;return!1}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.AncestorSets=null;this.SpatialAncestorsAdjusted=!1;this.shapeIdToObstacleMap=null;this.CurrentGroupBoundaryCrossingMap=new Microsoft.Msagl.Routing.Rectilinear.GroupBoundaryCrossingMap.ctor;this.allObstacles=null;this.overlapPairs=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor);this.hasOverlaps=!1;this.lookupIntPair=new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(-1,-1);this.insideHitTestIgnoreObstacle1=null;this.insideHitTestIgnoreObstacle2=null;this.insideHitTestScanDirection=null;this.restrictedIntersectionTestSegment=null;this.currentRestrictedRay=null;this.wantGroupCrossings=!1;this.stopAtGroups=!1;this.restrictedRayLengthSquared=0;this._Root=null;System.Object.ctor.call(this)},Root$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Routing.Rectilinear.Obstacle]]",get_Root:function(){return this._Root},set_Root:function(n){this._Root=n},GraphBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_GraphBox:function(){return this.get_Root().get_Rectangle()},Init:function(n,t,i){this.CreateObstacleListAndOrdinals(n);this.AncestorSets=t;this.CreateRoot();this.shapeIdToObstacleMap=i},CreateObstacleListAndOrdinals:function(n){var i,t,r;for(this.allObstacles=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,n),i=10,t=this.allObstacles.GetEnumerator();t.MoveNext();)r=t.get_Current(),r.set_Ordinal(i++)},OrdinalToObstacle:function(n){return System.Diagnostics.Debug.Assert$$Boolean$$String(n>=10,"index too small"),System.Diagnostics.Debug.Assert$$Boolean$$String(n<this.allObstacles.get_Count()+10,"index too large"),this.allObstacles.get_Item$$Int32(n-10)},CreateRoot:function(){(this.set_Root(Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.CalculateHierarchy(this.GetAllObstacles())),this.OverlapsExist())&&(this.AccreteClumps(),this.AccreteConvexHulls(),this.GrowGroupsToAccommodateOverlaps(),this.set_Root(Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.CalculateHierarchy(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,this.GetAllObstacles(),$CreateAnonymousDelegate(this,function(n){return n.get_IsPrimaryObstacle()})))))},OverlapsExist:function(){return this.get_Root()==null?!1:(Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,this.get_Root(),this.get_Root(),$CreateDelegate(this,this.CheckForInitialOverlaps)),this.hasOverlaps)},OverlapPairAlreadyFound:function(n,t){return this.lookupIntPair.x=t.get_Ordinal(),this.lookupIntPair.y=n.get_Ordinal(),this.overlapPairs.Contains$$T(this.lookupIntPair)},CheckForInitialOverlaps:function(n,t){if(!this.hasOverlaps){var i,r;if(function(){var u={Value:i},f={Value:r},e=Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.ObstaclesIntersect(n,t,u,f);return i=u.Value,r=f.Value,e}.call(this)){this.hasOverlaps=!0;return}(i||r)&&(n.get_IsGroup()&&t.get_IsGroup()||n.get_IsGroup()&&r||t.get_IsGroup()&&i||(this.hasOverlaps=!0))}},AccreteClumps:function(){(this.AccumulateObstaclesForClumps(),this.overlapPairs.get_Count()!=0)&&this.CreateClumps()},AccreteConvexHulls:function(){for(;;)if(this.AccumulateObstaclesForConvexHulls(),!this.CreateConvexHulls())return},AccumulateObstaclesForClumps:function(){this.overlapPairs.Clear();var n=Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.CalculateHierarchy(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,this.GetAllObstacles(),$CreateAnonymousDelegate(this,function(n){return!n.get_IsGroup()&&n.get_IsRectangle()})));n!=null&&Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,n,n,$CreateDelegate(this,this.EvaluateOverlappedPairForClump))},EvaluateOverlappedPairForClump:function(n,t){if(System.Diagnostics.Debug.Assert$$Boolean$$String(!n.get_IsGroup()&&!t.get_IsGroup(),"Groups should not come here"),System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_IsRectangle()&&t.get_IsRectangle(),"Only rectangles should come here"),n!=t&&!this.OverlapPairAlreadyFound(n,t)){var i,r;(function(){var u={Value:i},f={Value:r},e=Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.ObstaclesIntersect(n,t,u,f);return i=u.Value,r=f.Value,e}.call(this)||i||r)&&this.overlapPairs.Insert(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Ordinal(),t.get_Ordinal()))}},AccumulateObstaclesForConvexHulls:function(){this.overlapPairs.Clear();var n=Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.CalculateHierarchy(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,this.GetAllObstacles(),$CreateAnonymousDelegate(this,function(n){return n.get_IsPrimaryObstacle()&&!n.get_IsGroup()})));n!=null&&Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,n,n,$CreateDelegate(this,this.EvaluateOverlappedPairForConvexHull))},EvaluateOverlappedPairForConvexHull:function(n,t){if(System.Diagnostics.Debug.Assert$$Boolean$$String(!n.get_IsGroup()&&!t.get_IsGroup(),"Groups should not come here"),n!=t&&!this.OverlapPairAlreadyFound(n,t)){var i,r;(function(){var u={Value:i},f={Value:r},e=Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.ObstaclesIntersect(n,t,u,f);return i=u.Value,r=f.Value,e}.call(this)||i||r)&&(n.get_IsInConvexHull()||t.get_IsInConvexHull()||!n.get_IsRectangle()||!t.get_IsRectangle())&&(this.overlapPairs.Insert(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Ordinal(),t.get_Ordinal())),this.AddClumpToConvexHull(n),this.AddClumpToConvexHull(t),this.AddConvexHullToConvexHull(n),this.AddConvexHullToConvexHull(t))}},GrowGroupsToAccommodateOverlaps:function(){for(;;)if(this.AccumulateObstaclesForGroupOverlaps(),!this.GrowGroupsToResolveOverlaps())return},AccumulateObstaclesForGroupOverlaps:function(){var n=Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.CalculateHierarchy(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,this.GetAllObstacles(),$CreateAnonymousDelegate(this,function(n){return n.get_IsGroup()}))),t=Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.CalculateHierarchy(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,this.GetAllObstacles(),$CreateAnonymousDelegate(this,function(n){return n.get_IsPrimaryObstacle()})));n!=null&&t!=null&&Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,n,t,$CreateDelegate(this,this.EvaluateOverlappedPairForGroup))},EvaluateOverlappedPairForGroup:function(n,t){if(System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_IsGroup(),"Inconsistency in overlapping group enumeration"),n!=t&&!this.OverlapPairAlreadyFound(n,t)){var i,r,u=function(){var u={Value:i},f={Value:r},e=Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.ObstaclesIntersect(n,t,u,f);return i=u.Value,r=f.Value,e}.call(this);if(u||i||r){if(n.get_IsRectangle()&&t.get_IsRectangle()){t.get_IsGroup()||(i||Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.FirstRectangleContainsACornerOfTheOther(t.get_VisibilityBoundingBox(),n.get_VisibilityBoundingBox()))&&t.set_OverlapsGroupCorner(!0);return}!u&&(t.get_IsGroup()||r)||this.overlapPairs.Insert(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Ordinal(),t.get_Ordinal()))}}},AddClumpToConvexHull:function(n){var t,i;if(n.get_IsOverlapped()){for(t=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,n.get_Clump(),$CreateAnonymousDelegate(this,function(t){return t.get_Ordinal()!=n.get_Ordinal()})).GetEnumerator();t.MoveNext();)i=t.get_Current(),this.overlapPairs.Insert(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Ordinal(),i.get_Ordinal()));n.get_Clump().Clear()}},AddConvexHullToConvexHull:function(n){var t,i;if(n.get_IsInConvexHull()){for(t=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,n.get_ConvexHull().get_Obstacles(),$CreateAnonymousDelegate(this,function(t){return t.get_Ordinal()!=n.get_Ordinal()})).GetEnumerator();t.MoveNext();)i=t.get_Current(),this.overlapPairs.Insert(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Ordinal(),i.get_Ordinal()));n.get_ConvexHull().get_Obstacles().Clear()}},CreateClumps:function(){for(var f=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.overlapPairs),e=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(f),r=e.GetEnumerator(),n,t,i,u;r.MoveNext();)if(n=r.get_Current(),System.Linq.Enumerable.Count$1$$IEnumerable$1(System.Int32.ctor,n)!=1)for(t=new Microsoft.Msagl.Routing.Rectilinear.Clump.ctor(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Int32.ctor,Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,n,$CreateDelegate(this,this.OrdinalToObstacle))),i=t.GetEnumerator();i.MoveNext();)u=i.get_Current(),u.set_Clump(t)},CreateConvexHulls:function(){for(var i=!1,e=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.overlapPairs),o=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(e),r=o.GetEnumerator(),n,f;r.MoveNext();)if(n=r.get_Current(),System.Linq.Enumerable.Count$1$$IEnumerable$1(System.Int32.ctor,n)!=1){i=!0;for(var t=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Int32.ctor,Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,n,$CreateDelegate(this,this.OrdinalToObstacle)),s=System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,t,$CreateAnonymousDelegate(this,function(n){return n.get_VisibilityPolyline()})),h=new Microsoft.Msagl.Routing.Rectilinear.OverlapConvexHull.ctor(Microsoft.Msagl.Core.Geometry.ConvexHull.CreateConvexHullAsClosedPolyline(s),t),u=t.GetEnumerator();u.MoveNext();)f=u.get_Current(),f.SetConvexHull(h)}return i},GrowGroupsToResolveOverlaps:function(){for(var r=!1,u=this.overlapPairs.GetEnumerator(),n,t,i;u.MoveNext();)n=u.get_Current(),r=!0,t=this.OrdinalToObstacle(n.get_First()),i=this.OrdinalToObstacle(n.get_Second()),Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.ResolveGroupAndGroupOverlap(t,i)||Microsoft.Msagl.Routing.Rectilinear.ObstacleTree.ResolveGroupAndObstacleOverlap(t,i);return this.overlapPairs.Clear(),r},AdjustSpatialAncestors:function(){var u,t,f,h,i,e,r,c,o,n;if(this.SpatialAncestorsAdjusted)return!1;for(u=this.GetAllGroups().GetEnumerator();u.MoveNext();)for(var n=u.get_Current(),l=n.get_VisibilityBoundingBox(),s=this.get_Root().GetNodeItemsIntersectingRectangle(l).GetEnumerator();s.MoveNext();)if(t=s.get_Current(),t!=n&&Microsoft.Msagl.Core.Geometry.Curves.Curve.ClosedCurveInteriorsIntersect(t.get_VisibilityPolyline(),n.get_VisibilityPolyline())){if(t.get_IsInConvexHull())for(System.Diagnostics.Debug.Assert$$Boolean$$String(t.get_IsPrimaryObstacle(),"Only primary obstacles should be in the hierarchy"),f=t.get_ConvexHull().get_Obstacles().GetEnumerator();f.MoveNext();)h=f.get_Current(),this.AncestorSets.get_Item$$TKey(h.get_InputShape()).Insert(n.get_InputShape());this.AncestorSets.get_Item$$TKey(t.get_InputShape()).Insert(n.get_InputShape())}for(i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Shape.ctor),e=this.get_Root().GetAllLeaves().GetEnumerator();e.MoveNext();){for(r=e.get_Current(),c=r.get_VisibilityBoundingBox(),i.AddRange(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,this.AncestorSets.get_Item$$TKey(r.get_InputShape()),$CreateAnonymousDelegate(this,function(n){return!c.Intersects(this.shapeIdToObstacleMap.get_Item$$TKey(n).get_VisibilityBoundingBox())}))),o=i.GetEnumerator();o.MoveNext();)n=o.get_Current(),this.AncestorSets.get_Item$$TKey(r.get_InputShape()).Remove(n);i.Clear()}return this.SpatialAncestorsAdjusted=!0,!0},GetAllGroups:function(){return System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,this.GetAllObstacles(),$CreateAnonymousDelegate(this,function(n){return n.get_IsGroup()}))},Clear:function(){this.set_Root(null);this.AncestorSets=null},CreateMaxVisibilitySegment:function(n,t,i){var u=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.RectangleBorderIntersect(this.get_GraphBox(),n,t),r;return Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n,u)==Microsoft.Msagl.Core.Geometry.Directions.None?(i.Value=null,new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,n)):(r=this.RestrictSegmentWithObstacles(n,u),i.Value=this.CurrentGroupBoundaryCrossingMap.GetOrderedListBetween(r.get_Start(),r.get_End()),r)},GetAllObstacles:function(){return this.allObstacles},GetAllPrimaryObstacles:function(){return this.get_Root().GetAllLeaves()},IntersectionIsInsideAnotherObstacle:function(n,t,i,r){this.insideHitTestIgnoreObstacle1=t;this.insideHitTestIgnoreObstacle2=n;this.insideHitTestScanDirection=r;var u=this.get_Root().FirstHitNode$$Point$$Func$3(i,$CreateDelegate(this,this.InsideObstacleHitTest));return null!=u},PointIsInsideAnObstacle$$Point$$Directions:function(n,t){return this.PointIsInsideAnObstacle$$Point$$ScanDirection(n,Microsoft.Msagl.Routing.Rectilinear.ScanDirection.GetInstance(t))},PointIsInsideAnObstacle$$Point$$ScanDirection:function(n,t){this.insideHitTestIgnoreObstacle1=null;this.insideHitTestIgnoreObstacle2=null;this.insideHitTestScanDirection=t;var i=this.get_Root().FirstHitNode$$Point$$Func$3(n,$CreateDelegate(this,this.InsideObstacleHitTest));return null!=i},InsideObstacleHitTest:function(n,t){var r,u;if(t==this.insideHitTestIgnoreObstacle1||t==this.insideHitTestIgnoreObstacle2||t.get_IsGroup()||!Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.PointIsInRectangleInterior(n,t.get_VisibilityBoundingBox()))return Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue;var e=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.RectangleBorderIntersect(t.get_VisibilityBoundingBox(),n,this.insideHitTestScanDirection.get_Direction()),this.insideHitTestScanDirection.get_DirectionAsPoint()),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.RectangleBorderIntersect(t.get_VisibilityBoundingBox(),n,this.insideHitTestScanDirection.get_OppositeDirection()),this.insideHitTestScanDirection.get_DirectionAsPoint()),f=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(o,e),i=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(f,t.get_VisibilityPolyline(),!0);return 2==i.get_Count()&&(r=Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.RawIntersection(i.get_Item$$Int32(0),n),u=Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.RawIntersection(i.get_Item$$Int32(1),n),!Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,r)&&!Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,u)&&n.CompareTo(r)!=n.CompareTo(u)&&(System.Diagnostics.Debug.Assert$$Boolean$$String(f==i.get_Item$$Int32(0).get_Segment0(),"incorrect parameter ordering to GetAllIntersections"),!Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(System.Math.Floor$$Double(i.get_Item$$Int32(0).get_Par1()),System.Math.Floor$$Double(i.get_Item$$Int32(1).get_Par1()))))?Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue},SegmentCrossesAnObstacle:function(n,t){this.stopAtGroups=!0;this.wantGroupCrossings=!1;var i=this.RestrictSegmentPrivate(n,t);return!Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(i.get_End(),t)},SegmentCrossesANonGroupObstacle:function(n,t){this.stopAtGroups=!1;this.wantGroupCrossings=!1;var i=this.RestrictSegmentPrivate(n,t);return!Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(i.get_End(),t)},RestrictSegmentWithObstacles:function(n,t){return this.stopAtGroups=!1,this.wantGroupCrossings=!0,this.RestrictSegmentPrivate(n,t)},RestrictSegmentPrivate:function(n,t){return this.GetRestrictedIntersectionTestSegment(n,t),this.currentRestrictedRay=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t),this.restrictedRayLengthSquared=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t).get_LengthSquared(),this.CurrentGroupBoundaryCrossingMap.Clear(),this.RecurseRestrictRayWithObstacles(this.get_Root()),this.currentRestrictedRay},GetRestrictedIntersectionTestSegment:function(n,t){var i=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n,t),r=Microsoft.Msagl.Core.Geometry.Directions.West==i?this.get_GraphBox().get_Right():Microsoft.Msagl.Core.Geometry.Directions.East==i?this.get_GraphBox().get_Left():n.get_X(),u=Microsoft.Msagl.Core.Geometry.Directions.West==i?this.get_GraphBox().get_Left():Microsoft.Msagl.Core.Geometry.Directions.East==i?this.get_GraphBox().get_Right():t.get_X(),f=Microsoft.Msagl.Core.Geometry.Directions.South==i?this.get_GraphBox().get_Top()*2:Microsoft.Msagl.Core.Geometry.Directions.North==i?this.get_GraphBox().get_Bottom():n.get_Y(),e=Microsoft.Msagl.Core.Geometry.Directions.South==i?this.get_GraphBox().get_Bottom():Microsoft.Msagl.Core.Geometry.Directions.North==i?this.get_GraphBox().get_Top():n.get_Y();this.restrictedIntersectionTestSegment=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r,f),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,e))},RecurseRestrictRayWithObstacles:function(n){var t,i;if(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.RectangleInteriorsIntersect(this.currentRestrictedRay.get_BoundingBox(),n.get_Rectangle())){if(t=n.get_UserData(),null!=t){if(i=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(this.restrictedIntersectionTestSegment,t.get_VisibilityPolyline(),!0),!t.get_IsGroup()||this.stopAtGroups){this.LookForCloserNonGroupIntersectionToRestrictRay(i);return}this.wantGroupCrossings&&this.AddGroupIntersectionsToRestrictedRay(t,i);System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_IsLeaf(),"RectNode with UserData is not a Leaf");return}this.RecurseRestrictRayWithObstacles(n.get_Left());this.RecurseRestrictRayWithObstacles(n.get_Right())}},LookForCloserNonGroupIntersectionToRestrictRay:function(n){for(var e=0,t=null,r=this.restrictedRayLengthSquared,c=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(this.restrictedIntersectionTestSegment.get_Start(),this.restrictedIntersectionTestSegment.get_End()),o=n.GetEnumerator(),f,h,i;o.MoveNext();){var u=o.get_Current(),i=Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.RawIntersection(u,this.currentRestrictedRay.get_Start()),s=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(this.currentRestrictedRay.get_Start(),i);if(s!=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(c)){if(++e,Microsoft.Msagl.Core.Geometry.Directions.None==s){r=0;t=u;continue}if(f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,this.currentRestrictedRay.get_Start()).get_LengthSquared(),f<r){if(h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.get_IntersectionPoint(),this.currentRestrictedRay.get_Start()).get_LengthSquared(),h<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_SquareOfDistanceEpsilon())continue;r=f;t=u}}}if(null!=t){if(e==1&&(i=Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.RawIntersection(t,this.currentRestrictedRay.get_Start()),Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(i,this.currentRestrictedRay.get_Start())||Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(i,this.currentRestrictedRay.get_End())))return;this.restrictedRayLengthSquared=r;this.currentRestrictedRay.set_End(Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.MungeClosestIntersectionInfo(this.currentRestrictedRay.get_Start(),t,!Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Point$$Point(this.currentRestrictedRay.get_Start(),this.currentRestrictedRay.get_End())))}},AddGroupIntersectionsToRestrictedRay:function(n,t){for(var u=t.GetEnumerator();u.MoveNext();){var i=u.get_Current(),f=Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.RawIntersection(i,this.currentRestrictedRay.get_Start()),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,this.currentRestrictedRay.get_Start()).get_LengthSquared();if(!(o>this.restrictedRayLengthSquared)){var e=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(this.currentRestrictedRay.get_Start(),this.currentRestrictedRay.get_End()),s=Cast(i.get_Segment1(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),h=Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point(s.Derivative(i.get_Par1())),r=e;Microsoft.Msagl.Core.Geometry.Directions.None!=(h&Microsoft.Msagl.Core.Geometry.CompassVector.RotateRight(e))&&(r=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(r));this.CurrentGroupBoundaryCrossingMap.AddIntersection(f,n,r)}}}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$ObstacleTree);Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSpannerForPortLocations={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSpannerForPortLocations",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},GetTotalSteps:function(n){return 6.28318530717959/n|0}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.obstacles=null;this.coneAngle=.523598775598299;this._PortLocations=null;this._VisibilityGraph=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.set_PortLocations(i);this.obstacles=Microsoft.Msagl.Routing.Visibility.VisibilityGraph.OrientHolesClockwise(n);this.set_VisibilityGraph(t)},PortLocations$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_PortLocations:function(){return this._PortLocations},set_PortLocations:function(n){this._PortLocations=n},VisibilityGraph$$:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",get_VisibilityGraph:function(){return this._VisibilityGraph},set_VisibilityGraph:function(n){this._VisibilityGraph=n},RunInternal:function(){for(var t,n=0;n<Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSpannerForPortLocations.GetTotalSteps(this.coneAngle);n++)t=this.coneAngle*n,this.AddDirection(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Cos(t),System.Math.Sin(t))),this.ProgressStep()},AddDirection:function(n){var r=new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor,t,i;for(Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeperForPortLocations.Sweep(this.obstacles,n,this.coneAngle,r,this.get_PortLocations()),t=r.get_Edges().GetEnumerator();t.MoveNext();)i=t.get_Current(),this.get_VisibilityGraph().AddEdge$$Point$$Point$$Func$3$VisibilityVertex$VisibilityVertex$VisibilityEdge(i.get_SourcePoint(),i.get_TargetPoint(),$CreateAnonymousDelegate(this,function(n,t){return new Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex(n,t)}))}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSpannerForPortLocations);Microsoft$Msagl$Layout$Layered$FlatEdgeRouter={fullname:"Microsoft.Msagl.Layout.Layered.FlatEdgeRouter",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.routing=null;this.settings=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.settings=n;this.routing=t},Layers$$:"System.Int32[][]",get_Layers:function(){return this.routing.LayerArrays.get_Layers()},RunInternal:function(){for(var n=0;n<this.get_Layers().length;n++)this.ProgressStep(),this.RouteFlatEdgesBetweenTwoLayers(this.get_Layers()[n],n<this.get_Layers().length-1?this.get_Layers()[n+1]:new Int32Array(0))},RouteFlatEdgesBetweenTwoLayers:function(n,t){var i=new Microsoft.Msagl.Layout.Layered.TwoLayerFlatEdgeRouter.ctor(this.settings,this.routing,n,t);i.Run()}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$FlatEdgeRouter);Microsoft$Msagl$Core$Geometry$HitTestBehavior={fullname:"Microsoft.Msagl.Core.Geometry.HitTestBehavior",staticDefinition:{Continue:0,Stop:1},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Geometry$HitTestBehavior);Microsoft$Msagl$Routing$InteractiveEdgeRouter={fullname:"Microsoft.Msagl.Routing.InteractiveEdgeRouter",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},PointInsideOfConvexCurve:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Item$$Double(0),n.get_Item$$Double(1.5)),2)},CreateRelaxedPolylinePoints:function(n){for(var t=n.get_StartPoint(),u=new Microsoft.Msagl.Routing.RelaxedPolylinePoint.ctor(t,t.get_Point()),i=u,r;t.get_Next()!=null;)t=t.get_Next(),r=function(){var n=new Microsoft.Msagl.Routing.RelaxedPolylinePoint.ctor(t,t.get_Point());return n.set_Prev(i),n}(),i.set_Next(r),i=r;return u},PullCloserRelaxedPoint:function(n){n.get_PolylinePoint().set_Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.2,n.get_OriginalPosition()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.8,n.get_PolylinePoint().get_Point())))},IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline:function(n,t){var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor);return Microsoft.Msagl.Routing.InteractiveEdgeRouter.IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline$$List$1$IntersectionInfo(n,t,i),i},IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline$$List$1$IntersectionInfo:function(n,t,i){if(t!=null&&n.get_BoundingBox().Intersects(t.get_Rectangle())){if(t.get_UserData()!=null){i.AddRange(Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,t.get_UserData(),!0));return}Microsoft.Msagl.Routing.InteractiveEdgeRouter.IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline$$List$1$IntersectionInfo(n,t.get_Left(),i);Microsoft.Msagl.Routing.InteractiveEdgeRouter.IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline$$List$1$IntersectionInfo(n,t.get_Right(),i)}},SetRelaxedPointLocation:function(n,t){var r=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Next().get_OriginalPosition(),t.get_OriginalPosition(),t.get_Prev().get_OriginalPosition())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise,i=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Next().get_OriginalPosition(),t.get_Prev().get_OriginalPosition()).Normalize(),n).Rotate(1.5707963267949);r||(i=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(i));t.get_PolylinePoint().set_Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_OriginalPosition(),i))},RemoveCollinearVertices:function(n){for(var t=n.get_StartPoint().get_Next();t.get_Next()!=null;t=t.get_Next())Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Prev().get_Point(),t.get_Point(),t.get_Next().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear&&(t.get_Prev().set_Next(t.get_Next()),t.get_Next().set_Prev(t.get_Prev()));return n},GetFirstHitPolyline:function(n,t){var i=Microsoft.Msagl.Routing.InteractiveEdgeRouter.GetFirstHitRectangleNode(n,t);return i!=null?i.get_UserData():null},GetFirstHitRectangleNode:function(n,t){return t==null?null:t.FirstHitNode$$Point$$Func$3(n,function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n,t)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside?Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue})},GetTrimmedCurveForHookingUpAnywhere:function(n,t,i,r){var h=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(r.get_IntersectionPoint(),i.get_IntersectionPoint(),t.get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise,u=i.get_Par0(),f=r.get_Par0(),e,o,s;return h?u<f?n.Trim(u,f):(e=n.Trim(u,n.get_ParEnd()),o=n.Trim(n.get_ParStart(),f),s=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,s.AddSegs$$ICurve$$ICurve(e,o)):f<u?n.Trim(f,u):(e=n.Trim(f,n.get_ParEnd()),o=n.Trim(n.get_ParStart(),u),s=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,s.AddSegs$$ICurve$$ICurve(e,o))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$IEnumerable$1$ICurve$$Double$$Double$$Double:function(n,t,i,r){this._sourceTightPolyline=null;this.targetTightPolyline=null;this.targetLoosePolyline=null;this.activeRectangle=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox();this.visibilityGraph=null;this.activePolygons=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.Polygon.ctor);this.alreadyAddedOrExcludedPolylines=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);this.sourcePort=null;this.targetPort=null;this.loosePadding=0;this._sourceVisibilityVertex=null;this.targetVisibilityVertex=null;this._polyline=null;this.targetIsInsideOfSourceTightPolyline=!1;this.sourceIsInsideOfTargetTightPolyline=!1;this.UseEdgeLengthMultiplier=!1;this.UseInnerPolylingShortcutting=!0;this.UsePolylineEndShortcutting=!0;this.AllowedShootingStraightLines=!0;this.cornerTable=null;this.cacheCorners=!1;this.foundCachedCorners=0;this._Obstacles=null;this._EnteringAngleBound=0;this._SourceLoosePolyline=null;this._TightPadding=0;this._OffsetForPolylineRelaxing=0;this._ExpectedProgressSteps=0;this._StartPointOfEdgeRouting=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._ConeSpannerAngle=0;this._UseSpanner=!1;this._LookForRoundedVertices=!1;this._ObstacleCalculator=null;this._IgnoreTightPadding=!1;Microsoft.Msagl.Routing.InteractiveEdgeRouter.ctor$$IEnumerable$1$ICurve$$Double$$Double$$Double$$Boolean.call(this,n,t,i,r,!1)},Obstacles$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Curves.ICurve]]",get_Obstacles:function(){return this._Obstacles},set_Obstacles:function(n){this._Obstacles=n},EnteringAngleBound$$:"System.Double",get_EnteringAngleBound:function(){return this._EnteringAngleBound},set_EnteringAngleBound:function(n){this._EnteringAngleBound=n},SourceTightPolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_SourceTightPolyline:function(){return this._sourceTightPolyline},set_SourceTightPolyline:function(n){this._sourceTightPolyline=n},SourceLoosePolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_SourceLoosePolyline:function(){return this._SourceLoosePolyline},set_SourceLoosePolyline:function(n){this._SourceLoosePolyline=n},TargetTightPolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_TargetTightPolyline:function(){return this.targetTightPolyline},set_TargetTightPolyline:function(n){this.targetTightPolyline=n},TargetLoosePolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_TargetLoosePolyline:function(){return this.targetLoosePolyline},set_TargetLoosePolyline:function(n){this.targetLoosePolyline=n},VisibilityGraph$$:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",get_VisibilityGraph:function(){return this.visibilityGraph},set_VisibilityGraph:function(n){this.visibilityGraph=n},SourcePort$$:"Microsoft.Msagl.Core.Layout.Port",get_SourcePort:function(){return this.sourcePort},set_SourcePort:function(n){if(this.sourcePort=n,this.sourcePort!=null)if(this.set_SourceTightPolyline(Microsoft.Msagl.Routing.InteractiveEdgeRouter.GetFirstHitPolyline(this.sourcePort.get_Location(),this.get_ObstacleCalculator().get_RootOfTightHierarchy())),Is(this.sourcePort,Microsoft.Msagl.Core.Layout.FloatingPort.ctor))this.alreadyAddedOrExcludedPolylines.Insert(this.get_SourceLoosePolyline()),this.set_StartPointOfEdgeRouting(this.get_SourcePort().get_Location());else{var t=Cast(this.sourcePort,Microsoft.Msagl.Core.Layout.CurvePort.ctor);this.set_StartPointOfEdgeRouting(this.TakeBoundaryPortOutsideOfItsLoosePolyline(t.get_Curve(),t.get_Parameter(),this.get_SourceLoosePolyline()))}},TargetPort$$:"Microsoft.Msagl.Core.Layout.Port",get_TargetPort:function(){return this.targetPort},set_TargetPort:function(n){this.targetPort=n},TightPadding$$:"System.Double",get_TightPadding:function(){return this._TightPadding},set_TightPadding:function(n){this._TightPadding=n},LoosePadding$$:"System.Double",get_LoosePadding:function(){return this.loosePadding},set_LoosePadding:function(n){this.loosePadding=n;this.get_ObstacleCalculator()!=null&&this.get_ObstacleCalculator().set_LoosePadding(n)},SourceVisibilityVertex$$:"Microsoft.Msagl.Routing.Visibility.VisibilityVertex",get_SourceVisibilityVertex:function(){return this._sourceVisibilityVertex},TargetVisibilityVertex$$:"Microsoft.Msagl.Routing.Visibility.VisibilityVertex",get_TargetVisibilityVertex:function(){return this.targetVisibilityVertex},OffsetForPolylineRelaxing$$:"System.Double",get_OffsetForPolylineRelaxing:function(){return this._OffsetForPolylineRelaxing},set_OffsetForPolylineRelaxing:function(n){this._OffsetForPolylineRelaxing=n},ExpectedProgressSteps$$:"System.Int32",get_ExpectedProgressSteps:function(){return this._ExpectedProgressSteps},set_ExpectedProgressSteps:function(n){this._ExpectedProgressSteps=n},ctor:function(){this._sourceTightPolyline=null;this.targetTightPolyline=null;this.targetLoosePolyline=null;this.activeRectangle=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox();this.visibilityGraph=null;this.activePolygons=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.Polygon.ctor);this.alreadyAddedOrExcludedPolylines=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);this.sourcePort=null;this.targetPort=null;this.loosePadding=0;this._sourceVisibilityVertex=null;this.targetVisibilityVertex=null;this._polyline=null;this.targetIsInsideOfSourceTightPolyline=!1;this.sourceIsInsideOfTargetTightPolyline=!1;this.UseEdgeLengthMultiplier=!1;this.UseInnerPolylingShortcutting=!0;this.UsePolylineEndShortcutting=!0;this.AllowedShootingStraightLines=!0;this.cornerTable=null;this.cacheCorners=!1;this.foundCachedCorners=0;this._Obstacles=null;this._EnteringAngleBound=0;this._SourceLoosePolyline=null;this._TightPadding=0;this._OffsetForPolylineRelaxing=0;this._ExpectedProgressSteps=0;this._StartPointOfEdgeRouting=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._ConeSpannerAngle=0;this._UseSpanner=!1;this._LookForRoundedVertices=!1;this._ObstacleCalculator=null;this._IgnoreTightPadding=!1;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.set_ObstacleCalculator(new Microsoft.Msagl.Routing.InteractiveObstacleCalculator.ctor(this.get_Obstacles(),this.get_TightPadding(),this.get_LoosePadding(),!1))},StartPointOfEdgeRouting$$:"Microsoft.Msagl.Core.Geometry.Point",get_StartPointOfEdgeRouting:function(){return this._StartPointOfEdgeRouting},set_StartPointOfEdgeRouting:function(n){this._StartPointOfEdgeRouting=n},ExtendVisibilityGraphToLocation:function(n){var t,i,r,u;if(this.get_VisibilityGraph()==null&&this.set_VisibilityGraph(new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor),t=null,!this.activeRectangle.Contains$$Point(n))for(this.activeRectangle.get_IsEmpty()?this.activeRectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(this.get_SourcePort().get_Location(),n):this.activeRectangle.Add$$Point(n),t=this.GetAddedPolygonesAndMaybeExtendActiveRectangle(),i=t.GetEnumerator();i.MoveNext();)r=i.get_Current(),this.get_VisibilityGraph().AddHole(r.get_Polyline());t==null||t.get_Count()==0?(this.targetVisibilityVertex!=null&&this.get_VisibilityGraph().RemoveVertex(this.targetVisibilityVertex),this.CalculateEdgeTargetVisibilityGraph(n)):(this.RemovePointVisibilityGraphs(),u=new Microsoft.Msagl.Routing.Visibility.InteractiveTangentVisibilityGraphCalculator.ctor(t,this.activePolygons,this.get_VisibilityGraph()),u.Run(),this.activePolygons.AddRange(t),this.CalculateEdgeTargetVisibilityGraph(n),this.CalculateSourcePortVisibilityGraph())},RemovePointVisibilityGraphs:function(){this.targetVisibilityVertex!=null&&this.get_VisibilityGraph().RemoveVertex(this.targetVisibilityVertex);this._sourceVisibilityVertex!=null&&this.get_VisibilityGraph().RemoveVertex(this._sourceVisibilityVertex)},CalculateEdgeTargetVisibilityGraph:function(n){(function(){var t={Value:this.targetVisibilityVertex},i=Microsoft.Msagl.Routing.Visibility.PointVisibilityCalculator.CalculatePointVisibilityGraph(this.GetActivePolylines(),this.get_VisibilityGraph(),n,Microsoft.Msagl.Routing.Visibility.VisibilityKind.Tangent,t);return this.targetVisibilityVertex=t.Value,i}).call(this)},CalculateSourcePortVisibilityGraph:function(){(function(){var n={Value:this._sourceVisibilityVertex},t=Microsoft.Msagl.Routing.Visibility.PointVisibilityCalculator.CalculatePointVisibilityGraph(this.GetActivePolylines(),this.get_VisibilityGraph(),this.get_StartPointOfEdgeRouting(),Microsoft.Msagl.Routing.Visibility.VisibilityKind.Tangent,n);return this._sourceVisibilityVertex=n.Value,t}).call(this);System.Diagnostics.Debug.Assert$$Boolean(this._sourceVisibilityVertex!=null)},TakeBoundaryPortOutsideOfItsLoosePolyline:function(n,t,i){var u=n.get_Item$$Double(t),r=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.LeftDerivative(t).Normalize(),n.RightDerivative(t).Normalize()).Normalize(),o,s,c;Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(Microsoft.Msagl.Routing.InteractiveEdgeRouter.PointInsideOfConvexCurve(n),u,Microsoft.Msagl.Core.Geometry.Point.op_Addition(u,r))==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&(r=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(r));r=r.Rotate(1.5707963267949);for(var l=i.get_BoundingBox().get_Diagonal(),f=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u,Microsoft.Msagl.Core.Geometry.Point.op_Addition(u,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(l,r))),h=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(f,i,!1).get_Item$$Int32(0).get_IntersectionPoint(),e=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h,u).get_Length()),.5);;){for(f=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u,Microsoft.Msagl.Core.Geometry.Point.op_Addition(h,e)),o=!1,s=Microsoft.Msagl.Routing.InteractiveEdgeRouter.IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline(f,this.get_ObstacleCalculator().get_RootOfLooseHierarchy()).GetEnumerator();s.MoveNext();)if(c=s.get_Current(),c.get_Segment1()!=i){e=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(e,1.5);o=!0;break}if(!o)break}return f.get_End()},GetActivePolylines:function(){for(var n=[],t=this.activePolygons.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.push(i.get_Polyline());return n},GetAddedPolygonesAndMaybeExtendActiveRectangle:function(){var r=this.activeRectangle,u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.Polygon.ctor),t,i,n;do{for(t=!1,i=this.get_ObstacleCalculator().get_RootOfLooseHierarchy().GetNodeItemsIntersectingRectangle(this.activeRectangle).GetEnumerator();i.MoveNext();)n=i.get_Current(),this.alreadyAddedOrExcludedPolylines.Contains$$T(n)||(r.Add$$Rectangle(n.get_BoundingBox()),u.Add(new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(n)),this.alreadyAddedOrExcludedPolylines.Insert(n),t=!0);t&&(this.activeRectangle=r)}while(t);return u},RelaxPolyline:function(){for(var n=Microsoft.Msagl.Routing.InteractiveEdgeRouter.CreateRelaxedPolylinePoints(this._polyline),n=n.get_Next();n.get_Next()!=null;n=n.get_Next())this.RelaxPolylinePoint(n)},RelaxPolylinePoint:function(n){if((n.get_PolylinePoint().get_Prev().get_Prev()!=null||!Is(this.get_SourcePort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor)||n.get_PolylinePoint().get_Polyline()==this.get_SourceLoosePolyline())&&(n.get_PolylinePoint().get_Next().get_Next()!=null||!Is(this.get_TargetPort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor)||n.get_PolylinePoint().get_Polyline()==this.get_TargetLoosePolyline()))for(var t=this.get_OffsetForPolylineRelaxing();t>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&!this.RelaxWithGivenOffset(t,n);t/=2);},RelaxWithGivenOffset:function(n,t){return(System.Diagnostics.Debug.Assert$$Boolean(n>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon),Microsoft.Msagl.Routing.InteractiveEdgeRouter.SetRelaxedPointLocation(n,t),this.StickingSegmentDoesNotIntersectTightObstacles(t))?!0:(Microsoft.Msagl.Routing.InteractiveEdgeRouter.PullCloserRelaxedPoint(t.get_Prev()),!1)},StickingSegmentDoesNotIntersectTightObstacles:function(n){return!this.PolylineSegmentIntersectsTightHierarchy(n.get_PolylinePoint().get_Point(),n.get_Prev().get_PolylinePoint().get_Point())&&(n.get_Next()==null||!this.PolylineSegmentIntersectsTightHierarchy(n.get_PolylinePoint().get_Point(),n.get_Next().get_PolylinePoint().get_Point()))},PolylineSegmentIntersectsTightHierarchy:function(n,t){return this.PolylineIntersectsPolyRectangleNodeOfTightHierarchy$$Point$$Point$$RectangleNode$1$Polyline(n,t,this.get_ObstacleCalculator().get_RootOfTightHierarchy())},PolylineIntersectsPolyRectangleNodeOfTightHierarchy$$Point$$Point$$RectangleNode$1$Polyline:function(n,t,i){return this.PolylineIntersectsPolyRectangleNodeOfTightHierarchy$$LineSegment$$RectangleNode$1$Polyline(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t),i)},PolylineIntersectsPolyRectangleNodeOfTightHierarchy$$LineSegment$$RectangleNode$1$Polyline:function(n,t){var r,i;if(!n.get_BoundingBox().Intersects(t.get_Rectangle()))return!1;if(t.get_UserData()!=null){for(r=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,t.get_UserData(),!1).GetEnumerator();r.MoveNext();)if((i=r.get_Current(),i.get_Segment1()!=this.get_SourceTightPolyline()&&i.get_Segment1()!=this.get_TargetTightPolyline())||i.get_Segment1()==this.get_SourceTightPolyline()&&Is(this.get_SourcePort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor)||i.get_Segment1()==this.get_TargetTightPolyline()&&Is(this.get_TargetPort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor))return!0;return!1}return this.PolylineIntersectsPolyRectangleNodeOfTightHierarchy$$LineSegment$$RectangleNode$1$Polyline(n,t.get_Left())||this.PolylineIntersectsPolyRectangleNodeOfTightHierarchy$$LineSegment$$RectangleNode$1$Polyline(n,t.get_Right())},LineCanBeAcceptedForRouting:function(n){var u=Is(this.get_SourcePort(),Microsoft.Msagl.Core.Layout.FloatingPort.ctor),f=Is(this.get_TargetPort(),Microsoft.Msagl.Core.Layout.FloatingPort.ctor),r,t,i;if(!u&&!this.targetIsInsideOfSourceTightPolyline&&!this.InsideOfTheAllowedConeOfBoundaryPort(n.get_End(),As(this.get_SourcePort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor))||!f&&this.get_TargetPort()!=null&&!this.sourceIsInsideOfTargetTightPolyline&&!this.InsideOfTheAllowedConeOfBoundaryPort(n.get_Start(),As(this.get_TargetPort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor)))return!1;for(r=Microsoft.Msagl.Routing.InteractiveEdgeRouter.IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline(n,this.get_ObstacleCalculator().get_RootOfTightHierarchy()),t=r.GetEnumerator();t.MoveNext();)if((i=t.get_Current(),i.get_Segment1()!=this.get_SourceTightPolyline())&&i.get_Segment1()!=this.targetTightPolyline)return!1;return!0},InsideOfTheAllowedConeOfBoundaryPort:function(n,t){var i=t.get_Curve(),u=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CurveIsClockwise(i,Microsoft.Msagl.Routing.InteractiveEdgeRouter.PointInsideOfConvexCurve(i)),r=t.get_Location(),f=this.GetPointOnTheRightBoundaryPortConeSide(r,i,u,t.get_Parameter()),e=this.GetPointOnTheLeftBoundaryPortConeSide(r,i,u,t.get_Parameter());return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(r,f,n)!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(r,n,e)!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise},GetPointOnTheRightBoundaryPortConeSide:function(n,t,i,r){var u=i?t.RightDerivative(r):Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(t.LeftDerivative(r));return Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,u.Rotate(this.get_EnteringAngleBound()))},GetPointOnTheLeftBoundaryPortConeSide:function(n,t,i,r){var u=i?Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(t.LeftDerivative(r)):t.RightDerivative(r);return Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,u.Rotate(-this.get_EnteringAngleBound()))},SmoothCorners:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edgePolyline");for(var t=n.get_HeadSite(),i,r;function(){var n={Value:i},u={Value:r},f=Microsoft.Msagl.Core.Geometry.Curves.Curve.FindCorner(t,n,u);return i=n.Value,r=u.Value,f}.call(this);)t=this.SmoothOneCorner(t,r,i)},SmoothOneCorner:function(n,t,i){var o,s;if(this.get_CacheCorners()&&function(){var r={Value:o},u={Value:s},f=this.FindCachedCorner(n,i,t,r,u);return o=r.Value,s=u.Value,f}.call(this))return i.set_PreviousBezierSegmentFitCoefficient(o),i.set_NextBezierSegmentFitCoefficient(s),i;var h=1.5,c=.01,r=.5,e,u,f;n.get_Previous()==null?(u=2,f=1):t.get_Next()==null?(u=1,f=2):u=f=1;do e=Microsoft.Msagl.Core.Geometry.Curves.Curve.CreateBezierSeg$$Double$$Double$$Site$$Site$$Site(r*u,r*f,n,i,t),i.set_PreviousBezierSegmentFitCoefficient(r*u),i.set_NextBezierSegmentFitCoefficient(r*f),r/=h;while(this.get_ObstacleCalculator().ObstaclesIntersectICurve(e)&&r>c);return r*=h,r<.5&&r>c&&(r=.5*(r+r*h),e=Microsoft.Msagl.Core.Geometry.Curves.Curve.CreateBezierSeg$$Double$$Double$$Site$$Site$$Site(r*u,r*f,n,i,t),this.get_ObstacleCalculator().ObstaclesIntersectICurve(e)||(i.set_PreviousBezierSegmentFitCoefficient(r*u),i.set_NextBezierSegmentFitCoefficient(r*f))),this.get_CacheCorners()&&this.CacheCorner(n,i,t),i},FindCachedCorner:function(n,t,i,r,u){var e=new Microsoft.Msagl.Routing.Corner.ctor(n.get_Point(),t.get_Point(),i.get_Point()),f;return function(){var n={Value:f},t=this.cornerTable.TryGetValue(e,n);return f=n.Value,t}.call(this)?(Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Point(),e.a)?(r.Value=f.get_Item1(),u.Value=f.get_Item2()):(r.Value=f.get_Item2(),u.Value=f.get_Item1()),this.foundCachedCorners++,!0):(r.Value=u.Value=0,!1)},CacheCorner:function(n,t,i){this.cornerTable.set_Item$$TKey(new Microsoft.Msagl.Routing.Corner.ctor(n.get_Point(),t.get_Point(),i.get_Point()),new System.Tuple$2.ctor(System.Double.ctor,System.Double.ctor,t.get_PreviousBezierSegmentFitCoefficient(),t.get_NextBezierSegmentFitCoefficient()))},CacheCorners$$:"System.Boolean",get_CacheCorners:function(){return this.cacheCorners},set_CacheCorners:function(n){this.cacheCorners=n;this.cacheCorners?this.cornerTable=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Corner.ctor,System.Tuple$2.ctor):this.cornerTable!=null&&this.cornerTable.Clear()},TryToRemoveInflectionsAndCollinearSegments:function(n){var i,t;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"underlyingPolyline"),i=!0;i;)for(i=!1,t=n.get_HeadSite();t!=null&&t.get_Next()!=null;t=t.get_Next())t.get_Turn()*t.get_Next().get_Turn()<0&&(i=function(){var n={Value:t},i=this.TryToRemoveInflectionEdge(n);return t=n.Value,i}.call(this)||i)},TryToRemoveInflectionEdge:function(n){var i,t;return this.get_ObstacleCalculator().ObstaclesIntersectLine(n.Value.get_Previous().get_Point(),n.Value.get_Next().get_Point())?this.get_ObstacleCalculator().ObstaclesIntersectLine(n.Value.get_Previous().get_Point(),n.Value.get_Next().get_Next().get_Point())?this.get_ObstacleCalculator().ObstaclesIntersectLine(n.Value.get_Point(),n.Value.get_Next().get_Next().get_Point())?!1:(t=n.Value.get_Next().get_Next(),n.Value.set_Next(t),t.set_Previous(n.Value),!0):(i=n.Value.get_Previous(),t=n.Value.get_Next().get_Next(),i.set_Next(t),t.set_Previous(i),n.Value=i,!0):(i=n.Value.get_Previous(),t=n.Value.get_Next(),i.set_Next(t),t.set_Previous(i),n.Value=i,!0)},GetShortestPolyline:function(n,t){var f,i,r,u,e;if(this.CleanTheGraphForShortestPath(),f=new Microsoft.Msagl.Routing.SingleSourceSingleTargetShortestPathOnVisibilityGraph.ctor$$VisibilityGraph$$VisibilityVertex$$VisibilityVertex(this.visibilityGraph,n,t),i=f.GetPath(this.UseEdgeLengthMultiplier),i==null)return null;for(System.Diagnostics.Debug.Assert$$Boolean(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,i)==n&&System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,i)==t),r=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,u=i.GetEnumerator();u.MoveNext();)e=u.get_Current(),r.AddPoint$$Point(e.Point);return Microsoft.Msagl.Routing.InteractiveEdgeRouter.RemoveCollinearVertices(r)},CleanTheGraphForShortestPath:function(){this.visibilityGraph.ClearPrevEdgesTable()},OverlapsDetected$$:"System.Boolean",get_OverlapsDetected:function(){return this.get_ObstacleCalculator().get_OverlapsDetected()},ConeSpannerAngle$$:"System.Double",get_ConeSpannerAngle:function(){return this._ConeSpannerAngle},set_ConeSpannerAngle:function(n){this._ConeSpannerAngle=n},TightHierarchy$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_TightHierarchy:function(){return this.get_ObstacleCalculator().get_RootOfTightHierarchy()},set_TightHierarchy:function(n){this.get_ObstacleCalculator().set_RootOfTightHierarchy(n)},LooseHierarchy$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_LooseHierarchy:function(){return this.get_ObstacleCalculator().get_RootOfLooseHierarchy()},set_LooseHierarchy:function(n){this.get_ObstacleCalculator().set_RootOfLooseHierarchy(n)},UseSpanner$$:"System.Boolean",get_UseSpanner:function(){return this._UseSpanner},set_UseSpanner:function(n){this._UseSpanner=n},CalculateObstacles:function(){this.set_ObstacleCalculator(new Microsoft.Msagl.Routing.InteractiveObstacleCalculator.ctor(this.get_Obstacles(),this.get_TightPadding(),this.get_LoosePadding(),this.get_IgnoreTightPadding()));this.get_ObstacleCalculator().Calculate()},RouteEdgeToLocation:function(n){this.set_TargetPort(new Microsoft.Msagl.Core.Layout.FloatingPort.ctor(null,n));this.set_TargetTightPolyline(null);this.set_TargetLoosePolyline(null);var t=new Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_SourcePort().get_Location(),n);return this.LineCanBeAcceptedForRouting(i)?(this._polyline=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this._polyline.AddPoint$$Point(i.get_Start()),this._polyline.AddPoint$$Point(i.get_End()),t.set_SmoothedPolyline(Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints(this._polyline)),t.set_Curve(t.get_SmoothedPolyline().CreateCurve()),t):Is(this.get_SourcePort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor)&&(i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_StartPointOfEdgeRouting(),n),Microsoft.Msagl.Routing.InteractiveEdgeRouter.IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline(i,this.get_ObstacleCalculator().get_RootOfTightHierarchy()).get_Count()==0)?(this._polyline=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this._polyline.AddPoint$$Point(this.get_SourcePort().get_Location()),this._polyline.AddPoint$$Point(i.get_Start()),this._polyline.AddPoint$$Point(i.get_End()),t.set_SmoothedPolyline(Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints(this._polyline)),t.set_Curve(t.get_SmoothedPolyline().CreateCurve()),t):(this.ExtendVisibilityGraphToLocation(n),this._polyline=this.GetShortestPolyline(this.get_SourceVisibilityVertex(),this.get_TargetVisibilityVertex()),this.RelaxPolyline(),Is(this.get_SourcePort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor)&&this._polyline.PrependPoint(this.get_SourcePort().get_Location()),t.set_SmoothedPolyline(Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints(this._polyline)),t.set_Curve(t.get_SmoothedPolyline().CreateCurve()),t)},RouteEdgeToPort:function(n,t,i,r){if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edgeTargetToPort"),!this.get_ObstacleCalculator().IsEmpty()){this.set_TargetPort(n);this.set_TargetTightPolyline(Microsoft.Msagl.Routing.InteractiveEdgeRouter.GetFirstHitPolyline(n.get_Location(),this.get_ObstacleCalculator().get_RootOfTightHierarchy()));System.Diagnostics.Debug.Assert$$Boolean(this.targetTightPolyline!=null);var u=As(n,Microsoft.Msagl.Core.Layout.CurvePort.ctor);return u!=null?this.RouteEdgeToBoundaryPort(t,i,r):this.RouteEdgeToFloatingPortOfNode(t,i,r)}return this.sourcePort!=null&&this.targetPort!=null?(r.Value=this.SmoothedPolylineFromTwoPoints(this.sourcePort.get_Location(),this.targetPort.get_Location()),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.sourcePort.get_Location(),this.targetPort.get_Location())):(r.Value=null,null)},SmoothedPolylineFromTwoPoints:function(n,t){return this._polyline=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this._polyline.AddPoint$$Point(n),this._polyline.AddPoint$$Point(t),Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints(this._polyline)},RouteEdgeToFloatingPortOfNode:function(n,t,i){return Is(this.sourcePort,Microsoft.Msagl.Core.Layout.FloatingPort.ctor)?this.RouteFromFloatingPortToFloatingPort(n,t,i):this.RouteFromBoundaryPortToFloatingPort(n,t,i)},RouteFromBoundaryPortToFloatingPort:function(n,t,i){var u=this.get_SourcePort().get_Location(),f=this.targetPort.get_Location(),r=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u,f),e,o;return this.LineCanBeAcceptedForRouting(r)?(i.Value=this.SmoothedPolylineFromTwoPoints(r.get_Start(),r.get_End()),r):!this.targetIsInsideOfSourceTightPolyline&&(e=this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.get_SourcePort().get_Curve(),Cast(this.get_SourcePort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor).get_Parameter(),this.get_SourceLoosePolyline()),r=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(e,f),this.LineAvoidsTightHierarchy$$LineSegment$$Polyline(r,n))?(i.Value=this.SmoothedPolylineFromTwoPoints(r.get_Start(),r.get_End()),r):(this.ExtendVisibilityGraphToLocationOfTargetFloatingPort(n),this._polyline=this.GetShortestPolyline(this.get_SourceVisibilityVertex(),this.get_TargetVisibilityVertex()),o=this.get_SourceTightPolyline(),this.targetIsInsideOfSourceTightPolyline||this.set_SourceTightPolyline(null),this.TryShortcutPolyline(),this.set_SourceTightPolyline(o),this.RelaxPolyline(),this._polyline.PrependPoint(u),this.SmoothCornersAndReturnCurve(t,i))},SmoothCornersAndReturnCurve:function(n,t){return t.Value=Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints(this._polyline),n&&this.SmoothCorners(t.Value),t.Value.CreateCurve()},RouteFromFloatingPortToFloatingPort:function(n,t,i){var u=this.get_TargetPort().get_Location(),r=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_StartPointOfEdgeRouting(),u);return this.AllowedShootingStraightLines&&this.LineAvoidsTightHierarchy$$LineSegment$$Polyline$$Polyline(r,this.get_SourceTightPolyline(),this.targetTightPolyline)?(i.Value=this.SmoothedPolylineFromTwoPoints(r.get_Start(),r.get_End()),r):(this.ExtendVisibilityGraphToLocationOfTargetFloatingPort(n),this._polyline=this.GetShortestPolyline(this.get_SourceVisibilityVertex(),this.get_TargetVisibilityVertex()),this._polyline==null)?(i.Value=null,null):(this.get_UseSpanner()&&this.TryShortcutPolyline(),this.RelaxPolyline(),i.Value=Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints(this._polyline),this.SmoothCornersAndReturnCurve(t,i))},TryShortcutPolyline:function(){if(this.UseInnerPolylingShortcutting)while(this.ShortcutPolylineOneTime());this.UsePolylineEndShortcutting&&this.TryShortCutThePolylineEnds()},TryShortCutThePolylineEnds:function(){this.TryShortcutPolylineStart();this.TryShortcutPolylineEnd()},TryShortcutPolylineEnd:function(){var t=this._polyline.get_EndPoint(),i=t.get_Prev(),n,r,u;i!=null&&(n=i.get_Prev(),n!=null)&&(r=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Point(),n.get_Point())),this.LineAvoidsTightHierarchy$$Point$$Point$$Polyline$$Polyline(t.get_Point(),r,this._sourceTightPolyline,this.targetTightPolyline)&&(u=function(){var i=new Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor(r);return i.set_Next(t),i.set_Prev(n),i}.call(this),t.set_Prev(u),n.set_Next(u)))},TryShortcutPolylineStart:function(){var t=this._polyline.get_StartPoint(),i=t.get_Next(),n,r,u;i!=null&&(n=i.get_Next(),n!=null)&&(r=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Point(),n.get_Point())),this.LineAvoidsTightHierarchy$$Point$$Point$$Polyline$$Polyline(t.get_Point(),r,this._sourceTightPolyline,this.targetTightPolyline)&&(u=function(){var i=new Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor(r);return i.set_Prev(t),i.set_Next(n),i}.call(this),t.set_Next(u),n.set_Prev(u)))},ShortcutPolylineOneTime:function(){for(var t=!1,n=this._polyline.get_StartPoint();n.get_Next()!=null&&n.get_Next().get_Next()!=null;n=n.get_Next())t|=this.TryShortcutPolyPoint(n);return t},TryShortcutPolyPoint:function(n){return this.LineAvoidsTightHierarchy$$LineSegment$$Polyline$$Polyline(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_Point(),n.get_Next().get_Next().get_Point()),this.get_SourceTightPolyline(),this.targetTightPolyline)?(n.set_Next(n.get_Next().get_Next()),n.get_Next().set_Prev(n),!0):!1},ExtendVisibilityGraphToLocationOfTargetFloatingPort:function(n){var t,i,r,u,f;if(this.get_VisibilityGraph()==null&&this.set_VisibilityGraph(new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor),t=null,i=this.targetPort.get_Location(),!this.activeRectangle.Contains$$Point(i))for(this.activeRectangle.get_IsEmpty()?this.activeRectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(this.get_SourcePort().get_Location(),i):this.activeRectangle.Add$$Point(i),t=this.GetAddedPolygonesAndMaybeExtendActiveRectangle(),r=t.GetEnumerator();r.MoveNext();)u=r.get_Current(),this.get_VisibilityGraph().AddHole(u.get_Polyline());t==null?(this.targetVisibilityVertex!=null&&this.get_VisibilityGraph().RemoveVertex(this.targetVisibilityVertex),this.CalculateEdgeTargetVisibilityGraphForFloatingPort(i,n),this.get_SourceVisibilityVertex()==null&&this.CalculateSourcePortVisibilityGraph()):(this.RemovePointVisibilityGraphs(),f=new Microsoft.Msagl.Routing.Visibility.InteractiveTangentVisibilityGraphCalculator.ctor(t,this.activePolygons,this.get_VisibilityGraph()),f.Run(),this.activePolygons.AddRange(t),this.CalculateEdgeTargetVisibilityGraphForFloatingPort(i,n),this.CalculateSourcePortVisibilityGraph())},CalculateEdgeTargetVisibilityGraphForFloatingPort:function(n,t){this.get_UseSpanner()?this.targetVisibilityVertex=this.AddTransientVisibilityEdgesForPort(n,t):function(){var i={Value:this.targetVisibilityVertex},r=Microsoft.Msagl.Routing.Visibility.PointVisibilityCalculator.CalculatePointVisibilityGraph(this.GetActivePolylinesWithException(t),this.get_VisibilityGraph(),n,Microsoft.Msagl.Routing.Visibility.VisibilityKind.Tangent,i);return this.targetVisibilityVertex=i.Value,r}.call(this)},AddTransientVisibilityEdgesForPort:function(n,t){var i=this.GetVertex(n),r,u;if(i!=null)return i;if(i=this.visibilityGraph.AddVertex$$Point(n),t!=null)for(r=t.GetEnumerator();r.MoveNext();)u=r.get_Current(),this.visibilityGraph.AddEdge$$Point$$Point$$Func$3$VisibilityVertex$VisibilityVertex$VisibilityEdge(n,u,$CreateAnonymousDelegate(this,function(n,t){return new Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex(n,t)}));else(function(){var t={Value:i},r=Microsoft.Msagl.Routing.Visibility.PointVisibilityCalculator.CalculatePointVisibilityGraph(this.GetActivePolylines(),this.get_VisibilityGraph(),n,Microsoft.Msagl.Routing.Visibility.VisibilityKind.Tangent,t);return i=t.Value,r}).call(this),System.Diagnostics.Debug.Assert$$Boolean(i!=null);return i},GetVertex:function(n){var t=this.visibilityGraph.FindVertex(n);return t==null&&this.get_LookForRoundedVertices()&&(t=this.visibilityGraph.FindVertex(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n))),t},LookForRoundedVertices$$:"System.Boolean",get_LookForRoundedVertices:function(){return this._LookForRoundedVertices},set_LookForRoundedVertices:function(n){this._LookForRoundedVertices=n},ObstacleCalculator$$:"Microsoft.Msagl.Routing.InteractiveObstacleCalculator",get_ObstacleCalculator:function(){return this._ObstacleCalculator},set_ObstacleCalculator:function(n){this._ObstacleCalculator=n},ctor$$IEnumerable$1$ICurve$$Double$$Double$$Double$$Boolean:function(n,t,i,r,u){this._sourceTightPolyline=null;this.targetTightPolyline=null;this.targetLoosePolyline=null;this.activeRectangle=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox();this.visibilityGraph=null;this.activePolygons=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.Polygon.ctor);this.alreadyAddedOrExcludedPolylines=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);this.sourcePort=null;this.targetPort=null;this.loosePadding=0;this._sourceVisibilityVertex=null;this.targetVisibilityVertex=null;this._polyline=null;this.targetIsInsideOfSourceTightPolyline=!1;this.sourceIsInsideOfTargetTightPolyline=!1;this.UseEdgeLengthMultiplier=!1;this.UseInnerPolylingShortcutting=!0;this.UsePolylineEndShortcutting=!0;this.AllowedShootingStraightLines=!0;this.cornerTable=null;this.cacheCorners=!1;this.foundCachedCorners=0;this._Obstacles=null;this._EnteringAngleBound=0;this._SourceLoosePolyline=null;this._TightPadding=0;this._OffsetForPolylineRelaxing=0;this._ExpectedProgressSteps=0;this._StartPointOfEdgeRouting=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._ConeSpannerAngle=0;this._UseSpanner=!1;this._LookForRoundedVertices=!1;this._ObstacleCalculator=null;this._IgnoreTightPadding=!1;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.set_IgnoreTightPadding(u);this.set_EnteringAngleBound(1.39626340159546);this.set_TightPadding(t);this.set_LoosePadding(i);this.set_OffsetForPolylineRelaxing(.75*t);r>0?(System.Diagnostics.Debug.Assert$$Boolean(r>.0174532925199433),System.Diagnostics.Debug.Assert$$Boolean(r<=1.5707963267949),this.set_UseSpanner(!0),this.set_ExpectedProgressSteps(Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSpanner.GetTotalSteps(r))):this.set_ExpectedProgressSteps(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,n));this.set_ConeSpannerAngle(r);this.set_Obstacles(n);this.CalculateObstacles()},IgnoreTightPadding$$:"System.Boolean",get_IgnoreTightPadding:function(){return this._IgnoreTightPadding},set_IgnoreTightPadding:function(n){this._IgnoreTightPadding=n},GetActivePolylinesWithException:function(n){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.Polygon.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.Polygon.ctor,this.activePolygons,$CreateAnonymousDelegate(this,function(t){return t.get_Polyline()!=n})),$CreateAnonymousDelegate(this,function(n){return n.get_Polyline()}))},RouteEdgeToBoundaryPort:function(n,t,i){return(this.set_TargetLoosePolyline(n),Is(this.sourcePort,Microsoft.Msagl.Core.Layout.FloatingPort.ctor))?this.RouteFromFloatingPortToBoundaryPort(t,i):this.RouteFromBoundaryPortToBoundaryPort(t,i)},RouteFromBoundaryPortToBoundaryPort:function(n,t){var u=this.get_SourcePort().get_Location(),f,e=this.targetPort.get_Location(),i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u,e),r,o,s,h;return this.LineCanBeAcceptedForRouting(i)?(this._polyline=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this._polyline.AddPoint$$Point(i.get_Start()),this._polyline.AddPoint$$Point(i.get_End()),t.Value=this.SmoothedPolylineFromTwoPoints(i.get_Start(),i.get_End()),f=Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints(this._polyline).CreateCurve()):(r=this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.targetPort.get_Curve(),Cast(this.targetPort,Microsoft.Msagl.Core.Layout.CurvePort.ctor).get_Parameter(),this.get_TargetLoosePolyline()),i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u,r),this.InsideOfTheAllowedConeOfBoundaryPort(r,As(this.get_SourcePort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor))&&this.LineAvoidsTightHierarchy$$LineSegment$$Polyline(i,this._sourceTightPolyline)?(this._polyline=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this._polyline.AddPoint$$Point(i.get_Start()),this._polyline.AddPoint$$Point(i.get_End()),this._polyline.AddPoint$$Point(e),f=this.SmoothCornersAndReturnCurve(n,t)):(i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_StartPointOfEdgeRouting(),e),this.InsideOfTheAllowedConeOfBoundaryPort(this.get_StartPointOfEdgeRouting(),As(this.get_TargetPort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor))&&this.LineAvoidsTightHierarchy$$LineSegment(i)?(this._polyline=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this._polyline.AddPoint$$Point(u),this._polyline.AddPoint$$Point(i.get_Start()),this._polyline.AddPoint$$Point(i.get_End()),f=this.SmoothCornersAndReturnCurve(n,t)):function(){var n={Value:o},t=Microsoft.Msagl.Core.Geometry.Curves.LineSegment.Intersect(u,this.get_StartPointOfEdgeRouting(),e,r,n);return o=n.Value,t}.call(this)?(this._polyline=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this._polyline.AddPoint$$Point(u),this._polyline.AddPoint$$Point(o),this._polyline.AddPoint$$Point(e),f=this.SmoothCornersAndReturnCurve(n,t)):Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(this.get_StartPointOfEdgeRouting(),r)?(this._polyline=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this._polyline.AddPoint$$Point(u),this._polyline.AddPoint$$Point(r),this._polyline.AddPoint$$Point(e),f=this.SmoothCornersAndReturnCurve(n,t)):this.LineAvoidsTightHierarchy$$LineSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_StartPointOfEdgeRouting(),r))?(this._polyline=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this._polyline.AddPoint$$Point(u),this._polyline.AddPoint$$Point(this.get_StartPointOfEdgeRouting()),this._polyline.AddPoint$$Point(r),this._polyline.AddPoint$$Point(e),f=this.SmoothCornersAndReturnCurve(n,t)):(this.ExtendVisibilityGraphToTargetBoundaryPort(r),this._polyline=this.GetShortestPolyline(this.get_SourceVisibilityVertex(),this.get_TargetVisibilityVertex()),h=function(){var n={Value:s},t=this.HideSourceTargetTightsIfNeeded(n);return s=n.Value,t}.call(this),this.TryShortcutPolyline(),this.RecoverSourceTargetTights(h,s),this.RelaxPolyline(),this._polyline.PrependPoint(u),this._polyline.AddPoint$$Point(e),f=this.SmoothCornersAndReturnCurve(n,t)))),f},RecoverSourceTargetTights:function(n,t){this.set_SourceTightPolyline(n);this.set_TargetTightPolyline(t)},HideSourceTargetTightsIfNeeded:function(n){var t=this.get_SourceTightPolyline();return n.Value=this.get_TargetTightPolyline(),this.set_SourceTightPolyline(function(n){return this.set_TargetTightPolyline(n),n}.call(this,null)),t},LineAvoidsTightHierarchy$$LineSegment:function(n){return Microsoft.Msagl.Routing.InteractiveEdgeRouter.IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline(n,this.get_ObstacleCalculator().get_RootOfTightHierarchy()).get_Count()==0},RouteFromFloatingPortToBoundaryPort:function(n,t){var r=this.targetPort.get_Location(),i,u;return this.InsideOfTheAllowedConeOfBoundaryPort(this.sourcePort.get_Location(),Cast(this.targetPort,Microsoft.Msagl.Core.Layout.CurvePort.ctor))&&(i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_SourcePort().get_Location(),r),this.LineCanBeAcceptedForRouting(i))?(t.Value=this.SmoothedPolylineFromTwoPoints(i.get_Start(),i.get_End()),i):(u=this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.get_TargetPort().get_Curve(),Cast(this.get_TargetPort(),Microsoft.Msagl.Core.Layout.CurvePort.ctor).get_Parameter(),this.get_TargetLoosePolyline()),i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_SourcePort().get_Location(),u),this.LineAvoidsTightHierarchy$$LineSegment$$Polyline(i,this._sourceTightPolyline))?(this._polyline=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$Point$Array([i.get_Start(),i.get_End(),r]),t.Value=Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints(this._polyline),t.Value.CreateCurve()):(this.ExtendVisibilityGraphToTargetBoundaryPort(u),this._polyline=this.GetShortestPolyline(this.get_SourceVisibilityVertex(),this.get_TargetVisibilityVertex()),this.RelaxPolyline(),this._polyline.AddPoint$$Point(r),this.SmoothCornersAndReturnCurve(n,t))},LineAvoidsTightHierarchy$$LineSegment$$Polyline:function(n,t){for(var i=!0,r=Microsoft.Msagl.Routing.InteractiveEdgeRouter.IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline(n,this.get_ObstacleCalculator().get_RootOfTightHierarchy()).GetEnumerator(),u;r.MoveNext();)if(u=r.get_Current(),u.get_Segment1()!=t){i=!1;break}return i},LineAvoidsTightHierarchy$$LineSegment$$Polyline$$Polyline:function(n,t,i){for(var u=!0,f=Microsoft.Msagl.Routing.InteractiveEdgeRouter.IntersectionsOfLineAndRectangleNodeOverPolyline$$LineSegment$$RectangleNode$1$Polyline(n,this.get_ObstacleCalculator().get_RootOfTightHierarchy()).GetEnumerator(),r;f.MoveNext();)if(r=f.get_Current(),!(r.get_Segment1()==t||r.get_Segment1()==i)){u=!1;break}return u},LineAvoidsTightHierarchy$$Point$$Point$$Polyline$$Polyline:function(n,t,i,r){return this.LineAvoidsTightHierarchy$$LineSegment$$Polyline$$Polyline(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t),i,r)},ExtendVisibilityGraphToTargetBoundaryPort:function(n){var t=null,i,r,u;if(this.get_VisibilityGraph()==null&&this.set_VisibilityGraph(new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor),!this.activeRectangle.Contains$$Point(n)||!this.activeRectangle.Contains$$Rectangle(this.get_TargetLoosePolyline().get_BoundingBox()))for(this.activeRectangle.get_IsEmpty()?(this.activeRectangle=this.get_TargetLoosePolyline().get_BoundingBox().Clone(),this.activeRectangle.Add$$Point(this.get_SourcePort().get_Location()),this.activeRectangle.Add$$Point(this.get_StartPointOfEdgeRouting()),this.activeRectangle.Add$$Point(n)):(this.activeRectangle.Add$$Point(n),this.activeRectangle.Add$$Rectangle(this.get_TargetLoosePolyline().get_BoundingBox())),t=this.GetAddedPolygonesAndMaybeExtendActiveRectangle(),i=t.GetEnumerator();i.MoveNext();)r=i.get_Current(),this.get_VisibilityGraph().AddHole(r.get_Polyline());t==null?(this.targetVisibilityVertex!=null&&this.get_VisibilityGraph().RemoveVertex(this.targetVisibilityVertex),this.CalculateEdgeTargetVisibilityGraph(n)):(this.RemovePointVisibilityGraphs(),u=new Microsoft.Msagl.Routing.Visibility.InteractiveTangentVisibilityGraphCalculator.ctor(t,this.activePolygons,this.get_VisibilityGraph()),u.Run(),this.activePolygons.AddRange(t),this.CalculateEdgeTargetVisibilityGraph(n),this.CalculateSourcePortVisibilityGraph())},GetHitLoosePolyline:function(n){return this.get_ObstacleCalculator().IsEmpty()||this.get_ObstacleCalculator().get_RootOfLooseHierarchy()==null?null:Microsoft.Msagl.Routing.InteractiveEdgeRouter.GetFirstHitPolyline(n,this.get_ObstacleCalculator().get_RootOfLooseHierarchy())},Clean:function(){this.set_SourcePort(function(n){return this.set_TargetPort(n),n}.call(this,null));this.set_SourceLoosePolyline(function(n){return this.set_SourceTightPolyline(n),n}.call(this,null));this.targetTightPolyline=function(n){return this.set_TargetLoosePolyline(n),n}.call(this,null);this.set_VisibilityGraph(null);this._sourceVisibilityVertex=this.targetVisibilityVertex=null;this.activePolygons.Clear();this.alreadyAddedOrExcludedPolylines.Clear();this.activeRectangle.SetToEmpty()},SetSourcePortAndSourceLoosePolyline:function(n,t){this.set_SourceLoosePolyline(t);this.sourcePort=n;this.sourcePort!=null&&(this.set_SourceTightPolyline(Microsoft.Msagl.Routing.InteractiveEdgeRouter.GetFirstHitPolyline(this.sourcePort.get_Location(),this.get_ObstacleCalculator().get_RootOfTightHierarchy())),Is(this.sourcePort,Microsoft.Msagl.Core.Layout.FloatingPort.ctor)?(this.alreadyAddedOrExcludedPolylines.Insert(this.get_SourceLoosePolyline()),this.set_StartPointOfEdgeRouting(this.get_SourcePort().get_Location())):this.set_StartPointOfEdgeRouting(this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.get_SourcePort().get_Curve(),Cast(this.sourcePort,Microsoft.Msagl.Core.Layout.CurvePort.ctor).get_Parameter(),this.get_SourceLoosePolyline())))},RunInternal:function(){this.CalculateWholeTangentVisibilityGraph()},CalculateWholeTangentVisibilityGraph:function(){this.set_VisibilityGraph(new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor);this.CalculateWholeVisibilityGraphOnExistingGraph()},CalculateWholeVisibilityGraphOnExistingGraph:function(){var n,t,i;for(this.activePolygons=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.Polygon.ctor,this.AllPolygons()),n=this.get_ObstacleCalculator().get_LooseObstacles().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.get_VisibilityGraph().AddHole(t);i=this.get_UseSpanner()?function(){var n=new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSpanner.ctor$$IEnumerable$1$Polyline$$VisibilityGraph(this.get_ObstacleCalculator().get_LooseObstacles(),this.get_VisibilityGraph());return n.set_ConeAngle(this.get_ConeSpannerAngle()),n}.call(this):new Microsoft.Msagl.Routing.Visibility.InteractiveTangentVisibilityGraphCalculator.ctor(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.Polygon.ctor),this.activePolygons,this.visibilityGraph);i.Run()},RouteSplineFromPortToPortWhenTheWholeGraphIsReady:function(n,t,i,r){var f=Is(n,Microsoft.Msagl.Core.Layout.FloatingPort.ctor)&&Is(t,Microsoft.Msagl.Core.Layout.CurvePort.ctor)||Is(n,Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor),e,u;return(f&&(e=n,n=t,t=e),this.sourcePort=n,this.targetPort=t,this.FigureOutSourceTargetPolylinesAndActiveRectangle(),u=this.GetEdgeGeomByRouting(i,r),u==null)?null:(this._sourceVisibilityVertex=this.targetVisibilityVertex=null,f&&(u=u.Reverse()),u)},GetEdgeGeomByRouting:function(n,t){this.targetIsInsideOfSourceTightPolyline=this.get_SourceTightPolyline()==null||Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(this.targetPort.get_Location(),this.get_SourceTightPolyline())==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside;this.sourceIsInsideOfTargetTightPolyline=this.get_TargetTightPolyline()==null||Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(this.sourcePort.get_Location(),this.get_TargetTightPolyline())==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside;var i=As(this.sourcePort,Microsoft.Msagl.Core.Layout.CurvePort.ctor),r;return i!=null?(this.set_StartPointOfEdgeRouting(this.targetIsInsideOfSourceTightPolyline?i.get_Location():this.TakeBoundaryPortOutsideOfItsLoosePolyline(i.get_Curve(),i.get_Parameter(),this.get_SourceLoosePolyline())),this.CalculateSourcePortVisibilityGraph(),r=Is(this.targetPort,Microsoft.Msagl.Core.Layout.CurvePort.ctor)?this.RouteFromBoundaryPortToBoundaryPort(n,t):this.RouteFromBoundaryPortToFloatingPort(this.targetLoosePolyline,n,t)):Is(this.targetPort,Microsoft.Msagl.Core.Layout.FloatingPort.ctor)?(this.ExtendVisibilityGraphFromFloatingSourcePort(),System.Diagnostics.Debug.Assert$$Boolean(this._sourceVisibilityVertex!=null),r=this.RouteFromFloatingPortToFloatingPort(this.targetLoosePolyline,n,t)):r=this.RouteFromFloatingPortToAnywherePort(Cast(this.targetPort,Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor).get_LoosePolyline(),n,t,Cast(this.targetPort,Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor)),r},RouteFromFloatingPortToAnywherePort:function(n,t,i,r){return r.get_Curve().get_BoundingBox().Contains$$Point(this.sourcePort.get_Location())?(this._sourceVisibilityVertex=this.GetVertex(this.sourcePort.get_Location()),this._polyline=this.GetShortestPolylineToMulitpleTargets(this.get_SourceVisibilityVertex(),this.Targets(n)),this._polyline==null)?(i.Value=null,null):(this.get_UseSpanner()&&this.TryShortcutPolyline(),this.RelaxPolyline(),this.FixLastPolylinePointForAnywherePort(r),r.get_HookSize()>0&&this.BuildHook(r),this.SmoothCornersAndReturnCurve(t,i)):(i.Value=null,null)},BuildHook:function(n){var r=n.get_Curve(),s=new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point(n.get_HookSize(),n.get_HookSize(),this._polyline.get_End()),t=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor,Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(r,s,!0)),f,o;System.Diagnostics.Debug.Assert$$Boolean(t.length==2);Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t[0].get_IntersectionPoint(),this._polyline.get_End(),this._polyline.get_EndPoint().get_Prev().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&System.Linq.Enumerable.Reverse$1(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor,t);var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this._polyline.get_End(),this._polyline.get_EndPoint().get_Prev().get_Point()).Normalize(),u=r.Derivative(t[0].get_Par0()).Normalize(),e=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,i);System.Math.Abs$$Double(e)<.2?this.ExtendPolyline(u,t[0],i,n):(f=r.Derivative(t[1].get_Par0()).Normalize(),o=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,i),o<e?this.ExtendPolyline(f,t[1],i,n):this.ExtendPolyline(u,t[0],i,n))},ExtendPolyline:function(n,t,i,r){var u=n.Rotate(1.5707963267949),f,e;(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,i)<0&&(u=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(u)),f=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_IntersectionPoint(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(u,r.get_HookSize())),function(){var t={Value:e},r=Microsoft.Msagl.Core.Geometry.Point.LineLineIntersection(f,Microsoft.Msagl.Core.Geometry.Point.op_Addition(f,n),this._polyline.get_End(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(this._polyline.get_End(),i),t);return e=t.Value,r}.call(this))&&(this._polyline.AddPoint$$Point(e),this._polyline.AddPoint$$Point(f),this._polyline.AddPoint$$Point(t.get_IntersectionPoint()))},FixLastPolylinePointForAnywherePort:function(n){for(var t,i,r,u,f;;){t=this.GetLastPointInsideOfCurveOnPolyline(n.get_Curve());t.get_Next().set_Next(null);this._polyline.set_EndPoint(t.get_Next());i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Next().get_Point(),t.get_Point());i=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(i.Normalize(),n.get_Curve().get_BoundingBox().get_Diagonal());var s=i.Rotate(-n.get_AdjustmentAngle()),h=i.Rotate(n.get_AdjustmentAngle()),e=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(n.get_Curve(),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.get_Point(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Point(),s)),!0),o=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(n.get_Curve(),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.get_Point(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Point(),h)),!0);if(e==null||o==null)return;if(r=Microsoft.Msagl.Routing.InteractiveEdgeRouter.GetTrimmedCurveForHookingUpAnywhere(n.get_Curve(),t,e,o),u=r.get_Item$$Double(r.ClosestParameter(t.get_Point())),!this.LineAvoidsTightHierarchy$$LineSegment$$Polyline$$Polyline(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.get_Point(),u),this.get_SourceTightPolyline(),null)){if(f=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(n.get_Curve(),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.get_Point(),t.get_Next().get_Point()),!1),f==null)return;this._polyline.get_EndPoint().set_Point(f.get_IntersectionPoint());break}if(this._polyline.get_EndPoint().set_Point(u),t.get_Prev()==null||!this.TryShortcutPolyPoint(t.get_Prev()))break}},GetLastPointInsideOfCurveOnPolyline:function(n){for(var t=this._polyline.get_EndPoint().get_Prev();t!=null;t=t.get_Prev())if(t.get_Prev()==null||Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t.get_Point(),n)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside)return t;throw $CreateException(new System.InvalidOperationException.ctor,new Error);},GetShortestPolylineToMulitpleTargets:function(n,t){var f,i,r,u,e;if(this.CleanTheGraphForShortestPath(),f=new Microsoft.Msagl.Routing.SingleSourceMultipleTargetsShortestPathOnVisibilityGraph.ctor(n,t,this.get_VisibilityGraph()),i=f.GetPath(),i==null)return null;for(System.Diagnostics.Debug.Assert$$Boolean(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,i)==n&&System.Linq.Enumerable.Contains$1$$IEnumerable$1$$TSource(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,t,System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,i))),r=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,u=i.GetEnumerator();u.MoveNext();)e=u.get_Current(),r.AddPoint$$Point(e.Point);return Microsoft.Msagl.Routing.InteractiveEdgeRouter.RemoveCollinearVertices(r)},Targets:function(n){return new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,n,$CreateAnonymousDelegate(this,function(n){return this.visibilityGraph.FindVertex(n)})))},ExtendVisibilityGraphFromFloatingSourcePort:function(){var n=As(this.sourcePort,Microsoft.Msagl.Core.Layout.FloatingPort.ctor);System.Diagnostics.Debug.Assert$$Boolean(n!=null);this.set_StartPointOfEdgeRouting(n.get_Location());this.get_UseSpanner()?this._sourceVisibilityVertex=this.AddTransientVisibilityEdgesForPort(this.sourcePort.get_Location(),this.get_SourceLoosePolyline()):function(){var n={Value:this._sourceVisibilityVertex},t=Microsoft.Msagl.Routing.Visibility.PointVisibilityCalculator.CalculatePointVisibilityGraph(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.GetActivePolylines(),$CreateAnonymousDelegate(this,function(n){return n!=this.get_SourceLoosePolyline()})),this.get_VisibilityGraph(),this.get_StartPointOfEdgeRouting(),Microsoft.Msagl.Routing.Visibility.VisibilityKind.Tangent,n);return this._sourceVisibilityVertex=n.Value,t}.call(this)},FigureOutSourceTargetPolylinesAndActiveRectangle:function(){this._sourceTightPolyline=Microsoft.Msagl.Routing.InteractiveEdgeRouter.GetFirstHitPolyline(this.sourcePort.get_Location(),this.get_ObstacleCalculator().get_RootOfTightHierarchy());this.set_SourceLoosePolyline(Microsoft.Msagl.Routing.InteractiveEdgeRouter.GetFirstHitPolyline(this.sourcePort.get_Location(),this.get_ObstacleCalculator().get_RootOfLooseHierarchy()));this.targetTightPolyline=Microsoft.Msagl.Routing.InteractiveEdgeRouter.GetFirstHitPolyline(this.targetPort.get_Location(),this.get_ObstacleCalculator().get_RootOfTightHierarchy());this.targetLoosePolyline=Microsoft.Msagl.Routing.InteractiveEdgeRouter.GetFirstHitPolyline(this.targetPort.get_Location(),this.get_ObstacleCalculator().get_RootOfLooseHierarchy());this.activeRectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-Infinity,Infinity),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(Infinity,-Infinity))},AllPolygons:function(){for(var n=[],t=this.get_ObstacleCalculator().get_LooseObstacles().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.push(new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(i));return n},GetVisibilityGraph:function(){return this.get_VisibilityGraph()},AddActivePolygons:function(n){this.activePolygons.AddRange(n)},ClearActivePolygons:function(){this.activePolygons.Clear()}}};JsTypes.push(Microsoft$Msagl$Routing$InteractiveEdgeRouter);Microsoft$Msagl$Routing$InteractiveObstacleCalculator={fullname:"Microsoft.Msagl.Routing.InteractiveObstacleCalculator",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.InteractiveObstacleCalculator.LooseDistCoefficient=2.1},UpdateRectsForParents:function(n){while(n.get_Parent()!=null)n.get_Parent().rectangle.Add$$Rectangle(n.get_Rectangle()),n=n.get_Parent()},CreateTightObstacles$$IEnumerable$1$ICurve$$Double$$Set$1$Polyline:function(n,t,i){var r,u;if(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.DataStructures.Set$1.op_Inequality(i,null)),System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,n)==0)return null;for(r=n.GetEnumerator();r.MoveNext();)u=r.get_Current(),Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CalculateTightPolyline(i,t,u);return Microsoft.Msagl.Routing.InteractiveObstacleCalculator.RemovePossibleOverlapsInTightPolylinesAndCalculateHierarchy(i)},RemovePossibleOverlapsInTightPolylinesAndCalculateHierarchy:function(n){for(var t=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CalculateHierarchy(n),i;(i=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.GetOverlappedPairSet(t)).get_Count()>0;)t=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.ReplaceTightObstaclesWithConvexHulls(n,i);return t},CalculateTightPolyline:function(n,t,i){var r=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.PaddedPolylineBoundaryOfNode(i,t);n.Insert(r)},ReplaceTightObstaclesWithConvexHulls:function(n,t){for(var i=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),u=t.GetEnumerator(),r,c;u.MoveNext();)r=u.get_Current(),i.Insert(r.get_Item1()),i.Insert(r.get_Item2());for(var f=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,i),e=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.MapToInt$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,f),l=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,t,function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(e.get_Item$$TKey(n.get_Item1()),e.get_Item$$TKey(n.get_Item2()))})),a=Microsoft.Msagl.Core.GraphAlgorithms.ConnectedComponentCalculator$1.GetComponents(l),o=a.GetEnumerator();o.MoveNext();){for(var v=o.get_Current(),s=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Int32.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,v,function(n){return f[n]}),y=System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,s,function(n){return n}),p=Microsoft.Msagl.Core.Geometry.ConvexHull.CreateConvexHullAsClosedPolyline(y),h=s.GetEnumerator();h.MoveNext();)c=h.get_Current(),n.Remove(c);n.Insert(p)}return Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CalculateHierarchy(n)},MapToInt$1:function(n,t){for(var r=new System.Collections.Generic.Dictionary$2.ctor(n,System.Int32.ctor),i=0;i<t.length;i++)r.set_Item$$TKey(t[i],i);return r},GetOverlappedPairSet:function(n){var t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Tuple$2.ctor);return Microsoft.Msagl.Core.Geometry.RectangleNodeUtils.CrossRectangleNodes$1$$RectangleNode$1$$RectangleNode$1$$Action$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,n,function(n,i){Microsoft.Msagl.Routing.InteractiveObstacleCalculator.PolylinesIntersect(n,i)&&t.Insert(new System.Tuple$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,i))}),t},PolylinesIntersect:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.CurvesIntersect(n,t)||Microsoft.Msagl.Routing.InteractiveObstacleCalculator.OneCurveLiesInsideOfOther(n,t)},CalculateHierarchy:function(n){var t=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n,function(n){return Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CreateRectNodeOfPolyline(n)}));return Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnListOfNodes(t)},CreateRectNodeOfPolyline:function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,As(n,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor).get_BoundingBox())},OneCurveLiesInsideOfOther:function(n,t){return System.Diagnostics.Debug.Assert$$Boolean$$String(!Microsoft.Msagl.Core.Geometry.Curves.Curve.CurvesIntersect(n,t),"The curves should not intersect"),Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n.get_Start(),t)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside||Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t.get_Start(),n)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside},CreatePaddedPolyline:function(n,t){var i,r;if(System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n.get_Item$$Double(0),n.get_Item$$Double(1),n.get_Item$$Double(2))==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise,"Unpadded polyline is not clockwise"),i=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,!Microsoft.Msagl.Routing.InteractiveObstacleCalculator.PadCorner(i,n.get_EndPoint().get_Prev(),n.get_EndPoint(),n.get_StartPoint(),t))return Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CreatePaddedPolyline(function(){var t=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(Microsoft.Msagl.Core.Geometry.ConvexHull.CalculateConvexHull(n));return t.set_Closed(!0),t}(),t);if(!Microsoft.Msagl.Routing.InteractiveObstacleCalculator.PadCorner(i,n.get_EndPoint(),n.get_StartPoint(),n.get_StartPoint().get_Next(),t))return Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CreatePaddedPolyline(function(){var t=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(Microsoft.Msagl.Core.Geometry.ConvexHull.CalculateConvexHull(n));return t.set_Closed(!0),t}(),t);for(r=n.get_StartPoint();r.get_Next().get_Next()!=null;r=r.get_Next())if(!Microsoft.Msagl.Routing.InteractiveObstacleCalculator.PadCorner(i,r,r.get_Next(),r.get_Next().get_Next(),t))return Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CreatePaddedPolyline(function(){var t=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(Microsoft.Msagl.Core.Geometry.ConvexHull.CalculateConvexHull(n));return t.set_Closed(!0),t}(),t);return System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(i.get_Item$$Double(0),i.get_Item$$Double(1),i.get_Item$$Double(2))!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise,"Padded polyline is counterclockwise"),i.set_Closed(!0),i},PadCorner:function(n,t,i,r,u){var f,e,o=function(){var n={Value:f},o={Value:e},s=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.GetPaddedCorner(t,i,r,n,o,u);return f=n.Value,e=o.Value,s}();return o==-1?!1:(n.AddPoint$$Point(f),o==2&&n.AddPoint$$Point(e),!0)},GetPaddedCorner:function(n,t,i,r,u,f){var s=n.get_Point(),e=t.get_Point(),h=i.get_Point(),o,l,y,a;if(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(s,e,h)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise)return r.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,u.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,-1;if(o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,s).Rotate(1.5707963267949).Normalize(),Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CornerIsNotTooSharp(s,e,h))return o=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(o,f),l=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h,e).Normalize(),f).Rotate(1.5707963267949),y=Microsoft.Msagl.Core.Geometry.Point.LineLineIntersection(Microsoft.Msagl.Core.Geometry.Point.op_Addition(s,o),Microsoft.Msagl.Core.Geometry.Point.op_Addition(e,o),Microsoft.Msagl.Core.Geometry.Point.op_Addition(e,l),Microsoft.Msagl.Core.Geometry.Point.op_Addition(h,l),r),System.Diagnostics.Debug.Assert$$Boolean(y),u.Value=r.Value,1;if(a=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,s).Normalize(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,h).Normalize()),a.get_Length()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon())return r.Value=u.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(e,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(f,o)),1;var c=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(a.Normalize(),f),v=c.Rotate(1.5707963267949),p=(f-Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(c,o))/Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(v,o);return r.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(c,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(p,v)),e),u.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(c,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(p,v)),e),2},CornerIsNotTooSharp:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t).Rotate(.785398163397448),t);return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t,r,i)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise},CurveIsClockwise:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t,n.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Start(),n.Derivative(n.get_ParStart())))==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise},PaddedPolylineBoundaryOfNode:function(n,t){return Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CreatePaddedPolyline(Microsoft.Msagl.Core.Geometry.Curves.Curve.PolylineAroundClosedCurve(n),t)},LoosePolylineWithFewCorners:function(n,t){if(t<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return n;return Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CreateLoosePolylineOnBisectors(n,t)},CreateLoosePolylineOnBisectors:function(n,t){return function(){var i=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(Microsoft.Msagl.Core.Geometry.ConvexHull.CalculateConvexHull(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.BisectorPoints(n,t)));return i.set_Closed(!0),i}()},BisectorPoints:function(n,t){for(var r,f,u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),i=n.get_StartPoint();i!=null;i=i.get_Next())f=function(){var n={Value:r},u=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.GetStickingVertexOnBisector(i,t,n);return r=n.Value,u}(),r||u.Add(f);return u},GetStickingVertexOnBisector:function(n,t,i){var e=n.get_Polyline().Prev(n).get_Point(),u=n.get_Point(),o=n.get_Polyline().Next(n).get_Point(),r=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u,e).Normalize(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u,o).Normalize()),f=r.get_Length();return f<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?i.Value=!0:(i.Value=!1,r=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(r,f)),Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,r),u)},FindMaxPaddingForTightPolyline:function(n,t,i){var r=i,s=new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(t),f=t.get_BoundingBox().Clone(),u,e,o;for(f.Pad$$Double(2*i),u=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n.GetNodeItemsIntersectingRectangle(f),function(n){return n!=t}).GetEnumerator();u.MoveNext();)e=u.get_Current(),o=Microsoft.Msagl.Routing.Visibility.Polygon.Distance$$Polygon$$Polygon(s,new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(e)),r=System.Math.Min$$Double$$Double(r,o/2.1);return r},CurveIntersectsRectangleNode:function(n,t,i){if(!i.get_Rectangle().Intersects(t.Value))return!1;if(i.get_UserData()!=null){var r=i.get_UserData();return Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(r,n,!1)!=null||Microsoft.Msagl.Routing.InteractiveObstacleCalculator.Inside(r,n)}return System.Diagnostics.Debug.Assert$$Boolean(i.get_Left()!=null&&i.get_Right()!=null),Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CurveIntersectsRectangleNode(n,t,i.get_Left())||Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CurveIntersectsRectangleNode(n,t,i.get_Right())},Inside:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t.get_Start(),n)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.tightPolylinesToLooseDistances=null;this.tightObstacles=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);this._TightPadding=0;this._LoosePadding=0;this._Obstacles=null;this._OverlapsDetected=!1;this._LooseObstacles=null;this._RootOfTightHierarchy=null;this._RootOfLooseHierarchy=null;this._IgnoreTightPadding=!1;System.Object.ctor.call(this);this.set_Obstacles(n);this.set_TightPadding(t);this.set_LoosePadding(i);this.set_IgnoreTightPadding(r)},TightPadding$$:"System.Double",get_TightPadding:function(){return this._TightPadding},set_TightPadding:function(n){this._TightPadding=n},LoosePadding$$:"System.Double",get_LoosePadding:function(){return this._LoosePadding},set_LoosePadding:function(n){this._LoosePadding=n},Obstacles$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Curves.ICurve]]",get_Obstacles:function(){return this._Obstacles},set_Obstacles:function(n){this._Obstacles=n},OverlapsDetected$$:"System.Boolean",get_OverlapsDetected:function(){return this._OverlapsDetected},set_OverlapsDetected:function(n){this._OverlapsDetected=n},TightObstacles$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_TightObstacles:function(){return this.tightObstacles},set_TightObstacles:function(n){this.tightObstacles=n},LooseObstacles$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_LooseObstacles:function(){return this._LooseObstacles},set_LooseObstacles:function(n){this._LooseObstacles=n},RootOfTightHierarchy$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_RootOfTightHierarchy:function(){return this._RootOfTightHierarchy},set_RootOfTightHierarchy:function(n){this._RootOfTightHierarchy=n},RootOfLooseHierarchy$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_RootOfLooseHierarchy:function(){return this._RootOfLooseHierarchy},set_RootOfLooseHierarchy:function(n){this._RootOfLooseHierarchy=n},IgnoreTightPadding$$:"System.Boolean",get_IgnoreTightPadding:function(){return this._IgnoreTightPadding},set_IgnoreTightPadding:function(n){this._IgnoreTightPadding=n},Calculate:function(){this.get_IgnoreTightPadding()?this.CreateTightObstaclesIgnoringTightPadding():this.CreateTightObstacles();this.IsEmpty()||this.CreateLooseObstacles()},CreateLooseObstacles:function(){var t,n,i;for(this.tightPolylinesToLooseDistances=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Double.ctor),this.set_LooseObstacles(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)),t=this.get_TightObstacles().GetEnumerator();t.MoveNext();)n=t.get_Current(),i=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.FindMaxPaddingForTightPolyline(this.get_RootOfTightHierarchy(),n,this.get_LoosePadding()),this.tightPolylinesToLooseDistances.set_Item$$TKey(n,i),this.get_LooseObstacles().Add(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.LoosePolylineWithFewCorners(n,i));this.set_RootOfLooseHierarchy(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CalculateHierarchy(this.get_LooseObstacles()));System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.GetOverlappedPairSet(this.get_RootOfLooseHierarchy()).get_Count()==0,"Overlaps are found in LooseObstacles")},CreateTightObstacles:function(){this.set_RootOfTightHierarchy(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CreateTightObstacles$$IEnumerable$1$ICurve$$Double$$Set$1$Polyline(this.get_Obstacles(),this.get_TightPadding(),this.get_TightObstacles()));this.set_OverlapsDetected(this.get_TightObstacles().get_Count()<System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,this.get_Obstacles()))},CreateTightObstaclesIgnoringTightPadding:function(){var n=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.get_Obstacles(),$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PolylineAroundClosedCurve(n)}))),f=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CalculateHierarchy(n),r=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.GetOverlappedPairSet(f),e;if(this.set_TightObstacles(new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)),r.get_Count()==0){for(var t=0,s=n.length,u=n[t];t<s;t++,u=n[t])e=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.FindMaxPaddingForTightPolyline(f,u,this.get_TightPadding()),this.get_TightObstacles().Insert(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.LoosePolylineWithFewCorners(u,e));this.set_RootOfTightHierarchy(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CalculateHierarchy(this.get_TightObstacles()))}else{for(var i=0,h=n.length,o=n[i];i<h;i++,o=n[i])this.get_TightObstacles().Insert(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CreatePaddedPolyline(o,this.get_TightPadding()));if(!this.IsEmpty())for(this.set_RootOfTightHierarchy(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CalculateHierarchy(this.get_TightObstacles())),this.set_OverlapsDetected(!1);(r=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.GetOverlappedPairSet(this.get_RootOfTightHierarchy())).get_Count()>0;)this.set_RootOfTightHierarchy(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.ReplaceTightObstaclesWithConvexHulls(this.get_TightObstacles(),r)),this.set_OverlapsDetected(!0)}},IsEmpty:function(){return Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(this.get_TightObstacles(),null)||this.get_TightObstacles().get_Count()==0},ObstaclesIntersectLine:function(n,t){return this.ObstaclesIntersectICurve(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t))},ObstaclesIntersectICurve:function(n){var t=n.get_BoundingBox();return function(){var i={Value:t},r=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CurveIntersectsRectangleNode(n,i,this.get_RootOfTightHierarchy());return t=i.Value,r}.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$InteractiveObstacleCalculator);Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdge={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge",baseTypeName:"Microsoft.Msagl.Routing.Visibility.VisibilityEdge",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.RightNeighbors=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor);this.setOfLongestSegs=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.LongestNudgedSegment.ctor);this._Direction=Microsoft.Msagl.Core.Geometry.Directions.None;this._LeftBound=0;this._RightBound=0;Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex.call(this,n,t);this.set_RightBound(Infinity);this.set_LeftBound(-Infinity);this.set_Direction(Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(n.Point,t.Point));System.Diagnostics.Debug.Assert$$Boolean(this.get_Direction()==Microsoft.Msagl.Core.Geometry.Directions.East||this.get_Direction()==Microsoft.Msagl.Core.Geometry.Directions.North)},Direction$$:"Microsoft.Msagl.Core.Geometry.Directions",get_Direction:function(){return this._Direction},set_Direction:function(n){this._Direction=n},AddRightNeighbor:function(n){this.RightNeighbors.Insert(n)},LeftBound$$:"System.Double",get_LeftBound:function(){return this._LeftBound},set_LeftBound:function(n){this._LeftBound=n},RightBound$$:"System.Double",get_RightBound:function(){return this._RightBound},set_RightBound:function(n){this._RightBound=n},LongestNudgedSegments$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.LongestNudgedSegment]]",get_LongestNudgedSegments:function(){return this.setOfLongestSegs},AddLongestNudgedSegment:function(n){this.setOfLongestSegs.Insert(n)},BoundFromRight:function(n){n=System.Math.Max$$Double$$Double(n,this.get_LeftBound());this.set_RightBound(System.Math.Min$$Double$$Double(n,this.get_RightBound()))},BoundFromLeft:function(n){n=System.Math.Min$$Double$$Double(n,this.get_RightBound());this.set_LeftBound(System.Math.Max$$Double$$Double(n,this.get_LeftBound()))}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdge);Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdgesContainer={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdgesContainer",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor:function(n){this.edges=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor);this.UpPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._Source=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.set_Source(n)},AddEdge:function(n){this.UpPoint=n.get_TargetPoint();System.Diagnostics.Debug.Assert$$Boolean(this.edges.Contains$$T(n)==!1);this.edges.Insert(n)},Source$$:"Microsoft.Msagl.Core.Geometry.Point",get_Source:function(){return this._Source},set_Source:function(n){this._Source=n},GetEnumerator:function(){return this.edges.GetEnumerator()},RemoveAxis:function(n){System.Diagnostics.Debug.Assert$$Boolean(this.edges.Contains$$T(n));this.edges.Remove(n)},IsEmpty:function(){return this.edges.get_Count()==0}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdgesContainer);Microsoft$Msagl$Routing$Rectilinear$Nudging$CombinatorialNudger={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.NotOrdered=2147483647},CompareTwoPathEdges:function(n,t){if(n==t)return 0;System.Diagnostics.Debug.Assert$$Boolean(n.get_AxisEdge()==t.get_AxisEdge());var i=Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.CompareInDirectionStartingFromAxisEdge(n,t,n.get_AxisEdge(),n.get_AxisEdge().get_Direction());return i!=0?i:-Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.CompareInDirectionStartingFromAxisEdge(n,t,n.get_AxisEdge(),Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(n.get_AxisEdge().get_Direction()))},CompareInDirectionStartingFromAxisEdge:function(n,t,i,r){for(var u;;){if((n=Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.GetNextPathEdgeInDirection(n,i,r),n==null)||(t=Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.GetNextPathEdgeInDirection(t,i,r),t==null))return 0;if(n.get_AxisEdge()==t.get_AxisEdge()){if(r=Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.FindContinuedDirection(i,r,n.get_AxisEdge()),i=n.get_AxisEdge(),u=Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.GetExistingOrder(n,t),u==2147483647)continue;return r==i.get_Direction()?u:-u}var f=r==i.get_Direction()?i.get_Target():i.get_Source(),o=Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.OtherVertex(n.get_AxisEdge(),f),s=Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.OtherVertex(t.get_AxisEdge(),f),e=Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.ProjectionForCompare(i,r!=i.get_Direction());return e(o.Point).CompareTo$$Double(e(s.Point))}},FindContinuedDirection:function(n,t,i){return n.get_Direction()==t?i.get_Source()==n.get_Target()?i.get_Direction():Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(i.get_Direction()):i.get_Source()==n.get_Source()?i.get_Direction():Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(i.get_Direction())},OtherVertex:function(n,t){return n.get_Source()==t?n.get_Target():n.get_Source()},ProjectionForCompare:function(n,t){return n.get_Direction()==Microsoft.Msagl.Core.Geometry.Directions.North?t?function(n){return-n.get_X()}:function(n){return n.get_X()}:t?function(n){return n.get_Y()}:function(n){return-n.get_Y()}},GetNextPathEdgeInDirection:function(n,t,i){return System.Diagnostics.Debug.Assert$$Boolean(n.get_AxisEdge()==t),t.get_Direction()==i?n.get_Reversed()?n.get_Prev():n.get_Next():n.get_Reversed()?n.get_Next():n.get_Prev()},GetExistingOrder:function(n,t){var r=n.get_Index(),i;return r==-1?2147483647:(i=t.get_Index(),System.Diagnostics.Debug.Assert$$Boolean(i!=-1),r.CompareTo$$Int32(i))},InitQueueOfSources:function(n,t,i){for(var f=i.Vertices().GetEnumerator(),r,u;f.MoveNext();)r=f.get_Current(),u=r.get_InEdges().get_Count(),t.set_Item$$TKey(r,u),u==0&&n.Enqueue(r);System.Diagnostics.Debug.Assert$$Boolean(n.get_Count()>0)},WalkGraphEdgesInTopologicalOrderIfPossible:function(n){var f=[],i=new System.Collections.Generic.Queue$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor),r=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,System.Int32.ctor),e,u,t,o;for(Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.InitQueueOfSources(i,r,n);i.get_Count()>0;)for(e=i.Dequeue(),u=e.get_OutEdges().GetEnumerator();u.MoveNext();)t=u.get_Current(),o=r.set_Item$$TKey(t.get_Target(),r.get_Item$$TKey(t.get_Target())-1),o==1&&i.Enqueue(t.get_Target()),f.push(Cast(t,Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor));return f}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.pathVisibilityGraph=new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor;this.axisEdgesToPathOrders=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor,System.Collections.Generic.List$1.ctor);this._OriginalPaths=null;System.Object.ctor.call(this);this.set_OriginalPaths(n)},PathVisibilityGraph$$:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",get_PathVisibilityGraph:function(){return this.pathVisibilityGraph},OriginalPaths$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.Path]]",get_OriginalPaths:function(){return this._OriginalPaths},set_OriginalPaths:function(n){this._OriginalPaths=n},GetOrder:function(){return this.FillTheVisibilityGraphByWalkingThePaths(),this.InitPathOrder(),this.OrderPaths(),this.axisEdgesToPathOrders},FillTheVisibilityGraphByWalkingThePaths:function(){for(var n=this.get_OriginalPaths().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.FillTheVisibilityGraphByWalkingPath(t)},FillTheVisibilityGraphByWalkingPath:function(n){var t=this.CreatePathEdgesFromPoints(n.get_PathPoints(),n.get_Width()).GetEnumerator();for(t.MoveNext()&&n.SetFirstEdge(t.get_Current());t.MoveNext();)n.AddEdge(t.get_Current())},CreatePathEdgesFromPoints:function(n,t){for(var r=[],u=System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n),f=System.Linq.Enumerable.Skip$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n,1).GetEnumerator(),i;f.MoveNext();)i=f.get_Current(),r.push(this.CreatePathEdge(u,i,t)),u=i;return r},CreatePathEdge:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(n,t);switch(r){case Microsoft.Msagl.Core.Geometry.Directions.East:case Microsoft.Msagl.Core.Geometry.Directions.North:return new Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge.ctor(this.GetAxisEdge(n,t),i);case Microsoft.Msagl.Core.Geometry.Directions.South:case Microsoft.Msagl.Core.Geometry.Directions.West:return function(){var r=new Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge.ctor(this.GetAxisEdge(t,n),i);return r.set_Reversed(!0),r}.call(this);default:throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},GetAxisEdge:function(n,t){return As(this.get_PathVisibilityGraph().AddEdge$$Point$$Point$$Func$3$VisibilityVertex$VisibilityVertex$VisibilityEdge(n,t,$CreateAnonymousDelegate(this,function(n,t){return new Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor(n,t)})),Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor)},InitPathOrder:function(){for(var i=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor,this.get_PathVisibilityGraph().get_Edges(),$CreateAnonymousDelegate(this,function(n){return Cast(n,Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor)})).GetEnumerator(),r,n,t;i.MoveNext();)r=i.get_Current(),this.axisEdgesToPathOrders.set_Item$$TKey(r,new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge.ctor));for(n=System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge.ctor,this.get_OriginalPaths(),$CreateAnonymousDelegate(this,function(n){return n.get_PathEdges()})).GetEnumerator();n.MoveNext();)t=n.get_Current(),this.axisEdgesToPathOrders.get_Item$$TKey(t.get_AxisEdge()).Add(t)},OrderPaths:function(){for(var n=Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.WalkGraphEdgesInTopologicalOrderIfPossible(this.get_PathVisibilityGraph()).GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.OrderPathEdgesSharingEdge(t)},OrderPathEdgesSharingEdge:function(n){var i=this.PathOrderOfVisEdge(n),r,t,u;for(i.Sort$$Comparison$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.CompareTwoPathEdges),r=0,t=i.GetEnumerator();t.MoveNext();)u=t.get_Current(),u.set_Index(r++)},PathOrderOfVisEdge:function(n){return this.axisEdgesToPathOrders.get_Item$$TKey(n)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$CombinatorialNudger);Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdgeHighPointEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdgeHighPointEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.site=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._AxisEdge=null;Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor.call(this);this.site=t;this.set_AxisEdge(n)},AxisEdge$$:"Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge",get_AxisEdge:function(){return this._AxisEdge},set_AxisEdge:function(n){this._AxisEdge=n},Site$$:"Microsoft.Msagl.Core.Geometry.Point",get_Site:function(){return this.site}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdgeHighPointEvent);Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdgeLowPointEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdgeLowPointEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.site=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._AxisEdge=null;Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor.call(this);this.site=t;this.set_AxisEdge(n)},AxisEdge$$:"Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge",get_AxisEdge:function(){return this._AxisEdge},set_AxisEdge:function(n){this._AxisEdge=n},Site$$:"Microsoft.Msagl.Core.Geometry.Point",get_Site:function(){return this.site}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$AxisEdgeLowPointEvent);Microsoft$Msagl$Core$DataStructures$ComparerOnDelegate$1={fullname:"Microsoft.Msagl.Core.DataStructures.ComparerOnDelegate$1",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n,t){this.T=n;this.comparer=null;System.Object.ctor.call(this);this.comparer=t},Compare:function(n,t){return this.comparer(n,t)}}};JsTypes.push(Microsoft$Msagl$Core$DataStructures$ComparerOnDelegate$1);Microsoft$Msagl$Routing$Rectilinear$Nudging$FreeSpaceFinder={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder",baseTypeName:"Microsoft.Msagl.Routing.Visibility.LineSweeperBase",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.AreaComparisonEpsilon=Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()},X:function(n){return n.get_X()},MinusY:function(n){return-n.get_Y()},PointToTheLeftOfLineOrOnLineLocal:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,t,i)>-Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.AreaComparisonEpsilon},PointToTheRightOfLineOrOnLineLocal:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(t,i,n)<Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.AreaComparisonEpsilon},EdgeHighPointEvent:function(n,t){return new Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdgeHighPointEvent.ctor(n,t)},EdgeLowPointEvent:function(n,t){return new Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdgeLowPointEvent.ctor(n,t)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this.xProjection=null;this.edgeContainersTree=null;this._PathOrders=null;this._AxisEdgesToObstaclesTheyOriginatedFrom=null;this._SweepPole=Microsoft.Msagl.Core.Geometry.Directions.None;this._AxisEdges=null;Microsoft.Msagl.Routing.Visibility.LineSweeperBase.ctor.call(this,t,new Microsoft.Msagl.Core.Geometry.CompassVector.ctor$$Directions(n).ToPoint());this.set_DirectionPerp(new Microsoft.Msagl.Core.Geometry.CompassVector.ctor$$Directions(n).get_Right().ToPoint());this.set_PathOrders(r);this.xProjection=n==Microsoft.Msagl.Core.Geometry.Directions.North?Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.X:Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.MinusY;this.edgeContainersTree=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdgesContainer.ctor,new Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.FreeSpaceFinderComparer.ctor(this));this.set_SweepPole(Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point(this.get_SweepDirection()));System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(this.get_SweepPole()));this.set_AxisEdges(u);this.set_AxisEdgesToObstaclesTheyOriginatedFrom(i)},PathOrders$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge],[System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge]]]]",get_PathOrders:function(){return this._PathOrders},set_PathOrders:function(n){this._PathOrders=n},AxisEdgesToObstaclesTheyOriginatedFrom$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge],[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_AxisEdgesToObstaclesTheyOriginatedFrom:function(){return this._AxisEdgesToObstaclesTheyOriginatedFrom},set_AxisEdgesToObstaclesTheyOriginatedFrom:function(n){this._AxisEdgesToObstaclesTheyOriginatedFrom=n},SweepPole$$:"Microsoft.Msagl.Core.Geometry.Directions",get_SweepPole:function(){return this._SweepPole},set_SweepPole:function(n){this._SweepPole=n},FindFreeSpace:function(){this.InitTheQueueOfEvents();this.ProcessEvents()},ProcessEvents:function(){while(this.get_EventQueue().get_Count()>0)this.ProcessEvent(this.get_EventQueue().Dequeue())},ProcessEvent:function(n){var i=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent.ctor),t;i!=null?this.ProcessVertexEvent(i):(t=As(n,Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdgeLowPointEvent.ctor),this.set_Z(this.GetZ$$Point(n.get_Site())),t!=null?this.ProcessLowEdgeEvent(t):this.ProcessHighEdgeEvent(Cast(n,Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdgeHighPointEvent.ctor)))},ProcessHighEdgeEvent:function(n){var t=n.get_AxisEdge();this.RemoveEdge(t);this.ConstraintEdgeWithObstaclesAtZ(t,t.get_Target().Point)},ProcessLowEdgeEvent:function(n){var i=n.get_AxisEdge(),t=this.GetOrCreateAxisEdgesContainer(i),u,f,c,e,o,s,r,h,l;if(t.Item.AddEdge(i),u=this.edgeContainersTree.Previous(t),u!=null)for(f=u.Item.GetEnumerator();f.MoveNext();)for(c=f.get_Current(),e=t.Item.GetEnumerator();e.MoveNext();)r=e.get_Current(),this.TryToAddRightNeighbor(c,r);if(o=this.edgeContainersTree.Next(t),o!=null)for(s=t.Item.GetEnumerator();s.MoveNext();)for(r=s.get_Current(),h=o.Item.GetEnumerator();h.MoveNext();)l=h.get_Current(),this.TryToAddRightNeighbor(r,l);this.ConstraintEdgeWithObstaclesAtZ(i,i.get_Source().Point)},TryToAddRightNeighbor:function(n,t){this.ProjectionsOfEdgesOverlap(n,t)&&n.AddRightNeighbor(t)},ProjectionsOfEdgesOverlap:function(n,t){return this.get_SweepPole()==Microsoft.Msagl.Core.Geometry.Directions.North?!(n.get_TargetPoint().get_Y()<t.get_SourcePoint().get_Y()-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon||t.get_TargetPoint().get_Y()<n.get_SourcePoint().get_Y()-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon):!(n.get_TargetPoint().get_X()<t.get_SourcePoint().get_X()-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon||t.get_TargetPoint().get_X()<n.get_SourcePoint().get_X()-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)},ConstraintEdgeWithObstaclesAtZ:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.op_Equality(t,n.get_Source().Point)||Microsoft.Msagl.Core.Geometry.Point.op_Equality(t,n.get_Target().Point));this.ConstraintEdgeWithObstaclesAtZFromLeft(n,t);this.ConstraintEdgeWithObstaclesAtZFromRight(n,t)},ConstraintEdgeWithObstaclesAtZFromRight:function(n,t){var i=this.GetActiveSideFromRight(t),r;i!=null&&(this.NotRestricting(n,Cast(i.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide.ctor).get_Polyline())||(r=this.get_ObstacleSideComparer().IntersectionOfSideAndSweepLine(i.Item),n.BoundFromRight(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.get_DirectionPerp()))))},GetActiveSideFromRight:function(n){return this.get_LeftObstacleSideTree().FindFirst$$Func$2($CreateAnonymousDelegate(this,function(t){return Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.PointToTheLeftOfLineOrOnLineLocal(n,t.get_Start(),t.get_End())}))},ConstraintEdgeWithObstaclesAtZFromLeft:function(n,t){var i=this.GetActiveSideFromLeft(t),r;i!=null&&(this.NotRestricting(n,Cast(i.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide.ctor).get_Polyline())||(r=this.get_ObstacleSideComparer().IntersectionOfSideAndSweepLine(i.Item),n.BoundFromLeft(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.get_DirectionPerp()))))},GetActiveSideFromLeft:function(n){return this.get_RightObstacleSideTree().FindLast$$Func$2($CreateAnonymousDelegate(this,function(t){return Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.PointToTheRightOfLineOrOnLineLocal(n,t.get_Start(),t.get_End())}))},GetOrCreateAxisEdgesContainer:function(n){var t=n.get_Source().Point,i=this.GetAxisEdgesContainerNode(t);return i!=null?i:this.edgeContainersTree.Insert(new Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdgesContainer.ctor(t))},GetAxisEdgesContainerNode:function(n){var i=this.xProjection(n),t=this.edgeContainersTree.FindFirst$$Func$2($CreateAnonymousDelegate(this,function(n){return this.xProjection(n.get_Source())>=i-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon/2}));return t!=null&&this.xProjection(t.Item.get_Source())<=i+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon/2?t:null},ProcessVertexEvent:function(n){var t,i;this.set_Z(this.GetZ$$SweepEvent(n));t=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent.ctor);t!=null?this.ProcessLeftVertex(t,n.get_Vertex().get_NextOnPolyline()):(i=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent.ctor),i!=null?this.ProcessRightVertex(i,n.get_Vertex().get_PrevOnPolyline()):(this.ProcessLeftVertex(n,n.get_Vertex().get_NextOnPolyline()),this.ProcessRightVertex(n,n.get_Vertex().get_PrevOnPolyline())))},ProcessRightVertex:function(n,t){var i;System.Diagnostics.Debug.Assert$$Boolean(this.get_Z()==Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(n.get_Site(),this.get_SweepDirection()));i=n.get_Site();this.ProcessPrevSegmentForRightVertex(n,i);var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),n.get_Site()),f=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.get_DirectionPerp()),u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.get_SweepDirection());u<=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?f>0&&u>=0?this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent.ctor(t)):this.RestrictEdgeContainerToTheRightOfEvent(n.get_Vertex()):(this.InsertRightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide.ctor(n.get_Vertex())),this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent.ctor(t)),this.RestrictEdgeContainerToTheRightOfEvent(n.get_Vertex()))},RestrictEdgeContainerToTheRightOfEvent:function(n){var r=n.get_Point(),f=this.xProjection(r),u=this.edgeContainersTree.FindFirst$$Func$2($CreateAnonymousDelegate(this,function(n){return f<=this.xProjection(n.get_Source())})),t,i;if(u!=null)for(t=u.Item.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.NotRestricting(i,n.get_Polyline())||i.BoundFromLeft(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_DirectionPerp(),r))},NotRestricting:function(n,t){var i;return function(){var t={Value:i},r=this.get_AxisEdgesToObstaclesTheyOriginatedFrom().TryGetValue(n,t);return i=t.Value,r}.call(this)&&i==t},ProcessPrevSegmentForRightVertex:function(n,t){var i=n.get_Vertex().get_NextOnPolyline().get_Point(),r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,i),u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.get_SweepDirection());u>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.RemoveRightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide.ctor(n.get_Vertex().get_NextOnPolyline()))},RemoveEdge:function(n){var t=this.GetAxisEdgesContainerNode(n.get_Source().Point);t.Item.RemoveAxis(n);t.Item.IsEmpty()&&this.edgeContainersTree.DeleteNodeInternal(t)},ProcessLeftVertex:function(n,t){var i;System.Diagnostics.Debug.Assert$$Boolean(this.get_Z()==Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(n.get_Site(),this.get_SweepDirection()));i=n.get_Site();this.ProcessPrevSegmentForLeftVertex(n,i);var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),n.get_Site()),f=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.get_DirectionPerp()),u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.get_SweepDirection());u<=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?f<0&&u>=0&&this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent.ctor(t)):(this.InsertLeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide.ctor(n.get_Vertex())),this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent.ctor(t)));this.RestrictEdgeFromTheLeftOfEvent(n.get_Vertex())},RestrictEdgeFromTheLeftOfEvent:function(n){var r=n.get_Point(),u=this.GetContainerNodeToTheLeftOfEvent(r),t,i;if(u!=null)for(t=u.Item.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.NotRestricting(i,n.get_Polyline())||i.BoundFromRight(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.get_DirectionPerp()))},GetContainerNodeToTheLeftOfEvent:function(n){var t=this.xProjection(n);return this.edgeContainersTree.FindLast$$Func$2($CreateAnonymousDelegate(this,function(n){return this.xProjection(n.get_Source())<=t}))},ProcessPrevSegmentForLeftVertex:function(n,t){var i=n.get_Vertex().get_PrevOnPolyline().get_Point(),r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,i),u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.get_SweepDirection());u>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.RemoveLeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide.ctor(n.get_Vertex().get_PrevOnPolyline()))},InitTheQueueOfEvents:function(){var n,t;for(this.InitQueueOfEvents(),n=this.get_AxisEdges().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.EnqueueEventsForEdge(t)},AxisEdges$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge]]",get_AxisEdges:function(){return this._AxisEdges},set_AxisEdges:function(n){this._AxisEdges=n},EnqueueEventsForEdge:function(n){this.EdgeIsParallelToSweepDir(n)&&(this.EnqueueEvent(Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.EdgeLowPointEvent(n,n.get_Source().Point)),this.EnqueueEvent(Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.EdgeHighPointEvent(n,n.get_Target().Point)))},EdgeIsParallelToSweepDir:function(n){return n.get_Direction()==this.get_SweepPole()||n.get_Direction()==Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(this.get_SweepPole())}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$FreeSpaceFinder);Microsoft$Msagl$Routing$Rectilinear$Nudging$LinkedPointSplitter={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPointSplitter",baseTypeName:"System.Object",staticDefinition:{TrySplitVerticalPoint:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.get_X(),n.get_Next().get_X()));Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPointSplitter.Low(n)+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<t.get_Y()&&t.get_Y()+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPointSplitter.High(n)&&n.SetNewNext(t)},TrySplitHorizontalPoint:function(n,t,i){return(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.get_Y(),n.get_Next().get_Y())),i&&n.get_X()+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<t.get_X()&&t.get_X()+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<n.get_Next().get_X()||!i&&n.get_Next().get_X()+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<t.get_X()&&t.get_X()+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<n.get_X())?(n.SetNewNext(t),n.get_Next()):n},Low:function(n){return System.Math.Min$$Double$$Double(n.get_Point().get_Y(),n.get_Next().get_Point().get_Y())},High:function(n){return System.Math.Max$$Double$$Double(n.get_Point().get_Y(),n.get_Next().get_Point().get_Y())}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.tree=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$Func$3(Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor,$CreateAnonymousDelegate(this,function(n,t){return n.get_Point().get_X().CompareTo$$Double(t.get_Point().get_X())}));this._HorizontalPoints=null;this._VerticalPoints=null;this._Queue=null;System.Object.ctor.call(this);this.set_VerticalPoints(t);this.set_HorizontalPoints(n)},HorizontalPoints$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint]]",get_HorizontalPoints:function(){return this._HorizontalPoints},set_HorizontalPoints:function(n){this._HorizontalPoints=n},VerticalPoints$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint]]",get_VerticalPoints:function(){return this._VerticalPoints},set_VerticalPoints:function(n){this._VerticalPoints=n},SplitPoints:function(){this.get_VerticalPoints().get_Count()!=0&&this.get_HorizontalPoints().get_Count()!=0&&(this.InitEventQueue(),this.ProcessEvents())},ProcessEvents:function(){while(!this.get_Queue().IsEmpty()){var n,t=function(){var t={Value:n},i=this.get_Queue().Dequeue$$Double(t);return n=t.Value,i}.call(this);this.ProcessEvent(t,n)}},ProcessEvent:function(n,t){Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.get_Next().get_Point().get_X(),n.get_Point().get_X())?t==Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPointSplitter.Low(n)?this.ProcessLowLinkedPointEvent(n):this.ProcessHighLinkedPointEvent(n):this.IntersectWithTree(n)},IntersectWithTree:function(n){var r,u,f,e,t,i;if(System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.get_Y(),n.get_Next().get_Y())),e=n.get_Y(),n.get_Point().get_X()<n.get_Next().get_Point().get_X()?(r=n.get_Point().get_X(),u=n.get_Next().get_Point().get_X(),f=!0):(u=n.get_Point().get_X(),r=n.get_Next().get_Point().get_X(),f=!1),f)for(t=this.tree.FindFirst$$Func$2($CreateAnonymousDelegate(this,function(n){return r<=n.get_Point().get_X()}));t!=null&&t.Item.get_Point().get_X()<=u;t=this.tree.Next(t))i=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.Item.get_Point().get_X(),e),n=Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPointSplitter.TrySplitHorizontalPoint(n,i,!0),Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPointSplitter.TrySplitVerticalPoint(t.Item,i);else for(t=this.tree.FindLast$$Func$2($CreateAnonymousDelegate(this,function(n){return n.get_Point().get_X()<=u}));t!=null&&t.Item.get_Point().get_X()>=r;t=this.tree.Previous(t))i=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.Item.get_Point().get_X(),e),n=Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPointSplitter.TrySplitHorizontalPoint(n,i,!1),Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPointSplitter.TrySplitVerticalPoint(t.Item,i)},ProcessHighLinkedPointEvent:function(n){this.tree.Remove(n)},ProcessLowLinkedPointEvent:function(n){this.tree.Insert(n)},InitEventQueue:function(){var n,t,i,r;for(this.set_Queue(new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor)),n=this.get_VerticalPoints().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.get_Queue().Enqueue(t,Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPointSplitter.Low(t));for(i=this.get_HorizontalPoints().GetEnumerator();i.MoveNext();)r=i.get_Current(),this.get_Queue().Enqueue(r,r.get_Point().get_Y())},Queue$$:"Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint]]",get_Queue:function(){return this._Queue},set_Queue:function(n){this._Queue=n}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$LinkedPointSplitter);Microsoft$Msagl$Routing$Rectilinear$Nudging$Nudger={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger",baseTypeName:"System.Object",staticDefinition:{ObstacleTest:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n,t)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside?Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue},SetWidthsOfArrowheadsForEdge:function(n){var i=n.get_EdgeGeometry(),t;i.get_TargetArrowhead()!=null&&(t=n.get_LastEdge(),t.set_Width(System.Math.Max$$Double$$Double(i.get_TargetArrowhead().get_Width(),t.get_Width())));i.get_SourceArrowhead()!=null&&(t=n.get_FirstEdge(),t.set_Width(System.Math.Max$$Double$$Double(i.get_SourceArrowhead().get_Width(),t.get_Width())))},MoveLongestSegIdealPositionsInsideFeasibleInterval:function(n){if(!n.get_IsFixed()){var t=n.GetLeftBound(),i=n.GetRightBound();n.get_IdealPosition()<t?n.set_IdealPosition(t):n.get_IdealPosition()>i&&n.set_IdealPosition(i)}},Rectilinearise:function(n,t){if(t=t.Clone(),n.get_X()!=t.get_X()&&n.get_Y()!=t.get_Y()){var i=System.Math.Abs$$Double(n.get_X()-t.get_X()),r=System.Math.Abs$$Double(n.get_Y()-t.get_Y());i<r?t.set_X(n.get_X()):t.set_Y(n.get_Y())}return t},ParallelToDirection:function(n,t){switch(t){case Microsoft.Msagl.Core.Geometry.Directions.North:case Microsoft.Msagl.Core.Geometry.Directions.South:return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.get_SourcePoint().get_X(),n.get_TargetPoint().get_X());default:return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.get_SourcePoint().get_Y(),n.get_TargetPoint().get_Y())}},SegmentPosition:function(n,t){return t==Microsoft.Msagl.Core.Geometry.Directions.North?n.get_Start().get_X():-n.get_Start().get_Y()},FindPortEntryRectCrossingAxisEdge:function(n,t,i){for(var f=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(t.get_SourcePoint(),t.get_TargetPoint()),u=n.get_AllowedRectangles().GetEnumerator(),r;u.MoveNext();)if(r=u.get_Current(),r.Intersects(f))return i.Value=r,!0;return i.Value=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox(),!1},CalculateIdealPositionsForLongestSegs:function(n,t){for(var i=null,r=null,u=t(n.get_Start()),e=n.get_PathEdges().GetEnumerator(),f,o;e.MoveNext();)f=e.get_Current(),f.get_LongestNudgedSegment()!=null?(i=f.get_LongestNudgedSegment(),r!=null&&(Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.SetIdealPositionForSeg(r,o=t(r.get_Start()),u,t(i.get_Start())),u=o,r=null)):i!=null&&(r=i,i=null);r!=null?Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.SetIdealPositionForSeg(r,t(r.get_Start()),u,t(n.get_End())):i!=null&&i.set_IdealPosition(t(i.get_Start()))},SetIdealPositionForSeg:function(n,t,i,r){var u=System.Math.Max$$Double$$Double(i,r),f=System.Math.Min$$Double$$Double(i,r);f+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<t?t<u?n.set_IdealPosition(.5*(u+f)):n.set_IdealPosition(u):n.set_IdealPosition(f)},BuildPolylineForPath:function(n){var t=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_PathPoints(),function(n){return n.Clone()})),i;for(function(){var i={Value:t},r=Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.ExtendPolylineToPorts(i,n);return t=i.Value,r}(),i=0;i<t.length-1;i++)System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Point$$Point(t[i],t[i+1]));return t},ExtendPolylineToPorts:function(n,t){Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.ExtendPolylineToSourcePort(n,t.get_EdgeGeometry().get_SourcePort().get_Location());Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.ExtendPolylineToTargetPort(n,t.get_EdgeGeometry().get_TargetPort().get_Location());n.Value.length<2&&(n.Value=new Array(2),n.Value[0]=t.get_EdgeGeometry().get_SourcePort().get_Location(),n.Value[1]=t.get_EdgeGeometry().get_TargetPort().get_Location())},ExtendPolylineToTargetPort:function(n,t){var i=n.Value.length-1,r=Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point$$Point(n.Value[i-1],n.Value[i]);if(Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.ProjectionsAreClose(n.Value[i-1],r,t)){n.Value=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Take$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n.Value,i));return}r==Microsoft.Msagl.Core.Geometry.Directions.East||r==Microsoft.Msagl.Core.Geometry.Directions.West?n.Value[i].set_X(t.get_X()):n.Value[i].set_Y(t.get_Y())},ProjectionsAreClose:function(n,t,i){return t==Microsoft.Msagl.Core.Geometry.Directions.East||t==Microsoft.Msagl.Core.Geometry.Directions.West?Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.get_X(),i.get_X()):Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.get_Y(),i.get_Y())},ExtendPolylineToSourcePort:function(n,t){var i=Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point$$Point(n.Value[0],n.Value[1]);if(Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.ProjectionsAreClose(n.Value[1],i,t)){n.Value=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Skip$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n.Value,1));return}i==Microsoft.Msagl.Core.Geometry.Directions.East||i==Microsoft.Msagl.Core.Geometry.Directions.West?n.Value[0].set_X(t.get_X()):n.Value[0].set_Y(t.get_Y())},RemoveSwitchbacksAndMiddlePoints:function(n){var f=[],i=n.GetEnumerator(),r,t,e,u;for(i.MoveNext(),r=i.get_Current(),f.push(r),i.MoveNext(),t=i.get_Current(),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,r).get_CompassDirection();i.MoveNext();)u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Current(),t).get_CompassDirection(),u==e||Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(u)==e||u==Microsoft.Msagl.Core.Geometry.Directions.None?t=i.get_Current():(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(r,t)||f.push(r=Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.Rectilinearise(r,t)),t=i.get_Current(),e=u);return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(r,t)||f.push(Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.Rectilinearise(r,t)),f},NudgePaths:function(n,t,i,r,u){var f,e,o;if(System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,n))for(f=new Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.ctor(n,t,i,r),f.Calculate(Microsoft.Msagl.Core.Geometry.Directions.North,!0),f.Calculate(Microsoft.Msagl.Core.Geometry.Directions.East,!1),f.Calculate(Microsoft.Msagl.Core.Geometry.Directions.North,!1),u&&f.RemoveStaircases(),e=n.GetEnumerator();e.MoveNext();)o=e.get_Current(),o.get_EdgeGeometry().set_Curve(new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.BuildPolylineForPath(o)))},MapPortsToShapes:function(n){for(var r=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Port.ctor,Microsoft.Msagl.Routing.Shape.ctor),u=n.GetEnumerator(),t,i,f;u.MoveNext();)for(t=u.get_Current(),i=t.get_Ports().GetEnumerator();i.MoveNext();)f=i.get_Current(),r.set_Item$$TKey(f,t);return r}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.axisEdgesToObstaclesTheyOriginatedFrom=null;this._Paths=null;this._Obstacles=null;this._PathVisibilityGraph=null;this._AncestorsSets=null;this._HierarchyOfObstacles=null;this._HierarchyOfGroups=null;this._NudgingDirection=Microsoft.Msagl.Core.Geometry.Directions.None;this._EdgeSeparation=0;this._Solver=null;this._LongestNudgedSegs=null;this._PathOrders=null;this._PathToObstacles=null;this._PortToShapes=null;System.Object.ctor.call(this);this.set_AncestorsSets(r);this.set_HierarchyOfGroups(Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,r.get_Keys(),$CreateAnonymousDelegate(this,function(n){return n.get_IsGroup()})),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Routing.Shape.ctor,n,n.get_BoundingBox())}))));this.set_Obstacles(i);this.set_EdgeSeparation(2*t);this.set_Paths(new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,n));this.set_HierarchyOfObstacles(Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,i,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,n.get_BoundingBox())}))));this.MapPathsToTheirObstacles()},HasGroups$$:"System.Boolean",get_HasGroups:function(){return null!=this.get_HierarchyOfGroups()&&this.get_HierarchyOfGroups().get_Count()>0},Paths$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.Path]]",get_Paths:function(){return this._Paths},set_Paths:function(n){this._Paths=n},Obstacles$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_Obstacles:function(){return this._Obstacles},set_Obstacles:function(n){this._Obstacles=n},PathVisibilityGraph$$:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",get_PathVisibilityGraph:function(){return this._PathVisibilityGraph},set_PathVisibilityGraph:function(n){this._PathVisibilityGraph=n},AncestorsSets$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Routing.Shape],[Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Routing.Shape]]]]",get_AncestorsSets:function(){return this._AncestorsSets},set_AncestorsSets:function(n){this._AncestorsSets=n},MapPathsToTheirObstacles:function(){var n,t;for(this.set_PathToObstacles(new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,System.Tuple$2.ctor)),n=this.get_Paths().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.MapPathToItsObstacles(t)},MapPathToItsObstacles:function(n){var t=this.get_HierarchyOfObstacles().FirstHitNode$$Point$$Func$3(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_PathPoints()),Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.ObstacleTest),i=this.get_HierarchyOfObstacles().FirstHitNode$$Point$$Func$3(System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_PathPoints()),Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.ObstacleTest);null!=t&&null!=i&&this.get_PathToObstacles().set_Item$$TKey(n,new System.Tuple$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,t.get_UserData(),i.get_UserData()))},HierarchyOfObstacles$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_HierarchyOfObstacles:function(){return this._HierarchyOfObstacles},set_HierarchyOfObstacles:function(n){this._HierarchyOfObstacles=n},HierarchyOfGroups$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[Microsoft.Msagl.Routing.Shape]]",get_HierarchyOfGroups:function(){return this._HierarchyOfGroups},set_HierarchyOfGroups:function(n){this._HierarchyOfGroups=n},Calculate:function(n,t){this.set_NudgingDirection(n);Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.RefinePaths(this.get_Paths(),t);this.GetPathOrdersAndPathGraph();this.MapAxisEdgesToTheirObstacles();this.DrawPaths()},MapAxisEdgesToTheirObstacles:function(){var t,i,n;for(this.axisEdgesToObstaclesTheyOriginatedFrom=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),t=this.get_Paths().GetEnumerator();t.MoveNext();)n=t.get_Current(),this.MapPathEndAxisEdgesToTheirObstacles(n);for(i=this.get_Paths().GetEnumerator();i.MoveNext();)n=i.get_Current(),this.UmmapPathInteriourFromStrangerObstacles(n)},UmmapPathInteriourFromStrangerObstacles:function(n){var i=this.FindFirstUnmappedEdge(n),r,t;if(i!=null)for(r=this.FindLastUnmappedEdge(n),t=i;t!=null&&t!=r;t=t.get_Next())this.axisEdgesToObstaclesTheyOriginatedFrom.Remove(t.get_AxisEdge())},FindLastUnmappedEdge:function(n){for(var t=n.get_LastEdge();t!=null;t=t.get_Prev())if(t.get_AxisEdge().get_Direction()!=this.get_NudgingDirection())return t;return null},FindFirstUnmappedEdge:function(n){for(var t=n.get_FirstEdge();t!=null;t=t.get_Next())if(t.get_AxisEdge().get_Direction()!=this.get_NudgingDirection())return t;return null},MapPathEndAxisEdgesToTheirObstacles:function(n){var t;(function(){var i={Value:t},r=this.get_PathToObstacles().TryGetValue(n,i);return t=i.Value,r}).call(this)&&(this.ProcessThePathStartToMapAxisEdgesToTheirObstacles(n,t.get_Item1()),this.ProcessThePathEndToMapAxisEdgesToTheirObstacles(n,t.get_Item2()))},ProcessThePathEndToMapAxisEdgesToTheirObstacles:function(n,t){for(var i=n.get_LastEdge();i!=null&&Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsAreParallel(i.get_Direction(),this.get_NudgingDirection());i=i.get_Prev())this.axisEdgesToObstaclesTheyOriginatedFrom.set_Item$$TKey(i.get_AxisEdge(),t)},ProcessThePathStartToMapAxisEdgesToTheirObstacles:function(n,t){for(var i=n.get_FirstEdge();i!=null&&Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsAreParallel(i.get_Direction(),this.get_NudgingDirection());i=i.get_Next())this.axisEdgesToObstaclesTheyOriginatedFrom.set_Item$$TKey(i.get_AxisEdge(),t)},GetPathOrdersAndPathGraph:function(){var n=new Microsoft.Msagl.Routing.Rectilinear.Nudging.CombinatorialNudger.ctor(this.get_Paths());this.set_PathOrders(n.GetOrder());this.set_PathVisibilityGraph(n.get_PathVisibilityGraph())},NudgingDirection$$:"Microsoft.Msagl.Core.Geometry.Directions",get_NudgingDirection:function(){return this._NudgingDirection},set_NudgingDirection:function(n){this._NudgingDirection=n},DrawPaths:function(){this.SetWidthsOfArrowheads();this.CreateLongestNudgedSegments();this.FindFreeSpaceInDirection(System.Linq.Enumerable.Cast$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor,this.get_PathVisibilityGraph().get_Edges()));this.MoveLongestSegsIdealPositionsInsideFeasibleIntervals();this.PositionShiftedEdges()},SetWidthsOfArrowheads:function(){for(var n=this.get_Paths().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.SetWidthsOfArrowheadsForEdge(t)},EdgeSeparation$$:"System.Double",get_EdgeSeparation:function(){return this._EdgeSeparation},set_EdgeSeparation:function(n){this._EdgeSeparation=n},PositionShiftedEdges:function(){var n,t;for(this.set_Solver(new Microsoft.Msagl.Core.ProjectionSolver.UniformOneDimensionalSolver.ctor(this.get_EdgeSeparation())),n=this.get_LongestNudgedSegs().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.CreateVariablesOfLongestSegment(t);this.CreateConstraintsOfTheOrder();this.CreateConstraintsBetweenLongestSegments();this.get_Solver().Solve();this.ShiftPathEdges()},MoveLongestSegsIdealPositionsInsideFeasibleIntervals:function(){for(var n=this.get_LongestNudgedSegs().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.MoveLongestSegIdealPositionsInsideFeasibleInterval(t)},ShiftPathEdges:function(){for(var t=this.get_Paths().GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),n.set_PathPoints(System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,this.GetShiftedPoints(n)))},GetShiftedPoints:function(n){return Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.RemoveSwitchbacksAndMiddlePoints(this.GetShiftedPointsSimple(n))},GetShiftedPointsSimple:function(n){var t=[],r=n.get_FirstEdge(),i,u;for(t.push(this.ShiftedPoint(r.get_Source(),r.get_LongestNudgedSegment())),i=n.get_PathEdges().GetEnumerator();i.MoveNext();)u=i.get_Current(),t.push(this.ShiftedEdgePositionOfTarget(u));return t},ShiftedEdgePositionOfTarget:function(n){return n.get_LongestNudgedSegment()!=null||n.get_Next()==null?this.ShiftedPoint(n.get_Target(),n.get_LongestNudgedSegment()):this.ShiftedPoint(n.get_Next().get_Source(),n.get_Next().get_LongestNudgedSegment())},ShiftedPoint:function(n,t){if(t==null)return n;var i=this.get_Solver().GetVariablePosition(t.Id);return this.get_NudgingDirection()==Microsoft.Msagl.Core.Geometry.Directions.North?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i,n.get_Y()):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_X(),-i)},CreateConstraintsBetweenLongestSegments:function(){for(var n=this.get_LongestNudgedSegs().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.CreateConstraintsBetweenLongestSegmentsForSegment(t)},CreateConstraintsBetweenLongestSegmentsForSegment:function(n){for(var f=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.LongestNudgedSegment.ctor),e=n.get_Edges().GetEnumerator(),o,t,i,s,r,h,u,c;e.MoveNext();)if(o=e.get_Current(),t=o.get_AxisEdge(),t!=null)for(i=t.RightNeighbors.GetEnumerator();i.MoveNext();)for(s=i.get_Current(),r=s.get_LongestNudgedSegments().GetEnumerator();r.MoveNext();)h=r.get_Current(),f.Insert(h);for(u=f.GetEnumerator();u.MoveNext();)c=u.get_Current(),this.ConstraintTwoLongestSegs(n,c)},CreateConstraintsOfTheOrder:function(){for(var t=this.get_PathOrders().GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.ParallelToDirection(n.get_Key(),this.get_NudgingDirection())&&this.CreateConstraintsOfThePathOrder(n.get_Value())},CreateConstraintsOfThePathOrder:function(n){for(var t=null,r=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge.ctor,n,$CreateAnonymousDelegate(this,function(n){return n.get_LongestNudgedSegment()!=null})).GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),t!=null&&this.ConstraintTwoLongestSegs(t.get_LongestNudgedSegment(),i.get_LongestNudgedSegment()),t=i},ConstraintTwoLongestSegs:function(n,t){n.get_IsFixed()&&t.get_IsFixed()||this.get_Solver().AddConstraint(n.Id,t.Id)},Solver$$:"Microsoft.Msagl.Core.ProjectionSolver.UniformOneDimensionalSolver",get_Solver:function(){return this._Solver},set_Solver:function(n){this._Solver=n},CreateVariablesOfLongestSegment:function(n){if(n.get_IsFixed())this.get_Solver().AddFixedVariable(n.Id,Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.SegmentPosition(n,this.get_NudgingDirection()));else{var t=n.GetLeftBound(),i=n.GetRightBound();t>=i?(this.get_Solver().AddFixedVariable(n.Id,Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.SegmentPosition(n,this.get_NudgingDirection())),n.set_IsFixed(!0)):(this.get_Solver().AddVariable$$Int32$$Double$$Double$$Double(n.Id,Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.SegmentPosition(n,this.get_NudgingDirection()),n.get_IdealPosition(),n.get_Width()),t!=-Infinity&&this.get_Solver().SetLowBound(t,n.Id),i!=Infinity&&this.get_Solver().SetUpperBound(n.Id,i))}},LongestNudgedSegs$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.LongestNudgedSegment]]",get_LongestNudgedSegs:function(){return this._LongestNudgedSegs},set_LongestNudgedSegs:function(n){this._LongestNudgedSegs=n},PathOrders$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge],[System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge]]]]",get_PathOrders:function(){return this._PathOrders},set_PathOrders:function(n){this._PathOrders=n},PathToObstacles$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Routing.Rectilinear.Nudging.Path],[System.Tuple`2[[Microsoft.Msagl.Core.Geometry.Curves.Polyline],[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]]]",get_PathToObstacles:function(){return this._PathToObstacles},set_PathToObstacles:function(n){this._PathToObstacles=n},FindFreeSpaceInDirection:function(n){this.BoundAxisEdgesByRectsKnownInAdvance();var t=new Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.ctor(this.get_NudgingDirection(),this.get_Obstacles(),this.axisEdgesToObstaclesTheyOriginatedFrom,this.get_PathOrders(),n);t.FindFreeSpace()},BoundAxisEdgesByRectsKnownInAdvance:function(){for(var t=this.get_Paths().GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),this.get_HasGroups()&&this.BoundPathByMinCommonAncestors(n),this.BoundAxisEdgesAdjacentToSourceAndTargetOnEdge(n)},BoundPathByMinCommonAncestors:function(n){for(var i=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.Rectangle.ctor,this.GetMinCommonAncestors(n.get_EdgeGeometry()),$CreateAnonymousDelegate(this,function(n){return n.get_BoundingBox()})).GetEnumerator(),r,t,u;i.MoveNext();)for(r=i.get_Current(),t=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge.ctor,n.get_PathEdges(),$CreateAnonymousDelegate(this,function(n){return n.get_AxisEdge()})),$CreateAnonymousDelegate(this,function(n){return n.get_Direction()==this.get_NudgingDirection()})).GetEnumerator();t.MoveNext();)u=t.get_Current(),this.BoundAxisEdgeByRect(r,u)},GetMinCommonAncestors:function(n){this.get_PortToShapes()==null&&this.set_PortToShapes(Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.MapPortsToShapes(this.get_AncestorsSets().get_Keys()));var t=Microsoft.Msagl.Core.DataStructures.Set$1.op_Multiply(this.AncestorsForPort(n.get_SourcePort()),this.AncestorsForPort(n.get_TargetPort()));return System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,t,$CreateAnonymousDelegate(this,function(n){return!System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,n.get_Children(),$CreateAnonymousDelegate(this,function(n){return t.Contains$$T(n)}))}))},PortToShapes$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.Layout.Port],[Microsoft.Msagl.Routing.Shape]]",get_PortToShapes:function(){return this._PortToShapes},set_PortToShapes:function(n){this._PortToShapes=n},AncestorsForPort:function(n){var t;return function(){var i={Value:t},r=this.get_PortToShapes().TryGetValue(n,i);return t=i.Value,r}.call(this)?this.get_AncestorsSets().get_Item$$TKey(t):new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,this.get_HierarchyOfGroups().AllHitItems$$Rectangle$$Func$2(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n.get_Location(),n.get_Location()),null))},BoundAxisEdgeAdjacentToObstaclePort:function(n,t){var i,r;Is(n,Microsoft.Msagl.Routing.Rectilinear.WaypointPort.ctor)||n.get_Curve()==null&&n.get_PortEntry()==null?this.BoundAxisByPoint(n.get_Location(),t):n.get_PortEntry()==null?n.get_Curve().get_BoundingBox().Contains$$Point(n.get_Location())&&this.BoundAxisEdgeByRect(n.get_Curve().get_BoundingBox(),t):(i=As(n.get_PortEntry(),Microsoft.Msagl.Core.Layout.PortEntryOnCurve.ctor),i!=null&&function(){var n={Value:r},u=Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.FindPortEntryRectCrossingAxisEdge(i,t,n);return r=n.Value,u}.call(this)&&this.BoundAxisEdgeByRect(r,t))},BoundAxisByPoint:function(n,t){t!=null&&t.get_Direction()==this.get_NudgingDirection()&&(this.get_NudgingDirection()==Microsoft.Msagl.Core.Geometry.Directions.North?(t.BoundFromLeft(n.get_X()),t.BoundFromRight(n.get_X())):(t.BoundFromLeft(-n.get_Y()),t.BoundFromRight(-n.get_Y())))},BoundAxisEdgesAdjacentToSourceAndTargetOnEdge:function(n){this.BoundAxisEdgeAdjacentToObstaclePort(n.get_EdgeGeometry().get_SourcePort(),n.get_FirstEdge().get_AxisEdge());this.BoundAxisEdgeAdjacentToObstaclePort(n.get_EdgeGeometry().get_TargetPort(),n.get_LastEdge().get_AxisEdge())},BoundAxisEdgeByRect:function(n,t){t!=null&&t.get_Direction()==this.get_NudgingDirection()&&(this.get_NudgingDirection()==Microsoft.Msagl.Core.Geometry.Directions.North?(t.BoundFromLeft(n.get_Left()),t.BoundFromRight(n.get_Right())):(t.BoundFromLeft(-n.get_Top()),t.BoundFromRight(-n.get_Bottom())))},CreateLongestNudgedSegments:function(){var i=this.get_NudgingDirection()==Microsoft.Msagl.Core.Geometry.Directions.East?Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.MinusY:Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.X,n,t;for(this.set_LongestNudgedSegs(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.LongestNudgedSegment.ctor)),n=this.get_Paths().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.CreateLongestNudgedSegmentsForPath(t,i)},CreateLongestNudgedSegmentsForPath:function(n,t){this.GoOverPathAndCreateLongSegs(n);Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.CalculateIdealPositionsForLongestSegs(n,t)},GoOverPathAndCreateLongSegs:function(n){for(var i=null,f=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(this.get_NudgingDirection()),u=n.get_PathEdges().GetEnumerator(),t,r;u.MoveNext();)t=u.get_Current(),r=t.get_Direction(),r==this.get_NudgingDirection()||r==f?(i==null?(t.set_LongestNudgedSegment(i=new Microsoft.Msagl.Routing.Rectilinear.Nudging.LongestNudgedSegment.ctor(this.get_LongestNudgedSegs().get_Count())),this.get_LongestNudgedSegs().Add(t.get_LongestNudgedSegment())):t.set_LongestNudgedSegment(i),t.get_IsFixed()&&i.set_IsFixed(!0)):(t.set_LongestNudgedSegment(null),i=null)},RemoveStaircases:function(){Microsoft.Msagl.Routing.Rectilinear.Nudging.StaircaseRemover.RemoveStaircases(this.get_Paths(),this.get_HierarchyOfObstacles())}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$Nudger);Microsoft$Msagl$Routing$Rectilinear$Nudging$PointProjection={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.PointProjection",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$PointProjection);Microsoft$Msagl$Core$ProjectionSolver$UniformOneDimensionalSolver={fullname:"Microsoft.Msagl.Core.ProjectionSolver.UniformOneDimensionalSolver",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.idealPositions=new System.Collections.Generic.Dictionary$2.ctor(System.Int32.ctor,System.Double.ctor);this.varSepartion=0;this.varList=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.ProjectionSolver.UniformSolverVar.ctor);this.constraints=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor);this.graph=null;this.solverShell=new Microsoft.Msagl.Core.ProjectionSolver.SolverShell.ctor;this.boundsToInt=new System.Collections.Generic.Dictionary$2.ctor(System.Double.ctor,System.Int32.ctor);System.Object.ctor.call(this);this.varSepartion=n},SetLowBound:function(n,t){var i=this.Var(t);i.set_LowBound(System.Math.Max$$Double$$Double(n,i.get_LowBound()))},Var:function(n){return this.varList.get_Item$$Int32(n)},SetUpperBound:function(n,t){var i=this.Var(n);i.set_UpperBound(System.Math.Min$$Double$$Double(t,i.get_UpperBound()))},Solve:function(){this.SolveByRegularSolver()},SolveByRegularSolver:function(){var t,u,i,r,n;for(this.CreateVariablesForBounds(),n=0;n<this.varList.get_Count();n++)t=this.varList.get_Item$$Int32(n),t.IsFixed?this.solverShell.AddFixedVariable(n,t.get_Position()):(this.solverShell.AddVariableWithIdealPosition$$Int32$$Double(n,this.idealPositions.get_Item$$TKey(n)),t.get_LowBound()!=-Infinity&&this.constraints.Insert(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(this.GetBoundId(t.get_LowBound()),n)),t.get_UpperBound()!=Infinity&&this.constraints.Insert(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n,this.GetBoundId(t.get_UpperBound()))));for(this.CreateGraphAndRemoveCycles(),u=this.graph.get_Edges().GetEnumerator();u.MoveNext();)i=u.get_Current(),r=0,i.get_First()<this.varList.get_Count()&&(r+=this.varList.get_Item$$Int32(i.get_First()).get_Width()),i.get_Second()<this.varList.get_Count()&&(r+=this.varList.get_Item$$Int32(i.get_Second()).get_Width()),r/=2,this.solverShell.AddLeftRightSeparationConstraint$$Int32$$Int32$$Double(i.get_First(),i.get_Second(),this.varSepartion+r);for(this.solverShell.Solve(),n=0;n<this.varList.get_Count();n++)this.varList.get_Item$$Int32(n).set_Position(this.solverShell.GetVariableResolvedPosition(n))},GetBoundId:function(n){return this.boundsToInt.get_Item$$TKey(n)},CreateVariablesForBounds:function(){for(var t=this.varList.GetEnumerator(),n;t.MoveNext();)(n=t.get_Current(),n.IsFixed)||(n.get_LowBound()!=-Infinity&&this.RegisterBoundVar(n.get_LowBound()),n.get_UpperBound()!=Infinity&&this.RegisterBoundVar(n.get_UpperBound()))},RegisterBoundVar:function(n){if(!this.boundsToInt.ContainsKey(n)){var t=this.varList.get_Count()+this.boundsToInt.get_Count();this.boundsToInt.set_Item$$TKey(n,t);this.solverShell.AddFixedVariable(t,n)}},CreateGraphAndRemoveCycles:function(){var n,t,i;if(this.graph=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.constraints,this.varList.get_Count()+this.boundsToInt.get_Count()),n=Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval$1.GetFeedbackSet(this.graph),n!=null)for(t=n.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.graph.RemoveEdge(As(i,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor))},GetVariablePosition:function(n){return this.varList.get_Item$$Int32(n).get_Position()},AddConstraint:function(n,t){this.constraints.Insert(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n,t))},AddVariable$$Int32$$Double$$Double$$Double:function(n,t,i,r){this.idealPositions.set_Item$$TKey(n,i);this.AddVariable$$Int32$$Double$$Boolean$$Double(n,t,!1,r)},AddFixedVariable:function(n,t){this.AddVariable$$Int32$$Double$$Boolean$$Double(n,t,!0,0)},AddVariable$$Int32$$Double$$Boolean$$Double:function(n,t,i,r){System.Diagnostics.Debug.Assert$$Boolean(n==this.varList.get_Count());this.varList.Add(function(){var n=new Microsoft.Msagl.Core.ProjectionSolver.UniformSolverVar.ctor;return n.IsFixed=i,n.set_Position(t),n.set_Width(r),n}.call(this))}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$UniformOneDimensionalSolver);Microsoft$Msagl$Routing$Rectilinear$Nudging$LinkedPoint={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor:function(n){this._Point=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._Next=null;System.Object.ctor.call(this);this.set_Point(n)},Point$$:"Microsoft.Msagl.Core.Geometry.Point",get_Point:function(){return this._Point},set_Point:function(n){this._Point=n},Next$$:"Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint",get_Next:function(){return this._Next},set_Next:function(n){this._Next=n},GetEnumerator:function(){for(var t=[],n=this;n!=null;n=n.get_Next())t.push(n.get_Point());return t.GetEnumerator()},X$$:"System.Double",get_X:function(){return this.get_Point().get_X()},Y$$:"System.Double",get_Y:function(){return this.get_Point().get_Y()},InsertVerts:function(n,t,i){for(t--;n<t;t--)this.SetNewNext(i[t])},InsertVertsInReverse:function(n,t,i){for(n++;n<t;n++)this.SetNewNext(i[n])},SetNewNext:function(n){var t=new Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor(n),i=this.get_Next();this.set_Next(t);t.set_Next(i);System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Point$$Point(this.get_Point(),this.get_Next().get_Point()))}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$LinkedPoint);Microsoft$Msagl$Routing$Rectilinear$Nudging$PathRefiner={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.DigitsToRound=Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_DistanceEpsilonPrecision()},RefinePaths:function(n,t){Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.AdjustPaths(n);var i=Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.CreatePathsToFirstLinkedVerticesMap(n);Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.Refine(i.get_Values());Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.CrossVerticalAndHorizontalSegs(i.get_Values());Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.ReconstructPathsFromLinkedVertices(i);t&&new Microsoft.Msagl.Routing.Rectilinear.Nudging.PathMerger.ctor(n).MergePaths()},AdjustPaths:function(n){for(var i=n.GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),t.set_PathPoints(System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.AdjustPathPoints(System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,t.get_PathPoints(),function(n){return n.Clone()})))))},AdjustPathPoints:function(n){var r=[],t=Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.AdjustPoint(n.get_Item$$Int32(0)),i,u;for(r.push(t),i=1;i<System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n);i++)u=Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.AdjustPoint(n.get_Item$$Int32(i)),Microsoft.Msagl.Core.Geometry.Point.op_Inequality(t,u)&&(t=u,r.push(t));return r},AdjustPoint:function(n){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Round$$Double$$Int32(n.get_X(),Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.DigitsToRound),System.Math.Round$$Double$$Int32(n.get_Y(),Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.DigitsToRound))},CrossVerticalAndHorizontalSegs:function(n){for(var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor),r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor),u=n.GetEnumerator(),f,t;u.MoveNext();)for(f=u.get_Current(),t=f;t.get_Next()!=null;t=t.get_Next())Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(t.get_Point().get_X(),t.get_Next().get_Point().get_X())?r.Add(t):i.Add(t);new Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPointSplitter.ctor(i,r).SplitPoints()},ReconstructPathsFromLinkedVertices:function(n){for(var i=n.GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),t.get_Key().set_PathPoints(t.get_Value())},Refine:function(n){Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.RefineInDirection(Microsoft.Msagl.Core.Geometry.Directions.North,n);Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.RefineInDirection(Microsoft.Msagl.Core.Geometry.Directions.East,n)},RefineInDirection:function(n,t){var r,i,f;(function(){var t={Value:i},u={Value:r},f=Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.GetProjectionsDelegates(n,t,u);return i=t.Value,r=u.Value,f})();for(var e=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.GetAllLinkedVertsInDirection(i,t)),o=System.Linq.Enumerable.GroupBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor,System.Double.ctor,e,function(n){return i(n.get_Point())}),u=o.GetEnumerator();u.MoveNext();)f=u.get_Current(),Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.RefineCollinearBucket(f,r)},GetProjectionsDelegates:function(n,t,i){n==Microsoft.Msagl.Core.Geometry.Directions.East?(i.Value=function(n){return n.get_X()},t.Value=function(n){return n.get_Y()}):(t.Value=function(n){return n.get_X()},i.Value=function(n){return n.get_Y()})},GetAllLinkedVertsInDirection:function(n,t){for(var r=[],u=t.GetEnumerator(),f,i;u.MoveNext();)for(f=u.get_Current(),i=f;i.get_Next()!=null;i=i.get_Next())Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n(i.get_Point()),n(i.get_Next().get_Point()))&&r.push(i);return r},RefineCollinearBucket:function(n,t){for(var i=new System.Collections.Generic.SortedDictionary$2.ctor$$IComparer$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Int32.ctor,new Microsoft.Msagl.Routing.Rectilinear.Nudging.PointByDelegateComparer.ctor(t)),h=n.GetEnumerator(),u,l,o,e,s;h.MoveNext();)u=h.get_Current(),i.ContainsKey(u.get_Point())||i.set_Item$$TKey(u.get_Point(),0),i.ContainsKey(u.get_Next().get_Point())||i.set_Item$$TKey(u.get_Next().get_Point(),0);for(var f=new Array(i.get_Count()),r=0,c=i.get_Keys().GetEnumerator();c.MoveNext();)l=c.get_Current(),f[r++]=l;for(r=0;r<f.length;r++)i.set_Item$$TKey(f[r],r);for(o=n.GetEnumerator();o.MoveNext();)e=o.get_Current(),r=i.get_Item$$TKey(e.get_Point()),s=i.get_Item$$TKey(e.get_Next().get_Point()),System.Math.Abs$$Int32(s-r)>1&&Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.InsertPoints(e,f,r,s)},InsertPoints:function(n,t,i,r){i<r?n.InsertVerts(i,r,t):n.InsertVertsInReverse(r,i,t)},CreatePathsToFirstLinkedVerticesMap:function(n){for(var i=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor),r=n.GetEnumerator(),t;r.MoveNext();)t=r.get_Current(),i.set_Item$$TKey(t,Microsoft.Msagl.Routing.Rectilinear.Nudging.PathRefiner.CreateLinkedVertexOfEdgePath(t));return i},CreateLinkedVertexOfEdgePath:function(n){var t=new Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_PathPoints())),i=t;return System.Linq.Enumerable.Aggregate$2$$IEnumerable$1$$TAccumulate$$Func$3(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor,System.Linq.Enumerable.Skip$1(Microsoft.Msagl.Core.Geometry.Point.ctor,n.get_PathPoints(),1),t,function(n,t){return n.set_Next(new Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor(t)),n.get_Next()}),i}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$PathRefiner);Microsoft$Msagl$Routing$Rectilinear$Nudging$PointByDelegateComparer={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.PointByDelegateComparer",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.projection=null;System.Object.ctor.call(this);this.projection=n},Compare:function(n,t){return this.projection(n).CompareTo$$Double(this.projection(t))}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$PointByDelegateComparer);Microsoft$Msagl$Core$ProjectionSolver$UniformSolverVar={fullname:"Microsoft.Msagl.Core.ProjectionSolver.UniformSolverVar",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.lowBound=-Infinity;this.upperBound=Infinity;this.IsFixed=!1;this.position=0;this._Width=0;System.Object.ctor.call(this)},Width$$:"System.Double",get_Width:function(){return this._Width},set_Width:function(n){this._Width=n},Position$$:"System.Double",get_Position:function(){return this.position},set_Position:function(n){this.position=n<this.lowBound?this.lowBound:n>this.upperBound?this.upperBound:n},LowBound$$:"System.Double",get_LowBound:function(){return this.lowBound},set_LowBound:function(n){System.Diagnostics.Debug.Assert$$Boolean(n<=this.upperBound);this.lowBound=n},UpperBound$$:"System.Double",get_UpperBound:function(){return this.upperBound},set_UpperBound:function(n){System.Diagnostics.Debug.Assert$$Boolean(n>=this.get_LowBound());this.upperBound=n}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$UniformSolverVar);Microsoft$Msagl$Routing$Rectilinear$Nudging$SpaceCalculationEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.SpaceCalculationEvent",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$SpaceCalculationEvent);Microsoft$Msagl$Routing$Rectilinear$Nudging$PathEdge={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge",baseTypeName:"System.Object",staticDefinition:{VectorsAreParallel:function(n,t){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n.get_X()*t.get_Y()-n.get_Y()*t.get_X(),0)},EdgesAreParallel:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge.VectorsAreParallel(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_AxisEdge().get_TargetPoint(),n.get_AxisEdge().get_SourcePoint()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_AxisEdge().get_TargetPoint(),t.get_AxisEdge().get_SourcePoint()))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.longestNudgedSegment=null;this.index=-1;this._AxisEdge=null;this._Next=null;this._Prev=null;this._Width=0;this._Path=null;this._IsFixed=!1;this._Reversed=!1;System.Object.ctor.call(this);this.set_AxisEdge(n);this.set_Width(t)},AxisEdge$$:"Microsoft.Msagl.Routing.Rectilinear.Nudging.AxisEdge",get_AxisEdge:function(){return this._AxisEdge},set_AxisEdge:function(n){this._AxisEdge=n},Next$$:"Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge",get_Next:function(){return this._Next},set_Next:function(n){this._Next=n},Prev$$:"Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge",get_Prev:function(){return this._Prev},set_Prev:function(n){this._Prev=n},Width$$:"System.Double",get_Width:function(){return this._Width},set_Width:function(n){this._Width=n},Path$$:"Microsoft.Msagl.Routing.Rectilinear.Nudging.Path",get_Path:function(){return this._Path},set_Path:function(n){this._Path=n},LongestNudgedSegment$$:"Microsoft.Msagl.Routing.Rectilinear.Nudging.LongestNudgedSegment",get_LongestNudgedSegment:function(){return this.longestNudgedSegment},set_LongestNudgedSegment:function(n){this.longestNudgedSegment=n;this.longestNudgedSegment!=null&&(this.longestNudgedSegment.AddEdge(this),this.get_AxisEdge().AddLongestNudgedSegment(this.longestNudgedSegment))},IsFixed$$:"System.Boolean",get_IsFixed:function(){return this._IsFixed},set_IsFixed:function(n){this._IsFixed=n},Source$$:"Microsoft.Msagl.Core.Geometry.Point",get_Source:function(){return this.get_Reversed()?this.get_AxisEdge().get_TargetPoint():this.get_AxisEdge().get_SourcePoint()},Target$$:"Microsoft.Msagl.Core.Geometry.Point",get_Target:function(){return this.get_Reversed()?this.get_AxisEdge().get_SourcePoint():this.get_AxisEdge().get_TargetPoint()},Direction$$:"Microsoft.Msagl.Core.Geometry.Directions",get_Direction:function(){return this.get_Reversed()?Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(this.get_AxisEdge().get_Direction()):this.get_AxisEdge().get_Direction()},Reversed$$:"System.Boolean",get_Reversed:function(){return this._Reversed},set_Reversed:function(n){this._Reversed=n},Index$$:"System.Int32",get_Index:function(){return this.index},set_Index:function(n){this.index=n}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$PathEdge);Microsoft$Msagl$Routing$Rectilinear$Nudging$LongestNudgedSegment={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.LongestNudgedSegment",baseTypeName:"Microsoft.Msagl.Routing.Visibility.SegmentBase",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.edges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge.ctor);this.start=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.end=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.isFixed=!1;this.Id=-1;this._CompassDirection=Microsoft.Msagl.Core.Geometry.Directions.None;this._IdealPosition=0;Microsoft.Msagl.Routing.Visibility.SegmentBase.ctor.call(this);this.Id=n},CompassDirection$$:"Microsoft.Msagl.Core.Geometry.Directions",get_CompassDirection:function(){return this._CompassDirection},set_CompassDirection:function(n){this._CompassDirection=n},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.start},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.end},Edges$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge]]",get_Edges:function(){return this.edges},AddEdge:function(n){if(this.get_Edges().get_Count()==0){var t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Target(),n.get_Source()).get_CompassDirection();switch(t){case Microsoft.Msagl.Core.Geometry.Directions.South:t=Microsoft.Msagl.Core.Geometry.Directions.North;break;case Microsoft.Msagl.Core.Geometry.Directions.West:t=Microsoft.Msagl.Core.Geometry.Directions.East}this.set_CompassDirection(t);this.start=n.get_Source();this.end=n.get_Source()}switch(this.get_CompassDirection()){case Microsoft.Msagl.Core.Geometry.Directions.North:this.TryPointForStartAndEndNorth(n.get_Source());this.TryPointForStartAndEndNorth(n.get_Target());break;case Microsoft.Msagl.Core.Geometry.Directions.East:this.TryPointForStartAndEndEast(n.get_Source());this.TryPointForStartAndEndEast(n.get_Target())}this.get_Edges().Add(n)},TryPointForStartAndEndNorth:function(n){n.get_Y()<this.start.get_Y()?this.start=n:n.get_Y()>this.end.get_Y()&&(this.end=n)},TryPointForStartAndEndEast:function(n){n.get_X()<this.start.get_X()?this.start=n:n.get_X()>this.end.get_X()&&(this.end=n)},IsFixed$$:"System.Boolean",get_IsFixed:function(){return this.isFixed},set_IsFixed:function(n){this.isFixed=n},Width$$:"System.Double",get_Width:function(){return System.Linq.Enumerable.Max$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge.ctor,this.edges,$CreateAnonymousDelegate(this,function(n){return n.get_Width()}))},GetLeftBound:function(){return this.get_IsFixed()?this.get_CompassDirection()==Microsoft.Msagl.Core.Geometry.Directions.North?this.get_Edges().get_Item$$Int32(0).get_Source().get_X():-this.get_Edges().get_Item$$Int32(0).get_Source().get_Y():System.Linq.Enumerable.Max$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge.ctor,this.get_Edges(),$CreateAnonymousDelegate(this,function(n){return n.get_AxisEdge().get_LeftBound()}))},GetRightBound:function(){return this.get_IsFixed()?this.Position():System.Linq.Enumerable.Min$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge.ctor,this.get_Edges(),$CreateAnonymousDelegate(this,function(n){return n.get_AxisEdge().get_RightBound()}))},Position:function(){return this.get_CompassDirection()==Microsoft.Msagl.Core.Geometry.Directions.North?this.get_Edges().get_Item$$Int32(0).get_Source().get_X():-this.get_Edges().get_Item$$Int32(0).get_Source().get_Y()},IdealPosition$$:"System.Double",get_IdealPosition:function(){return this._IdealPosition},set_IdealPosition:function(n){this._IdealPosition=n}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$LongestNudgedSegment);Microsoft$Msagl$Routing$Rectilinear$Nudging$Path={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.Path",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this._EdgeGeometry=null;this._PathPoints=null;this._FirstEdge=null;this._LastEdge=null;System.Object.ctor.call(this);this.set_EdgeGeometry(n)},EdgeGeometry$$:"Microsoft.Msagl.Core.Layout.EdgeGeometry",get_EdgeGeometry:function(){return this._EdgeGeometry},set_EdgeGeometry:function(n){this._EdgeGeometry=n},PathPoints$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_PathPoints:function(){return this._PathPoints},set_PathPoints:function(n){this._PathPoints=n},Width$$:"System.Double",get_Width:function(){return this.get_EdgeGeometry().get_LineWidth()},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.get_LastEdge().get_Target()},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.get_FirstEdge().get_Source()},PathEdges$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge]]",get_PathEdges:function(){for(var t=[],n=this.get_FirstEdge();n!=null;n=n.get_Next())t.push(n);return t},FirstEdge$$:"Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge",get_FirstEdge:function(){return this._FirstEdge},set_FirstEdge:function(n){this._FirstEdge=n},LastEdge$$:"Microsoft.Msagl.Routing.Rectilinear.Nudging.PathEdge",get_LastEdge:function(){return this._LastEdge},set_LastEdge:function(n){this._LastEdge=n},AddEdge:function(n){n.set_Path(this);System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Source(),this.get_LastEdge().get_Target()));this.get_LastEdge().set_Next(n);n.set_Prev(this.get_LastEdge());this.set_LastEdge(n)},SetFirstEdge:function(n){this.set_LastEdge(function(n){return this.set_FirstEdge(n),n}.call(this,n));n.set_Path(this)},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0}->{1}",[this.get_EdgeGeometry().get_SourcePort().get_Location(),this.get_EdgeGeometry().get_TargetPort().get_Location()])}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$Path);Microsoft$Msagl$Core$Geometry$RectangleNode$1={fullname:"Microsoft.Msagl.Core.Geometry.RectangleNode$1",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Geometry.RectangleNode$1.GroupSplitThreshold=2},VisitTreeStatic:function(n,t,i){return n.get_Rectangle().Intersects(i)?t(n.get_UserData())==Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue?n.get_Left()!=null?Microsoft.Msagl.Core.Geometry.RectangleNode$1.VisitTreeStatic(n.get_Left(),t,i)==Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue&&Microsoft.Msagl.Core.Geometry.RectangleNode$1.VisitTreeStatic(n.get_Right(),t,i)==Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue?Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop:Microsoft.Msagl.Core.Geometry.HitTestBehavior.Continue},CreateRectangleNodeOnEnumeration:function(n){if(n==null)return null;var t=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n);return Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnListOfNodes(t)},CreateRectangleNodeOnData:function(n,t){if(n==null||t==null)return null;var i=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(this.TData,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(this.TData,n,t(n))}));return Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnListOfNodes(i)},CreateRectangleNodeOnListOfNodes:function(n){var i,r;if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"nodes"),n.get_Count()==0)return null;if(n.get_Count()==1)return n.get_Item$$Int32(0);var o=n.get_Item$$Int32(0).get_Rectangle(),t=1,u=function(){var i={Value:o},r={Value:t},u=Microsoft.Msagl.Core.Geometry.RectangleNode$1.ChooseSeeds(n,i,r);return o=i.Value,t=r.Value,u}(),f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor),e=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor);return f.Add(n.get_Item$$Int32(t)),e.Add(n.get_Item$$Int32(u)),i=n.get_Item$$Int32(t).get_Rectangle(),r=n.get_Item$$Int32(u).get_Rectangle(),function(){var o={Value:i},s={Value:r},h=Microsoft.Msagl.Core.Geometry.RectangleNode$1.DivideNodes(n,t,u,f,e,o,s,2);return i=o.Value,r=s.Value,h}(),function(){var t=new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$Int32(this.TData,n.get_Count());return t.set_Rectangle(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(i,r)),t.set_Left(Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnListOfNodes(f)),t.set_Right(Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnListOfNodes(e)),t}()},ChooseSeeds:function(n,t,i){for(var e,f,o,u=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(t.Value,n.get_Item$$Int32(i.Value).get_Rectangle()).get_Area(),r=2;r<n.get_Count();r++)e=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(t.Value,n.get_Item$$Int32(r).get_Rectangle()).get_Area(),e>u&&(i.Value=r,u=e);for(f=0,r=0;r<n.get_Count();r++)if(r!=i.Value){f=r;break}for(u=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(n.get_Item$$Int32(i.Value).get_Rectangle(),n.get_Item$$Int32(f).get_Rectangle()).get_Area(),r=0;r<n.get_Count();r++)r!=i.Value&&(o=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(n.get_Item$$Int32(i.Value).get_Rectangle(),n.get_Item$$Int32(r).get_Rectangle()).get_Area(),o>u&&(f=r,u=o));return f},DivideNodes:function(n,t,i,r,u,f,e,o){for(var s=0;s<n.get_Count();s++)if(s!=t&&s!=i){var h=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(f.Value,n.get_Item$$Int32(s).get_Rectangle()),l=h.get_Area()-f.Value.get_Area(),c=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Rectangle$$Rectangle(e.Value,n.get_Item$$Int32(s).get_Rectangle()),a=c.get_Area()-e.Value.get_Area();r.get_Count()*o<u.get_Count()?(r.Add(n.get_Item$$Int32(s)),f.Value=h):u.get_Count()*o<r.get_Count()?(u.Add(n.get_Item$$Int32(s)),e.Value=c):l<a?(r.Add(n.get_Item$$Int32(s)),f.Value=h):a<l?(u.Add(n.get_Item$$Int32(s)),e.Value=c):f.Value.get_Area()<e.Value.get_Area()?(r.Add(n.get_Item$$Int32(s)),f.Value=h):(u.Add(n.get_Item$$Int32(s)),e.Value=c)}},TraverseHierarchy:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"node");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"visitor");t(n);n.get_Left()!=null&&Microsoft.Msagl.Core.Geometry.RectangleNode$1.TraverseHierarchy(n.get_Left(),t);n.get_Right()!=null&&Microsoft.Msagl.Core.Geometry.RectangleNode$1.TraverseHierarchy(n.get_Right(),t)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.TData=n;this.left=null;this.right=null;this.rectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._Count=0;this._UserData=null;this._Parent=null;System.Object.ctor.call(this)},Count$$:"System.Int32",get_Count:function(){return this._Count},set_Count:function(n){this._Count=n},ctor$$TData$$Rectangle:function(n,t,i){this.TData=n;this.left=null;this.right=null;this.rectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._Count=0;this._UserData=null;this._Parent=null;System.Object.ctor.call(this);this.set_UserData(t);this.set_Rectangle(i);this.set_Count(1)},ctor$$Int32:function(n,t){this.TData=n;this.left=null;this.right=null;this.rectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this._Count=0;this._UserData=null;this._Parent=null;System.Object.ctor.call(this);this.set_Count(t)},Rectangle$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_Rectangle:function(){return this.rectangle},set_Rectangle:function(n){this.rectangle=n},IsLeaf$$:"System.Boolean",get_IsLeaf:function(){return this.left==null},Left$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[`0]]",get_Left:function(){return this.left},set_Left:function(n){this.left!=null&&this.left.get_Parent()==this&&this.left.set_Parent(null);this.left=n;this.left!=null&&this.left.set_Parent(this)},Right$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[`0]]",get_Right:function(){return this.right},set_Right:function(n){this.right!=null&&this.right.get_Parent()==this&&this.right.set_Parent(null);this.right=n;this.right!=null&&this.right.set_Parent(this)},UserData$$:"`0",get_UserData:function(){return this._UserData},set_UserData:function(n){this._UserData=n},Parent$$:"Microsoft.Msagl.Core.Geometry.RectangleNode`1[[`0]]",get_Parent:function(){return this._Parent},set_Parent:function(n){this._Parent=n},IsLeftChild$$:"System.Boolean",get_IsLeftChild:function(){return System.Diagnostics.Debug.Assert$$Boolean(this.get_Parent()!=null),this.Equals$$Object(this.get_Parent().get_Left())},FirstHitNode$$Point$$Func$3:function(n,t){return this.rectangle.Contains$$Point(n)?this.get_IsLeaf()?t!=null?t(n,this.get_UserData())==Microsoft.Msagl.Core.Geometry.HitTestBehavior.Stop?this:null:this:this.get_Left().FirstHitNode$$Point$$Func$3(n,t)!=null?this.get_Left().FirstHitNode$$Point$$Func$3(n,t):this.get_Right().FirstHitNode$$Point$$Func$3(n,t):null},FirstIntersectedNode:function(n){return n.Intersects(this.rectangle)?this.get_IsLeaf()?this:this.get_Left().FirstIntersectedNode(n)!=null?this.get_Left().FirstIntersectedNode(n):this.get_Right().FirstIntersectedNode(n):null},FirstHitNode$$Point:function(n){return this.rectangle.Contains$$Point(n)?this.get_IsLeaf()?this:this.get_Left().FirstHitNode$$Point(n)!=null?this.get_Left().FirstHitNode$$Point(n):this.get_Right().FirstHitNode$$Point(n):null},AllHitItems$$Rectangle$$Func$2:function(n,t){var u=[],r=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor),i;for(r.Push(this);r.get_Count()>0;)i=r.Pop(),i.get_Rectangle().Intersects(n)&&(i.get_IsLeaf()?(null==t||t(i.get_UserData()))&&u.push(i.get_UserData()):(r.Push(i.left),r.Push(i.right)));return u},AllHitItems$$Point:function(n){var r=[],i=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor),t;for(i.Push(this);i.get_Count()>0;)t=i.Pop(),t.get_Rectangle().Contains$$Point(n)&&(t.get_IsLeaf()?r.push(t.get_UserData()):(i.Push(t.left),i.Push(t.right)));return r},VisitTree:function(n,t){Microsoft.Msagl.Core.Geometry.RectangleNode$1.VisitTreeStatic(this,n,t)},Clone:function(){var n=function(){var n=new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$Int32(this.TData,this.get_Count());return n.set_UserData(this.get_UserData()),n.set_Rectangle(this.get_Rectangle()),n}.call(this);return this.get_Left()!=null&&n.set_Left(this.get_Left().Clone()),this.get_Right()!=null&&n.set_Right(this.get_Right().Clone()),n},GetNodeItemsIntersectingRectangle:function(n){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,this.TData,this.GetLeafRectangleNodesIntersectingRectangle(n),$CreateAnonymousDelegate(this,function(n){return n.get_UserData()}))},GetLeafRectangleNodesIntersectingRectangle:function(n){var r=[],i=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor),t;for(i.Push(this);i.get_Count()>0;)t=i.Pop(),t.get_Rectangle().Intersects(n)&&(t.get_IsLeaf()?r.push(t):(i.Push(t.left),i.Push(t.right)));return r},GetAllLeaves:function(){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,this.TData,this.GetAllLeafNodes(),$CreateAnonymousDelegate(this,function(n){return n.get_UserData()}))},GetAllLeafNodes:function(){return this.EnumRectangleNodes(!0)},EnumRectangleNodes:function(n){var r=[],i=new System.Collections.Generic.Stack$1.ctor(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor),t;for(i.Push(this);i.get_Count()>0;)t=i.Pop(),(t.get_IsLeaf()||!n)&&r.push(t),t.get_IsLeaf()||(i.Push(t.left),i.Push(t.right));return r}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$RectangleNode$1);Microsoft$Msagl$Routing$Rectilinear$BasicObstacleSide={fullname:"Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ObstacleSide",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.endVertex=null;this._Obstacle=null;this._Slope=0;this._SlopeInverse=0;Microsoft.Msagl.Routing.Spline.ConeSpanner.ObstacleSide.ctor.call(this,t);this.set_Obstacle(n);this.endVertex=r?t.get_NextOnPolyline():t.get_PrevOnPolyline();i.IsPerpendicular$$Point$$Point(t.get_Point(),this.endVertex.get_Point())||(this.set_Slope(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Slope(t.get_Point(),this.endVertex.get_Point(),i)),this.set_SlopeInverse(1/this.get_Slope()))},Obstacle$$:"Microsoft.Msagl.Routing.Rectilinear.Obstacle",get_Obstacle:function(){return this._Obstacle},set_Obstacle:function(n){this._Obstacle=n},Slope$$:"System.Double",get_Slope:function(){return this._Slope},set_Slope:function(n){this._Slope=n},SlopeInverse$$:"System.Double",get_SlopeInverse:function(){return this._SlopeInverse},set_SlopeInverse:function(n){this._SlopeInverse=n},EndVertex$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_EndVertex:function(){return this.endVertex}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$BasicObstacleSide);Microsoft$Msagl$Routing$Rectilinear$BasicReflectionEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.BasicReflectionEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Obstacle$$Obstacle$$Point:function(n,t,i){this.site=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._ReflectingObstacle=null;this._InitialObstacle=null;this._PreviousSite=null;Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor.call(this);this.set_InitialObstacle(n);this.set_ReflectingObstacle(t);this.site=i},ReflectingObstacle$$:"Microsoft.Msagl.Routing.Rectilinear.Obstacle",get_ReflectingObstacle:function(){return this._ReflectingObstacle},set_ReflectingObstacle:function(n){this._ReflectingObstacle=n},InitialObstacle$$:"Microsoft.Msagl.Routing.Rectilinear.Obstacle",get_InitialObstacle:function(){return this._InitialObstacle},set_InitialObstacle:function(n){this._InitialObstacle=n},PreviousSite$$:"Microsoft.Msagl.Routing.Rectilinear.BasicReflectionEvent",get_PreviousSite:function(){return this._PreviousSite},set_PreviousSite:function(n){this._PreviousSite=n},ctor$$BasicReflectionEvent$$Obstacle$$Point:function(n,t,i){this.site=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._ReflectingObstacle=null;this._InitialObstacle=null;this._PreviousSite=null;Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor.call(this);this.set_InitialObstacle(n.get_ReflectingObstacle());this.set_ReflectingObstacle(t);this.site=i;this.set_PreviousSite(n)},IsStaircaseStep:function(n){return this.get_InitialObstacle()==n},Site$$:"Microsoft.Msagl.Core.Geometry.Point",get_Site:function(){return this.site}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$BasicReflectionEvent);Microsoft$Msagl$Routing$Rectilinear$BasicVertexEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.BasicVertexEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this._Obstacle=null;Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent.ctor.call(this,t);this.set_Obstacle(n)},Obstacle$$:"Microsoft.Msagl.Routing.Rectilinear.Obstacle",get_Obstacle:function(){return this._Obstacle},set_Obstacle:function(n){this._Obstacle=n}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$BasicVertexEvent);Microsoft$Msagl$Routing$Rectilinear$OpenVertexEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.OpenVertexEvent",baseTypeName:"Microsoft.Msagl.Routing.Rectilinear.BasicVertexEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){Microsoft.Msagl.Routing.Rectilinear.BasicVertexEvent.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$OpenVertexEvent);Microsoft$Msagl$Core$Geometry$Directions={fullname:"Microsoft.Msagl.Core.Geometry.Directions",staticDefinition:{None:0,North:1,East:2,South:4,West:8},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Geometry$Directions);Microsoft$Msagl$Core$Geometry$CompassVector={fullname:"Microsoft.Msagl.Core.Geometry.CompassVector",baseTypeName:"System.ValueType",staticDefinition:{op_Equality:function(n,t){return n.get_Dir()==t.get_Dir()},op_Inequality:function(n,t){return n.get_Dir()!=t.get_Dir()},RotateRight:function(n){switch(n){case Microsoft.Msagl.Core.Geometry.Directions.North:return Microsoft.Msagl.Core.Geometry.Directions.East;case Microsoft.Msagl.Core.Geometry.Directions.East:return Microsoft.Msagl.Core.Geometry.Directions.South;case Microsoft.Msagl.Core.Geometry.Directions.South:return Microsoft.Msagl.Core.Geometry.Directions.West;case Microsoft.Msagl.Core.Geometry.Directions.West:return Microsoft.Msagl.Core.Geometry.Directions.North;default:throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},RotateLeft:function(n){switch(n){case Microsoft.Msagl.Core.Geometry.Directions.North:return Microsoft.Msagl.Core.Geometry.Directions.West;case Microsoft.Msagl.Core.Geometry.Directions.West:return Microsoft.Msagl.Core.Geometry.Directions.South;case Microsoft.Msagl.Core.Geometry.Directions.South:return Microsoft.Msagl.Core.Geometry.Directions.East;case Microsoft.Msagl.Core.Geometry.Directions.East:return Microsoft.Msagl.Core.Geometry.Directions.North;default:throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},ToIndex:function(n){switch(n){case Microsoft.Msagl.Core.Geometry.Directions.North:return 0;case Microsoft.Msagl.Core.Geometry.Directions.East:return 1;case Microsoft.Msagl.Core.Geometry.Directions.South:return 2;case Microsoft.Msagl.Core.Geometry.Directions.West:return 3;default:throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},VectorDirection$$Point:function(n){var t=Microsoft.Msagl.Core.Geometry.Directions.None;return n.get_X()>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?t=Microsoft.Msagl.Core.Geometry.Directions.East:n.get_X()<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(t=Microsoft.Msagl.Core.Geometry.Directions.West),n.get_Y()>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?t|=Microsoft.Msagl.Core.Geometry.Directions.North:n.get_Y()<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(t|=Microsoft.Msagl.Core.Geometry.Directions.South),t},VectorDirection$$Point$$Point:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Directions.None,u=t.get_X()-n.get_X(),f=t.get_Y()-n.get_Y(),r=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon/2;return u>r?i=Microsoft.Msagl.Core.Geometry.Directions.East:-u>r&&(i=Microsoft.Msagl.Core.Geometry.Directions.West),f>r?i|=Microsoft.Msagl.Core.Geometry.Directions.North:-f>r&&(i|=Microsoft.Msagl.Core.Geometry.Directions.South),i},DirectionsFromPointToPoint:function(n,t){return Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point$$Point(n,t)},PureDirectionFromPointToPoint:function(n,t){var i=Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point$$Point(n,t);return System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(i),"Impure direction found"),i},OppositeDir:function(n){switch(n){case Microsoft.Msagl.Core.Geometry.Directions.North:return Microsoft.Msagl.Core.Geometry.Directions.South;case Microsoft.Msagl.Core.Geometry.Directions.West:return Microsoft.Msagl.Core.Geometry.Directions.East;case Microsoft.Msagl.Core.Geometry.Directions.South:return Microsoft.Msagl.Core.Geometry.Directions.North;case Microsoft.Msagl.Core.Geometry.Directions.East:return Microsoft.Msagl.Core.Geometry.Directions.West;default:return Microsoft.Msagl.Core.Geometry.Directions.None}},IsPureDirection$$Directions:function(n){switch(n){case Microsoft.Msagl.Core.Geometry.Directions.North:return!0;case Microsoft.Msagl.Core.Geometry.Directions.East:return!0;case Microsoft.Msagl.Core.Geometry.Directions.South:return!0;case Microsoft.Msagl.Core.Geometry.Directions.West:return!0;default:return!1}},IsPureDirection$$Point$$Point:function(n,t){return Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(n,t))},DirectionsAreParallel:function(n,t){return n==t||n==Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(t)},ToPoint$$Directions:function(n){return new Microsoft.Msagl.Core.Geometry.CompassVector.ctor$$Directions(n).ToPoint()},op_UnaryNegation:function(n){return new Microsoft.Msagl.Core.Geometry.CompassVector.ctor$$Directions(Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(n.get_Dir()))}},assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Directions:function(n){this._Dir=Microsoft.Msagl.Core.Geometry.Directions.None;Microsoft.Msagl.Core.Geometry.CompassVector.ctor.call(this);this.set_Dir(n)},GetHashCode:function(){return this.get_Dir()},ctor$$Point:function(n){this._Dir=Microsoft.Msagl.Core.Geometry.Directions.None;Microsoft.Msagl.Core.Geometry.CompassVector.ctor.call(this);this.set_Dir(Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point(n))},ctor$$Point$$Point:function(n,t){this._Dir=Microsoft.Msagl.Core.Geometry.Directions.None;Microsoft.Msagl.Core.Geometry.CompassVector.ctor.call(this);this.set_Dir(Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point$$Point(n,t))},Dir$$:"Microsoft.Msagl.Core.Geometry.Directions",get_Dir:function(){return this._Dir},set_Dir:function(n){this._Dir=n},Right$$:"Microsoft.Msagl.Core.Geometry.CompassVector",get_Right:function(){return new Microsoft.Msagl.Core.Geometry.CompassVector.ctor$$Directions(Microsoft.Msagl.Core.Geometry.CompassVector.RotateRight(this.get_Dir()))},Equals$$CompassVector:function(n){return System.Object.Equals$$Object$$Object(n.get_Dir(),this.get_Dir())},Equals$$Object:function(n){return System.Object.ReferenceEquals(null,n)?!1:n.GetType()!=Typeof(Microsoft.Msagl.Core.Geometry.CompassVector.ctor)?!1:this.Equals$$CompassVector(Cast(n,Microsoft.Msagl.Core.Geometry.CompassVector.ctor))},toString:function(){return this.get_Dir().toString()},ToPoint:function(){var n=new Microsoft.Msagl.Core.Geometry.Point.ctor;return(this.get_Dir()&Microsoft.Msagl.Core.Geometry.Directions.East)==Microsoft.Msagl.Core.Geometry.Directions.East&&n.set_X(n.get_X()+1),(this.get_Dir()&Microsoft.Msagl.Core.Geometry.Directions.North)==Microsoft.Msagl.Core.Geometry.Directions.North&&n.set_Y(n.get_Y()+1),(this.get_Dir()&Microsoft.Msagl.Core.Geometry.Directions.West)==Microsoft.Msagl.Core.Geometry.Directions.West&&n.set_X(n.get_X()-1),(this.get_Dir()&Microsoft.Msagl.Core.Geometry.Directions.South)==Microsoft.Msagl.Core.Geometry.Directions.South&&n.set_Y(n.get_Y()-1),n},Negate:function(){return Microsoft.Msagl.Core.Geometry.CompassVector.op_UnaryNegation(this)},ctor:function(){this._Dir=Microsoft.Msagl.Core.Geometry.Directions.None;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$CompassVector);Microsoft$Msagl$Routing$Rectilinear$HighBendVertexEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.HighBendVertexEvent",baseTypeName:"Microsoft.Msagl.Routing.Rectilinear.BasicVertexEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){Microsoft.Msagl.Routing.Rectilinear.BasicVertexEvent.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$HighBendVertexEvent);Microsoft$Msagl$Routing$Rectilinear$LowBendVertexEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.LowBendVertexEvent",baseTypeName:"Microsoft.Msagl.Routing.Rectilinear.BasicVertexEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){Microsoft.Msagl.Routing.Rectilinear.BasicVertexEvent.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$LowBendVertexEvent);Microsoft$Msagl$Routing$Rectilinear$ScanSegmentTree={fullname:"Microsoft.Msagl.Routing.Rectilinear.ScanSegmentTree",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.segmentTree=null;this.lookupSegment=new Microsoft.Msagl.Routing.Rectilinear.ScanSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,1));this.findIntersectorPred=null;this.findPointPred=null;this._ScanDirection=null;System.Object.ctor.call(this);this.set_ScanDirection(n);this.segmentTree=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Rectilinear.ScanSegment.ctor,this);this.findIntersectorPred=$CreateDelegate(this,this.CompareIntersector);this.findPointPred=$CreateDelegate(this,this.CompareToPoint)},ScanDirection$$:"Microsoft.Msagl.Routing.Rectilinear.ScanDirection",get_ScanDirection:function(){return this._ScanDirection},set_ScanDirection:function(n){this._ScanDirection=n},Segments$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Rectilinear.ScanSegment]]",get_Segments:function(){return this.segmentTree},InsertUnique:function(n){this.AssertValidSegmentForInsertion(n);var t=this.segmentTree.Find$$T(n);return null!=t?(System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_IsOverlapped()==t.Item.get_IsOverlapped(),"Existing node found with different isOverlapped"),t):this.segmentTree.Insert(n)},AssertValidSegmentForInsertion:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_End().get_X()>=n.get_Start().get_X()&&n.get_End().get_Y()>=n.get_Start().get_Y(),"Reversed direction in ScanSegment");System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_ScanDirection().IsFlat$$Point$$Point(n.get_Start(),n.get_End()),"non-flat segment cannot be inserted")},Remove:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(n.get_IsVertical()==this.get_ScanDirection().get_IsVertical(),"seg.IsVertical != ScanDirection.IsVertical");this.segmentTree.Remove(n)},Find:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,t)||!this.get_ScanDirection().IsPerpendicular$$Point$$Point(n,t),"perpendicular segment passed");this.lookupSegment.Update(n,t);var i=this.segmentTree.Find$$T(this.lookupSegment);return null!=i&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(i.Item.get_End(),t)?i.Item:null},FindLowestIntersector:function(n,t){var i=this.FindLowestIntersectorNode(n,t);return null!=i?i.Item:null},FindLowestIntersectorNode:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_ScanDirection().IsPerpendicular$$Point$$Point(n,t),"non-perpendicular segment passed");this.lookupSegment.Update(n,n);var i=this.segmentTree.FindLast$$Func$2(this.findIntersectorPred);if(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,t))null!=i&&this.get_ScanDirection().Compare(i.Item.get_End(),n)<0&&(i=null);else for(this.lookupSegment.Update(n,t);null!=i&&!i.Item.IntersectsSegment(this.lookupSegment);){if(this.get_ScanDirection().Compare(i.Item.get_Start(),t)>0)return null;i=this.segmentTree.Next(i)}return i},FindHighestIntersector:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_ScanDirection().IsPerpendicular$$Point$$Point(n,t),"non-perpendicular segment passed");this.lookupSegment.Update(t,t);var i=this.segmentTree.FindLast$$Func$2(this.findIntersectorPred);if(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,t))null!=i&&this.get_ScanDirection().Compare(i.Item.get_End(),n)<0&&(i=null);else for(this.lookupSegment.Update(n,t);null!=i&&!i.Item.IntersectsSegment(this.lookupSegment);){if(this.get_ScanDirection().Compare(i.Item.get_End(),n)<0)return null;i=this.segmentTree.Previous(i)}return null!=i?i.Item:null},CompareIntersector:function(n){return this.get_ScanDirection().Compare(n.get_Start(),this.lookupSegment.get_Start())<=0},FindSegmentContainingPoint:function(n,t){return this.FindSegmentOverlappingPoints(n,n,t)},FindSegmentOverlappingPoints:function(n,t,i){var r,u;return(this.lookupSegment.Update(n,t),r=this.segmentTree.FindFirst$$Func$2(this.findPointPred),null!=r&&(u=r.Item,this.get_ScanDirection().Compare(u.get_Start(),t)<=0))?u:(i||System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"Could not find expected segment"),null)},CompareToPoint:function(n){return this.get_ScanDirection().Compare(n.get_End(),this.lookupSegment.get_Start())>=0},MergeAndRemoveNextNode:function(n,t){return-1==this.get_ScanDirection().Compare(n.get_End(),t.Item.get_End())&&n.Update(n.get_Start(),t.Item.get_End()),n.MergeGroupBoundaryCrossingList(t.Item.GroupBoundaryPointAndCrossingsList),this.segmentTree.DeleteNodeInternal(t),this.segmentTree.Find$$T(n)},MergeSegments:function(){var n,t,u,i,r;if(!(this.segmentTree.get_Count()<2))for(n=this.segmentTree.TreeMinimum(),t=this.segmentTree.Next(n);null!=t;t=this.segmentTree.Next(n)){u=this.get_ScanDirection().Compare(t.Item.get_Start(),n.Item.get_End());switch(u){case 1:n=t;break;case 0:t.Item.get_IsOverlapped()==n.Item.get_IsOverlapped()?n=this.MergeAndRemoveNextNode(n.Item,t):(n.Item.set_NeedEndOverlapVertex(!0),t.Item.set_NeedStartOverlapVertex(!0),n=t);break;default:if(System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.Point.op_Inequality(t.Item.get_Start(),n.Item.get_Start())||Microsoft.Msagl.Core.Geometry.Point.op_LessThan(t.Item.get_End(),n.Item.get_End()),"Identical segments are not allowed, and longer ones must come first"),n.Item.get_IsOverlapped()!=t.Item.get_IsOverlapped()){System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(n.Item.get_End(),t.Item.get_Start()),"Segments share a span with different IsOverlapped");n.Item.get_IsOverlapped()?Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.Item.get_Start(),t.Item.get_Start())?n=this.MergeAndRemoveNextNode(t.Item,n):(n.Item.Update(n.Item.get_Start(),t.Item.get_Start()),n=t):Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.Item.get_End(),t.Item.get_End())?n=this.MergeAndRemoveNextNode(n.Item,t):(i=t.Item,r=n.Item,this.segmentTree.DeleteNodeInternal(t),i.Update(r.get_End(),i.get_End()),this.segmentTree.Insert(i),i.TrimGroupBoundaryCrossingList(),n=this.segmentTree.Find$$T(r));break}n=this.MergeAndRemoveNextNode(n.Item,t)}}},Compare:function(n,t){if(n==t)return 0;if(n==null)return-1;if(t==null)return 1;var i=this.get_ScanDirection().Compare(n.get_Start(),t.get_Start());return 0==i&&(i=-this.get_ScanDirection().Compare(n.get_End(),t.get_End())),i},DevTraceInfo:function(){},DevTraceVerifyVisibility:function(){}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$ScanSegmentTree);Microsoft$Msagl$Routing$Rectilinear$StaticGraphUtility={fullname:"Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility",baseTypeName:"System.Object",staticDefinition:{EdgeDirection$$VisibilityEdge:function(n){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.EdgeDirection$$VisibilityVertex$$VisibilityVertex(n.get_Source(),n.get_Target())},EdgeDirection$$VisibilityVertex$$VisibilityVertex:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n.Point,t.Point)},GetVertex:function(n,t){var i=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.EdgeDirection$$VisibilityEdge(n);return System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.Directions.None!=(t&(i|Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(i))),"dir is orthogonal to edge"),t==i?n.get_Target():n.get_Source()},FindNextVertex:function(n,t){for(var r,i,f=n.get_InEdges().get_Count(),u=0;u<f;++u)if(i=n.get_InEdges().get_Item$$Int32(u),Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n.Point,i.get_SourcePoint())==t)return i.get_Source();for(r=n.get_OutEdges().IsEmpty()?null:n.get_OutEdges().TreeMinimum();r!=null;r=n.get_OutEdges().Next(r))if(i=r.Item,Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n.Point,i.get_TargetPoint())==t)return i.get_Target();return null},FindNextEdge:function(n,t,i){var r=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(t,i);return null==r?null:n.FindEdge$$Point$$Point(t.Point,r.Point)},FindBendPointBetween:function(n,t,i){var u=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n,t),r;return System.Diagnostics.Debug.Assert$$Boolean$$String(!Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureDirection$$Directions(u),"pure direction has no bend"),r=u&~i,System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureDirection$$Directions(r),"firstDir is not pure"),Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Directions(r)?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_X(),t.get_Y()):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X(),n.get_Y())},SegmentIntersection$$Point$$Point$$Point:function(n,t,i){var r=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n,t);return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Directions(r)?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_X(),i.get_Y()):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i.get_X(),n.get_Y())},SegmentIntersection$$SegmentBase$$Point:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SegmentIntersection$$Point$$Point$$Point(n.get_Start(),n.get_End(),t)},SegmentsIntersect$$SegmentBase$$SegmentBase:function(n,t){var i;return function(){var r={Value:i},u=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SegmentsIntersect$$SegmentBase$$SegmentBase$$Point(n,t,r);return i=r.Value,u}()},SegmentsIntersect$$SegmentBase$$SegmentBase$$Point:function(n,t,i){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IntervalsIntersect(n.get_Start(),n.get_End(),t.get_Start(),t.get_End(),i)},SegmentsIntersect$$LineSegment$$LineSegment$$Point:function(n,t,i){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IntervalsIntersect(n.get_Start(),n.get_End(),t.get_Start(),t.get_End(),i)},SegmentIntersection$$SegmentBase$$SegmentBase:function(n,t){var i;return function(){var r={Value:i},u=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SegmentsIntersect$$SegmentBase$$SegmentBase$$Point(n,t,r);return i=r.Value,u}()||System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"intersect is not on both segments"),i},IntervalsOverlap$$SegmentBase$$SegmentBase:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IntervalsOverlap$$Point$$Point$$Point$$Point(n.get_Start(),n.get_End(),t.get_Start(),t.get_End())},IntervalsOverlap$$Point$$Point$$Point$$Point:function(n,t,i,r){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IntervalsAreCollinear(n,t,i,r)&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(n,r)!=Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(t,i)},IntervalsAreCollinear:function(n,t,i,r){System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Point$$Point(n,t)==Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Point$$Point(i,r),"segments are not in the same orientation");var u=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Point$$Point(n,t);return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Point$$Point(i,r)==u?u?Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(n.get_X(),i.get_X()):Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(n.get_Y(),i.get_Y()):!1},IntervalsAreSame:function(n,t,i,r){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,i)&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(t,r)},IntervalsIntersect:function(n,t,i,r,u){return System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Point$$Point(n,t)!=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Point$$Point(i,r),"cannot intersect two parallel segments"),u.Value=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SegmentIntersection$$Point$$Point$$Point(n,t,i),Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.PointIsOnSegment$$Point$$Point$$Point(n,t,u.Value)&&Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.PointIsOnSegment$$Point$$Point$$Point(i,r,u.Value)},SegmentIntersection$$VisibilityEdge$$Point:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SegmentIntersection$$Point$$Point$$Point(n.get_SourcePoint(),n.get_TargetPoint(),t)},PointIsOnSegment$$Point$$Point$$Point:function(n,t,i){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,i)||Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(t,i)||Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n,i)==Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(i,t)},PointIsOnSegment$$SegmentBase$$Point:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.PointIsOnSegment$$Point$$Point$$Point(n.get_Start(),n.get_End(),t)},IsVertical$$Directions:function(n){return Microsoft.Msagl.Core.Geometry.Directions.None!=(n&5)},IsVertical$$VisibilityEdge:function(n){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Directions(Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n.get_SourcePoint(),n.get_TargetPoint()))},IsVertical$$Point$$Point:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Directions(Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n,t))},IsVertical$$LineSegment:function(n){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Directions(Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n.get_Start(),n.get_End()))},IsAscending:function(n){return Microsoft.Msagl.Core.Geometry.Directions.None!=(n&3)},Slope:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n);return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,i.get_PerpDirectionAsPoint())/Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,i.get_DirectionAsPoint())},SortAscending:function(n,t){var i=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n,t);return System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.Directions.None==i||Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureDirection$$Directions(i),"SortAscending with impure direction"),Microsoft.Msagl.Core.Geometry.Directions.None==i||Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsAscending(i)?new System.Tuple$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,n,t):new System.Tuple$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,t,n)},RectangleBorderIntersect:function(n,t,i){switch(i){case Microsoft.Msagl.Core.Geometry.Directions.North:case Microsoft.Msagl.Core.Geometry.Directions.South:return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X(),Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.GetRectangleBound(n,i));case Microsoft.Msagl.Core.Geometry.Directions.East:case Microsoft.Msagl.Core.Geometry.Directions.West:return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.GetRectangleBound(n,i),t.get_Y());default:throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},GetRectangleBound:function(n,t){switch(t){case Microsoft.Msagl.Core.Geometry.Directions.North:return n.get_Top();case Microsoft.Msagl.Core.Geometry.Directions.South:return n.get_Bottom();case Microsoft.Msagl.Core.Geometry.Directions.East:return n.get_Right();case Microsoft.Msagl.Core.Geometry.Directions.West:return n.get_Left();default:throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},RectangleInteriorsIntersect:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n.get_Bottom(),t.get_Top())<0&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(t.get_Bottom(),n.get_Top())<0&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n.get_Left(),t.get_Right())<0&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(t.get_Left(),n.get_Right())<0},PointIsInRectangleInterior:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n.get_Y(),t.get_Top())<0&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(t.get_Bottom(),n.get_Y())<0&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n.get_X(),t.get_Right())<0&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(t.get_Left(),n.get_X())<0},Assert:function(n,t){n||System.Diagnostics.Debug.Assert$$Boolean$$String(n,t)},Test_DumpVisibilityGraph:function(){},IsEqualForDebugger$$Double$$Double:function(n,t){return n<t+1&&n>t-1},IsEqualForDebugger$$Point$$Double$$Double:function(n,t,i){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsEqualForDebugger$$Double$$Double(n.get_X(),t)&&Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsEqualForDebugger$$Double$$Double(n.get_Y(),i)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$StaticGraphUtility);Microsoft$Msagl$Routing$Rectilinear$CloseVertexEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.CloseVertexEvent",baseTypeName:"Microsoft.Msagl.Routing.Rectilinear.BasicVertexEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){Microsoft.Msagl.Routing.Rectilinear.BasicVertexEvent.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$CloseVertexEvent);Microsoft$Msagl$Routing$Rectilinear$TransientGraphUtility={fullname:"Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility",baseTypeName:"System.Object",staticDefinition:{FindBracketingVertices:function(n,t,i,r,u){for(r.Value=n;;){if(u.Value=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(r.Value,i),null==u.Value)break;if(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(u.Value.Point,t))return!0;if(i!=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(u.Value.Point,t))break;r.Value=u.Value}return null!=u.Value},TraverseToFirstVertexAtOrAbove:function(n,t,i){for(var u=n,f=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(i),r;;){if(r=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(u,i),null==r||Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(r.Point,t)==f)break;u=r}return u},GetNextSpliceSource:function(n,t,i){var r=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(n.Value,i),u;if(null==r)for(r=n.Value;;){if(r=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(r,Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(t)),null==r)return!1;if(u=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(r,i),null!=u){r=u;break}}return n.Value=r,!0},GetSpliceTarget:function(n,t,i){for(var u=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n.Value.Point,i),f=u,r=n.Value;f==u;){if(n.Value=r,r=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(n.Value,t),null==r)break;if(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(r.Point,i)){r=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(r,t);break}f=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(r.Point,i)}return r},IsSkippableSpliceSourceEdgeWithNullTarget:function(n){return null!=n&&null!=n.get_IsPassable()&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(n.get_Length(),Microsoft.Msagl.Routing.Rectilinear.GroupBoundaryCrossing.get_BoundaryWidth())},IsReflectionEdge:function(n){return null!=n&&n.get_Weight()==5},IsPointPastSegmentEnd:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n.get_Start(),n.get_End())==Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n.get_End(),t)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.AddedVertices=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear.ctor);this.AddedEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor);this.edgesToRestore=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor);this._LimitPortVisibilitySpliceToEndpointBoundingBox=!1;this._GraphGenerator=null;System.Object.ctor.call(this);this.set_GraphGenerator(n)},LimitPortVisibilitySpliceToEndpointBoundingBox$$:"System.Boolean",get_LimitPortVisibilitySpliceToEndpointBoundingBox:function(){return this._LimitPortVisibilitySpliceToEndpointBoundingBox},set_LimitPortVisibilitySpliceToEndpointBoundingBox:function(n){this._LimitPortVisibilitySpliceToEndpointBoundingBox=n},GraphGenerator$$:"Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator",get_GraphGenerator:function(){return this._GraphGenerator},set_GraphGenerator:function(n){this._GraphGenerator=n},ObstacleTree$$:"Microsoft.Msagl.Routing.Rectilinear.ObstacleTree",get_ObstacleTree:function(){return this.get_GraphGenerator().ObstacleTree},VisGraph$$:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",get_VisGraph:function(){return this.get_GraphGenerator().get_VisibilityGraph()},IsSparseVg$$:"System.Boolean",get_IsSparseVg:function(){return Is(this.get_GraphGenerator(),Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.ctor)},AddVertex:function(n){var t=this.get_VisGraph().AddVertex$$Point(n);return this.AddedVertices.Add(Cast(t,Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear.ctor)),t},FindOrAddVertex:function(n){var t=this.get_VisGraph().FindVertex(n);return t!=null?t:this.AddVertex(n)},FindOrAddEdge$$VisibilityVertex$$VisibilityVertex:function(n,t){return this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(n,t,1)},FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double:function(n,t,i){var o=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$VisibilityVertex$$VisibilityVertex(n,t),r,u,s=t,f,e;return function(){var i={Value:r},f={Value:u},e=Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility.FindBracketingVertices(n,t.Point,o,i,f);return r=i.Value,u=f.Value,e}.call(this)||function(){var i={Value:u},r={Value:f},e=Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility.FindBracketingVertices(t,n.Point,Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(o),i,r);return u=i.Value,f=r.Value,e}.call(this)&&(System.Diagnostics.Debug.Assert$$Boolean$$String(r==n,"Mismatched bracketing detection"),r=f,s=n),e=this.get_VisGraph().FindEdge$$Point$$Point(r.Point,u.Point),null!=e?this.SplitEdge(e,s):this.CreateEdge(r,u,i)},DevTrace_VerifyEdge:function(){},DevTrace_VerifyAllVertices:function(){},DevTrace_VerifyAllEdgeIntersections:function(){},CreateEdge:function(n,t,i){var u=n,f=t,r;return Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(u.Point,f.Point)||(u=t,f=n),r=new Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex$$Double(u,f,i),Microsoft.Msagl.Routing.Visibility.VisibilityGraph.AddEdge$$VisibilityEdge(r),this.AddedEdges.Add(r),r},RemoveFromGraph:function(){this.RemoveAddedVertices();this.RemoveAddedEdges();this.RestoreRemovedEdges()},RemoveAddedVertices:function(){for(var t=this.AddedVertices.GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),null!=this.get_VisGraph().FindVertex(n.Point)&&this.get_VisGraph().RemoveVertex(n);this.AddedVertices.Clear()},RemoveAddedEdges:function(){for(var t=this.AddedEdges.GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),null!=this.get_VisGraph().FindVertex(n.get_SourcePoint())&&Microsoft.Msagl.Routing.Visibility.VisibilityGraph.RemoveEdge$$VisibilityEdge(n);this.AddedEdges.Clear()},RestoreRemovedEdges:function(){for(var t=this.edgesToRestore.GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),System.Diagnostics.Debug.Assert$$Boolean$$String(!Is(n,Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor),"Unexpected Transient edge"),Microsoft.Msagl.Routing.Visibility.VisibilityGraph.AddEdge$$VisibilityEdge(n);this.edgesToRestore.Clear()},FindNextEdge:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextEdge(this.get_VisGraph(),n,t)},FindPerpendicularOrContainingEdge:function(n,t,i){var r,u;for(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(Microsoft.Msagl.Core.Geometry.Directions.None==(Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(t)&Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n.Point,i)),"the ray from 'dir' is away from pointLocation",this.get_ObstacleTree(),this.get_VisGraph());;){if(r=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(n,t),null==r)break;if(u=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(r.Point,i),Microsoft.Msagl.Core.Geometry.Directions.None!=(Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(t)&u))return this.get_VisGraph().FindEdge$$Point$$Point(n.Point,r.Point);n=r}return null},FindNearestPerpendicularOrContainingEdge:function(n,t,i){for(var u=~t&Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n.Point,i),r=n,o=u,f,e;Microsoft.Msagl.Core.Geometry.Directions.None!=o;){if(f=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(r,u),null==f)break;if(Microsoft.Msagl.Core.Geometry.Directions.None!=(Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(u)&Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(f.Point,i)))break;r=f;o=~t&Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(r.Point,i)}for(;;){if(e=this.FindPerpendicularOrContainingEdge(r,t,i),null!=e||r==n)break;r=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(r,Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(u))}return e},ConnectVertexToTargetVertex:function(n,t,i,r){var f,e,u;if(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureDirection$$Directions(i),"finalEdgeDir is not pure",this.get_ObstacleTree(),this.get_VisGraph()),!Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n.Point,t.Point)){if(f=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n.Point,t.Point),Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureDirection$$Directions(f)){this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex(n,t);return}e=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindBendPointBetween(n.Point,t.Point,i);u=this.FindOrAddVertex(e);this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(n,u,r);this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(u,t,r)}},AddEdgeToTargetEdge:function(n,t,i){Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n.Point,i)||Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureDirection$$Point$$Point(n.Point,i),"non-orthogonal edge request",this.get_ObstacleTree(),this.get_VisGraph());Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.PointIsOnSegment$$Point$$Point$$Point(t.get_SourcePoint(),t.get_TargetPoint(),i),"targetIntersect is not on targetEdge",this.get_ObstacleTree(),this.get_VisGraph());var r=this.get_VisGraph().FindVertex(i);return null==r&&(r=this.AddVertex(i),this.SplitEdge(t,r)),this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex(n,r),r},SplitEdge:function(n,t){return null==n?null:(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.PointIsOnSegment$$Point$$Point$$Point(n.get_SourcePoint(),n.get_TargetPoint(),t.Point),"splitVertex is not on edge",this.get_ObstacleTree(),this.get_VisGraph()),Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n.get_Source().Point,t.Point)||Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n.get_Target().Point,t.Point))?n:(Is(n,Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor)||this.edgesToRestore.Add(n),Microsoft.Msagl.Routing.Visibility.VisibilityGraph.RemoveEdge$$VisibilityEdge(n),(this.get_IsSparseVg()||n.get_Weight()==500)&&t.get_Degree()>0)?(this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(t,n.get_Source(),n.get_Weight()),this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(t,n.get_Target(),n.get_Weight())):(this.CreateEdge(t,n.get_Target(),n.get_Weight()),this.CreateEdge(n.get_Source(),t,n.get_Weight()))},ExtendEdgeChain$$VisibilityVertex$$Rectangle$$LineSegment$$PointAndCrossingsList$$Boolean:function(n,t,i,r,u){var f=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(i.get_Start(),i.get_End()),s,e,o;f!=Microsoft.Msagl.Core.Geometry.Directions.None&&((System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(f),"impure max visibility segment"),Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(i.get_Start(),n.Point)||Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(i.get_Start(),n.Point)==f,"Inconsistent direction found",this.get_ObstacleTree(),this.get_VisGraph()),s=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.GetRectangleBound(t,f),e=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Directions(f)?Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.Point.get_X(),s)):Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(s,n.Point.get_Y())),Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(e,n.Point))||Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n.Point,e)==f&&(o=i,Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(e,o.get_End())==f&&(o=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(o.get_Start(),e)),this.ExtendEdgeChain$$VisibilityVertex$$Directions$$LineSegment$$LineSegment$$PointAndCrossingsList$$Boolean(n,f,o,i,r,u)))},ExtendEdgeChain$$VisibilityVertex$$Directions$$LineSegment$$LineSegment$$PointAndCrossingsList$$Boolean:function(n,t,i,r,u,f){var h,e,o,c,s;if(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(i.get_Start(),i.get_End())==t,"maxDesiredSegment is reversed",this.get_ObstacleTree(),this.get_VisGraph()),h=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n.Point,i.get_End()),h!=t){Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(f||h!=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(t),"obstacle encountered between prevPoint and startVertex",this.get_ObstacleTree(),this.get_VisGraph());return}(e=Microsoft.Msagl.Core.Geometry.CompassVector.RotateLeft(t),o=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(n,e),null!=o||(e=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(e),o=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(n,e),null!=o))&&(c=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(e),function(){var n={Value:s},u=this.ExtendSpliceWorker(o,t,c,i,r,f,n);return s=n.Value,u}.call(this)&&function(){var n={Value:s},u=this.ExtendSpliceWorker(s,t,e,i,r,f,n);return s=n.Value,u}.call(this),this.SpliceGroupBoundaryCrossings(u,n,i))},SpliceGroupBoundaryCrossings:function(n,t,i){var r,s,f;if(null!=n&&0!=n.get_Count()){n.Reset();var o=i.get_Start(),e=i.get_End(),u=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(o,e);for(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsAscending(u)||(o=i.get_End(),e=i.get_Start(),u=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(u)),t=Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility.TraverseToFirstVertexAtOrAbove(t,o,Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(u)),r=t;null!=r;r=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(r,u)){for(s=Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(r.Point,e)>=0;n.CurrentIsBeforeOrAt(r.Point);)f=n.Pop(),Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(f.get_Location(),t.Point)>0&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(f.get_Location(),e)<=0&&this.SpliceGroupBoundaryCrossing(r,f,Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(u)),Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(f.get_Location(),t.Point)>=0&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(f.get_Location(),e)<0&&this.SpliceGroupBoundaryCrossing(r,f,u);if(s)break}}},SpliceGroupBoundaryCrossing:function(n,t,i){var f=Microsoft.Msagl.Routing.Rectilinear.PointAndCrossingsList.ToCrossingArray(t.get_Crossings(),i),r,u,e,o,s;null!=f&&(r=this.get_VisGraph().FindVertex(t.get_Location())!=null?this.get_VisGraph().FindVertex(t.get_Location()):this.AddVertex(t.get_Location()),Microsoft.Msagl.Core.Geometry.Point.op_Inequality(n.Point,r.Point)&&this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex(n,r),u=f[0].GetInteriorVertexPoint(t.get_Location()),e=this.get_VisGraph().FindVertex(u)!=null?this.get_VisGraph().FindVertex(u):this.AddVertex(u),this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex(r,e),o=this.get_VisGraph().FindEdge$$Point$$Point(r.Point,e.Point),s=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Routing.Shape.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.GroupBoundaryCrossing.ctor,Microsoft.Msagl.Routing.Shape.ctor,f,$CreateAnonymousDelegate(this,function(n){return n.get_Group().get_InputShape()}))),o.set_IsPassable($CreateAnonymousDelegate(this,function(){return System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,s,$CreateAnonymousDelegate(this,function(n){return n.get_IsTransparent()}))})))},ExtendSpliceWorker:function(n,t,i,r,u,f,e){var h=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(n,i),s,o;for(e.Value=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(h,i);;){if(!function(){var r={Value:n},u=Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility.GetNextSpliceSource(r,i,t);return n=r.Value,u}.call(this))break;if(s=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindBendPointBetween(h.Point,n.Point,Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(i)),Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility.IsPointPastSegmentEnd(u,s))break;if(e.Value=function(){var t={Value:n},r=Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility.GetSpliceTarget(t,i,s);return n=t.Value,r}.call(this),null==e.Value){if(this.IsSkippableSpliceSourceWithNullSpliceTarget(n,t))continue;if(this.get_ObstacleTree().SegmentCrossesAnObstacle(n.Point,s))return!1}if(o=this.get_VisGraph().FindVertex(s),null!=o){if(null==e.Value||null!=this.get_VisGraph().FindEdge$$Point$$Point(h.Point,s))return null==e.Value&&(this.Debug_VerifyNonOverlappedExtension(f,h,o,null,null),this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(h,o,f?500:1)),!1;Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(e.Value==Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(o,i),"no edge exists between an existing nextExtendVertex and spliceTarget",this.get_ObstacleTree(),this.get_VisGraph())}else Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(null==e.Value||i==Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(s,e.Value.Point),"spliceTarget is not to spliceTargetDir of nextExtendVertex",this.get_ObstacleTree(),this.get_VisGraph()),o=this.AddVertex(s);if(this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(h,o,f?500:1),this.Debug_VerifyNonOverlappedExtension(f,h,o,n,e.Value),this.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(n,o,f?500:1),f&&(f=this.SeeIfSpliceIsStillOverlapped(t,o)),h=o,Microsoft.Msagl.Core.Geometry.Directions.None==(t&Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(s,r.get_End()))){e.Value=null;break}}return null!=e.Value},Debug_VerifyNonOverlappedExtension:function(n,t,i,r,u){n||(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(!this.get_ObstacleTree().SegmentCrossesANonGroupObstacle(t.Point,i.Point),"extendDir edge crosses an obstacle",this.get_ObstacleTree(),this.get_VisGraph()),r!=null)&&(null==u||null==this.get_VisGraph().FindEdge$$Point$$Point(r.Point,u.Point)&&null==this.get_VisGraph().FindEdge$$Point$$Point(r.Point,i.Point))&&(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(!this.get_ObstacleTree().SegmentCrossesAnObstacle(r.Point,i.Point),"spliceSource->extendVertex edge crosses an obstacle",this.get_ObstacleTree(),this.get_VisGraph()),Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(null==u||null!=this.get_VisGraph().FindEdge$$Point$$Point(i.Point,u.Point)||!this.get_ObstacleTree().SegmentCrossesAnObstacle(i.Point,u.Point),"extendVertex->spliceTarget edge crosses an obstacle",this.get_ObstacleTree(),this.get_VisGraph()))},SeeIfSpliceIsStillOverlapped:function(n,t){var i=this.FindNextEdge(t,Microsoft.Msagl.Core.Geometry.CompassVector.RotateLeft(n)),r=null==i?!1:1==i.get_Weight();return r||(i=this.FindNextEdge(t,Microsoft.Msagl.Core.Geometry.CompassVector.RotateRight(n)),r=null==i?!1:1==i.get_Weight()),!r||this.get_ObstacleTree().PointIsInsideAnObstacle$$Point$$Directions(t.Point,n)},IsSkippableSpliceSourceWithNullSpliceTarget:function(n,t){if(Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility.IsSkippableSpliceSourceEdgeWithNullTarget(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextEdge(this.get_VisGraph(),n,t)))return!0;var i=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextEdge(this.get_VisGraph(),n,Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(t));return Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility.IsSkippableSpliceSourceEdgeWithNullTarget(i)||Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility.IsReflectionEdge(i)},toString:function(){return System.String.Format$$String$$Object$$Object("{0} {1}",this.AddedVertices.get_Count(),this.edgesToRestore.get_Count())}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$TransientGraphUtility);Microsoft$Msagl$Routing$Visibility$PortObstacleEvent={fullname:"Microsoft.Msagl.Routing.Visibility.PortObstacleEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.site=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor.call(this);this.site=n},Site$$:"Microsoft.Msagl.Core.Geometry.Point",get_Site:function(){return this.site}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$PortObstacleEvent);Microsoft$Msagl$Routing$Visibility$TollFreeVisibilityEdge={fullname:"Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge",baseTypeName:"Microsoft.Msagl.Routing.Visibility.VisibilityEdge",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$VisibilityVertex$$VisibilityVertex:function(n,t){Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex$$Double.call(this,n,t,0)},ctor$$VisibilityVertex$$VisibilityVertex$$Double:function(n,t,i){Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex$$Double.call(this,n,t,i)}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$TollFreeVisibilityEdge);Microsoft$Msagl$Routing$Rectilinear$EventQueue={fullname:"Microsoft.Msagl.Routing.Rectilinear.EventQueue",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(){this.scanDirection=null;this.eventTree=null;System.Object.ctor.call(this);this.eventTree=new Microsoft.Msagl.Core.DataStructures.BinaryHeapWithComparer$1.ctor(Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor,this)},Reset:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(0==this.eventTree.get_Count(),"Stray events in EventQueue.Reset");this.scanDirection=n},Enqueue:function(n){this.eventTree.Enqueue(n)},Dequeue:function(){return this.eventTree.Dequeue()},Count$$:"System.Int32",get_Count:function(){return this.eventTree.get_Count()},Compare:function(n,t){var i,r,u;return n==t?0:n==null?-1:t==null?1:(i=this.scanDirection.ComparePerpCoord(n.get_Site(),t.get_Site()),0==i&&(r=!Is(n,Microsoft.Msagl.Routing.Rectilinear.BasicReflectionEvent.ctor),u=!Is(t,Microsoft.Msagl.Routing.Rectilinear.BasicReflectionEvent.ctor),i=r.CompareTo$$Boolean(u),0==i&&(i=this.scanDirection.CompareScanCoord(n.get_Site(),t.get_Site()))),i)},DevTraceInfo:function(){}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$EventQueue);Microsoft$Msagl$Routing$Rectilinear$FreePoint={fullname:"Microsoft.Msagl.Routing.Rectilinear.FreePoint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.maxVisibilitySegmentsAndCrossings=new Array(4);this._Vertex=null;this._IsOverlapped=!1;this._OutOfBoundsDirectionFromGraph=Microsoft.Msagl.Core.Geometry.Directions.None;System.Object.ctor.call(this);this.set_OutOfBoundsDirectionFromGraph(Microsoft.Msagl.Core.Geometry.Directions.None);this.GetVertex(n,t)},Vertex$$:"Microsoft.Msagl.Routing.Visibility.VisibilityVertex",get_Vertex:function(){return this._Vertex},set_Vertex:function(n){this._Vertex=n},Point$$:"Microsoft.Msagl.Core.Geometry.Point",get_Point:function(){return this.get_Vertex().Point},IsOverlapped$$:"System.Boolean",get_IsOverlapped:function(){return this._IsOverlapped},set_IsOverlapped:function(n){this._IsOverlapped=n},InitialWeight$$:"System.Double",get_InitialWeight:function(){return this.get_IsOverlapped()?500:1},OutOfBoundsDirectionFromGraph$$:"Microsoft.Msagl.Core.Geometry.Directions",get_OutOfBoundsDirectionFromGraph:function(){return this._OutOfBoundsDirectionFromGraph},set_OutOfBoundsDirectionFromGraph:function(n){this._OutOfBoundsDirectionFromGraph=n},IsOutOfBounds$$:"System.Boolean",get_IsOutOfBounds:function(){return Microsoft.Msagl.Core.Geometry.Directions.None!=this.get_OutOfBoundsDirectionFromGraph()},GetVertex:function(n,t){this.set_Vertex(n.FindOrAddVertex(t))},AddEdgeToAdjacentEdge:function(n,t,i,r){var f=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SegmentIntersection$$VisibilityEdge$$Point(t,this.get_Point()),u=n.get_VisGraph().FindVertex(f);return null!=u?this.AddToAdjacentVertex(n,u,i,r):u=n.AddEdgeToTargetEdge(this.get_Vertex(),t,f),this.ExtendEdgeChain(n,u,i,r),u},AddToAdjacentVertex:function(n,t,i,r){Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(this.get_Point(),t.Point)||n.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(this.get_Vertex(),t,this.get_InitialWeight());this.ExtendEdgeChain(n,t,i,r)},ExtendEdgeChain:function(n,t,i,r){var u,f;Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(this.get_Point(),t.Point)||Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(this.get_Point(),t.Point)==i,"input dir does not match with to-targetVertex direction",n.get_ObstacleTree(),n.get_VisGraph());u=this.get_IsOverlapped();u&&(u=n.get_ObstacleTree().PointIsInsideAnObstacle$$Point$$Directions(t.Point,i));f=this.GetSegmentAndCrossings(this.get_IsOverlapped()?t:this.get_Vertex(),i,n);n.ExtendEdgeChain$$VisibilityVertex$$Rectangle$$LineSegment$$PointAndCrossingsList$$Boolean(t,r,f.get_Item1(),f.get_Item2(),u)},GetSegmentAndCrossings:function(n,t,i){var f=Microsoft.Msagl.Core.Geometry.CompassVector.ToIndex(t),r=this.maxVisibilitySegmentsAndCrossings[f],u,e;return null==r?(e=function(){var r={Value:u},f=i.get_ObstacleTree().CreateMaxVisibilitySegment(n.Point,t,r);return u=r.Value,f}.call(this),r=new System.Tuple$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor,Microsoft.Msagl.Routing.Rectilinear.PointAndCrossingsList.ctor,e,u),this.maxVisibilitySegmentsAndCrossings[f]=r):Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n.Point,r.get_Item1().get_Start())==t&&r.get_Item1().set_Start(n.Point),r},MaxVisibilityInDirectionForNonOverlappedFreePoint:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(!this.get_IsOverlapped(),"Do not precalculate overlapped obstacle visibility as we should extend from the outer target vertex instead");var i=this.GetSegmentAndCrossings(this.get_Vertex(),n,t);return i.get_Item1().get_End()},AddOobEdgesFromGraphCorner:function(n,t){var i=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(t,this.get_Vertex().Point),r=n.get_VisGraph().FindVertex(t);n.ConnectVertexToTargetVertex(r,this.get_Vertex(),i&5,1);n.ConnectVertexToTargetVertex(r,this.get_Vertex(),i&10,1)},RemoveFromGraph:function(){this.set_Vertex(null)},toString:function(){return this.get_Vertex().toString()}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$FreePoint);Microsoft$Msagl$Routing$Rectilinear$HighObstacleSide={fullname:"Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide",baseTypeName:"Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide.ctor.call(this,n,t,i,i.get_IsVertical())}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$HighObstacleSide);Microsoft$Msagl$Routing$Rectilinear$LowReflectionEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.LowReflectionEvent",baseTypeName:"Microsoft.Msagl.Routing.Rectilinear.BasicReflectionEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this._Side=null;Microsoft.Msagl.Routing.Rectilinear.BasicReflectionEvent.ctor$$BasicReflectionEvent$$Obstacle$$Point.call(this,n,t.get_Obstacle(),i);this.set_Side(t)},Side$$:"Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide",get_Side:function(){return this._Side},set_Side:function(n){this._Side=n}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$LowReflectionEvent);Microsoft$Msagl$Routing$Rectilinear$LookaheadScan={fullname:"Microsoft.Msagl.Routing.Rectilinear.LookaheadScan",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.eventTree=null;this.findFirstPred=null;this.scanDirection=null;this.staleSites=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.BasicReflectionEvent.ctor);this.findFirstPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.scanDirection=n;this.eventTree=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Rectilinear.BasicReflectionEvent.ctor,this);this.findFirstPred=$CreateAnonymousDelegate(this,function(n){return this.CompareToFindFirstPoint(n.get_Site())>=0})},Add:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(null==this.Find(n.get_Site()),"Should not add the same Lookahead coordinate twice");this.eventTree.Insert(n)},MarkStaleSite:function(n){this.staleSites.Add(n)},RemoveStaleSites:function(){var t=this.staleSites.get_Count(),n;if(t>0){for(n=0;n<t;++n)this.RemoveExact(this.staleSites.get_Item$$Int32(n));this.staleSites.Clear()}},RemoveSitesForFlatBottom:function(n,t){for(var i=this.FindFirstInRange(n,t);null!=i;i=this.FindNextInRange(i,t))this.MarkStaleSite(i.Item);this.RemoveStaleSites()},Find:function(n){return this.FindFirstInRange(n,n)},RemoveExact:function(n){var t=this.eventTree.Find$$T(n);return null!=t&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(t.Item.get_Site(),n.get_Site())?(this.eventTree.DeleteNodeInternal(t),!0):!1},FindFirstInRange:function(n,t){this.findFirstPoint=n;var i=this.eventTree.FindFirst$$Func$2(this.findFirstPred);return null!=i&&this.Compare$$Point$$Point(i.Item.get_Site(),t)<=0?i:null},CompareToFindFirstPoint:function(n){return this.Compare$$Point$$Point(n,this.findFirstPoint)},FindNextInRange:function(n,t){var i=this.eventTree.Next(n);return null!=i&&this.Compare$$Point$$Point(i.Item.get_Site(),t)<=0?i:null},Compare$$BasicReflectionEvent$$BasicReflectionEvent:function(n,t){return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"lhs"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"rhs"),this.scanDirection.CompareScanCoord(n.get_Site(),t.get_Site())},Compare$$Point$$Point:function(n,t){return this.scanDirection.CompareScanCoord(n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$LookaheadScan);Microsoft$Msagl$Routing$Rectilinear$LowObstacleSide={fullname:"Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide",baseTypeName:"Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide.ctor.call(this,n,t,i,i.get_IsHorizontal())}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$LowObstacleSide);Microsoft$Msagl$Routing$Rectilinear$MsmtRectilinearPath={fullname:"Microsoft.Msagl.Routing.Rectilinear.MsmtRectilinearPath",baseTypeName:"System.Object",staticDefinition:{RestorePathStages:function(n,t){var i=new System.Collections.Generic.List$1.ctor(System.Collections.Generic.IEnumerable$1.ctor),r,u;for(n.Reverse(),r=n.GetEnumerator();r.MoveNext();)u=r.get_Current(),i.Add(function(){var n={Value:t},i=Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.RestorePath$$VertexEntry$$VisibilityVertex(n,u.waypointVector[0]);return t=n.Value,i}());return i.Add(Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.RestorePath$$VertexEntry(t)),i.Reverse(),i},UpdateTargetEntriesForEachDirection:function(n,t,i,r){for(var f,u=0;u<t.length;++u)(f=t[u],f!=null)&&(n[u]==null||f.get_Cost()<n[u].get_Cost())&&(n[u]=f,f.get_Cost()<i.Value&&(i.Value=f.get_Cost(),r.Value=f));return},GetBarycenterOfUniquePortLocations:function(n){for(var i=new Microsoft.Msagl.Core.Geometry.Point.ctor,r=null,u=0,f=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,n,function(n){return n.Point}).GetEnumerator(),t;f.MoveNext();)(t=f.get_Current(),r!=null&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(t.Point,r.Point))||(r=t,++u,i=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,t.Point));return Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(i,u)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.bendPenaltyAsAPercentageOfDistance=4;this.currentPassTargetEntries=new Array(4);System.Object.ctor.call(this);this.bendPenaltyAsAPercentageOfDistance=n},GetPath$$IEnumerable$1$VisibilityVertex$$IEnumerable$1$VisibilityVertex:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.RestorePath$$VertexEntry(this.GetPathStage(null,n,null,t))},GetPath$$IEnumerable$1$VisibilityVertex$$IEnumerable$1$VisibilityVertex$$IEnumerable$1$VisibilityVertex:function(n,t,i){var u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.MsmtRectilinearPath.WaypointEntry.ctor),f=t.GetEnumerator(),r,e;return(f.MoveNext(),r=new Microsoft.Msagl.Routing.Rectilinear.MsmtRectilinearPath.WaypointEntry.ctor(f.get_Current()),u.Add(r),!this.GetFirstPathStage(r,n)||!function(){var n={Value:r},t=this.GetWaypointPathStages(f,u,n);return r=n.Value,t}.call(this)||!function(){var n={Value:e},t=this.GetLastPathStage(r,i,n);return e=n.Value,t}.call(this))?null:Microsoft.Msagl.Routing.Rectilinear.MsmtRectilinearPath.RestorePathStages(u,e)},GetFirstPathStage:function(n,t){return null!=this.GetPathStage(null,t,n.entryVector,n.waypointVector)},GetWaypointPathStages:function(n,t,i){while(n.MoveNext()){var r=new Microsoft.Msagl.Routing.Rectilinear.MsmtRectilinearPath.WaypointEntry.ctor(n.get_Current());if(t.Add(r),null==this.GetPathStage(i.Value.entryVector,i.Value.waypointVector,r.entryVector,r.waypointVector))return!1;i.Value=r}return!0},GetLastPathStage:function(n,t,i){return i.Value=this.GetPathStage(n.entryVector,n.waypointVector,null,t),i.Value!=null},GetPathStage:function(n,t,i,r){var h=new Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.ctor,c=null,f=359538626972463e291,l=Infinity,a=Microsoft.Msagl.Routing.Rectilinear.MsmtRectilinearPath.GetBarycenterOfUniquePortLocations(t),v=Microsoft.Msagl.Routing.Rectilinear.MsmtRectilinearPath.GetBarycenterOfUniquePortLocations(r),d=Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.ManhattanDistance(a,v),u,k;h.set_BendsImportance(System.Math.Max$$Double$$Double(.001,d*this.bendPenaltyAsAPercentageOfDistance*.01));for(var y=h.get_LengthImportance(),e=i!=null?this.currentPassTargetEntries:null,p=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,null,System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(null,System.Double.ctor,System.Linq.Enumerable.SelectMany$3$$IEnumerable$1$$Func$2$$Func$3(Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear.ctor,Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear.ctor,null,System.Linq.Enumerable.Cast$1(Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear.ctor,t),$CreateAnonymousDelegate(this,function(){return System.Linq.Enumerable.Cast$1(Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear.ctor,r)}),$CreateAnonymousDelegate(this,function(n,t){return $CreateAnonymousObject({source:n,target:t})})),$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.ManhattanDistance(n.get_source().Point,n.get_target().Point)})),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({sourceV:n.get_source(),targetV:n.get_target()})})).GetEnumerator();p.MoveNext();){var w=p.get_Current(),o=w.get_sourceV(),s=w.get_targetV();if(!Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(o.Point,s.Point)){var g=Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.ManhattanDistance(o.Point,a)*y,nt=Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.ManhattanDistance(s.Point,v)*y,b=f;if(i!=null&&(System.Array.Clear(e,0,e.length),b=h.MultistageAdjustedCostBound(f)),u=h.GetPathWithCost(n,o,g,e,s,nt,b),e!=null){(function(){var n={Value:f},t={Value:c},r=Microsoft.Msagl.Routing.Rectilinear.MsmtRectilinearPath.UpdateTargetEntriesForEachDirection(i,e,n,t);return f=n.Value,c=t.Value,r}).call(this);continue}u!=null&&(k=u.get_Cost()/Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.ManhattanDistance(o.Point,s.Point),(u.get_Cost()<f||Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(u.get_Cost(),f)&&k<l)&&(f=u.get_Cost(),c=u,l=u.get_Cost()/Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.ManhattanDistance(o.Point,s.Point)))}}return c}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$MsmtRectilinearPath);Microsoft$Msagl$Routing$Rectilinear$Obstacle={fullname:"Microsoft.Msagl.Routing.Rectilinear.Obstacle",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Rectilinear.Obstacle.FirstSentinelOrdinal=1;Microsoft.Msagl.Routing.Rectilinear.Obstacle.FirstNonSentinelOrdinal=10},CreateLoosePolyline:function(n){var t=Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CreatePaddedPolyline(n,Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()*10);return Microsoft.Msagl.Routing.Rectilinear.Obstacle.RoundVertices(t),t},CreateSentinel:function(n,t,i,r){var u=new Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor$$Point$$Point$$Int32(n,t,r);return u.CreateInitialSides(u.get_PaddedPolyline().get_StartPoint(),i),u},RoundVertices:function(n){var t=n.get_StartPoint();do t.set_Point(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(t.get_Point())),t=t.get_NextOnPolyline();while(t!=n.get_StartPoint());Microsoft.Msagl.Routing.Rectilinear.Obstacle.RemoveCloseAndCollinearVerticesInPlace(n);n.RequireInit();System.Diagnostics.Debug.Assert$$Boolean$$String(n.IsClockwise(),"Polyline is not clockwise after RoundVertices")},RemoveCloseAndCollinearVerticesInPlace:function(n){for(var i=Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()*10,t=n.get_StartPoint().get_Next();t!=null;t=t.get_Next())Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point$$Double(t.get_Prev().get_Point(),t.get_Point(),i)&&(t.get_Next()==null?n.RemoveEndPoint():(t.get_Prev().set_Next(t.get_Next()),t.get_Next().set_Prev(t.get_Prev())));return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point$$Double(n.get_Start(),n.get_End(),i)&&n.RemoveStartPoint(),Microsoft.Msagl.Routing.InteractiveEdgeRouter.RemoveCollinearVertices(n),n.get_EndPoint().get_Prev()!=null&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n.get_EndPoint().get_Prev().get_Point(),n.get_End(),n.get_Start())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear&&n.RemoveEndPoint(),n.get_StartPoint().get_Next()!=null&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n.get_End(),n.get_Start(),n.get_StartPoint().get_Next().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear&&n.RemoveStartPoint(),n}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Shape$$Boolean$$Double:function(n,t,i){if(this.looseVisibilityPolyline=null,this._ActiveLowSide=null,this._ActiveHighSide=null,this._InputShape=null,this._IsRectangle=!1,this._PaddedPolyline=null,this._Ordinal=0,this._Clump=null,this._OverlapsGroupCorner=!1,this._ConvexHull=null,this._Ports=null,System.Object.ctor.call(this),t){var r=n.get_BoundingBox().Clone();r.Pad$$Double(i);this.set_PaddedPolyline(Microsoft.Msagl.Core.Geometry.Curves.Curve.PolyFromBox(r))}else this.set_PaddedPolyline(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.PaddedPolylineBoundaryOfNode(n.get_BoundaryCurve(),i));Microsoft.Msagl.Routing.Rectilinear.Obstacle.RoundVertices(this.get_PaddedPolyline());this.set_IsRectangle(this.IsPolylineRectangle());this.get_IsRectangle()||this.ConvertToRectangleIfClose();this.set_InputShape(n);this.set_Ports(new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Port.ctor,this.get_InputShape().get_Ports()))},ctor$$Point$$Point$$Int32:function(n,t,i){this.looseVisibilityPolyline=null;this._ActiveLowSide=null;this._ActiveHighSide=null;this._InputShape=null;this._IsRectangle=!1;this._PaddedPolyline=null;this._Ordinal=0;this._Clump=null;this._OverlapsGroupCorner=!1;this._ConvexHull=null;this._Ports=null;System.Object.ctor.call(this);this.set_PaddedPolyline(function(){var i=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(t));return i.set_Closed(!0),i}.call(this));this.set_Ordinal(i)},ActiveLowSide$$:"Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide",get_ActiveLowSide:function(){return this._ActiveLowSide},set_ActiveLowSide:function(n){this._ActiveLowSide=n},ActiveHighSide$$:"Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide",get_ActiveHighSide:function(){return this._ActiveHighSide},set_ActiveHighSide:function(n){this._ActiveHighSide=n},InputShape$$:"Microsoft.Msagl.Routing.Shape",get_InputShape:function(){return this._InputShape},set_InputShape:function(n){this._InputShape=n},IsRectangle$$:"System.Boolean",get_IsRectangle:function(){return this._IsRectangle},set_IsRectangle:function(n){this._IsRectangle=n},PaddedPolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_PaddedPolyline:function(){return this._PaddedPolyline},set_PaddedPolyline:function(n){this._PaddedPolyline=n},VisibilityPolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_VisibilityPolyline:function(){return this.get_ConvexHull()!=null?this.get_ConvexHull().get_Polyline():this.get_PaddedPolyline()},LooseVisibilityPolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_LooseVisibilityPolyline:function(){return this.looseVisibilityPolyline==null&&(this.looseVisibilityPolyline=Microsoft.Msagl.Routing.Rectilinear.Obstacle.CreateLoosePolyline(this.get_VisibilityPolyline())),this.looseVisibilityPolyline},PaddedBoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_PaddedBoundingBox:function(){return this.get_PaddedPolyline().get_BoundingBox()},VisibilityBoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_VisibilityBoundingBox:function(){return this.get_VisibilityPolyline().get_BoundingBox()},IsGroup$$:"System.Boolean",get_IsGroup:function(){return null!=this.get_InputShape()&&this.get_InputShape().get_IsGroup()},IsTransparentAncestor$$:"System.Boolean",get_IsTransparentAncestor:function(){return this.get_InputShape()==null?!1:this.get_InputShape().get_IsTransparent()},set_IsTransparentAncestor:function(n){if(this.get_InputShape()==null)throw $CreateException(new System.InvalidOperationException.ctor,new Error);this.get_InputShape().set_IsTransparent(n)},Ordinal$$:"System.Int32",get_Ordinal:function(){return this._Ordinal},set_Ordinal:function(n){this._Ordinal=n},Clump$$:"Microsoft.Msagl.Routing.Rectilinear.Clump",get_Clump:function(){return this._Clump},set_Clump:function(n){this._Clump=n},IsOverlapped$$:"System.Boolean",get_IsOverlapped:function(){return System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_Clump()==null||!this.get_IsGroup(),"Groups should not be considered overlapped"),System.Diagnostics.Debug.Assert$$Boolean$$String(this.get_Clump()==null||this.get_ConvexHull()==null,"Clumped obstacles should not have overlapped convex hulls"),this.get_Clump()!=null},IsInSameClump:function(n){return this.get_IsOverlapped()&&this.get_Clump()==n.get_Clump()},OverlapsGroupCorner$$:"System.Boolean",get_OverlapsGroupCorner:function(){return this._OverlapsGroupCorner},set_OverlapsGroupCorner:function(n){this._OverlapsGroupCorner=n},IsPrimaryObstacle$$:"System.Boolean",get_IsPrimaryObstacle:function(){return this.get_ConvexHull()==null||this==this.get_ConvexHull().get_PrimaryObstacle()},ConvexHull$$:"Microsoft.Msagl.Routing.Rectilinear.OverlapConvexHull",get_ConvexHull:function(){return this._ConvexHull},set_ConvexHull:function(n){this._ConvexHull=n},IsInConvexHull$$:"System.Boolean",get_IsInConvexHull:function(){return this.get_ConvexHull()!=null},SetConvexHull:function(n){this.set_Clump(null);this.set_IsRectangle(!1);this.set_ConvexHull(n);this.looseVisibilityPolyline=null},Ports$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Layout.Port]]",get_Ports:function(){return this._Ports},set_Ports:function(n){this._Ports=n},IsSentinel$$:"System.Boolean",get_IsSentinel:function(){return null==this.get_InputShape()},CreateInitialSides:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(null==this.get_ActiveLowSide()&&null==this.get_ActiveHighSide(),"Cannot call SetInitialSides when sides are already set");this.set_ActiveLowSide(new Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor(this,n,t));this.set_ActiveHighSide(new Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide.ctor(this,n,t));t.IsFlat$$SegmentBase(this.get_ActiveHighSide())&&this.set_ActiveHighSide(new Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide.ctor(this,this.get_ActiveHighSide().get_EndVertex(),t))},Close:function(){this.set_ActiveLowSide(null);this.set_ActiveHighSide(null)},IsPolylineRectangle:function(){var r;if(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor,this.get_PaddedPolyline().get_PolylinePoints())!=4)return!1;var n=this.get_PaddedPolyline().get_StartPoint(),t=n.get_NextOnPolyline(),i=Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(n.get_Point(),t.get_Point());if(!Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(i))return!1;do{if(n=t,t=n.get_NextOnPolyline(),r=Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(n.get_Point(),t.get_Point()),r!=Microsoft.Msagl.Core.Geometry.CompassVector.RotateRight(i))return!1;i=r}while(n!=this.get_PaddedPolyline().get_StartPoint());return!0},ConvertToRectangleIfClose:function(){var f,e,r,o;if(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor,this.get_PaddedPolyline().get_PolylinePoints())==4){var n=this.get_PaddedPolyline().get_StartPoint(),t=n.get_NextOnPolyline(),i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Point(),t.get_Point()),u=i.get_X()==0||i.get_Y()==0?0:System.Math.Abs$$Double(i.get_Y()/i.get_X());if(!(u<1e3)||!(u>.001)){f=1.5707963267949;e=.0015707963267949;do{if(r=t.get_NextOnPolyline(),o=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point$$Point(n.get_Point(),t.get_Point(),r.get_Point()),System.Math.Abs$$Double(f-o)>e)return;n=t;t=r}while(n!=this.get_PaddedPolyline().get_StartPoint());this.set_PaddedPolyline(Microsoft.Msagl.Core.Geometry.Curves.Curve.PolyFromBox(this.get_PaddedPolyline().get_BoundingBox()));this.set_IsRectangle(!0);System.Diagnostics.Debug.Assert$$Boolean$$String(this.IsPolylineRectangle(),"PaddedPolyline is not rectangular");return}}},GetPortChanges:function(n,t){return(n.Value=Microsoft.Msagl.Core.DataStructures.Set$1.op_Subtraction(this.get_InputShape().get_Ports(),this.get_Ports()),t.Value=Microsoft.Msagl.Core.DataStructures.Set$1.op_Subtraction(this.get_Ports(),this.get_InputShape().get_Ports()),0==n.Value.get_Count()&&0==t.Value.get_Count())?!1:(this.set_Ports(new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Port.ctor,this.get_InputShape().get_Ports())),!0)},toString:function(){var n=this.GetType().toString(),t=n.lastIndexOf(".");return t>=0&&(n=n.substr(t+1)),n+" ["+this.get_InputShape()+"]"}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Obstacle);Microsoft$Msagl$Routing$Rectilinear$ObstaclePort={fullname:"Microsoft.Msagl.Routing.Rectilinear.ObstaclePort",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.CenterVertex=null;this.VisibilityRectangle=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox();this._Port=null;this._Obstacle=null;this._PortEntrances=null;this._HasCollinearEntrances=!1;this._Location=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.set_Port(n);this.set_Obstacle(t);this.set_PortEntrances(new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.ObstaclePortEntrance.ctor));this.set_Location(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(this.get_Port().get_Location()))},Port$$:"Microsoft.Msagl.Core.Layout.Port",get_Port:function(){return this._Port},set_Port:function(n){this._Port=n},Obstacle$$:"Microsoft.Msagl.Routing.Rectilinear.Obstacle",get_Obstacle:function(){return this._Obstacle},set_Obstacle:function(n){this._Obstacle=n},PortEntrances$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Rectilinear.ObstaclePortEntrance]]",get_PortEntrances:function(){return this._PortEntrances},set_PortEntrances:function(n){this._PortEntrances=n},HasCollinearEntrances$$:"System.Boolean",get_HasCollinearEntrances:function(){return this._HasCollinearEntrances},set_HasCollinearEntrances:function(n){this._HasCollinearEntrances=n},Location$$:"Microsoft.Msagl.Core.Geometry.Point",get_Location:function(){return this._Location},set_Location:function(n){this._Location=n},CreatePortEntrance:function(n,t,i){var r=new Microsoft.Msagl.Routing.Rectilinear.ObstaclePortEntrance.ctor(this,n,t,i);this.get_PortEntrances().Add(r);this.VisibilityRectangle.Add$$Point(r.get_MaxVisibilitySegment().get_End());this.set_HasCollinearEntrances(this.get_HasCollinearEntrances()|r.get_IsCollinearWithPort())},ClearVisibility:function(){this.get_PortEntrances().Clear()},AddToGraph:function(n,t){t&&(this.CenterVertex=n.FindOrAddVertex(this.get_Location()))},RemoveFromGraph:function(){for(var n=this.get_PortEntrances().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.RemoveFromGraph();this.CenterVertex=null},LocationHasChanged$$:"System.Boolean",get_LocationHasChanged:function(){return!Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(this.get_Location(),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(this.get_Port().get_Location()))},PortCurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_PortCurve:function(){return this.get_Port().get_Curve()},PortLocation$$:"Microsoft.Msagl.Core.Geometry.Point",get_PortLocation:function(){return this.get_Port().get_Location()},toString:function(){return this.get_Port()+this.get_Obstacle().toString()}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$ObstaclePort);Microsoft$Msagl$Routing$Rectilinear$ObstaclePortEntrance={fullname:"Microsoft.Msagl.Routing.Rectilinear.ObstaclePortEntrance",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.unpaddedToPaddedBorderWeight=1;this.pointAndCrossingsList=null;this._ObstaclePort=null;this._UnpaddedBorderIntersect=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._OutwardDirection=Microsoft.Msagl.Core.Geometry.Directions.None;this._VisibilityBorderIntersect=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._IsOverlapped=!1;this._MaxVisibilitySegment=null;System.Object.ctor.call(this);this.set_ObstaclePort(n);this.set_UnpaddedBorderIntersect(t);this.set_OutwardDirection(i);var f=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_UnpaddedBorderIntersect(),Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.RectangleBorderIntersect(n.get_Obstacle().get_VisibilityBoundingBox(),this.get_UnpaddedBorderIntersect(),i)),u=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(f,n.get_Obstacle().get_VisibilityPolyline(),!0);System.Diagnostics.Debug.Assert$$Boolean$$String(1==u.get_Count(),"Expected one intersection");this.set_VisibilityBorderIntersect(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.RawIntersection(u.get_Item$$Int32(0),this.get_UnpaddedBorderIntersect())));this.set_MaxVisibilitySegment(function(){var n={Value:this.pointAndCrossingsList},t=r.CreateMaxVisibilitySegment(this.get_VisibilityBorderIntersect(),this.get_OutwardDirection(),n);return this.pointAndCrossingsList=n.Value,t}.call(this));(this.get_Obstacle().get_IsOverlapped()||this.get_Obstacle().get_IsGroup()&&!this.get_Obstacle().get_IsInConvexHull())&&(this.set_IsOverlapped(r.IntersectionIsInsideAnotherObstacle(null,this.get_Obstacle(),this.get_VisibilityBorderIntersect(),Microsoft.Msagl.Routing.Rectilinear.ScanDirection.GetInstance(this.get_OutwardDirection()))),(!this.get_Obstacle().get_IsGroup()||this.get_IsOverlapped()||this.InteriorEdgeCrossesObstacle$$ObstacleTree(r))&&(this.unpaddedToPaddedBorderWeight=500));this.get_Obstacle().get_IsInConvexHull()&&this.unpaddedToPaddedBorderWeight==1&&this.SetUnpaddedToPaddedBorderWeightFromHullSiblingOverlaps(r)},ObstaclePort$$:"Microsoft.Msagl.Routing.Rectilinear.ObstaclePort",get_ObstaclePort:function(){return this._ObstaclePort},set_ObstaclePort:function(n){this._ObstaclePort=n},Obstacle$$:"Microsoft.Msagl.Routing.Rectilinear.Obstacle",get_Obstacle:function(){return this.get_ObstaclePort().get_Obstacle()},UnpaddedBorderIntersect$$:"Microsoft.Msagl.Core.Geometry.Point",get_UnpaddedBorderIntersect:function(){return this._UnpaddedBorderIntersect},set_UnpaddedBorderIntersect:function(n){this._UnpaddedBorderIntersect=n},OutwardDirection$$:"Microsoft.Msagl.Core.Geometry.Directions",get_OutwardDirection:function(){return this._OutwardDirection},set_OutwardDirection:function(n){this._OutwardDirection=n},VisibilityBorderIntersect$$:"Microsoft.Msagl.Core.Geometry.Point",get_VisibilityBorderIntersect:function(){return this._VisibilityBorderIntersect},set_VisibilityBorderIntersect:function(n){this._VisibilityBorderIntersect=n},IsOverlapped$$:"System.Boolean",get_IsOverlapped:function(){return this._IsOverlapped},set_IsOverlapped:function(n){this._IsOverlapped=n},InitialWeight$$:"System.Double",get_InitialWeight:function(){return this.get_IsOverlapped()?500:1},IsCollinearWithPort$$:"System.Boolean",get_IsCollinearWithPort:function(){return Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(this.get_VisibilityBorderIntersect(),this.get_ObstaclePort().get_Location()))},MaxVisibilitySegment$$:"Microsoft.Msagl.Core.Geometry.Curves.LineSegment",get_MaxVisibilitySegment:function(){return this._MaxVisibilitySegment},set_MaxVisibilitySegment:function(n){this._MaxVisibilitySegment=n},IsVertical$$:"System.Boolean",get_IsVertical:function(){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$LineSegment(this.get_MaxVisibilitySegment())},WantVisibilityIntersection$$:"System.Boolean",get_WantVisibilityIntersection:function(){return!this.get_IsOverlapped()&&this.get_CanExtend()&&(!this.get_ObstaclePort().get_HasCollinearEntrances()||this.get_IsCollinearWithPort())},CanExtend$$:"System.Boolean",get_CanExtend:function(){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(this.get_MaxVisibilitySegment().get_Start(),this.get_MaxVisibilitySegment().get_End())!=Microsoft.Msagl.Core.Geometry.Directions.None},SetUnpaddedToPaddedBorderWeightFromHullSiblingOverlaps:function(n){(this.get_Obstacle().get_IsGroup()?this.InteriorEdgeCrossesObstacle$$ObstacleTree(n):this.InteriorEdgeCrossesConvexHullSiblings())&&(this.unpaddedToPaddedBorderWeight=500)},InteriorEdgeCrossesObstacle$$ObstacleTree:function(n){var t=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(this.get_UnpaddedBorderIntersect(),this.get_VisibilityBorderIntersect());return this.InteriorEdgeCrossesObstacle$$Rectangle$$Func$2$Obstacle$Polyline$$IEnumerable$1$Obstacle(t,$CreateAnonymousDelegate(this,function(n){return n.get_VisibilityPolyline()}),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n.get_Root().GetLeafRectangleNodesIntersectingRectangle(t),$CreateAnonymousDelegate(this,function(n){return!n.get_UserData().get_IsGroup()&&n.get_UserData()!=this.get_Obstacle()})),$CreateAnonymousDelegate(this,function(n){return n.get_UserData()})))},InteriorEdgeCrossesConvexHullSiblings:function(){var n=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(this.get_UnpaddedBorderIntersect(),this.get_VisibilityBorderIntersect());return this.InteriorEdgeCrossesObstacle$$Rectangle$$Func$2$Obstacle$Polyline$$IEnumerable$1$Obstacle(n,$CreateAnonymousDelegate(this,function(n){return n.get_PaddedPolyline()}),System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,this.get_Obstacle().get_ConvexHull().get_Obstacles(),$CreateAnonymousDelegate(this,function(n){return n!=this.get_Obstacle()})))},InteriorEdgeCrossesObstacle$$Rectangle$$Func$2$Obstacle$Polyline$$IEnumerable$1$Obstacle:function(n,t,i){for(var r=null,f=i.GetEnumerator(),e,u,o;f.MoveNext();)if((e=f.get_Current(),u=t(e),Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.RectangleInteriorsIntersect(n,u.get_BoundingBox()))&&((r=r!=null?r:new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_UnpaddedBorderIntersect(),this.get_VisibilityBorderIntersect()),o=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(r,u,!1),o!=null)||Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside!=Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(this.get_UnpaddedBorderIntersect(),u)))return!0;return!1},HasGroupCrossings$$:"System.Boolean",get_HasGroupCrossings:function(){return this.pointAndCrossingsList!=null&&this.pointAndCrossingsList.get_Count()>0},HasGroupCrossingBeforePoint:function(n){if(!this.get_HasGroupCrossings())return!1;var t=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsAscending(this.get_OutwardDirection())?this.pointAndCrossingsList.get_First():this.pointAndCrossingsList.get_Last();return Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(this.get_MaxVisibilitySegment().get_Start(),t.get_Location())==Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(t.get_Location(),n)},AddToAdjacentVertex:function(n,t,i,r){var u=n.get_VisGraph().FindVertex(this.get_VisibilityBorderIntersect());if(null!=u){this.ExtendFromBorderVertex(n,u,i,r);return}this.get_OutwardDirection()==Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(t.Point,this.get_VisibilityBorderIntersect())?(System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"Unexpected reversed direction between VisibilityBorderIntersect and targetVertex"),this.set_VisibilityBorderIntersect(t.Point),u=t):(u=n.FindOrAddVertex(this.get_VisibilityBorderIntersect()),n.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(u,t,this.get_InitialWeight()));this.ExtendEdgeChain(n,u,t,i,r)},ExtendFromBorderVertex:function(n,t,i,r){this.ExtendEdgeChain(n,t,t,i,r)},ExtendEdgeChain:function(n,t,i,r,u){n.ExtendEdgeChain$$VisibilityVertex$$Rectangle$$LineSegment$$PointAndCrossingsList$$Boolean(i,r,this.get_MaxVisibilitySegment(),this.pointAndCrossingsList,this.get_IsOverlapped());var f=n.FindOrAddVertex(this.get_UnpaddedBorderIntersect());n.FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(f,t,this.unpaddedToPaddedBorderWeight);u&&n.ConnectVertexToTargetVertex(this.get_ObstaclePort().CenterVertex,f,this.get_OutwardDirection(),this.get_InitialWeight())},RemoveFromGraph:function(){},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0} {1}~{2} {3}",[this.get_ObstaclePort().get_Location(),this.get_UnpaddedBorderIntersect(),this.get_VisibilityBorderIntersect(),this.get_OutwardDirection()])}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$ObstaclePortEntrance);Microsoft$Msagl$Routing$Rectilinear$PortManager={fullname:"Microsoft.Msagl.Routing.Rectilinear.PortManager",baseTypeName:"System.Object",staticDefinition:{GetPathPointsFromOverlappingCollinearVisibility:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IntervalsAreSame(n.get_MaxVisibilitySegment().get_Start(),n.get_MaxVisibilitySegment().get_End(),t.get_MaxVisibilitySegment().get_End(),t.get_MaxVisibilitySegment().get_Start())?n.get_HasGroupCrossings()||t.get_HasGroupCrossings()?null:Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n.get_UnpaddedBorderIntersect(),t.get_UnpaddedBorderIntersect())?null:[n.get_UnpaddedBorderIntersect(),t.get_UnpaddedBorderIntersect()]:null},GetPathPointsFromIntersectingVisibility:function(n,t){var i;return function(){var r={Value:i},u=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SegmentsIntersect$$LineSegment$$LineSegment$$Point(n.get_MaxVisibilitySegment(),t.get_MaxVisibilitySegment(),r);return i=r.Value,u}()?n.HasGroupCrossingBeforePoint(i)||t.HasGroupCrossingBeforePoint(i)?null:[n.get_UnpaddedBorderIntersect(),i,t.get_UnpaddedBorderIntersect()]:null},GetDerivative:function(n,t){var r=n.get_PortCurve().ClosestParameter(t),i=n.get_PortCurve().Derivative(r),u=(n.get_PortCurve().get_ParStart()+n.get_PortCurve().get_ParEnd())/2;return Microsoft.Msagl.Routing.InteractiveObstacleCalculator.CurveIsClockwise(n.get_PortCurve(),n.get_PortCurve().get_Item$$Double(u))||(i=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(i)),i}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.obstaclePortMap=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Port.ctor,Microsoft.Msagl.Routing.Rectilinear.ObstaclePort.ctor);this.freePointMap=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.Rectilinear.FreePoint.ctor);this.freePointLocationsUsedByRouteEdges=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor);this.graphGenerator=null;this.obstaclePortsInGraph=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.ObstaclePort.ctor);this.freePointsInGraph=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Rectilinear.FreePoint.ctor);this.portSpliceLimitRectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.activeAncestors=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor);this._TransUtil=null;this._RouteToCenterOfObstacles=!1;System.Object.ctor.call(this);this.set_TransUtil(new Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility.ctor(n));this.graphGenerator=n},TransUtil$$:"Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility",get_TransUtil:function(){return this._TransUtil},set_TransUtil:function(n){this._TransUtil=n},RouteToCenterOfObstacles$$:"System.Boolean",get_RouteToCenterOfObstacles:function(){return this._RouteToCenterOfObstacles},set_RouteToCenterOfObstacles:function(n){this._RouteToCenterOfObstacles=n},LimitPortVisibilitySpliceToEndpointBoundingBox$$:"System.Boolean",get_LimitPortVisibilitySpliceToEndpointBoundingBox:function(){return this.get_TransUtil().get_LimitPortVisibilitySpliceToEndpointBoundingBox()},set_LimitPortVisibilitySpliceToEndpointBoundingBox:function(n){this.get_TransUtil().set_LimitPortVisibilitySpliceToEndpointBoundingBox(n)},VisGraph$$:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",get_VisGraph:function(){return this.graphGenerator.get_VisibilityGraph()},HScanSegments$$:"Microsoft.Msagl.Routing.Rectilinear.ScanSegmentTree",get_HScanSegments:function(){return this.graphGenerator.HorizontalScanSegments},VScanSegments$$:"Microsoft.Msagl.Routing.Rectilinear.ScanSegmentTree",get_VScanSegments:function(){return this.graphGenerator.VerticalScanSegments},ObstacleTree$$:"Microsoft.Msagl.Routing.Rectilinear.ObstacleTree",get_ObstacleTree:function(){return this.graphGenerator.ObstacleTree},AncestorSets$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Routing.Shape],[Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Routing.Shape]]]]",get_AncestorSets:function(){return this.get_ObstacleTree().AncestorSets},Clear:function(){this.get_TransUtil().RemoveFromGraph();this.obstaclePortMap.Clear()},CreateObstaclePorts:function(n){for(var t=n.get_Ports().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.CreateObstaclePort(n,i)},CreateObstaclePort:function(n,t){var i,r;return(System.Diagnostics.Debug.Assert$$Boolean$$String(!this.obstaclePortMap.ContainsKey(t),"Port is used by more than one obstacle"),null==t.get_Curve())?null:(i=Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(t.get_Location()),Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside==Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(i,n.get_InputShape().get_BoundaryCurve()))?null:n.get_InputShape().get_BoundaryCurve()!=t.get_Curve()&&Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside==Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(i,t.get_Curve())?null:(r=new Microsoft.Msagl.Routing.Rectilinear.ObstaclePort.ctor(t,n),this.obstaclePortMap.set_Item$$TKey(t,r),r)},FindVertices:function(n){var t=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor),i,r,f,u;if(function(){var t={Value:i},r=this.obstaclePortMap.TryGetValue(n,t);return i=t.Value,r}.call(this)){if(this.get_RouteToCenterOfObstacles())return t.Add(i.CenterVertex),t;for(r=i.get_PortEntrances().GetEnumerator();r.MoveNext();)f=r.get_Current(),u=this.get_VisGraph().FindVertex(f.get_UnpaddedBorderIntersect()),null!=u&&t.Add(u);return t}return t.Add(this.get_VisGraph().FindVertex(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n.get_Location()))),t},RemoveObstaclePorts:function(n){for(var t=n.get_Ports().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.RemoveObstaclePort(i)},RemoveObstaclePort:function(n){this.obstaclePortMap.Remove(n)},AddControlPointsToGraph:function(n,t){var i,r,u,f,e,o;this.GetPortSpliceLimitRectangle(n);this.activeAncestors.Clear();u=function(){var t={Value:i},r=this.FindAncestorsAndObstaclePort(n.get_SourcePort(),t);return i=t.Value,r}.call(this);f=function(){var t={Value:r},i=this.FindAncestorsAndObstaclePort(n.get_TargetPort(),t);return r=t.Value,i}.call(this);this.get_AncestorSets().get_Count()>0&&null!=i&&null!=r&&(e=Microsoft.Msagl.Core.DataStructures.Set$1.op_Subtraction(f,u),o=Microsoft.Msagl.Core.DataStructures.Set$1.op_Subtraction(u,f),this.ActivateAncestors(o,e,t));this.AddPortToGraph(n.get_SourcePort(),i);this.AddPortToGraph(n.get_TargetPort(),r);this.AddWaypointsToGraph(n)},AddWaypointsToGraph:function(n){var e,t,r;if(null!=n.get_Waypoints()){for(var i=null,u=null,f=n.get_Waypoints().GetEnumerator();f.MoveNext();){if(e=f.get_Current(),t=this.AddFreePointToGraph(e),u==null&&(u=t),!t.get_IsOutOfBounds()){i=null;continue}null!=i&&(this.get_ObstacleTree().get_GraphBox().Intersects(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(i.get_Point(),t.get_Point()))?Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureDirection$$Directions(t.get_OutOfBoundsDirectionFromGraph())&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureDirection$$Directions(i.get_OutOfBoundsDirectionFromGraph())&&i.get_OutOfBoundsDirectionFromGraph()!=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(t.get_OutOfBoundsDirectionFromGraph())&&this.get_TransUtil().ConnectVertexToTargetVertex(t.get_Vertex(),i.get_Vertex(),Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(t.get_OutOfBoundsDirectionFromGraph()),1):(r=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(i.get_Point(),t.get_Point()),Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(r)?this.get_TransUtil().ConnectVertexToTargetVertex(i.get_Vertex(),t.get_Vertex(),r,1):(this.get_TransUtil().ConnectVertexToTargetVertex(i.get_Vertex(),t.get_Vertex(),r&5,1),this.get_TransUtil().ConnectVertexToTargetVertex(i.get_Vertex(),t.get_Vertex(),r&10,1))));i=t}this.ConnectOobWaypointToEndpointVisibilityAtGraphBoundary(u,n.get_SourcePort());this.ConnectOobWaypointToEndpointVisibilityAtGraphBoundary(i,n.get_TargetPort())}},ConnectOobWaypointToEndpointVisibilityAtGraphBoundary:function(n,t){if(n!=null&&n.get_IsOutOfBounds()){var r=this.FindVertices(t),i=n.get_OutOfBoundsDirectionFromGraph()&5;this.ConnectToGraphAtPointsCollinearWithVertices(n,i,r);i=n.get_OutOfBoundsDirectionFromGraph()&10;this.ConnectToGraphAtPointsCollinearWithVertices(n,i,r)}},ConnectToGraphAtPointsCollinearWithVertices:function(n,t,i){var u,r;if(Microsoft.Msagl.Core.Geometry.Directions.None!=t)for(u=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(t),r=i.GetEnumerator();r.MoveNext();){var e=r.get_Current(),o=this.InBoundsGraphBoxIntersect(e.Point,t),f=this.get_VisGraph().FindVertex(o);f!=null&&this.get_TransUtil().ConnectVertexToTargetVertex(n.get_Vertex(),f,u,1)}},SetAllAncestorsActive:function(n,t){if(0==this.get_AncestorSets().get_Count())return!1;this.get_ObstacleTree().AdjustSpatialAncestors();this.ClearActiveAncestors();var i,r,u=function(){var t={Value:i},r=this.FindAncestorsAndObstaclePort(n.get_SourcePort(),t);return i=t.Value,r}.call(this),f=function(){var t={Value:r},i=this.FindAncestorsAndObstaclePort(n.get_TargetPort(),t);return r=t.Value,i}.call(this);return this.get_AncestorSets().get_Count()>0&&Microsoft.Msagl.Core.DataStructures.Set$1.op_Inequality(null,u)&&Microsoft.Msagl.Core.DataStructures.Set$1.op_Inequality(null,f)?(this.ActivateAncestors(u,f,t),!0):!1},SetAllGroupsActive:function(){var n,t;for(this.ClearActiveAncestors(),n=this.get_ObstacleTree().GetAllGroups().GetEnumerator();n.MoveNext();)t=n.get_Current(),t.set_IsTransparentAncestor(!0),this.activeAncestors.Add(t)},FindAncestorsAndObstaclePort:function(n,t){return(t.Value=this.FindObstaclePort(n),0==this.get_AncestorSets().get_Count())?null:null!=t.Value?this.get_AncestorSets().get_Item$$TKey(t.Value.get_Obstacle().get_InputShape()):new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,Microsoft.Msagl.Routing.Shape.ctor,this.get_ObstacleTree().get_Root().AllHitItems$$Rectangle$$Func$2(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(n.get_Location(),n.get_Location()),$CreateAnonymousDelegate(this,function(n){return n.get_IsGroup()})),$CreateAnonymousDelegate(this,function(n){return n.get_InputShape()})))},ActivateAncestors:function(n,t,i){for(var u=Microsoft.Msagl.Core.DataStructures.Set$1.op_Addition(n,t).GetEnumerator(),f,r;u.MoveNext();)f=u.get_Current(),r=i.get_Item$$TKey(f),System.Diagnostics.Debug.Assert$$Boolean$$String(r.get_IsGroup(),"Ancestor shape is not a group"),r.set_IsTransparentAncestor(!0),this.activeAncestors.Add(r)},ClearActiveAncestors:function(){for(var n=this.activeAncestors.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.set_IsTransparentAncestor(!1);this.activeAncestors.Clear()},RemoveControlPointsFromGraph:function(){this.ClearActiveAncestors();this.RemoveObstaclePortsFromGraph();this.RemoveFreePointsFromGraph();this.get_TransUtil().RemoveFromGraph();this.portSpliceLimitRectangle=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor},RemoveObstaclePortsFromGraph:function(){for(var n=this.obstaclePortsInGraph.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.RemoveFromGraph();this.obstaclePortsInGraph.Clear()},RemoveFreePointsFromGraph:function(){for(var n=this.freePointsInGraph.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.RemoveFromGraph();this.freePointsInGraph.Clear()},RemoveStaleFreePoints:function(){var n;if(this.freePointMap.get_Count()>this.freePointLocationsUsedByRouteEdges.get_Count()){n=System.Linq.Enumerable.ToArray$1(System.Collections.Generic.KeyValuePair$2.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,this.freePointMap,$CreateAnonymousDelegate(this,function(n){return!this.freePointLocationsUsedByRouteEdges.Contains$$T(n.get_Key())})));for(var t=0,r=n.length,i=n[t];t<r;t++,i=n[t])this.freePointMap.Remove(i.get_Key())}},ClearVisibility:function(){var n,t;for(this.freePointMap.Clear(),n=this.obstaclePortMap.get_Values().GetEnumerator();n.MoveNext();)t=n.get_Current(),t.ClearVisibility()},BeginRouteEdges:function(){this.RemoveControlPointsFromGraph();this.freePointLocationsUsedByRouteEdges.Clear()},EndRouteEdges:function(){this.RemoveStaleFreePoints()},FindObstaclePort:function(n){var t,i,r,u,e,f,o;if(function(){var i={Value:t},r=this.obstaclePortMap.TryGetValue(n,i);return t=i.Value,r}.call(this)&&function(){var n={Value:i},u={Value:r},f=t.get_Obstacle().GetPortChanges(n,u);return i=n.Value,r=u.Value,f}.call(this)){for(u=i.GetEnumerator();u.MoveNext();)e=u.get_Current(),this.CreateObstaclePort(t.get_Obstacle(),e);for(f=r.GetEnumerator();f.MoveNext();)o=f.get_Current(),this.RemoveObstaclePort(o);(function(){var i={Value:t},r=this.obstaclePortMap.TryGetValue(n,i);return t=i.Value,r}).call(this)||(t=null)}return t},AddPortToGraph:function(n,t){if(null!=t){this.AddObstaclePortToGraph(t);return}this.AddFreePointToGraph(n.get_Location())},AddObstaclePortToGraph:function(n){var t,i;if(!n.get_LocationHasChanged()||(this.RemoveObstaclePort(n.get_Port()),n=this.CreateObstaclePort(n.get_Obstacle(),n.get_Port()),null!=n)){for(n.AddToGraph(this.get_TransUtil(),this.get_RouteToCenterOfObstacles()),this.obstaclePortsInGraph.Add(n),this.CreateObstaclePortEntrancesIfNeeded(n),t=n.get_PortEntrances().GetEnumerator();t.MoveNext();)i=t.get_Current(),this.AddObstaclePortEntranceToGraph(i);return}},CreateObstaclePortEntrancesIfNeeded:function(n){0==n.get_PortEntrances().get_Count()&&(null==n.get_Port().get_PortEntry()?this.CreateObstaclePortEntrancesFromPoints(n):this.CreateObstaclePortEntrancesFromPortEntry(n))},GetPortVisibilityIntersection:function(n){var t=this.FindObstaclePort(n.get_SourcePort()),i=this.FindObstaclePort(n.get_TargetPort()),f,r,e,u,o;if(t==null||i==null||t.get_Obstacle().get_IsInConvexHull()||i.get_Obstacle().get_IsInConvexHull()||(this.CreateObstaclePortEntrancesIfNeeded(t),this.CreateObstaclePortEntrancesIfNeeded(i),!t.VisibilityRectangle.Intersects(i.VisibilityRectangle)))return null;for(f=t.get_PortEntrances().GetEnumerator();f.MoveNext();)if(r=f.get_Current(),r.get_WantVisibilityIntersection())for(e=i.get_PortEntrances().GetEnumerator();e.MoveNext();)if((u=e.get_Current(),u.get_WantVisibilityIntersection())&&(o=r.get_IsVertical()==u.get_IsVertical()?Microsoft.Msagl.Routing.Rectilinear.PortManager.GetPathPointsFromOverlappingCollinearVisibility(r,u):Microsoft.Msagl.Routing.Rectilinear.PortManager.GetPathPointsFromIntersectingVisibility(r,u),o!=null))return o;return null},CreateObstaclePortEntrancesFromPoints:function(n){var r=this.graphGenerator.ObstacleTree.get_GraphBox(),i=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n.get_PortCurve().get_BoundingBox().get_LeftBottom()),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n.get_PortCurve().get_BoundingBox().get_RightTop())),t=Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n.get_PortLocation()),u,f,c=!1,l,e,o,a,s,h;Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(t.get_Y(),i.get_Top())||Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(t.get_Y(),i.get_Bottom())||(c=!0,l=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Double$$Double$$Double$$Double(r.get_Left(),t.get_Y(),r.get_Right(),t.get_Y()),function(){var i={Value:u},r={Value:f},e=this.GetBorderIntersections(t,l,n.get_PortCurve(),i,r);return u=i.Value,f=r.Value,e}.call(this),e=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Min$$Double$$Double(u.get_X(),f.get_X()),t.get_Y()),e.get_X()<i.get_Left()&&e.set_X(i.get_Left()),o=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Max$$Double$$Double(u.get_X(),f.get_X()),t.get_Y()),o.get_X()>i.get_Right()&&o.set_X(i.get_Right()),this.CreatePortEntrancesAtBorderIntersections(i,n,t,e,o));Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(t.get_X(),i.get_Left())||Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(t.get_X(),i.get_Right())||(c=!0,a=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Double$$Double$$Double$$Double(t.get_X(),r.get_Bottom(),t.get_X(),r.get_Top()),function(){var i={Value:u},r={Value:f},e=this.GetBorderIntersections(t,a,n.get_PortCurve(),i,r);return u=i.Value,f=r.Value,e}.call(this),s=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X(),System.Math.Min$$Double$$Double(u.get_Y(),f.get_Y())),s.get_Y()<r.get_Bottom()&&s.set_Y(r.get_Bottom()),h=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X(),System.Math.Max$$Double$$Double(u.get_Y(),f.get_Y())),h.get_Y()>r.get_Top()&&h.set_Y(r.get_Top()),this.CreatePortEntrancesAtBorderIntersections(i,n,t,s,h));c||this.CreateEntrancesForCornerPort(i,n,t)},CreateObstaclePortEntrancesFromPortEntry:function(n){for(var r=n.get_Port().get_PortEntry().GetEntryPoints().GetEnumerator();r.MoveNext();){var f=r.get_Current(),i=Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(f),u=Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point(Microsoft.Msagl.Routing.Rectilinear.PortManager.GetDerivative(n,i)),t=u&5;Microsoft.Msagl.Core.Geometry.Directions.None!=t&&n.CreatePortEntrance(i,Microsoft.Msagl.Core.Geometry.CompassVector.RotateLeft(t),this.get_ObstacleTree());t=u&10;Microsoft.Msagl.Core.Geometry.Directions.None!=t&&n.CreatePortEntrance(i,Microsoft.Msagl.Core.Geometry.CompassVector.RotateLeft(t),this.get_ObstacleTree())}},GetBorderIntersections:function(n,t,i,r,u){var f=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(t,i,!0);Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(2==f.get_Count(),"Expected two intersections",this.get_ObstacleTree(),this.get_VisGraph());r.Value=Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.RawIntersection(f.get_Item$$Int32(0),n);u.Value=Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.RawIntersection(f.get_Item$$Int32(1),n)},CreatePortEntrancesAtBorderIntersections:function(n,t,i,r,u){var f=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(r,u);Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(r,i)||this.CreatePortEntrance(n,t,u,f);Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(u,i)||this.CreatePortEntrance(n,t,r,Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(f))},CreatePortEntrance:function(n,t,i,r){var o,u,e,f;t.CreatePortEntrance(i,r,this.get_ObstacleTree());o=Microsoft.Msagl.Routing.Rectilinear.ScanDirection.GetInstance(r);u=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.GetRectangleBound(n,r)-o.Coord(i);u<0&&(u=-u);u>Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()&&(e=Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point(Microsoft.Msagl.Routing.Rectilinear.PortManager.GetDerivative(t,i)),f=e&~(r|Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(r)),Microsoft.Msagl.Core.Geometry.Directions.None!=(r&e)&&(f=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(f)),t.CreatePortEntrance(i,f,this.get_ObstacleTree()))},CreateEntrancesForCornerPort:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Directions.North;Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(i,n.get_LeftBottom())?r=Microsoft.Msagl.Core.Geometry.Directions.South:Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(i,n.get_LeftTop())?r=Microsoft.Msagl.Core.Geometry.Directions.West:Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(i,n.get_RightTop())?r=Microsoft.Msagl.Core.Geometry.Directions.North:Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(i,n.get_RightBottom())?r=Microsoft.Msagl.Core.Geometry.Directions.East:System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"Expected Port to be on corner of curveBox");t.CreatePortEntrance(i,r,this.get_ObstacleTree());t.CreatePortEntrance(i,Microsoft.Msagl.Core.Geometry.CompassVector.RotateRight(r),this.get_ObstacleTree())},AddObstaclePortEntranceToGraph:function(n){var i=this.get_VisGraph().FindVertex(n.get_VisibilityBorderIntersect()),t,r,u;if(null!=i){n.ExtendFromBorderVertex(this.get_TransUtil(),i,this.portSpliceLimitRectangle,this.get_RouteToCenterOfObstacles());return}r=n.get_IsOverlapped()?500:1;u=function(){var i={Value:t},u=this.FindorCreateNearestPerpEdge$$Point$$Point$$Directions$$Double$$VisibilityVertex(n.get_MaxVisibilitySegment().get_End(),n.get_VisibilityBorderIntersect(),n.get_OutwardDirection(),r,i);return t=i.Value,u}.call(this);null!=u&&n.AddToAdjacentVertex(this.get_TransUtil(),t,this.portSpliceLimitRectangle,this.get_RouteToCenterOfObstacles())},InBoundsGraphBoxIntersect:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.RectangleBorderIntersect(this.graphGenerator.ObstacleTree.get_GraphBox(),n,t)},FindorCreateNearestPerpEdge$$Point$$Point$$Directions$$Double:function(n,t,i,r){var u;return function(){var f={Value:u},e=this.FindorCreateNearestPerpEdge$$Point$$Point$$Directions$$Double$$VisibilityVertex(n,t,i,r,f);return u=f.Value,e}.call(this)},FindorCreateNearestPerpEdge$$Point$$Point$$Directions$$Double$$VisibilityVertex:function(n,t,i,r,u){var s=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SortAscending(n,t),f=s.get_Item1(),e=s.get_Item2(),h=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Directions(i)?this.get_HScanSegments():this.get_VScanSegments(),o=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsAscending(i)?h.FindLowestIntersector(f,e):h.FindHighestIntersector(f,e),c;return o==null?(u.Value=null,null):(c=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SegmentIntersection$$SegmentBase$$Point(o,f),this.FindOrCreateNearestPerpEdgeFromNearestPerpSegment(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsAscending(i)?f:e,o,c,r,u))},FindOrCreateNearestPerpEdgeFromNearestPerpSegment:function(n,t,i,r,u){var f=this.get_VisGraph().FindVertex(i),s,e,o,c,h;if(null==f){if(s=function(){var e={Value:f},o=this.FindOrCreateSegmentIntersectionVertexAndAssociatedEdge(n,i,t,r,e,u);return f=e.Value,o}.call(this),s!=null)return s}else if(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,i))return u.Value=f,this.get_TransUtil().FindNextEdge(u.Value,t.get_ScanDirection().get_Direction())!=null?this.get_TransUtil().FindNextEdge(u.Value,t.get_ScanDirection().get_Direction()):this.get_TransUtil().FindNextEdge(u.Value,Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(t.get_ScanDirection().get_Direction()));return(e=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(i,n),o=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(f.Point,n),e==o)?(function(){var t={Value:c},i=Microsoft.Msagl.Routing.Rectilinear.TransientGraphUtility.FindBracketingVertices(f,n,e,u,t);return c=t.Value,i}.call(this),this.get_TransUtil().FindNextEdge(u.Value,Microsoft.Msagl.Core.Geometry.CompassVector.RotateLeft(e))!=null?this.get_TransUtil().FindNextEdge(u.Value,Microsoft.Msagl.Core.Geometry.CompassVector.RotateLeft(e)):this.get_TransUtil().FindNextEdge(u.Value,Microsoft.Msagl.Core.Geometry.CompassVector.RotateRight(e))):(o&=~e,Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(Microsoft.Msagl.Core.Geometry.Directions.None!=o,"pointLocation == initial segsegVertex.Point should already have exited",this.get_ObstacleTree(),this.get_VisGraph()),h=this.get_TransUtil().FindNearestPerpendicularOrContainingEdge(f,o,n),null==h)?(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(Microsoft.Msagl.Core.Geometry.Point.op_GreaterThan(i,t.get_HighestVisibilityVertex().Point),"edgeIntersect is not > scanSeg.HighestVisibilityVertex",this.get_ObstacleTree(),this.get_VisGraph()),u.Value=this.get_TransUtil().AddVertex(i),this.get_TransUtil().FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(u.Value,t.get_HighestVisibilityVertex(),t.get_Weight())):(f=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.GetVertex(h,Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(o)),i=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SegmentIntersection$$Point$$Point$$Point(n,i,f.Point),Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(f.Point,i))?(u.Value=f,this.get_TransUtil().FindNextEdge(f,o)):(u.Value=this.get_TransUtil().FindOrAddVertex(i),this.get_TransUtil().FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(f,u.Value,r))},FindOrCreateSegmentIntersectionVertexAndAssociatedEdge:function(n,t,i,r,u,f){var h=i.get_IsVertical()?this.get_HScanSegments():this.get_VScanSegments(),e=h.FindHighestIntersector(i.get_Start(),t),o,s;return null==e?(u.Value=null,f.Value=this.get_TransUtil().AddVertex(t),this.get_TransUtil().FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(f.Value,i.get_LowestVisibilityVertex(),i.get_Weight())):(o=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SegmentIntersection$$SegmentBase$$SegmentBase(i,e),u.Value=this.get_VisGraph().FindVertex(o),null==u.Value&&(u.Value=this.get_TransUtil().AddVertex(o),s=this.AddEdgeToClosestSegmentEnd(i,u.Value,i.get_Weight()),this.AddEdgeToClosestSegmentEnd(e,u.Value,e.get_Weight()),Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(u.Value.Point,t)))?(f.Value=u.Value,s):Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,t)?(f.Value=this.get_TransUtil().FindOrAddVertex(t),this.get_TransUtil().FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(u.Value,f.Value,r)):(f.Value=null,null)},AddEdgeToClosestSegmentEnd:function(n,t,i){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(n.get_HighestVisibilityVertex().Point,t.Point)?this.get_TransUtil().FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(n.get_HighestVisibilityVertex(),t,i):Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(t.Point,n.get_LowestVisibilityVertex().Point)?this.get_TransUtil().FindOrAddEdge$$VisibilityVertex$$VisibilityVertex$$Double(t,n.get_LowestVisibilityVertex(),i):this.get_TransUtil().FindOrAddEdge$$VisibilityVertex$$VisibilityVertex(n.get_LowestVisibilityVertex(),t)},GetPortSpliceLimitRectangle:function(n){var t,i;if(!this.get_LimitPortVisibilitySpliceToEndpointBoundingBox()){this.portSpliceLimitRectangle=this.graphGenerator.ObstacleTree.get_GraphBox();return}if(this.portSpliceLimitRectangle=this.GetPortRectangle(n.get_SourcePort()),this.portSpliceLimitRectangle.Add$$Rectangle(this.GetPortRectangle(n.get_TargetPort())),null!=n.get_Waypoints())for(t=n.get_Waypoints().GetEnumerator();t.MoveNext();)i=t.get_Current(),this.AddToLimitRectangle(i)},GetPortRectangle:function(n){var t;return(function(){var i={Value:t},r=this.obstaclePortMap.TryGetValue(n,i);return t=i.Value,r}.call(this),null!=t)?t.get_Obstacle().get_VisibilityBoundingBox().Clone():new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n.get_Location()))},AddToLimitRectangle:function(n){this.graphGenerator.IsInBounds$$Point(n)&&this.portSpliceLimitRectangle.Add$$Point(n)},FindWaypointVertices:function(n){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,n,$CreateAnonymousDelegate(this,function(n){return this.get_VisGraph().FindVertex(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n))}))},FindOrCreateFreePoint:function(n){var t;return function(){var i={Value:t},r=this.freePointMap.TryGetValue(n,i);return t=i.Value,r}.call(this)?t.GetVertex(this.get_TransUtil(),n):(t=new Microsoft.Msagl.Routing.Rectilinear.FreePoint.ctor(this.get_TransUtil(),n),this.freePointMap.set_Item$$TKey(n,t)),this.freePointsInGraph.Insert(t),this.freePointLocationsUsedByRouteEdges.Insert(n),t},AddFreePointToGraph:function(n){var e,t,r,u,o,i,f;if(n=Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n),e=this.get_VisGraph().FindVertex(n),t=this.FindOrCreateFreePoint(n),null!=e)return t;if(!this.graphGenerator.IsInBounds$$Point(n))return this.CreateOutOfBoundsFreePoint(t),t;if(r=null,t.set_IsOverlapped(this.get_ObstacleTree().PointIsInsideAnObstacle$$Point$$ScanDirection(t.get_Point(),this.get_HScanSegments().get_ScanDirection())),u=this.get_HScanSegments().FindSegmentContainingPoint(n,!0)!=null?this.get_HScanSegments().FindSegmentContainingPoint(n,!0):this.get_VScanSegments().FindSegmentContainingPoint(n,!0),null!=u&&(r=function(){var i={Value:o},r=this.FindOrCreateNearestPerpEdgeFromNearestPerpSegment(n,u,n,t.get_InitialWeight(),i);return o=i.Value,r}.call(this)),i=Microsoft.Msagl.Core.Geometry.Directions.South,null!=r)i=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.EdgeDirection$$VisibilityEdge(r),this.ConnectFreePointToLateralEdge(t,Microsoft.Msagl.Core.Geometry.CompassVector.RotateLeft(i)),this.ConnectFreePointToLateralEdge(t,Microsoft.Msagl.Core.Geometry.CompassVector.RotateRight(i));else for(f=0;f<4;++f)this.ConnectFreePointToLateralEdge(t,i),i=Microsoft.Msagl.Core.Geometry.CompassVector.RotateLeft(i);return t},CreateOutOfBoundsFreePoint:function(n){var f=n.get_Point(),r=this.graphGenerator.MakeInBoundsLocation(f),u=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(r,f),i,t,e,o,s;if(n.set_OutOfBoundsDirectionFromGraph(u),!Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureDirection$$Directions(u)){Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.Assert(null!=this.get_VisGraph().FindVertex(r),"graph corner vertex not found",this.get_ObstacleTree(),this.get_VisGraph());n.AddOobEdgesFromGraphCorner(this.get_TransUtil(),r);return}i=this.get_VisGraph().FindVertex(r);t=Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(u);null!=i?n.AddToAdjacentVertex(this.get_TransUtil(),i,t,this.portSpliceLimitRectangle):(e=this.FindorCreateNearestPerpEdge$$Point$$Point$$Directions$$Double(f,r,u,1),null!=e&&(i=n.AddEdgeToAdjacentEdge(this.get_TransUtil(),e,t,this.portSpliceLimitRectangle)));o=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(i,Microsoft.Msagl.Core.Geometry.CompassVector.RotateLeft(t));o!=null&&this.get_TransUtil().ConnectVertexToTargetVertex(n.get_Vertex(),o,t,1);s=Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(i,Microsoft.Msagl.Core.Geometry.CompassVector.RotateRight(t));s!=null&&this.get_TransUtil().ConnectVertexToTargetVertex(n.get_Vertex(),s,t,1)},ConnectFreePointToLateralEdge:function(n,t){var r=n.get_IsOverlapped()?this.InBoundsGraphBoxIntersect(n.get_Point(),t):n.MaxVisibilityInDirectionForNonOverlappedFreePoint(t,this.get_TransUtil()),i=this.FindorCreateNearestPerpEdge$$Point$$Point$$Directions$$Double(r,n.get_Point(),t,n.get_InitialWeight());null!=i&&n.AddEdgeToAdjacentEdge(this.get_TransUtil(),i,t,this.portSpliceLimitRectangle)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$PortManager);Microsoft$Msagl$Routing$Rectilinear$RectilinearInteractiveEditor={fullname:"Microsoft.Msagl.Routing.Rectilinear.RectilinearInteractiveEditor",baseTypeName:"System.Object",staticDefinition:{CreatePortsAndRouteEdges$$Double$$Double$$IEnumerable$1$Node$$IEnumerable$1$Edge$$EdgeRoutingMode$$Boolean$$Boolean$$Double:function(n,t,i,r,u,f,e,o){var s=Microsoft.Msagl.Routing.Rectilinear.RectilinearInteractiveEditor.FillRouter(n,t,i,r,u,f,e,o);s.Run();Microsoft.Msagl.Routing.Rectilinear.RectilinearInteractiveEditor.CreateSelfEdges(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,r,function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_SourcePort().get_Location(),n.get_TargetPort().get_Location())}),n)},CreatePortsAndRouteEdges$$Double$$Double$$IEnumerable$1$Node$$IEnumerable$1$Edge$$EdgeRoutingMode$$Boolean$$Boolean:function(n,t,i,r,u,f,e){Microsoft.Msagl.Routing.Rectilinear.RectilinearInteractiveEditor.CreatePortsAndRouteEdges$$Double$$Double$$IEnumerable$1$Node$$IEnumerable$1$Edge$$EdgeRoutingMode$$Boolean$$Boolean$$Double(n,t,i,r,u,f,e,4)},CreatePortsAndRouteEdges$$Double$$Double$$IEnumerable$1$Node$$IEnumerable$1$Edge$$EdgeRoutingMode$$Boolean:function(n,t,i,r,u,f){Microsoft.Msagl.Routing.Rectilinear.RectilinearInteractiveEditor.CreatePortsAndRouteEdges$$Double$$Double$$IEnumerable$1$Node$$IEnumerable$1$Edge$$EdgeRoutingMode$$Boolean$$Boolean$$Double(n,t,i,r,u,f,!1,4)},FillRouter:function(n,t,i,r,u,f,e,o){var s,l,a,p,v,y,h,c;for(System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Routing.EdgeRoutingMode.Rectilinear==u||Microsoft.Msagl.Core.Routing.EdgeRoutingMode.RectilinearToCenter==u,"Non-rectilinear edgeRoutingMode"),s=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Node.ctor,Microsoft.Msagl.Routing.Shape.ctor),l=i.GetEnumerator();l.MoveNext();)a=l.get_Current(),p=Microsoft.Msagl.Routing.Rectilinear.RectilinearInteractiveEditor.CreateShapeWithRelativeNodeAtCenter(a),s.Add(a,p);for(v=function(){var i=new Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.ctor$$IEnumerable$1$Shape$$Double$$Double$$Boolean$$Boolean(s.get_Values(),t,n,f,e);return i.set_RouteToCenterOfObstacles(u==Microsoft.Msagl.Core.Routing.EdgeRoutingMode.RectilinearToCenter),i.set_BendPenaltyAsAPercentageOfDistance(o),i}(),y=r.GetEnumerator();y.MoveNext();)h=y.get_Current(),c=h.get_EdgeGeometry(),c.set_SourcePort(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Port.ctor,s.get_Item$$TKey(h.get_Source()).get_Ports())),c.set_TargetPort(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Port.ctor,s.get_Item$$TKey(h.get_Target()).get_Ports())),v.AddEdgeGeometryToRoute(c);return v},CreateSelfEdges:function(n,t){for(var i=n.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),Microsoft.Msagl.Routing.Rectilinear.RectilinearInteractiveEditor.CreateSimpleEdgeCurveWithGivenFitRadius(r,t)},CreateSimpleEdgeCurveWithGivenFitRadius:function(n,t){var r,u,f,e,i;if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edge"),r=n.get_Source().get_Center(),u=n.get_Target().get_Center(),n.get_Source()==n.get_Target()){for(f=n.get_Source().get_BoundaryCurve().get_BoundingBox().get_Width()/2,e=n.get_Source().get_BoundingBox().get_Height()/4,n.set_UnderlyingPolyline(Microsoft.Msagl.Routing.Rectilinear.RectilinearInteractiveEditor.CreateUnderlyingPolylineForSelfEdge(r,f,e)),i=n.get_UnderlyingPolyline().get_HeadSite().get_Next();i.get_Next()!=null;i=i.get_Next())Microsoft.Msagl.Routing.Rectilinear.RectilinearInteractiveEditor.CalculateCoefficiensUnderSite(i,t);n.set_Curve(n.get_UnderlyingPolyline().CreateCurve())}else n.set_UnderlyingPolyline(Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints([r,u])),n.set_Curve(n.get_UnderlyingPolyline().CreateCurve());Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(n.get_EdgeGeometry(),n.get_Source().get_BoundaryCurve(),n.get_Target().get_BoundaryCurve(),n.get_Curve(),!0,!1)||Microsoft.Msagl.Core.Layout.Arrowheads.CreateBigEnoughSpline(n)},CreateSimpleEdgeCurve:function(n){var t,i,r,u;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edge");t=n.get_Source().get_Center();i=n.get_Target().get_Center();n.get_Source()==n.get_Target()?(r=n.get_Source().get_BoundaryCurve().get_BoundingBox().get_Width()/2,u=n.get_Source().get_BoundingBox().get_Height()/4,n.set_UnderlyingPolyline(Microsoft.Msagl.Routing.Rectilinear.RectilinearInteractiveEditor.CreateUnderlyingPolylineForSelfEdge(t,r,u)),n.set_Curve(n.get_UnderlyingPolyline().CreateCurve())):(n.set_UnderlyingPolyline(Microsoft.Msagl.Core.Geometry.SmoothedPolyline.FromPoints([t,i])),n.set_Curve(n.get_UnderlyingPolyline().CreateCurve()));Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(n.get_EdgeGeometry(),n.get_Source().get_BoundaryCurve(),n.get_Target().get_BoundaryCurve(),n.get_Curve(),!0,!1)||Microsoft.Msagl.Core.Layout.Arrowheads.CreateBigEnoughSpline(n)},CreateUnderlyingPolylineForSelfEdge:function(n,t,i){var u=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,i)),f=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,i)),e=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,-i)),o=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,-i)),r=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Point(n),s=new Microsoft.Msagl.Core.Geometry.SmoothedPolyline.ctor(r);return r=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(r,u),r=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(r,f),r=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(r,e),r=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(r,o),new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(r,n),s},CreateShapeWithRelativeNodeAtCenter:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"node");var t=new Microsoft.Msagl.Routing.RelativeShape.ctor(function(){return n.get_BoundaryCurve()});return t.get_Ports().Insert(new Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point(function(){return n.get_BoundaryCurve()},function(){return n.get_Center()})),t},CalculateCoefficiensUnderSite:function(n,t){var i=t/Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Point(),n.get_Previous().get_Point()).get_Length();i=System.Math.Min$$Double$$Double(.5,i);n.set_PreviousBezierSegmentFitCoefficient(i);i=t/Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Next().get_Point(),n.get_Point()).get_Length();i=System.Math.Min$$Double$$Double(.5,i);n.set_NextBezierSegmentFitCoefficient(i)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$RectilinearInteractiveEditor);Microsoft$Msagl$Routing$RelativeShape={fullname:"Microsoft.Msagl.Routing.RelativeShape",baseTypeName:"Microsoft.Msagl.Routing.Shape",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.curveDelegate=null;Microsoft.Msagl.Routing.Shape.ctor.call(this);this.curveDelegate=n},BoundaryCurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_BoundaryCurve:function(){return this.curveDelegate()},set_BoundaryCurve:function(){throw $CreateException(new System.InvalidOperationException.ctor,new Error);}}};JsTypes.push(Microsoft$Msagl$Routing$RelativeShape);Microsoft$Msagl$Routing$Shape={fullname:"Microsoft.Msagl.Routing.Shape",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.parents=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Shape.ctor);this.children=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Shape.ctor);this.boundaryCurve=null;this.ports=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Port.ctor);this._UserData=null;this._IsTransparent=!1;Microsoft.Msagl.Routing.Shape.ctor$$ICurve.call(this,null)},Parents$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Shape]]",get_Parents:function(){return this.parents},Children$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Shape]]",get_Children:function(){return this.children},BoundaryCurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_BoundaryCurve:function(){return this.boundaryCurve},set_BoundaryCurve:function(n){this.boundaryCurve=n},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){return this.get_BoundaryCurve().get_BoundingBox()},Ports$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Layout.Port]]",get_Ports:function(){return this.ports},UserData$$:"System.Object",get_UserData:function(){return this._UserData},set_UserData:function(n){this._UserData=n},ctor$$ICurve:function(n){this.parents=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Shape.ctor);this.children=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Shape.ctor);this.boundaryCurve=null;this.ports=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Layout.Port.ctor);this._UserData=null;this._IsTransparent=!1;System.Object.ctor.call(this);this.boundaryCurve=n},IsGroup$$:"System.Boolean",get_IsGroup:function(){return this.children.get_Count()>0},IsTransparent$$:"System.Boolean",get_IsTransparent:function(){return this._IsTransparent},set_IsTransparent:function(n){this._IsTransparent=n},Descendants$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Shape]]",get_Descendants:function(){for(var u=[],n=new System.Collections.Generic.Queue$1.ctor(Microsoft.Msagl.Routing.Shape.ctor),f=this.get_Children().GetEnumerator(),i,r,t;f.MoveNext();)t=f.get_Current(),n.Enqueue(t);while(n.get_Count()>0)for(i=n.Dequeue(),u.push(i),r=i.get_Children().GetEnumerator();r.MoveNext();)t=r.get_Current(),n.Enqueue(t);return u},Ancestors$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Shape]]",get_Ancestors:function(){for(var u=[],n=new System.Collections.Generic.Queue$1.ctor(Microsoft.Msagl.Routing.Shape.ctor),f=this.get_Parents().GetEnumerator(),i,r,t;f.MoveNext();)t=f.get_Current(),n.Enqueue(t);while(n.get_Count()>0)for(i=n.Dequeue(),u.push(i),r=i.get_Parents().GetEnumerator();r.MoveNext();)t=r.get_Current(),n.Enqueue(t);return u},AddParent:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"shape");this.parents.Insert(n);n.children.Insert(this)},AddChild:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"shape");n.parents.Insert(this);this.children.Insert(n)},RemoveChild:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"shape");this.children.Remove(n);n.parents.Remove(this)},RemoveParent:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"shape");this.parents.Remove(n);n.children.Remove(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Shape);Microsoft$Msagl$Routing$Rectilinear$Nudging$PathMerger={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.PathMerger",baseTypeName:"System.Object",staticDefinition:{GetPointsInBetween:function(n,t){for(var r=[],i=n.get_Next();i!=t;i=i.get_Next())r.push(i.get_Point());return r},Before:function(n,t){for(n=n.get_Next();n!=null;n=n.get_Next())if(n==t)return!0;return!1},FindLinkedPointInPath:function(n,t){for(var i=Cast(n.get_PathPoints(),Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor);;i=i.get_Next())if(Microsoft.Msagl.Core.Geometry.Point.op_Equality(i.get_Point(),t))return i}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.verticesToPathOffsets=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Collections.Generic.Dictionary$2.ctor);this._Paths=null;System.Object.ctor.call(this);this.set_Paths(n)},Paths$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Rectilinear.Nudging.Path]]",get_Paths:function(){return this._Paths},set_Paths:function(n){this._Paths=n},MergePaths:function(){var n,t;for(this.InitVerticesToPathOffsetsAndRemoveSelfCycles(),n=this.get_Paths().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.ProcessPath(t)},ProcessPath:function(n){for(var u,o,s,f,h,t,r=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor),e=null,i=Cast(n.get_PathPoints(),Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor);i!=null;i=i.get_Next()){if(u=this.verticesToPathOffsets.get_Item$$TKey(i.get_Point()),e!=null){if(r.get_Count()>0)for(o=u.GetEnumerator();o.MoveNext();)t=o.get_Current(),f=t.get_Key(),function(){var n={Value:s},t=r.TryGetValue(f,n);return s=n.Value,t}.call(this)&&(this.CollapseLoopingPath(f,s,t.get_Value(),n,i),r.Remove(f));for(h=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Collections.Generic.KeyValuePair$2.ctor,e,$CreateAnonymousDelegate(this,function(n){return!u.ContainsKey(n.get_Key())})).GetEnumerator();h.MoveNext();)t=h.get_Current(),r.Add(t.get_Key(),t.get_Value())}e=u}},CollapseLoopingPath:function(n,t,i,r,u){var e=Microsoft.Msagl.Routing.Rectilinear.Nudging.PathMerger.FindLinkedPointInPath(r,t.get_Point()),f=Microsoft.Msagl.Routing.Rectilinear.Nudging.PathMerger.GetPointsInBetween(e,u);Microsoft.Msagl.Routing.Rectilinear.Nudging.PathMerger.Before(t,i)?(this.CleanDisappearedPiece(t,i,n),this.ReplacePiece(t,i,f,n)):(this.CleanDisappearedPiece(i,t,n),this.ReplacePiece(i,t,System.Linq.Enumerable.Reverse$1(Microsoft.Msagl.Core.Geometry.Point.ctor,f),n))},ReplacePiece:function(n,t,i,r){for(var u=n,s=i.GetEnumerator(),f,e,o;s.MoveNext();)f=s.get_Current(),e=new Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor(f),u.set_Next(e),u=e,o=this.verticesToPathOffsets.get_Item$$TKey(f),System.Diagnostics.Debug.Assert$$Boolean(!o.ContainsKey(r)),o.set_Item$$TKey(r,u);u.set_Next(t)},CleanDisappearedPiece:function(n,t,i){for(var u=Microsoft.Msagl.Routing.Rectilinear.Nudging.PathMerger.GetPointsInBetween(n,t).GetEnumerator(),f,r;u.MoveNext();)f=u.get_Current(),r=this.verticesToPathOffsets.get_Item$$TKey(f),System.Diagnostics.Debug.Assert$$Boolean(r.ContainsKey(i)),r.Remove(i)},InitVerticesToPathOffsetsAndRemoveSelfCycles:function(){for(var u=this.get_Paths().GetEnumerator(),t,n,i,r;u.MoveNext();)for(t=u.get_Current(),n=Cast(t.get_PathPoints(),Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor);n!=null;n=n.get_Next())(function(){var t={Value:i},r=this.verticesToPathOffsets.TryGetValue(n.get_Point(),t);return i=t.Value,r}).call(this)||this.verticesToPathOffsets.set_Item$$TKey(n.get_Point(),i=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.LinkedPoint.ctor)),function(){var n={Value:r},u=i.TryGetValue(t,n);return r=n.Value,u}.call(this)?(this.CleanDisappearedPiece(r,n,t),r.set_Next(n.get_Next())):i.set_Item$$TKey(t,n)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$PathMerger);Microsoft$Msagl$Routing$Rectilinear$SpliceUtility={fullname:"Microsoft.Msagl.Routing.Rectilinear.SpliceUtility",baseTypeName:"System.Object",staticDefinition:{MungeClosestIntersectionInfo:function(n,t,i){var u=t.get_Segment1().get_BoundingBox(),r=Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.RawIntersection(t,n).Clone();return i?r.set_X(Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.MungeIntersect(n.get_X(),r.get_X(),u.get_Left(),u.get_Right())):r.set_Y(Microsoft.Msagl.Routing.Rectilinear.SpliceUtility.MungeIntersect(n.get_Y(),r.get_Y(),u.get_Bottom(),u.get_Top())),r},MungeIntersect:function(n,t,i,r){var u,f;return n<t?(u=System.Math.Min$$Double$$Double(i,r),t<u&&(t=u)):n>t&&(f=System.Math.Max$$Double$$Double(i,r),t>f&&(t=f)),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Double(t)},RawIntersection:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(Is(n.get_Segment0(),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor),"LineSegment was not first arg to GetAllIntersections");var i=n.get_Segment0().get_Item$$Double(n.get_Par0()),r=Cast(n.get_Segment0(),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor);return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Directions(Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(r.get_Start(),r.get_End()))?System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(i.get_X(),t.get_X()),"segment0 obstacle intersection is off the vertical line"):System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(i.get_Y(),t.get_Y()),"segment0 obstacle intersection is off the horizontal line"),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(i)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$SpliceUtility);Microsoft$Msagl$Routing$Rectilinear$SsstRectilinearPath={fullname:"Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.DefaultBendPenaltyAsAPercentageOfDistance=4;Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.AddOneTurn=[Microsoft.Msagl.Core.Geometry.Directions.None,11,7,15,14,15,15,15,13,15,15,15,15,15,15,15]},IsInDirs:function(n,t){return n==(n&t)},GetBendsForNotPureDirection:function(n,t,i){var u=n&t,r;return u==Microsoft.Msagl.Core.Geometry.Directions.None?Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.GetBendsForNotPureDirection(n,Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.AddOneTurn[t],i)+1:(r=n&i,r==Microsoft.Msagl.Core.Geometry.Directions.None)?Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.GetBendsForNotPureDirection(n,t,Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.AddOneTurn[i])+1:(u|r)==n?1:2},Left:function(n){switch(n){case Microsoft.Msagl.Core.Geometry.Directions.None:return Microsoft.Msagl.Core.Geometry.Directions.None;case Microsoft.Msagl.Core.Geometry.Directions.North:return Microsoft.Msagl.Core.Geometry.Directions.West;case Microsoft.Msagl.Core.Geometry.Directions.East:return Microsoft.Msagl.Core.Geometry.Directions.North;case Microsoft.Msagl.Core.Geometry.Directions.South:return Microsoft.Msagl.Core.Geometry.Directions.East;case Microsoft.Msagl.Core.Geometry.Directions.West:return Microsoft.Msagl.Core.Geometry.Directions.South;default:throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String("direction"),new Error);}},Right:function(n){switch(n){case Microsoft.Msagl.Core.Geometry.Directions.None:return Microsoft.Msagl.Core.Geometry.Directions.None;case Microsoft.Msagl.Core.Geometry.Directions.North:return Microsoft.Msagl.Core.Geometry.Directions.East;case Microsoft.Msagl.Core.Geometry.Directions.East:return Microsoft.Msagl.Core.Geometry.Directions.South;case Microsoft.Msagl.Core.Geometry.Directions.South:return Microsoft.Msagl.Core.Geometry.Directions.West;case Microsoft.Msagl.Core.Geometry.Directions.West:return Microsoft.Msagl.Core.Geometry.Directions.North;default:throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String("direction"),new Error);}},RestorePath$$VertexEntry:function(n){return function(){var t={Value:n},i=Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.RestorePath$$VertexEntry$$VisibilityVertex(t,null);return n=t.Value,i}()},RestorePath$$VertexEntry$$VisibilityVertex:function(n,t){var u;if(n.Value==null)return null;for(var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),r=!1,f=Microsoft.Msagl.Core.Geometry.Directions.None;;){if(f==n.Value.get_Direction()?r=!0:(r=!1,i.Add(n.Value.get_Vertex().Point),f=n.Value.get_Direction()),u=n.Value.get_PreviousEntry(),u==null||n.Value.get_Vertex()==t)break;n.Value=u}return r&&i.Add(n.Value.get_Vertex().Point),i.Reverse(),i},GetLengthAndNumberOfBendsToNeighborVertex:function(n,t,i,r,u){u.Value=n.get_Length()+Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.ManhattanDistance(n.get_Vertex().Point,t.Point)*i;var f=Microsoft.Msagl.Core.Geometry.CompassVector.PureDirectionFromPointToPoint(n.get_Vertex().Point,t.Point);return r.Value=n.get_NumberOfBends(),n.get_Direction()!=Microsoft.Msagl.Core.Geometry.Directions.None&&f!=n.get_Direction()&&r.Value++,f},ManhattanDistance:function(n,t){return System.Math.Abs$$Double(t.get_X()-n.get_X())+System.Math.Abs$$Double(t.get_Y()-n.get_Y())},IsPassable:function(n){return n.get_IsPassable()==null||n.get_IsPassable()()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.upperBoundOnCost=0;this.sourceCostAdjustment=0;this.targetCostAdjustment=0;this.queue=null;this.visitedVertices=null;this.nextNeighbors=[new Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.NextNeighbor.ctor,new Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.NextNeighbor.ctor,new Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.NextNeighbor.ctor];this._LengthImportance=0;this._BendsImportance=0;this._Target=null;this._Source=null;this._EntryDirectionsToTarget=Microsoft.Msagl.Core.Geometry.Directions.None;System.Object.ctor.call(this);this.set_LengthImportance(1);this.set_BendsImportance(1)},LengthImportance$$:"System.Double",get_LengthImportance:function(){return this._LengthImportance},set_LengthImportance:function(n){this._LengthImportance=n},BendsImportance$$:"System.Double",get_BendsImportance:function(){return this._BendsImportance},set_BendsImportance:function(n){this._BendsImportance=n},Target$$:"Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear",get_Target:function(){return this._Target},set_Target:function(n){this._Target=n},Source$$:"Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear",get_Source:function(){return this._Source},set_Source:function(n){this._Source=n},EntryDirectionsToTarget$$:"Microsoft.Msagl.Core.Geometry.Directions",get_EntryDirectionsToTarget:function(){return this._EntryDirectionsToTarget},set_EntryDirectionsToTarget:function(n){this._EntryDirectionsToTarget=n},CombinedCost:function(n,t){return this.get_LengthImportance()*n+this.get_BendsImportance()*t},TotalCostFromSourceToVertex:function(n,t){return this.CombinedCost(n,t)+this.sourceCostAdjustment},InitPath:function(n,t,i){if(t==i||!this.InitEntryDirectionsAtTarget(i))return!1;this.set_Target(i);this.set_Source(t);var r=this.TotalCostFromSourceToVertex(0,0)+this.HeuristicDistanceFromVertexToTarget(t.Point,Microsoft.Msagl.Core.Geometry.Directions.None);return r>=this.upperBoundOnCost?!1:(this.queue=new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueueWithTimestamp$1.ctor(Microsoft.Msagl.Routing.Rectilinear.VertexEntry.ctor),this.visitedVertices=function(){var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear.ctor);return n.Add(t),n}.call(this),n==null?this.EnqueueInitialVerticesFromSource(r):this.EnqueueInitialVerticesFromSourceEntries(n),this.queue.get_Count()>0)},InitEntryDirectionsAtTarget:function(n){var i,r,t;for(this.set_EntryDirectionsToTarget(Microsoft.Msagl.Core.Geometry.Directions.None),i=n.get_OutEdges().GetEnumerator();i.MoveNext();)t=i.get_Current(),this.set_EntryDirectionsToTarget(this.get_EntryDirectionsToTarget()|Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(t.get_TargetPoint(),n.Point));for(r=n.get_InEdges().GetEnumerator();r.MoveNext();)t=r.get_Current(),this.set_EntryDirectionsToTarget(this.get_EntryDirectionsToTarget()|Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(t.get_SourcePoint(),n.Point));return this.get_EntryDirectionsToTarget()!=Microsoft.Msagl.Core.Geometry.Directions.None},MultistageAdjustedCostBound:function(n){return System.Double.IsPositiveInfinity(n)?n:n+this.get_BendsImportance()},HeuristicDistanceFromVertexToTarget:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.get_Target().Point,n),r,u;return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(i.get_X(),0)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(i.get_Y(),0)?this.targetCostAdjustment:(r=Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point(i),t==Microsoft.Msagl.Core.Geometry.Directions.None?(t=15,u=this.GetNumberOfBends(t,r)):u=this.GetNumberOfBends(t,r),this.CombinedCost(Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.ManhattanDistance(n,this.get_Target().Point),u)+this.targetCostAdjustment)},GetNumberOfBends:function(n,t){return Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(t)?this.GetNumberOfBendsForPureDirection(n,t):Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.GetBendsForNotPureDirection(t,n,this.get_EntryDirectionsToTarget())},GetNumberOfBendsForPureDirection:function(n,t){return(t&n)==t?Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.IsInDirs(t,this.get_EntryDirectionsToTarget())?0:Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.IsInDirs(Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.Left(t),this.get_EntryDirectionsToTarget())||Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.IsInDirs(Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.Right(t),this.get_EntryDirectionsToTarget())?2:4:this.GetNumberOfBendsForPureDirection(Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.AddOneTurn[n],t)+1},QueueReversedEntryToNeighborVertexIfNeeded:function(n,t,i){var r,u,f=t.get_PreviousVertex(),o=function(){var t={Value:r},e={Value:u},o=Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.GetLengthAndNumberOfBendsToNeighborVertex(n,f,i,t,e);return r=t.Value,u=e.Value,o}.call(this),e;(this.CombinedCost(u,r)<this.CombinedCost(t.get_Length(),t.get_NumberOfBends())||n.get_Vertex().get_Degree()==1)&&(e=this.TotalCostFromSourceToVertex(u,r)+this.HeuristicDistanceFromVertexToTarget(f.Point,o),this.EnqueueEntry(n,f,u,r,e))},UpdateEntryToNeighborVertexIfNeeded:function(n,t,i){var r,u,e=function(){var f={Value:r},e={Value:u},o=Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.GetLengthAndNumberOfBendsToNeighborVertex(n,t.get_Vertex(),i,f,e);return r=f.Value,u=e.Value,o}.call(this),f;this.CombinedCost(u,r)<this.CombinedCost(t.get_Length(),t.get_NumberOfBends())&&(f=this.TotalCostFromSourceToVertex(u,r)+this.HeuristicDistanceFromVertexToTarget(t.get_Vertex().Point,e),t.ResetEntry(n,u,r,f),this.queue.DecreasePriority(t,f))},CreateAndEnqueueEntryToNeighborVertex:function(n,t,i){var r,u,e=function(){var f={Value:r},e={Value:u},o=Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.GetLengthAndNumberOfBendsToNeighborVertex(n,t,i,f,e);return r=f.Value,u=e.Value,o}.call(this),f=this.TotalCostFromSourceToVertex(u,r)+this.HeuristicDistanceFromVertexToTarget(t.Point,e);f<this.upperBoundOnCost&&(t.get_VertexEntries()==null&&this.visitedVertices.Add(t),this.EnqueueEntry(n,t,u,r,f))},EnqueueEntry:function(n,t,i,r,u){var f=new Microsoft.Msagl.Routing.Rectilinear.VertexEntry.ctor(t,n,i,r,u);t.SetVertexEntry(f);this.queue.Enqueue(f,f.get_Cost())},GetPathWithCost:function(n,t,i,r,u,f,e){var o,h,v;if(this.upperBoundOnCost=e,this.sourceCostAdjustment=i,this.targetCostAdjustment=f,!this.InitPath(n,t,u))return null;while(this.queue.get_Count()>0){if(o=this.queue.Dequeue(),h=o.get_Vertex(),h==this.get_Target()){if(r==null)return this.Cleanup(),o;if(this.set_EntryDirectionsToTarget(this.get_EntryDirectionsToTarget()&~o.get_Direction()),this.get_EntryDirectionsToTarget()==Microsoft.Msagl.Core.Geometry.Directions.None)return this.get_Target().get_VertexEntries().CopyTo(r,0),this.Cleanup(),null;this.upperBoundOnCost=System.Math.Min$$Double$$Double(this.MultistageAdjustedCostBound(o.get_Cost()),this.upperBoundOnCost);continue}o.set_IsClosed(!0);for(var c=0,a=this.nextNeighbors,p=a.length,s=a[c];c<p;c++,s=a[c])s.Clear();v=Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.Right(o.get_Direction());this.ExtendPathAlongInEdges(o,h.get_InEdges(),v);this.ExtendPathAlongOutEdges(o,h.get_OutEdges(),v);for(var l=0,y=this.nextNeighbors,w=y.length,s=y[l];l<w;l++,s=y[l])s.Vertex!=null&&this.ExtendPathToNeighborVertex(o,s.Vertex,s.Weight)}return r!=null&&this.get_Target().get_VertexEntries()!=null&&this.get_Target().get_VertexEntries().CopyTo(r,0),this.Cleanup(),null},ExtendPathAlongInEdges:function(n,t,i){for(var u,f=t.get_Count(),r=0;r<f;++r)u=t.get_Item$$Int32(r),this.ExtendPathAlongEdge(n,u,!0,i)},ExtendPathAlongOutEdges:function(n,t,i){for(var r=t.IsEmpty()?null:t.TreeMinimum();r!=null;r=t.Next(r))this.ExtendPathAlongEdge(n,r.Item,!1,i)},ExtendPathAlongEdge:function(n,t,i,r){var u,e,f;if(Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.IsPassable(t)){if(u=Cast(i?t.get_Source():t.get_Target(),Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear.ctor),u==n.get_PreviousVertex()){if(n.get_Vertex().get_Degree()>1||n.get_Vertex()!=this.get_Source())return;this.ExtendPathToNeighborVertex(n,u,t.get_Weight());return}e=Microsoft.Msagl.Core.Geometry.CompassVector.PureDirectionFromPointToPoint(n.get_Vertex().Point,u.Point);f=this.nextNeighbors[2];e!=n.get_Direction()&&(f=this.nextNeighbors[e==r?1:0]);System.Diagnostics.Debug.Assert$$Boolean$$String(f.Vertex==null,"bend neighbor already exists");f.Set(u,t.get_Weight())}},EnqueueInitialVerticesFromSource:function(n){for(var r=function(){var t=new Microsoft.Msagl.Routing.Rectilinear.VertexEntry.ctor(this.get_Source(),null,0,0,n);return t.set_IsClosed(!0),t}.call(this),u=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,this.get_Source().get_OutEdges(),Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.IsPassable).GetEnumerator(),i,t;u.MoveNext();)t=u.get_Current(),this.ExtendPathToNeighborVertex(r,Cast(t.get_Target(),Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear.ctor),t.get_Weight());for(i=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,this.get_Source().get_InEdges(),Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.IsPassable).GetEnumerator();i.MoveNext();)t=i.get_Current(),this.ExtendPathToNeighborVertex(r,Cast(t.get_Source(),Microsoft.Msagl.Routing.Rectilinear.VisibilityVertexRectilinear.ctor),t.get_Weight())},EnqueueInitialVerticesFromSourceEntries:function(n){for(var t=0,r=n.length,i=n[t];t<r;t++,i=n[t])i!=null&&this.queue.Enqueue(i,i.get_Cost())},ExtendPathToNeighborVertex:function(n,t,i){var u=Microsoft.Msagl.Core.Geometry.CompassVector.PureDirectionFromPointToPoint(n.get_Vertex().Point,t.Point),r=t.get_VertexEntries()!=null?t.get_VertexEntries()[Microsoft.Msagl.Core.Geometry.CompassVector.ToIndex(u)]:null;r==null?this.CreateAndEnqueueReversedEntryToNeighborVertex(n,t,i)||this.CreateAndEnqueueEntryToNeighborVertex(n,t,i):r.get_IsClosed()||this.UpdateEntryToNeighborVertexIfNeeded(n,r,i)},CreateAndEnqueueReversedEntryToNeighborVertex:function(n,t,i){if(n.get_Vertex().get_VertexEntries()!=null){var u=Microsoft.Msagl.Core.Geometry.CompassVector.PureDirectionFromPointToPoint(t.Point,n.get_Vertex().Point),r=n.get_Vertex().get_VertexEntries()[Microsoft.Msagl.Core.Geometry.CompassVector.ToIndex(u)];if(r!=null)return System.Diagnostics.Debug.Assert$$Boolean$$String(r.get_PreviousVertex()==t,"mismatch in turnback PreviousEntry"),System.Diagnostics.Debug.Assert$$Boolean$$String(r.get_PreviousEntry().get_IsClosed(),"turnback PreviousEntry should be closed"),this.QueueReversedEntryToNeighborVertexIfNeeded(n,r,i),!0}return!1},Cleanup:function(){for(var n=this.visitedVertices.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.RemoveVertexEntries();this.visitedVertices.Clear();this.queue=null},DevTraceShowAllPartialPaths:function(){},DevTraceShowPath:function(){},DevTracePrintSourceAndTarget:function(){},TestPreDequeue:function(){},TestClearIterations:function(){}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$SsstRectilinearPath);Microsoft$Msagl$Routing$Rectilinear$RectilinearEdgeRouter={fullname:"Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.DefaultPadding=1;Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.DefaultCornerFitRadius=3},SplitEdgeGeomsWithWaypoints:function(n){for(var i=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,System.Collections.Generic.IEnumerable$1.ctor),r=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,n,function(n){return n.get_HasWaypoints()}).GetEnumerator(),t;r.MoveNext();)t=r.get_Current(),i.set_Item$$TKey(t,Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.SplitEdgeGeomWithWaypoints(t,t.get_Waypoints()));return i},SplitEdgeGeomWithWaypoints:function(n,t){var r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor),i=t.GetEnumerator(),u;for(i.MoveNext(),r.Add(new Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor(new Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor$$Port$$Port(n.get_SourcePort(),new Microsoft.Msagl.Routing.Rectilinear.WaypointPort.ctor(i.get_Current())))),u=t.GetEnumerator(),u.MoveNext();u.MoveNext();)r.Add(new Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor(new Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor$$Port$$Port(new Microsoft.Msagl.Routing.Rectilinear.WaypointPort.ctor(i.get_Current()),new Microsoft.Msagl.Routing.Rectilinear.WaypointPort.ctor(u.get_Current())))),i.MoveNext();return r.Add(new Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor(new Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor$$Port$$Port(new Microsoft.Msagl.Routing.Rectilinear.WaypointPort.ctor(i.get_Current()),n.get_TargetPort()))),r},GetSingleStagePath:function(n,t,i,r,u){return n.set_PathPoints(t.GetPath$$IEnumerable$1$VisibilityVertex$$IEnumerable$1$VisibilityVertex(i,r)),u&&Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.EnsureNonNullPath(n),n.get_PathPoints()!=null},EnsureNonNullPath:function(n){if(null==n.get_PathPoints()){if(Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureDirection$$Point$$Point(n.get_EdgeGeometry().get_SourcePort().get_Location(),n.get_EdgeGeometry().get_TargetPort().get_Location())){n.set_PathPoints([n.get_EdgeGeometry().get_SourcePort().get_Location(),n.get_EdgeGeometry().get_TargetPort().get_Location()]);return}n.set_PathPoints([n.get_EdgeGeometry().get_SourcePort().get_Location(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_EdgeGeometry().get_SourcePort().get_Location().get_X(),n.get_EdgeGeometry().get_TargetPort().get_Location().get_Y()),n.get_EdgeGeometry().get_TargetPort().get_Location()])}},CalculateArrowheads:function(n){Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(n,n.get_SourcePort().get_Curve(),n.get_TargetPort().get_Curve(),n.get_Curve(),!0,!1)},FitArcsIntoCorners:function(n,t){for(var o=Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.GetFittedArcSegs(n,t),i=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$Int32(t.length),f=null,e=o.GetEnumerator(),r,u;e.MoveNext();)r=e.get_Current(),u=Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.EllipseIsAlmostLineSegment(r),f!=null?u?Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Point(i,Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.CornerPoint(r)):(Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Point(i,r.get_Start()),i.AddSegment(r)):u?Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Point$$Point(i,t[0],Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.CornerPoint(r)):(Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Point$$Point(i,t[0],r.get_Start()),i.AddSegment(r)),f=r;return i.get_Segments().get_Count()>0?Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Point(i,t[t.length-1]):Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Point$$Point(i,t[0],t[t.length-1]),i},CornerPoint:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Center(),n.get_AxisA()),n.get_AxisB())},EllipseIsAlmostLineSegment:function(n){return n.get_AxisA().get_LengthSquared()<.0001||n.get_AxisB().get_LengthSquared()<.0001},GetFittedArcSegs:function(n,t){for(var u,o,f,s=[],r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t[1],t[0]),e=r.Normalize(),h=System.Math.Min$$Double$$Double(n,r.get_Length()/2),i=1;i<t.length-1;i++){u=null;r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t[i+1],t[i]);o=r.get_Length();o<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()&&(u=new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point(0,0,t[i]));f=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(r,o);System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,e))>.9&&(u=new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point(0,0,t[i]));var c=System.Math.Min$$Double$$Double(n,r.get_Length()/2),l=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(-c,f),a=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(h,e);s.push(u!=null?u:new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Point(0,1.5707963267949,l,a,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t[i],a),l)));e=f;h=c}return s}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.GraphGenerator=null;this.ShapeToObstacleMap=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor);this.EdgeGeometries=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor);this.PortManager=null;this.edgeGeomsToSplittedEdgePaths=null;this.removeStaircases=!0;this.selfEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor);this._Padding=0;this._CornerFitRadius=0;this._BendPenaltyAsAPercentageOfDistance=0;this._UseObstacleRectangles=!1;this._AncestorsSets=null;Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.ctor$$IEnumerable$1$Shape.call(this,null)},Padding$$:"System.Double",get_Padding:function(){return this._Padding},set_Padding:function(n){this._Padding=n},CornerFitRadius$$:"System.Double",get_CornerFitRadius:function(){return this._CornerFitRadius},set_CornerFitRadius:function(n){this._CornerFitRadius=n},BendPenaltyAsAPercentageOfDistance$$:"System.Double",get_BendPenaltyAsAPercentageOfDistance:function(){return this._BendPenaltyAsAPercentageOfDistance},set_BendPenaltyAsAPercentageOfDistance:function(n){this._BendPenaltyAsAPercentageOfDistance=n},RouteToCenterOfObstacles$$:"System.Boolean",get_RouteToCenterOfObstacles:function(){return this.PortManager.get_RouteToCenterOfObstacles()},set_RouteToCenterOfObstacles:function(n){this.PortManager.set_RouteToCenterOfObstacles(n)},LimitPortVisibilitySpliceToEndpointBoundingBox$$:"System.Boolean",get_LimitPortVisibilitySpliceToEndpointBoundingBox:function(){return this.PortManager.get_LimitPortVisibilitySpliceToEndpointBoundingBox()},set_LimitPortVisibilitySpliceToEndpointBoundingBox:function(n){this.PortManager.set_LimitPortVisibilitySpliceToEndpointBoundingBox(n)},AddEdgeGeometryToRoute:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"edgeGeometry");Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n.get_SourcePort().get_Location()),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Point(n.get_TargetPort().get_Location()))?this.selfEdges.Add(n):this.EdgeGeometries.Add(n)},RemoveEdgeGeometryToRoute:function(n){this.EdgeGeometries.Remove(n)},EdgeGeometriesToRoute$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.EdgeGeometry]]",get_EdgeGeometriesToRoute:function(){return this.EdgeGeometries},RemoveAllEdgeGeometriesToRoute:function(){this.EdgeGeometries.Clear()},UseSparseVisibilityGraph$$:"System.Boolean",get_UseSparseVisibilityGraph:function(){return Is(this.GraphGenerator,Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.ctor)},UseObstacleRectangles$$:"System.Boolean",get_UseObstacleRectangles:function(){return this._UseObstacleRectangles},set_UseObstacleRectangles:function(n){this._UseObstacleRectangles=n},Obstacles$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Shape]]",get_Obstacles:function(){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,Microsoft.Msagl.Routing.Shape.ctor,this.ShapeToObstacleMap.get_Values(),$CreateAnonymousDelegate(this,function(n){return n.get_InputShape()}))},PaddedObstacles$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_PaddedObstacles:function(){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.ShapeToObstacleMap.get_Values(),$CreateAnonymousDelegate(this,function(n){return n.get_PaddedPolyline()}))},AddObstacles:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"obstacles");this.AddShapes(n);this.RebuildTreeAndGraph()},AddShapes:function(n){for(var t=n.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.AddObstacleWithoutRebuild(i)},AddObstacle:function(n){this.AddObstacleWithoutRebuild(n);this.RebuildTreeAndGraph()},UpdateObstacles:function(n){var t,i;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"obstacles"),t=n.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.UpdateObstacleWithoutRebuild(i);this.RebuildTreeAndGraph()},UpdateObstacle:function(n){this.UpdateObstacleWithoutRebuild(n);this.RebuildTreeAndGraph()},RemoveObstacles:function(n){var t,i;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"obstacles"),t=n.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.RemoveObstacleWithoutRebuild(i);this.RebuildTreeAndGraph()},RemoveObstacle:function(n){this.RemoveObstacleWithoutRebuild(n);this.RebuildTreeAndGraph()},AddObstacleWithoutRebuild:function(n){if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"shape"),null==n.get_BoundaryCurve())throw $CreateException(new System.InvalidOperationException.ctor$$String("Shape must have a BoundaryCurve"),new Error);this.CreatePaddedObstacle(n)},UpdateObstacleWithoutRebuild:function(n){if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"shape"),null==n.get_BoundaryCurve())throw $CreateException(new System.InvalidOperationException.ctor$$String("Shape must have a BoundaryCurve"),new Error);this.PortManager.RemoveObstaclePorts(this.ShapeToObstacleMap.get_Item$$TKey(n));this.CreatePaddedObstacle(n)},CreatePaddedObstacle:function(n){var t=new Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor$$Shape$$Boolean$$Double(n,this.get_UseObstacleRectangles(),this.get_Padding());this.ShapeToObstacleMap.set_Item$$TKey(n,t);this.PortManager.CreateObstaclePorts(t)},RemoveObstacleWithoutRebuild:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"shape");var t=this.ShapeToObstacleMap.get_Item$$TKey(n);this.ShapeToObstacleMap.Remove(n);this.PortManager.RemoveObstaclePorts(t)},RemoveAllObstacles:function(){this.InternalClear(!1)},RebuildTreeAndGraph:function(){var n=null!=this.get_ObstacleTree().get_Root(),t=null!=this.GraphGenerator.get_VisibilityGraph();this.InternalClear(!0);n&&this.GenerateObstacleTree();t&&this.GenerateVisibilityGraph()},VisibilityGraph$$:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",get_VisibilityGraph:function(){return this.GenerateVisibilityGraph(),this.GraphGenerator.get_VisibilityGraph()},Clear:function(){this.InternalClear(!1)},AncestorsSets$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Routing.Shape],[Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Routing.Shape]]]]",get_AncestorsSets:function(){return this._AncestorsSets},set_AncestorsSets:function(n){this._AncestorsSets=n},ctor$$IEnumerable$1$Shape:function(n){this.GraphGenerator=null;this.ShapeToObstacleMap=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor);this.EdgeGeometries=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor);this.PortManager=null;this.edgeGeomsToSplittedEdgePaths=null;this.removeStaircases=!0;this.selfEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor);this._Padding=0;this._CornerFitRadius=0;this._BendPenaltyAsAPercentageOfDistance=0;this._UseObstacleRectangles=!1;this._AncestorsSets=null;Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.ctor$$IEnumerable$1$Shape$$Double$$Double$$Boolean$$Boolean.call(this,n,1,3,!1,!1)},ctor$$IEnumerable$1$Shape$$Double$$Double$$Boolean:function(n,t,i,r){this.GraphGenerator=null;this.ShapeToObstacleMap=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor);this.EdgeGeometries=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor);this.PortManager=null;this.edgeGeomsToSplittedEdgePaths=null;this.removeStaircases=!0;this.selfEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor);this._Padding=0;this._CornerFitRadius=0;this._BendPenaltyAsAPercentageOfDistance=0;this._UseObstacleRectangles=!1;this._AncestorsSets=null;Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.ctor$$IEnumerable$1$Shape$$Double$$Double$$Boolean$$Boolean.call(this,n,t,i,r,!1)},ctor$$IEnumerable$1$Shape$$Double$$Double$$Boolean$$Boolean:function(n,t,i,r,u){this.GraphGenerator=null;this.ShapeToObstacleMap=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor);this.EdgeGeometries=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor);this.PortManager=null;this.edgeGeomsToSplittedEdgePaths=null;this.removeStaircases=!0;this.selfEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor);this._Padding=0;this._CornerFitRadius=0;this._BendPenaltyAsAPercentageOfDistance=0;this._UseObstacleRectangles=!1;this._AncestorsSets=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.set_Padding(t);this.set_CornerFitRadius(i);this.set_BendPenaltyAsAPercentageOfDistance(4);this.GraphGenerator=r?new Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.ctor:new Microsoft.Msagl.Routing.Rectilinear.FullVisibilityGraphGenerator.ctor;this.set_UseObstacleRectangles(u);this.PortManager=new Microsoft.Msagl.Routing.Rectilinear.PortManager.ctor(this.GraphGenerator);this.AddShapes(n)},ctor$$GeometryGraph$$Double$$Double$$Boolean:function(n,t,i,r){this.GraphGenerator=null;this.ShapeToObstacleMap=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor);this.EdgeGeometries=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor);this.PortManager=null;this.edgeGeomsToSplittedEdgePaths=null;this.removeStaircases=!0;this.selfEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor);this._Padding=0;this._CornerFitRadius=0;this._BendPenaltyAsAPercentageOfDistance=0;this._UseObstacleRectangles=!1;this._AncestorsSets=null;Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.ctor$$GeometryGraph$$Double$$Double$$Boolean$$Boolean.call(this,n,t,i,r,!1)},ctor$$GeometryGraph$$Double$$Double$$Boolean$$Boolean:function(n,t,i,r,u){var f,e;for(this.GraphGenerator=null,this.ShapeToObstacleMap=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.Rectilinear.Obstacle.ctor),this.EdgeGeometries=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor),this.PortManager=null,this.edgeGeomsToSplittedEdgePaths=null,this.removeStaircases=!0,this.selfEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor),this._Padding=0,this._CornerFitRadius=0,this._BendPenaltyAsAPercentageOfDistance=0,this._UseObstacleRectangles=!1,this._AncestorsSets=null,Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.ctor$$IEnumerable$1$Shape$$Double$$Double$$Boolean$$Boolean.call(this,Microsoft.Msagl.Routing.ShapeCreator.GetShapes(n),t,i,r,u),Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"graph"),f=n.get_Edges().GetEnumerator();f.MoveNext();)e=f.get_Current(),this.AddEdgeGeometryToRoute(e.get_EdgeGeometry())},RunInternal:function(){this.RouteEdges()},RouteEdges:function(){this.GenerateVisibilityGraph();this.GeneratePaths()},GeneratePaths:function(){this.edgeGeomsToSplittedEdgePaths=Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.SplitEdgeGeomsWithWaypoints(this.EdgeGeometries);var n=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,this.EdgeGeometries,$CreateAnonymousDelegate(this,function(n){return!n.get_HasWaypoints()})),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor(n)}))),t=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,this.edgeGeomsToSplittedEdgePaths.get_Keys(),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor(n)})));this.FillEdgePathsWithShortestPaths(System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,n,t));this.NudgePaths(System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,n,System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(System.Collections.Generic.IEnumerable$1.ctor,Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,this.edgeGeomsToSplittedEdgePaths.get_Values(),$CreateAnonymousDelegate(this,function(n){return n}))));this.UniteEdgeCurvesBetweenWaypoints();this.RouteSelfEdges();this.FinaliseEdgeGeometries()},RouteSelfEdges:function(){for(var t=this.selfEdges.GetEnumerator(),n,i;t.MoveNext();)n=t.get_Current(),n.set_Curve(function(){var t={Value:i},r=Microsoft.Msagl.Core.Layout.Edge.RouteSelfEdge(n.get_SourcePort().get_Curve(),System.Math.Max$$Double$$Double(this.get_Padding(),2*n.GetMaxArrowheadLength()),t);return i=t.Value,r}.call(this))},UniteEdgeCurvesBetweenWaypoints:function(){for(var n=this.edgeGeomsToSplittedEdgePaths.GetEnumerator(),f;n.MoveNext();){for(var t=n.get_Current(),e=t.get_Key(),i=t.get_Value(),r=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(As(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,i).get_EdgeGeometry().get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)),u=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,System.Linq.Enumerable.Skip$1(Microsoft.Msagl.Routing.Rectilinear.Nudging.Path.ctor,i,1),$CreateAnonymousDelegate(this,function(n){return n.get_EdgeGeometry()})).GetEnumerator();u.MoveNext();)f=u.get_Current(),r.AddRangeOfPoints(System.Linq.Enumerable.Skip$1(Microsoft.Msagl.Core.Geometry.Point.ctor,As(f.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),1));e.set_Curve(r)}},FillEdgePathsWithShortestPaths:function(n){var i,t,r;for(this.PortManager.BeginRouteEdges(),i=new Microsoft.Msagl.Routing.Rectilinear.MsmtRectilinearPath.ctor(this.get_BendPenaltyAsAPercentageOfDistance()),t=n.GetEnumerator();t.MoveNext();)r=t.get_Current(),this.ProgressStep(),this.AddControlPointsAndGeneratePath(i,r);this.PortManager.EndRouteEdges()},AddControlPointsAndGeneratePath:function(n,t){if(!t.get_EdgeGeometry().get_HasWaypoints()){var i=this.PortManager.GetPortVisibilityIntersection(t.get_EdgeGeometry());if(i!=null){this.GeneratePathThroughVisibilityIntersection(t,i);return}}this.SpliceVisibilityAndGeneratePath(n,t)},GeneratePathThroughVisibilityIntersection:function(n,t){n.set_PathPoints(t)},SpliceVisibilityAndGeneratePath:function(n,t){this.PortManager.AddControlPointsToGraph(t.get_EdgeGeometry(),this.ShapeToObstacleMap);this.GeneratePath(n,t,!1)||this.RetryPathsWithAdditionalGroupsEnabled(n,t);this.PortManager.RemoveControlPointsFromGraph()},GeneratePath:function(n,t,i){var r=this.PortManager.FindVertices(t.get_EdgeGeometry().get_SourcePort()),u=this.PortManager.FindVertices(t.get_EdgeGeometry().get_TargetPort());return t.get_EdgeGeometry().get_HasWaypoints()?this.GetMultiStagePath(t,n,r,u,i):Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.GetSingleStagePath(t,n,r,u,i)},GetMultiStagePath:function(n,t,i,r,u){var l=this.PortManager.FindWaypointVertices(n.get_EdgeGeometry().get_Waypoints()),c=t.GetPath$$IEnumerable$1$VisibilityVertex$$IEnumerable$1$VisibilityVertex$$IEnumerable$1$VisibilityVertex(i,l,r),e,o,s,h,f;if(c==null){if(!u)return!1;for(e=this.edgeGeomsToSplittedEdgePaths.get_Item$$TKey(n.get_EdgeGeometry()).GetEnumerator();e.MoveNext();)f=e.get_Current(),o=f.get_EdgeGeometry(),Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.GetSingleStagePath(f,t,this.PortManager.FindVertices(o.get_SourcePort()),this.PortManager.FindVertices(o.get_TargetPort()),!0);return!0}for(s=c.GetEnumerator(),h=this.edgeGeomsToSplittedEdgePaths.get_Item$$TKey(n.get_EdgeGeometry()).GetEnumerator();h.MoveNext();)f=h.get_Current(),s.MoveNext(),f.set_PathPoints(s.get_Current());return!0},RetryPathsWithAdditionalGroupsEnabled:function(n,t){this.PortManager.SetAllAncestorsActive(t.get_EdgeGeometry(),this.ShapeToObstacleMap)&&this.GeneratePath(n,t,!1)||(this.PortManager.SetAllGroupsActive(),this.GeneratePath(n,t,!0))},NudgePaths:function(n){var t=this.get_ObstacleTree().SpatialAncestorsAdjusted?Microsoft.Msagl.Routing.SplineRouter.GetAncestorSetsMap(this.get_Obstacles()):this.get_AncestorsSets();Microsoft.Msagl.Routing.Rectilinear.Nudging.Nudger.NudgePaths(n,this.get_CornerFitRadius(),this.get_PaddedObstacles(),t,this.get_RemoveStaircases())},RemoveStaircases$$:"System.Boolean",get_RemoveStaircases:function(){return this.removeStaircases},set_RemoveStaircases:function(n){this.removeStaircases=n},FinaliseEdgeGeometries:function(){for(var i=System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,this.EdgeGeometries,this.selfEdges).GetEnumerator(),n,t;i.MoveNext();)(n=i.get_Current(),null!=n.get_Curve())&&(t=As(n.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),t!=null&&n.set_Curve(Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.FitArcsIntoCorners(this.get_CornerFitRadius(),System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,t))),Microsoft.Msagl.Routing.Rectilinear.RectilinearEdgeRouter.CalculateArrowheads(n))},CreateVisibilityGraph:function(){this.GraphGenerator.Clear();this.InitObstacleTree();this.GraphGenerator.GenerateVisibilityGraph()},ObstacleTree$$:"Microsoft.Msagl.Routing.Rectilinear.ObstacleTree",get_ObstacleTree:function(){return this.GraphGenerator.ObstacleTree},GenerateObstacleTree:function(){if(null==this.get_Obstacles()||!System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,this.get_Obstacles()))throw $CreateException(new System.InvalidOperationException.ctor,new Error);null==this.get_ObstacleTree().get_Root()&&this.InitObstacleTree()},InitObstacleTree:function(){this.set_AncestorsSets(Microsoft.Msagl.Routing.SplineRouter.GetAncestorSetsMap(this.get_Obstacles()));this.get_ObstacleTree().Init(this.ShapeToObstacleMap.get_Values(),this.get_AncestorsSets(),this.ShapeToObstacleMap)},InternalClear:function(n){this.GraphGenerator.Clear();this.ClearShortestPaths();n?this.PortManager.ClearVisibility():(this.PortManager.Clear(),this.ShapeToObstacleMap.Clear(),this.EdgeGeometries.Clear())},ClearShortestPaths:function(){for(var n=this.EdgeGeometries.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.set_Curve(null)},GenerateVisibilityGraph:function(){if(null==this.get_Obstacles()||!System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,this.get_Obstacles()))throw $CreateException(new System.InvalidOperationException.ctor,new Error);this.GraphGenerator.get_VisibilityGraph()==null&&this.CreateVisibilityGraph()}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$RectilinearEdgeRouter);Microsoft$Msagl$Routing$Rectilinear$HighReflectionEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.HighReflectionEvent",baseTypeName:"Microsoft.Msagl.Routing.Rectilinear.BasicReflectionEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this._Side=null;Microsoft.Msagl.Routing.Rectilinear.BasicReflectionEvent.ctor$$BasicReflectionEvent$$Obstacle$$Point.call(this,n,t.get_Obstacle(),i);this.set_Side(t)},Side$$:"Microsoft.Msagl.Routing.Rectilinear.HighObstacleSide",get_Side:function(){return this._Side},set_Side:function(n){this._Side=n}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$HighReflectionEvent);Microsoft$Msagl$Routing$Rectilinear$ScanDirection={fullname:"Microsoft.Msagl.Routing.Rectilinear.ScanDirection",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Rectilinear.ScanDirection.horizontalInstance=new Microsoft.Msagl.Routing.Rectilinear.ScanDirection.ctor(Microsoft.Msagl.Core.Geometry.Directions.East);Microsoft.Msagl.Routing.Rectilinear.ScanDirection.verticalInstance=new Microsoft.Msagl.Routing.Rectilinear.ScanDirection.ctor(Microsoft.Msagl.Core.Geometry.Directions.North)},HorizontalInstance$$:"Microsoft.Msagl.Routing.Rectilinear.ScanDirection",get_HorizontalInstance:function(){return Microsoft.Msagl.Routing.Rectilinear.ScanDirection.horizontalInstance},VerticalInstance$$:"Microsoft.Msagl.Routing.Rectilinear.ScanDirection",get_VerticalInstance:function(){return Microsoft.Msagl.Routing.Rectilinear.ScanDirection.verticalInstance},GetInstance:function(n){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsVertical$$Directions(n)?Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_VerticalInstance():Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_HorizontalInstance()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this._Direction=Microsoft.Msagl.Core.Geometry.Directions.None;this._DirectionAsPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._PerpDirection=Microsoft.Msagl.Core.Geometry.Directions.None;this._PerpDirectionAsPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._OppositeDirection=Microsoft.Msagl.Core.Geometry.Directions.None;System.Object.ctor.call(this);System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsAscending(n),"directionAlongScanLine must be ascending");this.set_Direction(n);this.set_DirectionAsPoint(Microsoft.Msagl.Core.Geometry.CompassVector.ToPoint$$Directions(this.get_Direction()));this.set_PerpDirection(Microsoft.Msagl.Core.Geometry.Directions.North==n?Microsoft.Msagl.Core.Geometry.Directions.East:Microsoft.Msagl.Core.Geometry.Directions.North);this.set_PerpDirectionAsPoint(Microsoft.Msagl.Core.Geometry.CompassVector.ToPoint$$Directions(this.get_PerpDirection()));this.set_OppositeDirection(Microsoft.Msagl.Core.Geometry.CompassVector.OppositeDir(n))},Direction$$:"Microsoft.Msagl.Core.Geometry.Directions",get_Direction:function(){return this._Direction},set_Direction:function(n){this._Direction=n},DirectionAsPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_DirectionAsPoint:function(){return this._DirectionAsPoint},set_DirectionAsPoint:function(n){this._DirectionAsPoint=n},PerpDirection$$:"Microsoft.Msagl.Core.Geometry.Directions",get_PerpDirection:function(){return this._PerpDirection},set_PerpDirection:function(n){this._PerpDirection=n},PerpDirectionAsPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_PerpDirectionAsPoint:function(){return this._PerpDirectionAsPoint},set_PerpDirectionAsPoint:function(n){this._PerpDirectionAsPoint=n},OppositeDirection$$:"Microsoft.Msagl.Core.Geometry.Directions",get_OppositeDirection:function(){return this._OppositeDirection},set_OppositeDirection:function(n){this._OppositeDirection=n},IsHorizontal$$:"System.Boolean",get_IsHorizontal:function(){return Microsoft.Msagl.Core.Geometry.Directions.East==this.get_Direction()},IsVertical$$:"System.Boolean",get_IsVertical:function(){return Microsoft.Msagl.Core.Geometry.Directions.North==this.get_Direction()},Compare:function(n,t){var i=this.ComparePerpCoord(n,t);return 0!=i?i:this.CompareScanCoord(n,t)},CompareScanCoord:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t),this.get_DirectionAsPoint()),0)},ComparePerpCoord:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t),this.get_PerpDirectionAsPoint()),0)},IsFlat$$SegmentBase:function(n){return this.IsFlat$$Point$$Point(n.get_Start(),n.get_End())},IsFlat$$Point$$Point:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),this.get_PerpDirectionAsPoint()),0)},IsPerpendicular$$SegmentBase:function(n){return this.IsPerpendicular$$Point$$Point(n.get_Start(),n.get_End())},IsPerpendicular$$Point$$Point:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),this.get_DirectionAsPoint()),0)},Coord:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(n,this.get_DirectionAsPoint())},Min:function(n,t){return this.Compare(n,t)<=0?n:t},Max:function(n,t){return this.Compare(n,t)>=0?n:t},PerpendicularInstance$$:"Microsoft.Msagl.Routing.Rectilinear.ScanDirection",get_PerpendicularInstance:function(){return this.get_IsHorizontal()?Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_VerticalInstance():Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_HorizontalInstance()},toString:function(){return this.get_Direction().toString()}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$ScanDirection);Microsoft$Msagl$Routing$Rectilinear$RectilinearScanLine={fullname:"Microsoft.Msagl.Routing.Rectilinear.RectilinearScanLine",baseTypeName:"System.Object",staticDefinition:{Debug_VerifySidesDoNotIntersect:function(n,t){var i,r;(function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.LineLineIntersection(n.get_Start(),n.get_End(),t.get_Start(),t.get_End(),r);return i=r.Value,u})()&&(r=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Start(),i),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,n.get_End()))>=-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Start(),i),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t.get_End()))>=-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon,System.Diagnostics.Debug.Assert$$Boolean$$String(!r,"Shouldn't have interior intersections except sides of the same obstacle"))}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n,t){this.scanDirection=null;this.linePositionAtLastInsertOrRemove=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._SideTree=null;System.Object.ctor.call(this);this.scanDirection=n;this.set_SideTree(new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide.ctor,this));this.linePositionAtLastInsertOrRemove=t},SideTree$$:"Microsoft.Msagl.Core.DataStructures.RbTree`1[[Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide]]",get_SideTree:function(){return this._SideTree},set_SideTree:function(n){this._SideTree=n},Insert:function(n,t){this.Assert(!this.scanDirection.IsFlat$$SegmentBase(n),"Flat sides are not allowed in the scanline");this.Assert(null==this.Find(n),"side already exists in the ScanLine");this.linePositionAtLastInsertOrRemove=t;return this.get_SideTree().Insert(n)},Count$$:"System.Int32",get_Count:function(){return this.get_SideTree().get_Count()},Remove:function(n,t){this.Assert(null!=this.Find(n),"side does not exist in the ScanLine");this.linePositionAtLastInsertOrRemove=t;this.get_SideTree().Remove(n)},Find:function(n){return-1==this.scanDirection.ComparePerpCoord(this.linePositionAtLastInsertOrRemove,n.get_Start())?null:this.get_SideTree().Find$$T(n)},NextLow$$BasicObstacleSide:function(n){return this.NextLow$$RBNode$1$BasicObstacleSide(this.Find(n))},NextLow$$RBNode$1$BasicObstacleSide:function(n){return this.get_SideTree().Previous(n)},NextHigh$$BasicObstacleSide:function(n){return this.NextHigh$$RBNode$1$BasicObstacleSide(this.Find(n))},NextHigh$$RBNode$1$BasicObstacleSide:function(n){return this.get_SideTree().Next(n)},Next:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsAscending(n)?this.get_SideTree().Next(t):this.get_SideTree().Previous(t)},Lowest:function(){return this.get_SideTree().TreeMinimum()},Compare:function(n,t){var r,u;if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"first"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"second"),n.get_Obstacle()==t.get_Obstacle())return n==t?0:Is(n,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor)?-1:1;Microsoft.Msagl.Routing.Rectilinear.RectilinearScanLine.Debug_VerifySidesDoNotIntersect(n,t);var f=Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.ScanLineIntersectSide$$Point$$BasicObstacleSide$$ScanDirection(this.linePositionAtLastInsertOrRemove,n,this.scanDirection),e=Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.ScanLineIntersectSide$$Point$$BasicObstacleSide$$ScanDirection(this.linePositionAtLastInsertOrRemove,t,this.scanDirection),i=f.CompareTo(e);return 0==i&&(r=Is(n,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor),u=Is(t,Microsoft.Msagl.Routing.Rectilinear.LowObstacleSide.ctor),i=r.CompareTo$$Boolean(u),0==i&&(i=n.get_Obstacle().get_Ordinal().CompareTo$$Int32(t.get_Obstacle().get_Ordinal()))),i},toString:function(){return this.linePositionAtLastInsertOrRemove+" "+this.scanDirection},Assert:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(n,t)},DevTraceInfo:function(){},DevTraceDump:function(){}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$RectilinearScanLine);Microsoft$Msagl$Routing$Rectilinear$ScanSegment={fullname:"Microsoft.Msagl.Routing.Rectilinear.ScanSegment",baseTypeName:"Microsoft.Msagl.Routing.Visibility.SegmentBase",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Rectilinear.ScanSegment.NormalWeight=1;Microsoft.Msagl.Routing.Rectilinear.ScanSegment.ReflectionWeight=5;Microsoft.Msagl.Routing.Rectilinear.ScanSegment.OverlappedWeight=500},IsVerticalSegment:function(n,t){return n.get_X()==t.get_X()},Subsume:function(n,t,i,r,u,f,e,o,s){return(o.Value=!0,s.Value=!0,null==n.Value)?!1:Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IntervalsOverlap$$Point$$Point$$Point$$Point(n.Value.get_Start(),n.Value.get_End(),t,i)?n.Value.get_Weight()!=r?Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.Value.get_Start(),t)&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.Value.get_End(),i)?(n.Value.set_Weight(System.Math.Min$$Double$$Double(n.Value.get_Weight(),r)),!0):(System.Diagnostics.Debug.Assert$$Boolean$$String(n.Value.get_Weight()==500==(r==500)||Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(n.Value.get_End(),t)||Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(n.Value.get_Start(),i),"non-equal overlap-mismatched ScanSegments overlap by more than just Start/End"),!1):(o.Value=-1==f.CompareScanCoord(t,n.Value.get_Start()),s.Value=1==f.CompareScanCoord(i,n.Value.get_End()),(o.Value||s.Value)&&(e.Remove(n.Value),n.Value.startPoint=f.Min(n.Value.get_Start(),t),n.Value.endPoint=f.Max(n.Value.get_End(),i),n.Value=e.InsertUnique(n.Value).Item,n.Value.MergeGroupBoundaryCrossingList(u)),!0):!1},GetCrossingInteriorVertex:function(n,t,i){var r=i.GetInteriorVertexPoint(t.Point);return n.FindVertex(r)!=null?n.FindVertex(r):n.AddVertex$$Point(r)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$Point$$Point:function(n,t){this.GroupBoundaryPointAndCrossingsList=null;this.endPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.startPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.sparsePerpendicularCoords=null;this._Weight=0;this._NextSegment=null;this._LowestVisibilityVertex=null;this._HighestVisibilityVertex=null;this._NeedStartOverlapVertex=!1;this._NeedEndOverlapVertex=!1;Microsoft.Msagl.Routing.Rectilinear.ScanSegment.ctor$$Point$$Point$$Double$$PointAndCrossingsList.call(this,n,t,1,null)},Weight$$:"System.Double",get_Weight:function(){return this._Weight},set_Weight:function(n){this._Weight=n},NextSegment$$:"Microsoft.Msagl.Routing.Rectilinear.ScanSegment",get_NextSegment:function(){return this._NextSegment},set_NextSegment:function(n){this._NextSegment=n},ctor$$Point$$Point$$Double$$PointAndCrossingsList:function(n,t,i,r){this.GroupBoundaryPointAndCrossingsList=null;this.endPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.startPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.sparsePerpendicularCoords=null;this._Weight=0;this._NextSegment=null;this._LowestVisibilityVertex=null;this._HighestVisibilityVertex=null;this._NeedStartOverlapVertex=!1;this._NeedEndOverlapVertex=!1;Microsoft.Msagl.Routing.Visibility.SegmentBase.ctor.call(this);this.Update(n,t);this.set_Weight(i);this.GroupBoundaryPointAndCrossingsList=r},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.startPoint},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.endPoint},IsVertical$$:"System.Boolean",get_IsVertical:function(){return Microsoft.Msagl.Routing.Rectilinear.ScanSegment.IsVerticalSegment(this.get_Start(),this.get_End())},ScanDirection$$:"Microsoft.Msagl.Routing.Rectilinear.ScanDirection",get_ScanDirection:function(){return this.get_IsVertical()?Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_VerticalInstance():Microsoft.Msagl.Routing.Rectilinear.ScanDirection.get_HorizontalInstance()},LowestVisibilityVertex$$:"Microsoft.Msagl.Routing.Visibility.VisibilityVertex",get_LowestVisibilityVertex:function(){return this._LowestVisibilityVertex},set_LowestVisibilityVertex:function(n){this._LowestVisibilityVertex=n},HighestVisibilityVertex$$:"Microsoft.Msagl.Routing.Visibility.VisibilityVertex",get_HighestVisibilityVertex:function(){return this._HighestVisibilityVertex},set_HighestVisibilityVertex:function(n){this._HighestVisibilityVertex=n},IsOverlapped$$:"System.Boolean",get_IsOverlapped:function(){return 500==this.get_Weight()},IsReflection$$:"System.Boolean",get_IsReflection:function(){return 5==this.get_Weight()},NeedStartOverlapVertex$$:"System.Boolean",get_NeedStartOverlapVertex:function(){return this._NeedStartOverlapVertex},set_NeedStartOverlapVertex:function(n){this._NeedStartOverlapVertex=n},NeedEndOverlapVertex$$:"System.Boolean",get_NeedEndOverlapVertex:function(){return this._NeedEndOverlapVertex},set_NeedEndOverlapVertex:function(n){this._NeedEndOverlapVertex=n},MergeGroupBoundaryCrossingList:function(n){null!=n&&(null==this.GroupBoundaryPointAndCrossingsList&&(this.GroupBoundaryPointAndCrossingsList=new Microsoft.Msagl.Routing.Rectilinear.PointAndCrossingsList.ctor),this.GroupBoundaryPointAndCrossingsList.MergeFrom(n))},TrimGroupBoundaryCrossingList:function(){null!=this.GroupBoundaryPointAndCrossingsList&&this.GroupBoundaryPointAndCrossingsList.Trim(this.get_Start(),this.get_End())},Update:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(n,t)||Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsAscending(Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n,t)),"non-ascending segment");this.startPoint=n;this.endPoint=t},SetInitialVisibilityVertex:function(n){this.set_LowestVisibilityVertex(n);this.set_HighestVisibilityVertex(n)},AppendVisibilityVertex:function(n,t){if(System.Diagnostics.Debug.Assert$$Boolean$$String(null!=t,"newVertex must not be null"),System.Diagnostics.Debug.Assert$$Boolean$$String(null==this.get_LowestVisibilityVertex()==(null==this.get_HighestVisibilityVertex()),"Mismatched null Lowest/HighestVisibilityVertex"),System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.PointIsOnSegment$$SegmentBase$$Point(this,t.Point),"newVertex is out of segment range"),null==this.get_HighestVisibilityVertex())this.AddGroupCrossingsBeforeHighestVisibilityVertex(n,t)||this.SetInitialVisibilityVertex(t);else{if(Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(t.Point,this.get_HighestVisibilityVertex().Point)){System.Diagnostics.Debug.Assert$$Boolean$$String(null!=n.FindEdge$$Point$$Point(t.Point,this.get_HighestVisibilityVertex().Point),"unexpected low/middle insertion to ScanSegment");return}this.AddGroupCrossingsBeforeHighestVisibilityVertex(n,t)||this.AppendHighestVisibilityVertex(t)}},AddVisibilityEdge:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.Point.op_Inequality(n.Point,t.Point),"Self-edges are not allowed");System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(n.Point,t.Point),"Impure or reversed direction encountered");System.Diagnostics.Debug.Assert$$Boolean$$String(null==Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(n,Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.EdgeDirection$$VisibilityVertex$$VisibilityVertex(n,t)),"Duplicate outEdge from Source vertex");System.Diagnostics.Debug.Assert$$Boolean$$String(null==Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.FindNextVertex(t,Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.EdgeDirection$$VisibilityVertex$$VisibilityVertex(t,n)),"Duplicate inEdge to Target vertex");var i=new Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex$$Double(n,t,this.get_Weight());return Microsoft.Msagl.Routing.Visibility.VisibilityGraph.AddEdge$$VisibilityEdge(i),i},AppendHighestVisibilityVertex:function(n){Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(this.get_HighestVisibilityVertex().Point,n.Point)||(this.AddVisibilityEdge(this.get_HighestVisibilityVertex(),n),this.set_HighestVisibilityVertex(n))},LoadStartOverlapVertexIfNeeded:function(n){if(this.get_NeedStartOverlapVertex()){var t=n.FindVertex(this.get_Start());this.AppendVisibilityVertex(n,t!=null?t:n.AddVertex$$Point(this.get_Start()))}},LoadEndOverlapVertexIfNeeded:function(n){if(this.get_NeedEndOverlapVertex()){var t=n.FindVertex(this.get_End());this.AppendVisibilityVertex(n,t!=null?t:n.AddVertex$$Point(this.get_End()))}},OnSegmentIntersectorBegin:function(n){this.AppendGroupCrossingsThroughPoint(n,this.get_Start())||this.LoadStartOverlapVertexIfNeeded(n)},OnSegmentIntersectorEnd:function(n){this.AppendGroupCrossingsThroughPoint(n,this.get_End());this.GroupBoundaryPointAndCrossingsList=null;(null==this.get_HighestVisibilityVertex()||Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(this.get_HighestVisibilityVertex().Point,this.get_End()))&&this.LoadEndOverlapVertexIfNeeded(n)},IntersectsSegment:function(n){return Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.SegmentsIntersect$$SegmentBase$$SegmentBase(this,n)},toString:function(){return"["+this.get_Start()+" -> "+this.get_End()+(this.get_IsOverlapped()?" olap":" free")+"]"},ContainsPoint:function(n){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(this.get_Start(),n)||Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(this.get_End(),n)||Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(this.get_Start(),n)==Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n,this.get_End())},HasSparsePerpendicularCoords$$:"System.Boolean",get_HasSparsePerpendicularCoords:function(){return Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(this.sparsePerpendicularCoords,null)?!1:this.sparsePerpendicularCoords.get_Count()>0},CreatePointFromPerpCoord:function(n){return this.get_IsVertical()?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Start().get_X(),n):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,this.get_Start().get_Y())},AddSparseVertexCoord:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(this.ContainsPoint(this.CreatePointFromPerpCoord(n)),"vertexLocation is not on Segment");Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(this.sparsePerpendicularCoords,null)&&(this.sparsePerpendicularCoords=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(System.Double.ctor));this.sparsePerpendicularCoords.Insert(n)},AddSparseEndpoint:function(n){return this.sparsePerpendicularCoords.Contains$$T(n)?!1:(this.sparsePerpendicularCoords.Insert(n),!0)},CreateSparseVerticesAndEdges:function(n){var i,r,t;if(!Microsoft.Msagl.Core.DataStructures.Set$1.op_Equality(this.sparsePerpendicularCoords,null)){for(this.AppendGroupCrossingsThroughPoint(n,this.get_Start()),i=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(System.Double.ctor,System.Double.ctor,this.sparsePerpendicularCoords,$CreateAnonymousDelegate(this,function(n){return n})).GetEnumerator();i.MoveNext();)r=i.get_Current(),t=this.CreatePointFromPerpCoord(r),System.Diagnostics.Debug.Assert$$Boolean$$String(this.ContainsPoint(t),"vertexLocation is not on Segment"),this.AppendVisibilityVertex(n,n.FindVertex(t)!=null?n.FindVertex(t):n.AddVertex$$Point(t));this.AppendGroupCrossingsThroughPoint(n,this.get_End());this.GroupBoundaryPointAndCrossingsList=null;this.sparsePerpendicularCoords.Clear();this.sparsePerpendicularCoords=null}},HasVisibility:function(){return null!=this.get_LowestVisibilityVertex()},AddGroupCrossingsBeforeHighestVisibilityVertex:function(n,t){return this.AppendGroupCrossingsThroughPoint(n,t.Point)?(Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(this.get_HighestVisibilityVertex().Point,t.Point)&&(this.AddVisibilityEdge(this.get_HighestVisibilityVertex(),t),this.set_HighestVisibilityVertex(t)),!0):!1},AppendGroupCrossingsThroughPoint:function(n,t){var u,r;if(null==this.GroupBoundaryPointAndCrossingsList)return!1;for(u=!1;this.GroupBoundaryPointAndCrossingsList.CurrentIsBeforeOrAt(t);){var i=this.GroupBoundaryPointAndCrossingsList.Pop(),f=null,e=null;Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(i.get_Location(),this.get_Start())>0&&(f=Microsoft.Msagl.Routing.Rectilinear.PointAndCrossingsList.ToCrossingArray(i.get_Crossings(),this.get_ScanDirection().get_OppositeDirection()));Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(i.get_Location(),this.get_End())<0&&(e=Microsoft.Msagl.Routing.Rectilinear.PointAndCrossingsList.ToCrossingArray(i.get_Crossings(),this.get_ScanDirection().get_Direction()));u=!0;r=n.FindVertex(i.get_Location())!=null?n.FindVertex(i.get_Location()):n.AddVertex$$Point(i.get_Location());null!=f||null!=e?(this.AddLowCrossings(n,r,f),this.AddHighCrossings(n,r,e)):null==this.get_LowestVisibilityVertex()?this.SetInitialVisibilityVertex(r):(System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(this.get_End(),r.Point),"Expected this.End crossingVertex"),this.AppendHighestVisibilityVertex(r))}return u},AddCrossingEdge:function(n,t,i,r){var u=null,f,e;null!=this.get_HighestVisibilityVertex()&&(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Point$$Point(this.get_HighestVisibilityVertex().Point,i.Point)?(u=n.FindEdge$$Point$$Point(t.Point,i.Point),System.Diagnostics.Debug.Assert$$Boolean$$String(u!=null,"Inconsistent forward-backward sequencing in HighVisibilityVertex")):this.AppendHighestVisibilityVertex(t));u==null&&(u=this.AddVisibilityEdge(t,i));f=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Routing.Shape.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Rectilinear.GroupBoundaryCrossing.ctor,Microsoft.Msagl.Routing.Shape.ctor,r,$CreateAnonymousDelegate(this,function(n){return n.get_Group().get_InputShape()})));e=u.get_IsPassable();e==null?u.set_IsPassable($CreateAnonymousDelegate(this,function(){return System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,f,$CreateAnonymousDelegate(this,function(n){return n.get_IsTransparent()}))})):u.set_IsPassable($CreateAnonymousDelegate(this,function(){return System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,f,$CreateAnonymousDelegate(this,function(n){return n.get_IsTransparent()}))||e()}));null==this.get_LowestVisibilityVertex()&&this.SetInitialVisibilityVertex(t);this.set_HighestVisibilityVertex(i)},AddLowCrossings:function(n,t,i){if(null!=i){var r=Microsoft.Msagl.Routing.Rectilinear.ScanSegment.GetCrossingInteriorVertex(n,t,i[0]);this.AddCrossingEdge(n,r,t,i)}},AddHighCrossings:function(n,t,i){if(null!=i){var r=Microsoft.Msagl.Routing.Rectilinear.ScanSegment.GetCrossingInteriorVertex(n,t,i[0]);this.AddCrossingEdge(n,t,r,i)}}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$ScanSegment);Microsoft$Msagl$Routing$Rectilinear$SegmentIntersector={fullname:"Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1","System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(){this.eventList=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEvent.ctor);this.findFirstPred=null;this.segmentsWithoutVisibility=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Rectilinear.ScanSegment.ctor);this.verticalSegmentsScanLine=null;this.findFirstHSeg=null;this.visGraph=null;System.Object.ctor.call(this);this.verticalSegmentsScanLine=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Rectilinear.ScanSegment.ctor,this);this.findFirstPred=$CreateDelegate(this,this.IsVSegInHSegRange)},IsVSegInHSegRange:function(n){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n.get_Start().get_X(),this.findFirstHSeg.get_Start().get_X())>=0},Generate:function(n,t){for(var e=t.GetEnumerator(),u,r,f,i;e.MoveNext();)r=e.get_Current(),this.eventList.Add(new Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEvent.ctor(Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.VOpen,r)),this.eventList.Add(new Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEvent.ctor(Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.VClose,r));for(u=n.GetEnumerator();u.MoveNext();)r=u.get_Current(),this.eventList.Add(new Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEvent.ctor(Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.HOpen,r));if(0==this.eventList.get_Count())return null;for(this.eventList.Sort$$IComparer$1(this),this.visGraph=Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.NewVisibilityGraph(),f=this.eventList.GetEnumerator();f.MoveNext();){i=f.get_Current();switch(i.get_EventType()){case Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.VOpen:this.OnSegmentOpen(i.get_Segment());this.ScanInsert(i.get_Segment());break;case Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.VClose:this.OnSegmentClose(i.get_Segment());this.ScanRemove(i.get_Segment());break;case Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.HOpen:this.OnSegmentOpen(i.get_Segment());this.ScanIntersect(i.get_Segment());break;default:System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"Unknown SegEventType")}}return this.visGraph},OnSegmentOpen:function(n){n.OnSegmentIntersectorBegin(this.visGraph)},OnSegmentClose:function(n){n.OnSegmentIntersectorEnd(this.visGraph);null==n.get_LowestVisibilityVertex()&&this.segmentsWithoutVisibility.Add(n)},RemoveSegmentsWithNoVisibility:function(n,t){for(var r=this.segmentsWithoutVisibility.GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),(i.get_IsVertical()?t:n).Remove(i)},ScanInsert:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(null==this.verticalSegmentsScanLine.Find$$T(n),"seg already exists in the rbtree");this.verticalSegmentsScanLine.Insert(n)},ScanRemove:function(n){this.verticalSegmentsScanLine.Remove(n)},ScanIntersect:function(n){var t,i,r;for(this.findFirstHSeg=n,t=this.verticalSegmentsScanLine.FindFirst$$Func$2(this.findFirstPred);null!=t;t=this.verticalSegmentsScanLine.Next(t)){if(i=t.Item,1==Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(i.get_Start().get_X(),n.get_End().get_X()))break;r=this.visGraph.AddVertex$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i.get_Start().get_X(),n.get_Start().get_Y()));n.AppendVisibilityVertex(this.visGraph,r);i.AppendVisibilityVertex(this.visGraph,r)}this.OnSegmentClose(n)},Compare$$SegEvent$$SegEvent:function(n,t){var i,r;return n==t?0:n==null?-1:t==null?1:(i=Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n.get_Site().get_Y(),t.get_Site().get_Y()),0!=i)?i:n.get_IsVertical()&&t.get_IsVertical()?(System.Diagnostics.Debug.Assert$$Boolean$$String(!Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IntervalsOverlap$$SegmentBase$$SegmentBase(n.get_Segment(),t.get_Segment())||0==Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(n.get_Segment().get_Start(),t.get_Segment().get_End())||0==Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(n.get_Segment().get_End(),t.get_Segment().get_Start()),"V subsumption failure detected in SegEvent comparison"),0==i&&(i=(Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.VClose==n.get_EventType()).CompareTo$$Boolean(Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.VClose==t.get_EventType())),i):!n.get_IsVertical()&&!t.get_IsVertical()?(System.Diagnostics.Debug.Assert$$Boolean$$String(!Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IntervalsOverlap$$SegmentBase$$SegmentBase(n.get_Segment(),t.get_Segment())||0==Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(n.get_Segment().get_Start(),t.get_Segment().get_End())||0==Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Point$$Point(n.get_Segment().get_End(),t.get_Segment().get_Start()),"H subsumption failure detected in SegEvent comparison"),Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n.get_Site().get_X(),t.get_Site().get_X())):(r=n.get_IsVertical()?n:t,i=-1,Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.VClose==r.get_EventType()&&(i=1),r!=n&&(i*=-1),i)},Compare$$ScanSegment$$ScanSegment:function(n,t){if(n==t)return 0;if(n==null)return-1;if(t==null)return 1;var i=Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n.get_Start().get_X(),t.get_Start().get_X());return 0==i&&(i=Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n.get_Start().get_Y(),t.get_Start().get_Y())),i}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$SegmentIntersector);Microsoft$Msagl$Routing$Rectilinear$WaypointPort={fullname:"Microsoft.Msagl.Routing.Rectilinear.WaypointPort",baseTypeName:"Microsoft.Msagl.Core.Layout.FloatingPort",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.location=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Core.Layout.FloatingPort.ctor.call(this,null,n);this.location=n},Location$$:"Microsoft.Msagl.Core.Geometry.Point",get_Location:function(){return this.location},Curve$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Curve:function(){return null}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$WaypointPort);Microsoft$Msagl$Routing$RelaxedPolylinePoint={fullname:"Microsoft.Msagl.Routing.RelaxedPolylinePoint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.polylinePoint=null;this.originalPosition=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.next=null;this.prev=null;System.Object.ctor.call(this);this.set_PolylinePoint(n);this.set_OriginalPosition(t)},PolylinePoint$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_PolylinePoint:function(){return this.polylinePoint},set_PolylinePoint:function(n){this.polylinePoint=n},OriginalPosition$$:"Microsoft.Msagl.Core.Geometry.Point",get_OriginalPosition:function(){return this.originalPosition},set_OriginalPosition:function(n){this.originalPosition=n},Next$$:"Microsoft.Msagl.Routing.RelaxedPolylinePoint",get_Next:function(){return this.next},set_Next:function(n){this.next=n},Prev$$:"Microsoft.Msagl.Routing.RelaxedPolylinePoint",get_Prev:function(){return this.prev},set_Prev:function(n){this.prev=n}}};JsTypes.push(Microsoft$Msagl$Routing$RelaxedPolylinePoint);Microsoft$Msagl$Layout$Layered$HierarchyCalculator={fullname:"Microsoft.Msagl.Layout.Layered.HierarchyCalculator",baseTypeName:"System.Object",staticDefinition:{Calculate$$List$1$ParallelogramNode$$Int32:function(n,t){var i=new Microsoft.Msagl.Layout.Layered.HierarchyCalculator.ctor(n,t);return i.Calculate()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.initialNodes=null;this.groupSplitThreshold=2;System.Object.ctor.call(this);this.initialNodes=n;this.groupSplitThreshold=t},Calculate:function(){return this.Calc(this.initialNodes)},Calc:function(n){var c,r,l,u,f,e,o,t,h;if(n.get_Count()==0)return null;if(n.get_Count()==1)return n.get_Item$$Int32(0);var y=n.get_Item$$Int32(0).get_Parallelogram(),i=1,s=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Parallelogram$$Parallelogram(y,n.get_Item$$Int32(i).get_Parallelogram()).get_Area();for(t=2;t<n.get_Count();t++)c=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Parallelogram$$Parallelogram(y,n.get_Item$$Int32(t).get_Parallelogram()).get_Area(),c>s&&(i=t,s=c);for(r=0,t=0;t<n.get_Count();t++)if(t!=i){r=t;break}for(s=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Parallelogram$$Parallelogram(n.get_Item$$Int32(i).get_Parallelogram(),n.get_Item$$Int32(r).get_Parallelogram()).get_Area(),t=0;t<n.get_Count();t++)t!=i&&(l=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Parallelogram$$Parallelogram(n.get_Item$$Int32(i).get_Parallelogram(),n.get_Item$$Int32(t).get_Parallelogram()).get_Area(),l>s&&(r=t,s=l));for(u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode.ctor),f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode.ctor),u.Add(n.get_Item$$Int32(i)),f.Add(n.get_Item$$Int32(r)),e=n.get_Item$$Int32(i).get_Parallelogram(),o=n.get_Item$$Int32(r).get_Parallelogram(),t=0;t<n.get_Count();t++)if(t!=i&&t!=r){var a=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Parallelogram$$Parallelogram(e,n.get_Item$$Int32(t).get_Parallelogram()),p=a.get_Area()-e.get_Area(),v=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Parallelogram$$Parallelogram(o,n.get_Item$$Int32(t).get_Parallelogram()),w=v.get_Area()-o.get_Area();u.get_Count()*this.groupSplitThreshold<f.get_Count()?(u.Add(n.get_Item$$Int32(t)),e=a):f.get_Count()*this.groupSplitThreshold<u.get_Count()?(f.Add(n.get_Item$$Int32(t)),o=v):p<w?(u.Add(n.get_Item$$Int32(t)),e=a):(f.Add(n.get_Item$$Int32(t)),o=v)}return h=new Microsoft.Msagl.Core.Geometry.Curves.ParallelogramBinaryTreeNode.ctor,h.set_Parallelogram(new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Parallelogram$$Parallelogram(e,o)),h.set_LeftSon(this.Calc(u)),h.set_RightSon(this.Calc(f)),h}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$HierarchyCalculator);Microsoft$Msagl$Routing$NodeKind={fullname:"Microsoft.Msagl.Routing.NodeKind",staticDefinition:{Top:0,Internal:1,Bottom:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Routing$NodeKind);Microsoft$Msagl$Layout$Layered$Points={fullname:"Microsoft.Msagl.Layout.Layered.Points",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$Points);Microsoft$Msagl$Layout$Layered$RefinerBetweenTwoLayers={fullname:"Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers",baseTypeName:"System.Object",staticDefinition:{Refine$$Int32$$Int32$$Site$$Anchor$Array$$LayerArrays$$ProperLayeredGraph$$GeometryGraph$$Double:function(n,t,i,r,u,f,e,o){var s=new Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.ctor(n,t,i,u,f,e,r,o);s.Refine()},AbsCotan:function(n){return System.Math.Abs$$Double(n.get_X()/n.get_Y())},PossibleCorner:function(n,t,i){return i.get_X()>n&&i.get_X()<t}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u,f,e,o){this.topNode=0;this.bottomNode=0;this.topSite=null;this.bottomSite=null;this.currentTopSite=null;this.currentBottomSite=null;this.layerArrays=null;this.layeredGraph=null;this.originalGraph=null;this.topCorners=null;this.bottomCorners=null;this.anchors=null;this.random=new System.Random.ctor$$Int32(1);this.layerSeparation=0;System.Object.ctor.call(this);this.topNode=n;this.bottomNode=t;this.topSite=i;this.bottomSite=i.get_Next();this.currentTopSite=i;this.currentBottomSite=i.get_Next();this.layerArrays=r;this.layeredGraph=u;this.originalGraph=f;this.anchors=e;this.layerSeparation=o},Refine:function(){for(this.Init();this.InsertSites(););},FixCorner:function(n,t,i){if(Microsoft.Msagl.Core.Geometry.Point.op_Equality(n,t))return t;var e=Microsoft.Msagl.Core.Geometry.Point.ClosestPointAtLineSegment(t,n,i),r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,e),u=System.Math.Abs$$Double(r.get_Y()),f=this.layerSeparation/2;return u>f&&(r=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,f/(u*2))),Microsoft.Msagl.Core.Geometry.Point.op_Addition(r,t)},InsertSites:function(){return this.random.Next$$Int32(2)==0?this.CalculateNewTopSite()|this.CalculateNewBottomSite():this.CalculateNewBottomSite()|this.CalculateNewTopSite()},CalculateNewBottomSite:function(){for(var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.currentBottomSite.get_Point(),this.currentTopSite.get_Point()),n=Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.AbsCotan(r),u=new Microsoft.Msagl.Core.Geometry.Point.ctor,f=!1,e=this.bottomCorners().GetEnumerator(),t,i;e.MoveNext();)t=e.get_Current(),i=Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.AbsCotan(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,this.currentBottomSite.get_Point())),i<n&&(n=i,u=t,f=!0);return f?Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n,Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.AbsCotan(r))?!1:(this.currentBottomSite=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point$$Site(this.currentTopSite,this.FixCorner(this.currentTopSite.get_Point(),u,this.currentBottomSite.get_Point()),this.currentBottomSite),!0):!1},CalculateNewTopSite:function(){for(var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.currentBottomSite.get_Point(),this.currentTopSite.get_Point()),n=Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.AbsCotan(r),u=new Microsoft.Msagl.Core.Geometry.Point.ctor,f=!1,e=this.topCorners().GetEnumerator(),t,i;e.MoveNext();)t=e.get_Current(),i=Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.AbsCotan(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,this.currentTopSite.get_Point())),i<n&&(n=i,u=t,f=!0);return f?Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n,Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.AbsCotan(r))?!1:(this.currentTopSite=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point$$Site(this.currentTopSite,this.FixCorner(this.currentTopSite.get_Point(),u,this.currentBottomSite.get_Point()),this.currentBottomSite),!0):!1},Init:function(){this.IsTopToTheLeftOfBottom()?(this.topCorners=$CreateDelegate(this,this.CornersToTheRightOfTop),this.bottomCorners=$CreateDelegate(this,this.CornersToTheLeftOfBottom)):(this.topCorners=$CreateDelegate(this,this.CornersToTheLeftOfTop),this.bottomCorners=$CreateDelegate(this,this.CornersToTheRightOfBottom))},IsTopToTheLeftOfBottom:function(){return this.topSite.get_Point().get_X()<this.topSite.get_Next().get_Point().get_X()},NodeCorners:function(n){for(var t=[],i=this.NodeAnchor(n).get_PolygonalBoundary().GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.push(r);return t},NodeAnchor:function(n){return this.anchors[n]},CornersToTheLeftOfBottom:function(){for(var i=[],o=this.layerArrays.get_X()[this.bottomNode],r=this.currentTopSite.get_Point().get_X(),u=this.currentBottomSite.get_Point().get_X(),f=this.LeftFromTheNode(this.NodeLayer(this.bottomNode),o,Microsoft.Msagl.Routing.NodeKind.Bottom,r,u).GetEnumerator(),e,t,n;f.MoveNext();)for(e=f.get_Current(),t=this.NodeCorners(e).GetEnumerator();t.MoveNext();)n=t.get_Current(),n.get_Y()>this.currentBottomSite.get_Point().get_Y()&&Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.PossibleCorner(r,u,n)&&i.push(n);return i},CornersToTheLeftOfTop:function(){for(var i=[],o=this.layerArrays.get_X()[this.topNode],r=this.currentBottomSite.get_Point().get_X(),u=this.currentTopSite.get_Point().get_X(),f=this.LeftFromTheNode(this.NodeLayer(this.topNode),o,Microsoft.Msagl.Routing.NodeKind.Top,r,u).GetEnumerator(),e,t,n;f.MoveNext();)for(e=f.get_Current(),t=this.NodeCorners(e).GetEnumerator();t.MoveNext();)n=t.get_Current(),n.get_Y()<this.currentTopSite.get_Point().get_Y()&&Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.PossibleCorner(r,u,n)&&i.push(n);return i},CornersToTheRightOfBottom:function(){for(var i=[],o=this.layerArrays.get_X()[this.bottomNode],r=this.currentBottomSite.get_Point().get_X(),u=this.currentTopSite.get_Point().get_X(),f=this.RightFromTheNode(this.NodeLayer(this.bottomNode),o,Microsoft.Msagl.Routing.NodeKind.Bottom,r,u).GetEnumerator(),e,t,n;f.MoveNext();)for(e=f.get_Current(),t=this.NodeCorners(e).GetEnumerator();t.MoveNext();)n=t.get_Current(),n.get_Y()>this.currentBottomSite.get_Point().get_Y()&&Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.PossibleCorner(r,u,n)&&i.push(n);return i},CornersToTheRightOfTop:function(){for(var i=[],o=this.layerArrays.get_X()[this.topNode],r=this.currentTopSite.get_Point().get_X(),u=this.currentBottomSite.get_Point().get_X(),f=this.RightFromTheNode(this.NodeLayer(this.topNode),o,Microsoft.Msagl.Routing.NodeKind.Top,r,u).GetEnumerator(),e,t,n;f.MoveNext();)for(e=f.get_Current(),t=this.NodeCorners(e).GetEnumerator();t.MoveNext();)n=t.get_Current(),n.get_Y()<this.currentTopSite.get_Point().get_Y()&&Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.PossibleCorner(r,u,n)&&i.push(n);return i},NodeLayer:function(n){return this.layerArrays.get_Layers()[this.layerArrays.Y[n]]},IsLabel:function(n){return this.anchors[n].get_RepresentsLabel()},NodeUCanBeCrossedByNodeV:function(n,t){return this.IsLabel(n)||this.IsLabel(t)?!1:this.IsVirtualVertex(n)&&this.IsVirtualVertex(t)&&this.AdjacentEdgesIntersect(n,t)?!0:!1},AdjacentEdgesIntersect:function(n,t){return this.Intersect(this.IncomingEdge(n),this.IncomingEdge(t))||this.Intersect(this.OutcomingEdge(n),this.OutcomingEdge(t))},Intersect:function(n,t){return(this.layerArrays.get_X()[n.get_Source()]-this.layerArrays.get_X()[t.get_Source()])*(this.layerArrays.get_X()[n.get_Target()]-this.layerArrays.get_X()[t.get_Target()])<0},IncomingEdge:function(n){for(var t=this.layeredGraph.InEdges(n).GetEnumerator();t.MoveNext();)return t.get_Current();throw $CreateException(new System.InvalidOperationException.ctor,new Error);},OutcomingEdge:function(n){for(var t=this.layeredGraph.OutEdges(n).GetEnumerator();t.MoveNext();)return t.get_Current();throw $CreateException(new System.InvalidOperationException.ctor,new Error);},IsVirtualVertex:function(n){return n>=this.originalGraph.get_Nodes().get_Count()},RightFromTheNode:function(n,t,i,r,u){var s=[],h=0,c=0,l,o,e,f;for(i==Microsoft.Msagl.Routing.NodeKind.Bottom?c=340282346638529e24:i==Microsoft.Msagl.Routing.NodeKind.Top&&(h=340282346638529e24),l=n[t],o=t+1;o<n.length;o++)if(e=n[o],!this.NodeUCanBeCrossedByNodeV(e,l)){if(f=this.anchors[e],f.get_Left()>=u)break;f.get_Right()>r&&(f.get_TopAnchor()>h+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?(h=f.get_TopAnchor(),s.push(e)):f.get_BottomAnchor()>c+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(c=f.get_BottomAnchor(),s.push(e)))}return s},LeftFromTheNode:function(n,t,i,r,u){var s=[],h=0,c=0,l,o,e,f;for(i==Microsoft.Msagl.Routing.NodeKind.Bottom?c=340282346638529e24:i==Microsoft.Msagl.Routing.NodeKind.Top&&(h=340282346638529e24),l=n[t],o=t-1;o>-1;o--)if(e=n[o],!this.NodeUCanBeCrossedByNodeV(e,l)){if(f=this.anchors[e],f.get_Right()<=r)break;f.get_Left()<u&&(f.get_TopAnchor()>h+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?(h=f.get_TopAnchor(),s.push(e)):f.get_BottomAnchor()>c+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(c=f.get_BottomAnchor(),s.push(e)))}return s}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$RefinerBetweenTwoLayers);Microsoft$Msagl$Layout$Layered$Routing={fullname:"Microsoft.Msagl.Layout.Layered.Routing",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},UpdateLabel:function(n,t){var i=null,r,u,f,e,o;(t.get_LabelToTheRightOfAnchorCenter()?(n.get_Label().set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X()+t.get_RightAnchor()/2,t.get_Y())),i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_LabelBBox().get_LeftTop(),n.get_LabelBBox().get_LeftBottom())):t.get_LabelToTheLeftOfAnchorCenter()&&(n.get_Label().set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X()-t.get_LeftAnchor()/2,t.get_Y())),i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_LabelBBox().get_RightTop(),n.get_LabelBBox().get_RightBottom())),r=Microsoft.Msagl.Layout.Layered.Routing.GetSegmentInFrontOfLabel(n.get_Curve(),n.get_Label().get_Center().get_Y()),r!=null)&&Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n.get_Curve(),Microsoft.Msagl.Core.Geometry.Curves.Curve.PolyFromBox(n.get_LabelBBox()),!1).get_Count()==0&&(function(){var n={Value:u},t={Value:f},e=Microsoft.Msagl.Layout.Layered.Routing.FindClosestPoints(n,t,r,i);return u=n.Value,f=t.Value,e}()?function(){var t={Value:u},i={Value:f},r=Microsoft.Msagl.Layout.Layered.Routing.ShiftLabel(n,t,i);return u=t.Value,f=i.Value,r}():(e=r.ClosestParameter(i.get_Start()),o=r.ClosestParameter(i.get_End()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r.get_Item$$Double(e),i.get_Start()).get_Length()<Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r.get_Item$$Double(o),i.get_End()).get_Length()?(u=r.get_Item$$Double(e),f=i.get_Start()):(u=r.get_Item$$Double(o),f=i.get_End()),function(){var t={Value:u},i={Value:f},r=Microsoft.Msagl.Layout.Layered.Routing.ShiftLabel(n,t,i);return u=t.Value,f=i.Value,r}()))},ShiftLabel:function(n,t,i){var u=n.get_LineWidth()/2,f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Value,i.Value),r=f.get_Length();r>u&&n.get_Label().set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Label().get_Center(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(f,r),r-u)))},FindClosestPoints:function(n,t,i,r){var u,f;return function(){var e={Value:u},o={Value:f},s=Microsoft.Msagl.Core.Geometry.Curves.Curve.MinDistWithinIntervals(i,r,i.get_ParStart(),i.get_ParEnd(),r.get_ParStart(),r.get_ParEnd(),(i.get_ParStart()+i.get_ParEnd())/2,(r.get_ParStart()+r.get_ParEnd())/2,e,o,n,t);return u=e.Value,f=o.Value,s}()},GetSegmentInFrontOfLabel:function(n,t){var u=As(n,Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),r,i;if(u!=null){for(r=u.get_Segments().GetEnumerator();r.MoveNext();)if(i=r.get_Current(),(i.get_Start().get_Y()-t)*(i.get_End().get_Y()-t)<=0)return i}else System.Diagnostics.Debug.Assert$$Boolean(!1);return null},GetNodeKind:function(n,t){return n==0?Microsoft.Msagl.Routing.NodeKind.Top:n<t.get_Count()?Microsoft.Msagl.Routing.NodeKind.Internal:Microsoft.Msagl.Routing.NodeKind.Bottom}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u,f){this.settings=null;this.Database=null;this.IntGraph=null;this.LayerArrays=null;this.OriginalGraph=null;this.ProperLayeredGraph=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.settings=n;this.OriginalGraph=t;this.Database=i;this.ProperLayeredGraph=u;this.LayerArrays=r;this.IntGraph=f},RunInternal:function(){this.CreateSplines()},CreateSplines:function(){this.CreateRegularSplines();this.CreateSelfSplines();this.IntGraph!=null&&this.RouteFlatEdges()},RouteFlatEdges:function(){var n=new Microsoft.Msagl.Layout.Layered.FlatEdgeRouter.ctor(this.settings,this);n.Run()},CreateRegularSplines:function(){for(var r=this.Database.get_RegularMultiedges().GetEnumerator(),n;r.MoveNext();){var i=r.get_Current(),t=i.get_Count(),u=t==1;for(n=t/2|0;n<t;n++)this.CreateSplineForNonSelfEdge(i.get_Item$$Int32(n),u);for(n=(t/2|0)-1;n>=0;n--)this.CreateSplineForNonSelfEdge(i.get_Item$$Int32(n),u)}},CreateSelfSplines:function(){for(var c=this.Database.get_Multiedges().GetEnumerator(),o,u,n,r;c.MoveNext();)if(o=c.get_Current(),this.ProgressStep(),u=o.get_Key(),u.x==u.y)for(var f=this.Database.get_Anchors()[u.x],s=f.get_LeftAnchor(),l=o.get_Value().GetEnumerator();l.MoveNext();){n=l.get_Current();this.ProgressStep();var h=this.settings.get_NodeSeparation()+this.settings.get_MinNodeWidth()+s,e=f.get_BottomAnchor()/2,i=f.get_Origin(),p=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,e)),w=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(h,e)),b=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(h,-e)),k=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,-e)),t=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Point(i),a=new Microsoft.Msagl.Core.Geometry.SmoothedPolyline.ctor(t);if(t=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(t,p),t=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(t,w),t=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(t,b),t=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(t,k),new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(t,i),n.set_Curve(r=a.CreateCurve()),n.get_Edge().set_UnderlyingPolyline(a),s=h,n.get_Edge().get_Label()!=null){s+=n.get_Edge().get_Label().get_Width();var v=function(t){return n.get_Edge().get_Label().set_Center(t),t}.call(this,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r.get_Item$$Double((r.get_ParStart()+r.get_ParEnd())/2).get_X()+n.get_LabelWidth()/2,f.get_Y())),y=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_Edge().get_Label().get_Width()/2,n.get_Edge().get_Label().get_Height()/2),d=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(v,y),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(v,y));n.get_Edge().get_Label().set_BoundingBox(d)}Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(n.get_Edge().get_EdgeGeometry(),n.get_Edge().get_Source().get_BoundaryCurve(),n.get_Edge().get_Target().get_BoundaryCurve(),r,!1,this.settings.get_EdgeRoutingSettings().get_KeepOriginalSpline())}},CreateSplineForNonSelfEdge:function(n,t){this.ProgressStep();n.get_LayerEdges()!=null&&(this.DrawSplineBySmothingThePolyline(n,t),n.get_IsVirtualEdge()||(n.UpdateEdgeLabelPosition(this.Database.get_Anchors()),Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(n.get_Edge().get_EdgeGeometry(),n.get_Edge().get_Source().get_BoundaryCurve(),n.get_Edge().get_Target().get_BoundaryCurve(),n.get_Curve(),!0,this.settings.get_EdgeRoutingSettings().get_KeepOriginalSpline())))},DrawSplineBySmothingThePolyline:function(n,t){var i=new Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.ctor(n,this.Database.get_Anchors(),this.OriginalGraph,this.settings,this.LayerArrays,this.ProperLayeredGraph,this.Database),r=i.GetSpline(t);n.get_Reversed()?(n.set_Curve(r.Reverse()),n.set_UnderlyingPolyline(i.Reverse().get_GetPolyline())):(n.set_Curve(r),n.set_UnderlyingPolyline(i.get_GetPolyline()))}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$Routing);Microsoft$Msagl$Routing$SplineRouter={fullname:"Microsoft.Msagl.Routing.SplineRouter",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},EdgesAttachedToPortAvoidTheNode:function(n){return Is(n,Microsoft.Msagl.Core.Layout.CurvePort.ctor)||Is(n,Microsoft.Msagl.Routing.ClusterBoundaryPort.ctor)},RegisterInPortLocationsToEdges:function(n,t){var i,r=new Microsoft.Msagl.Core.Geometry.PointPair.ctor(n.get_SourcePort().get_Location(),n.get_TargetPort().get_Location());(function(){var n={Value:i},u=t.TryGetValue(r,n);return i=n.Value,u})()||t.set_Item$$TKey(r,i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor));i.Add(n)},IsEdgeToParent:function(n){return Is(n.get_SourcePort(),Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor)||Is(n.get_TargetPort(),Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor)},SetTransparency:function(n,t){for(var i=n.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),r.set_IsTransparent(t)},CreateLooseObstacleHierarachy:function(n){return Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,n.get_BoundingBox())}))},FindPointOnPolylineToInsertAfter:function(n,t){for(var r,u,i=n.get_StartPoint();;){if(r=i.get_NextOnPolyline(),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(t,i.get_Point())||Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(t,r.get_Point()))return null;if(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(function(){var n={Value:u},f=Microsoft.Msagl.Core.Geometry.Point.DistToLineSegment(t,i.get_Point(),r.get_Point(),n);return u=n.Value,f}(),0))return i;if(i=r,i==n.get_StartPoint())throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},GetAncestorSetsMap:function(n){for(var t=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor),r=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,n,function(n){return!t.ContainsKey(n)}).GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),t.set_Item$$TKey(i,Microsoft.Msagl.Routing.SplineRouter.GetAncestorSet(i,t));return t},GetAncestorSet:function(n,t){for(var r=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,n.get_Parents()),f=n.get_Parents().GetEnumerator(),i,u;f.MoveNext();)i=f.get_Current(),r=Microsoft.Msagl.Core.DataStructures.Set$1.op_Addition(r,function(){var n={Value:u},r=t.TryGetValue(i,n);return u=n.Value,r}()?u:function(n){return t.set_Item$$TKey(i,n),n}(Microsoft.Msagl.Routing.SplineRouter.GetAncestorSet(i,t)));return r},CreatePortsIfNeeded:function(n){for(var r=n.GetEnumerator(),t,i;r.MoveNext();)t=r.get_Current(),t.get_SourcePort()==null&&(i=t,t.set_SourcePort(function(n){return new Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point(function(){return n.get_Source().get_BoundaryCurve()},function(){return n.get_Source().get_Center()})}(i))),t.get_TargetPort()==null&&(i=t,t.set_TargetPort(function(n){return new Microsoft.Msagl.Core.Layout.RelativeFloatingPort.ctor$$Func$1$ICurve$$Func$1$Point(function(){return n.get_Target().get_BoundaryCurve()},function(){return n.get_Target().get_Center()})}(i)))},ComputeLooseSplinePadding:function(n,t){var i,r;return System.Diagnostics.Debug.Assert$$Boolean$$String(t>0,"require EdgePadding > 0"),i=2*t,System.Diagnostics.Debug.Assert$$Boolean$$String(n>i,"require OverlapSeparation > 2*EdgePadding"),r=(n-i)/8,System.Diagnostics.Debug.Assert$$Boolean$$String(r>0,"require LoosePadding > 0"),System.Diagnostics.Debug.Assert$$Boolean$$String(i+2*r<n,"EdgePadding too big!"),r}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$GeometryGraph$$EdgeRoutingSettings:function(n,t){this.continueOnOverlaps=!0;this.rootShapes=null;this.coneAngle=0;this.tightPadding=0;this.rootWasCreated=!1;this.root=null;this.visGraph=null;this.ancestorSets=null;this.shapesToTightLooseCouples=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.TightLooseCouple.ctor);this.portsToShapes=null;this.portsToEnterableShapes=null;this.portRTree=null;this.portLocationsToLoosePolylines=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);this.looseRoot=null;this.enterableLoose=null;this.enterableTight=null;this.geometryGraph=null;this.multiEdgesSeparation=5;this.routeMultiEdgesAsBundles=!0;this.UseEdgeLengthMultiplier=!1;this.UsePolylineEndShortcutting=!0;this.UseInnerPolylingShortcutting=!0;this.AllowedShootingStraightLines=!0;this._edges=null;this.ReplaceEdgeByRails=null;this._LoosePadding=0;this._BundlingSettings=null;this._OverlapsDetected=!1;this._CacheCornersForSmoothing=!1;this._KeepOriginalSpline=!1;this._ArrowHeadRatio=0;this._LineSweeperPorts=null;this._Bidirectional=!1;Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$Double$$Double$$Double$$BundlingSettings.call(this,n,t.get_Padding(),t.get_PolylinePadding(),t.get_ConeAngle(),t.get_BundlingSettings())},ContinueOnOverlaps$$:"System.Boolean",get_ContinueOnOverlaps:function(){return this.continueOnOverlaps},set_ContinueOnOverlaps:function(n){this.continueOnOverlaps=n},edgeGeometriesEnumeration$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Layout.EdgeGeometry]]",get_edgeGeometriesEnumeration:function(){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,this._edges,$CreateAnonymousDelegate(this,function(n){return n.get_EdgeGeometry()}))},LoosePadding$$:"System.Double",get_LoosePadding:function(){return this._LoosePadding},set_LoosePadding:function(n){this._LoosePadding=n},BundlingSettings$$:"Microsoft.Msagl.Core.Routing.BundlingSettings",get_BundlingSettings:function(){return this._BundlingSettings},set_BundlingSettings:function(n){this._BundlingSettings=n},MultiEdgesSeparation$$:"System.Double",get_MultiEdgesSeparation:function(){return this.multiEdgesSeparation},set_MultiEdgesSeparation:function(n){this.multiEdgesSeparation=n},ctor$$GeometryGraph$$Double$$Double$$Double:function(n,t,i,r){this.continueOnOverlaps=!0;this.rootShapes=null;this.coneAngle=0;this.tightPadding=0;this.rootWasCreated=!1;this.root=null;this.visGraph=null;this.ancestorSets=null;this.shapesToTightLooseCouples=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.TightLooseCouple.ctor);this.portsToShapes=null;this.portsToEnterableShapes=null;this.portRTree=null;this.portLocationsToLoosePolylines=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);this.looseRoot=null;this.enterableLoose=null;this.enterableTight=null;this.geometryGraph=null;this.multiEdgesSeparation=5;this.routeMultiEdgesAsBundles=!0;this.UseEdgeLengthMultiplier=!1;this.UsePolylineEndShortcutting=!0;this.UseInnerPolylingShortcutting=!0;this.AllowedShootingStraightLines=!0;this._edges=null;this.ReplaceEdgeByRails=null;this._LoosePadding=0;this._BundlingSettings=null;this._OverlapsDetected=!1;this._CacheCornersForSmoothing=!1;this._KeepOriginalSpline=!1;this._ArrowHeadRatio=0;this._LineSweeperPorts=null;this._Bidirectional=!1;Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$IEnumerable$1$Edge$$Double$$Double$$Double$$BundlingSettings.call(this,n,n.get_Edges(),t,i,r,null)},ctor$$GeometryGraph$$Double$$Double$$Double$$BundlingSettings:function(n,t,i,r,u){this.continueOnOverlaps=!0;this.rootShapes=null;this.coneAngle=0;this.tightPadding=0;this.rootWasCreated=!1;this.root=null;this.visGraph=null;this.ancestorSets=null;this.shapesToTightLooseCouples=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.TightLooseCouple.ctor);this.portsToShapes=null;this.portsToEnterableShapes=null;this.portRTree=null;this.portLocationsToLoosePolylines=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);this.looseRoot=null;this.enterableLoose=null;this.enterableTight=null;this.geometryGraph=null;this.multiEdgesSeparation=5;this.routeMultiEdgesAsBundles=!0;this.UseEdgeLengthMultiplier=!1;this.UsePolylineEndShortcutting=!0;this.UseInnerPolylingShortcutting=!0;this.AllowedShootingStraightLines=!0;this._edges=null;this.ReplaceEdgeByRails=null;this._LoosePadding=0;this._BundlingSettings=null;this._OverlapsDetected=!1;this._CacheCornersForSmoothing=!1;this._KeepOriginalSpline=!1;this._ArrowHeadRatio=0;this._LineSweeperPorts=null;this._Bidirectional=!1;Microsoft.Msagl.Routing.SplineRouter.ctor$$GeometryGraph$$IEnumerable$1$Edge$$Double$$Double$$Double$$BundlingSettings.call(this,n,n.get_Edges(),t,i,r,u)},ctor$$GeometryGraph$$IEnumerable$1$Edge$$Double$$Double$$Double$$BundlingSettings:function(n,t,i,r,u,f){this.continueOnOverlaps=!0;this.rootShapes=null;this.coneAngle=0;this.tightPadding=0;this.rootWasCreated=!1;this.root=null;this.visGraph=null;this.ancestorSets=null;this.shapesToTightLooseCouples=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.TightLooseCouple.ctor);this.portsToShapes=null;this.portsToEnterableShapes=null;this.portRTree=null;this.portLocationsToLoosePolylines=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);this.looseRoot=null;this.enterableLoose=null;this.enterableTight=null;this.geometryGraph=null;this.multiEdgesSeparation=5;this.routeMultiEdgesAsBundles=!0;this.UseEdgeLengthMultiplier=!1;this.UsePolylineEndShortcutting=!0;this.UseInnerPolylingShortcutting=!0;this.AllowedShootingStraightLines=!0;this._edges=null;this.ReplaceEdgeByRails=null;this._LoosePadding=0;this._BundlingSettings=null;this._OverlapsDetected=!1;this._CacheCornersForSmoothing=!1;this._KeepOriginalSpline=!1;this._ArrowHeadRatio=0;this._LineSweeperPorts=null;this._Bidirectional=!1;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"graph");Microsoft.Msagl.Core.ValidateArg.IsPositive(i,"tightPadding");Microsoft.Msagl.Core.ValidateArg.IsPositive(r,"loosePadding");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"edges");this._edges=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Layout.Edge.ctor,t);this.set_BundlingSettings(f);this.geometryGraph=n;this.set_LoosePadding(r);this.tightPadding=i;var e=Microsoft.Msagl.Routing.ShapeCreator.GetShapes(this.geometryGraph);this.Initialize(e,u)},ctor$$GeometryGraph$$Double$$Double$$Double$$List$1$Edge$$List$1$Edge:function(n,t,i,r,u,f){this.continueOnOverlaps=!0;this.rootShapes=null;this.coneAngle=0;this.tightPadding=0;this.rootWasCreated=!1;this.root=null;this.visGraph=null;this.ancestorSets=null;this.shapesToTightLooseCouples=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.TightLooseCouple.ctor);this.portsToShapes=null;this.portsToEnterableShapes=null;this.portRTree=null;this.portLocationsToLoosePolylines=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);this.looseRoot=null;this.enterableLoose=null;this.enterableTight=null;this.geometryGraph=null;this.multiEdgesSeparation=5;this.routeMultiEdgesAsBundles=!0;this.UseEdgeLengthMultiplier=!1;this.UsePolylineEndShortcutting=!0;this.UseInnerPolylingShortcutting=!0;this.AllowedShootingStraightLines=!0;this._edges=null;this.ReplaceEdgeByRails=null;this._LoosePadding=0;this._BundlingSettings=null;this._OverlapsDetected=!1;this._CacheCornersForSmoothing=!1;this._KeepOriginalSpline=!1;this._ArrowHeadRatio=0;this._LineSweeperPorts=null;this._Bidirectional=!1;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.geometryGraph=n;this.set_LoosePadding(i);this.tightPadding=t;var e=Microsoft.Msagl.Routing.ShapeCreatorForRoutingToParents.GetShapes(u,f);this.Initialize(e,r)},Initialize:function(n,t){this.rootShapes=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Routing.Shape.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,n,$CreateAnonymousDelegate(this,function(n){return n.get_Parents()==null||!System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,n.get_Parents())})));this.coneAngle=t;this.coneAngle==0&&(this.coneAngle=.523598775598299)},RunInternal:function(){System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,this.get_edgeGeometriesEnumeration())&&(this.GetOrCreateRoot(),this.RouteOnRoot(),this.RemoveRoot())},RouteOnRoot:function(){(this.CalculatePortsToShapes(),this.CalculatePortsToEnterableShapes(),this.CalculateShapeToBoundaries(this.root),!this.get_OverlapsDetected()||this.get_ContinueOnOverlaps())&&(this.BindLooseShapes(),this.SetLoosePolylinesForAnywherePorts(),this.CalculateVisibilityGraph(),this.RouteOnVisGraph())},CalculatePortsToEnterableShapes:function(){var i,u,f,e,n,c;for(this.portsToEnterableShapes=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Port.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor),i=this.portsToShapes.GetEnumerator();i.MoveNext();){var o=i.get_Current(),n=o.get_Key(),s=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Shape.ctor);Microsoft.Msagl.Routing.SplineRouter.EdgesAttachedToPortAvoidTheNode(n)||s.Insert(o.get_Value());this.portsToEnterableShapes.set_Item$$TKey(n,s)}for(var t=0,r=this.rootShapes,l=r.length,h=r[t];t<l;t++,h=r[t])for(u=h.get_Descendants().GetEnumerator();u.MoveNext();)for(f=u.get_Current(),e=f.get_Ports().GetEnumerator();e.MoveNext();)n=e.get_Current(),c=this.portsToEnterableShapes.get_Item$$TKey(n),c.InsertRange(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,f.get_Ancestors(),$CreateAnonymousDelegate(this,function(n){return n.get_BoundaryCurve()!=null})))},SetLoosePolylinesForAnywherePorts:function(){for(var u=this.shapesToTightLooseCouples.GetEnumerator(),t,i,r;u.MoveNext();)for(var n=u.get_Current(),e=n.get_Key(),f=e.get_Ports().GetEnumerator();f.MoveNext();)t=f.get_Current(),i=As(t,Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor),i!=null&&i.set_LoosePolyline(Cast(n.get_Value().get_LooseShape().get_BoundaryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)),r=As(t,Microsoft.Msagl.Routing.ClusterBoundaryPort.ctor),r!=null&&r.set_LoosePolyline(Cast(n.get_Value().get_LooseShape().get_BoundaryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor))},BindLooseShapes:function(){var n,t,i;for(this.looseRoot=new Microsoft.Msagl.Routing.Shape.ctor,n=this.root.get_Children().GetEnumerator();n.MoveNext();)t=n.get_Current(),i=this.shapesToTightLooseCouples.get_Item$$TKey(t).get_LooseShape(),this.BindLooseShapesUnderShape(t),this.looseRoot.AddChild(i)},BindLooseShapesUnderShape:function(n){for(var u=this.shapesToTightLooseCouples.get_Item$$TKey(n).get_LooseShape(),i=n.get_Children().GetEnumerator(),t,r;i.MoveNext();)t=i.get_Current(),r=this.shapesToTightLooseCouples.get_Item$$TKey(t).get_LooseShape(),u.AddChild(r),this.BindLooseShapesUnderShape(t)},CalculateShapeToBoundaries:function(n){var t,r,i;if(this.ProgressStep(),System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,n.get_Children())){for(t=n.get_Children().GetEnumerator();t.MoveNext();)r=t.get_Current(),this.CalculateShapeToBoundaries(r);i=new Microsoft.Msagl.Routing.ShapeObstacleCalculator.ctor(n,this.tightPadding,this.get_AdjustedLoosePadding(),this.shapesToTightLooseCouples);i.Calculate();this.set_OverlapsDetected(this.get_OverlapsDetected()|i.get_OverlapsDetected())}},OverlapsDetected$$:"System.Boolean",get_OverlapsDetected:function(){return this._OverlapsDetected},set_OverlapsDetected:function(n){this._OverlapsDetected=n},AdjustedLoosePadding$$:"System.Double",get_AdjustedLoosePadding:function(){return this.get_BundlingSettings()==null?this.get_LoosePadding():this.get_LoosePadding()*1.1},RouteOnVisGraph:function(){var n;if(this.ancestorSets=Microsoft.Msagl.Routing.SplineRouter.GetAncestorSetsMap(this.root.get_Descendants()),this.get_BundlingSettings()==null)for(n=System.Linq.Enumerable.GroupBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Edge.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor,this._edges,$CreateDelegate(this,this.EdgePassport)).GetEnumerator();n.MoveNext();){var t=n.get_Current(),r=t.get_Key(),i=this.GetObstaclesFromPassport(r),u=this.CreateInteractiveEdgeRouter(i);this.RouteEdgesWithTheSamePassport(t,u,i)}else this.RouteBundles()},RouteEdgesWithTheSamePassport:function(n,t,i){var u,r,f,o,e,s;if(this.get_RouteMultiEdgesAsBundles()){for(function(){var t={Value:u},i={Value:r},f=this.SplitOnRegularAndMultiedges(n,t,i);return u=t.Value,r=i.Value,f}.call(this),f=u.GetEnumerator();f.MoveNext();)o=f.get_Current(),this.RouteEdge(t,o);r!=null&&(this.ScaleDownLooseHierarchy(t,i),this.RouteMultiEdges(r,t,n.get_Key()))}else for(e=n.GetEnumerator();e.MoveNext();)s=e.get_Current(),this.RouteEdge(t,s)},RouteMultiEdgesAsBundles$$:"System.Boolean",get_RouteMultiEdgesAsBundles:function(){return this.routeMultiEdgesAsBundles},set_RouteMultiEdgesAsBundles:function(n){this.routeMultiEdgesAsBundles=n},RouteEdge:function(n,t){var i=this.MakeTransparentShapesOfEdgeGeometryAndGetTheShapes(t.get_EdgeGeometry());this.ProgressStep();this.RouteEdgeGeometry(t,n);Microsoft.Msagl.Routing.SplineRouter.SetTransparency(i,!1)},ScaleDownLooseHierarchy:function(n,t){for(var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),u=t.GetEnumerator(),f,r;u.MoveNext();)f=u.get_Current(),r=this.shapesToTightLooseCouples.get_Item$$TKey(f),i.Add(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.LoosePolylineWithFewCorners(r.get_TightPolyline(),r.get_Distance()/1.1));n.set_LooseHierarchy(Microsoft.Msagl.Routing.SplineRouter.CreateLooseObstacleHierarachy(i));n.ClearActivePolygons();n.AddActivePolygons(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Routing.Visibility.Polygon.ctor,i,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(n)})))},RouteMultiEdges:function(n,t,i){var r=new Microsoft.Msagl.Routing.MultiEdgeRouter.ctor(n,t,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.Shape.ctor,i,$CreateAnonymousDelegate(this,function(n){return n.get_Children()})),$CreateAnonymousDelegate(this,function(n){return n.get_BoundaryCurve()})),function(){var n=new Microsoft.Msagl.Core.Routing.BundlingSettings.ctor;return n.set_InkImportance(1e-5),n.set_EdgeSeparation(this.get_MultiEdgesSeparation()),n}.call(this),$CreateDelegate(this,this.MakeTransparentShapesOfEdgeGeometryAndGetTheShapes));r.Run()},SplitOnRegularAndMultiedges:function(n,t,i){var f,e,r,o,u;for(t.Value=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Layout.Edge.ctor),f=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.PointPair.ctor,System.Collections.Generic.List$1.ctor),e=n.GetEnumerator();e.MoveNext();)r=e.get_Current(),Microsoft.Msagl.Routing.SplineRouter.IsEdgeToParent(r.get_EdgeGeometry())?t.Value.Add(r):Microsoft.Msagl.Routing.SplineRouter.RegisterInPortLocationsToEdges(r,f);for(i.Value=null,o=f.get_Values().GetEnumerator();o.MoveNext();)u=o.get_Current(),u.get_Count()==1||this.get_OverlapsDetected()?t.Value.AddRange(u):(i.Value==null&&(i.Value=new System.Collections.Generic.List$1.ctor(Array)),i.Value.Add(u.ToArray()))},CreateInteractiveEdgeRouter:function(n){var t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,$CreateAnonymousDelegate(this,function(n){return As(this.shapesToTightLooseCouples.get_Item$$TKey(n).get_LooseShape().get_BoundaryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)}))),i=function(){var i=new Microsoft.Msagl.Routing.InteractiveEdgeRouter.ctor;return i.set_VisibilityGraph(this.visGraph),i.set_TightHierarchy(this.CreateTightObstacleHierarachy(n)),i.set_LooseHierarchy(Microsoft.Msagl.Routing.SplineRouter.CreateLooseObstacleHierarachy(t)),i.set_UseSpanner(!0),i.set_LookForRoundedVertices(!0),i.set_TightPadding(this.tightPadding),i.set_LoosePadding(this.get_LoosePadding()),i.UseEdgeLengthMultiplier=this.UseEdgeLengthMultiplier,i.UsePolylineEndShortcutting=this.UsePolylineEndShortcutting,i.UseInnerPolylingShortcutting=this.UseInnerPolylingShortcutting,i.AllowedShootingStraightLines=this.AllowedShootingStraightLines,i.set_CacheCorners(this.get_CacheCornersForSmoothing()),i}.call(this);return i.AddActivePolygons(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Routing.Visibility.Polygon.ctor,t,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(n)}))),i},CacheCornersForSmoothing$$:"System.Boolean",get_CacheCornersForSmoothing:function(){return this._CacheCornersForSmoothing},set_CacheCornersForSmoothing:function(n){this._CacheCornersForSmoothing=n},GetObstaclesFromPassport:function(n){var l,a,u,t,f,e;if(n.get_Count()==0)return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,this.root.get_Children());for(var o=this.GetCommonAncestorsAbovePassport(n),s=this.GetAllAncestors(n),r=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Routing.Shape.ctor,n,$CreateAnonymousDelegate(this,function(n){return System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,n.get_Children(),$CreateAnonymousDelegate(this,function(n){return!s.Contains$$T(n)}))}))),h=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Routing.Shape.ctor,n,r)),i=new System.Collections.Generic.Queue$1.ctor(Microsoft.Msagl.Routing.Shape.ctor),c=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,n,$CreateAnonymousDelegate(this,function(n){return!o.Contains$$T(n)})).GetEnumerator();c.MoveNext();)l=c.get_Current(),i.Enqueue(l);while(i.get_Count()>0)for(a=i.Dequeue(),u=a.get_Parents().GetEnumerator();u.MoveNext();){for(t=u.get_Current(),f=t.get_Children().GetEnumerator();f.MoveNext();)e=f.get_Current(),s.Contains$$T(e)||r.Insert(e);o.Contains$$T(t)||h.Contains$$T(t)||(i.Enqueue(t),h.Insert(t))}return r},GetAllAncestors:function(n){var t,i,r;if(!System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,n))return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Shape.ctor);for(t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,n),i=n.GetEnumerator();i.MoveNext();)r=i.get_Current(),t=Microsoft.Msagl.Core.DataStructures.Set$1.op_Addition(t,this.ancestorSets.get_Item$$TKey(r));return t},GetCommonAncestorsAbovePassport:function(n){var t,i,r;if(!System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,n))return new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Shape.ctor);for(t=this.ancestorSets.get_Item$$TKey(System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,n)),i=System.Linq.Enumerable.Skip$1(Microsoft.Msagl.Routing.Shape.ctor,n,1).GetEnumerator();i.MoveNext();)r=i.get_Current(),t=Microsoft.Msagl.Core.DataStructures.Set$1.op_Multiply(t,this.ancestorSets.get_Item$$TKey(r));return t},RouteBundles:function(){this.ScaleLooseShapesDown();this.CalculateEdgeEnterablePolylines();var n=this.GetLooseHierarchy(),t=Microsoft.Msagl.Routing.Spline.Bundling.BundleRouter.CreateConstrainedDelaunayTriangulation(n),i=new Microsoft.Msagl.Routing.Spline.Bundling.SdShortestPath.ctor($CreateDelegate(this,this.MakeTransparentShapesOfEdgeGeometryAndGetTheShapes),t,this.FindCdtGates(t)),r=new Microsoft.Msagl.Routing.Spline.Bundling.BundleRouter.ctor(this.geometryGraph,i,this.visGraph,this.get_BundlingSettings(),this.get_LoosePadding(),this.GetTightHierarchy(),n,this.enterableLoose,this.enterableTight,$CreateAnonymousDelegate(this,function(n){return this.LoosePolyOfOriginalShape(this.portsToShapes.get_Item$$TKey(n))}));r.Run()},CreateTheMapToParentLooseShapes:function(n,t){for(var i=n.get_Children().GetEnumerator();i.MoveNext();){var r=i.get_Current(),u=this.shapesToTightLooseCouples.get_Item$$TKey(r),f=u.get_LooseShape().get_BoundaryCurve();t.set_Item$$TKey(f,n);this.CreateTheMapToParentLooseShapes(r,t)}},FindCdtGates:function(n){var i=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,Microsoft.Msagl.Routing.Shape.ctor),r,u,f,e,t,o,s,h,c;for(this.CreateTheMapToParentLooseShapes(this.root,i),r=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.CdtEdge.ctor),u=n.PointsToSites.get_Values().GetEnumerator();u.MoveNext();)for(f=u.get_Current(),e=f.Edges.GetEnumerator();e.MoveNext();)(t=e.get_Current(),t.get_CwTriangle()!=null||t.get_CcwTriangle()!=null)&&(o=Cast(f.get_Owner(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),s=Cast(t.lowerSite.get_Owner(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),o!=s)&&function(){var n={Value:h},t=i.TryGetValue(o,n);return h=n.Value,t}.call(this)&&function(){var n={Value:c},t=i.TryGetValue(s,n);return c=n.Value,t}.call(this)&&h==c&&r.Insert(t);return r},CalculateEdgeEnterablePolylines:function(){var t,n,i,r;for(this.enterableLoose=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor),this.enterableTight=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.EdgeGeometry.ctor,Microsoft.Msagl.Core.DataStructures.Set$1.ctor),t=this.get_edgeGeometriesEnumeration().GetEnumerator();t.MoveNext();)n=t.get_Current(),function(){var t={Value:i},u={Value:r},f=this.GetEdgeEnterablePolylines(n,t,u);return i=t.Value,r=u.Value,f}.call(this),this.enterableLoose.set_Item$$TKey(n,i),this.enterableTight.set_Item$$TKey(n,r)},GetEdgeEnterablePolylines:function(n,t,i){t.Value=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);i.Value=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor);var r=this.portsToShapes.get_Item$$TKey(n.get_SourcePort()),u=this.portsToShapes.get_Item$$TKey(n.get_TargetPort());r!=this.root&&(t.Value.InsertRange(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.ancestorSets.get_Item$$TKey(r),$CreateDelegate(this,this.LoosePolyOfOriginalShape)),$CreateAnonymousDelegate(this,function(n){return n!=null}))),i.Value.InsertRange(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.ancestorSets.get_Item$$TKey(r),$CreateDelegate(this,this.TightPolyOfOriginalShape)),$CreateAnonymousDelegate(this,function(n){return n!=null}))));u!=this.root&&(t.Value.InsertRange(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.ancestorSets.get_Item$$TKey(u),$CreateDelegate(this,this.LoosePolyOfOriginalShape)),$CreateAnonymousDelegate(this,function(n){return n!=null}))),i.Value.InsertRange(System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.ancestorSets.get_Item$$TKey(u),$CreateDelegate(this,this.TightPolyOfOriginalShape)),$CreateAnonymousDelegate(this,function(n){return n!=null}))))},GetTightHierarchy:function(){return Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.TightLooseCouple.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,this.shapesToTightLooseCouples.get_Values(),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n.get_TightPolyline(),n.get_TightPolyline().get_BoundingBox())})))},GetLooseHierarchy:function(){var n=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.TightLooseCouple.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,this.shapesToTightLooseCouples.get_Values(),$CreateAnonymousDelegate(this,function(n){return Cast(n.get_LooseShape().get_BoundaryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)})));return Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,n,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,n.get_BoundingBox())})))},ScaleLooseShapesDown:function(){for(var t=this.shapesToTightLooseCouples.GetEnumerator(),i,n;t.MoveNext();)i=t.get_Current(),n=i.get_Value(),n.get_LooseShape().set_BoundaryCurve(Microsoft.Msagl.Routing.InteractiveObstacleCalculator.LoosePolylineWithFewCorners(n.get_TightPolyline(),n.get_Distance()/1.1))},EdgePassport:function(n){var u=n.get_EdgeGeometry(),t=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Routing.Shape.ctor),i=this.portsToShapes.get_Item$$TKey(u.get_SourcePort()),r=this.portsToShapes.get_Item$$TKey(u.get_TargetPort());return this.IsAncestor(i,r)?(t.InsertRange(r.get_Parents()),t.Insert(i),t):this.IsAncestor(r,i)?(t.InsertRange(i.get_Parents()),t.Insert(r),t):(i!=this.looseRoot&&t.InsertRange(i.get_Parents()),r!=this.looseRoot&&t.InsertRange(r.get_Parents()),t)},AllPorts:function(){for(var n=[],i=this.get_edgeGeometriesEnumeration().GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),n.push(t.get_SourcePort()),n.push(t.get_TargetPort());return n},CalculatePortsToShapes:function(){var t,i,r,u,n;for(this.portsToShapes=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Port.ctor,Microsoft.Msagl.Routing.Shape.ctor),t=this.root.get_Descendants().GetEnumerator();t.MoveNext();)for(i=t.get_Current(),r=i.get_Ports().GetEnumerator();r.MoveNext();)n=r.get_Current(),this.portsToShapes.set_Item$$TKey(n,i);for(u=System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Port.ctor,this.AllPorts(),$CreateAnonymousDelegate(this,function(n){return!this.portsToShapes.ContainsKey(n)})).GetEnumerator();u.MoveNext();)n=u.get_Current(),this.root.get_Ports().Insert(n),this.portsToShapes.set_Item$$TKey(n,this.root)},RouteEdgeGeometry:function(n,t){var i=n.get_EdgeGeometry(),u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor),r,f,e;if(Is(i.get_SourcePort(),Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor)||u.AddRange(this.AddVisibilityEdgesFromPort(i.get_SourcePort())),Is(i.get_TargetPort(),Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor)||u.AddRange(this.AddVisibilityEdgesFromPort(i.get_TargetPort())),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(i.get_SourcePort().get_Location(),i.get_TargetPort().get_Location())?i.set_Curve(function(){var n={Value:r},t=Microsoft.Msagl.Core.Layout.Edge.RouteSelfEdge(i.get_SourcePort().get_Curve(),System.Math.Max$$Double$$Double(this.get_LoosePadding()*2,i.GetMaxArrowheadLength()),n);return r=n.Value,t}.call(this)):i.set_Curve(function(){var n={Value:r},u=t.RouteSplineFromPortToPortWhenTheWholeGraphIsReady(i.get_SourcePort(),i.get_TargetPort(),!0,n);return r=n.Value,u}.call(this)),i.set_SmoothedPolyline(r),i.get_Curve()==null)throw $CreateException(new System.NotImplementedException.ctor,new Error);for(f=u.GetEnumerator();f.MoveNext();)e=f.get_Current(),Microsoft.Msagl.Routing.Visibility.VisibilityGraph.RemoveEdge$$VisibilityEdge(e);Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(i,i.get_SourcePort().get_Curve(),i.get_TargetPort().get_Curve(),i.get_Curve(),!1,this.get_KeepOriginalSpline());this.ReplaceEdgeByRails!=null&&this.ReplaceEdgeByRails(n)},KeepOriginalSpline$$:"System.Boolean",get_KeepOriginalSpline:function(){return this._KeepOriginalSpline},set_KeepOriginalSpline:function(n){this._KeepOriginalSpline=n},ArrowHeadRatio$$:"System.Double",get_ArrowHeadRatio:function(){return this._ArrowHeadRatio},set_ArrowHeadRatio:function(n){this._ArrowHeadRatio=n},LineSweeperPorts$$:"Microsoft.Msagl.Core.Geometry.Point[]",get_LineSweeperPorts:function(){return this._LineSweeperPorts},set_LineSweeperPorts:function(n){this._LineSweeperPorts=n},AddVisibilityEdgesFromPort:function(n){var t,i,r;return Is(n,Microsoft.Msagl.Core.Layout.CurvePort.ctor)||!function(){var i={Value:t},r=this.portsToShapes.TryGetValue(n,i);return t=i.Value,r}.call(this)||!function(){var n={Value:i},r=this.shapesToTightLooseCouples.TryGetValue(t,n);return i=n.Value,r}.call(this)?new Array(0):(r=i.get_LooseShape(),System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,As(r.get_BoundaryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),$CreateAnonymousDelegate(this,function(t){return this.visGraph.FindEdge$$Point$$Point(n.get_Location(),t)==null})),$CreateAnonymousDelegate(this,function(t){return this.visGraph.AddEdge$$Point$$Point(n.get_Location(),t)})))},MakeTransparentShapesOfEdgeGeometryAndGetTheShapes:function(n){for(var f,e,o=this.portsToShapes.get_Item$$TKey(n.get_SourcePort()),s=this.portsToShapes.get_Item$$TKey(n.get_TargetPort()),i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Shape.ctor),r=0,u=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Routing.Shape.ctor,this.GetTransparentShapes(n.get_SourcePort(),n.get_TargetPort(),o,s)),h=u.length,t=u[r];r<h;r++,t=u[r])t!=null&&i.Add(this.LooseShapeOfOriginalShape(t));for(f=this.portsToEnterableShapes.get_Item$$TKey(n.get_SourcePort()).GetEnumerator();f.MoveNext();)t=f.get_Current(),i.Add(this.LooseShapeOfOriginalShape(t));for(e=this.portsToEnterableShapes.get_Item$$TKey(n.get_TargetPort()).GetEnumerator();e.MoveNext();)t=e.get_Current(),i.Add(this.LooseShapeOfOriginalShape(t));return Microsoft.Msagl.Routing.SplineRouter.SetTransparency(i,!0),i},LooseShapeOfOriginalShape:function(n){return n==this.root?this.looseRoot:this.shapesToTightLooseCouples.get_Item$$TKey(n).get_LooseShape()},LoosePolyOfOriginalShape:function(n){return Cast(this.LooseShapeOfOriginalShape(n).get_BoundaryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)},TightPolyOfOriginalShape:function(n){return n==this.root?null:this.shapesToTightLooseCouples.get_Item$$TKey(n).get_TightPolyline()},GetTransparentShapes:function(n,t,i,r){for(var u=[],s=this.ancestorSets.get_Item$$TKey(i).GetEnumerator(),e,f,o,h;s.MoveNext();)f=s.get_Current(),u.push(f);for(e=this.ancestorSets.get_Item$$TKey(r).GetEnumerator();e.MoveNext();)f=e.get_Current(),u.push(f);return o=Microsoft.Msagl.Routing.SplineRouter.EdgesAttachedToPortAvoidTheNode(n),h=Microsoft.Msagl.Routing.SplineRouter.EdgesAttachedToPortAvoidTheNode(t),o||h?o?this.IsAncestor(i,r)&&u.push(i):this.IsAncestor(r,i)&&u.push(r):(u.push(i),u.push(r)),u},IsAncestor:function(n,t){var i;return t!=null&&function(){var n={Value:i},r=this.ancestorSets.TryGetValue(t,n);return i=n.Value,r}.call(this)&&Microsoft.Msagl.Core.DataStructures.Set$1.op_Inequality(i,null)&&i.Contains$$T(n)},CreateTightObstacleHierarachy:function(n){var t=System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,$CreateAnonymousDelegate(this,function(n){return this.shapesToTightLooseCouples.get_Item$$TKey(n).get_TightPolyline()}));return Microsoft.Msagl.Core.Geometry.RectangleNode$1.CreateRectangleNodeOnEnumeration(System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor,t,$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.Geometry.RectangleNode$1.ctor$$TData$$Rectangle(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,n.get_BoundingBox())})))},CalculateVisibilityGraph:function(){for(var t=this.get_LineSweeperPorts()!=null?new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,this.get_LineSweeperPorts()):new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),i=this.get_edgeGeometriesEnumeration().GetEnumerator(),n;i.MoveNext();)n=i.get_Current(),Is(n.get_SourcePort(),Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor)||Is(n.get_SourcePort(),Microsoft.Msagl.Routing.ClusterBoundaryPort.ctor)||t.Insert(n.get_SourcePort().get_Location()),Is(n.get_TargetPort(),Microsoft.Msagl.Core.Layout.HookUpAnywhereFromInsidePort.ctor)||Is(n.get_TargetPort(),Microsoft.Msagl.Routing.ClusterBoundaryPort.ctor)||t.Insert(n.get_TargetPort().get_Location());this.portRTree=new Microsoft.Msagl.Core.Geometry.RTree$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,System.Collections.Generic.KeyValuePair$2.ctor,t,$CreateAnonymousDelegate(this,function(n){return new System.Collections.Generic.KeyValuePair$2.ctor$$TKey$$TValue(Microsoft.Msagl.Core.Geometry.Rectangle.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor,new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(n),n)})));this.visGraph=new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor;this.FillVisibilityGraphUnderShape(this.root)},FillVisibilityGraphUnderShape:function(n){for(var a=n.get_Children(),e=a.GetEnumerator(),o,f,l;e.MoveNext();)o=e.get_Current(),this.FillVisibilityGraphUnderShape(o);var t,i=function(){var i={Value:t},r=this.shapesToTightLooseCouples.TryGetValue(n,i);return t=i.Value,r}.call(this)?As(t.get_LooseShape().get_BoundaryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor):null,s=t!=null?t.get_LooseShape():this.looseRoot,h=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Shape.ctor,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,s.get_Children(),$CreateAnonymousDelegate(this,function(n){return As(n.get_BoundaryCurve(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)}))),c=this.RemoveInsidePortsAndSplitBoundaryIfNeeded(i),r=new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor,u=new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSpanner.ctor$$IEnumerable$1$Polyline$$VisibilityGraph$$Double$$Set$1$Point$$Polyline(new Array(0),r,this.coneAngle,c,i);for(u.Run(),r=new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor,u=function(){var n=new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSpanner.ctor$$IEnumerable$1$Polyline$$VisibilityGraph$$Double$$Set$1$Point$$Polyline(h,r,this.coneAngle,c,i);return n.set_Bidirectional(this.get_Bidirectional()&&h.get_Count()>0),n}.call(this),u.Run(),this.ProgressStep(),f=r.get_Edges().GetEnumerator();f.MoveNext();)l=f.get_Current(),this.TryToCreateNewEdgeAndSetIsPassable(l,s);this.AddBoundaryEdgesToVisGraph(i)},Bidirectional$$:"System.Boolean",get_Bidirectional:function(){return this._Bidirectional},set_Bidirectional:function(n){this._Bidirectional=n},TryToCreateNewEdgeAndSetIsPassable:function(n,t){var i=this.visGraph.FindEdge$$Point$$Point(n.get_SourcePoint(),n.get_TargetPoint());i==null&&(i=this.visGraph.AddEdge$$Point$$Point(n.get_SourcePoint(),n.get_TargetPoint()),t!=null&&i.set_IsPassable($CreateAnonymousDelegate(this,function(){return t.get_IsTransparent()})))},AddBoundaryEdgesToVisGraph:function(n){var t,i;if(n!=null){t=n.get_StartPoint();do{if(i=t.get_NextOnPolyline(),this.visGraph.AddEdge$$Point$$Point(t.get_Point(),i.get_Point()),i==n.get_StartPoint())break;t=i}while(1)}},RemoveInsidePortsAndSplitBoundaryIfNeeded:function(n){var i=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor),f,t,o,r,e;if(n==null){for(f=this.portRTree.GetAllLeaves().GetEnumerator();f.MoveNext();)t=f.get_Current(),i.Insert(t);return this.portRTree.Clear(),i}o=n.get_BoundingBox();r=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.Geometry.Point.ctor,this.portRTree.GetAllIntersecting(o));for(var u=0,s=r.length,t=r[u];u<s;u++,t=r[u])switch(Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t,n)){case Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside:i.Insert(t);this.portLocationsToLoosePolylines.set_Item$$TKey(t,n);this.portRTree.Remove(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(t),t);break;case Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Boundary:if(this.portRTree.Remove(new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(t),t),this.portLocationsToLoosePolylines.set_Item$$TKey(t,n),e=Microsoft.Msagl.Routing.SplineRouter.FindPointOnPolylineToInsertAfter(n,t),e!=null)Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.InsertPointIntoPolylineAfter(n,e,t);else throw $CreateException(new System.InvalidOperationException.ctor,new Error);}return i},GetOrCreateRoot:function(){var t;if(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,this.rootShapes)!=0){if(System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,this.rootShapes)==1&&(t=System.Linq.Enumerable.First$1$$IEnumerable$1(Microsoft.Msagl.Routing.Shape.ctor,this.rootShapes),t.get_BoundaryCurve()==null)){this.root=t;return}this.rootWasCreated=!0;this.root=new Microsoft.Msagl.Routing.Shape.ctor;for(var n=0,i=this.rootShapes,u=i.length,r=i[n];n<u;n++,r=i[n])this.root.AddChild(r)}},RemoveRoot:function(){if(this.rootWasCreated)for(var n=0,t=this.rootShapes,r=t.length,i=t[n];n<r;n++,i=t[n])i.RemoveParent(this.root)}}};JsTypes.push(Microsoft$Msagl$Routing$SplineRouter);Microsoft$Msagl$Routing$SingleSourceSingleTargetShortestPathOnVisibilityGraph={fullname:"Microsoft.Msagl.Routing.SingleSourceSingleTargetShortestPathOnVisibilityGraph",baseTypeName:"System.Object",staticDefinition:{IsForbidden:function(n){return n.get_IsPassable()!=null&&!n.get_IsPassable()()||Is(n,Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$VisibilityGraph$$VisibilityVertex$$VisibilityVertex$$Tiling:function(n,t,i,r){this._g=null;this._source=null;this._target=null;this._visGraph=null;this._lengthMultiplier=1;this._lengthMultiplierForAStar=1;System.Object.ctor.call(this);this._visGraph=n;this._source=t;this._target=i;this._source.set_Distance(0);this._g=r},LengthMultiplier$$:"System.Double",get_LengthMultiplier:function(){return this._lengthMultiplier},set_LengthMultiplier:function(n){this._lengthMultiplier=n},LengthMultiplierForAStar$$:"System.Double",get_LengthMultiplierForAStar:function(){return this._lengthMultiplierForAStar},set_LengthMultiplierForAStar:function(n){this._lengthMultiplierForAStar=n},ctor$$VisibilityGraph$$VisibilityVertex$$VisibilityVertex:function(n,t,i){this._g=null;this._source=null;this._target=null;this._visGraph=null;this._lengthMultiplier=1;this._lengthMultiplierForAStar=1;System.Object.ctor.call(this);this._visGraph=n;this._source=t;this._target=i;this._source.set_Distance(0)},GetPath:function(n){var r=new Microsoft.Msagl.Core.DataStructures.GenericBinaryHeapPriorityQueue$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor),f,i,e,o,t,u;for(this._source.set_Distance(0),this._target.set_Distance(Infinity),r.Enqueue(this._source,this.H(this._source));!r.IsEmpty();){if(i=function(){var n={Value:f},t=r.Dequeue$$Double(n);return f=n.Value,t}.call(this),f>=this._target.get_Distance())break;for(e=i.get_OutEdges().GetEnumerator();e.MoveNext();)t=e.get_Current(),this.PassableOutEdge(t)&&(u=t.get_Target(),i!=this._source&&i.isReal?this.ProcessNeighbor$$GenericBinaryHeapPriorityQueue$1$VisibilityVertex$$VisibilityVertex$$VisibilityEdge$$VisibilityVertex$$Int32(r,i,t,u,1e3):this.ProcessNeighbor$$GenericBinaryHeapPriorityQueue$1$VisibilityVertex$$VisibilityVertex$$VisibilityEdge$$VisibilityVertex(r,i,t,u));for(o=i.get_InEdges().GetEnumerator();o.MoveNext();)t=o.get_Current(),this.PassableInEdge(t)&&(u=t.get_Source(),this.ProcessNeighbor$$GenericBinaryHeapPriorityQueue$1$VisibilityVertex$$VisibilityVertex$$VisibilityEdge$$VisibilityVertex(r,i,t,u))}return this._visGraph.PreviosVertex(this._target)==null?null:this.CalculatePath(n)},AssertEdgesPassable:function(n){for(var i=n.GetEnumerator(),t;i.MoveNext();)t=i.get_Current(),System.Diagnostics.Debug.Assert$$Boolean(this.PassableOutEdge(t)||this.PassableInEdge(t))},PassableOutEdge:function(n){return n.get_Source()==this._source||n.get_Target()==this._target||!Microsoft.Msagl.Routing.SingleSourceSingleTargetShortestPathOnVisibilityGraph.IsForbidden(n)},PassableInEdge:function(n){return n.get_Source()==this._target||n.get_Target()==this._source||!Microsoft.Msagl.Routing.SingleSourceSingleTargetShortestPathOnVisibilityGraph.IsForbidden(n)},ProcessNeighbor$$GenericBinaryHeapPriorityQueue$1$VisibilityVertex$$VisibilityVertex$$VisibilityEdge$$VisibilityVertex$$Int32:function(n,t,i,r,u){var e=i.get_Length()+u,f=t.get_Distance()+e,o;r!=this._source&&this._visGraph.PreviosVertex(r)==null?(r.set_Distance(f),this._visGraph.SetPreviousEdge(r,i),r!=this._target&&n.Enqueue(r,this.H(r))):r!=this._source&&f<r.get_Distance()&&(o=this._visGraph.PreviosVertex(r),r.set_Distance(f),this._visGraph.SetPreviousEdge(r,i),r!=this._target&&n.DecreasePriority(r,this.H(r)))},ProcessNeighbor$$GenericBinaryHeapPriorityQueue$1$VisibilityVertex$$VisibilityVertex$$VisibilityEdge$$VisibilityVertex:function(n,t,i,r){var f=i.get_Length(),u=t.get_Distance()+f,e;r!=this._source&&this._visGraph.PreviosVertex(r)==null?(r.set_Distance(u),this._visGraph.SetPreviousEdge(r,i),r!=this._target&&n.Enqueue(r,this.H(r))):r!=this._source&&u<r.get_Distance()&&(e=this._visGraph.PreviosVertex(r),r.set_Distance(u),this._visGraph.SetPreviousEdge(r,i),r!=this._target&&n.DecreasePriority(r,this.H(r)))},H:function(n){return n.get_Distance()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Point,this._target.Point).get_Length()*this.get_LengthMultiplierForAStar()},CalculatePath:function(n){var u=[],i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor),t=this._target,r;do i.Add(t),n&&this._visGraph.ShrinkLengthOfPrevEdge(t,this.get_LengthMultiplier()),t=this._visGraph.PreviosVertex(t);while(t!=this._source);for(i.Add(this._source),r=i.get_Count()-1;r>=0;r--)u.push(i.get_Item$$Int32(r));return u}}};JsTypes.push(Microsoft$Msagl$Routing$SingleSourceSingleTargetShortestPathOnVisibilityGraph);Microsoft$Msagl$Layout$Layered$SmoothedPolylineCalculator={fullname:"Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator",baseTypeName:"System.Object",staticDefinition:{SegIntersectsBound:function(n,t,i){return Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.CurveIntersectsHierarchy(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_Point(),t.get_Point()),i)},CurveIntersectsHierarchy:function(n,t){if(t==null||!Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.Intersect(n.get_ParallelogramNodeOverICurve().get_Parallelogram(),t.get_Parallelogram()))return!1;var i=As(t,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramBinaryTreeNode.ctor);return i!=null?Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.CurveIntersectsHierarchy(n,i.get_LeftSon())||Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.CurveIntersectsHierarchy(n,i.get_RightSon()):Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(n,Cast(t,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.ctor).get_Seg(),!1)!=null},Flat:function(n){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n.get_Previous().get_Point(),n.get_Point(),n.get_Next().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear},BezierSegIntersectsBoundary$$CubicBezierSegment$$ICurve:function(n,t){for(var r=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,t,!1).GetEnumerator(),u,i;r.MoveNext();)if(u=r.get_Current(),i=As(t,Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),i!=null){if(Microsoft.Msagl.Core.Geometry.Curves.Curve.RealCutWithClosedCurve(u,i,!1))return!0}else return!0;return!1}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u,f,e){this.headSite=null;this.edgePath=null;this.anchors=null;this.originalGraph=null;this.rightHierarchy=null;this.leftHierarchy=null;this.thinRightHierarchy=null;this.thinLeftHierarchy=null;this.thinRightNodes=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode.ctor);this.thinLefttNodes=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode.ctor);this.database=null;this.layeredGraph=null;this.layerArrays=null;this.settings=null;System.Object.ctor.call(this);this.database=e;this.edgePath=n;this.anchors=t;this.layerArrays=u;this.originalGraph=i;this.settings=r;this.layeredGraph=f;this.rightHierarchy=this.BuildRightHierarchy();this.leftHierarchy=this.BuildLeftHierarchy()},BuildRightHierarchy:function(){for(var r=this.FindRightBoundaryAnchorCurves(),n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode.ctor),t=r.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.Add(i.get_ParallelogramNodeOverICurve());return this.thinRightHierarchy=Microsoft.Msagl.Layout.Layered.HierarchyCalculator.Calculate$$List$1$ParallelogramNode$$Int32(this.thinRightNodes,this.settings.get_GroupSplit()),Microsoft.Msagl.Layout.Layered.HierarchyCalculator.Calculate$$List$1$ParallelogramNode$$Int32(n,this.settings.get_GroupSplit())},BuildLeftHierarchy:function(){for(var r=this.FindLeftBoundaryAnchorCurves(),n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode.ctor),t=r.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.Add(i.get_ParallelogramNodeOverICurve());return this.thinLeftHierarchy=Microsoft.Msagl.Layout.Layered.HierarchyCalculator.Calculate$$List$1$ParallelogramNode$$Int32(this.thinLefttNodes,this.settings.get_GroupSplit()),Microsoft.Msagl.Layout.Layered.HierarchyCalculator.Calculate$$List$1$ParallelogramNode$$Int32(n,this.settings.get_GroupSplit())},FindRightBoundaryAnchorCurves:function(){for(var i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),r=0,u=this.edgePath.GetEnumerator(),e,t;u.MoveNext();){for(var o=u.get_Current(),n=null,f=this.LeftBoundaryNodesOfANode(o,Microsoft.Msagl.Layout.Layered.Routing.GetNodeKind(r,this.edgePath)).GetEnumerator();f.MoveNext();)e=f.get_Current(),t=this.anchors[e],(n==null||n.get_Origin().get_X()<t.get_Origin().get_X())&&(n=t),i.Add(t.get_PolygonalBoundary());n!=null&&this.thinRightNodes.Add(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Double$$Double(n.get_Origin(),this.originalGraph.get_Left(),n.get_Y()).get_ParallelogramNodeOverICurve());r++}return i},FindLeftBoundaryAnchorCurves:function(){for(var r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),u=0,f=this.edgePath.GetEnumerator(),t,i;f.MoveNext();){for(var o=f.get_Current(),n=-1,e=this.RightBoundaryNodesOfANode(o,Microsoft.Msagl.Layout.Layered.Routing.GetNodeKind(u,this.edgePath)).GetEnumerator();e.MoveNext();)t=e.get_Current(),(n==-1||this.layerArrays.get_X()[t]<this.layerArrays.get_X()[n])&&(n=t),r.Add(this.anchors[t].get_PolygonalBoundary());n!=-1&&(i=this.anchors[n],this.thinLefttNodes.Add(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Double$$Double(i.get_Origin(),this.originalGraph.get_Right(),i.get_Origin().get_Y()).get_ParallelogramNodeOverICurve()));u++}return r},FillRightTopAndBottomVerts:function(n,t,i){var s=[],f=0,e=0,h,o,u,r;for(i==Microsoft.Msagl.Routing.NodeKind.Bottom?e=340282346638529e24:i==Microsoft.Msagl.Routing.NodeKind.Top&&(f=340282346638529e24),h=n[t],o=t+1;o<n.length;o++)u=n[o],r=this.anchors[u],r.get_TopAnchor()>f?this.NodeUCanBeCrossedByNodeV(u,h)||(f=r.get_TopAnchor(),r.get_BottomAnchor()>e&&(e=r.get_BottomAnchor()),s.push(u)):r.get_BottomAnchor()>e&&(this.NodeUCanBeCrossedByNodeV(u,h)||(e=r.get_BottomAnchor(),r.get_TopAnchor()>f&&(f=r.get_TopAnchor()),s.push(u)));return s},FillLeftTopAndBottomVerts:function(n,t,i){var s=[],f=0,e=0,h,o,u,r;for(i==Microsoft.Msagl.Routing.NodeKind.Top?f=340282346638529e24:i==Microsoft.Msagl.Routing.NodeKind.Bottom&&(e=340282346638529e24),h=n[t],o=t-1;o>=0;o--)u=n[o],r=this.anchors[u],r.get_TopAnchor()>f+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?this.NodeUCanBeCrossedByNodeV(u,h)||(f=r.get_TopAnchor(),e=System.Math.Max$$Double$$Double(e,r.get_BottomAnchor()),s.push(u)):r.get_BottomAnchor()>e+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(this.NodeUCanBeCrossedByNodeV(u,h)||(f=System.Math.Max$$Double$$Double(f,r.get_TopAnchor()),e=r.get_BottomAnchor(),s.push(u)));return s},IsVirtualVertex:function(n){return n>=this.originalGraph.get_Nodes().get_Count()},IsLabel:function(n){return this.anchors[n].get_RepresentsLabel()},NodeUCanBeCrossedByNodeV:function(n,t){return this.IsLabel(n)?!1:this.IsLabel(t)?!1:this.IsVirtualVertex(n)&&this.IsVirtualVertex(t)&&this.EdgesIntersectSomewhere(n,t)?!0:!1},EdgesIntersectSomewhere:function(n,t){return this.UVAreMiddlesOfTheSameMultiEdge(n,t)?!1:this.IntersectAbove(n,t)||this.IntersectBelow(n,t)},UVAreMiddlesOfTheSameMultiEdge:function(n,t){return this.database.get_MultipleMiddles().Contains$$T(n)&&this.database.get_MultipleMiddles().Contains$$T(t)&&this.SourceOfTheOriginalEdgeContainingAVirtualNode(n)==this.SourceOfTheOriginalEdgeContainingAVirtualNode(t)?!0:!1},SourceOfTheOriginalEdgeContainingAVirtualNode:function(n){while(this.IsVirtualVertex(n))n=this.IncomingEdge(n).get_Source();return n},IntersectBelow:function(n,t){for(;;){var i=this.OutcomingEdge(n),r=this.OutcomingEdge(t);if(this.Intersect(i,r))return!0;if(n=i.get_Target(),t=r.get_Target(),!(this.IsVirtualVertex(n)&&this.IsVirtualVertex(t)))return t==n?!0:!1}},IntersectAbove:function(n,t){for(;;){var i=this.IncomingEdge(n),r=this.IncomingEdge(t);if(this.Intersect(i,r))return!0;if(n=i.get_Source(),t=r.get_Source(),!(this.IsVirtualVertex(n)&&this.IsVirtualVertex(t)))return n==t?!0:!1}},Intersect:function(n,t){var i=this.layerArrays.get_X()[n.get_Source()]-this.layerArrays.get_X()[t.get_Source()],r=this.layerArrays.get_X()[n.get_Target()]-this.layerArrays.get_X()[t.get_Target()];return i>0&&r<0||i<0&&r>0},IncomingEdge:function(n){return this.layeredGraph.InEdgeOfVirtualNode(n)},OutcomingEdge:function(n){return this.layeredGraph.OutEdgeOfVirtualNode(n)},RightBoundaryNodesOfANode:function(n,t){return this.FillRightTopAndBottomVerts(this.NodeLayer(n),this.layerArrays.get_X()[n],t)},NodeLayer:function(n){return this.layerArrays.get_Layers()[this.layerArrays.Y[n]]},LeftBoundaryNodesOfANode:function(n,t){return this.FillLeftTopAndBottomVerts(this.NodeLayer(n),this.layerArrays.get_X()[n],t)},GetSpline:function(n){return this.CreateRefinedPolyline(n),this.CreateSmoothedPolyline()},GetPolyline$$:"Microsoft.Msagl.Core.Geometry.SmoothedPolyline",get_GetPolyline:function(){return System.Diagnostics.Debug.Assert$$Boolean(this.headSite!=null),new Microsoft.Msagl.Core.Geometry.SmoothedPolyline.ctor(this.headSite)},LineSegIntersectBound:function(n,t){var i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,t);return Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.CurveIntersectsHierarchy(i,this.leftHierarchy)||Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.CurveIntersectsHierarchy(i,this.thinLeftHierarchy)||Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.CurveIntersectsHierarchy(i,this.rightHierarchy)||Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.CurveIntersectsHierarchy(i,this.thinRightHierarchy)},SegIntersectRightBound:function(n,t){return Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.SegIntersectsBound(n,t,this.leftHierarchy)||Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.SegIntersectsBound(n,t,this.thinLeftHierarchy)},SegIntersectLeftBound:function(n,t){return Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.SegIntersectsBound(n,t,this.rightHierarchy)||Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.SegIntersectsBound(n,t,this.thinRightHierarchy)},TryToRemoveInflectionEdge:function(n){var t,r,i;if(n.Value.get_Next().get_Next()==null||n.Value.get_Previous()==null)return!1;if(n.Value.get_Turn()<0){if(!this.SegIntersectRightBound(n.Value,n.Value.get_Next().get_Next())&&!this.SegIntersectLeftBound(n.Value,n.Value.get_Next().get_Next()))return t=n.Value.get_Next().get_Next(),n.Value.set_Next(t),t.set_Previous(n.Value),n.Value=t,!0;if(!this.SegIntersectLeftBound(n.Value.get_Previous(),n.Value.get_Next())&&!this.SegIntersectRightBound(n.Value.get_Previous(),n.Value.get_Next()))return r=n.Value.get_Previous(),i=n.Value.get_Next(),r.set_Next(i),i.set_Previous(r),n.Value=i,!0}else{if(!this.SegIntersectLeftBound(n.Value,n.Value.get_Next().get_Next())&&!this.SegIntersectRightBound(n.Value,n.Value.get_Next().get_Next()))return t=n.Value.get_Next().get_Next(),n.Value.set_Next(t),t.set_Previous(n.Value),n.Value=t,!0;if(!this.SegIntersectRightBound(n.Value.get_Previous(),n.Value.get_Next())&&this.SegIntersectLeftBound(n.Value.get_Previous(),n.Value.get_Next()))return r=n.Value.get_Previous(),i=n.Value.get_Next(),r.set_Next(i),i.set_Previous(r),n.Value=i,!0}return!1},Reverse:function(){for(var n=new Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.ctor(this.edgePath,this.anchors,this.originalGraph,this.settings,this.layerArrays,this.layeredGraph,this.database),t=this.headSite,i=null;t!=null;)n.headSite=t.Clone(),n.headSite.set_Next(i),i!=null&&i.set_Previous(n.headSite),i=n.headSite,t=t.get_Next();return n},CreateRefinedPolyline:function(n){var i,r,t;for(this.CreateInitialListOfSites(),i=this.headSite,t=0;t<this.edgePath.get_Count();t++)r=i.get_Next(),this.RefineBeetweenNeighborLayers(i,this.EdgePathNode(t),this.EdgePathNode(t+1)),i=r;this.TryToRemoveInflections();n&&this.OptimizeShortPath()},RefineBeetweenNeighborLayers:function(n,t,i){Microsoft.Msagl.Layout.Layered.RefinerBetweenTwoLayers.Refine$$Int32$$Int32$$Site$$Anchor$Array$$LayerArrays$$ProperLayeredGraph$$GeometryGraph$$Double(t,i,n,this.anchors,this.layerArrays,this.layeredGraph,this.originalGraph,this.settings.get_LayerSeparation())},CreateInitialListOfSites:function(){for(var t=this.headSite=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Point(this.EdgePathPoint(0)),n=1;n<=this.edgePath.get_Count();n++)t=new Microsoft.Msagl.Core.Geometry.Site.ctor$$Site$$Point(t,this.EdgePathPoint(n))},TailSite$$:"Microsoft.Msagl.Core.Geometry.Site",get_TailSite:function(){for(var n=this.headSite;n.get_Next()!=null;)n=n.get_Next();return n},OptimizeForThreeSites:function(){var u,f,e,c;System.Diagnostics.Debug.Assert$$Boolean(this.edgePath.get_LayerEdges().get_Count()==2);var l=this.EdgePathNode(0),a=this.EdgePathNode(2),i=this.anchors[l],r=this.anchors[a],n=i.get_X(),t=r.get_X();if(!Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n,t)&&function(){var f={Value:n},e={Value:t},o={Value:u},s=this.FindLegalPositions(i,r,f,e,o);return n=f.Value,t=e.Value,u=o.Value,s}.call(this)){var o=(i.get_Y()-r.get_Y())/(i.get_Bottom()-r.get_Top()),s=.5*(n+t),h=u*(n-t)*.5;n=s+o*h*u;t=s-o*h*u;this.headSite.set_Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,i.get_Y()));f=this.headSite.get_Next();e=f.get_Point().get_Y();f.set_Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.MiddlePos(n,t,i,r,e),e));f.get_Next().set_Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,r.get_Y()));c=this.anchors[this.EdgePathNode(1)];c.set_X(f.get_Point().get_X())}},OptimizeForTwoSites:function(){var u;System.Diagnostics.Debug.Assert$$Boolean(this.edgePath.get_LayerEdges().get_Count()==1);var s=this.EdgePathNode(0),h=this.EdgePathNode(1),i=this.anchors[s],r=this.anchors[h],n=i.get_X(),t=r.get_X();if(!Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n,t)&&function(){var f={Value:n},e={Value:t},o={Value:u},s=this.FindPositions(i,r,f,e,o);return n=f.Value,t=e.Value,u=o.Value,s}.call(this)){var f=(i.get_Y()-r.get_Y())/(i.get_Bottom()-r.get_Top()),e=.5*(n+t),o=u*(n-t)*.5;n=e+f*o*u;t=e-f*o*u;this.headSite.set_Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,i.get_Y()));this.headSite.get_Next().set_Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,r.get_Y()))}},FindLegalPositions:function(n,t,i,r,u){if(!this.FindPositions(n,t,i,r,u))return!1;var f=10;do{if(this.PositionsAreLegal(i.Value,r.Value,u.Value,n,t,this.EdgePathNode(1)))return!0;i.Value=(i.Value+n.get_X())/2;r.Value=(r.Value+t.get_X())/2}while(f++<10);return!1},FindPositions:function(n,t,i,r,u){var f,e;if(i.Value<r.Value?(u.Value=1,f=System.Math.Max$$Double$$Double(i.Value,t.get_Left()),e=System.Math.Min$$Double$$Double(n.get_Right(),r.Value)):(u.Value=-1,f=System.Math.Max$$Double$$Double(n.get_Left(),r.Value),e=System.Math.Min$$Double$$Double(t.get_Right(),i.Value)),f<=e)i.Value=r.Value=.5*(f+e);else{if(this.OriginToOriginSegCrossesAnchorSide(n,t))return!1;u.Value==1?(i.Value=n.get_Right(),r.Value=t.get_Left()):(i.Value=n.get_Left(),r.Value=t.get_Right())}return!0},OriginToOriginSegCrossesAnchorSide:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(n.get_Y()>t.get_Y());var i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_Origin(),t.get_Origin());return n.get_X()<t.get_X()&&Microsoft.Msagl.Core.Geometry.Curves.Curve.CurvesIntersect(i,new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_RightBottom(),n.get_RightTop()))||Microsoft.Msagl.Core.Geometry.Curves.Curve.CurvesIntersect(i,new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.get_LeftBottom(),n.get_LeftTop()))||n.get_X()>t.get_X()&&Microsoft.Msagl.Core.Geometry.Curves.Curve.CurvesIntersect(i,new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_LeftBottom(),n.get_LeftTop()))||Microsoft.Msagl.Core.Geometry.Curves.Curve.CurvesIntersect(i,new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.get_RightBottom(),n.get_RightTop()))},OptimizeShortPath:function(){this.edgePath.get_Count()>2||(this.edgePath.get_Count()==2&&this.headSite.get_Next().get_Next()!=null&&this.headSite.get_Next().get_Next().get_Next()==null&&this.anchors[this.EdgePathNode(1)].get_Node()==null?this.OptimizeForThreeSites():this.edgePath.get_Count()==1&&this.OptimizeForTwoSites())},PositionsAreLegal:function(n,t,i,r,u,f){if(!Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n,t)&&(n-t)*i>0)return!1;var e=this.anchors[f],o=this.MiddlePos(n,t,r,u,e.get_Y());return this.MiddleAnchorLegal(o,f,e)?!this.LineSegIntersectBound(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,r.get_Bottom()),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,u.get_Top())):!1},MiddleAnchorLegal:function(n,t,i){var u=this.NodeLayer(t),r=this.layerArrays.get_X()[t],f=n-i.get_X(),e,o;return r>0&&(e=this.anchors[u[r-1]],e.get_Right()>f+i.get_Left())?!1:r<u.length-1&&(o=this.anchors[u[r+1]],o.get_Left()<f+i.get_Right())?!1:!0},MiddlePos:function(n,t,i,r,u){var f=i.get_Y()-u,e=u-r.get_Y();return System.Diagnostics.Debug.Assert$$Boolean(f>=0&&e>=0),(n*f+t*e)/(f+e)},TryToRemoveInflections:function(){var t,n;if(!this.TurningAlwaySameDirection())for(t=!0;t;)for(t=!1,n=this.headSite;n!=null&&n.get_Next()!=null;n=n.get_Next())t=function(){var t={Value:n},i=this.TryToRemoveInflectionEdge(t);return n=t.Value,i}.call(this)||t},TurningAlwaySameDirection:function(){for(var i,t=0,n=this.headSite.get_Next();n!=null&&n.get_Next()!=null;n=n.get_Next())if(i=n.get_Turn(),t==0)i>0?t=1:i<0&&(t=-1);else if(t*i<0)return!1;return!0},EdgePathPoint:function(n){return this.anchors[this.EdgePathNode(n)].get_Origin()},EdgePathNode:function(n){return n==this.edgePath.get_Count()?this.edgePath.get_Item$$Int32(this.edgePath.get_Count()-1).get_Target():this.edgePath.get_Item$$Int32(n).get_Source()},CreateSmoothedPolyline:function(){this.RemoveVerticesWithNoTurns();var n=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,r=this.headSite,t,i;return function(){var n={Value:t},u={Value:i},f=Microsoft.Msagl.Core.Geometry.Curves.Curve.FindCorner(r,n,u);return t=n.Value,i=u.Value,f}.call(this)?(function(){var u={Value:r},f={Value:t},e={Value:i},o=this.CreateFilletCurve(n,u,f,e);return r=u.Value,t=f.Value,i=e.Value,o}.call(this),n=this.ExtendCurveToEndpoints(n)):n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.headSite.get_Point(),this.get_TailSite().get_Point())),n},RemoveVerticesWithNoTurns:function(){while(this.RemoveVerticesWithNoTurnsOnePass());},RemoveVerticesWithNoTurnsOnePass:function(){for(var t=!1,n=this.headSite;n.get_Next()!=null&&n.get_Next().get_Next()!=null;n=n.get_Next())Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.Flat(n.get_Next())&&(t=!0,n.set_Next(n.get_Next().get_Next()),n.get_Next().set_Previous(n));return t},ExtendCurveToEndpoints:function(n){var t=this.headSite.get_Point(),i;return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(t,n.get_Start())||(i=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,i.AddSegs$$ICurve$$ICurve(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t,n.get_Start()),n),n=i),t=this.get_TailSite().get_Point(),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(t,n.get_End())||n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n.get_End(),t)),n},CreateFilletCurve:function(n,t,i,r){do if(this.AddSmoothedCorner(t.Value,i.Value,r.Value,n),t.Value=i.Value,i.Value=r.Value,i.Value.get_Next()!=null)r.Value=i.Value.get_Next();else break;while(1)},AddSmoothedCorner:function(n,t,i,r){var u=.5,f,e;do f=Microsoft.Msagl.Core.Geometry.Curves.Curve.CreateBezierSeg$$Double$$Double$$Site$$Site$$Site(u,u,n,t,i),t.set_PreviousBezierSegmentFitCoefficient(u),u/=2;while(this.BezierSegIntersectsBoundary$$CubicBezierSegment(f));u*=2;u<.5&&(u=.5*(u+u*2),e=Microsoft.Msagl.Core.Geometry.Curves.Curve.CreateBezierSeg$$Double$$Double$$Site$$Site$$Site(u,u,n,t,i),this.BezierSegIntersectsBoundary$$CubicBezierSegment(e)||(t.set_PreviousBezierSegmentFitCoefficient(function(n){return t.set_NextBezierSegmentFitCoefficient(n),n}.call(this,u)),f=e));r.get_Segments().get_Count()>0&&!Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(r.get_End(),f.get_Start())&&r.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r.get_End(),f.get_Start()));r.AddSegment(f)},BezierSegIntersectsBoundary$$CubicBezierSegment:function(n){var t=Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n.B(0),n.B(1),n.B(2));return t>0?this.BezierSegIntersectsTree(n,this.thinLeftHierarchy)||this.BezierSegIntersectsTree(n,this.leftHierarchy):this.BezierSegIntersectsTree(n,this.thinRightHierarchy)||this.BezierSegIntersectsTree(n,this.rightHierarchy)},BezierSegIntersectsTree:function(n,t){if(t==null)return!1;if(Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.Intersect(n.get_ParallelogramNodeOverICurve().get_Parallelogram(),t.get_Parallelogram())){var i=As(t,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramBinaryTreeNode.ctor);return i!=null?this.BezierSegIntersectsTree(n,i.get_LeftSon())||this.BezierSegIntersectsTree(n,i.get_RightSon()):Microsoft.Msagl.Layout.Layered.SmoothedPolylineCalculator.BezierSegIntersectsBoundary$$CubicBezierSegment$$ICurve(n,Cast(t,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.ctor).get_Seg())}return!1}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$SmoothedPolylineCalculator);Microsoft$Msagl$Layout$Layered$TwoLayerFlatEdgeRouter={fullname:"Microsoft.Msagl.Layout.Layered.TwoLayerFlatEdgeRouter",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},CreatObstaceOnLabel:function(n){var t=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,i=n.get_Center().get_Y()-n.get_Height()/4;return t.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_BoundingBox().get_Left(),i),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_BoundingBox().get_Right(),i))),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Point(t,n.get_BoundingBox().get_RightTop()),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Point(t,n.get_BoundingBox().get_LeftTop()),Microsoft.Msagl.Core.Geometry.Curves.Curve.CloseCurve(t),t}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.bottomLayer=null;this.interactiveEdgeRouter=null;this.labelCenters=null;this.labelsToLabelObstacles=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Label.ctor,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor);this.pairArray=null;this.routing=null;this.topLayer=null;this.settings=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.settings=n;this.topLayer=r;this.bottomLayer=i;this.routing=t;this.InitLabelsInfo()},Database$$:"Microsoft.Msagl.Layout.Layered.Database",get_Database:function(){return this.routing.Database},Layering$$:"System.Int32[]",get_Layering:function(){return this.routing.LayerArrays.Y},IntGraph$$:"Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph`1[[Microsoft.Msagl.Layout.Layered.IntEdge]]",get_IntGraph:function(){return this.routing.IntGraph},LayerArrays$$:"Microsoft.Msagl.Layout.Layered.LayerArrays",get_LayerArrays:function(){return this.routing.LayerArrays},PaddingForEdges$$:"System.Double",get_PaddingForEdges:function(){return this.settings.get_LayerSeparation()/8},InitLabelsInfo:function(){var f,r,u;this.pairArray=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,new Microsoft.Msagl.Core.DataStructures.Set$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.SelectMany$3$$IEnumerable$1$$Func$2$$Func$3(System.Int32.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,null,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Int32.ctor,this.bottomLayer,$CreateAnonymousDelegate(this,function(n){return n<this.get_IntGraph().get_NodeCount()})),$CreateAnonymousDelegate(this,function(n){return this.get_IntGraph().OutEdges(n)}),$CreateAnonymousDelegate(this,function(n,t){return $CreateAnonymousObject({v:n,edge:t})})),$CreateAnonymousDelegate(this,function(n){return n.get_edge().get_Source()!=n.get_edge().get_Target()})),$CreateAnonymousDelegate(this,function(n){return this.get_Layering()[n.get_edge().get_Target()]==this.get_Layering()[n.get_edge().get_Source()]})),$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_edge().get_Source(),n.get_edge().get_Target())}))));this.labelCenters=new Float64Array(this.pairArray.length);f=0;for(var t=0,i=this.pairArray,e=i.length,n=i[t];t<e;t++,n=i[t])this.get_LayerArrays().get_X()[n.get_First()]<this.get_LayerArrays().get_X()[n.get_Second()]?(r=n.get_First(),u=n.get_Second()):(r=n.get_Second(),u=n.get_First()),this.labelCenters[f++]=(this.get_Database().get_Anchors()[r].get_Right()+this.get_Database().get_Anchors()[u].get_Left())/2;this.InitLabelsToLabelObstacles()},InitLabelsToLabelObstacles:function(){var i,n,t;for(this.labelsToLabelObstacles=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Layout.Label.ctor,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor),i=System.Linq.Enumerable.SelectMany$3$$IEnumerable$1$$Func$2$$Func$3(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,Microsoft.Msagl.Core.Layout.Label.ctor,Microsoft.Msagl.Core.Layout.Label.ctor,this.pairArray,$CreateAnonymousDelegate(this,function(n){return this.PairLabels(n)}),$CreateAnonymousDelegate(this,function(n,t){return t})),n=i.GetEnumerator();n.MoveNext();)t=n.get_Current(),this.labelsToLabelObstacles.set_Item$$TKey(t,Microsoft.Msagl.Layout.Layered.TwoLayerFlatEdgeRouter.CreatObstaceOnLabel(t))},GetMaxLabelWidth:function(n){var t=this.PairLabels(n);return System.Linq.Enumerable.Any$1$$IEnumerable$1(Microsoft.Msagl.Core.Layout.Label.ctor,t)?System.Linq.Enumerable.Max$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Layout.Label.ctor,t,$CreateAnonymousDelegate(this,function(n){return n.get_Width()})):0},PairLabels:function(n){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.Layout.Label.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,null,this.get_Database().GetMultiedge$$IntPair(n),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({edge:n,label:n.get_Edge().get_Label()})})),$CreateAnonymousDelegate(this,function(n){return n.get_label()!=null})),$CreateAnonymousDelegate(this,function(n){return n.get_label()}))},RunInternal:function(){var n,t;if(this.pairArray.length>0)for(this.PositionLabelsOfFlatEdges(),this.interactiveEdgeRouter=new Microsoft.Msagl.Routing.InteractiveEdgeRouter.ctor$$IEnumerable$1$ICurve$$Double$$Double$$Double(this.GetObstacles(),this.get_PaddingForEdges(),this.get_PaddingForEdges()/3,.523598775598299),this.interactiveEdgeRouter.CalculateWholeTangentVisibilityGraph(),n=this.IntEdges().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.ProgressStep(),this.RouteEdge(t)},GetObstacles:function(){return System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(System.Int32.ctor,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Int32.ctor,System.Linq.Enumerable.Concat$1(System.Int32.ctor,this.topLayer,this.bottomLayer),$CreateAnonymousDelegate(this,function(n){return n<this.routing.OriginalGraph.get_Nodes().get_Count()})),$CreateAnonymousDelegate(this,function(n){return this.routing.IntGraph.get_Nodes().get_Item$$Int32(n).get_BoundaryCurve()})),this.LabelCurves())},LabelCurves:function(){return System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(null,Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(null,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,null,this.IntEdges(),$CreateAnonymousDelegate(this,function(n){return $CreateAnonymousObject({edge:n,label:n.get_Edge().get_Label()})})),$CreateAnonymousDelegate(this,function(n){return n.get_label()!=null})),$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Layout.Layered.TwoLayerFlatEdgeRouter.CreatObstaceOnLabel(n.get_label())}))},IntEdges:function(){return System.Linq.Enumerable.SelectMany$3$$IEnumerable$1$$Func$2$$Func$3(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,Microsoft.Msagl.Layout.Layered.IntEdge.ctor,this.pairArray,$CreateAnonymousDelegate(this,function(n){return this.get_Database().GetMultiedge$$IntPair(n)}),$CreateAnonymousDelegate(this,function(n,t){return t}))},RouteEdge:function(n){n.get_HasLabel()?this.RouteEdgeWithLabel(n,n.get_Edge().get_Label()):this.RouteEdgeWithNoLabel(n)},RouteEdgeWithLabel:function(n,t){var o=this.routing.IntGraph.get_Nodes().get_Item$$Int32(n.get_Source()),s=this.routing.IntGraph.get_Nodes().get_Item$$Int32(n.get_Target()),c=new Microsoft.Msagl.Core.Layout.FloatingPort.ctor(o.get_BoundaryCurve(),o.get_Center()),l=new Microsoft.Msagl.Core.Layout.FloatingPort.ctor(s.get_BoundaryCurve(),s.get_Center()),a=this.labelsToLabelObstacles.get_Item$$TKey(t),h=new Microsoft.Msagl.Core.Layout.FloatingPort.ctor(a,t.get_Center()),i,u,f,e,r;(function(){var n={Value:i},t=this.interactiveEdgeRouter.RouteSplineFromPortToPortWhenTheWholeGraphIsReady(c,h,!0,n);return i=n.Value,t}).call(this),function(){var n={Value:u},t=this.interactiveEdgeRouter.RouteSplineFromPortToPortWhenTheWholeGraphIsReady(h,l,!0,n);return u=n.Value,t}.call(this);f=u.get_HeadSite().get_Next();e=i.get_LastSite();e.set_Next(f);f.set_Previous(e);r=n.get_Edge().get_EdgeGeometry();r.SetSmoothedPolylineAndCurve(i);Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(r,n.get_Edge().get_Source().get_BoundaryCurve(),n.get_Edge().get_Target().get_BoundaryCurve(),r.get_Curve(),!1,this.settings.get_EdgeRoutingSettings().get_KeepOriginalSpline())},RouteEdgeWithNoLabel:function(n){var i=this.routing.IntGraph.get_Nodes().get_Item$$Int32(n.get_Source()),r=this.routing.IntGraph.get_Nodes().get_Item$$Int32(n.get_Target()),f=new Microsoft.Msagl.Core.Layout.FloatingPort.ctor(i.get_BoundaryCurve(),i.get_Center()),e=new Microsoft.Msagl.Core.Layout.FloatingPort.ctor(r.get_BoundaryCurve(),r.get_Center()),t=n.get_Edge().get_EdgeGeometry(),u;t.set_Curve(function(){var n={Value:u},t=this.interactiveEdgeRouter.RouteSplineFromPortToPortWhenTheWholeGraphIsReady(f,e,!0,n);return u=n.Value,t}.call(this));Microsoft.Msagl.Core.Layout.Arrowheads.TrimSplineAndCalculateArrowheads$$EdgeGeometry$$ICurve$$ICurve$$ICurve$$Boolean$$Boolean(t,n.get_Edge().get_Source().get_BoundaryCurve(),n.get_Edge().get_Target().get_BoundaryCurve(),t.get_Curve(),!1,this.settings.get_EdgeRoutingSettings().get_KeepOriginalSpline());n.get_Edge().set_EdgeGeometry(t)},PositionLabelsOfFlatEdges:function(){this.labelCenters!=null&&this.labelCenters.length!=0&&(this.SortLabelsByX(),this.CalculateLabelsX())},CalculateLabelsX:function(){for(var t=Microsoft.Msagl.Layout.Layered.ConstrainedOrdering.CreateSolver(),i,f,r,u,n=0;n<this.pairArray.length;n++)t.AddVariableWithIdealPosition$$Int32$$Double$$Double(n,this.labelCenters[n],this.GetLabelWeight(this.pairArray[n]));for(i=this.GetMaxLabelWidth(this.pairArray[0]),n=0;n<this.pairArray.length-1;n++)t.AddLeftRightSeparationConstraint$$Int32$$Int32$$Double(n,n+1,(i+(i=this.GetMaxLabelWidth(this.pairArray[n+1])))/2+this.settings.get_NodeSeparation());for(n=0;n<this.labelCenters.length;n++)for(f=this.labelCenters[n]=t.GetVariableResolvedPosition(n),r=this.PairLabels(this.pairArray[n]).GetEnumerator();r.MoveNext();)u=r.get_Current(),u.set_Center(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(f,u.get_Center().get_Y()))},GetLabelWeight:function(n){return this.get_Database().GetMultiedge$$IntPair(n).get_Count()},SortLabelsByX:function(){System.Array.Sort$2$$TKey$Array$$TValue$Array(System.Double.ctor,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor,this.labelCenters,this.pairArray)}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$TwoLayerFlatEdgeRouter);Microsoft$Msagl$DebugHelpers$DevTrace={fullname:"Microsoft.Msagl.DebugHelpers.DevTrace",baseTypeName:"System.Object",staticDefinition:{Assert:function(n,t,i){System.Diagnostics.Trace.Assert$$Boolean$$String(n,System.String.Format$$String$$Object$Array(t,i))}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$DebugHelpers$DevTrace);Microsoft$Msagl$Routing$Spline$ConeSpanner$Cone={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.removed=!1;this.apex=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.coneSweeper=null;this.rightSide=null;this.leftSide=null;System.Object.ctor.call(this);this.apex=n;this.coneSweeper=t},Removed$$:"System.Boolean",get_Removed:function(){return this.removed},set_Removed:function(n){this.removed=n},Apex$$:"Microsoft.Msagl.Core.Geometry.Point",get_Apex:function(){return this.apex},set_Apex:function(n){this.apex=n},RightSideDirection$$:"Microsoft.Msagl.Core.Geometry.Point",get_RightSideDirection:function(){return this.coneSweeper.get_ConeRightSideDirection()},LeftSideDirection$$:"Microsoft.Msagl.Core.Geometry.Point",get_LeftSideDirection:function(){return this.coneSweeper.get_ConeLeftSideDirection()},RightSide$$:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide",get_RightSide:function(){return this.rightSide},set_RightSide:function(n){this.rightSide=n;this.rightSide.set_Cone(this)},LeftSide$$:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide",get_LeftSide:function(){return this.leftSide},set_LeftSide:function(n){this.leftSide=n;this.leftSide.set_Cone(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$Cone);Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeClosureEvent={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeClosureEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.coneToClose=null;this.site=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor.call(this);this.site=n;this.coneToClose=t},ConeToClose$$:"Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone",get_ConeToClose:function(){return this.coneToClose},Site$$:"Microsoft.Msagl.Core.Geometry.Point",get_Site:function(){return this.site},toString:function(){return"ConeClosureEvent "+this.site}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeClosureEvent);Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeLeftSide={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide.ctor.call(this);this.set_Cone(n)},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.get_Cone().get_Apex()},Direction$$:"Microsoft.Msagl.Core.Geometry.Point",get_Direction:function(){return this.get_Cone().get_LeftSideDirection()}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeLeftSide);Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeRightSide={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide.ctor.call(this);this.set_Cone(n)},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.get_Cone().get_Apex()},Direction$$:"Microsoft.Msagl.Core.Geometry.Point",get_Direction:function(){return this.get_Cone().get_RightSideDirection()},toString:function(){return"ConeRightSide "+this.get_Start()+" "+this.get_Direction()}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeRightSide);Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSpanner={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSpanner",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},GetTotalSteps:function(n){return((6.28318530717959-n/2)/n|0)+1}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor$$IEnumerable$1$Polyline$$VisibilityGraph:function(n,t){this._obstacles=null;this._visibilityGraph=null;this.coneAngle=.523598775598299;this._bidirectional=!1;this._Ports=null;this._BorderPolyline=null;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this._obstacles=Microsoft.Msagl.Routing.Visibility.VisibilityGraph.OrientHolesClockwise(n);this._visibilityGraph=t},ctor$$IEnumerable$1$Polyline$$VisibilityGraph$$Double$$Set$1$Point$$Polyline:function(n,t,i,r,u){this._obstacles=null;this._visibilityGraph=null;this.coneAngle=.523598775598299;this._bidirectional=!1;this._Ports=null;this._BorderPolyline=null;Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSpanner.ctor$$IEnumerable$1$Polyline$$VisibilityGraph.call(this,n,t);System.Diagnostics.Debug.Assert$$Boolean(u==null||System.Linq.Enumerable.All$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,n,$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveIsInsideOther(n,u)})));System.Diagnostics.Debug.Assert$$Boolean(u==null||System.Linq.Enumerable.All$1(Microsoft.Msagl.Core.Geometry.Point.ctor,r,$CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n,u)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside})));System.Diagnostics.Debug.Assert$$Boolean(i>.0349065850398866&&i<=1.5707963267949);this.set_Ports(r);this.set_BorderPolyline(u);this.set_ConeAngle(i)},ConeAngle$$:"System.Double",get_ConeAngle:function(){return this.coneAngle},set_ConeAngle:function(n){this.coneAngle=n},Ports$$:"Microsoft.Msagl.Core.DataStructures.Set`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_Ports:function(){return this._Ports},set_Ports:function(n){this._Ports=n},BorderPolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_BorderPolyline:function(){return this._BorderPolyline},set_BorderPolyline:function(n){this._BorderPolyline=n},Bidirectional$$:"System.Boolean",get_Bidirectional:function(){return this._bidirectional},set_Bidirectional:function(n){this._bidirectional=n},RunInternal:function(){var i=6.28318530717959-this.coneAngle/2,n,t;if(this.get_Bidirectional())this.HandleBideractionalCase();else for(t=0;(n=this.coneAngle*t)<=i;t++)this.ProgressStep(),this.AddDirection(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Cos(n),System.Math.Sin(n)),this.get_BorderPolyline(),this._visibilityGraph)},HandleBideractionalCase:function(){for(var n,i,r,u=3.14159265358979/this.coneAngle|0,t=0;t<u;t++)n=t*this.coneAngle,i=new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor,this.AddDirection(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Cos(n),System.Math.Sin(n)),this.get_BorderPolyline(),i),r=new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor,this.AddDirection(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-System.Math.Cos(n),-System.Math.Sin(n)),this.get_BorderPolyline(),r),this.AddIntersectionOfBothDirectionSweepsToTheResult(i,r)},AddIntersectionOfBothDirectionSweepsToTheResult:function(n,t){for(var r=n.get_Edges().GetEnumerator(),i;r.MoveNext();)i=r.get_Current(),t.FindEdge$$Point$$Point(i.get_SourcePoint(),i.get_TargetPoint())!=null&&this._visibilityGraph.AddEdge$$Point$$Point(i.get_SourcePoint(),i.get_TargetPoint())},AddDirection:function(n,t,i){Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.Sweep(this._obstacles,n,this.coneAngle,i,this.get_Ports(),t)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSpanner);Microsoft$Msagl$Core$Geometry$Curves$ClosestPointOnCurve={fullname:"Microsoft.Msagl.Core.Geometry.Curves.ClosestPointOnCurve",baseTypeName:"System.Object",staticDefinition:{ClosestPoint:function(n,t,i,r,u){var f=i,h=0,e=0,o,c=!1;do{var l=n.get_Item$$Double(f),s=n.Derivative(f),v=n.SecondDerivative(f),a=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(s,s)+Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(l,t),v);if(System.Math.Abs$$Double(a)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())return f;o=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(l,t),s)/a;f-=o;f>u+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?(f=u,e++):f<r-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()&&(f=r,e++);h++}while(System.Math.Abs$$Double(o)>Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()&&!(c=h>=5||e>=5));return c&&Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Item$$Double(i),t).get_Length()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(f=i),f}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$ClosestPointOnCurve);Microsoft$Msagl$Core$Geometry$Curves$CubicBezierSegment={fullname:"Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment",baseTypeName:"System.Object",staticDefinition:{AdjustParamTo01:function(n){n.Value>1?n.Value=1:n.Value<0&&(n.Value=0)},LengthOnControlPolygon:function(n,t,i,r){var u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,n).get_Length(),f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t).get_Length()+Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,i).get_Length();if(f-u>Microsoft.Msagl.Core.Geometry.Curves.Curve.get_LineSegmentThreshold()){var e=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,t),2),o=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,i),2),s=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,r),2),h=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(e,o),2),c=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(s,o),2),l=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(h,c),2);return Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.LengthOnControlPolygon(n,e,h,l)+Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.LengthOnControlPolygon(l,c,s,r)}return(f+u)/2}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Geometry.Curves.ICurve"],Kind:"Class",definition:{ctor:function(n,t,i,r){this.b=new Array(4);this.l=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.e=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.c=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.pBoxNode=null;this.parStart=0;this.parEnd=1;System.Object.ctor.call(this);this.b[0]=n;this.b[1]=t;this.b[2]=i;this.b[3]=r;this.c=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(3,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.b[1],this.b[0]));this.e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(3,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.b[2],this.b[1])),this.c);this.l=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.b[3],this.b[0]),this.c),this.e)},LeftDerivative:function(n){return this.Derivative(n)},RightDerivative:function(n){return this.Derivative(n)},B:function(n){return this.b[n]},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"(Bezie{0},{1},{2},{3})",[this.b[0],this.b[1],this.b[2],this.b[3]])},ParallelogramNodeOverICurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve",get_ParallelogramNodeOverICurve:function(){return this.pBoxNode!=null?this.pBoxNode:this.pBoxNode=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSegment(this)},Item$$:"Microsoft.Msagl.Core.Geometry.Point",get_Item$$Double:function(n){var t=n*n,i=t*n;return Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(this.l,i),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(this.e,t)),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(this.c,n)),this.b[0])},Trim:function(n,t){if(function(){var t={Value:n},i=Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.AdjustParamTo01(t);return n=t.Value,i}.call(this),function(){var n={Value:t},i=Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.AdjustParamTo01(n);return t=n.Value,i}.call(this),n>t)return this.Trim(t,n);if(n>1-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())return new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(this.b[3],this.b[3],this.b[3],this.b[3]);var i=new Array(3),r=new Array(2),f=this.Casteljau(n,i,r),u=new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(f,r[1],i[2],this.b[3]),e=u.Casteljau((t-n)/(1-n),i,r);return new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(u.b[0],i[0],r[0],e)},TrimWithWrap:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Casteljau:function(n,t,i){for(var u=1-n,r=0;r<3;r++)t[r]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(this.b[r],u),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(this.b[r+1],n));for(r=0;r<2;r++)i[r]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t[r],u),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t[r+1],n));return Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(i[0],u),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(i[1],n))},Derivative:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(3,this.l),n),n),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(2,this.e),n)),this.c)},SecondDerivative:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(6,this.l),n),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(2,this.e))},ThirdDerivative:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(6,this.l)},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.b[0]},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.b[3]},ParStart$$:"System.Double",get_ParStart:function(){return this.parStart},set_ParStart:function(n){this.parStart=n},ParEnd$$:"System.Double",get_ParEnd:function(){return this.parEnd},set_ParEnd:function(n){this.parEnd=n},Reverse:function(){return new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(this.b[3],this.b[2],this.b[1],this.b[0])},Translate:function(n){this.b[0]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.b[0],n);this.b[1]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.b[1],n);this.b[2]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.b[2],n);this.b[3]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.b[3],n);this.c=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(3,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.b[1],this.b[0]));this.e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(3,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.b[2],this.b[1])),this.c);this.l=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.b[3],this.b[0]),this.c),this.e);this.pBoxNode=null},ScaleFromOrigin:function(n,t){return new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(Microsoft.Msagl.Core.Geometry.Point.Scale(n,t,this.b[0]),Microsoft.Msagl.Core.Geometry.Point.Scale(n,t,this.b[1]),Microsoft.Msagl.Core.Geometry.Point.Scale(n,t,this.b[2]),Microsoft.Msagl.Core.Geometry.Point.Scale(n,t,this.b[3]))},OffsetCurve:function(){return null},LengthPartial:function(n,t){return this.Trim(n,t).get_Length()},Length$$:"System.Double",get_Length:function(){return Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.LengthOnControlPolygon(this.b[0],this.b[1],this.b[2],this.b[3])},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){var n=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(this.b[0],this.b[1]);return n.Add$$Point(this.b[2]),n.Add$$Point(this.b[3]),n},Transform:function(n){return new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,this.b[0]),Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,this.b[1]),Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,this.b[2]),Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,this.b[3]))},ClosestParameterWithinBounds:function(n,t,i){var r,u,f;System.Diagnostics.Debug.Assert$$Boolean(i<=1&&t>=0);System.Diagnostics.Debug.Assert$$Boolean(t<=i);var e=(i-t)/8,o=0,s=1.79769313486232E+308;for(r=0;r<9;r++)u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,this.get_Item$$Double(r*e+t)),f=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,u),f<s&&(s=f,o=r*e+t);return Microsoft.Msagl.Core.Geometry.Curves.ClosestPointOnCurve.ClosestPoint(this,n,o,t,i)},Clone:function(){return new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(this.b[0],this.b[1],this.b[2],this.b[3])},Curvature:function(n){System.Diagnostics.Debug.Assert$$Boolean(n>=this.get_ParStart()&&n<=this.get_ParEnd());var t=this.G(n);return System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Double(t)>1e-5),this.F(n)/t},F:function(n){return this.Xp(n)*this.Ypp(n)-this.Yp(n)*this.Xpp(n)},G:function(n){var i=this.Xp(n),r=this.Yp(n),t=i*i+r*r;return System.Math.Sqrt(t*t*t)},Xp:function(n){return 3*this.l.get_X()*n*n+2*this.e.get_X()*n+this.c.get_X()},Ypp:function(n){return 6*this.l.get_Y()*n+2*this.e.get_Y()},Yp:function(n){return 3*this.l.get_Y()*n*n+2*this.e.get_Y()*n+this.c.get_Y()},Xpp:function(n){return 6*this.l.get_X()*n+2*this.e.get_X()},Xppp:function(){return 6*this.l.get_X()},Yppp:function(){return 6*this.l.get_Y()},CurvatureDerivative:function(n){var t=this.G(n);return(this.Fp(n)*t-this.Gp(n)*this.F(n))/(t*t)},Fp:function(n){return this.Xp(n)*this.Yppp(n)-this.Yp(n)*this.Xppp(n)},Fpp:function(n){return this.Xpp(n)*this.Yppp(n)-this.Ypp(n)*this.Xppp(n)},ClosestParameter:function(n){for(var i,r,u=.125,f=0,e=1.79769313486232E+308,t=0;t<9;t++)i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,this.get_Item$$Double(t*u)),r=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(i,i),r<e&&(e=r,f=t*u);return Microsoft.Msagl.Core.Geometry.Curves.ClosestPointOnCurve.ClosestPoint(this,n,f,0,1)},MaximalCurvaturePoints$$:"System.Collections.Generic.IEnumerable`1[[System.Tuple`2[[System.Double],[System.Double]]]]",get_MaximalCurvaturePoints:function(){for(var i,r,n,s,t=new System.Collections.Generic.List$1.ctor(System.Tuple$2.ctor),f=8,e=1/f,o=-1,u=0;u<f;u++)i=u*e,r=i+e,function(){var t={Value:n},u=Microsoft.Msagl.Core.Geometry.Curves.RootFinder.TryToFindRoot(new Microsoft.Msagl.Core.Geometry.Curves.CurvatureDerivative.ctor(this,i,r),i,r,(i+r)/2,t);return n=t.Value,u}.call(this)&&n!=o&&(o=n,t.Add(new System.Tuple$2.ctor(System.Double.ctor,System.Double.ctor,n,this.Curvature(n))));return t.Add(new System.Tuple$2.ctor(System.Double.ctor,System.Double.ctor,this.get_ParStart(),this.Curvature(this.get_ParStart()))),t.Add(new System.Tuple$2.ctor(System.Double.ctor,System.Double.ctor,this.get_ParEnd(),this.Curvature(this.get_ParEnd()))),s=System.Linq.Enumerable.Max$1$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,t,$CreateAnonymousDelegate(this,function(n){return System.Math.Abs$$Double(n.get_Item2())})),System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(System.Tuple$2.ctor,t,$CreateAnonymousDelegate(this,function(n){return System.Math.Abs$$Double(n.get_Item2())==s}))},CurvatureSecondDerivative:function(n){var t=this.G(n);return(this.Qp(n)*t-2*this.Q(n)*this.Gp(n))/(t*t*t)},Q:function(n){return this.Fp(n)*this.G(n)-this.Gp(n)*this.F(n)},Qp:function(n){return this.Fpp(n)*this.G(n)-this.Gpp(n)*this.F(n)},Gpp:function(n){var t=this.Xp(n),i=this.Yp(n),r=this.Xpp(n),u=this.Ypp(n),o=this.Xppp(n),s=this.Yppp(n),f=System.Math.Sqrt(t*t+i*i),e=t*r+i*u;return 3*(e*e/f+f*(r*r+t*o+u*u+i*s))},Gp:function(n){var t=this.Xp(n),i=this.Yp(n),r=this.Xpp(n),u=this.Ypp(n);return 3*System.Math.Sqrt(t*t+i*i)*(t*r+i*u)},GetParameterAtLength:function(n){for(var i=0,r=1,t,u;r-i>Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance();)if(t=(r+i)/2,u=this.EvaluateError(n,t),u>0)r=t;else if(u<0)i=t;else return t;return(i+r)/2},EvaluateError:function(n,t){var i=1-t,r=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,this.b[0]),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,this.b[1])),u=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,this.b[1]),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,this.b[2])),o=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,this.b[2]),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,this.b[3])),f=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,r),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,u)),s=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,u),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,o)),h=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,f),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,s)),e=Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.LengthOnControlPolygon(this.b[0],r,f,h);return e>n+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?1:e<n-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?-1:0}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$CubicBezierSegment);Microsoft$Msagl$Core$Geometry$Curves$CurvatureDerivative={fullname:"Microsoft.Msagl.Core.Geometry.Curves.CurvatureDerivative",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Geometry.Curves.IFunction"],Kind:"Class",definition:{ctor:function(n,t,i){this.curve=null;this.start=0;this.end=0;System.Object.ctor.call(this);this.curve=n;this.start=t;this.end=i},Item$$:"System.Double",get_Item$$Double:function(n){return this.curve.CurvatureDerivative(n)},Derivative:function(n){return this.curve.CurvatureSecondDerivative(n)},SecondDerivative:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},ThirdDerivative:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},ParStart$$:"System.Double",get_ParStart:function(){return this.start},ParEnd$$:"System.Double",get_ParEnd:function(){return this.end}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$CurvatureDerivative);Microsoft$Msagl$Core$Geometry$Curves$Curve={fullname:"Microsoft.Msagl.Core.Geometry.Curves.Curve",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Geometry.Curves.Curve.lineSegThreshold=.05},IsCloseToLineSeg:function(n,t,i,r,u,f){var s=.333333333333333,o=n*s+i*.666666666666667,e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.get_Item$$Double(o),Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t.Value,s),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r.Value,.666666666666667)));return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(e,e)>f?!1:(o=n*.666666666666667+i*s,e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.get_Item$$Double(o),Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t.Value,.666666666666667),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r.Value,s))),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(e,e)>f)?!1:(o=n*.5+i*.5,e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.get_Item$$Double(o),Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(t.Value,.5),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r.Value,.5))),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(e,e)>f)?!1:!0},Interpolate$$Double$$Point$$Double$$Point$$ICurve$$Double:function(n,t,i,r,u,f){var o=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor),s,e;return Microsoft.Msagl.Core.Geometry.Curves.Curve.IsCloseToLineSeg(n,t,i,r,u,f)?o.Add(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.Value,r.Value)):(s=.5*(n+i),e=u.get_Item$$Double(s),o.AddRange(function(){var i={Value:e},r=Microsoft.Msagl.Core.Geometry.Curves.Curve.Interpolate$$Double$$Point$$Double$$Point$$ICurve$$Double(n,t,s,i,u,f);return e=i.Value,r}()),o.AddRange(function(){var n={Value:e},t=Microsoft.Msagl.Core.Geometry.Curves.Curve.Interpolate$$Double$$Point$$Double$$Point$$ICurve$$Double(s,n,i,r,u,f);return e=n.Value,t}())),o},Interpolate$$Double$$Double$$Point$$Double$$Point$$ICurve:function(n,t,i,r,u,f){var o=(t+r)/2,e=f.get_Item$$Double(o),s=function(){var r={Value:e},u=Microsoft.Msagl.Core.Geometry.Curves.Curve.Interpolate$$Double$$Point$$Double$$Point$$ICurve$$Double(t,i,o,r,f,n*n);return e=r.Value,u}();return s.AddRange(function(){var t={Value:e},i=Microsoft.Msagl.Core.Geometry.Curves.Curve.Interpolate$$Double$$Point$$Double$$Point$$ICurve$$Double(o,t,r,u,f,n*n);return e=t.Value,i}()),s},Interpolate$$ICurve$$Double:function(n,t){var i=n.get_Start(),r=n.get_End();return function(){var u={Value:i},f={Value:r},e=Microsoft.Msagl.Core.Geometry.Curves.Curve.Interpolate$$Double$$Double$$Point$$Double$$Point$$ICurve(t,n.get_ParStart(),u,n.get_ParEnd(),f,n);return i=u.Value,r=f.Value,e}()},CurveCurveIntersectionOne:function(n,t,i){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"curve0");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"curve1");System.Diagnostics.Debug.Assert$$Boolean$$String(n!=t,"curve0 == curve1");var r=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodesOne(n.get_ParallelogramNodeOverICurve(),t.get_ParallelogramNodeOverICurve());return i&&r!=null&&(r=Microsoft.Msagl.Core.Geometry.Curves.Curve.LiftIntersectionToCurves$$ICurve$$ICurve$$IntersectionInfo(n,t,r)),r},GetAllIntersections:function(n,t,i){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"curve0");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"curve1");System.Diagnostics.Debug.Assert$$Boolean(n!=t);var r=As(n,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor);return r!=null?Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersectionsOfLineAndICurve(r,t,i):Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersectionsInternal(n,t,i)},GetAllIntersectionsInternal:function(n,t,i){var r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor),u;if(function(){var i={Value:r},u=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodes(n.get_ParallelogramNodeOverICurve(),t.get_ParallelogramNodeOverICurve(),i);return r=i.Value,u}(),i)for(u=0;u<r.get_Count();u++)r.set_Item$$Int32(u,Microsoft.Msagl.Core.Geometry.Curves.Curve.LiftIntersectionToCurves$$ICurve$$ICurve$$IntersectionInfo(n,t,r.get_Item$$Int32(u)));return r},GetAllIntersectionsOfLineAndICurve:function(n,t,i){var e=As(t,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),u,f,r;return e!=null?Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersectionsOfLineAndPolyline(n,e):(u=As(t,Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),u!=null)?Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersectionsOfLineAndCurve(n,u,i):(f=As(t,Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor),f!=null)?Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersectionsOfLineAndRoundedRect(n,f,i):(r=As(t,Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor),r!=null&&r.IsArc())?Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersectionsOfLineAndArc(n,r):Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersectionsInternal(n,t,i)},GetAllIntersectionsOfLineAndRoundedRect:function(n,t,i){var u=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersectionsOfLineAndCurve(n,t.get_Curve(),i),r,f;if(i)for(r=u.GetEnumerator();r.MoveNext();)f=r.get_Current(),f.set_Segment1(t);return u},GetAllIntersectionsOfLineAndCurve:function(n,t,i){var f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor),l=n.get_ParallelogramNodeOverICurve(),a=t.get_ParallelogramNodeOverICurve(),e,o,u,s,h,c,r;if(Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.Intersect(l.get_Parallelogram(),a.get_Parallelogram())==!1)return f;for(e=0,o=t.get_Segments().GetEnumerator();o.MoveNext();){if(u=o.get_Current(),s=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,u,!1),i){for(h=s.GetEnumerator();h.MoveNext();)r=h.get_Current(),r.set_Par1(r.get_Par1()+e-u.get_ParStart()),r.set_Segment1(t);e+=u.get_ParEnd()-u.get_ParStart()}for(c=s.GetEnumerator();c.MoveNext();)r=c.get_Current(),Microsoft.Msagl.Core.Geometry.Curves.Curve.AlreadyInside(f,r)||f.Add(r)}return f},AlreadyInside:function(n,t){for(var r,i=0;i<n.get_Count();i++)if(r=n.get_Item$$Int32(i),Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(r.get_IntersectionPoint(),t.get_IntersectionPoint()))return!0;return!1},GetAllIntersectionsOfLineAndArc:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_End(),n.get_Start()),u=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor),f=i.get_Length(),r,l;if(f<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Start(),t.get_Center()).get_Length(),t.get_AxisA().get_Length())&&(r=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(t.get_AxisA(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Start(),t.get_Center())),t.get_ParStart()-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()<=r&&(r=System.Math.Max$$Double$$Double(r,t.get_ParStart()),r<=t.get_ParEnd()+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()&&(r=System.Math.Min$$Double$$Double(t.get_ParEnd(),r),u.Add(new Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor(0,r,n.get_Start(),n,t))))),u;var s=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(i.Rotate90Ccw(),f),o=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Start(),t.get_Center()),s),h=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Center(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(s,o)),e=t.get_AxisA().get_Length(),c=System.Math.Abs$$Double(o);return e<c-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?u:(i=s.Rotate90Cw(),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(e,c)?Microsoft.Msagl.Core.Geometry.Curves.Curve.TryToAddPointToLineCircleCrossing(n,t,u,h,f,i):(System.Diagnostics.Debug.Assert$$Boolean(e>c),l=System.Math.Sqrt(e*e-o*o),Microsoft.Msagl.Core.Geometry.Curves.Curve.TryToAddPointToLineCircleCrossing(n,t,u,Microsoft.Msagl.Core.Geometry.Point.op_Addition(h,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(l,i)),f,i),Microsoft.Msagl.Core.Geometry.Curves.Curve.TryToAddPointToLineCircleCrossing(n,t,u,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(l,i)),f,i)),u)},TryToAddPointToLineCircleCrossing:function(n,t,i,r,u,f){var s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,n.get_Start()),h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,n.get_End()),e=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(s,f),o;e<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon||(e=System.Math.Max$$Double$$Double(e,0),e>u+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)||(e=System.Math.Min$$Double$$Double(e,u),e/=u,o=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(t.get_AxisA(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,t.get_Center())),t.get_ParStart()-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()<=o&&(o=System.Math.Max$$Double$$Double(o,t.get_ParStart()),o<=t.get_ParEnd()+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()&&(o=System.Math.Min$$Double$$Double(t.get_ParEnd(),o),i.Add(new Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor(e,o,r,n,t)))))},GetAllIntersectionsOfLineAndPolyline:function(n,t){for(var e=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor),o=0,r,u,i,f=t.get_StartPoint();f!=null&&f.get_Next()!=null;f=f.get_Next())(function(){var t={Value:r},e={Value:u},o={Value:i},s=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossTwoLineSegs(n.get_Start(),n.get_End(),f.get_Point(),f.get_Next().get_Point(),0,1,0,1,t,e,o);return r=t.Value,u=e.Value,i=o.Value,s})()&&(function(){var t={Value:r},e={Value:u},o={Value:i},s=Microsoft.Msagl.Core.Geometry.Curves.Curve.AdjustSolution(n.get_Start(),n.get_End(),f.get_Point(),f.get_Next().get_Point(),t,e,o);return r=t.Value,u=e.Value,i=o.Value,s}(),function(){var n={Value:i},t=Microsoft.Msagl.Core.Geometry.Curves.Curve.OldIntersection(e,n);return i=n.Value,t}()||e.Add(new Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor(r,o+u,i,n,t))),o++;return t.get_Closed()&&function(){var e={Value:r},o={Value:u},s={Value:i},h=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossTwoLineSegs(n.get_Start(),n.get_End(),f.get_Point(),t.get_Start(),0,1,0,1,e,o,s);return r=e.Value,u=o.Value,i=s.Value,h}()&&(function(){var e={Value:r},o={Value:u},s={Value:i},h=Microsoft.Msagl.Core.Geometry.Curves.Curve.AdjustSolution(n.get_Start(),n.get_End(),f.get_Point(),t.get_Start(),e,o,s);return r=e.Value,u=o.Value,i=s.Value,h}(),function(){var n={Value:i},t=Microsoft.Msagl.Core.Geometry.Curves.Curve.OldIntersection(e,n);return i=n.Value,t}()||e.Add(new Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor(r,o+u,i,n,t))),e},AdjustSolution:function(n,t,i,r,u,f,e){Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(e.Value,n)?(e.Value=n,u.Value=0):Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(e.Value,t)&&(e.Value=t,u.Value=1);Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(e.Value,i)?(e.Value=i,f.Value=System.Math.Floor$$Double(f.Value)):Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(e.Value,r)&&(e.Value=r,f.Value=System.Math.Ceiling$$Double(f.Value))},CurveCurveXWithParallelogramNodesOne:function(n,t){var r,u,e,c,o,l,s,h,f,i;if(!Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.Intersect(n.get_Parallelogram(),t.get_Parallelogram()))return null;if(r=As(n,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramInternalTreeNode.ctor),u=As(t,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramInternalTreeNode.ctor),r!=null&&u!=null){for(e=r.get_Children().GetEnumerator();e.MoveNext();)for(c=e.get_Current(),o=u.get_Children().GetEnumerator();o.MoveNext();)if(l=o.get_Current(),i=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodesOne(c,l),i!=null)return i}else if(u!=null){for(s=u.get_Children().GetEnumerator();s.MoveNext();)if(f=s.get_Current(),i=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodesOne(n,f),i!=null)return i}else if(r!=null){for(h=r.get_Children().GetEnumerator();h.MoveNext();)if(f=h.get_Current(),i=Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodesOne(f,t),i!=null)return i}else return Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossOverIntervalsOne(n,t);return null},CurveCurveXWithParallelogramNodes:function(n,t,i){var r,u,e,c,o,l,s,h,f;if(Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.Intersect(n.get_Parallelogram(),t.get_Parallelogram()))if(r=As(n,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramInternalTreeNode.ctor),u=As(t,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramInternalTreeNode.ctor),r!=null&&u!=null)for(e=r.get_Children().GetEnumerator();e.MoveNext();)for(c=e.get_Current(),o=u.get_Children().GetEnumerator();o.MoveNext();)l=o.get_Current(),Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodes(c,l,i);else if(u!=null)for(s=u.get_Children().GetEnumerator();s.MoveNext();)f=s.get_Current(),Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodes(n,f,i);else if(r!=null)for(h=r.get_Children().GetEnumerator();h.MoveNext();)f=h.get_Current(),Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodes(f,t,i);else i.Value=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossOverIntervals(n,t,i.Value)},CrossOverIntervalsOne:function(n,t){for(var c,s,l,u,f,e,o,i=As(n,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf.ctor),r=As(t,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf.ctor),a=(i.get_High()-i.get_Low())/2,v=(r.get_High()-r.get_Low())/2,h=1;h<2;h++)for(c=h*a+i.get_Low(),s=1;s<2;s++)if(l=s*v+r.get_Low(),i.get_Chord()==null&&r.get_Chord()==null?o=function(){var o={Value:u},s={Value:f},h={Value:e},a=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossWithinIntervalsWithGuess(n.get_Seg(),t.get_Seg(),i.get_Low(),i.get_High(),r.get_Low(),r.get_High(),c,l,o,s,h);return u=o.Value,f=s.Value,e=h.Value,a}():i.get_Chord()!=null&&r.get_Chord()==null?(o=function(){var n={Value:u},o={Value:f},s={Value:e},c=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossWithinIntervalsWithGuess(i.get_Chord(),t.get_Seg(),0,1,r.get_Low(),r.get_High(),.5*h,l,n,o,s);return u=n.Value,f=o.Value,e=s.Value,c}(),o&&(u=i.get_Low()+u*(i.get_High()-i.get_Low()))):i.get_Chord()==null?(o=function(){var t={Value:u},o={Value:f},h={Value:e},l=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossWithinIntervalsWithGuess(n.get_Seg(),r.get_Chord(),i.get_Low(),i.get_High(),0,1,c,.5*s,t,o,h);return u=t.Value,f=o.Value,e=h.Value,l}(),o&&(f=r.get_Low()+f*(r.get_High()-r.get_Low()))):(o=function(){var n={Value:u},t={Value:f},o={Value:e},c=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossWithinIntervalsWithGuess(i.get_Chord(),r.get_Chord(),0,1,0,1,.5*h,.5*s,n,t,o);return u=n.Value,f=t.Value,e=o.Value,c}(),o&&(f=r.get_Low()+f*(r.get_High()-r.get_Low()),u=i.get_Low()+u*(i.get_High()-i.get_Low()))),o)return Microsoft.Msagl.Core.Geometry.Curves.Curve.CreateIntersectionOne(i,r,u,f,e);return Microsoft.Msagl.Core.Geometry.Curves.Curve.GoDeeperOne(i,r)},CrossOverIntervals:function(n,t,i){for(var l,h,a,f,e,o,s,r=As(n,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf.ctor),u=As(t,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf.ctor),y=(r.get_High()-r.get_Low())/2,p=(u.get_High()-u.get_Low())/2,v=!1,c=1;c<2;c++)for(l=c*y+r.get_Low(),h=1;h<2;h++)a=h*p+u.get_Low(),r.get_Chord()==null&&u.get_Chord()==null?s=function(){var i={Value:f},s={Value:e},h={Value:o},c=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossWithinIntervalsWithGuess(n.get_Seg(),t.get_Seg(),r.get_Low(),r.get_High(),u.get_Low(),u.get_High(),l,a,i,s,h);return f=i.Value,e=s.Value,o=h.Value,c}():r.get_Chord()!=null&&u.get_Chord()==null?(s=function(){var n={Value:f},i={Value:e},s={Value:o},h=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossWithinIntervalsWithGuess(r.get_Chord(),t.get_Seg(),0,1,u.get_Low(),u.get_High(),.5*c,a,n,i,s);return f=n.Value,e=i.Value,o=s.Value,h}(),s&&(f=r.get_Low()+f*(r.get_High()-r.get_Low()))):r.get_Chord()==null?(s=function(){var t={Value:f},i={Value:e},s={Value:o},c=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossWithinIntervalsWithGuess(n.get_Seg(),u.get_Chord(),r.get_Low(),r.get_High(),0,1,l,.5*h,t,i,s);return f=t.Value,e=i.Value,o=s.Value,c}(),s&&(e=u.get_Low()+e*(u.get_High()-u.get_Low()))):(s=function(){var n={Value:f},t={Value:e},i={Value:o},s=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossWithinIntervalsWithGuess(r.get_Chord(),u.get_Chord(),0,1,0,1,.5*c,.5*h,n,t,i);return f=n.Value,e=t.Value,o=i.Value,s}(),s&&(e=u.get_Low()+e*(u.get_High()-u.get_Low()),f=r.get_Low()+f*(r.get_High()-r.get_Low()))),s&&(Microsoft.Msagl.Core.Geometry.Curves.Curve.AddIntersection(r,u,i,f,e,o),v=!0);return v||function(){var n={Value:i},t=Microsoft.Msagl.Core.Geometry.Curves.Curve.GoDeeper(n,r,u);return i=n.Value,t}(),i},AddIntersection:function(n,t,i,r,u,f){var e,o;Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(f,n.get_Seg().get_Item$$Double(n.get_Low()))?(f=n.get_Seg().get_Item$$Double(n.get_Low()),r=n.get_Low()):Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(f,n.get_Seg().get_Item$$Double(n.get_High()))&&(f=n.get_Seg().get_Item$$Double(n.get_High()),r=n.get_High());Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(f,t.get_Seg().get_Item$$Double(t.get_Low()))?(f=t.get_Seg().get_Item$$Double(t.get_Low()),u=t.get_Low()):Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(f,t.get_Seg().get_Item$$Double(t.get_High()))&&(f=t.get_Seg().get_Item$$Double(t.get_High()),u=t.get_High());e=function(){var n={Value:f},t=Microsoft.Msagl.Core.Geometry.Curves.Curve.OldIntersection(i,n);return f=n.Value,t}();e||(o=new Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor(r,u,f,n.get_Seg(),t.get_Seg()),i.Add(o));return},OldIntersection:function(n,t){for(var i=!1,r=n.GetEnumerator(),u;r.MoveNext();)if(u=r.get_Current(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Value,u.get_IntersectionPoint()).get_Length()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon*100){i=!0;break}return i},CreateIntersectionOne:function(n,t,i,r,u){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(u,n.get_Seg().get_Item$$Double(n.get_Low()))?(u=n.get_Seg().get_Item$$Double(n.get_Low()),i=n.get_Low()):Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(u,n.get_Seg().get_Item$$Double(n.get_High()))&&(u=n.get_Seg().get_Item$$Double(n.get_High()),i=n.get_High()),Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(u,t.get_Seg().get_Item$$Double(t.get_Low()))?(u=t.get_Seg().get_Item$$Double(t.get_Low()),r=t.get_Low()):Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(u,t.get_Seg().get_Item$$Double(t.get_High()))&&(u=t.get_Seg().get_Item$$Double(t.get_High()),r=t.get_High()),new Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor(i,r,u,n.get_Seg(),t.get_Seg())},LiftIntersectionToCurves$$ICurve$$ICurve$$Double$$Double$$Point$$ICurve$$ICurve:function(n,t,i,r,u,f,e){var o=Microsoft.Msagl.Core.Geometry.Curves.Curve.LiftParameterToCurve(n,i-f.get_ParStart(),f),s=Microsoft.Msagl.Core.Geometry.Curves.Curve.LiftParameterToCurve(t,r-e.get_ParStart(),e);return new Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor(o,s,u,n,t)},DropIntersectionToSegs:function(n){var t,i,r,u;return Is(n.get_Segment0(),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor)?function(){var r={Value:i},u={Value:t},f=As(n.get_Segment0(),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor).GetSegmentAndParameter$$Double$$Double$$ICurve(n.get_Par0(),r,u);return i=r.Value,t=u.Value,f}():(i=n.get_Par0(),t=n.get_Segment0()),Is(n.get_Segment1(),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor)?function(){var t={Value:u},i={Value:r},f=As(n.get_Segment1(),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor).GetSegmentAndParameter$$Double$$Double$$ICurve(n.get_Par1(),t,i);return u=t.Value,r=i.Value,f}():(u=n.get_Par1(),r=n.get_Segment1()),new Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor(i,u,n.get_IntersectionPoint(),t,r)},LiftIntersectionToCurves$$ICurve$$ICurve$$IntersectionInfo:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Curves.Curve.LiftIntersectionToCurves$$ICurve$$ICurve$$Double$$Double$$Point$$ICurve$$ICurve(n,t,i.get_Par0(),i.get_Par1(),i.get_IntersectionPoint(),i.get_Segment0(),i.get_Segment1())},LiftParameterToCurve:function(n,t,i){var r,u,f,e,o;if(n==i)return t;if(r=As(n,Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),r!=null)for(u=0,f=r.get_Segments().GetEnumerator();f.MoveNext();){if(e=f.get_Current(),e==i)return t+u;u+=Microsoft.Msagl.Core.Geometry.Curves.Curve.ParamSpan(e)}if(o=As(n,Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor),o!=null)return Microsoft.Msagl.Core.Geometry.Curves.Curve.LiftParameterToCurve(o.get_Curve(),t,i);throw $CreateException(new System.InvalidOperationException.ctor,new Error);},ParamSpan:function(n){return n.get_ParEnd()-n.get_ParStart()},GoDeeperOne:function(n,t){var u=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon,f,e,s,h,c,l;if(n.get_LeafBoxesOffset()>u&&t.get_LeafBoxesOffset()>u)return f=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSeg(n.get_Low(),n.get_High(),n.get_Seg(),n.get_LeafBoxesOffset()/2),e=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSeg(t.get_Low(),t.get_High(),t.get_Seg(),t.get_LeafBoxesOffset()/2),Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodesOne(f,e);if(n.get_LeafBoxesOffset()>u)return f=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSeg(n.get_Low(),n.get_High(),n.get_Seg(),n.get_LeafBoxesOffset()/2),Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodesOne(f,t);if(t.get_LeafBoxesOffset()>u)return e=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSeg(t.get_Low(),t.get_High(),t.get_Seg(),t.get_LeafBoxesOffset()/2),Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodesOne(n,e);if(s=n.get_Seg().get_Item$$Double(n.get_Low()),h=n.get_Seg().get_Item$$Double(n.get_High()),!Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(s,h)&&(c=t.get_Seg().get_Item$$Double(t.get_Low()),l=t.get_Seg().get_Item$$Double(t.get_High()),!Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(c,l))){var a=Is(n.get_Seg(),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor)?As(n.get_Seg(),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor):new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(s,h),v=Is(t.get_Seg(),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor)?As(t.get_Seg(),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor):new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(c,l),i,r,o,y=function(){var n={Value:i},t={Value:r},u={Value:o},f=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossWithinIntervalsWithGuess(a,v,0,1,0,1,.5,.5,n,t,u);return i=n.Value,r=t.Value,o=u.Value,f}();if(y)return function(){var u={Value:i},f={Value:r},e=Microsoft.Msagl.Core.Geometry.Curves.Curve.AdjustParameters(n,a,t,v,o,u,f);return i=u.Value,r=f.Value,e}(),Microsoft.Msagl.Core.Geometry.Curves.Curve.CreateIntersectionOne(n,t,i,r,o)}return null},GoDeeper:function(n,t,i){var f=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon,e,o,h,c,l,a;if(t.get_LeafBoxesOffset()>f&&i.get_LeafBoxesOffset()>f)e=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSeg(t.get_Low(),t.get_High(),t.get_Seg(),t.get_LeafBoxesOffset()/2),o=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSeg(i.get_Low(),i.get_High(),i.get_Seg(),i.get_LeafBoxesOffset()/2),Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodes(e,o,n);else if(t.get_LeafBoxesOffset()>f)e=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSeg(t.get_Low(),t.get_High(),t.get_Seg(),t.get_LeafBoxesOffset()/2),Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodes(e,i,n);else if(i.get_LeafBoxesOffset()>f)o=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSeg(i.get_Low(),i.get_High(),i.get_Seg(),i.get_LeafBoxesOffset()/2),Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveXWithParallelogramNodes(t,o,n);else if(h=t.get_Seg().get_Item$$Double(t.get_Low()),c=t.get_Seg().get_Item$$Double(t.get_High()),!Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(h,c)&&(l=i.get_Seg().get_Item$$Double(i.get_Low()),a=i.get_Seg().get_Item$$Double(i.get_High()),!Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(l,a))){var v=Is(t.get_Seg(),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor)?As(t.get_Seg(),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor):new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(h,c),y=Is(i.get_Seg(),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor)?As(i.get_Seg(),Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor):new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(l,a),r,u,s,p=function(){var n={Value:r},t={Value:u},i={Value:s},f=Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossWithinIntervalsWithGuess(v,y,0,1,0,1,.5,.5,n,t,i);return r=n.Value,u=t.Value,s=i.Value,f}();p&&(function(){var n={Value:r},f={Value:u},e=Microsoft.Msagl.Core.Geometry.Curves.Curve.AdjustParameters(t,v,i,y,s,n,f);return r=n.Value,u=f.Value,e}(),Microsoft.Msagl.Core.Geometry.Curves.Curve.AddIntersection(t,i,n.Value,r,u,s))}},AdjustParameters:function(n,t,i,r,u,f,e){f.Value=t!=n.get_Seg()&&Is(n.get_Seg(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)==!1?n.get_Seg().ClosestParameter(u):n.get_Low()+f.Value*(n.get_High()-n.get_Low());e.Value=r!=i.get_Seg()&&Is(i.get_Seg(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)==!1?i.get_Seg().ClosestParameter(u):i.get_Low()+e.Value*(i.get_High()-i.get_Low())},LineSegmentThreshold$$:"System.Double",get_LineSegmentThreshold:function(){return Microsoft.Msagl.Core.Geometry.Curves.Curve.lineSegThreshold},set_LineSegmentThreshold:function(n){Microsoft.Msagl.Core.Geometry.Curves.Curve.lineSegThreshold=n},CrossWithinIntervalsWithGuess:function(n,t,i,r,u,f,e,o,s,h,c){var y,l,a,v,p;return Is(n,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor)&&Is(t,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor)&&Microsoft.Msagl.Core.Geometry.Curves.Curve.CrossTwoLineSegs(n.get_Start(),n.get_End(),t.get_Start(),t.get_End(),i,r,u,f,s,h,c)?!0:(y=function(){var c={Value:l},v={Value:a},y=Microsoft.Msagl.Core.Geometry.Curves.Curve.MinDistWithinIntervals(n,t,i,r,u,f,e,o,s,h,c,v);return l=c.Value,a=v.Value,y}(),c.Value=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Addition(l,a)),v=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(l,a),p=y&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(v,v)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon*Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon,p)},CrossTwoLineSegs:function(n,t,i,r,u,f,e,o,s,h,c){var l=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),a=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r),v=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,n),y=Microsoft.Msagl.Core.Geometry.Curves.LinearSystem2.Solve(l.get_X(),a.get_X(),v.get_X(),l.get_Y(),a.get_Y(),v.get_Y(),s,h);return(c.Value=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(s.Value,l)),y)?s.Value<u-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?!1:(s.Value=System.Math.Max$$Double$$Double(s.Value,u),s.Value>f+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())?!1:(s.Value=System.Math.Min$$Double$$Double(s.Value,f),h.Value<e-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())?!1:(h.Value=System.Math.Max$$Double$$Double(h.Value,e),h.Value>o+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())?!1:(h.Value=System.Math.Min$$Double$$Double(h.Value,o),!0):!1},PointRelativeToCurveLocation:function(n,t){var i,f,o,s;if(System.Diagnostics.Debug.Assert$$Boolean(!System.Double.IsNaN(n.get_X())&&!System.Double.IsNaN(n.get_Y())),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"curve"),!t.get_BoundingBox().Contains$$Point(n))return Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside;var h=2*t.get_BoundingBox().get_Diagonal(),e=.0174532925199433,r=0;for(i=13;i<360;i+=13){var c=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Cos(i*e),System.Math.Sin(i*e)),l=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(n,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(h,c))),u=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(l,t,!0);if(Microsoft.Msagl.Core.Geometry.Curves.Curve.AllIntersectionsAreGood(u,t)){for(f=u.GetEnumerator();f.MoveNext();)if(o=f.get_Current(),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(o.get_IntersectionPoint(),n))return Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Boundary;if(s=u.get_Count()%2==1,s?r++:r--,r>=2)return Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside;if(r<=-2)return Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside}}return Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Boundary},AllIntersectionsAreGood:function(n,t){var i=As(t,Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),r,u,f;if(null==i&&(r=As(t,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),null!=r&&(i=r.ToCurve())),null!=i)for(u=n.GetEnumerator();u.MoveNext();)if(f=u.get_Current(),!Microsoft.Msagl.Core.Geometry.Curves.Curve.RealCut(Microsoft.Msagl.Core.Geometry.Curves.Curve.DropIntersectionToSegs(f),i,!1))return!1;return!0},RealCutWithClosedCurve:function(n,t,i){var e,s,r,f,o,c;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"xx");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"polygon");var a=n.get_Segment0(),u=n.get_Segment1(),v=n.get_Par0(),y=n.get_Par1(),l=n.get_IntersectionPoint(),h=a.Derivative(v).Normalize(),p=u.Derivative(y).Normalize().Rotate(1.5707963267949);if(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(l,u.get_End())){for(e=null,r=0;r<t.get_Segments().get_Count();r++)if(t.get_Segments().get_Item$$Int32(r)==u){e=t.get_Segments().get_Item$$Int32((r+1)%t.get_Segments().get_Count());break}if(e==null)throw $CreateException(new System.InvalidOperationException.ctor,new Error);return f=h.Rotate(1.5707963267949),o=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,u.Derivative(u.get_ParEnd()))*Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,e.Derivative(e.get_ParStart()))<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance(),!o}if(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(l,u.get_Start())){for(s=null,r=0;r<t.get_Segments().get_Count();r++)if(t.get_Segments().get_Item$$Int32(r)==u){s=t.get_Segments().get_Item$$Int32(r>0?r-1:t.get_Segments().get_Count()-1);break}return f=h.Rotate(1.5707963267949),o=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,u.Derivative(u.get_ParStart()))*Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,s.Derivative(s.get_ParEnd()))<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance(),!o}return(c=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(h,p),i)?c>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon:System.Math.Abs$$Double(c)>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon},RealCut:function(n,t,i){var e,o,r,f,s,c;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"xx");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"polyline");var a=n.get_Segment0(),u=n.get_Segment1(),v=n.get_Par0(),y=n.get_Par1(),l=n.get_IntersectionPoint(),h=a.Derivative(v).Normalize(),p=u.Derivative(y).Normalize().Rotate(1.5707963267949);if(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(l,u.get_End())){for(e=null,r=0;r<t.get_Segments().get_Count()-1;r++)if(t.get_Segments().get_Item$$Int32(r)==u){e=t.get_Segments().get_Item$$Int32(r+1);break}return e==null?!1:(f=h.Rotate(1.5707963267949),s=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,u.Derivative(u.get_ParEnd()))*Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,e.Derivative(e.get_ParStart()))<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance(),!s)}if(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(l,u.get_Start())){for(o=null,r=t.segs.get_Count()-1;r>0;r--)if(t.get_Segments().get_Item$$Int32(r)==u){o=t.get_Segments().get_Item$$Int32(r-1);break}return o==null?!1:(f=h.Rotate(1.5707963267949),s=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,u.Derivative(u.get_ParStart()))*Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(f,o.Derivative(o.get_ParEnd()))<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance(),!s)}return(c=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(h,p),i)?c>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon:System.Math.Abs$$Double(c)>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon},MinDistWithinIntervals:function(n,t,i,r,u,f,e,o,s,h,c,l){var a=new Microsoft.Msagl.Core.Geometry.Curves.MinDistCurveCurve.ctor(n,t,i,r,u,f,e,o);return a.Solve(),s.Value=a.get_ASolution(),c.Value=a.get_APoint(),h.Value=a.get_BSolution(),l.Value=a.get_BPoint(),a.get_Status()},AddLineSegment$$Curve$$Point$$Point:function(n,t,i){return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"curve"),n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t,i))},AddLineSegment$$Curve$$Double$$Double$$Double$$Double:function(n,t,i,r,u){Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Point$$Point(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,i),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r,u))},ContinueWithLineSegment$$Curve$$Double$$Double:function(n,t,i){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"c");Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Point$$Point(n,n.get_End(),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,i))},ContinueWithLineSegment$$Curve$$Point:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"c");Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Point$$Point(n,n.get_End(),t)},CloseCurve:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"curve");Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Point(n,n.get_Start())},ClosestParameterWithPoint:function(n,t,i){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"curve");var r=n.ClosestParameter(t);return i.Value=n.get_Item$$Double(r),r},ClosestPoint:function(n,t){return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"curve"),n.get_Item$$Double(n.ClosestParameter(t))},CurveIsInsideOther:function(n,t){if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"innerCurve"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"outerCurve"),!t.get_BoundingBox().Contains$$Rectangle(n.get_BoundingBox()))return!1;var i=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,t,!0);return i.get_Count()==0?Microsoft.Msagl.Core.Geometry.Curves.Curve.NonIntersectingCurveIsInsideOther(n,t):i.get_Count()==1?Microsoft.Msagl.Core.Geometry.Point.op_Inequality(n.get_Start(),i.get_Item$$Int32(0).get_IntersectionPoint())?Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n.get_Start(),t)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside:Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n.get_Item$$Double((n.get_ParStart()+n.get_ParEnd())/2),t)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside:System.Linq.Enumerable.All$1(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Curves.Curve.PointsBetweenIntersections(n,i),function(n){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n,t)!=Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside})},PointsBetweenIntersections:function(n,t){var u=[],i;for(System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo.ctor,System.Double.ctor,t,function(n){return n.get_Par0()}),i=0;i<t.get_Count()-1;i++)u.push(n.get_Item$$Double((t.get_Item$$Int32(i).get_Par0()+t.get_Item$$Int32(i+1).get_Par0())/2));var f=t.get_Item$$Int32(t.get_Count()-1).get_Par0(),e=t.get_Item$$Int32(0).get_Par0(),o=n.get_ParEnd()-f+e-n.get_ParStart(),r=f+o/2;return r>n.get_ParEnd()&&(r=n.get_ParStart()+r-n.get_ParEnd()),u.push(n.get_Item$$Double(r)),u},NonIntersectingCurveIsInsideOther:function(n,t){var i,r;for(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"a"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"b"),i=n.get_ParStart();i<n.get_ParEnd();i+=.5)if(r=Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n.get_Item$$Double(i),t),Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Boundary!=r)return Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside==r;return Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside!=Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n.get_End(),t)},ClosedCurveInteriorsIntersect:function(n,t){if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"curve1"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"curve2"),!t.get_BoundingBox().Intersects(n.get_BoundingBox()))return!1;var i=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,t,!0);return i.get_Count()==0?Microsoft.Msagl.Core.Geometry.Curves.Curve.NonIntersectingCurveIsInsideOther(n,t)||Microsoft.Msagl.Core.Geometry.Curves.Curve.NonIntersectingCurveIsInsideOther(t,n):i.get_Count()==1?Microsoft.Msagl.Core.Geometry.Point.op_Inequality(n.get_Start(),i.get_Item$$Int32(0).get_IntersectionPoint())?Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n.get_Start(),t)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside:Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n.get_Item$$Double((n.get_ParStart()+n.get_ParEnd())/2),t)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside||Microsoft.Msagl.Core.Geometry.Point.op_Inequality(t.get_Start(),i.get_Item$$Int32(0).get_IntersectionPoint())?Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t.get_Start(),n)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside:Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(t.get_Item$$Double((t.get_ParStart()+t.get_ParEnd())/2),n)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside:System.Linq.Enumerable.Any$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Core.Geometry.Curves.Curve.PointsBetweenIntersections(n,i),function(n){return Microsoft.Msagl.Core.Geometry.Curves.Curve.PointRelativeToCurveLocation(n,t)==Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside})},CurvesIntersect:function(n,t){return n==t||Microsoft.Msagl.Core.Geometry.Curves.Curve.CurveCurveIntersectionOne(n,t,!1)!=null},CreateBezierSeg$$Double$$Double$$Site$$Site$$Site:function(n,t,i,r,u){var f=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(n,i.get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1-n,r.get_Point())),e=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,u.get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1-t,r.get_Point())),o=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.666666666666667,r.get_Point());return new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(f,Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(f,3),o),Microsoft.Msagl.Core.Geometry.Point.op_Addition(o,Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(e,3)),e)},CreateBezierSeg$$Point$$Point$$Point$$Int32:function(n,t,i,r){var u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(i,r);return new Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor(n,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,u),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,u),t)},FindCorner:function(n,t,i){return(i.Value=null,t.Value=n.get_Next(),t.Value.get_Next()==null)?!1:(i.Value=t.Value.get_Next(),i.Value!=null)},TrimEdgeSplineWithNodeBoundaries:function(n,t,i,r){var u=i.get_ParStart(),f=i.get_ParEnd(),e,o;return n!=null&&function(){var t={Value:u},f=Microsoft.Msagl.Core.Geometry.Curves.Curve.FindNewStart(i,t,n,r);return u=t.Value,f}(),t!=null&&function(){var n={Value:f},u=Microsoft.Msagl.Core.Geometry.Curves.Curve.FindNewEnd(i,t,r,n);return f=n.Value,u}(),e=System.Math.Min$$Double$$Double(u,f),o=System.Math.Max$$Double$$Double(u,f),e<o?i.Trim(e,o):i},FindNewEnd:function(n,t,i,r){var f=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,t,!0),e,o,u;if(f.get_Count()==0){r.Value=n.get_ParEnd();return}if(i)for(r.Value=n.get_ParEnd(),e=f.GetEnumerator();e.MoveNext();)u=e.get_Current(),u.get_Par0()<r.Value&&(r.Value=u.get_Par0());else for(r.Value=n.get_ParStart(),o=f.GetEnumerator();o.MoveNext();)u=o.get_Current(),u.get_Par0()>r.Value&&(r.Value=u.get_Par0())},FindNewStart:function(n,t,i,r){var f=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(n,i,!0),e,o,u;if(f.get_Count()==0){t.Value=n.get_ParStart();return}if(r)for(t.Value=n.get_ParStart(),e=f.GetEnumerator();e.MoveNext();)u=e.get_Current(),u.get_Par0()>t.Value&&(t.Value=u.get_Par0());else for(t.Value=n.get_ParEnd(),o=f.GetEnumerator();o.MoveNext();)u=o.get_Current(),u.get_Par0()<t.Value&&(t.Value=u.get_Par0())},PolylineAroundClosedCurve:function(n){var t,f=As(n,Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor),r,i,u,e;if(f!=null)t=Microsoft.Msagl.Core.Geometry.Curves.Curve.RefineEllipse(f);else{if(r=As(n,Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor),r!=null)return r;if(i=As(n,Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),i!=null&&Microsoft.Msagl.Core.Geometry.Curves.Curve.AllSegsAreLines(i)){for(t=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,u=i.get_Segments().GetEnumerator();u.MoveNext();)e=u.get_Current(),t.AddPoint$$Point(e.get_Start());t.set_Closed(!0);t.IsClockwise()||(t=Cast(t.Reverse(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor))}else t=Microsoft.Msagl.Core.Geometry.Curves.Curve.StandardRectBoundary(n)}return t},AllSegsAreLines:function(n){for(var t=n.get_Segments().GetEnumerator(),i;t.MoveNext();)if(i=t.get_Current(),!Is(i,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor))return!1;return!0},RefineEllipse:function(n){for(var r,c=Microsoft.Msagl.Core.Geometry.Curves.Curve.StandardRectBoundary(n),t=new System.Collections.Generic.SortedDictionary$2.ctor(System.Double.ctor,Microsoft.Msagl.Core.Geometry.Point.ctor),u=n.get_BoundingBox().get_Width(),f=n.get_BoundingBox().get_Height(),l=System.Math.Sqrt(u*u+f*f),i=0;i<4;i++)for(var e=.785398163397448+i*3.14159265358979/2,o=n.get_Item$$Double(e),s=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(l,n.Derivative(e).Normalize()),a=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(o,s),Microsoft.Msagl.Core.Geometry.Point.op_Addition(o,s)),h=Microsoft.Msagl.Core.Geometry.Curves.Curve.GetAllIntersections(c,a,!0).GetEnumerator();h.MoveNext();)r=h.get_Current(),t.set_Item$$TKey(r.get_Par0(),r.get_IntersectionPoint());return System.Diagnostics.Debug.Assert$$Boolean(t.get_Count()>0),function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(t.get_Values());return n.set_Closed(!0),n}()},StandardRectBoundary:function(n){var t=n.get_BoundingBox();return t.Perimeter()},PolyFromBox:function(n){var t=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor;return t.AddPoint$$Point(n.get_LeftTop()),t.AddPoint$$Point(n.get_RightTop()),t.AddPoint$$Point(n.get_RightBottom()),t.AddPoint$$Point(n.get_LeftBottom()),t.set_Closed(!0),t},LengthWithInterpolation:function(n){for(var t=0,i=Microsoft.Msagl.Core.Geometry.Curves.Curve.Interpolate$$ICurve$$Double(n,Microsoft.Msagl.Core.Geometry.Curves.Curve.lineSegThreshold).GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t+=r.get_Length();return t},LengthWithInterpolationAndThreshold:function(n,t){for(var i=0,r=Microsoft.Msagl.Core.Geometry.Curves.Curve.Interpolate$$ICurve$$Double(n,t).GetEnumerator(),u;r.MoveNext();)u=r.get_Current(),i+=u.get_Length();return i}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Geometry.Curves.ICurve"],Kind:"Class",definition:{ctor:function(){this.pBNode=null;this.segs=null;this.parStart=0;this.parEnd=0;System.Object.ctor.call(this);this.segs=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor)},Reverse:function(){for(var t=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$Int32(this.segs.get_Count()),n=this.segs.get_Count()-1;n>=0;n--)t.AddSegment(this.segs.get_Item$$Int32(n).Reverse());return t},ctor$$Int32:function(n){this.pBNode=null;this.segs=null;this.parStart=0;this.parEnd=0;System.Object.ctor.call(this);this.segs=new System.Collections.Generic.List$1.ctor$$Int32(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,n)},ctor$$List$1$ICurve:function(n){var t,i;for(this.pBNode=null,this.segs=null,this.parStart=0,this.parEnd=0,System.Object.ctor.call(this),this.segs=n,this.set_ParStart(0),t=n.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.set_ParEnd(this.get_ParEnd()+i.get_ParEnd()-i.get_ParStart())},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.segs.get_Item$$Int32(0).get_Start()},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.segs.get_Item$$Int32(this.segs.get_Count()-1).get_End()},Trim:function(n,t){var i,f,r,e,u,o;if(function(){var i={Value:n},r={Value:t},u=this.AdjustStartEndEndParametersToDomain(i,r);return n=i.Value,t=r.Value,u}.call(this),function(){var t={Value:f},r={Value:i},u=this.GetSegmentAndParameter$$Double$$Double$$Int32(n,t,r);return f=t.Value,i=r.Value,u}.call(this),function(){var n={Value:e},i={Value:r},u=this.GetSegmentAndParameter$$Double$$Double$$Int32(t,n,i);return e=n.Value,r=i.Value,u}.call(this),i==r)return this.get_Segments().get_Item$$Int32(i).Trim(f,e);for(u=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$Int32(r-i+1),f<this.get_Segments().get_Item$$Int32(i).get_ParEnd()&&(u=u.AddSegment(this.get_Segments().get_Item$$Int32(i).Trim(f,this.get_Segments().get_Item$$Int32(i).get_ParEnd()))),o=i+1;o<r;o++)u=u.AddSegment(this.get_Segments().get_Item$$Int32(o));return this.get_Segments().get_Item$$Int32(r).get_ParStart()<e&&(u=u.AddSegment(this.get_Segments().get_Item$$Int32(r).Trim(this.get_Segments().get_Item$$Int32(r).get_ParStart(),e))),u},AdjustStartEndEndParametersToDomain:function(n,t){if(n.Value>t.Value){var i=n.Value;n.Value=t.Value;t.Value=i}n.Value<this.get_ParStart()&&(n.Value=this.get_ParStart());t.Value>this.get_ParEnd()&&(t.Value=this.get_ParEnd())},TrimWithWrap:function(n,t){if(System.Diagnostics.Debug.Assert$$Boolean(n>=this.get_ParStart()&&n<=this.get_ParEnd()),System.Diagnostics.Debug.Assert$$Boolean(t>=this.get_ParStart()&&t<=this.get_ParEnd()),n<t)return As(this.Trim(n,t),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor);System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(this.get_Start(),this.get_End()),"Curve must be closed to wrap");var i=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor;return i.AddSegment(As(this.Trim(n,this.get_ParEnd()),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor)),i.AddSegment(As(this.Trim(this.get_ParStart(),t),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor)),i},AddSegment:function(n){var t,r,i;if(n==null)return this;if(this.set_ParStart(0),t=As(n,Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),t==null)this.segs.Add(n),this.set_ParEnd(this.get_ParEnd()+n.get_ParEnd()-n.get_ParStart());else for(this.IncreaseSegmentCapacity(t.get_Segments().get_Count()),r=t.get_Segments().GetEnumerator();r.MoveNext();)i=r.get_Current(),this.segs.Add(i),this.set_ParEnd(this.get_ParEnd()+i.get_ParEnd()-i.get_ParStart());return this},IncreaseSegmentCapacity:function(n){var i=this.segs.get_Count()+n,t;if(this.segs.get_Capacity()<i){for(t=System.Math.Max$$Int32$$Int32(this.segs.get_Capacity(),1);t<i;)t*=2;this.segs.set_Capacity(t)}},AddSegs$$ICurve$$ICurve:function(n,t){var i=this.AddSegment(n);return i.AddSegment(t)},AddSegs$$ICurve$$ICurve$$ICurve$$ICurve:function(n,t,i,r){this.IncreaseSegmentCapacity(4);var u=this.AddSegment(n);return u=u.AddSegment(t),u=u.AddSegment(i),u.AddSegment(r)},Segments$$:"System.Collections.Generic.IList`1[[Microsoft.Msagl.Core.Geometry.Curves.ICurve]]",get_Segments:function(){return this.segs},ParallelogramNodeOverICurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve",get_ParallelogramNodeOverICurve:function(){var n,t,r,i;if(this.pBNode!=null)return this.pBNode;for(this.pBNode=new Microsoft.Msagl.Core.Geometry.Curves.ParallelogramInternalTreeNode.ctor(this,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DefaultLeafBoxesOffset),n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor),t=this.segs.GetEnumerator();t.MoveNext();)r=t.get_Current(),i=r.get_ParallelogramNodeOverICurve(),n.Add(i.get_Parallelogram()),this.pBNode.AddChild(i);return this.pBNode.set_Parallelogram(Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.GetParallelogramOfAGroup(n)),this.pBNode},GetSegmentAndParameter$$Double$$Double$$ICurve:function(n,t,i){for(var u=this.get_ParStart(),e=this.segs.GetEnumerator(),r,f;e.MoveNext();){if(r=e.get_Current(),f=r.get_ParEnd()-r.get_ParStart(),n>=u&&n<=u+f){t.Value=n-u+r.get_ParStart();i.Value=r;return}u+=f}i.Value=System.Linq.Enumerable.Last$1$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.ICurve.ctor,this.segs);t.Value=i.Value.get_ParEnd()},GetSegmentAndParameter$$Double$$Double$$Int32:function(n,t,i){var r=0,u,f,e;for(i.Value=0,t.Value=-1,u=0;u<this.segs.get_Count();u++){if(f=this.segs.get_Item$$Int32(u),e=f.get_ParEnd()-f.get_ParStart(),n>=r&&(n<=r+e||u==this.segs.get_Count()-1&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Compare(n,r+e)<=0)){t.Value=n-r+f.get_ParStart();return}i.Value++;r+=e}throw $CreateException(new System.InvalidOperationException.ctor$$String(System.String.Format$$String$$Object$Array("Check, args t:{0}, par:{1}, segIndex:{2} and u:{3}",[n,t.Value,i.Value,r])),new Error);},Item$$:"Microsoft.Msagl.Core.Geometry.Point",get_Item$$Double:function(n){var t,i;return function(){var r={Value:t},u={Value:i},f=this.GetSegmentAndParameter$$Double$$Double$$ICurve(n,r,u);return t=r.Value,i=u.Value,f}.call(this),i.get_Item$$Double(t)},Derivative:function(n){var t,i;return function(){var r={Value:t},u={Value:i},f=this.GetSegmentAndParameter$$Double$$Double$$ICurve(n,r,u);return t=r.Value,i=u.Value,f}.call(this),i.Derivative(t)},SecondDerivative:function(n){var t,i;return function(){var r={Value:t},u={Value:i},f=this.GetSegmentAndParameter$$Double$$Double$$ICurve(n,r,u);return t=r.Value,i=u.Value,f}.call(this),i.SecondDerivative(t)},ThirdDerivative:function(n){var t,i;return function(){var r={Value:t},u={Value:i},f=this.GetSegmentAndParameter$$Double$$Double$$ICurve(n,r,u);return t=r.Value,i=u.Value,f}.call(this),i.ThirdDerivative(t)},OffsetCurve:function(){return null},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){var t,n;if(this.get_Segments().get_Count()==0)return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(0,0,-1,-1);for(t=this.get_Segments().get_Item$$Int32(0).get_BoundingBox().Clone(),n=1;n<this.get_Segments().get_Count();n++)t.Add$$Rectangle(this.get_Segments().get_Item$$Int32(n).get_BoundingBox());return t},Clone:function(){for(var n=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$Int32(this.get_Segments().get_Count()),t=this.get_Segments().GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n.AddSegment(i.Clone());return n},GetParameterAtLength:function(n){for(var r=0,u=this.get_Segments().GetEnumerator(),t,i;u.MoveNext();){if(t=u.get_Current(),i=t.get_Length(),i>=n)return r+t.GetParameterAtLength(n);n-=i;r+=t.get_ParEnd()-t.get_ParStart()}return this.get_ParEnd()},ClosestParameterWithinBounds:function(n,t,i){for(var s=0,h=1.79769313486232E+308,u=0,c=this.get_Segments().GetEnumerator(),r,f,l,e,o;c.MoveNext();){if(r=c.get_Current(),u>i)break;if(f=Microsoft.Msagl.Core.Geometry.Curves.Curve.ParamSpan(r),l=u+f,l>=t){e=System.Math.Max$$Double$$Double(r.get_ParStart(),r.get_ParStart()+(t-u));o=System.Math.Min$$Double$$Double(r.get_ParEnd(),r.get_ParStart()+(i-u));System.Diagnostics.Debug.Assert$$Boolean(o>=e);var a=r.ClosestParameterWithinBounds(n,e,o),v=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,r.get_Item$$Double(a)),y=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(v,v);y<h&&(s=u+a-r.get_ParStart(),h=y)}u+=f}return s},ClosestParameter:function(n){for(var i=0,r=1.79769313486232E+308,u=0,f=this.get_Segments().GetEnumerator();f.MoveNext();){var t=f.get_Current(),e=t.ClosestParameter(n),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t.get_Item$$Double(e)),s=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(o,o);s<r&&(i=u+e-t.get_ParStart(),r=s);u+=Microsoft.Msagl.Core.Geometry.Curves.Curve.ParamSpan(t)}return i},LeftDerivative:function(n){var t=this.TryToGetLeftSegment(n);return t!=null?t.Derivative(t.get_ParEnd()):this.Derivative(n)},RightDerivative:function(n){var t=this.TryToGetRightSegment(n);return t!=null?t.Derivative(t.get_ParStart()):this.Derivative(n)},TryToGetLeftSegment:function(n){var t,i;if(System.Math.Abs$$Double(n-this.get_ParStart())<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())return Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.get_Start(),this.get_End())?this.get_Segments().get_Item$$Int32(this.get_Segments().get_Count()-1):null;for(t=this.get_Segments().GetEnumerator();t.MoveNext();)if(i=t.get_Current(),n-=Microsoft.Msagl.Core.Geometry.Curves.Curve.ParamSpan(i),System.Math.Abs$$Double(n)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())return i;return null},TryToGetRightSegment:function(n){var t,i;if(System.Math.Abs$$Double(n-this.get_ParEnd())<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())return Microsoft.Msagl.Core.Geometry.Point.op_Equality(this.get_Start(),this.get_End())?this.get_Segments().get_Item$$Int32(0):null;for(t=this.get_Segments().GetEnumerator();t.MoveNext();){if(i=t.get_Current(),System.Math.Abs$$Double(n)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())return i;n-=Microsoft.Msagl.Core.Geometry.Curves.Curve.ParamSpan(i)}return null},Curvature:function(n){var t,i;return function(){var r={Value:i},u={Value:t},f=this.GetSegmentAndParameter$$Double$$Double$$ICurve(n,r,u);return i=r.Value,t=u.Value,f}.call(this),t.Curvature(i)},CurvatureDerivative:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},CurvatureSecondDerivative:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},ParStart$$:"System.Double",get_ParStart:function(){return this.parStart},set_ParStart:function(n){this.parStart=n},ParEnd$$:"System.Double",get_ParEnd:function(){return this.parEnd},set_ParEnd:function(n){this.parEnd=n},Translate:function(n){for(var t=this.segs.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),i.Translate(n);this.pBNode=null},ScaleFromOrigin:function(n,t){for(var i=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$Int32(this.segs.get_Count()),r=this.segs.GetEnumerator(),u;r.MoveNext();)u=r.get_Current(),i.AddSegment(u.ScaleFromOrigin(n,t));return i},Transform:function(n){for(var t=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$Int32(this.segs.get_Count()),i=this.segs.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.AddSegment(r.Transform(n));return t},LengthPartial:function(n,t){var e,o,r,u,i,s,f;for(function(){var i={Value:n},r={Value:t},u=this.AdjustStartEndEndParametersToDomain(i,r);return n=i.Value,t=r.Value,u}.call(this),function(){var t={Value:e},i={Value:r},u=this.GetSegmentAndParameter$$Double$$Double$$Int32(n,t,i);return e=t.Value,r=i.Value,u}.call(this),function(){var n={Value:o},i={Value:u},r=this.GetSegmentAndParameter$$Double$$Double$$Int32(t,n,i);return o=n.Value,u=i.Value,r}.call(this),i=this.segs.get_Item$$Int32(r),s=i.LengthPartial(e,i.get_ParEnd()),f=r+1;f<u;f++)s+=this.segs.get_Item$$Int32(f).get_Length();return i=this.segs.get_Item$$Int32(u),s+i.LengthPartial(i.get_ParStart(),o)},Length$$:"System.Double",get_Length:function(){for(var n=0,t=this.segs.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n+=i.get_Length();return n}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$Curve);Microsoft$Msagl$Core$Geometry$Curves$CurveFactory={fullname:"Microsoft.Msagl.Core.Geometry.Curves.CurveFactory",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.octagonPad=.25},CreateEllipse:function(n,t,i){return new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point(n,t,i)},CreateCircle:function(n,t){return new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point(n,n,t)},CreateRectangleWithRoundedCorners$$Double$$Double$$Double$$Double$$Point:function(n,t,i,r,u){var f=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(u.get_X()-n/2,u.get_Y()-t/2,u.get_X()+n/2,u.get_Y()+t/2);return new Microsoft.Msagl.Core.Geometry.Curves.RoundedRect.ctor$$Rectangle$$Double$$Double(f,i,r)},CreateRectangleWithRoundedCorners$$Curve$$Double$$Double$$Double$$Double$$Point:function(n,t,i,r,u,f){var c,l;if(r==0||u==0){Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRectangle$$Curve$$Double$$Double$$Point(n,t,i,f);return}c=t/2;r>c/2&&(r=c/2);l=i/2;u>l/2&&(u=l/2);var e=f.get_X(),o=f.get_Y(),s=c-r,h=l-u,y=o+l,p=o-l,w=e-c,b=e+c,a=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r,0),v=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,u);n.IncreaseSegmentCapacity(8);s>0&&n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e-s,p),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e+s,p)));n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Double$$Double(4.71238898038469,6.28318530717959,a,v,e+s,o-h));h>0&&n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(b,o-h),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(b,o+h)));n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Double$$Double(0,1.5707963267949,a,v,e+s,o+h));s>0&&n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e+s,y),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e-s,y)));n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Double$$Double(1.5707963267949,3.14159265358979,a,v,e-s,o+h));h>0&&n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(w,o+h),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(w,o-h)));n.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Double$$Double(3.14159265358979,4.71238898038469,a,v,e-s,o-h))},CreateRectangle$$Double$$Double$$Point:function(n,t,i){var u=n/2,f=t/2,e=i.get_X(),o=i.get_Y(),s=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,r=[new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e-u,o-f),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e+u,o-f),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e+u,o+f),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e-u,o+f)];return s.AddSegs$$ICurve$$ICurve$$ICurve$$ICurve(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r[0],r[1]),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r[1],r[2]),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r[2],r[3]),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r[3],r[0])),s},CreateRectangle$$Curve$$Double$$Double$$Point:function(n,t,i,r){var f=t/2,e=i/2,o=r.get_X(),s=r.get_Y(),u=[new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(o-f,s-e),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(o+f,s-e),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(o+f,s+e),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(o-f,s+e)];n.AddSegs$$ICurve$$ICurve$$ICurve$$ICurve(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u[0],u[1]),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u[1],u[2]),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u[2],u[3]),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u[3],u[0]))},CreateRectangle$$Rectangle:function(n){return Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateRectangle$$Double$$Double$$Point(n.get_Width(),n.get_Height(),n.get_Center())},CreateHouse:function(n,t,i){var o=n/2,u=t/2,f=i.get_X(),e=i.get_Y(),r=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$Int32(4);return Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Double$$Double$$Double$$Double(r,f-o,e-u,f+o,e-u),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(r,f+o,e+u),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(r,f,e+2*u),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(r,f-o,e+u),Microsoft.Msagl.Core.Geometry.Curves.Curve.CloseCurve(r),r},CreateInteriorHouse:function(n,t,i){var e=n/2,o=t/2,u=i.get_X(),f=i.get_Y(),r=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$Int32(4);return Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Double$$Double$$Double$$Double(r,u-e,f-o,u+e,f-o),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(r,u+e,f),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(r,u,f+o),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(r,u-e,f),Microsoft.Msagl.Core.Geometry.Curves.Curve.CloseCurve(r),r},CreateInvertedHouse:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateHouse(n,t,i);return Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.RotateCurveAroundCenterByDegree(r,i,180)},CreateDiamond:function(n,t,i){var e=n,o=t,u=i.get_X(),f=i.get_Y(),s=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,r=[new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,f-o),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u+e,f),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,f+o),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u-e,f)];return s.AddSegs$$ICurve$$ICurve$$ICurve$$ICurve(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r[0],r[1]),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r[1],r[2]),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r[2],r[3]),new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r[3],r[0])),s},CreateInteriorDiamond:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateDiamond(n/2,t/2,i)},CreateOctagon:function(n,t,i){var f=n/2,e=t/2,r=new Array(8),u;for(r[0]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(f+Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.octagonPad*f,e-e*Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.octagonPad),r[3]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-r[0].get_X(),r[0].get_Y()),r[4]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r[3].get_X(),-r[3].get_Y()),r[7]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r[0].get_X(),-r[0].get_Y()),r[1]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(f-f*Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.octagonPad,e+e*Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.octagonPad),r[2]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-r[1].get_X(),r[1].get_Y()),r[6]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r[1].get_X(),-r[1].get_Y()),r[5]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(r[2].get_X(),-r[2].get_Y()),u=0;u<8;u++)r[u]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(r[u],i);return function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$Point$Array(r);return n.set_Closed(!0),n}()},CreateHexagon:function(n,t,i){var e=n/2,u=new Array(6),f,r;for(u[0]=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,0),r=1;r<6;r++)u[r]=u[r-1].Rotate(1.0471975511966);for(f=t/n,r=0;r<6;r++)u[r].set_Y(u[r].get_Y()*f);for(r=0;r<6;r++)u[r]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(u[r],i);return function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$Point$Array(u);return n.set_Closed(!0),n}()},CreateInteriorOctagon:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.CreateOctagon(n/(1+Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.octagonPad),t/(1+Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.octagonPad),i)},CreateTestShape:function(n,t){var r=n*3,u=t*3,i=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$Int32(9);return Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Double$$Double$$Double$$Double(i,-r,-u,0,-u/2),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(i,r/2,-.75*u),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(i,r,-u),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(i,.75*r,-u/2),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(i,r/2,0),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(i,r,u),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(i,0,u/2),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(i,-r,1*u),Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Double$$Double(i,-r/3,0),Microsoft.Msagl.Core.Geometry.Curves.Curve.CloseCurve(i),i},CreateInteriorTriangle:function(n,t,i){var s=n/2,f=t/2,e=i.get_X(),o=i.get_Y(),u=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor$$Int32(3),r=[new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e-s,o-f),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e+s,o-f),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(e,o+f)];return u.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r[0],r[1])),u.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r[1],r[2])),u.AddSegment(new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(r[2],r[0])),u},RotateCurveAroundCenterByRadian:function(n,t,i){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"curve");var r=System.Math.Cos(i),u=System.Math.Sin(i),f=Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$PlaneTransformation(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$PlaneTransformation(new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(1,0,t.get_X(),0,1,t.get_Y()),new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(r,-u,0,u,r,0)),new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(1,0,-t.get_X(),0,1,-t.get_Y()));return n.Transform(f)},RotateCurveAroundCenterByDegree:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.RotateCurveAroundCenterByRadian(n,t,i*.0174532925199433)},CreateStar:function(n,t){var i=1.25663706143592,r=n/(2*System.Math.Sin(i)),u=r/2;return function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point(Microsoft.Msagl.Core.Geometry.Curves.CurveFactory.StarPoints(u,r,t,i));return n.set_Closed(!0),n}()},StarPoints:function(n,t,i,r){for(var f=[],u=1.5707963267949,e=r/2,o=0;o<5;o++)f.push(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Cos(u),System.Math.Sin(u))))),f.push(Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Cos(u+e),System.Math.Sin(u+e))))),u+=r;return f},CreateRegularPolygon:function(n,t,i){for(var u=new Array(n),f=6.28318530717959/n,r=0;r<n;r++)u[r]=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Cos(r*f),System.Math.Sin(r*f))),t);return function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$Point$Array(u);return n.set_Closed(!0),n}()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$CurveFactory);Microsoft$Msagl$Core$Geometry$Curves$CurveTangent={fullname:"Microsoft.Msagl.Core.Geometry.Curves.CurveTangent",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.touchPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.direction=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.touchPoint=n;this.direction=t}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$CurveTangent);Microsoft$Msagl$Core$Geometry$Curves$Ellipse={fullname:"Microsoft.Msagl.Core.Geometry.Curves.Ellipse",baseTypeName:"System.Object",staticDefinition:{CreateNodeWithSegmentSplit:function(n,t,i,r){var u=new Microsoft.Msagl.Core.Geometry.Curves.ParallelogramInternalTreeNode.ctor(i,r),f;return u.AddChild(Microsoft.Msagl.Core.Geometry.Curves.Ellipse.CreateParallelogramNodeForCurveSeg$$Double$$Double$$Ellipse$$Double(n,.5*(n+t),i,r)),u.AddChild(Microsoft.Msagl.Core.Geometry.Curves.Ellipse.CreateParallelogramNodeForCurveSeg$$Double$$Double$$Ellipse$$Double(.5*(n+t),t,i,r)),f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor),f.Add(u.get_Children().get_Item$$Int32(0).get_Parallelogram()),f.Add(u.get_Children().get_Item$$Int32(1).get_Parallelogram()),u.set_Parallelogram(Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.GetParallelogramOfAGroup(f)),u},CreateParallelogramNodeForCurveSeg$$Double$$Double$$Ellipse$$Double:function(n,t,i,r){var l=n==i.get_ParStart()&&t==i.get_ParEnd()&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(i.get_Start(),i.get_End()),s,u,c,f;if(l)return Microsoft.Msagl.Core.Geometry.Curves.Ellipse.CreateNodeWithSegmentSplit(n,t,i,r);var e=i.get_Item$$Double(n),o=i.get_Item$$Double(t),h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(o,e),a=i.get_Item$$Double((n+t)/2);return Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DistToSegm(a,e,o)<=Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(h,h)<Microsoft.Msagl.Core.Geometry.Curves.Curve.get_LineSegmentThreshold()*Microsoft.Msagl.Core.Geometry.Curves.Curve.get_LineSegmentThreshold()&&t-n<Microsoft.Msagl.Core.Geometry.Curves.Curve.get_LineSegmentThreshold()?(s=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(e,o),u=As(s.get_ParallelogramNodeOverICurve(),Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf.ctor),u.set_Low(n),u.set_High(t),u.set_Seg(i),u.set_Chord(s),u):(c=Microsoft.Msagl.Core.Geometry.Curves.Ellipse.WithinEpsilon(i,n,t,r),f=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor,c&&function(){var r={Value:f},u=Microsoft.Msagl.Core.Geometry.Curves.Ellipse.CreateParallelogramOnSubSeg(n,t,i,r);return f=r.Value,u}()?new Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf.ctor(n,t,f,i,r):Microsoft.Msagl.Core.Geometry.Curves.Ellipse.CreateNodeWithSegmentSplit(n,t,i,r))},CreateParallelogramOnSubSeg:function(n,t,i,r){var u=i.Derivative(n),o=i.Derivative(t),s=Microsoft.Msagl.Core.Geometry.Point.P(-o.get_Y(),o.get_X()),f=i.get_Item$$Double(n),h=i.get_Item$$Double(t),a=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h,f),c=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(a,s),l=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,s),e;if(System.Math.Abs$$Double(c)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)e=0;else{if(System.Math.Abs$$Double(l)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return!1;e=c/l}return u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(u,e),r.Value=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Point$$Point$$Point(f,u,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h,f),u)),!0},WithinEpsilon:function(n,t,i,r){var u=3,f=(i-t)/u,e=n.get_Item$$Double(t),o=n.get_Item$$Double(i),h=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DistToSegm(n.get_Item$$Double(t+f),e,o),s;return h>r?!1:(s=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DistToSegm(n.get_Item$$Double(t+f*(u-1)),e,o),s<=r)},CreateParallelogramNodeForCurveSeg$$Ellipse:function(n){return Microsoft.Msagl.Core.Geometry.Curves.Ellipse.CreateParallelogramNodeForCurveSeg$$Double$$Double$$Ellipse$$Double(n.get_ParStart(),n.get_ParEnd(),n,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DefaultLeafBoxesOffset)}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Geometry.Curves.ICurve"],Kind:"Class",definition:{ctor$$Double$$Double$$Point$$Point$$Point:function(n,t,i,r,u){this.box=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.parallelogramNodeOverICurve=null;this.aAxis=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bAxis=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.center=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.parStart=0;this.parEnd=0;System.Object.ctor.call(this);System.Diagnostics.Debug.Assert$$Boolean(n<=t);this.set_ParStart(n);this.set_ParEnd(t);this.set_AxisA(i);this.set_AxisB(r);this.center=u;this.SetBoundingBox()},OffsetCurve:function(n,t){var u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,this.center),f=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point(this.aAxis,u),e=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(this.aAxis,System.Math.Cos(f)),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(this.bAxis,System.Math.Sin(f))),i,r;return e.get_Length()<u.get_Length()?(i=this.aAxis.get_Length(),r=this.bAxis.get_Length(),new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Point$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i+n,this.aAxis.Normalize()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(r+n,this.bAxis.Normalize()),this.center)):(i=this.aAxis.get_Length(),r=this.bAxis.get_Length(),new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Point$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i-n,this.aAxis.Normalize()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(r-n,this.bAxis.Normalize()),this.center))},Reverse:function(){return null},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.get_Item$$Double(this.get_ParStart())},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.get_Item$$Double(this.get_ParEnd())},Trim:function(n,t){return System.Diagnostics.Debug.Assert$$Boolean(n<=t),System.Diagnostics.Debug.Assert$$Boolean(n>=this.get_ParStart()-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()),System.Diagnostics.Debug.Assert$$Boolean(t<=this.get_ParEnd()+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()),new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Point(System.Math.Max$$Double$$Double(n,this.get_ParStart()),System.Math.Min$$Double$$Double(t,this.get_ParEnd()),this.get_AxisA(),this.get_AxisB(),this.center)},TrimWithWrap:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},AxisA$$:"Microsoft.Msagl.Core.Geometry.Point",get_AxisA:function(){return this.aAxis},set_AxisA:function(n){this.aAxis=n},AxisB$$:"Microsoft.Msagl.Core.Geometry.Point",get_AxisB:function(){return this.bAxis},set_AxisB:function(n){this.bAxis=n},Center$$:"Microsoft.Msagl.Core.Geometry.Point",get_Center:function(){return this.center},set_Center:function(n){this.center=n},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){return this.box},Item$$:"Microsoft.Msagl.Core.Geometry.Point",get_Item$$Double:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.center,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(System.Math.Cos(n),this.aAxis)),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(System.Math.Sin(n),this.bAxis))},Derivative:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(-System.Math.Sin(n),this.aAxis),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(System.Math.Cos(n),this.bAxis))},SecondDerivative:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(-System.Math.Cos(n),this.aAxis),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(System.Math.Sin(n),this.bAxis))},ThirdDerivative:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(System.Math.Sin(n),this.aAxis),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(System.Math.Cos(n),this.bAxis))},ParallelogramNodeOverICurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve",get_ParallelogramNodeOverICurve:function(){return this.parallelogramNodeOverICurve!=null?this.parallelogramNodeOverICurve:this.parallelogramNodeOverICurve=Microsoft.Msagl.Core.Geometry.Curves.Ellipse.CreateParallelogramNodeForCurveSeg$$Ellipse(this)},ParStart$$:"System.Double",get_ParStart:function(){return this.parStart},set_ParStart:function(n){this.parStart=n},ParEnd$$:"System.Double",get_ParEnd:function(){return this.parEnd},set_ParEnd:function(n){this.parEnd=n},SetBoundingBox:function(){var n,t;if(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(this.get_ParStart(),0)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(this.get_ParEnd(),6.28318530717959))this.box=this.FullBox();else for(this.box=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(this.get_Start(),this.get_End()),t=System.Math.Ceiling$$Double(this.get_ParStart()/1.5707963267949)|0;(n=t*3.14159265358979/2)<this.get_ParEnd();t++)n>this.parStart&&this.box.Add$$Point(this.get_Item$$Double(n))},ctor$$Double$$Double$$Point$$Point$$Double$$Double:function(n,t,i,r,u,f){this.box=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.parallelogramNodeOverICurve=null;this.aAxis=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bAxis=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.center=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.parStart=0;this.parEnd=0;Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Point.call(this,n,t,i,r,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u,f))},ctor$$Point$$Point$$Point:function(n,t,i){this.box=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.parallelogramNodeOverICurve=null;this.aAxis=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bAxis=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.center=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.parStart=0;this.parEnd=0;Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Point.call(this,0,6.28318530717959,n,t,i)},ctor$$Double$$Double$$Point:function(n,t,i){this.box=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.parallelogramNodeOverICurve=null;this.aAxis=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bAxis=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.center=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.parStart=0;this.parEnd=0;Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Point.call(this,0,6.28318530717959,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,0),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,t),i)},Translate:function(n){this.center=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.center,n);this.box=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.center,this.bAxis),this.aAxis),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.center,this.bAxis),this.aAxis));this.parallelogramNodeOverICurve=null},ScaleFromOrigin:function(n,t){return new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Point(this.parStart,this.parEnd,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(this.aAxis,n),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(this.bAxis,t),Microsoft.Msagl.Core.Geometry.Point.Scale(n,t,this.center))},GetParameterAtLength:function(n){for(var f=.001,i=this.get_ParStart(),r=this.get_ParEnd(),e=n+f,o=n-f,t,u;r-i>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon;)if(t=.5*(r+i),u=this.LengthPartial(this.get_ParStart(),t),u>e)r=t;else if(u<o)i=t;else return t;return(r+i)/2},Transform:function(n){if(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Inequality(n,null)){var t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,this.aAxis),n.get_Offset()),i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,this.bAxis),n.get_Offset());return new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Point(this.parStart,this.parEnd,t,i,Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,this.center))}return this},ClosestParameterWithinBounds:function(n,t,i){for(var r,c=(i-t)/9,u=t,e=1.79769313486232E+308,f=0;f<=8;f++){var o=t+f*c,s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,this.get_Item$$Double(o)),h=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(s,s);h<e&&(e=h,u=o)}return u==0&&i==6.28318530717959&&(t=-3.14159265358979),r=Microsoft.Msagl.Core.Geometry.Curves.ClosestPointOnCurve.ClosestPoint(this,n,u,t,i),r<0&&(r+=6.28318530717959),r},LengthPartial:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.Curve.LengthWithInterpolationAndThreshold(this.Trim(n,t),Microsoft.Msagl.Core.Geometry.Curves.Curve.get_LineSegmentThreshold()/100)},Length$$:"System.Double",get_Length:function(){return Microsoft.Msagl.Core.Geometry.Curves.Curve.LengthWithInterpolation(this)},Clone:function(){return new Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor$$Double$$Double$$Point$$Point$$Point(this.parStart,this.parEnd,this.aAxis,this.bAxis,this.center)},ClosestParameter:function(n){for(var u,t,f=0,c=(this.get_ParEnd()-this.get_ParStart())/9,i=this.get_ParStart(),e=1.79769313486232E+308,r=0;r<=8;r++){var o=this.get_ParStart()+r*c,s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,this.get_Item$$Double(o)),h=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(s,s);h<e&&(e=h,i=o)}return u=!1,i==0&&this.get_ParEnd()==6.28318530717959&&(u=!0,f=this.get_ParStart(),this.set_ParStart(-3.14159265358979)),t=Microsoft.Msagl.Core.Geometry.Curves.ClosestPointOnCurve.ClosestPoint(this,n,i,this.get_ParStart(),this.get_ParEnd()),t<0&&(t+=6.28318530717959),u&&this.set_ParStart(f),t},LeftDerivative:function(n){return this.Derivative(n)},RightDerivative:function(n){return this.Derivative(n)},Curvature:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},CurvatureDerivative:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},CurvatureSecondDerivative:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},OrientedCounterclockwise:function(){return this.get_AxisA().get_X()*this.get_AxisB().get_Y()-this.get_AxisB().get_X()*this.get_AxisA().get_Y()>0},FullBox:function(){var n=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_AxisA(),this.get_AxisB());return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.center,n),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.center,n))},IsArc:function(){return this.get_AxisA().get_X()==this.get_AxisB().get_Y()&&this.get_AxisA().get_Y()==-this.get_AxisB().get_X()}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$Ellipse);Microsoft$Msagl$Core$Geometry$Curves$ICurve={fullname:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$ICurve);Microsoft$Msagl$Core$Geometry$Curves$IFunction={fullname:"Microsoft.Msagl.Core.Geometry.Curves.IFunction",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$IFunction);Microsoft$Msagl$Core$Geometry$Curves$IntersectionInfo={fullname:"Microsoft.Msagl.Core.Geometry.Curves.IntersectionInfo",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this.par0=0;this.par1=0;this.x=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.seg0=null;this.seg1=null;System.Object.ctor.call(this);this.par0=n;this.par1=t;this.x=i;this.seg0=r;this.seg1=u},Par0$$:"System.Double",get_Par0:function(){return this.par0},set_Par0:function(n){this.par0=n},Par1$$:"System.Double",get_Par1:function(){return this.par1},set_Par1:function(n){this.par1=n},IntersectionPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_IntersectionPoint:function(){return this.x},set_IntersectionPoint:function(n){this.x=n},Segment0$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Segment0:function(){return this.seg0},set_Segment0:function(n){this.seg0=n},Segment1$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Segment1:function(){return this.seg1},set_Segment1:function(n){this.seg1=n},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"XX({0} {1} {2})",[this.par0,this.par1,this.x])}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$IntersectionInfo);Microsoft$Msagl$Core$Geometry$Curves$LinearSystem2={fullname:"Microsoft.Msagl.Core.Geometry.Curves.LinearSystem2",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Geometry.Curves.LinearSystem2.eps=1e-8},Eps$$:"System.Double",get_Eps:function(){return Microsoft.Msagl.Core.Geometry.Curves.LinearSystem2.eps},Solve:function(n,t,i,r,u,f,e,o){var s=n*u-r*t;return System.Math.Abs$$Double(s)<Microsoft.Msagl.Core.Geometry.Curves.LinearSystem2.get_Eps()?(e.Value=o.Value=0,!1):(e.Value=(i*u-f*t)/s,o.Value=(n*f-r*i)/s,!0)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$LinearSystem2);Microsoft$Msagl$Core$Geometry$Curves$LineSegment={fullname:"Microsoft.Msagl.Core.Geometry.Curves.LineSegment",baseTypeName:"System.Object",staticDefinition:{Intersect:function(n,t,i,r,u){return Microsoft.Msagl.Core.Geometry.Point.LineLineIntersection(n,t,i,r,u)?function(){var i={Value:n},r={Value:t},f=Microsoft.Msagl.Core.Geometry.Curves.LineSegment.XIsBetweenPoints(i,r,u);return n=i.Value,t=r.Value,f}()&&function(){var n={Value:i},t={Value:r},f=Microsoft.Msagl.Core.Geometry.Curves.LineSegment.XIsBetweenPoints(n,t,u);return i=n.Value,r=t.Value,f}():!1},XIsBetweenPoints:function(n,t,i){return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Value,i.Value),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Value,i.Value))<=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon},MinDistBetweenLineSegments:function(n,t,i,r,u,f){var h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),c=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,i),v=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,i),d=Microsoft.Msagl.Core.Geometry.Point.CrossProduct(h,c),y=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(h,h),p=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(h,c),w=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(c,c),l=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(h,v),b=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(c,v),e,o,k=System.Math.Abs$$Double(d),s=k,a=k,g;return k<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?(e=0,s=1,o=b,a=w):(e=Microsoft.Msagl.Core.Geometry.Point.CrossProduct(c,v),o=Microsoft.Msagl.Core.Geometry.Point.CrossProduct(h,v),d<0&&(e=-e,o=-o),e<0?(e=0,o=b,a=w):e>s&&(e=s=1,o=b+p,a=w)),o<0?(o=0,-l<0?e=0:-l>y?e=s:(e=-l,s=y)):o>a&&(o=a=1,-l+p<0?e=0:-l+p>y?e=s:(e=-l+p,s=y)),u.Value=System.Math.Abs$$Double(e)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?0:e/s,f.Value=System.Math.Abs$$Double(o)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?0:o/a,g=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Addition(v,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(u.Value,h)),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(f.Value,c)),g.get_Length()}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Geometry.Curves.ICurve"],Kind:"Class",definition:{ctor$$Point$$Point:function(n,t){this.a=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.b=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.a=n.Clone();this.b=t.Clone()},OffsetCurve:function(){return null},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.a},set_Start:function(n){this.a=n},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.b},set_End:function(n){this.b=n},ParStart$$:"System.Double",get_ParStart:function(){return 0},ParEnd$$:"System.Double",get_ParEnd:function(){return 1},Trim:function(n,t){if(n>t)throw $CreateException(new System.InvalidOperationException.ctor,new Error);var i=n<=this.get_ParStart()?this.get_Start():Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1-n,this.a),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(n,this.b)),r=t>=this.get_ParEnd()?this.get_End():Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1-t,this.a),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(t,this.b));return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(n,t)?null:new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(i,r)},TrimWithWrap:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},ParallelogramNodeOverICurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve",get_ParallelogramNodeOverICurve:function(){var n=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.b,this.a));return new Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf.ctor(0,1,new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Point$$Point$$Point(this.a,n,n),this,0)},Normal$$:"Microsoft.Msagl.Core.Geometry.Point",get_Normal:function(){var n=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.a,this.b);return n=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(n,n.get_Length()),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-n.get_Y(),n.get_X())},ctor$$Point$$Double$$Double:function(n,t,i){this.a=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.b=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point.call(this,n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,i))},ctor$$Double$$Double$$Double$$Double:function(n,t,i,r){this.a=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.b=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point.call(this,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,t),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i,r))},Item$$:"Microsoft.Msagl.Core.Geometry.Point",get_Item$$Double:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.a,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.b,this.a),n))},Derivative:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.b,this.a)},SecondDerivative:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0)},ThirdDerivative:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0)},toString:function(){return"{"+this.a+","+this.b+"}"},Reverse:function(){return new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.b,this.a)},Translate:function(n){this.a=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.a,n);this.b=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.b,n)},ScaleFromOrigin:function(n,t){return new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.Scale(n,t,this.a),Microsoft.Msagl.Core.Geometry.Point.Scale(n,t,this.b))},GetParameterAtLength:function(n){var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.b,this.a).get_Length(),t;return i<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()?0:(t=n/i,t>1?1:t<0?0:t)},Transform:function(n){return new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,this.a),Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,this.b))},ClosestParameterWithinBounds:function(n,t,i){var r=this.ClosestParameter(n);return r<t&&(r=t),r>i&&(r=i),r},LengthPartial:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.get_Item$$Double(t),this.get_Item$$Double(n)).get_Length()},Length$$:"System.Double",get_Length:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.a,this.b).get_Length()},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(this.get_Start(),this.get_End())},Clone:function(){return new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.a,this.b)},ClosestParameter:function(n){return Microsoft.Msagl.Core.Geometry.Point.ClosestParameterOnLineSegment(n,this.get_Start(),this.get_End())},LeftDerivative:function(n){return this.Derivative(n)},RightDerivative:function(n){return this.Derivative(n)},Curvature:function(){return 0},CurvatureDerivative:function(){return 0},CurvatureSecondDerivative:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$LineSegment);Microsoft$Msagl$Core$Geometry$Curves$MinDistCurveCurve={fullname:"Microsoft.Msagl.Core.Geometry.Curves.MinDistCurveCurve",baseTypeName:"System.Object",staticDefinition:{Delta:function(n,t,i,r){return n*r-i*t}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u,f,e,o){this.curveA=null;this.curveB=null;this.aMin=0;this.aMax=0;this.bMin=0;this.bMax=0;this.aGuess=0;this.bGuess=0;this.aSolution=0;this.bSolution=0;this.aPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.status=!1;this.si=0;this.ti=0;this.a=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.b=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.a_b=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.ad=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bd=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.add=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bdd=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.curveA=n;this.curveB=t;this.aMin=i;this.bMin=u;this.aMax=r;this.bMax=f;this.aGuess=e;this.bGuess=o;this.si=e;this.ti=o},ASolution$$:"System.Double",get_ASolution:function(){return this.aSolution},BSolution$$:"System.Double",get_BSolution:function(){return this.bSolution},APoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_APoint:function(){return this.aPoint},BPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_BPoint:function(){return this.bPoint},Status$$:"System.Boolean",get_Status:function(){return this.status},InitValues:function(){this.a=this.curveA.get_Item$$Double(this.si);this.b=this.curveB.get_Item$$Double(this.ti);this.a_b=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.a,this.b);this.ad=this.curveA.Derivative(this.si);this.add=this.curveA.SecondDerivative(this.si);this.bd=this.curveB.Derivative(this.ti);this.bdd=this.curveB.SecondDerivative(this.ti)},Fs$$:"System.Double",get_Fs:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.a_b,this.ad)},Fss$$:"System.Double",get_Fss:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.a_b,this.add)+Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.ad,this.ad)},Fst$$:"System.Double",get_Fst:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(this.bd),this.ad)},Ftt$$:"System.Double",get_Ftt:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(this.a_b),this.bdd)+Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.bd,this.bd)},Ft$$:"System.Double",get_Ft:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(this.a_b),this.bd)},Solve:function(){var h=0,c=0,i=!1,r,l,a,n,t,u,f,e,o,s;if(this.InitValues(),Is(this.curveA,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor)&&Is(this.curveB,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor)&&(r=this.curveB.Derivative(0),r=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(r,r.get_Length()),l=As(this.curveA,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor).get_Normal(),a=System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(l,r)),System.Math.Abs$$Double(a)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon||Microsoft.Msagl.Core.Geometry.Curves.MinDistCurveCurve.Delta(this.get_Fss(),this.get_Fst(),this.get_Fst(),this.get_Ftt())<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())){this.status=!0;this.ParallelLineSegLineSegMinDist();return}do{if(u=Microsoft.Msagl.Core.Geometry.Curves.MinDistCurveCurve.Delta(this.get_Fss(),this.get_Fst(),this.get_Fst(),this.get_Ftt()),System.Math.Abs$$Double(u)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()){this.status=!1;i=!0;break}n=Microsoft.Msagl.Core.Geometry.Curves.MinDistCurveCurve.Delta(-this.get_Fs(),this.get_Fst(),-this.get_Ft(),this.get_Ftt())/u;t=Microsoft.Msagl.Core.Geometry.Curves.MinDistCurveCurve.Delta(this.get_Fss(),-this.get_Fs(),this.get_Fst(),-this.get_Ft())/u;f=this.si+n;e=this.ti+t;f>this.aMax+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon||f<this.aMin-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon||e>this.bMax+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon||e<this.bMin-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?(h++,function(){var i={Value:n},r={Value:t},u=this.ChopDsDt(i,r);return n=i.Value,t=r.Value,u}.call(this),this.si+=n,this.ti+=t,o=!0):(o=!1,this.si=f,this.ti=e,this.si>this.aMax?this.si=this.aMax:this.si<this.aMin&&(this.si=this.aMin),this.ti>this.bMax?this.ti=this.bMax:this.ti<this.bMin&&(this.ti=this.bMin));this.InitValues();c++;i=h>=10||c>=100||n==0&&t==0&&o}while((System.Math.Abs$$Double(n)>=Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()||System.Math.Abs$$Double(t)>=Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())&&!i);if(i&&(s=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.curveA.get_Item$$Double(this.aGuess),this.curveB.get_Item$$Double(this.bGuess)),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(s,s)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon*Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)){this.aSolution=this.aGuess;this.bSolution=this.bGuess;this.aPoint=this.curveA.get_Item$$Double(this.aGuess);this.bPoint=this.curveB.get_Item$$Double(this.bGuess);this.status=!0;return}this.aSolution=this.si;this.bSolution=this.ti;this.aPoint=this.a;this.bPoint=this.b;this.status=!i},ChopDsDt:function(n,t){var i,r,u;n.Value!=0&&t.Value!=0?(i=1,this.si+n.Value>this.aMax?i=(this.aMax-this.si)/n.Value:this.si+n.Value<this.aMin&&(i=(this.aMin-this.si)/n.Value),r=1,this.ti+t.Value>this.bMax?r=(this.bMax-this.ti)/t.Value:this.ti+t.Value<this.bMin&&(r=(this.bMin-this.ti)/t.Value),u=System.Math.Min$$Double$$Double(i,r),n.Value*=u,t.Value*=u):n.Value==0?this.ti+t.Value>this.bMax?t.Value=this.bMax-this.ti:this.ti+t.Value<this.bMin&&(t.Value=this.bMin-this.ti):this.si+n.Value>this.aMax?n.Value=this.aMax-this.si:this.si+n.Value<this.aMin&&(n.Value=this.aMin-this.si)},ParallelLineSegLineSegMinDist:function(){var a=As(this.curveA,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor),v=As(this.curveB,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor),f=a.get_Start(),y=a.get_End(),h=v.get_Start(),c=v.get_End(),r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(y,f),p=r.get_Length(),e=0,t,n,i,o,w,u,l,s;p>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?(r=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(r,p),t=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(y,f)),n=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h,f)),i=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(c,f)),o=!1,n>i&&(o=!0,w=n,n=i,i=w),i<e?(this.aSolution=0,this.bSolution=o?0:1):n>t?(this.aSolution=1,this.bSolution=o?1:0):(s=System.Math.Min$$Double$$Double(t,i),this.aSolution=s/(t-e),this.bSolution=(s-n)/(i-n),o&&(this.bSolution=1-this.bSolution))):(u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(c,h),l=u.get_Length(),l>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?(u=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(u,l),e=0,t=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(c,h)),n=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,h)),n<e?(this.bSolution=0,this.aSolution=1):n>t?(this.bSolution=1,this.aSolution=0):(s=System.Math.Min$$Double$$Double(t,n),this.bSolution=s/(t-e),this.aSolution=0)):(this.aSolution=0,this.bSolution=0));this.aPoint=this.curveA.get_Item$$Double(this.aSolution);this.bPoint=this.curveB.get_Item$$Double(this.bSolution)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$MinDistCurveCurve);Microsoft$Msagl$Core$Geometry$Curves$VertexId={fullname:"Microsoft.Msagl.Core.Geometry.Curves.VertexId",staticDefinition:{Corner:0,VertexA:1,OtherCorner:2,VertexB:3},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$VertexId);Microsoft$Msagl$Core$Geometry$Curves$Parallelogram={fullname:"Microsoft.Msagl.Core.Geometry.Curves.Parallelogram",baseTypeName:"System.ValueType",staticDefinition:{Intersect:function(n,t){var i=!(function(){var i={Value:n},r={Value:t},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.separByA(i,r);return n=i.Value,t=r.Value,u}()||function(){var i={Value:t},r={Value:n},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.separByA(i,r);return t=i.Value,n=r.Value,u}()||function(){var i={Value:n},r={Value:t},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.separByB(i,r);return n=i.Value,t=r.Value,u}()||function(){var i={Value:t},r={Value:n},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.separByB(i,r);return t=i.Value,n=r.Value,u}());return i==!1?!1:(n.isSeg&&t.isSeg)?Microsoft.Msagl.Core.Geometry.Point.ParallelWithinEpsilon(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_OtherCorner(),n.get_Corner()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_OtherCorner(),t.get_Corner()),1e-5)?function(){var i={Value:t},r={Value:n},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ParallelSegsIntersect(i,r);return t=i.Value,n=r.Value,u}():!0:!0},ParallelSegsIntersect:function(n,t){var f=n.Value.get_Corner(),o=n.Value.get_OtherCorner(),s=t.Value.get_Corner(),h=t.Value.get_OtherCorner(),i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(o,f),c=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(i,i),r=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(s,f),i),u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(h,f),i),e;return r>u&&(e=r,r=u,u=e),!(u<0-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon||r>c+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)},mult:function(n,t){return n.Value.get_X()*t.Value.get_X()+n.Value.get_Y()*t.Value.get_Y()},separByA:function(n,t){var r=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon,i=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.Value.corner.get_X()-n.Value.corner.get_X(),t.Value.corner.get_Y()-n.Value.corner.get_Y()),u=function(){var t={Value:i},r={Value:n.Value.aRot},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.mult(t,r);return i=t.Value,n.Value.aRot=r.Value,u}();return u>n.Value.baRot+r?(i.set_X(t.Value.aPlusCorner.get_X()-n.Value.corner.get_X()),i.set_Y(t.Value.aPlusCorner.get_Y()-n.Value.corner.get_Y()),function(){var t={Value:i},r={Value:n.Value.aRot},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.mult(t,r);return i=t.Value,n.Value.aRot=r.Value,u}()<=n.Value.baRot+r)?!1:(i.set_X(t.Value.bPlusCorner.get_X()-n.Value.corner.get_X()),i.set_Y(t.Value.bPlusCorner.get_Y()-n.Value.corner.get_Y()),function(){var t={Value:i},r={Value:n.Value.aRot},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.mult(t,r);return i=t.Value,n.Value.aRot=r.Value,u}()<=n.Value.baRot+r)?!1:(i.set_X(t.Value.otherCorner.get_X()-n.Value.corner.get_X()),i.set_Y(t.Value.otherCorner.get_Y()-n.Value.corner.get_Y()),function(){var t={Value:i},r={Value:n.Value.aRot},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.mult(t,r);return i=t.Value,n.Value.aRot=r.Value,u}()<=n.Value.baRot+r)?!1:!0:u<-r?(i.set_X(t.Value.aPlusCorner.get_X()-n.Value.corner.get_X()),i.set_Y(t.Value.aPlusCorner.get_Y()-n.Value.corner.get_Y()),function(){var t={Value:i},r={Value:n.Value.aRot},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.mult(t,r);return i=t.Value,n.Value.aRot=r.Value,u}()>=-r)?!1:(i.set_X(t.Value.bPlusCorner.get_X()-n.Value.corner.get_X()),i.set_Y(t.Value.bPlusCorner.get_Y()-n.Value.corner.get_Y()),function(){var t={Value:i},r={Value:n.Value.aRot},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.mult(t,r);return i=t.Value,n.Value.aRot=r.Value,u}()>=-r)?!1:(i.set_X(t.Value.otherCorner.get_X()-n.Value.corner.get_X()),i.set_Y(t.Value.otherCorner.get_Y()-n.Value.corner.get_Y()),function(){var t={Value:i},r={Value:n.Value.aRot},u=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.mult(t,r);return i=t.Value,n.Value.aRot=r.Value,u}()>=-r)?!1:!0:!1},separByB:function(n,t){var i=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon,e=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Value.Vertex(Microsoft.Msagl.Core.Geometry.Curves.VertexId.Corner),n.Value.corner),n.Value.bRot),u,f,r;if(e>n.Value.abRot+i){for(u=t.Value.get_OtherVertices().GetEnumerator();u.MoveNext();)if(r=u.get_Current(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,n.Value.corner),n.Value.bRot)<=n.Value.abRot+i)return!1;return!0}if(e<-i){for(f=t.Value.get_OtherVertices().GetEnumerator();f.MoveNext();)if(r=f.get_Current(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,n.Value.corner),n.Value.bRot)>=-i)return!1;return!0}return!1},GetParallelogramOfAGroup:function(n){for(var t=0,f=0,i=0,e=0,s=!0,h=n.GetEnumerator(),c,o;h.MoveNext();)for(c=h.get_Current(),o=c.get_AllVertices().GetEnumerator();o.MoveNext();){var l=o.get_Current(),r=l.get_X(),u=l.get_Y();s?(s=!1,t=f=r,i=e=u):(r<t?t=r:r>f&&(f=r),u<i?i=u:u>e&&(e=u))}return new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Point$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,i),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,e-i),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(f-t,0))},PumpMinMax:function(n,t,i,r,u){u.Value.get_X()<n.Value?n.Value=u.Value.get_X():u.Value.get_X()>t.Value&&(t.Value=u.Value.get_X());u.Value.get_Y()<i.Value?i.Value=u.Value.get_Y():u.Value.get_Y()>r.Value&&(r.Value=u.Value.get_Y())}},assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Point$$Point$$Point:function(n,t,i){this.isSeg=!1;this.corner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.a=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.b=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.otherCorner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.aPlusCorner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bPlusCorner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.aRot=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bRot=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.abRot=0;this.baRot=0;System.ValueType.ctor.call(this);this.corner=n;this.a=t;this.b=i;this.aRot=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-t.get_Y(),t.get_X());this.aRot.get_Length()>.5&&(this.aRot=this.aRot.Normalize());this.bRot=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-i.get_Y(),i.get_X());this.bRot.get_Length()>.5&&(this.bRot=this.bRot.Normalize());this.abRot=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(t,this.bRot);this.baRot=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(i,this.aRot);this.abRot<0&&(this.abRot=-this.abRot,this.bRot=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(this.bRot));this.baRot<0&&(this.baRot=-this.baRot,this.aRot=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(this.aRot));this.isSeg=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,i).get_Length()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon;this.aPlusCorner=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,n);this.otherCorner=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,this.aPlusCorner);this.bPlusCorner=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,n)},AllVertices$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_AllVertices:function(){var n=[];return n.push(this.corner),n.push(this.aPlusCorner),n.push(this.otherCorner),n.push(this.bPlusCorner),n},OtherVertices$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_OtherVertices:function(){var n=[];return n.push(this.aPlusCorner),n.push(this.otherCorner),n.push(this.bPlusCorner),n},Corner$$:"Microsoft.Msagl.Core.Geometry.Point",get_Corner:function(){return this.corner},OtherCorner$$:"Microsoft.Msagl.Core.Geometry.Point",get_OtherCorner:function(){return this.otherCorner},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"({0},{1},{2},{3})",[this.Vertex(Microsoft.Msagl.Core.Geometry.Curves.VertexId.Corner),this.Vertex(Microsoft.Msagl.Core.Geometry.Curves.VertexId.VertexA),this.Vertex(Microsoft.Msagl.Core.Geometry.Curves.VertexId.OtherCorner),this.Vertex(Microsoft.Msagl.Core.Geometry.Curves.VertexId.VertexB)])},Contains:function(n){var r=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,this.corner),t=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon,u=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.bRot),i;return u>this.abRot+t||u<-t?!1:(i=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.aRot),i<=this.baRot+t&&i>=-t)},Area$$:"System.Double",get_Area:function(){return System.Math.Abs$$Double(this.a.get_X()*this.b.get_Y()-this.a.get_Y()*this.b.get_X())},Vertex:function(n){switch(n){case Microsoft.Msagl.Core.Geometry.Curves.VertexId.Corner:return this.corner;case Microsoft.Msagl.Core.Geometry.Curves.VertexId.VertexA:return this.aPlusCorner;case Microsoft.Msagl.Core.Geometry.Curves.VertexId.OtherCorner:return this.get_OtherCorner();case Microsoft.Msagl.Core.Geometry.Curves.VertexId.VertexB:return this.bPlusCorner;default:throw $CreateException(new System.InvalidOperationException.ctor,new Error);}},ctor$$Parallelogram$$Parallelogram:function(n,t){this.isSeg=!1;this.corner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.a=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.b=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.otherCorner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.aPlusCorner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bPlusCorner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.aRot=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bRot=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.abRot=0;this.baRot=0;System.ValueType.ctor.call(this);var e=n.get_Corner(),i,u,r,f;i=u=e.get_X();r=f=e.get_Y(),function(){var t={Value:i},e={Value:u},o={Value:r},s={Value:f},h={Value:n.aPlusCorner},c=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.PumpMinMax(t,e,o,s,h);return i=t.Value,u=e.Value,r=o.Value,f=s.Value,n.aPlusCorner=h.Value,c}.call(this),function(){var t={Value:i},e={Value:u},o={Value:r},s={Value:f},h={Value:n.otherCorner},c=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.PumpMinMax(t,e,o,s,h);return i=t.Value,u=e.Value,r=o.Value,f=s.Value,n.otherCorner=h.Value,c}.call(this),function(){var t={Value:i},e={Value:u},o={Value:r},s={Value:f},h={Value:n.bPlusCorner},c=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.PumpMinMax(t,e,o,s,h);return i=t.Value,u=e.Value,r=o.Value,f=s.Value,n.bPlusCorner=h.Value,c}.call(this),function(){var n={Value:i},e={Value:u},o={Value:r},s={Value:f},h={Value:t.corner},c=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.PumpMinMax(n,e,o,s,h);return i=n.Value,u=e.Value,r=o.Value,f=s.Value,t.corner=h.Value,c}.call(this),function(){var n={Value:i},e={Value:u},o={Value:r},s={Value:f},h={Value:t.aPlusCorner},c=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.PumpMinMax(n,e,o,s,h);return i=n.Value,u=e.Value,r=o.Value,f=s.Value,t.aPlusCorner=h.Value,c}.call(this),function(){var n={Value:i},e={Value:u},o={Value:r},s={Value:f},h={Value:t.otherCorner},c=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.PumpMinMax(n,e,o,s,h);return i=n.Value,u=e.Value,r=o.Value,f=s.Value,t.otherCorner=h.Value,c}.call(this),function(){var n={Value:i},e={Value:u},o={Value:r},s={Value:f},h={Value:t.bPlusCorner},c=Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.PumpMinMax(n,e,o,s,h);return i=n.Value,u=e.Value,r=o.Value,f=s.Value,t.bPlusCorner=h.Value,c}.call(this);this.corner=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i,r);this.a=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,f-r);this.b=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(u-i,0);this.aPlusCorner=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.a,this.corner);this.otherCorner=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.b,this.aPlusCorner);this.bPlusCorner=Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.b,this.corner);this.aRot=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-this.a.get_Y(),this.a.get_X());this.aRot.get_Length()>.5&&(this.aRot=this.aRot.Normalize());this.bRot=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-this.b.get_Y(),this.b.get_X());this.bRot.get_Length()>.5&&(this.bRot=this.bRot.Normalize());this.abRot=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.a,this.bRot);this.baRot=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.b,this.aRot);this.abRot<0&&(this.abRot=-this.abRot,this.bRot=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(this.bRot));this.baRot<0&&(this.baRot=-this.baRot,this.aRot=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(this.aRot));this.isSeg=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.a,this.b).get_Length()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon},ctor:function(){this.isSeg=!1;this.corner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.a=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.b=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.otherCorner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.aPlusCorner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bPlusCorner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.aRot=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.bRot=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.abRot=0;this.baRot=0;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$Parallelogram);Microsoft$Msagl$Core$Geometry$Curves$ParallelogramBinaryTreeNode={fullname:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramBinaryTreeNode",baseTypeName:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.leftSon=null;this.rightSon=null;Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode.ctor.call(this)},LeftSon$$:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode",get_LeftSon:function(){return this.leftSon},set_LeftSon:function(n){this.leftSon=n},RightSon$$:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode",get_RightSon:function(){return this.rightSon},set_RightSon:function(n){this.rightSon=n}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$ParallelogramBinaryTreeNode);Microsoft$Msagl$Core$Geometry$Curves$ParallelogramInternalTreeNode={fullname:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramInternalTreeNode",baseTypeName:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.children=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.ctor);Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.ctor.call(this,n,t)},Children$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve]]",get_Children:function(){return this.children},AddChild:function(n){this.children.Add(n)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$ParallelogramInternalTreeNode);Microsoft$Msagl$Core$Geometry$Curves$ParallelogramLeaf={fullname:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf",baseTypeName:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve",staticDefinition:{cctor:function(){}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this.low=0;this.high=0;this.chord=null;Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.ctor.call(this,r,u);this.low=n;this.high=t;this.set_Parallelogram(i)},Low$$:"System.Double",get_Low:function(){return this.low},set_Low:function(n){this.low=n},High$$:"System.Double",get_High:function(){return this.high},set_High:function(n){this.high=n},Chord$$:"Microsoft.Msagl.Core.Geometry.Curves.LineSegment",get_Chord:function(){return this.chord},set_Chord:function(n){if(this.chord=n,!Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(this.get_Seg().get_Item$$Double(this.low),this.chord.get_Start()))throw $CreateException(new System.InvalidOperationException.ctor,new Error);}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$ParallelogramLeaf);Microsoft$Msagl$Core$Geometry$Curves$ParallelogramNode={fullname:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.parallelogram=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor;System.Object.ctor.call(this)},Parallelogram$$:"Microsoft.Msagl.Core.Geometry.Curves.Parallelogram",get_Parallelogram:function(){return this.parallelogram},set_Parallelogram:function(n){this.parallelogram=n}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$ParallelogramNode);Microsoft$Msagl$Core$Geometry$Curves$ParallelogramNodeOverICurve={fullname:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve",baseTypeName:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode",staticDefinition:{cctor:function(){Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DefaultLeafBoxesOffset=.5},CreateParallelogramNodeForCurveSegment:function(n){return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"segment"),Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSeg(n.get_ParStart(),n.get_ParEnd(),n,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DefaultLeafBoxesOffset)},WithinEpsilon:function(n,t,i,r){if(Is(n,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor))return!0;var u=3,f=(i-t)/u,e=n.get_Item$$Double(t),o=n.get_Item$$Double(i),s=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DistToSegm(n.get_Item$$Double(t+f),e,o),h=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DistToSegm(n.get_Item$$Double(t+f*(u-1)),e,o);return s<r&&h<r},DistToSegm:function(n,t,i){var u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t),r;return u.get_Length()<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()?Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Addition(t,i))).get_Length():(r=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-u.get_Y(),u.get_X()),r=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(r,1/r.get_Length()),System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t),r)))},CreateParallelogramOnSubSeg:function(n,t,i,r,u,f){var v,o;if(Is(i,Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor))return Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramOnSubSegOnBezierSeg(n,t,i,r);var e=i.Derivative(n),h=i.Derivative(t),c=Microsoft.Msagl.Core.Geometry.Point.P(-h.get_Y(),h.get_X()),y=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,u),l=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(y,c),a=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(e,c),s;if(System.Math.Abs$$Double(l)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)s=0;else{if(System.Math.Abs$$Double(a)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)return!1;s=l/a}for(e=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Double(e,s),r.Value=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Point$$Point$$Point(u,e,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,u),e)),v=(t-n)/64,o=1;o<64;o++)if(!r.Value.Contains(i.get_Item$$Double(n+v*o)))return!1;return!0},CreateParallelogramOnSubSegOnBezierSeg:function(n,t,i,r){var f=As(i.Trim(n,t),Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor),u=$CreateDelegate(f,f.B),e=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u(1),u(0));return(r.Value=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Point$$Point$$Point(u(0),e,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u(3),u(0))),r.Value.Contains(u(2)))?!0:(r.Value=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Point$$Point$$Point(u(3),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u(2),u(3)),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u(0),u(3))),r.Value.Contains(u(1)))?!0:!1},CreateParallelogramNodeForCurveSeg:function(n,t,i,r){var l=n==i.get_ParStart()&&t==i.get_ParEnd()&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(i.get_Start(),i.get_End()),s,u,c,o;if(l)return Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateNodeWithSegmentSplit(n,t,i,r);var f=i.get_Item$$Double(n),e=i.get_Item$$Double(t),h=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,f),a=i.get_Item$$Double((n+t)/2);return Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DistToSegm(a,f,e)<=Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_IntersectionEpsilon()&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(h,h)<Microsoft.Msagl.Core.Geometry.Curves.Curve.get_LineSegmentThreshold()*Microsoft.Msagl.Core.Geometry.Curves.Curve.get_LineSegmentThreshold()&&t-n<Microsoft.Msagl.Core.Geometry.Curves.Curve.get_LineSegmentThreshold()?(s=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(f,e),u=As(s.get_ParallelogramNodeOverICurve(),Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf.ctor),u.set_Low(n),u.set_High(t),u.set_Seg(i),u.set_Chord(s),u):(c=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.WithinEpsilon(i,n,t,r),o=new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor,c&&function(){var r={Value:o},u=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramOnSubSeg(n,t,i,r,f,e);return o=r.Value,u}())?new Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf.ctor(n,t,o,i,r):Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateNodeWithSegmentSplit(n,t,i,r)},CreateNodeWithSegmentSplit:function(n,t,i,r){var u=new Microsoft.Msagl.Core.Geometry.Curves.ParallelogramInternalTreeNode.ctor(i,r),f;return u.AddChild(Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSeg(n,.5*(n+t),i,r)),u.AddChild(Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.CreateParallelogramNodeForCurveSeg(.5*(n+t),t,i,r)),f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor),f.Add(u.get_Children().get_Item$$Int32(0).get_Parallelogram()),f.Add(u.get_Children().get_Item$$Int32(1).get_Parallelogram()),u.set_Parallelogram(Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.GetParallelogramOfAGroup(f)),u}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.seg=null;this.leafBoxesOffset=Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DefaultLeafBoxesOffset;Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNode.ctor.call(this);this.seg=n;this.leafBoxesOffset=t},Seg$$:"Microsoft.Msagl.Core.Geometry.Curves.ICurve",get_Seg:function(){return this.seg},set_Seg:function(n){this.seg=n},LeafBoxesOffset$$:"System.Double",get_LeafBoxesOffset:function(){return this.leafBoxesOffset}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$ParallelogramNodeOverICurve);Microsoft$Msagl$Core$Geometry$Curves$PenetrationDepth={fullname:"Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth",baseTypeName:"System.Object",staticDefinition:{PenetrationVector:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.PenetrationDepthForPolylines(Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.PolylineAroundClosedCurve(n),Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.PolylineAroundClosedCurve(t))},PolylineAroundClosedCurve:function(n){for(var t=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,i=Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.PointsOnAroundPolyline(n).GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.AddPoint$$Point(r);return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_StartPoint().get_Point(),t.get_StartPoint().get_Next().get_Point(),t.get_StartPoint().get_Next().get_Next().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&(t=Cast(t.Reverse(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor)),t.set_Closed(!0),t},PointsOnAroundPolyline:function(n){for(var r=[],u=!0,t=null,f=null,e=Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.TangentsAroundCurve(n).GetEnumerator(),i;e.MoveNext();)i=e.get_Current(),u?(u=!1,f=t=i):(Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.TangentsAreParallel(t,i)||r.push(Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.TangentIntersection(t,i)),t=i);return r.push(Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.TangentIntersection(f,t)),r},TangentsAroundCurve:function(n){var i=[],c=As(n,Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),u,l,f,r,e,o,s,h,t;if(c!=null)for(u=c.get_Segments().GetEnumerator();u.MoveNext();)for(l=u.get_Current(),f=Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.TangentsAroundCurve(l).GetEnumerator();f.MoveNext();)t=f.get_Current(),i.push(t);else if(r=As(n,Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor),r!=null)i.push(new Microsoft.Msagl.Core.Geometry.Curves.CurveTangent.ctor(r.get_Start(),r.Derivative(0)));else if(e=As(n,Microsoft.Msagl.Core.Geometry.Curves.Ellipse.ctor),e!=null)for(o=Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.TangentsOfEllipse(e).GetEnumerator();o.MoveNext();)t=o.get_Current(),i.push(t);else if(s=As(n,Microsoft.Msagl.Core.Geometry.Curves.CubicBezierSegment.ctor),s!=null)for(h=Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.TangentsOfBezier(s).GetEnumerator();h.MoveNext();)t=h.get_Current(),i.push(t);return i},TangentsOfBezier:function(n){for(var i=[],r=(n.get_ParEnd()-n.get_ParStart())/8,t=0;t<8;t++)i.push(Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.TangentOnICurve(r/2+n.get_ParStart()+r*t,n));return i},TangentOnICurve:function(n,t){return new Microsoft.Msagl.Core.Geometry.Curves.CurveTangent.ctor(t.get_Item$$Double(n),t.Derivative(n))},TangentsOfEllipse:function(n){for(var i=[],r=(System.Math.Ceiling$$Double((n.get_ParEnd()-n.get_ParStart())/1.0471975511966)|0)+1,u=(n.get_ParEnd()-n.get_ParStart())/r,t=0;t<r;t++)i.push(Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.TangentOnICurve(u/2+n.get_ParStart()+u*t,n));return i},TangentIntersection:function(n,t){var i;return function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.LineLineIntersection(n.touchPoint,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.touchPoint,n.direction),t.touchPoint,Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.touchPoint,t.direction),r);return i=r.Value,u}(),i},TangentsAreParallel:function(n,t){return System.Math.Abs$$Double(n.direction.get_X()*t.direction.get_Y()-n.direction.get_Y()*t.direction.get_X())<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon},PenetrationDepthForPolylines:function(n,t){var r,u,f;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"poly0");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"poly1");System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n.get_Item$$Double(0),n.get_Item$$Double(1),n.get_Item$$Double(2))==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Item$$Double(0),t.get_Item$$Double(1),t.get_Item$$Double(2))==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise);n=Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.FlipPolyline(n);var c=Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.GetMostLeftLow(n),l=Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.GetMostLeftLow(t),e=Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.Merge(c,l),o=new Microsoft.Msagl.Core.Geometry.Point.ctor,i=e.get_StartPoint(),s=Infinity,h=new Microsoft.Msagl.Core.Geometry.Point.ctor;do{if(r=i.get_Polyline().Next(i),Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(o,i.get_Point(),r.get_Point())!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise)return new Microsoft.Msagl.Core.Geometry.Point.ctor;f=function(){var n={Value:u},t=Microsoft.Msagl.Core.Geometry.Point.DistToLineSegment(o,i.get_Point(),r.get_Point(),n);return u=n.Value,t}();f<s&&(s=f,h=Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1-u,i.get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(u,r.get_Point())));i=r}while(i!=e.get_StartPoint());return h},Merge:function(n,t){for(var r=n,u=t,i=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor;;)if(i.AddPoint$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Point(),t.get_Point())),function(){var i={Value:n},r={Value:t},u=Microsoft.Msagl.Core.Geometry.Curves.PenetrationDepth.PickNextVertex(i,r);return n=i.Value,t=r.Value,u}(),n==r&&t==u)break;return i.set_Closed(!0),i},PickNextVertex:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.Value.get_Point(),n.Value.get_Point()),r=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.Value.get_Point(),t.Value.get_Polyline().Next(t.Value).get_Point(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.Value.get_Polyline().Next(n.Value).get_Point(),i));r==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise?n.Value=n.Value.get_Polyline().Next(n.Value):t.Value=t.Value.get_Polyline().Next(t.Value)},FlipPolyline:function(n){for(var i=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,t=n.get_StartPoint();t!=null;t=t.get_Next())i.AddPoint$$Point(Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(t.get_Point()));return i.set_Closed(!0),i},GetMostLeftLow:function(n){for(var i=n.get_StartPoint(),t=i.get_Next();t!=null;t=t.get_Next())t.get_Point().get_X()<i.get_Point().get_X()?i=t:t.get_Point().get_X()==i.get_Point().get_X()&&t.get_Point().get_Y()<i.get_Point().get_Y()&&(i=t);return i}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$PenetrationDepth);Microsoft$Msagl$Core$Geometry$Curves$PlaneTransformation={fullname:"Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation",baseTypeName:"System.Object",staticDefinition:{op_Multiply$$PlaneTransformation$$Point:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.Multiply$$PlaneTransformation$$Point(n,t)},Multiply$$PlaneTransformation$$Point:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Inequality(n,null)?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n.get_Item$$Int32$$Int32(0,0)*t.get_X()+n.get_Item$$Int32$$Int32(0,1)*t.get_Y()+n.get_Item$$Int32$$Int32(0,2),n.get_Item$$Int32$$Int32(1,0)*t.get_X()+n.get_Item$$Int32$$Int32(1,1)*t.get_Y()+n.get_Item$$Int32$$Int32(1,2)):new Microsoft.Msagl.Core.Geometry.Point.ctor},op_Multiply$$PlaneTransformation$$PlaneTransformation:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.Multiply$$PlaneTransformation$$PlaneTransformation(n,t)},Multiply$$PlaneTransformation$$PlaneTransformation:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Inequality(n,null)&&Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Inequality(t,null)?new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(n.get_Item$$Int32$$Int32(0,0)*t.get_Item$$Int32$$Int32(0,0)+n.get_Item$$Int32$$Int32(0,1)*t.get_Item$$Int32$$Int32(1,0),n.get_Item$$Int32$$Int32(0,0)*t.get_Item$$Int32$$Int32(0,1)+n.get_Item$$Int32$$Int32(0,1)*t.get_Item$$Int32$$Int32(1,1),n.get_Item$$Int32$$Int32(0,0)*t.get_Item$$Int32$$Int32(0,2)+n.get_Item$$Int32$$Int32(0,1)*t.get_Item$$Int32$$Int32(1,2)+n.get_Item$$Int32$$Int32(0,2),n.get_Item$$Int32$$Int32(1,0)*t.get_Item$$Int32$$Int32(0,0)+n.get_Item$$Int32$$Int32(1,1)*t.get_Item$$Int32$$Int32(1,0),n.get_Item$$Int32$$Int32(1,0)*t.get_Item$$Int32$$Int32(0,1)+n.get_Item$$Int32$$Int32(1,1)*t.get_Item$$Int32$$Int32(1,1),n.get_Item$$Int32$$Int32(1,0)*t.get_Item$$Int32$$Int32(0,2)+n.get_Item$$Int32$$Int32(1,1)*t.get_Item$$Int32$$Int32(1,2)+n.get_Item$$Int32$$Int32(1,2)):null},op_Division:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Inequality(n,null)&&Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Inequality(t,null)?Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$PlaneTransformation(n,t.get_Inverse()):null},Divide:function(n,t){return Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Division(n,t)},UnitTransformation$$:"Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation",get_UnitTransformation:function(){return new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(1,0,0,0,1,0)},Rotation:function(n){var t=System.Math.Cos(n),i=System.Math.Sin(n);return new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(t,-i,0,i,t,0)},op_Equality:function(n,t){var i,r;if(n==null&&t==null)return!0;if(n==null||t==null)return!1;for(i=0;i<2;i++)for(r=0;r<3;r++)if(n.get_Item$$Int32$$Int32(i,r)!=t.get_Item$$Int32$$Int32(i,r))return!1;return!0},op_Inequality:function(n,t){return!Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Equality(n,t)},ScaleAroundCenterTransformation$$Double$$Point:function(n,t){var i=1-n;return new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(n,0,i*t.get_X(),0,n,i*t.get_Y())},ScaleAroundCenterTransformation$$Double$$Double$$Point:function(n,t,i){var r=1-n,u=1-t;return new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(n,0,r*i.get_X(),0,t,u*i.get_Y())}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.elements=new Array(2);System.Object.ctor.call(this);this.elements[0]=new Float64Array(3);this.elements[1]=new Float64Array(3);this.set_Item$$Int32$$Int32(0,0,function(n){return this.set_Item$$Int32$$Int32(1,1,n),n}.call(this,1))},GetHashCode:function(){return this.elements!=null?this.elements.GetHashCode():0},Equals$$Object:function(n){var t=As(n,Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor);return Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Inequality(t,null)&&Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Equality(t,this)},Elements$$:"System.Double[][]",get_Elements:function(){return this.elements},Item$$:"System.Double",get_Item$$Int32$$Int32:function(n,t){return this.get_Elements()[n][t]},set_Item$$Int32$$Int32:function(n,t,i){this.get_Elements()[n][t]=i},ctor$$Double$$Double$$Double$$Double$$Double$$Double:function(n,t,i,r,u,f){this.elements=new Array(2);System.Object.ctor.call(this);this.elements[0]=new Float64Array(3);this.elements[1]=new Float64Array(3);this.elements[0][0]=n;this.elements[0][1]=t;this.elements[0][2]=i;this.elements[1][0]=r;this.elements[1][1]=u;this.elements[1][2]=f},Inverse$$:"Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation",get_Inverse:function(){var n=this.get_Elements()[0][0]*this.get_Elements()[1][1]-this.get_Elements()[1][0]*this.get_Elements()[0][1],t=this.get_Elements()[1][1]/n,i=-this.get_Elements()[0][1]/n,r=-this.get_Elements()[1][0]/n,u=this.get_Elements()[0][0]/n,f=-t*this.get_Elements()[0][2]-i*this.get_Elements()[1][2],e=-r*this.get_Elements()[0][2]-u*this.get_Elements()[1][2];return new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(t,i,f,r,u,e)},IsIdentity$$:"System.Boolean",get_IsIdentity:function(){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(this.get_Elements()[0][0],1)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(this.get_Elements()[0][1],0)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(this.get_Elements()[0][2],0)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(this.get_Elements()[1][0],0)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(this.get_Elements()[1][1],1)&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(this.get_Elements()[1][2],0)},Offset$$:"Microsoft.Msagl.Core.Geometry.Point",get_Offset:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Elements()[0][2],this.get_Elements()[1][2])},Clone:function(){return new Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.ctor$$Double$$Double$$Double$$Double$$Double$$Double(this.get_Item$$Int32$$Int32(0,0),this.get_Item$$Int32$$Int32(0,1),this.get_Item$$Int32$$Int32(0,2),this.get_Item$$Int32$$Int32(1,0),this.get_Item$$Int32$$Int32(1,1),this.get_Item$$Int32$$Int32(1,2))}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$PlaneTransformation);Microsoft$Msagl$Core$Geometry$Curves$PolylinePoint={fullname:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.point=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.next=null;this.prev=null;this.polyline=null;System.Object.ctor.call(this);this.set_Point(n)},Point$$:"Microsoft.Msagl.Core.Geometry.Point",get_Point:function(){return this.point},set_Point:function(n){this.point=n;this.get_Polyline()!=null&&this.get_Polyline().RequireInit()},Next$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_Next:function(){return this.next},set_Next:function(n){this.next=n;this.get_Polyline()!=null&&this.get_Polyline().RequireInit()},Prev$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_Prev:function(){return this.prev},set_Prev:function(n){this.prev=n;this.get_Polyline()!=null&&this.get_Polyline().RequireInit()},Polyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_Polyline:function(){return this.polyline},set_Polyline:function(n){this.polyline=n},toString:function(){return this.point.toString()},NextOnPolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_NextOnPolyline:function(){return this.get_Polyline().Next(this)},PrevOnPolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_PrevOnPolyline:function(){return this.get_Polyline().Prev(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$PolylinePoint);Microsoft$Msagl$Core$Geometry$Curves$PointLocation={fullname:"Microsoft.Msagl.Core.Geometry.Curves.PointLocation",staticDefinition:{Outside:0,Boundary:1,Inside:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$PointLocation);Microsoft$Msagl$Core$Geometry$Curves$Polyline={fullname:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",baseTypeName:"System.Object",staticDefinition:{ParallelogramOfLineSeg:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n));return new Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor$$Point$$Point$$Point(n,i,i)},PolylineFromCurve:function(n){var t=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,i,r;for(t.AddPoint$$Point(n.get_Start()),i=n.get_Segments().GetEnumerator();i.MoveNext();)r=i.get_Current(),t.AddPoint$$Point(r.get_End());return t.set_Closed(Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Start(),n.get_End())),t}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.Geometry.Curves.ICurve","System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor$$IEnumerable$1$Point:function(n){var t,i;for(this.needToInit=!0,this.pBNode=null,this.startPoint=null,this.endPoint=null,this.count=0,this.closed=!1,this.boundingBox=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox(),System.Object.ctor.call(this),Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"points"),t=n.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.AddPoint$$Point(i)},RequireInit:function(){this.needToInit=!0},NeedToInit$$:"System.Boolean",get_NeedToInit:function(){return this.needToInit},set_NeedToInit:function(n){this.needToInit=n},PolylinePoints$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint]]",get_PolylinePoints:function(){for(var t=[],n=this.get_StartPoint();n!=null;)t.push(n),n=n.get_Next();return t},ToCurve:function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor,t;for(Microsoft.Msagl.Core.Geometry.Curves.Curve.AddLineSegment$$Curve$$Point$$Point(n,this.get_StartPoint().get_Point(),this.get_StartPoint().get_Next().get_Point()),t=this.get_StartPoint().get_Next();(t=t.get_Next())!=null;)Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Point(n,t.get_Point());return this.get_Closed()&&Microsoft.Msagl.Core.Geometry.Curves.Curve.ContinueWithLineSegment$$Curve$$Point(n,this.get_StartPoint().get_Point()),n},StartPoint$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_StartPoint:function(){return this.startPoint},set_StartPoint:function(n){this.RequireInit();this.startPoint=n},EndPoint$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_EndPoint:function(){return this.endPoint},set_EndPoint:function(n){this.RequireInit();this.endPoint=n},Count$$:"System.Int32",get_Count:function(){return this.needToInit&&this.Init(),this.count},Closed$$:"System.Boolean",get_Closed:function(){return this.closed},set_Closed:function(n){this.closed!=n&&(this.closed=n,this.RequireInit())},Item$$:"Microsoft.Msagl.Core.Geometry.Point",get_Item$$Double:function(n){var t,i;return this.get_NeedToInit()&&this.Init(),function(){var r={Value:n},u={Value:t},f={Value:i},e=this.GetAdjustedParamAndStartEndPoints(r,u,f);return n=r.Value,t=u.Value,i=f.Value,e}.call(this),Microsoft.Msagl.Core.Geometry.Point.op_Addition(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(1-n,t),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(n,i))},GetAdjustedParamAndStartEndPoints:function(n,t,i){System.Diagnostics.Debug.Assert$$Boolean(n.Value>=-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance());System.Diagnostics.Debug.Assert$$Boolean(this.get_StartPoint()!=null);for(var r=this.get_StartPoint();r.get_Next()!=null;){if(n.Value<=1){t.Value=r.get_Point();i.Value=r.get_Next().get_Point();return}r=r.get_Next();n.Value-=1}if(this.get_Closed()&&n.Value<=1){t.Value=this.get_EndPoint().get_Point();i.Value=this.get_StartPoint().get_Point();return}throw $CreateException(new System.InvalidOperationException.ctor,new Error);},Derivative:function(n){var t,i;return this.get_NeedToInit()&&this.Init(),function(){var r={Value:n},u={Value:t},f={Value:i},e=this.GetAdjustedParamAndStartEndPoints(r,u,f);return n=r.Value,t=u.Value,i=f.Value,e}.call(this),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t)},LeftDerivative:function(n){var t,i;return(this.get_NeedToInit()&&this.Init(),t=this.TryToGetPolylinePointCorrespondingToT(n),t==null)?this.Derivative(n):(i=this.TryToGetPrevPointToPolylinePoint(t),i!=null)?Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),i.get_Point()):Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Next().get_Point(),t.get_Point())},RightDerivative:function(n){var t,i;return(this.get_NeedToInit()&&this.Init(),t=this.TryToGetPolylinePointCorrespondingToT(n),t==null)?this.Derivative(n):(i=this.TryToGetNextPointToPolylinePoint(t),i!=null)?Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Point(),t.get_Point()):Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),t.get_Prev().get_Point())},TryToGetPolylinePointCorrespondingToT:function(n){for(var t=this.get_StartPoint();t!=null;t=t.get_Next(),n--)if(System.Math.Abs$$Double(n)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())return t;return null},TryToGetPrevPointToPolylinePoint:function(n){return n!=this.get_StartPoint()?n.get_Prev():this.get_Closed()?this.get_EndPoint():null},TryToGetNextPointToPolylinePoint:function(n){return n!=this.get_EndPoint()?n.get_Next():this.get_Closed()?this.get_StartPoint():null},SecondDerivative:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor},ThirdDerivative:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor},ParallelogramNodeOverICurve$$:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve",get_ParallelogramNodeOverICurve:function(){return this.get_NeedToInit()&&this.Init(),this.pBNode},BoundingBox$$:"Microsoft.Msagl.Core.Geometry.Rectangle",get_BoundingBox:function(){return this.get_NeedToInit()&&this.Init(),this.boundingBox},Init:function(){var n,t;for(this.boundingBox=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point(this.get_StartPoint().get_Point()),this.count=1,n=System.Linq.Enumerable.Skip$1(Microsoft.Msagl.Core.Geometry.Point.ctor,this,1).GetEnumerator();n.MoveNext();)t=n.get_Current(),this.boundingBox.Add$$Point(t),this.count++;this.CalculatePbNode();this.set_NeedToInit(!1)},CalculatePbNode:function(){var n;this.pBNode=new Microsoft.Msagl.Core.Geometry.Curves.ParallelogramInternalTreeNode.ctor(this,Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.DefaultLeafBoxesOffset);for(var r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.ctor),t=this.get_StartPoint(),i=0;t.get_Next()!=null;)n=Microsoft.Msagl.Core.Geometry.Curves.Polyline.ParallelogramOfLineSeg(t.get_Point(),t.get_Next().get_Point()),r.Add(n),this.pBNode.AddChild(new Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf.ctor(i,i+1,n,this,0)),t=t.get_Next(),i++;this.get_Closed()&&(n=Microsoft.Msagl.Core.Geometry.Curves.Polyline.ParallelogramOfLineSeg(this.get_EndPoint().get_Point(),this.get_StartPoint().get_Point()),r.Add(n),this.pBNode.AddChild(new Microsoft.Msagl.Core.Geometry.Curves.ParallelogramLeaf.ctor(i,i+1,n,this,0)));this.pBNode.set_Parallelogram(Microsoft.Msagl.Core.Geometry.Curves.Parallelogram.GetParallelogramOfAGroup(r))},ParStart$$:"System.Double",get_ParStart:function(){return 0},ParEnd$$:"System.Double",get_ParEnd:function(){return this.get_Closed()?this.get_Count():this.get_Count()-1},Trim:function(n,t){var i=this.ToCurve();return i=Cast(i.Trim(n,t),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor),Microsoft.Msagl.Core.Geometry.Curves.Polyline.PolylineFromCurve(i)},TrimWithWrap:function(n,t){System.Diagnostics.Debug.Assert$$Boolean$$String(n<t||this.get_Closed(),"Polyline must be closed to wrap");var i=Cast(this.ToCurve().TrimWithWrap(n,t),Microsoft.Msagl.Core.Geometry.Curves.Curve.ctor);return Microsoft.Msagl.Core.Geometry.Curves.Polyline.PolylineFromCurve(i)},Translate:function(n){for(var t=this.get_StartPoint();t!=null;)t.set_Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Point(),n)),t=t.get_Next();this.RequireInit()},ScaleFromOrigin:function(n,t){for(var r=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,i=this.get_StartPoint();i!=null;)r.AddPoint$$Point(Microsoft.Msagl.Core.Geometry.Point.Scale(n,t,i.get_Point())),i=i.get_Next();return r.set_Closed(this.get_Closed()),r},AddPoint$$Double$$Double:function(n,t){this.AddPoint$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,t))},PrependPoint:function(n){System.Diagnostics.Debug.Assert$$Boolean(this.get_EndPoint()==null||!Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(n,this.get_EndPoint().get_Point()));var t=function(){var t=new Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor(n);return t.set_Polyline(this),t}.call(this);this.get_StartPoint()!=null?Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(n,this.get_StartPoint().get_Point())||(this.get_StartPoint().set_Prev(t),t.set_Next(this.get_StartPoint()),this.set_StartPoint(t)):this.set_StartPoint(function(n){return this.set_EndPoint(n),n}.call(this,t));this.RequireInit()},AddPoint$$Point:function(n){var t=function(){var t=new Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor(n);return t.set_Polyline(this),t}.call(this);this.get_EndPoint()!=null?(this.get_EndPoint().set_Next(t),t.set_Prev(this.get_EndPoint()),this.set_EndPoint(t)):this.set_StartPoint(function(n){return this.set_EndPoint(n),n}.call(this,t));this.RequireInit()},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.get_StartPoint().get_Point()},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.get_EndPoint().get_Point()},Reverse:function(){return this.ReversePolyline()},OffsetCurve:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},LengthPartial:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Length$$:"System.Double",get_Length:function(){var t=0,n;if(this.get_StartPoint()!=null&&this.get_StartPoint().get_Next()!=null){n=this.get_StartPoint().get_Next();do t+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Point(),n.get_Prev().get_Point()).get_Length(),n=n.get_Next();while(n!=null)}return t},GetParameterAtLength:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},Transform:function(n){var t,i,r;if(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Equality(n,null))return this;for(t=function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor;return n.set_Closed(this.get_Closed()),n}.call(this),i=this.GetEnumerator();i.MoveNext();)r=i.get_Current(),t.AddPoint$$Point(Microsoft.Msagl.Core.Geometry.Curves.PlaneTransformation.op_Multiply$$PlaneTransformation$$Point(n,r));return t},ClosestParameterWithinBounds:function(n,t,i){for(var s=0,h=1.79769313486232E+308,r=0,u=this.get_StartPoint();u.get_Next()!=null;){if(r<=i&&r+1>=t){var l=System.Math.Max$$Double$$Double(0,t-r),a=System.Math.Min$$Double$$Double(1,i-r),f=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(u.get_Point(),u.get_Next().get_Point()),e=f.ClosestParameterWithinBounds(n,l,a),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.get_Item$$Double(e),n),c=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(o,o);c<h&&(h=c,s=e+r)}u=u.get_Next();r++}if(this.get_Closed()&&r<=i&&r+1>=t){var l=System.Math.Max$$Double$$Double(0,t-r),a=System.Math.Min$$Double$$Double(1,i-r),f=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_EndPoint().get_Point(),this.get_StartPoint().get_Point()),e=f.ClosestParameterWithinBounds(n,l,a),o=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f.get_Item$$Double(e),n),c=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(o,o);c<h&&(s=e+r)}return s},ClosestParameter:function(n){for(var f=0,e=1.79769313486232E+308,o=0,t=this.get_StartPoint();t.get_Next()!=null;){var i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(t.get_Point(),t.get_Next().get_Point()),r=i.ClosestParameter(n),u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Item$$Double(r),n),s=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,u);s<e&&(e=s,f=r+o);t=t.get_Next();o++}if(this.get_Closed()){var i=new Microsoft.Msagl.Core.Geometry.Curves.LineSegment.ctor$$Point$$Point(this.get_EndPoint().get_Point(),this.get_StartPoint().get_Point()),r=i.ClosestParameter(n),u=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Item$$Double(r),n),s=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,u);s<e&&(f=r+o)}return f},GetEnumerator:function(){return new Microsoft.Msagl.Core.Geometry.Curves.PolylineIterator.ctor(this)},ReversePolyline:function(){for(var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,t=this.get_EndPoint();t.get_Prev()!=null;)n.AddPoint$$Point(t.get_Point()),t=t.get_Prev();return n.AddPoint$$Point(this.get_StartPoint().get_Point()),n.set_Closed(this.get_Closed()),n},Next:function(n){return n.get_Next()!=null?n.get_Next():this.get_Closed()?this.get_StartPoint():null},Prev:function(n){return n.get_Prev()!=null?n.get_Prev():this.get_Closed()?this.get_EndPoint():null},ctor$$Point$$Point:function(n,t){this.needToInit=!0;this.pBNode=null;this.startPoint=null;this.endPoint=null;this.count=0;this.closed=!1;this.boundingBox=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox();System.Object.ctor.call(this);this.AddPoint$$Point(n);this.AddPoint$$Point(t)},ctor:function(){this.needToInit=!0;this.pBNode=null;this.startPoint=null;this.endPoint=null;this.count=0;this.closed=!1;this.boundingBox=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox();System.Object.ctor.call(this)},ctor$$Point$Array:function(n){this.needToInit=!0;this.pBNode=null;this.startPoint=null;this.endPoint=null;this.count=0;this.closed=!1;this.boundingBox=Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox();Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor$$IEnumerable$1$Point.call(this,n)},IsClockwise:function(){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.get_StartPoint().get_Point(),this.get_StartPoint().get_Next().get_Point(),this.get_StartPoint().get_Next().get_Next().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise},RemoveStartPoint:function(){var n=this.get_StartPoint().get_Next();n.set_Prev(null);this.set_StartPoint(n);this.RequireInit()},RemoveEndPoint:function(){var n=this.get_EndPoint().get_Prev();n.set_Next(null);this.set_EndPoint(n);this.RequireInit()},GetPointLocation$$Point$$PolylinePoint:function(n,t){var r;for(System.Diagnostics.Debug.Assert$$Boolean(this.get_Closed()&&this.IsClockwise()),t.Value=null,r=this.get_PolylinePoints().GetEnumerator();r.MoveNext();){var i=r.get_Current(),u=this.Next(i),f=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n,i.get_Point(),u.get_Point());if(f==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise)return Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Outside;if(f==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,i.get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u.get_Point(),n))>=0)return t.Value=i,Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Boundary}return Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Inside},GetPointLocation$$Point$$Point$$Point:function(n,t,i){var r,u;return t.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,i.Value=new Microsoft.Msagl.Core.Geometry.Point.ctor,u=function(){var t={Value:r},i=this.GetPointLocation$$Point$$PolylinePoint(n,t);return r=t.Value,i}.call(this),Microsoft.Msagl.Core.Geometry.Curves.PointLocation.Boundary==u&&(t.Value=r.get_Point(),i.Value=r.get_NextOnPolyline().get_Point()),u},Shift:function(n){for(var t=this.get_StartPoint();t!=null;t=t.get_Next())t.set_Point(Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Point(),n))},Curvature:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},CurvatureDerivative:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},CurvatureSecondDerivative:function(){throw $CreateException(new System.NotImplementedException.ctor,new Error);},AddRangeOfPoints:function(n){for(var t=n.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),this.AddPoint$$Point(i)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$Polyline);Microsoft$Msagl$Core$Geometry$Curves$PolylineIterator={fullname:"Microsoft.Msagl.Core.Geometry.Curves.PolylineIterator",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerator$1"],Kind:"Class",definition:{ctor:function(n){this.polyline=null;this.currentPolyPoint=null;System.Object.ctor.call(this);this.polyline=n},Current$$:"Microsoft.Msagl.Core.Geometry.Point",get_Current:function(){return this.currentPolyPoint.get_Point()},MoveNext:function(){return this.currentPolyPoint==null?(this.currentPolyPoint=this.polyline.get_StartPoint(),this.currentPolyPoint!=null):this.currentPolyPoint==this.polyline.get_EndPoint()?!1:(this.currentPolyPoint=this.currentPolyPoint.get_Next(),!0)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$PolylineIterator);Microsoft$Msagl$Core$Geometry$Rectangle={fullname:"Microsoft.Msagl.Core.Geometry.Rectangle",baseTypeName:"System.ValueType",staticDefinition:{CreateAnEmptyBox:function(){return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Point(0,0,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-1,-1))},op_Equality:function(n,t){return n.Equals$$Rectangle(t)},op_Inequality:function(n,t){return!n.Equals$$Rectangle(t)},Translate:function(n,t){return n.set_Center(Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Center(),t)),n.Clone()},Intersect:function(n,t){return n.Intersects(t)?new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Max$$Double$$Double(n.get_Left(),t.get_Left()),System.Math.Max$$Double$$Double(n.get_Bottom(),t.get_Bottom())),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(System.Math.Min$$Double$$Double(n.get_Right(),t.get_Right()),System.Math.Min$$Double$$Double(n.get_Top(),t.get_Top()))):Microsoft.Msagl.Core.Geometry.Rectangle.CreateAnEmptyBox()}},assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Point$$Point:function(n,t){this.left=0;this.right=0;this.top=0;this.bottom=0;System.ValueType.ctor.call(this);this.left=this.right=n.get_X();this.top=this.bottom=n.get_Y();this.Add$$Point(t)},toString:function(){return"("+this.get_LeftBottom()+" "+this.get_RightTop()+")"},Intersects:function(n){return this.IntersectsOnX(n)&&this.IntersectsOnY(n)},Intersection:function(n){var t=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;if(!this.Intersects(n))return t.SetToEmpty(),t;var i=System.Math.Max$$Double$$Double(this.get_Left(),n.get_Left()),r=System.Math.Min$$Double$$Double(this.get_Right(),n.get_Right()),u=System.Math.Max$$Double$$Double(this.get_Bottom(),n.get_Bottom()),f=System.Math.Min$$Double$$Double(this.get_Top(),n.get_Top());return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Double$$Double(i,u,r,f)},Center$$:"Microsoft.Msagl.Core.Geometry.Point",get_Center:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_LeftTop(),this.get_RightBottom()))},set_Center:function(n){var t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,this.get_Center());this.set_LeftTop(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_LeftTop(),t));this.set_RightBottom(Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_RightBottom(),t))},IntersectsOnY:function(n){return n.get_Bottom()>this.top+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?!1:n.get_Top()<this.bottom-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?!1:!0},IntersectsOnX:function(n){return n.get_Left()>this.right+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?!1:n.get_Right()<this.left-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?!1:!0},Equals$$Object:function(n){return Is(n,Microsoft.Msagl.Core.Geometry.Rectangle.ctor)&&this.Equals$$Rectangle(Cast(n,Microsoft.Msagl.Core.Geometry.Rectangle.ctor)),!1},Equals$$Rectangle:function(n){return n.get_Left()==this.get_Left()&&n.get_Right()==this.get_Right()&&n.get_Top()==this.get_Top()&&n.get_Bottom()==this.get_Bottom()},GetHashCode:function(){return System.ValueType.commonPrototype.GetHashCode.call(this)},Left$$:"System.Double",get_Left:function(){return this.left},set_Left:function(n){this.left=n},Right$$:"System.Double",get_Right:function(){return this.right},set_Right:function(n){this.right=n},Top$$:"System.Double",get_Top:function(){return this.top},set_Top:function(n){this.top=n},Bottom$$:"System.Double",get_Bottom:function(){return this.bottom},set_Bottom:function(n){this.bottom=n},LeftBottom$$:"Microsoft.Msagl.Core.Geometry.Point",get_LeftBottom:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Left(),this.get_Bottom())},RightTop$$:"Microsoft.Msagl.Core.Geometry.Point",get_RightTop:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Right(),this.get_Top())},LeftTop$$:"Microsoft.Msagl.Core.Geometry.Point",get_LeftTop:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.left,this.top)},set_LeftTop:function(n){this.left=n.get_X();this.top=n.get_Y()},RightBottom$$:"Microsoft.Msagl.Core.Geometry.Point",get_RightBottom:function(){return new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.right,this.bottom)},set_RightBottom:function(n){this.right=n.get_X();this.set_Bottom(n.get_Y())},ctor$$Point:function(n){this.left=0;this.right=0;this.top=0;this.bottom=0;System.ValueType.ctor.call(this);this.left=this.right=n.get_X();this.top=this.bottom=n.get_Y()},ctor$$Double$$Double$$Point:function(n,t,i){this.left=0;this.right=0;this.top=0;this.bottom=0;System.ValueType.ctor.call(this);this.left=n;this.bottom=t;this.right=n+i.get_X();this.top=t+i.get_Y()},ctor$$Double$$Double$$Double$$Double:function(n,t,i,r){this.left=0;this.right=0;this.top=0;this.bottom=0;System.ValueType.ctor.call(this);this.left=this.right=n;this.top=this.bottom=t;this.Add$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(i,r))},ctor$$IEnumerable$1$Point:function(n){var t,i;for(this.left=0,this.right=0,this.top=0,this.bottom=0,Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Point.call(this,0,0,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-1,-1)),Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"points"),t=n.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.Add$$Point(i)},ctor$$IEnumerable$1$Rectangle:function(n){var t,i;for(this.left=0,this.right=0,this.top=0,this.bottom=0,Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Double$$Double$$Point.call(this,0,0,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(-1,-1)),Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"rectangles"),t=n.GetEnumerator();t.MoveNext();)i=t.get_Current(),this.Add$$Rectangle(i)},Width$$:"System.Double",get_Width:function(){return this.right-this.left},set_Width:function(n){var t=n/2,i=(this.left+this.right)/2;this.left=i-t;this.right=i+t},IsEmpty$$:"System.Boolean",get_IsEmpty:function(){return this.get_Width()<0},SetToEmpty:function(){this.set_Left(0);this.set_Right(-1)},Height$$:"System.Double",get_Height:function(){return this.top-this.bottom},set_Height:function(n){var t=n/2,i=(this.top+this.bottom)/2;this.top=i+t;this.bottom=i-t},ctor$$Rectangle$$Rectangle:function(n,t){this.left=0;this.right=0;this.top=0;this.bottom=0;System.ValueType.ctor.call(this);this.left=n.left;this.right=n.right;this.top=n.top;this.bottom=n.bottom;this.Add$$Rectangle(t)},Contains$$Point$$Double:function(n,t){return this.left-t-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<=n.get_X()&&n.get_X()<=this.right+t+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.bottom-t-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<=n.get_Y()&&n.get_Y()<=this.top+t+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon},Area$$:"System.Double",get_Area:function(){return(this.right-this.left)*(this.top-this.bottom)},Add$$Point:function(n){this.get_IsEmpty()?(this.left=this.right=n.get_X(),this.top=this.bottom=n.get_Y()):(this.left>n.get_X()&&(this.left=n.get_X()),this.top<n.get_Y()&&(this.top=n.get_Y()),this.right<n.get_X()&&(this.right=n.get_X()),this.bottom>n.get_Y()&&(this.bottom=n.get_Y()))},AddWithCheck:function(n){var t,i;return(t=n.get_X()<this.left)?this.left=n.get_X():(t=this.right<n.get_X())&&(this.right=n.get_X()),(i=n.get_Y()>this.top)?this.top=n.get_Y():(i=this.bottom>n.get_Y())&&(this.bottom=n.get_Y()),t||i},Add$$Rectangle:function(n){this.Add$$Point(n.get_LeftTop());this.Add$$Point(n.get_RightBottom())},Contains$$Point:function(n){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Compare(this.left,n.get_X())<=0&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Compare(this.right,n.get_X())>=0&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Compare(this.top,n.get_Y())>=0&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.Compare(this.bottom,n.get_Y())<=0},Contains$$Rectangle:function(n){return this.Contains$$Point(n.get_LeftTop())&&this.Contains$$Point(n.get_RightBottom())},Diagonal$$:"System.Double",get_Diagonal:function(){return System.Math.Sqrt(this.get_Width()*this.get_Width()+this.get_Height()*this.get_Height())},PadWidth:function(n){this.set_Left(this.get_Left()-n);this.set_Right(this.get_Right()+n)},PadHeight:function(n){this.set_Top(this.get_Top()+n);this.set_Bottom(this.get_Bottom()-n)},Pad$$Double:function(n){n<-this.get_Width()/2&&(n=-this.get_Width()/2);n<-this.get_Height()/2&&(n=-this.get_Height()/2);this.PadWidth(n);this.PadHeight(n)},Pad$$Double$$Double$$Double$$Double:function(n,t,i,r){this.set_Left(this.get_Left()-n);this.set_Right(this.get_Right()+i);this.set_Bottom(this.get_Bottom()-t);this.set_Top(this.get_Top()+r)},Perimeter:function(){var n=new Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor;return n.AddPoint$$Point(this.get_LeftTop()),n.AddPoint$$Point(this.get_RightTop()),n.AddPoint$$Point(this.get_RightBottom()),n.AddPoint$$Point(this.get_LeftBottom()),n.set_Closed(!0),n},ScaleAroundCenter:function(n){this.set_Width(this.get_Width()*n);this.set_Height(this.get_Height()*n)},Clone:function(){return new Microsoft.Msagl.Core.Geometry.Rectangle.ctor$$Point$$Point(this.get_LeftTop(),this.get_RightBottom())},Size$$:"Microsoft.Msagl.Core.DataStructures.Size",get_Size:function(){return new Microsoft.Msagl.Core.DataStructures.Size.ctor$$Double$$Double(this.get_Width(),this.get_Height())},set_Size:function(n){this.set_Width(n.get_Width());this.set_Height(n.get_Height())},ctor$$Size$$Point:function(n,t){var i,r;this.left=0;this.right=0;this.top=0;this.bottom=0;System.ValueType.ctor.call(this);i=n.get_Width()/2;this.left=t.get_X()-i;this.right=t.get_X()+i;r=n.get_Height()/2;this.bottom=t.get_Y()-r;this.top=t.get_Y()+r},Add$$Size$$Point:function(n,t){var i=n.get_Width()/2,r=n.get_Height()/2;this.Add$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X()-i,t.get_Y()-r));this.Add$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X()+i,t.get_Y()-r));this.Add$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X()-i,t.get_Y()+r));this.Add$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t.get_X()+i,t.get_Y()+r))},ctor:function(){this.left=0;this.right=0;this.top=0;this.bottom=0;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Rectangle);Microsoft$Msagl$Core$Geometry$Curves$RootFinder={fullname:"Microsoft.Msagl.Core.Geometry.Curves.RootFinder",baseTypeName:"System.Object",staticDefinition:{TryToFindRoot:function(n,t,i,r,u){var e,f,s;Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"f");System.Diagnostics.Debug.Assert$$Boolean(t>=n.get_ParStart()&&i<=n.get_ParEnd());System.Diagnostics.Debug.Assert$$Boolean(t<=r&&i>=r);var o=0,h=0;u.Value=r;f=!1;do{if(s=n.Derivative(u.Value),System.Math.Abs$$Double(s)<Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()){f=!0;break}e=-n.get_Item$$Double(u.Value)/s;u.Value+=e;u.Value<t-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?(u.Value=t,o++):u.Value>i+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(u.Value=i,o++);h++;f=o>=10||h>=100||e==0}while(System.Math.Abs$$Double(e)>=Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()&&!f);return f?System.Math.Abs$$Double(n.get_Item$$Double(r))<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon?(u.Value=r,!0):!1:(u.Value<t?u.Value=t:u.Value>i&&(u.Value=i),!0)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$RootFinder);Microsoft$Msagl$Routing$Visibility$ActiveDiagonalComparerWithRay={fullname:"Microsoft.Msagl.Routing.Visibility.ActiveDiagonalComparerWithRay",baseTypeName:"System.Object",staticDefinition:{BelongsToTheDiagonal:function(n,t,i){return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(n,Microsoft.Msagl.Core.Geometry.Point.ClosestPointAtLineSegment(n,t,i))},IntersectDiagonalWithRay:function(n,t,i){var f=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t,n),r=i.get_Start(),o=i.get_End(),u,e,s=function(){var t={Value:u},i={Value:e},s=Microsoft.Msagl.Core.Geometry.Curves.LinearSystem2.Solve(o.get_X()-r.get_X(),-f.get_X(),n.get_X()-r.get_X(),o.get_Y()-r.get_Y(),-f.get_Y(),n.get_Y()-r.get_Y(),t,i);return u=t.Value,e=i.Value,s}();return System.Diagnostics.Debug.Assert$$Boolean(s&&-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()<=u&&u<=1+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()),Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(e,f))}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(){this.pointOnTheRay=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this)},PointOnTangentAndInsertedDiagonal$$:"Microsoft.Msagl.Core.Geometry.Point",get_PointOnTangentAndInsertedDiagonal:function(){return this.pointOnTheRay},set_PointOnTangentAndInsertedDiagonal:function(n){this.pointOnTheRay=n},Compare:function(n,t){if(Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"x"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"y"),System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.Visibility.ActiveDiagonalComparerWithRay.BelongsToTheDiagonal(this.get_PointOnTangentAndInsertedDiagonal(),n.get_Start(),n.get_End())),Microsoft.Msagl.Core.Geometry.Point.op_Inequality(n.get_Start(),t.get_Start()))switch(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.get_PointOnTangentAndInsertedDiagonal(),t.get_Start(),t.get_End())){case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise:return-1;default:return 1}else return 0}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$ActiveDiagonalComparerWithRay);Microsoft$Msagl$Routing$Visibility$ActiveEdgeComparerWithRay={fullname:"Microsoft.Msagl.Routing.Visibility.ActiveEdgeComparerWithRay",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor$$Point$$Point:function(n,t){this.pivot=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.pointOnTheRay=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.pivot=n;this.pointOnTheRay=t},Pivot$$:"Microsoft.Msagl.Core.Geometry.Point",get_Pivot:function(){return this.pivot},set_Pivot:function(n){this.pivot=n},IntersectionOfTheRayAndInsertedEdge$$:"Microsoft.Msagl.Core.Geometry.Point",get_IntersectionOfTheRayAndInsertedEdge:function(){return this.pointOnTheRay},set_IntersectionOfTheRayAndInsertedEdge:function(n){this.pointOnTheRay=n},IntersectionPointBelongsToTheInsertedEdge:function(n){var t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Point(),this.get_IntersectionOfTheRayAndInsertedEdge()),i=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_NextOnPolyline().get_Point(),this.get_IntersectionOfTheRayAndInsertedEdge());return System.Math.Abs$$Double(t.get_X()*i.get_Y()-i.get_X()*t.get_Y())<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon},IntersectEdgeWithRay$$Point$$Point$$Point:function(n,t,i){var r,u,f=function(){var f={Value:r},e={Value:u},o=Microsoft.Msagl.Core.Geometry.Curves.LinearSystem2.Solve(t.get_X()-n.get_X(),-i.get_X(),this.get_Pivot().get_X()-n.get_X(),t.get_Y()-n.get_Y(),-i.get_Y(),this.get_Pivot().get_Y()-n.get_Y(),f,e);return r=f.Value,u=e.Value,o}.call(this);if(!(-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()<=r&&r<=1+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()))throw $CreateException(new System.Exception.ctor,new Error);if(!f)throw $CreateException(new System.InvalidOperationException.ctor,new Error);return Microsoft.Msagl.Core.Geometry.Point.op_Addition(this.get_Pivot(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(u,i))},IntersectEdgeWithRay$$PolylinePoint$$Point:function(n,t){return this.IntersectEdgeWithRay$$Point$$Point$$Point(n.get_Point(),n.get_NextOnPolyline().get_Point(),t)},ctor:function(){this.pivot=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.pointOnTheRay=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$ActiveEdgeComparerWithRay);Microsoft$Msagl$Routing$Visibility$BimodalSequence={fullname:"Microsoft.Msagl.Routing.Visibility.BimodalSequence",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.sequence=null;this.length=0;System.Object.ctor.call(this);this.sequence=n;this.length=t},Sequence$$:"System.Func`2[[System.Int32],[System.Double]]",get_Sequence:function(){return this.sequence},Length$$:"System.Int32",get_Length:function(){return this.length},FindMinimum:function(){return this.sequence(0)==this.sequence(this.get_Length()-1)?new Microsoft.Msagl.Routing.Visibility.UnimodalSequence.ctor(this.sequence,this.get_Length()).FindMinimum():new Microsoft.Msagl.Routing.Visibility.UnimodalSequence.ctor(this.GetAdjustedSequenceForMinimum(),this.get_Length()).FindMinimum()},GetAdjustedSequenceForMinimum:function(){var n=this.get_Sequence()(0),t=this.get_Sequence()(this.get_Length()-1),i=(t-n)/(this.get_Length()-1);return $CreateAnonymousDelegate(this,function(t){return System.Math.Min$$Double$$Double(this.get_Sequence()(t),n+i*t)})},FindMaximum:function(){return this.sequence(0)==this.sequence(this.get_Length()-1)?new Microsoft.Msagl.Routing.Visibility.UnimodalSequence.ctor(this.sequence,this.get_Length()).FindMaximum():new Microsoft.Msagl.Routing.Visibility.UnimodalSequence.ctor(this.GetAdjustedSequenceForMaximum(),this.get_Length()).FindMaximum()},GetAdjustedSequenceForMaximum:function(){var n=this.get_Sequence()(0),t=this.get_Sequence()(this.get_Length()-1),i=(t-n)/(this.get_Length()-1);return $CreateAnonymousDelegate(this,function(t){return System.Math.Max$$Double$$Double(this.get_Sequence()(t),n+i*t)})}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$BimodalSequence);Microsoft$Msagl$Routing$Spline$ConeSpanner$IConeSweeper={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.IConeSweeper",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Interface"};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$IConeSweeper);Microsoft$Msagl$Routing$Spline$ConeSpanner$LeftIntersectionEvent={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftIntersectionEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.coneLeftSide=null;this.intersectionPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.endVertex=null;Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor.call(this);this.coneLeftSide=n;this.intersectionPoint=t;this.endVertex=i},EndVertex$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_EndVertex:function(){return this.endVertex},Site$$:"Microsoft.Msagl.Core.Geometry.Point",get_Site:function(){return this.intersectionPoint},toString:function(){return"LeftIntersectionEvent "+this.intersectionPoint}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$LeftIntersectionEvent);Microsoft$Msagl$Routing$Spline$ConeSpanner$LeftObstacleSide={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ObstacleSide",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.end=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Routing.Spline.ConeSpanner.ObstacleSide.ctor.call(this,n);this.end=n.get_NextOnPolyline().get_Point()},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.end},EndVertex$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_EndVertex:function(){return this.get_StartVertex().get_NextOnPolyline()}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$LeftObstacleSide);Microsoft$Msagl$Routing$Spline$ConeSpanner$LineSweeperForPortLocations={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeperForPortLocations",baseTypeName:"Microsoft.Msagl.Routing.Visibility.LineSweeperBase",staticDefinition:{Sweep:function(n,t,i,r,u){var f=new Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeperForPortLocations.ctor(n,t,t.Rotate(-i/2),t.Rotate(i/2),r,u);f.Calculate()},PointIsToTheLeftOfSegment:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise},PointIsToTheRightOfSegment:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise},VertexIsToTheLeftOfSegment:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n.get_Site())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise},VertexIsToTheRightOfSegment:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n.get_Site())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Routing.Spline.ConeSpanner.IConeSweeper"],Kind:"Class",definition:{ctor:function(n,t,i,r,u,f){this.coneSideComparer=null;this.visibilityGraph=null;this.rightConeSides=null;this.leftConeSides=null;this._ConeRightSideDirection=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._ConeLeftSideDirection=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._PortLocations=null;Microsoft.Msagl.Routing.Visibility.LineSweeperBase.ctor.call(this,n,t);this.visibilityGraph=u;this.set_ConeRightSideDirection(i);this.set_ConeLeftSideDirection(r);this.coneSideComparer=new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSideComparer.ctor(this);this.leftConeSides=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide.ctor,this.coneSideComparer);this.rightConeSides=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide.ctor,this.coneSideComparer);this.set_PortLocations(f)},ConeRightSideDirection$$:"Microsoft.Msagl.Core.Geometry.Point",get_ConeRightSideDirection:function(){return this._ConeRightSideDirection},set_ConeRightSideDirection:function(n){this._ConeRightSideDirection=n},ConeLeftSideDirection$$:"Microsoft.Msagl.Core.Geometry.Point",get_ConeLeftSideDirection:function(){return this._ConeLeftSideDirection},set_ConeLeftSideDirection:function(n){this._ConeLeftSideDirection=n},PortLocations$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Point]]",get_PortLocations:function(){return this._PortLocations},set_PortLocations:function(n){this._PortLocations=n},Calculate:function(){var n,t;for(this.InitQueueOfEvents(),n=this.get_PortLocations().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.PortLocationEvent.ctor(t));while(this.get_EventQueue().get_Count()>0)this.ProcessEvent(this.get_EventQueue().Dequeue())},ProcessEvent:function(n){var f=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent.ctor),i,r,t,u;f!=null?this.ProcessVertexEvent(f):(i=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.RightIntersectionEvent.ctor),i!=null?this.ProcessRightIntersectionEvent(i):(r=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftIntersectionEvent.ctor),r!=null?this.ProcessLeftIntersectionEvent(r):(t=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeClosureEvent.ctor),t!=null?t.get_ConeToClose().get_Removed()||this.RemoveCone(t.get_ConeToClose()):(u=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.PortLocationEvent.ctor),u!=null?this.ProcessPortLocationEvent(u):this.ProcessPointObstacleEvent(Cast(n,Microsoft.Msagl.Routing.Visibility.PortObstacleEvent.ctor))),this.set_Z(this.GetZ$$SweepEvent(n)))))},ProcessPointObstacleEvent:function(n){this.set_Z(this.GetZ$$SweepEvent(n));this.GoOverConesSeeingVertexEvent(n)},CreateConeOnPortLocation:function(n){var t=new Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone.ctor(n.get_Site(),this),i=this.InsertToTree(this.leftConeSides,t.set_LeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor(t))),r=this.InsertToTree(this.rightConeSides,t.set_RightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor(t)));this.LookForIntersectionWithConeRightSide(r);this.LookForIntersectionWithConeLeftSide(i)},ProcessPortLocationEvent:function(n){this.set_Z(this.GetZ$$SweepEvent(n));this.GoOverConesSeeingVertexEvent(n);this.CreateConeOnPortLocation(n)},ProcessLeftIntersectionEvent:function(n){if(n.coneLeftSide.get_Removed()==!1)if(System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_EndVertex().get_Point(),n.get_Site()),this.get_SweepDirection()))<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)this.RemoveCone(n.coneLeftSide.get_Cone());else{this.RemoveSegFromLeftTree(n.coneLeftSide);this.set_Z(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n.get_Site()));var t=new Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor(n.get_Site(),n.get_EndVertex(),n.coneLeftSide);this.InsertToTree(this.leftConeSides,t);n.coneLeftSide.get_Cone().set_LeftSide(t);this.LookForIntersectionOfObstacleSideAndLeftConeSide(n.get_Site(),n.get_EndVertex());this.TryCreateConeClosureForLeftSide(t)}else this.set_Z(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n.get_Site()))},TryCreateConeClosureForLeftSide:function(n){var t=As(n.get_Cone().get_RightSide(),Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor);t!=null&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n.get_EndVertex().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise&&this.CreateConeClosureEvent(n,t)},CreateConeClosureEvent:function(n,t){var i,r=function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.RayIntersectsRayInteriors(n.start,n.get_Direction(),t.get_Start(),t.get_Direction(),r);return i=r.Value,u}.call(this);System.Diagnostics.Debug.Assert$$Boolean(r);this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeClosureEvent.ctor(i,n.get_Cone()))},ProcessRightIntersectionEvent:function(n){if(n.coneRightSide.get_Removed()==!1){this.RemoveSegFromRightTree(n.coneRightSide);this.set_Z(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n.get_Site()));var t=new Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor(n.get_Site(),n.get_EndVertex(),n.coneRightSide);this.InsertToTree(this.rightConeSides,t);n.coneRightSide.get_Cone().set_RightSide(t);this.LookForIntersectionOfObstacleSideAndRightConeSide(n.get_Site(),n.get_EndVertex());this.TryCreateConeClosureForRightSide(t)}else this.set_Z(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n.get_Site()))},TryCreateConeClosureForRightSide:function(n){var t=As(n.get_Cone().get_LeftSide(),Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor);t!=null&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n.get_EndVertex().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&this.CreateConeClosureEvent(n,t)},RemoveConesClosedBySegment:function(n,t){this.CloseConesCoveredBySegment(n,t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n)>Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),t)?this.leftConeSides:this.rightConeSides)},CloseConesCoveredBySegment:function(n,t,i){var r=i.FindFirst$$Func$2($CreateAnonymousDelegate(this,function(t){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise})),u,f,e,o;if(r!=null&&function(){var i={Value:u},f=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n,t,r.Item.get_Start(),r.Item.get_Direction(),i);return u=i.Value,f}.call(this)){f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone.ctor);do f.Add(r.Item.get_Cone()),r=i.Next(r);while(r!=null&&function(){var i={Value:u},f=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n,t,r.Item.get_Start(),r.Item.get_Direction(),i);return u=i.Value,f}.call(this));for(e=f.GetEnumerator();e.MoveNext();)o=e.get_Current(),this.RemoveCone(o)}},ProcessVertexEvent:function(n){this.set_Z(this.GetZ$$SweepEvent(n));this.GoOverConesSeeingVertexEvent(n);this.AddConeAndEnqueueEvents(n)},AddConeAndEnqueueEvents:function(n){var r=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent.ctor),i,t;r!=null?(t=n.get_Vertex().get_NextOnPolyline(),this.CloseConesAtLeftVertex(r,t)):(i=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent.ctor),i!=null?(t=n.get_Vertex().get_PrevOnPolyline(),this.CloseConesAtRightVertex(i,t)):(this.CloseConesAtLeftVertex(n,n.get_Vertex().get_NextOnPolyline()),this.CloseConesAtRightVertex(n,n.get_Vertex().get_PrevOnPolyline())))},CloseConesAtRightVertex:function(n,t){var u=n.get_Vertex().get_NextOnPolyline().get_Point(),f=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,this.get_SweepDirection());f<=this.get_Z()&&this.get_Z()-f<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.RemoveConesClosedBySegment(u,n.get_Vertex().get_Point());var i=n.get_Site(),e=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,this.get_ConeLeftSideDirection()),o=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,this.get_ConeRightSideDirection()),r=t.get_Point();(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,u),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.RemoveRightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide.ctor(n.get_Vertex().get_NextOnPolyline())),this.GetZ$$Point(r)+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<this.GetZ$$SweepEvent(n))||(Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLineOrOnLine(r,i,e)?Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(r,i,o)?this.CaseToTheLeftOfLineOrOnLineConeRp(n,t):(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,i),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(this.LookForIntersectionOfObstacleSideAndLeftConeSide(n.get_Site(),t),this.InsertRightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide.ctor(n.get_Vertex()))),this.EnqueueEvent$$RightVertexEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent.ctor(t))):Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(Microsoft.Msagl.Core.Geometry.Point.op_Addition(r,this.get_DirectionPerp()),r,i)&&this.EnqueueEvent$$RightVertexEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent.ctor(t)))},CaseToTheLeftOfLineOrOnLineConeRp:function(n,t){this.EnqueueEvent$$RightVertexEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent.ctor(t));var i=this.leftConeSides.FindFirst$$Func$2($CreateAnonymousDelegate(this,function(t){return Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeperForPortLocations.PointIsToTheLeftOfSegment(n.get_Site(),t)}));this.FixConeLeftSideIntersections(n.get_Vertex(),t,i);Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),n.get_Site()),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.InsertRightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide.ctor(n.get_Vertex()))},LookForIntersectionOfObstacleSideAndRightConeSide:function(n,t){var u=this.GetLastNodeToTheLeftOfPointInRightSegmentTree(n),i,r;u!=null&&(i=As(u.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor),i!=null&&function(){var u={Value:r},f=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n,t.get_Point(),i.get_Start(),this.get_ConeRightSideDirection(),u);return r=u.Value,f}.call(this)&&this.SegmentIsNotHorizontal(r,t.get_Point())&&this.EnqueueEvent(this.CreateRightIntersectionEvent(i,r,t)))},CreateRightIntersectionEvent:function(n,t,i){return System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Point(),t),this.get_SweepDirection()))>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon),new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightIntersectionEvent.ctor(n,t,i)},GetLastNodeToTheLeftOfPointInRightSegmentTree:function(n){return this.rightConeSides.FindLast$$Func$2($CreateAnonymousDelegate(this,function(t){return Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeperForPortLocations.PointIsToTheRightOfSegment(n,t)}))},LookForIntersectionOfObstacleSideAndLeftConeSide:function(n,t){var u=this.GetFirstNodeToTheRightOfPoint(n),i,r;u!=null&&(i=As(u.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor),i!=null)&&function(){var u={Value:r},f=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n,t.get_Point(),i.get_Start(),this.get_ConeLeftSideDirection(),u);return r=u.Value,f}.call(this)&&this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftIntersectionEvent.ctor(i,r,t))},GetFirstNodeToTheRightOfPoint:function(n){return this.leftConeSides.FindFirst$$Func$2($CreateAnonymousDelegate(this,function(t){return Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeperForPortLocations.PointIsToTheLeftOfSegment(n,t)}))},FixConeLeftSideIntersections:function(n,t,i){if(i!=null){var u,r=As(i.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor);r!=null&&function(){var i={Value:u},f=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n.get_Point(),t.get_Point(),r.get_Start(),r.get_Direction(),i);return u=i.Value,f}.call(this)&&this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftIntersectionEvent.ctor(r,u,t))}},InsertToTree:function(n,t){return System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(t.get_Direction(),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon),this.coneSideComparer.SetOperand(t),n.Insert(t)},CloseConesAtLeftVertex:function(n,t){var r=n.get_Vertex().get_PrevOnPolyline().get_Point(),f=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(r,this.get_SweepDirection()),e;f<=this.get_Z()&&this.get_Z()-f<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.RemoveConesClosedBySegment(n.get_Vertex().get_Point(),r);var i=n.get_Site(),o=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,this.get_ConeLeftSideDirection()),s=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,this.get_ConeRightSideDirection()),u=t.get_Point();Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,r),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.RemoveLeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide.ctor(n.get_Vertex().get_PrevOnPolyline()));Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLineOrOnLine(u,i,Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,this.get_DirectionPerp()))||(Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(u,i,s)?Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(u,i,o)?(this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent.ctor(t)),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),n.get_Site()),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(this.LookForIntersectionOfObstacleSideAndRightConeSide(n.get_Site(),t),this.InsertLeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide.ctor(n.get_Vertex())))):(this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent.ctor(t)),e=this.rightConeSides.FindLast$$Func$2($CreateAnonymousDelegate(this,function(n){return Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeperForPortLocations.PointIsToTheRightOfSegment(i,n)})),this.FixConeRightSideIntersections(n.get_Vertex(),t,e),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),n.get_Site()),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.InsertLeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide.ctor(n.get_Vertex()))):this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent.ctor(t)))},RemoveCone:function(n){System.Diagnostics.Debug.Assert$$Boolean(n.get_Removed()==!1);n.set_Removed(!0);this.RemoveSegFromLeftTree(n.get_LeftSide());this.RemoveSegFromRightTree(n.get_RightSide())},RemoveSegFromRightTree:function(n){var t,i;System.Diagnostics.Debug.Assert$$Boolean(n.get_Removed()==!1);this.coneSideComparer.SetOperand(n);t=this.rightConeSides.Remove(n);n.set_Removed(!0);t==null&&(i=this.get_Z(),this.set_Z(System.Math.Max$$Double$$Double(this.GetZ$$Point(n.get_Start()),this.get_Z()-.01)),this.coneSideComparer.SetOperand(n),this.rightConeSides.Remove(n),this.set_Z(i));System.Diagnostics.Debug.Assert$$Boolean(t!=null)},RemoveSegFromLeftTree:function(n){var t,i;System.Diagnostics.Debug.Assert$$Boolean(n.get_Removed()==!1);n.set_Removed(!0);this.coneSideComparer.SetOperand(n);t=this.leftConeSides.Remove(n);t==null&&(i=this.get_Z(),this.set_Z(System.Math.Max$$Double$$Double(this.GetZ$$Point(n.get_Start()),this.get_Z()-.01)),this.coneSideComparer.SetOperand(n),this.leftConeSides.Remove(n),this.set_Z(i));System.Diagnostics.Debug.Assert$$Boolean(t!=null)},FixConeRightSideIntersections:function(n,t,i){if(i!=null){var u,r=As(i.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor);r!=null&&function(){var i={Value:u},f=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n.get_Point(),t.get_Point(),r.get_Start(),r.get_Direction(),i);return u=i.Value,f}.call(this)&&this.EnqueueEvent(this.CreateRightIntersectionEvent(r,u,t))}},LookForIntersectionWithConeLeftSide:function(n){var t=As(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor),i,r;t!=null?(i=this.FindFirstObstacleSideToTheLeftOfPoint(t.get_Start()),i!=null&&this.TryIntersectionOfConeLeftSideAndObstacleSide(t,i)):(r=Cast(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor),n=this.leftConeSides.Next(n),n!=null&&(t=As(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor),t!=null&&this.TryIntersectionOfConeLeftSideAndObstacleConeSide(t,r)))},LookForIntersectionWithConeRightSide:function(n){var t=As(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor),i,r;t!=null?(i=this.FindFirstObstacleSideToToTheRightOfPoint(t.get_Start()),i!=null&&this.TryIntersectionOfConeRightSideAndObstacleSide(t,i)):(r=Cast(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor),n=this.rightConeSides.Previous(n),n!=null&&(t=As(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor),t!=null&&this.TryIntersectionOfConeRightSideAndObstacleConeSide(t,r)))},TryIntersectionOfConeRightSideAndObstacleConeSide:function(n,t){var i;(function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(t.get_Start(),t.get_End(),n.get_Start(),n.get_Direction(),r);return i=r.Value,u}).call(this)&&this.EnqueueEvent(this.CreateRightIntersectionEvent(n,i,t.get_EndVertex()))},TryIntersectionOfConeRightSideAndObstacleSide:function(n,t){var i;(function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(t.get_Start(),t.get_End(),n.get_Start(),n.get_Direction(),r);return i=r.Value,u}).call(this)&&this.EnqueueEvent(this.CreateRightIntersectionEvent(n,i,t.get_EndVertex()))},TryIntersectionOfConeLeftSideAndObstacleConeSide:function(n,t){var i;(function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(t.get_Start(),t.get_End(),n.get_Start(),n.get_Direction(),r);return i=r.Value,u}).call(this)&&this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftIntersectionEvent.ctor(n,i,t.get_EndVertex()))},TryIntersectionOfConeLeftSideAndObstacleSide:function(n,t){var i;(function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(t.get_Start(),t.get_End(),n.get_Start(),n.get_Direction(),r);return i=r.Value,u}).call(this)&&this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftIntersectionEvent.ctor(n,i,t.get_EndVertex()))},GoOverConesSeeingVertexEvent:function(n){var t=this.FindFirstSegmentInTheRightTreeNotToTheLeftOfVertex(n),r,o,u,f;if(t!=null){var s=t.Item,e=s.get_Cone(),i=e.get_LeftSide();if(!Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeperForPortLocations.VertexIsToTheLeftOfSegment(n,i)){for(r=function(){var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone.ctor);return n.Add(e),n}.call(this),this.coneSideComparer.SetOperand(i),t=this.leftConeSides.Find$$T(i),t==null&&(o=this.get_Z(),this.set_Z(System.Math.Max$$Double$$Double(this.GetZ$$Point(i.get_Start()),this.PreviousZ)),this.coneSideComparer.SetOperand(i),t=this.leftConeSides.Find$$T(i),this.set_Z(o)),t=this.leftConeSides.Next(t);t!=null&&!Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeperForPortLocations.VertexIsToTheLeftOfSegment(n,t.Item);)r.Add(t.Item.get_Cone()),t=this.leftConeSides.Next(t);for(u=r.GetEnumerator();u.MoveNext();)f=u.get_Current(),this.AddEdge(f.get_Apex(),n.get_Site()),this.RemoveCone(f)}}},AddEdge:function(n,t){var i,r,f,o;System.Diagnostics.Debug.Assert$$Boolean(System.Linq.Enumerable.Contains$1$$IEnumerable$1$$TSource(Microsoft.Msagl.Core.Geometry.Point.ctor,this.get_PortLocations(),n));i=this.visibilityGraph.AddEdge$$Point$$Point(n,t);r=i.get_Source();System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.op_Equality(r.Point,n)&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(i.get_TargetPoint(),t));f=System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,r.get_InEdges(),$CreateAnonymousDelegate(this,function(n){return n!=i})),System.Linq.Enumerable.Where$1$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,r.get_OutEdges(),$CreateAnonymousDelegate(this,function(n){return n!=i}))));for(var e=0,s=f.length,u=f[e];e<s;e++,u=f[e])o=(u.get_Target()==r?u.get_Source():u.get_Target()).Point,Microsoft.Msagl.Routing.Visibility.VisibilityGraph.RemoveEdge$$VisibilityEdge(u),this.visibilityGraph.AddEdge$$Point$$Point(o,t)},FindFirstSegmentInTheRightTreeNotToTheLeftOfVertex:function(n){return this.rightConeSides.FindFirst$$Func$2($CreateAnonymousDelegate(this,function(t){return!Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeperForPortLocations.VertexIsToTheRightOfSegment(n,t)}))},EnqueueEvent$$RightVertexEvent:function(n){Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Site(),n.get_Vertex().get_PrevOnPolyline().get_Point()))>Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()||Microsoft.Msagl.Routing.Visibility.LineSweeperBase.commonPrototype.EnqueueEvent.call(this,n)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$LineSweeperForPortLocations);Microsoft$Msagl$Routing$Spline$ConeSpanner$PortLocationEvent={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.PortLocationEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this._PortLocation=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor.call(this);this.set_PortLocation(n)},Site$$:"Microsoft.Msagl.Core.Geometry.Point",get_Site:function(){return this.get_PortLocation()},PortLocation$$:"Microsoft.Msagl.Core.Geometry.Point",get_PortLocation:function(){return this._PortLocation},set_PortLocation:function(n){this._PortLocation=n}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$PortLocationEvent);Microsoft$Msagl$Routing$Visibility$LineSweeperBase={fullname:"Microsoft.Msagl.Routing.Visibility.LineSweeperBase",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n,t){this.directionPerp=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.eventQueue=null;this.Ports=null;this.PreviousZ=-Infinity;this.z=0;this._LeftObstacleSideTree=null;this._ObstacleSideComparer=null;this._RightObstacleSideTree=null;this._SweepDirection=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._Obstacles=null;System.Object.ctor.call(this);this.set_Obstacles(n);this.set_SweepDirection(t);this.set_DirectionPerp(t.Rotate(-1.5707963267949));this.set_EventQueue(new Microsoft.Msagl.Core.DataStructures.BinaryHeapWithComparer$1.ctor(Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor,this));this.set_ObstacleSideComparer(new Microsoft.Msagl.Routing.Visibility.ObstacleSideComparer.ctor(this));this.set_LeftObstacleSideTree(new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Visibility.SegmentBase.ctor,this.get_ObstacleSideComparer()));this.set_RightObstacleSideTree(new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Visibility.SegmentBase.ctor,this.get_ObstacleSideComparer()))},LeftObstacleSideTree$$:"Microsoft.Msagl.Core.DataStructures.RbTree`1[[Microsoft.Msagl.Routing.Visibility.SegmentBase]]",get_LeftObstacleSideTree:function(){return this._LeftObstacleSideTree},set_LeftObstacleSideTree:function(n){this._LeftObstacleSideTree=n},ObstacleSideComparer$$:"Microsoft.Msagl.Routing.Visibility.ObstacleSideComparer",get_ObstacleSideComparer:function(){return this._ObstacleSideComparer},set_ObstacleSideComparer:function(n){this._ObstacleSideComparer=n},RightObstacleSideTree$$:"Microsoft.Msagl.Core.DataStructures.RbTree`1[[Microsoft.Msagl.Routing.Visibility.SegmentBase]]",get_RightObstacleSideTree:function(){return this._RightObstacleSideTree},set_RightObstacleSideTree:function(n){this._RightObstacleSideTree=n},EventQueue$$:"Microsoft.Msagl.Core.DataStructures.BinaryHeapWithComparer`1[[Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent]]",get_EventQueue:function(){return this.eventQueue},set_EventQueue:function(n){this.eventQueue=n},SweepDirection$$:"Microsoft.Msagl.Core.Geometry.Point",get_SweepDirection:function(){return this._SweepDirection},set_SweepDirection:function(n){this._SweepDirection=n},DirectionPerp$$:"Microsoft.Msagl.Core.Geometry.Point",get_DirectionPerp:function(){return this.directionPerp},set_DirectionPerp:function(n){this.directionPerp=n},Z$$:"System.Double",get_Z:function(){return this.z},set_Z:function(n){n>this.z+Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()&&(this.PreviousZ=this.z);this.z=n},Obstacles$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_Obstacles:function(){return this._Obstacles},set_Obstacles:function(n){this._Obstacles=n},GetZ$$SweepEvent:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n.get_Site())},GetZ$$Point:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n)},SegmentIsNotHorizontal:function(n,t){return System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n,t),this.get_SweepDirection()))>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon},RemoveLeftSide:function(n){this.get_ObstacleSideComparer().SetOperand(n);this.get_LeftObstacleSideTree().Remove(n)},RemoveRightSide:function(n){this.get_ObstacleSideComparer().SetOperand(n);this.get_RightObstacleSideTree().Remove(n)},InsertLeftSide:function(n){this.get_ObstacleSideComparer().SetOperand(n);this.get_LeftObstacleSideTree().Insert(n)},InsertRightSide:function(n){this.get_ObstacleSideComparer().SetOperand(n);this.get_RightObstacleSideTree().Insert(n)},FindFirstObstacleSideToTheLeftOfPoint:function(n){var t=this.get_RightObstacleSideTree().FindLast$$Func$2($CreateAnonymousDelegate(this,function(t){return Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLineOrOnLine(n,t.get_Start(),t.get_End())}));return t==null?null:Cast(t.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide.ctor)},FindFirstObstacleSideToToTheRightOfPoint:function(n){var t=this.get_LeftObstacleSideTree().FindFirst$$Func$2($CreateAnonymousDelegate(this,function(t){return!Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLineOrOnLine(n,t.get_Start(),t.get_End())}));return t==null?null:Cast(t.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide.ctor)},EnqueueEvent:function(n){System.Diagnostics.Debug.Assert$$Boolean(this.GetZ$$Point(n.get_Site())>=this.PreviousZ);this.eventQueue.Enqueue(n)},InitQueueOfEvents:function(){for(var t=this.get_Obstacles().GetEnumerator(),i,n,r;t.MoveNext();)i=t.get_Current(),this.EnqueueLowestPointsOnObstacles(i);if(Microsoft.Msagl.Core.DataStructures.Set$1.op_Inequality(this.Ports,null))for(n=this.Ports.GetEnumerator();n.MoveNext();)r=n.get_Current(),this.EnqueueEvent(new Microsoft.Msagl.Routing.Visibility.PortObstacleEvent.ctor(r))},EnqueueLowestPointsOnObstacles:function(n){var t=this.GetLowestPoint(n);this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LowestVertexEvent.ctor(t))},GetLowestPoint:function(n){for(var i=n.get_StartPoint(),t=n.get_StartPoint().get_Next();t!=null;t=t.get_Next())this.Less(t.get_Point(),i.get_Point())&&(i=t);return i},Compare:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"a");Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"b");var i=n.get_Site(),r=t.get_Site();return function(){var n={Value:i},t={Value:r},u=this.ComparePoints(n,t);return i=n.Value,r=t.Value,u}.call(this)},Less:function(n,t){return function(){var i={Value:n},r={Value:t},u=this.ComparePoints(i,r);return n=i.Value,t=r.Value,u}.call(this)<0},ComparePoints:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n.Value),r=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),t.Value);return i<r?-1:i>r?1:(i=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.directionPerp,n.Value),r=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.directionPerp,t.Value),i<r)?-1:i>r?1:0}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$LineSweeperBase);Microsoft$Msagl$Routing$Spline$ConeSpanner$LowestVertexEvent={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.LowestVertexEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent.ctor.call(this,n)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$LowestVertexEvent);Microsoft$Msagl$Routing$Spline$ConeSpanner$ObstacleSide={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ObstacleSide",baseTypeName:"Microsoft.Msagl.Routing.Visibility.SegmentBase",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this._StartVertex=null;Microsoft.Msagl.Routing.Visibility.SegmentBase.ctor.call(this);this.set_StartVertex(n)},StartVertex$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_StartVertex:function(){return this._StartVertex},set_StartVertex:function(n){this._StartVertex=n},EndVertex$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",Polyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_Polyline:function(){return this.get_StartVertex().get_Polyline()},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.get_StartVertex().get_Point()},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.get_EndVertex().get_Point()},toString:function(){var n=this.GetType().toString(),t=n.lastIndexOf(".");return t>=0&&(n=n.substr(t+1)),n+" ["+this.get_Start().toString()+" -> "+this.get_End().toString()+"]"}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$ObstacleSide);Microsoft$Msagl$Routing$Visibility$ObstacleSideComparer={fullname:"Microsoft.Msagl.Routing.Visibility.ObstacleSideComparer",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.lineSweeper=null;this.x=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.lineSweeper=n},Compare:function(n,t){Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"b");var i=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),t.get_End(),this.x);switch(i){case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear:return 0;case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise:return 1;default:return-1}},SetOperand:function(n){this.x=this.IntersectionOfSideAndSweepLine(n)},IntersectionOfSideAndSweepLine:function(n){var t=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(n.get_Direction(),this.lineSweeper.get_SweepDirection()),i;return System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Double(t)>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon),i=(this.lineSweeper.get_Z()-Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(n.get_Start(),this.lineSweeper.get_SweepDirection()))/t,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,n.get_Direction()))}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$ObstacleSideComparer);Microsoft$Msagl$Routing$Spline$ConeSpanner$RightIntersectionEvent={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.RightIntersectionEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.coneRightSide=null;this.intersectionPoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.endVertex=null;Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor.call(this);this.coneRightSide=n;this.intersectionPoint=t;this.endVertex=i},EndVertex$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_EndVertex:function(){return this.endVertex},set_EndVertex:function(n){this.endVertex=n},Site$$:"Microsoft.Msagl.Core.Geometry.Point",get_Site:function(){return this.intersectionPoint},toString:function(){return"RightIntersectionEvent "+this.intersectionPoint}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$RightIntersectionEvent);Microsoft$Msagl$Routing$Spline$ConeSpanner$LeftVertexEvent={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent.ctor.call(this,n)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$LeftVertexEvent);Microsoft$Msagl$Routing$Spline$ConeSpanner$LineSweeper={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper",baseTypeName:"Microsoft.Msagl.Routing.Visibility.LineSweeperBase",staticDefinition:{Sweep:function(n,t,i,r,u,f){var e=new Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.ctor(n,t,t.Rotate(-i/2),t.Rotate(i/2),r,u,f);e.Calculate()},FindInsidePoint:function(n,t,i){return Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.FindInsidePointBool(n,t,i.get_Apex(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Apex(),i.get_LeftSideDirection()),Microsoft.Msagl.Core.Geometry.Point.op_Addition(i.get_Apex(),i.get_RightSideDirection()))},FindInsidePointBool:function(n,t,i,r,u){if(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(n,t)||Microsoft.Msagl.Core.Geometry.Point.PointIsInsideCone(n,i,r,u))return n;if(Microsoft.Msagl.Core.Geometry.Point.PointIsInsideCone(t,i,r,u))return t;var f=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(.5,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n,t));return Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLine(f,i,r)?Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.FindInsidePointBool(f,t,i,r,u):Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.FindInsidePointBool(n,f,i,r,u)},GetSign:function(n,t,i){var r=Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(t,i,n.get_Point());return r<0?1:r>0?-1:0},InsertPointIntoPolylineAfter:function(n,t,i){var r;return t.get_Next()!=null?(r=function(){var r=new Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor(i);return r.set_Prev(t),r.set_Next(t.get_Next()),r.set_Polyline(n),r}(),t.get_Next().set_Prev(r),t.set_Next(r)):(r=function(){var r=new Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor(i);return r.set_Prev(t),r.set_Polyline(n),r}(),t.set_Next(r),n.set_EndPoint(r)),System.Diagnostics.Debug.Assert$$Boolean(!(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(r.get_Point(),r.get_PrevOnPolyline().get_Point())||Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(r.get_Point(),r.get_NextOnPolyline().get_Point()))),n.RequireInit(),r},PointIsToTheLeftOfSegment:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise},PointIsToTheRightOfSegment:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise},VertexIsToTheLeftOfSegment:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n.get_Site())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise},VertexIsToTheRightOfSegment:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n.get_Site())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Routing.Spline.ConeSpanner.IConeSweeper"],Kind:"Class",definition:{ctor:function(n,t,i,r,u,f,e){this.coneSideComparer=null;this.visibilityGraph=null;this.rightConeSides=null;this.leftConeSides=null;this.portEdgesGraph=null;this._ConeRightSideDirection=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._ConeLeftSideDirection=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._PortEdgesCreator=null;this._BorderPolyline=null;Microsoft.Msagl.Routing.Visibility.LineSweeperBase.ctor.call(this,n,t);this.visibilityGraph=u;this.set_ConeRightSideDirection(i);this.set_ConeLeftSideDirection(r);this.coneSideComparer=new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSideComparer.ctor(this);this.leftConeSides=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide.ctor,this.coneSideComparer);this.rightConeSides=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide.ctor,this.coneSideComparer);this.Ports=f;this.set_BorderPolyline(e);this.set_PortEdgesCreator($CreateAnonymousDelegate(this,function(n,t){return new Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex(n,t)}))},ConeRightSideDirection$$:"Microsoft.Msagl.Core.Geometry.Point",get_ConeRightSideDirection:function(){return this._ConeRightSideDirection},set_ConeRightSideDirection:function(n){this._ConeRightSideDirection=n},ConeLeftSideDirection$$:"Microsoft.Msagl.Core.Geometry.Point",get_ConeLeftSideDirection:function(){return this._ConeLeftSideDirection},set_ConeLeftSideDirection:function(n){this._ConeLeftSideDirection=n},PortEdgesCreator$$:"System.Func`3[[Microsoft.Msagl.Routing.Visibility.VisibilityVertex],[Microsoft.Msagl.Routing.Visibility.VisibilityVertex],[Microsoft.Msagl.Routing.Visibility.VisibilityEdge]]",get_PortEdgesCreator:function(){return this._PortEdgesCreator},set_PortEdgesCreator:function(n){this._PortEdgesCreator=n},BorderPolyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_BorderPolyline:function(){return this._BorderPolyline},set_BorderPolyline:function(n){this._BorderPolyline=n},Calculate:function(){for(this.InitQueueOfEvents();this.get_EventQueue().get_Count()>0;)this.ProcessEvent(this.get_EventQueue().Dequeue());this.get_BorderPolyline()!=null&&this.CloseRemainingCones();this.CreatePortEdges()},CreatePortEdges:function(){var n,t;if(this.portEdgesGraph!=null)for(n=this.portEdgesGraph.get_Edges().GetEnumerator();n.MoveNext();)t=n.get_Current(),this.visibilityGraph.AddEdge$$Point$$Point$$Func$3$VisibilityVertex$VisibilityVertex$VisibilityEdge(t.get_SourcePoint(),t.get_TargetPoint(),this.get_PortEdgesCreator())},CloseRemainingCones:function(){var n,t,i;if(this.leftConeSides.get_Count()!=0){System.Diagnostics.Debug.Assert$$Boolean(this.leftConeSides.get_Count()==this.rightConeSides.get_Count());n=this.get_BorderPolyline().get_StartPoint();t=this.leftConeSides.get_Count();do i=this.leftConeSides.TreeMinimum().Item.get_Cone(),n=this.FindPolylineSideIntersectingConeRightSide(n,i),n=this.GetPolylinePointInsideOfConeAndRemoveCones(n,i),t--;while(this.leftConeSides.get_Count()>0&&t>0)}},GetPolylinePointInsideOfConeAndRemoveCones:function(n,t){var i=n.get_NextOnPolyline(),r=Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.FindInsidePoint(n.get_Point(),i.get_Point(),t);return Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(r,n.get_Point())?(this.AddEdgeAndRemoveCone(t,n.get_Point()),this.AddEdgesAndRemoveRemainingConesByPoint(n.get_Point())):Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(r,i.get_Point())?(this.AddEdgeAndRemoveCone(t,i.get_Point()),this.AddEdgesAndRemoveRemainingConesByPoint(i.get_Point()),n=i):(n=Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.InsertPointIntoPolylineAfter(this.get_BorderPolyline(),n,r),this.AddEdgeAndRemoveCone(t,n.get_Point()),this.AddEdgesAndRemoveRemainingConesByPoint(n.get_Point())),n},AddEdgesAndRemoveRemainingConesByPoint:function(n){for(var r=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone.ctor),u=this.leftConeSides.GetEnumerator(),t,i,f;u.MoveNext();)if(t=u.get_Current(),Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLineOrOnLine(n,t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction())))r.Add(t.get_Cone());else break;for(i=r.GetEnumerator();i.MoveNext();)f=i.get_Current(),this.AddEdgeAndRemoveCone(f,n)},FindPolylineSideIntersectingConeRightSide:function(n,t){var o=n,u=t.get_Apex(),f=Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Apex(),this.get_ConeRightSideDirection()),e=Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.GetSign(n,u,f),i,r;do{if(i=n.get_NextOnPolyline(),r=Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.GetSign(i,u,f),r-e>0)return n;if(n=i,e=r,n==o)throw $CreateException(new System.InvalidOperationException.ctor,new Error);}while(1)},AddEdgeAndRemoveCone:function(n,t){Microsoft.Msagl.Core.DataStructures.Set$1.op_Inequality(this.Ports,null)&&this.Ports.Contains$$T(n.get_Apex())?this.CreatePortEdge(n,t):this.visibilityGraph.AddEdge$$Point$$Point(n.get_Apex(),t);this.RemoveCone(n)},CreatePortEdge:function(n,t){var i,r,e;if(this.portEdgesGraph==null&&(this.portEdgesGraph=new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor),i=this.portEdgesGraph.FindVertex(n.get_Apex()),r=i!=null?System.Linq.Enumerable.ToArray$1(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,System.Linq.Enumerable.Concat$1(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,i.get_InEdges(),i.get_OutEdges())):null,r!=null)for(var f=0,o=r.length,u=r[f];f<o;f++,u=r[f])e=(u.get_Target()==i?u.get_Source():u.get_Target()).Point,Microsoft.Msagl.Routing.Visibility.VisibilityGraph.RemoveEdge$$VisibilityEdge(u),this.portEdgesGraph.AddEdge$$Point$$Point(e,t);this.portEdgesGraph.AddEdge$$Point$$Point(n.get_Apex(),t)},ProcessEvent:function(n){var u=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent.ctor),i,r,t;u!=null?this.ProcessVertexEvent(u):(i=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.RightIntersectionEvent.ctor),i!=null?this.ProcessRightIntersectionEvent(i):(r=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftIntersectionEvent.ctor),r!=null?this.ProcessLeftIntersectionEvent(r):(t=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeClosureEvent.ctor),t!=null?t.get_ConeToClose().get_Removed()||this.RemoveCone(t.get_ConeToClose()):this.ProcessPortObstacleEvent(Cast(n,Microsoft.Msagl.Routing.Visibility.PortObstacleEvent.ctor)),this.set_Z(this.GetZ$$SweepEvent(n)))))},ProcessPortObstacleEvent:function(n){this.set_Z(this.GetZ$$SweepEvent(n));this.GoOverConesSeeingVertexEvent(n);this.CreateConeOnVertex(n)},ProcessLeftIntersectionEvent:function(n){if(n.coneLeftSide.get_Removed()==!1)if(System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_EndVertex().get_Point(),n.get_Site()),this.get_SweepDirection()))<Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon)this.RemoveCone(n.coneLeftSide.get_Cone());else{this.RemoveSegFromLeftTree(n.coneLeftSide);this.set_Z(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n.get_Site()));var t=new Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor(n.get_Site(),n.get_EndVertex(),n.coneLeftSide);this.InsertToTree(this.leftConeSides,t);n.coneLeftSide.get_Cone().set_LeftSide(t);this.LookForIntersectionOfObstacleSideAndLeftConeSide(n.get_Site(),n.get_EndVertex());this.TryCreateConeClosureForLeftSide(t)}else this.set_Z(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n.get_Site()))},TryCreateConeClosureForLeftSide:function(n){var t=As(n.get_Cone().get_RightSide(),Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor);t!=null&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n.get_EndVertex().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise&&this.CreateConeClosureEvent(n,t)},CreateConeClosureEvent:function(n,t){var i;(function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.RayIntersectsRayInteriors(n.start,n.get_Direction(),t.get_Start(),t.get_Direction(),r);return i=r.Value,u}).call(this);this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeClosureEvent.ctor(i,n.get_Cone()))},ProcessRightIntersectionEvent:function(n){if(n.coneRightSide.get_Removed()==!1){this.RemoveSegFromRightTree(n.coneRightSide);this.set_Z(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n.get_Site()));var t=new Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor(n.get_Site(),n.get_EndVertex(),n.coneRightSide);this.InsertToTree(this.rightConeSides,t);n.coneRightSide.get_Cone().set_RightSide(t);this.LookForIntersectionOfObstacleSideAndRightConeSide(n.get_Site(),n.get_EndVertex());this.TryCreateConeClosureForRightSide(t)}else this.set_Z(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n.get_Site()))},TryCreateConeClosureForRightSide:function(n){var t=As(n.get_Cone().get_LeftSide(),Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor);t!=null&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n.get_EndVertex().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&this.CreateConeClosureEvent(n,t)},RemoveConesClosedBySegment:function(n,t){this.CloseConesCoveredBySegment(n,t,Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),n)>Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),t)?this.leftConeSides:this.rightConeSides)},CloseConesCoveredBySegment:function(n,t,i){var r=i.FindFirst$$Func$2($CreateAnonymousDelegate(this,function(t){return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()),n)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise})),u,f,e,o;if(r!=null&&function(){var i={Value:u},f=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n,t,r.Item.get_Start(),r.Item.get_Direction(),i);return u=i.Value,f}.call(this)){f=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone.ctor);do f.Add(r.Item.get_Cone()),r=i.Next(r);while(r!=null&&function(){var i={Value:u},f=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n,t,r.Item.get_Start(),r.Item.get_Direction(),i);return u=i.Value,f}.call(this));for(e=f.GetEnumerator();e.MoveNext();)o=e.get_Current(),this.RemoveCone(o)}},ProcessVertexEvent:function(n){this.set_Z(this.GetZ$$SweepEvent(n));this.GoOverConesSeeingVertexEvent(n);this.AddConeAndEnqueueEvents(n)},AddConeAndEnqueueEvents:function(n){var r=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent.ctor),i,t;r!=null?(t=n.get_Vertex().get_NextOnPolyline(),this.CloseConesAddConeAtLeftVertex(r,t)):(i=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent.ctor),i!=null?(t=n.get_Vertex().get_PrevOnPolyline(),this.CloseConesAddConeAtRightVertex(i,t)):(this.CloseConesAddConeAtLeftVertex(n,n.get_Vertex().get_NextOnPolyline()),this.CloseConesAddConeAtRightVertex(n,n.get_Vertex().get_PrevOnPolyline())))},CloseConesAddConeAtRightVertex:function(n,t){var u=n.get_Vertex().get_NextOnPolyline().get_Point(),f=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,this.get_SweepDirection());Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(f,this.get_Z())&&this.RemoveConesClosedBySegment(u,n.get_Vertex().get_Point());var i=n.get_Site(),e=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,this.get_ConeLeftSideDirection()),o=Microsoft.Msagl.Core.Geometry.Point.op_Addition(i,this.get_ConeRightSideDirection()),r=t.get_Point();Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,u),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.RemoveRightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide.ctor(n.get_Vertex().get_NextOnPolyline()));Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i,t.get_Point()),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.RemoveLeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide.ctor(t));this.GetZ$$Point(r)+Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon<this.GetZ$$SweepEvent(n)&&this.CreateConeOnVertex(n);Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLineOrOnLine(r,i,e)?Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(r,i,o)?this.CaseToTheLeftOfLineOrOnLineConeRp(n,t):(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,i),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(this.LookForIntersectionOfObstacleSideAndLeftConeSide(n.get_Site(),t),this.InsertRightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide.ctor(n.get_Vertex()))),this.EnqueueEvent$$RightVertexEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent.ctor(t))):(this.CreateConeOnVertex(n),Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(Microsoft.Msagl.Core.Geometry.Point.op_Addition(r,this.get_DirectionPerp()),r,i)&&this.EnqueueEvent$$RightVertexEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent.ctor(t)))},CaseToTheLeftOfLineOrOnLineConeRp:function(n,t){var i,r,u,f;this.EnqueueEvent$$RightVertexEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent.ctor(t));i=new Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone.ctor(n.get_Vertex().get_Point(),this);r=new Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor(i.get_Apex(),t,new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor(i));i.set_LeftSide(r);i.set_RightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor(i));u=this.InsertToTree(this.rightConeSides,i.get_RightSide());this.LookForIntersectionWithConeRightSide(u);f=this.InsertToTree(this.leftConeSides,i.get_LeftSide());this.FixConeLeftSideIntersections(r,f);Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),n.get_Site()),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.InsertRightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide.ctor(n.get_Vertex()))},LookForIntersectionOfObstacleSideAndRightConeSide:function(n,t){var u=this.GetLastNodeToTheLeftOfPointInRightSegmentTree(n),i,r;u!=null&&(i=As(u.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor),i!=null&&function(){var u={Value:r},f=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n,t.get_Point(),i.get_Start(),this.get_ConeRightSideDirection(),u);return r=u.Value,f}.call(this)&&this.SegmentIsNotHorizontal(r,t.get_Point())&&this.EnqueueEvent(this.CreateRightIntersectionEvent(i,r,t)))},CreateRightIntersectionEvent:function(n,t,i){return System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.get_Point(),t),this.get_SweepDirection()))>0),new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightIntersectionEvent.ctor(n,t,i)},GetLastNodeToTheLeftOfPointInRightSegmentTree:function(n){return this.rightConeSides.FindLast$$Func$2($CreateAnonymousDelegate(this,function(t){return Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.PointIsToTheRightOfSegment(n,t)}))},LookForIntersectionOfObstacleSideAndLeftConeSide:function(n,t){var u=this.GetFirstNodeToTheRightOfPoint(n),i,r;u!=null&&(i=As(u.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor),i!=null)&&function(){var u={Value:r},f=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n,t.get_Point(),i.get_Start(),this.get_ConeLeftSideDirection(),u);return r=u.Value,f}.call(this)&&this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftIntersectionEvent.ctor(i,r,t))},GetFirstNodeToTheRightOfPoint:function(n){return this.leftConeSides.FindFirst$$Func$2($CreateAnonymousDelegate(this,function(t){return Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.PointIsToTheLeftOfSegment(n,t)}))},FixConeLeftSideIntersections:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(t!=null);do t=this.leftConeSides.Next(t);while(t!=null&&Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLineOrOnLine(n.get_Start(),t.Item.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.Item.get_Start(),t.Item.get_Direction())));if(t!=null){var r,i=As(t.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor);i!=null&&function(){var t={Value:r},u=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n.get_Start(),n.get_End(),i.get_Start(),i.get_Direction(),t);return r=t.Value,u}.call(this)&&this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftIntersectionEvent.ctor(i,r,n.get_EndVertex()))}},InsertToTree:function(n,t){return System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(t.get_Direction(),this.get_SweepDirection())>0),this.coneSideComparer.SetOperand(t),n.Insert(t)},CloseConesAddConeAtLeftVertex:function(n,t){var u=n.get_Vertex().get_PrevOnPolyline().get_Point(),h=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(u,this.get_SweepDirection()),e,i,o,s;Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(h,this.get_Z())&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(u,n.get_Site()),this.get_DirectionPerp())>0&&this.RemoveConesClosedBySegment(n.get_Vertex().get_Point(),u);var r=n.get_Site(),c=Microsoft.Msagl.Core.Geometry.Point.op_Addition(r,this.get_ConeLeftSideDirection()),l=Microsoft.Msagl.Core.Geometry.Point.op_Addition(r,this.get_ConeRightSideDirection()),f=t.get_Point();Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(r,u),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.RemoveLeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide.ctor(n.get_Vertex().get_PrevOnPolyline()));e=this.GetZ$$Point(f)-this.get_Z();e<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.RemoveRightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide.ctor(t));e<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon||Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Double$$Double(e,0)&&Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(f,n.get_Site()),this.get_DirectionPerp())>0?this.CreateConeOnVertex(n):Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(f,r,l)?Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(f,r,c)?(this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent.ctor(t)),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),n.get_Site()),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&(this.LookForIntersectionOfObstacleSideAndRightConeSide(n.get_Site(),t),this.InsertLeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide.ctor(n.get_Vertex())))):(this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent.ctor(t)),i=new Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone.ctor(n.get_Vertex().get_Point(),this),o=new Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor(n.get_Vertex().get_Point(),t,new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor(i)),i.set_RightSide(o),i.set_LeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor(i)),this.LookForIntersectionWithConeLeftSide(this.InsertToTree(this.leftConeSides,i.get_LeftSide())),s=this.InsertToTree(this.rightConeSides,o),this.FixConeRightSideIntersections(o,s),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_Point(),n.get_Site()),this.get_SweepDirection())>Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon&&this.InsertLeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftObstacleSide.ctor(n.get_Vertex()))):(this.CreateConeOnVertex(n),this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftVertexEvent.ctor(t)))},RemoveCone:function(n){n.set_Removed(!0);this.RemoveSegFromLeftTree(n.get_LeftSide());this.RemoveSegFromRightTree(n.get_RightSide())},RemoveSegFromRightTree:function(n){var t,i;System.Diagnostics.Debug.Assert$$Boolean(n.get_Removed()==!1);this.coneSideComparer.SetOperand(n);t=this.rightConeSides.Remove(n);n.set_Removed(!0);t==null&&(i=this.get_Z(),this.set_Z(System.Math.Max$$Double$$Double(this.GetZ$$Point(n.get_Start()),this.get_Z()-.01)),this.coneSideComparer.SetOperand(n),t=this.rightConeSides.Remove(n),this.set_Z(i))},RemoveSegFromLeftTree:function(n){var t,i;System.Diagnostics.Debug.Assert$$Boolean(n.get_Removed()==!1);n.set_Removed(!0);this.coneSideComparer.SetOperand(n);t=this.leftConeSides.Remove(n);t==null&&(i=this.get_Z(),this.set_Z(System.Math.Max$$Double$$Double(this.GetZ$$Point(n.get_Start()),this.get_Z()-.01)),this.coneSideComparer.SetOperand(n),this.leftConeSides.Remove(n),this.set_Z(i));System.Diagnostics.Debug.Assert$$Boolean(t!=null)},FixConeRightSideIntersections:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(t!=null);do t=this.rightConeSides.Previous(t);while(t!=null&&Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(n.get_Start(),t.Item.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.Item.get_Start(),t.Item.get_Direction())));if(t!=null){var r,i=As(t.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor);i!=null&&function(){var t={Value:r},u=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(n.get_Start(),n.get_End(),i.get_Start(),i.get_Direction(),t);return r=t.Value,u}.call(this)&&this.EnqueueEvent(this.CreateRightIntersectionEvent(i,r,n.get_EndVertex()))}},CreateConeOnVertex:function(n){var t=new Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone.ctor(n.get_Site(),this),i,r;t.set_LeftSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor(t));t.set_RightSide(new Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor(t));i=this.InsertToTree(this.leftConeSides,t.get_LeftSide());r=this.InsertToTree(this.rightConeSides,t.get_RightSide());this.LookForIntersectionWithConeRightSide(r);this.LookForIntersectionWithConeLeftSide(i)},LookForIntersectionWithConeLeftSide:function(n){var t=As(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor),i,r;t!=null?(i=this.FindFirstObstacleSideToTheLeftOfPoint(t.get_Start()),i!=null&&this.TryIntersectionOfConeLeftSideAndObstacleSide(t,i)):(r=Cast(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor),n=this.leftConeSides.Next(n),n!=null&&(t=As(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor),t!=null&&this.TryIntersectionOfConeLeftSideAndObstacleConeSide(t,r)))},LookForIntersectionWithConeRightSide:function(n){var t=As(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor),i,r;t!=null?(i=this.FindFirstObstacleSideToToTheRightOfPoint(t.get_Start()),i!=null&&this.TryIntersectionOfConeRightSideAndObstacleSide(t,i)):(r=Cast(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor),n=this.rightConeSides.Previous(n),n!=null&&(t=As(n.Item,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeRightSide.ctor),t!=null&&this.TryIntersectionOfConeRightSideAndObstacleConeSide(t,r)))},TryIntersectionOfConeRightSideAndObstacleConeSide:function(n,t){var i;(function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(t.get_Start(),t.get_End(),n.get_Start(),n.get_Direction(),r);return i=r.Value,u}).call(this)&&this.EnqueueEvent(this.CreateRightIntersectionEvent(n,i,t.get_EndVertex()))},TryIntersectionOfConeRightSideAndObstacleSide:function(n,t){var i;(function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(t.get_Start(),t.get_End(),n.get_Start(),n.get_Direction(),r);return i=r.Value,u}).call(this)&&this.EnqueueEvent(this.CreateRightIntersectionEvent(n,i,t.get_EndVertex()))},TryIntersectionOfConeLeftSideAndObstacleConeSide:function(n,t){var i;(function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(t.get_Start(),t.get_End(),n.get_Start(),n.get_Direction(),r);return i=r.Value,u}).call(this)&&this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftIntersectionEvent.ctor(n,i,t.get_EndVertex()))},TryIntersectionOfConeLeftSideAndObstacleSide:function(n,t){var i;(function(){var r={Value:i},u=Microsoft.Msagl.Core.Geometry.Point.IntervalIntersectsRay(t.get_Start(),t.get_End(),n.get_Start(),n.get_Direction(),r);return i=r.Value,u}).call(this)&&this.EnqueueEvent(new Microsoft.Msagl.Routing.Spline.ConeSpanner.LeftIntersectionEvent.ctor(n,i,t.get_EndVertex()))},GoOverConesSeeingVertexEvent:function(n){var t=this.FindFirstSegmentInTheRightTreeNotToTheLeftOfVertex(n),r,e,u,o;if(t!=null){var s=t.Item,f=s.get_Cone(),i=f.get_LeftSide();if(!Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.VertexIsToTheLeftOfSegment(n,i)&&(r=function(){var n=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone.ctor);return n.Add(f),n}.call(this),this.coneSideComparer.SetOperand(i),t=this.leftConeSides.Find$$T(i),t==null&&(e=this.get_Z(),this.set_Z(System.Math.Max$$Double$$Double(this.GetZ$$Point(i.get_Start()),this.PreviousZ)),this.coneSideComparer.SetOperand(i),t=this.leftConeSides.Find$$T(i),this.set_Z(e)),t==null&&(t=this.GetRbNodeEmergency(t,i)),t!=null)){for(t=this.leftConeSides.Next(t);t!=null&&!Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.VertexIsToTheLeftOfSegment(n,t.Item);)r.Add(t.Item.get_Cone()),t=this.leftConeSides.Next(t);for(u=r.GetEnumerator();u.MoveNext();)o=u.get_Current(),this.AddEdgeAndRemoveCone(o,n.get_Site())}}},GetRbNodeEmergency:function(n,t){for(var i=this.leftConeSides.TreeMinimum();i!=null;i=this.leftConeSides.Next(i))if(i.Item==t){n=i;break}return n},FindFirstSegmentInTheRightTreeNotToTheLeftOfVertex:function(n){return this.rightConeSides.FindFirst$$Func$2($CreateAnonymousDelegate(this,function(t){return!Microsoft.Msagl.Routing.Spline.ConeSpanner.LineSweeper.VertexIsToTheRightOfSegment(n,t)}))},EnqueueEvent$$RightVertexEvent:function(n){Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(this.get_SweepDirection(),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_Site(),n.get_Vertex().get_PrevOnPolyline().get_Point()))>Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()||Microsoft.Msagl.Routing.Visibility.LineSweeperBase.commonPrototype.EnqueueEvent.call(this,n)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$LineSweeper);Microsoft$Msagl$Routing$Spline$ConeSpanner$SweepEvent={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)},Site$$:"Microsoft.Msagl.Core.Geometry.Point",toString:function(){var n=this.GetType().toString(),t=n.lastIndexOf(".");return t>=0&&(n=n.substr(t+1)),System.String.Format$$String$$Object$$Object("{0} {1}",n,this.get_Site())}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$SweepEvent);Microsoft$Msagl$Routing$Spline$ConeSpanner$BrokenConeSide={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.start=new Microsoft.Msagl.Core.Geometry.Point.ctor;this._ConeSide=null;this._EndVertex=null;Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide.ctor.call(this);this.start=n;this.set_EndVertex(t);this.set_ConeSide(i)},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.start},ConeSide$$:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide",get_ConeSide:function(){return this._ConeSide},set_ConeSide:function(n){this._ConeSide=n},EndVertex$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_EndVertex:function(){return this._EndVertex},set_EndVertex:function(n){this._EndVertex=n},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.get_EndVertex().get_Point()},Direction$$:"Microsoft.Msagl.Core.Geometry.Point",get_Direction:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.get_End(),this.get_Start())},toString:function(){return"BrokenConeSide: "+this.get_Start()+","+this.get_End()}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$BrokenConeSide);Microsoft$Msagl$Routing$Spline$ConeSpanner$RightObstacleSide={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.RightObstacleSide",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ObstacleSide",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.end=new Microsoft.Msagl.Core.Geometry.Point.ctor;Microsoft.Msagl.Routing.Spline.ConeSpanner.ObstacleSide.ctor.call(this,n);this.end=n.get_PrevOnPolyline().get_Point()},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.end},EndVertex$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_EndVertex:function(){return this.get_StartVertex().get_PrevOnPolyline()}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$RightObstacleSide);Microsoft$Msagl$Routing$Spline$ConeSpanner$RightVertexEvent={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.RightVertexEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent.ctor.call(this,n)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$RightVertexEvent);Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSide={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSide",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._Cone=null;this._Removed=!1;System.Object.ctor.call(this)},Start$$:"Microsoft.Msagl.Core.Geometry.Point",Direction$$:"Microsoft.Msagl.Core.Geometry.Point",Cone$$:"Microsoft.Msagl.Routing.Spline.ConeSpanner.Cone",get_Cone:function(){return this._Cone},set_Cone:function(n){this._Cone=n},Removed$$:"System.Boolean",get_Removed:function(){return this._Removed},set_Removed:function(n){this._Removed=n}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSide);Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSideComparer={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSideComparer",baseTypeName:"System.Object",staticDefinition:{CompareNotIntersectingSegs:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n.get_Start(),t.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(t.get_Start(),t.get_Direction()));switch(i){case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise:return-1;case Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise:return 1;default:return 0}}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.x=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.coneSweeper=null;System.Object.ctor.call(this);this.coneSweeper=n},SetOperand:function(n){this.x=this.IntersectionOfSegmentAndSweepLine(n)},Compare:function(n,t){var r=As(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor),i=As(t,Microsoft.Msagl.Routing.Spline.ConeSpanner.BrokenConeSide.ctor);return r!=null?i!=null?this.CompareBrokenSides(r,i):this.CompareObstacleSideAndConeSide(t):i!=null?this.CompareConeSideAndObstacleSide(n,i):Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSideComparer.CompareNotIntersectingSegs(n,t)},CompareObstacleSideAndConeSide:function(n){var t=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.x,n.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Start(),n.get_Direction()));return t==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise?-1:t==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise?1:Is(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor)?-1:1},CompareConeSideAndObstacleSide:function(n,t){var i=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.x,t.get_Start(),t.get_End());return i==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise?-1:i==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise?1:Is(n,Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeLeftSide.ctor)?1:-1},IntersectionOfSegmentAndSweepLine:function(n){var t=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(n.get_Direction(),this.coneSweeper.get_SweepDirection()),i;return System.Diagnostics.Debug.Assert$$Boolean(System.Math.Abs$$Double(t)>0),i=(this.coneSweeper.get_Z()-Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(n.get_Start(),this.coneSweeper.get_SweepDirection()))/t,Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.get_Start(),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Double$$Point(i,n.get_Direction()))},CompareBrokenSides:function(n,t){return n.get_EndVertex()==t.get_EndVertex()?Microsoft.Msagl.Routing.Spline.ConeSpanner.ConeSideComparer.CompareNotIntersectingSegs(n.get_ConeSide(),t.get_ConeSide()):Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.x,t.get_Start(),t.get_EndVertex().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise?-1:1}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$ConeSideComparer);Microsoft$Msagl$Routing$Spline$ConeSpanner$VertexEvent={fullname:"Microsoft.Msagl.Routing.Spline.ConeSpanner.VertexEvent",baseTypeName:"Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.vertex=null;Microsoft.Msagl.Routing.Spline.ConeSpanner.SweepEvent.ctor.call(this);this.vertex=n},Vertex$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_Vertex:function(){return this.vertex},set_Vertex:function(n){this.vertex=n},Site$$:"Microsoft.Msagl.Core.Geometry.Point",get_Site:function(){return this.vertex.get_Point()},Polyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_Polyline:function(){return this.vertex.get_Polyline()}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$ConeSpanner$VertexEvent);Microsoft$Msagl$Routing$Visibility$Diagonal={fullname:"Microsoft.Msagl.Routing.Visibility.Diagonal",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.leftTangent=null;this.rightTangent=null;this.rbNode=null;System.Object.ctor.call(this);this.set_LeftTangent(n);this.set_RightTangent(t)},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0},{1}",[this.get_Start(),this.get_End()])},Start$$:"Microsoft.Msagl.Core.Geometry.Point",get_Start:function(){return this.leftTangent.get_End().get_Point()},End$$:"Microsoft.Msagl.Core.Geometry.Point",get_End:function(){return this.rightTangent.get_End().get_Point()},LeftTangent$$:"Microsoft.Msagl.Routing.Visibility.Tangent",get_LeftTangent:function(){return this.leftTangent},set_LeftTangent:function(n){this.leftTangent=n},RightTangent$$:"Microsoft.Msagl.Routing.Visibility.Tangent",get_RightTangent:function(){return this.rightTangent},set_RightTangent:function(n){this.rightTangent=n},RbNode$$:"Microsoft.Msagl.Core.DataStructures.RBNode`1[[Microsoft.Msagl.Routing.Visibility.Diagonal]]",get_RbNode:function(){return this.rbNode},set_RbNode:function(n){this.rbNode=n}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$Diagonal);Microsoft$Msagl$Routing$Visibility$InteractiveTangentVisibilityGraphCalculator={fullname:"Microsoft.Msagl.Routing.Visibility.InteractiveTangentVisibilityGraphCalculator",baseTypeName:"Microsoft.Msagl.Core.AlgorithmBase",staticDefinition:{cctor:function(){},MarkDiagonalAsActiveInTangents:function(n){n.get_LeftTangent().set_Diagonal(n);n.get_RightTangent().set_Diagonal(n)},RayIntersectDiagonal:function(n,t,i){var r=i.get_Start(),u=i.get_End();return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n,r,u)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n,t,r)!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n,t,u)!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.polygons=null;this.addedPolygons=null;this.visibilityGraph=null;this.diagonals=null;this.tangents=null;this.activeDiagonalTree=null;this.currentPolygon=null;this.activeDiagonalComparer=new Microsoft.Msagl.Routing.Visibility.ActiveDiagonalComparerWithRay.ctor;this.useLeftPTangents=!1;Microsoft.Msagl.Core.AlgorithmBase.ctor.call(this);this.polygons=n;this.visibilityGraph=i;this.addedPolygons=t},RunInternal:function(){this.useLeftPTangents=!0;this.CalculateAndAddEdges();this.useLeftPTangents=!1;this.CalculateAndAddEdges()},CalculateAndAddEdges:function(){for(var n=this.addedPolygons.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.CalculateVisibleTangentsFromPolygon(t),this.ProgressStep()},CalculateVisibleTangentsFromPolygon:function(n){this.currentPolygon=n;this.AllocateDataStructures();this.OrganizeTangents();this.InitActiveDiagonals();this.Sweep()},AllocateDataStructures:function(){this.tangents=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.Tangent.ctor);this.diagonals=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.Diagonal.ctor);this.activeDiagonalTree=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Visibility.Diagonal.ctor,this.activeDiagonalComparer)},Sweep:function(){var t,n;if(!(this.tangents.get_Count()<2))for(t=1;t<this.tangents.get_Count();t++)n=this.tangents.get_Item$$Int32(t),n.get_Diagonal()!=null?(n.get_Diagonal().get_RbNode()==this.activeDiagonalTree.TreeMinimum()&&this.AddVisibleEdge(n),n.get_IsHigh()&&this.RemoveDiagonalFromActiveNodes(n.get_Diagonal())):n.get_IsLow()&&(this.activeDiagonalComparer.set_PointOnTangentAndInsertedDiagonal(n.get_End().get_Point()),this.InsertActiveDiagonal(new Microsoft.Msagl.Routing.Visibility.Diagonal.ctor(n,n.get_Comp())),n.get_Diagonal().get_RbNode()==this.activeDiagonalTree.TreeMinimum()&&this.AddVisibleEdge(n))},AddVisibleEdge:function(n){Microsoft.Msagl.Routing.Visibility.VisibilityGraph.AddEdge$$VisibilityVertex$$VisibilityVertex(this.visibilityGraph.GetVertex(n.get_Start()),this.visibilityGraph.GetVertex(n.get_End()))},InitActiveDiagonals:function(){var t,f;if(this.tangents.get_Count()!=0){for(var n=this.tangents.get_Item$$Int32(0),i=n.get_Start().get_Point(),r=n.get_End().get_Point(),u=this.diagonals.GetEnumerator();u.MoveNext();)t=u.get_Current(),Microsoft.Msagl.Routing.Visibility.InteractiveTangentVisibilityGraphCalculator.RayIntersectDiagonal(i,r,t)&&(this.activeDiagonalComparer.set_PointOnTangentAndInsertedDiagonal(Microsoft.Msagl.Routing.Visibility.ActiveDiagonalComparerWithRay.IntersectDiagonalWithRay(i,r,t)),this.InsertActiveDiagonal(t));n.get_Diagonal().get_RbNode()==this.activeDiagonalTree.TreeMinimum()&&this.AddVisibleEdge(n);n.get_IsLow()==!1&&(f=n.get_Diagonal(),this.RemoveDiagonalFromActiveNodes(f))}},RemoveDiagonalFromActiveNodes:function(n){var t=this.activeDiagonalTree.DeleteSubtree(n.get_RbNode());t!=null&&t.Item!=null&&t.Item.set_RbNode(t);n.get_LeftTangent().set_Diagonal(null);n.get_RightTangent().set_Diagonal(null)},InsertActiveDiagonal:function(n){n.set_RbNode(this.activeDiagonalTree.Insert(n));Microsoft.Msagl.Routing.Visibility.InteractiveTangentVisibilityGraphCalculator.MarkDiagonalAsActiveInTangents(n)},TangentComparison:function(n,t){return Microsoft.Msagl.Routing.Visibility.StemStartPointComparer.CompareVectorsByAngleToXAxis(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_End().get_Point(),n.get_Start().get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_End().get_Point(),t.get_Start().get_Point()))},AllObstacles$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Visibility.Polygon]]",get_AllObstacles:function(){for(var t=[],r=this.addedPolygons.GetEnumerator(),i,n;r.MoveNext();)n=r.get_Current(),t.push(n);for(i=this.polygons.GetEnumerator();i.MoveNext();)n=i.get_Current(),t.push(n);return t},OrganizeTangents:function(){for(var t=this.get_AllObstacles().GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),n!=this.currentPolygon&&this.ProcessPolygonQ(n);this.tangents.Sort$$Comparison$1($CreateDelegate(this,this.TangentComparison))},ProcessPolygonQ:function(n){var r=new Microsoft.Msagl.Routing.Visibility.TangentPair.ctor(this.currentPolygon,n),u,t,i;this.useLeftPTangents?r.CalculateLeftTangents():r.CalculateRightTangents();u=this.useLeftPTangents?r.leftPLeftQ:r.rightPLeftQ;t=new Microsoft.Msagl.Routing.Visibility.Tangent.ctor(this.currentPolygon.get_Item$$Int32(u.get_Item1()),n.get_Item$$Int32(u.get_Item2()));t.set_IsLow(!0);t.set_SeparatingPolygons(!this.useLeftPTangents);u=this.useLeftPTangents?r.leftPRightQ:r.rightPRightQ;i=new Microsoft.Msagl.Routing.Visibility.Tangent.ctor(this.currentPolygon.get_Item$$Int32(u.get_Item1()),n.get_Item$$Int32(u.get_Item2()));i.set_IsLow(!1);i.set_SeparatingPolygons(this.useLeftPTangents);t.set_Comp(i);i.set_Comp(t);this.tangents.Add(t);this.tangents.Add(i);this.diagonals.Add(new Microsoft.Msagl.Routing.Visibility.Diagonal.ctor(t,i))}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$InteractiveTangentVisibilityGraphCalculator);Microsoft$Msagl$Routing$Rectilinear$PointComparer={fullname:"Microsoft.Msagl.Routing.Rectilinear.PointComparer",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Rectilinear.PointComparer.differenceEpsilon=Microsoft.Msagl.Core.Geometry.ApproximateComparer.DistanceEpsilon/2},DifferenceEpsilon$$:"System.Double",get_DifferenceEpsilon:function(){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.differenceEpsilon},Equal$$Point$$Point:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(n.get_X(),t.get_X())&&Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(n.get_Y(),t.get_Y())},Equal$$Double$$Double:function(n,t){return 0==Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n,t)},Compare$$Double$$Double:function(n,t){Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Double(n);Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Double(t);var i=0;return n+Microsoft.Msagl.Routing.Rectilinear.PointComparer.get_DifferenceEpsilon()<t?i=-1:t+Microsoft.Msagl.Routing.Rectilinear.PointComparer.get_DifferenceEpsilon()<n&&(i=1),System.Diagnostics.Debug.Assert$$Boolean(i<0==(Microsoft.Msagl.Core.Geometry.Directions.East==Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,0),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,0)))),System.Diagnostics.Debug.Assert$$Boolean(0==i==(Microsoft.Msagl.Core.Geometry.Directions.None==Microsoft.Msagl.Core.Geometry.CompassVector.VectorDirection$$Point$$Point(new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,0),new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(t,0)))),i},Compare$$Point$$Point:function(n,t){var i=Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n.get_X(),t.get_X());return 0==i&&(i=Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n.get_Y(),t.get_Y())),i},LessOrEqual:function(n,t){var i=Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n,t);return i<0||i==0},Less:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(n,t)<0},Assert_Rounded$$Double:function(n){System.Math.Log10(System.Math.Abs$$Double(n))<14-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_DistanceEpsilonPrecision()&&System.Diagnostics.Debug.Assert$$Boolean$$String(System.Math.Abs$$Double(Microsoft.Msagl.Core.Geometry.ApproximateComparer.Round$$Double(n)-n)<Microsoft.Msagl.Routing.Rectilinear.PointComparer.get_DifferenceEpsilon(),"unRounded value passed")},Assert_Rounded$$Point:function(n){Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Double(n.get_X());Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Double(n.get_Y())},GetDirections:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Point(n),Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Point(t),Microsoft.Msagl.Core.Geometry.CompassVector.DirectionsFromPointToPoint(n,t)},GetPureDirection$$Point$$Point:function(n,t){Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Point(n);Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Point(t);var i=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n,t);return System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(i),"Impure direction found"),i},IsPureDirection$$Point$$Point:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Point(n),Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Point(t),Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n,t))},IsPureDirection$$Directions:function(n){return Microsoft.Msagl.Core.Geometry.CompassVector.IsPureDirection$$Directions(n)},IsPureLower:function(n,t){Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Point(n);Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Point(t);var i=Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n,t);return Microsoft.Msagl.Core.Geometry.Directions.East==i||Microsoft.Msagl.Core.Geometry.Directions.North==i},GetPureDirection$$VisibilityVertex$$VisibilityVertex:function(n,t){return Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Point(n.Point),Microsoft.Msagl.Routing.Rectilinear.PointComparer.Assert_Rounded$$Point(t.Point),Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetPureDirection$$Point$$Point(n.Point,t.Point)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$PointComparer);Microsoft$Msagl$Routing$Visibility$PointVisibilityCalculator={fullname:"Microsoft.Msagl.Routing.Visibility.PointVisibilityCalculator",baseTypeName:"System.Object",staticDefinition:{CalculatePointVisibilityGraph:function(n,t,i,r,u){var e=t.FindVertex(i),f;if(e!=null){u.Value=e;return}f=new Microsoft.Msagl.Routing.Visibility.PointVisibilityCalculator.ctor(n,t,i,r);f.FillGraph();u.Value=f.get_QVertex();System.Diagnostics.Debug.Assert$$Boolean(u.Value!=null)},LineTouchesPolygon:function(n,t){var r=t.get_Polyline().Prev(t).get_Point(),u=t.get_Polyline().Next(t).get_Point(),i=t.get_Point();return Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,i,r)*Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(n,i,u)>=0},GetIncomingSide:function(n){return n.get_PrevOnPolyline()}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r){this.activeEdgeComparer=null;this.activeSidesTree=null;this.sideNodes=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor,Microsoft.Msagl.Core.DataStructures.RBNode$1.ctor);this.heapForSorting=null;this.visibilityGraph=null;this.visibilityKind=Microsoft.Msagl.Routing.Visibility.VisibilityKind.Regular;this.visibleBoundaries=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Routing.Visibility.Stem.ctor);this.q=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.qPolylinePoint=null;this.sortedListOfPolypoints=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor);this.holes=null;this._QVertex=null;System.Object.ctor.call(this);this.holes=n;this.visibilityGraph=t;this.q=i;this.qPolylinePoint=new Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor(this.q);this.set_QVertex(this.visibilityGraph.AddVertex$$PolylinePoint(this.qPolylinePoint));this.visibilityKind=r;this.heapForSorting=new Microsoft.Msagl.Core.DataStructures.BinaryHeapWithComparer$1.ctor(Microsoft.Msagl.Routing.Visibility.Stem.ctor,new Microsoft.Msagl.Routing.Visibility.StemStartPointComparer.ctor(this.q))},QVertex$$:"Microsoft.Msagl.Routing.Visibility.VisibilityVertex",get_QVertex:function(){return this._QVertex},set_QVertex:function(n){this._QVertex=n},FillGraph:function(){this.ComputeHoleBoundariesPossiblyVisibleFromQ();this.visibleBoundaries.get_Count()>0&&(this.SortSAndInitActiveSides(),this.Sweep())},SortSAndInitActiveSides:function(){this.InitHeapAndInsertActiveSides();for(var n=this.heapForSorting.GetMinimum();;n=this.heapForSorting.GetMinimum())if(this.sortedListOfPolypoints.Add(n.get_Start()),n.MoveStartClockwise()?this.heapForSorting.ChangeMinimum(n):this.heapForSorting.Dequeue(),this.heapForSorting.get_Count()==0)break},InitHeapAndInsertActiveSides:function(){for(var n=this.GetInitialVisibleBoundaryStemsAndInsertActiveSides().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.heapForSorting.Enqueue(t)},GetInitialVisibleBoundaryStemsAndInsertActiveSides:function(){for(var i=[],e=this.visibleBoundaries.GetEnumerator(),n,r,f;e.MoveNext();){for(var o=e.get_Current(),h=o.get_Key(),t=o.get_Value(),u=!1,s=t.get_Sides().GetEnumerator();s.MoveNext();)if(n=s.get_Current(),r=n,r.get_Point().get_Y()<this.q.get_Y()){if(n.get_NextOnPolyline().get_Point().get_Y()>=this.q.get_Y()&&(f=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(this.q,r.get_Point(),n.get_NextOnPolyline().get_Point()),f==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise||f==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear)){u=!0;i.push(new Microsoft.Msagl.Routing.Visibility.Stem.ctor(t.get_Start(),n));i.push(new Microsoft.Msagl.Routing.Visibility.Stem.ctor(n.get_NextOnPolyline(),t.get_End()));this.RegisterActiveSide(n);break}}else if(r.get_Point().get_Y()>this.q.get_Y())break;else if(n.get_Point().get_X()>=this.q.get_X()){u=!0;i.push(new Microsoft.Msagl.Routing.Visibility.Stem.ctor(n,t.get_End()));n!=t.get_Start()&&i.push(new Microsoft.Msagl.Routing.Visibility.Stem.ctor(t.get_Start(),h.Prev(r)));this.RegisterActiveSide(n);break}u||i.push(t)}return i},RegisterActiveSide:function(n){this.activeEdgeComparer.set_IntersectionOfTheRayAndInsertedEdge(this.activeEdgeComparer.IntersectEdgeWithRay$$PolylinePoint$$Point(n,new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(1,0)));this.sideNodes.set_Item$$TKey(n,this.activeSidesTree.Insert(n))},Sweep:function(){for(var n=this.sortedListOfPolypoints.GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),this.SweepPolylinePoint(t)},SweepPolylinePoint:function(n){var f=Microsoft.Msagl.Routing.Visibility.PointVisibilityCalculator.GetIncomingSide(n),t=this.GetOutgoingSide(n),i,u,r;if(this.activeEdgeComparer.set_IntersectionOfTheRayAndInsertedEdge(n.get_Point()),function(){var n={Value:i},t=this.sideNodes.TryGetValue(f,n);return i=n.Value,t}.call(this)&&i!=null)i==this.activeSidesTree.TreeMinimum()&&this.AddEdge(n),t!=null?(i.Item=t,this.sideNodes.set_Item$$TKey(t,i)):(u=this.activeSidesTree.DeleteSubtree(i),u!=null&&u.Item!=null&&this.sideNodes.set_Item$$TKey(u.Item,u)),this.sideNodes.Remove(f);else if(t!=null)(function(){var n={Value:r},i=this.sideNodes.TryGetValue(t,n);return r=n.Value,i}).call(this)&&r!=null||(r=this.activeSidesTree.Insert(t),this.sideNodes.set_Item$$TKey(t,r),r==this.activeSidesTree.TreeMinimum()&&this.AddEdge(n));else throw $CreateException(new System.InvalidOperationException.ctor,new Error);},AddEdge:function(n){(this.visibilityKind==Microsoft.Msagl.Routing.Visibility.VisibilityKind.Regular||this.visibilityKind==Microsoft.Msagl.Routing.Visibility.VisibilityKind.Tangent&&Microsoft.Msagl.Routing.Visibility.PointVisibilityCalculator.LineTouchesPolygon(this.get_QVertex().Point,n))&&this.visibilityGraph.AddEdge$$Point$$Point$$Func$3$VisibilityVertex$VisibilityVertex$VisibilityEdge(this.get_QVertex().Point,n.get_Point(),$CreateAnonymousDelegate(this,function(n,t){return new Microsoft.Msagl.Routing.Visibility.TollFreeVisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex(n,t)}))},GetOutgoingSide:function(n){var t=this.visibleBoundaries.get_Item$$TKey(n.get_Polyline());return n==t.get_End()?null:n},ComputeHoleBoundariesPossiblyVisibleFromQ:function(){var n,t;for(this.InitActiveEdgesAndActiveEdgesComparer(),n=this.holes.GetEnumerator();n.MoveNext();)t=n.get_Current(),this.ComputeVisiblePartOfTheHole(t)},InitActiveEdgesAndActiveEdgesComparer:function(){this.activeEdgeComparer=function(){var n=new Microsoft.Msagl.Routing.Visibility.ActiveEdgeComparerWithRay.ctor;return n.set_Pivot(this.q),n}.call(this);this.activeSidesTree=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint.ctor,this.activeEdgeComparer)},ComputeVisiblePartOfTheHole:function(n){for(var r=!0,i,t=n.get_StartPoint();!this.HoleSideIsVisibleFromQ(n,t);t=n.Next(t))System.Diagnostics.Debug.Assert$$Boolean(r||t!=n.get_StartPoint()),r=!1;if(i=n.Next(t),r)while(this.HoleSideIsVisibleFromQ(n,n.Prev(t)))t=n.Prev(t);for(;this.HoleSideIsVisibleFromQ(n,i);i=n.Next(i));this.visibleBoundaries.set_Item$$TKey(n,new Microsoft.Msagl.Routing.Visibility.Stem.ctor(t,i))},HoleSideIsVisibleFromQ:function(n,t){return Microsoft.Msagl.Core.Geometry.Point.SignedDoubledTriangleArea(this.q,t.get_Point(),n.Next(t).get_Point())>=-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_SquareOfDistanceEpsilon()}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$PointVisibilityCalculator);Microsoft$Msagl$Routing$Visibility$Polygon={fullname:"Microsoft.Msagl.Routing.Visibility.Polygon",baseTypeName:"System.Object",staticDefinition:{Distance$$Polygon$$Polygon$$Point$$Point:function(n,t,i,r){var u=new Microsoft.Msagl.Routing.Visibility.TangentPair.ctor(n,t);return u.FindClosestPoints$$Point$$Point(i,r),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(i.Value,r.Value).get_Length()},Distance$$Polygon$$Polygon:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.Visibility.Polygon.PolygonIsLegalDebug(n));System.Diagnostics.Debug.Assert$$Boolean(Microsoft.Msagl.Routing.Visibility.Polygon.PolygonIsLegalDebug(t));var i,r;return function(){var u={Value:i},f={Value:r},e=Microsoft.Msagl.Routing.Visibility.Polygon.Distance$$Polygon$$Polygon$$Point$$Point(n,t,u,f);return i=u.Value,r=f.Value,e}()},PolygonIsLegalDebug:function(n){for(var i=n.get_Polyline(),t=i.get_StartPoint();t.get_Next()!=null&&t.get_Next().get_Next()!=null;t=t.get_Next())if(Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Point(),t.get_Next().get_Point(),t.get_Next().get_Next().get_Point())==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear)return!1;return!0},Distance$$Polygon$$Point:function(n,t){for(var u,f,r=Infinity,i=0;i<n.get_Count();i++)f=function(){var r={Value:u},f=Microsoft.Msagl.Core.Geometry.Point.DistToLineSegment(t,n.points[i].get_Point(),n.points[(i+1)%n.get_Count()].get_Point(),r);return u=r.Value,f}(),r=System.Math.Min$$Double$$Double(r,f);return r}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.polyline=null;this.points=null;System.Object.ctor.call(this);this.polyline=n;this.points=new Array(n.get_Count());for(var t=0,i=n.get_StartPoint();t<n.get_Count();t++,i=i.get_Next())this.points[t]=i},Polyline$$:"Microsoft.Msagl.Core.Geometry.Curves.Polyline",get_Polyline:function(){return this.polyline},Next:function(n){return this.Module(n+1)},Prev:function(n){return this.Module(n-1)},Count$$:"System.Int32",get_Count:function(){return this.get_Polyline().get_Count()},Module:function(n){return n<0?n+this.get_Count():n<this.get_Count()?n:n-this.get_Count()},Item$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_Item$$Int32:function(n){return this.points[this.Module(n)]},Pnt:function(n){return this.get_Item$$Int32(n).get_Point()},toString:function(){return this.polyline.toString()},Median:function(n,t){return(System.Diagnostics.Debug.Assert$$Boolean(n!=t),t>n)?(t+n)/2|0:this.Module((t+this.get_Count()+n)/2|0)},FindTheFurthestVertexFromBisector:function(n,t,i,r){var f=r.Rotate(1.5707963267949),u,e;Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.polyline.get_StartPoint().get_Point(),i),f)<0&&(f=Microsoft.Msagl.Core.Geometry.Point.op_UnaryNegation(f));n==t&&(t=this.Next(n));do u=this.Median(t,n),e=this.Pnt(u),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.Pnt(this.Next(u)),e),f)>=0?t=this.Next(u):n=Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.Pnt(this.Prev(u)),e),f)>=0?this.Prev(u):t=u;while(n!=t);return n},GetTangentPoints:function(n,t,i){var r=new Microsoft.Msagl.Routing.Visibility.BimodalSequence.ctor(this.GetSequenceDelegate(i),this.get_Count());n.Value=r.FindMaximum();t.Value=r.FindMinimum()},GetSequenceDelegate:function(n){var t=this.Pnt(0);return $CreateAnonymousDelegate(this,function(i){var r=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point$$Point(t,n,this.Pnt(i));return r<3.14159265358979?r:r-6.28318530717959})}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$Polygon);Microsoft$Msagl$Routing$Visibility$SegmentBase={fullname:"Microsoft.Msagl.Routing.Visibility.SegmentBase",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)},Start$$:"Microsoft.Msagl.Core.Geometry.Point",End$$:"Microsoft.Msagl.Core.Geometry.Point",Direction$$:"Microsoft.Msagl.Core.Geometry.Point",get_Direction:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.get_End(),this.get_Start())},toString:function(){return this.get_Start()+" "+this.get_End()}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$SegmentBase);Microsoft$Msagl$Routing$Visibility$StemStartPointComparer={fullname:"Microsoft.Msagl.Routing.Visibility.StemStartPointComparer",baseTypeName:"System.Object",staticDefinition:{CompareVectorsByAngleToXAxis:function(n,t){return n.get_Y()>=0?t.get_Y()<0?-1:function(){var i={Value:n},r={Value:t},u=Microsoft.Msagl.Routing.Visibility.StemStartPointComparer.CompareVectorsPointingToTheSameYHalfPlane(i,r);return n=i.Value,t=r.Value,u}():t.get_Y()>=0?1:function(){var i={Value:n},r={Value:t},u=Microsoft.Msagl.Routing.Visibility.StemStartPointComparer.CompareVectorsPointingToTheSameYHalfPlane(i,r);return n=i.Value,t=r.Value,u}()},CompareVectorsPointingToTheSameYHalfPlane:function(n,t){var r=n.Value.get_X()*t.Value.get_Y()-n.Value.get_Y()*t.Value.get_X(),i;if(r>Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())return-1;if(r<-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance())return 1;if(n.Value.get_X()>=0){if(t.Value.get_X()<0)return-1}else if(t.Value.get_X()>=0)return 1;return(i=System.Math.Abs$$Double(n.Value.get_X())-System.Math.Abs$$Double(t.Value.get_X()),i<0)?-1:i>0?1:(i=System.Math.Abs$$Double(n.Value.get_Y())-System.Math.Abs$$Double(t.Value.get_Y()),i<0)?-1:i>0?1:0}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.pivot=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.pivot=n}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$StemStartPointComparer);Microsoft$Msagl$Routing$Visibility$UnimodalSequence={fullname:"Microsoft.Msagl.Routing.Visibility.UnimodalSequence",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.sequence=null;this.length=0;System.Object.ctor.call(this);this.set_Sequence(n);this.set_Length(t)},Sequence$$:"System.Func`2[[System.Int32],[System.Double]]",get_Sequence:function(){return this.sequence},set_Sequence:function(n){this.sequence=n},Length$$:"System.Int32",get_Length:function(){return this.length},set_Length:function(n){this.length=n},FindMinimum:function(){var n=0,t=this.get_Length()-1,i=n+(t-n)/2|0,r=this.get_Sequence()(i);if(r>=this.get_Sequence()(0)&&r>=this.get_Sequence()(this.get_Length()-1))return this.get_Sequence()(0)<this.get_Sequence()(this.get_Length()-1)?0:this.get_Length()-1;while(t-n>1){i=n+(t-n)/2|0;switch(this.BehaviourAtIndex(i)){case Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Decreasing:n=i;break;case Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Increasing:t=i;break;case Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Extremum:return i}}return n==t?n:this.get_Sequence()(n)<=this.get_Sequence()(t)?n:t},BehaviourAtIndex:function(n){var t=this.get_Sequence()(n),i,r,u;return n==0?(i=this.get_Sequence()(1),i==t)?Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Extremum:i>t?Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Increasing:Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Decreasing:n==this.get_Length()-1?(i=this.get_Sequence()(this.get_Length()-2),i==t)?Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Extremum:i>t?Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Decreasing:Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Increasing:(r=t-this.get_Sequence()(n-1),u=this.get_Sequence()(n+1)-t,r*u<=0)?Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Extremum:r>0?Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Increasing:Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Decreasing},FindMaximum:function(){var n=0,t=this.get_Length()-1,i=n+(t-n)/2|0,r=this.get_Sequence()(i);if(r<=this.get_Sequence()(0)&&r<=this.get_Sequence()(this.get_Length()-1))return this.get_Sequence()(0)>this.get_Sequence()(this.get_Length()-1)?0:this.get_Length()-1;while(t-n>1){i=n+(t-n)/2|0;switch(this.BehaviourAtIndex(i)){case Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Decreasing:t=i;break;case Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Increasing:n=i;break;case Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior.Extremum:return i}}return n==t?n:this.get_Sequence()(n)>=this.get_Sequence()(t)?n:t}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$UnimodalSequence);Microsoft$Msagl$Routing$Visibility$VisibilityKind={fullname:"Microsoft.Msagl.Routing.Visibility.VisibilityKind",staticDefinition:{Regular:0,Tangent:1},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Routing$Visibility$VisibilityKind);Microsoft$Msagl$Routing$Visibility$VisibilityEdge={fullname:"Microsoft.Msagl.Routing.Visibility.VisibilityEdge",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Routing.Visibility.VisibilityEdge.DefaultWeight=1}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.LengthMultiplier=1;this._Weight=0;this._IsPassable=null;this._Source=null;this._Target=null;System.Object.ctor.call(this)},ctor$$VisibilityVertex$$VisibilityVertex$$Double:function(n,t,i){this.LengthMultiplier=1;this._Weight=0;this._IsPassable=null;this._Source=null;this._Target=null;System.Object.ctor.call(this);System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.Point.op_Inequality(n.Point,t.Point),"Self-edges are not allowed");this.set_Source(n);this.set_Target(t);this.set_Weight(i)},ctor$$VisibilityVertex$$VisibilityVertex:function(n,t){this.LengthMultiplier=1;this._Weight=0;this._IsPassable=null;this._Source=null;this._Target=null;Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex$$Double.call(this,n,t,1)},Weight$$:"System.Double",get_Weight:function(){return this._Weight},set_Weight:function(n){this._Weight=n},IsPassable$$:"System.Func`1[[System.Boolean]]",get_IsPassable:function(){return this._IsPassable},set_IsPassable:function(n){this._IsPassable=n},SourcePoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_SourcePoint:function(){return this.get_Source().Point},TargetPoint$$:"Microsoft.Msagl.Core.Geometry.Point",get_TargetPoint:function(){return this.get_Target().Point},Source$$:"Microsoft.Msagl.Routing.Visibility.VisibilityVertex",get_Source:function(){return this._Source},set_Source:function(n){this._Source=n},Target$$:"Microsoft.Msagl.Routing.Visibility.VisibilityVertex",get_Target:function(){return this._Target},set_Target:function(n){this._Target=n},Length$$:"System.Double",get_Length:function(){return Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(this.get_SourcePoint(),this.get_TargetPoint()).get_Length()*this.LengthMultiplier},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0}->{1} ({2})",[this.get_Source(),this.get_Target(),this.get_Weight().ToString$$String$$IFormatProvider("0.0###",System.Globalization.CultureInfo.get_InvariantCulture())])},ReversedClone:function(){return new Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex(this.get_Target(),this.get_Source())},Clone:function(){return new Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex(this.get_Source(),this.get_Target())}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$VisibilityEdge);Microsoft$Msagl$Routing$Visibility$VisibilityGraph={fullname:"Microsoft.Msagl.Routing.Visibility.VisibilityGraph",baseTypeName:"System.Object",staticDefinition:{GetVisibilityGraphForShortestPath:function(n,t,i,r,u){var f=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityGraph.OrientHolesClockwise(i)),e=Microsoft.Msagl.Routing.Visibility.VisibilityGraph.CalculateGraphOfBoundaries(f),o=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Routing.Visibility.Polygon.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Routing.Visibility.Polygon.ctor,f,function(n){return new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(n)}));return Microsoft.Msagl.Routing.Visibility.TangentVisibilityGraphCalculator.AddTangentVisibilityEdgesToGraph(o,e),Microsoft.Msagl.Routing.Visibility.PointVisibilityCalculator.CalculatePointVisibilityGraph(f,e,n,Microsoft.Msagl.Routing.Visibility.VisibilityKind.Tangent,r),Microsoft.Msagl.Routing.Visibility.PointVisibilityCalculator.CalculatePointVisibilityGraph(f,e,t,Microsoft.Msagl.Routing.Visibility.VisibilityKind.Tangent,u),e},FillVisibilityGraphForShortestPath:function(n){var t=new System.Collections.Generic.List$1.ctor$$IEnumerable$1(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityGraph.OrientHolesClockwise(n)),i=Microsoft.Msagl.Routing.Visibility.VisibilityGraph.CalculateGraphOfBoundaries(t),r=System.Linq.Enumerable.ToList$1(Microsoft.Msagl.Routing.Visibility.Polygon.ctor,System.Linq.Enumerable.Select$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,Microsoft.Msagl.Routing.Visibility.Polygon.ctor,t,function(n){return new Microsoft.Msagl.Routing.Visibility.Polygon.ctor(n)}));return Microsoft.Msagl.Routing.Visibility.TangentVisibilityGraphCalculator.AddTangentVisibilityEdgesToGraph(r,i),i},CalculateGraphOfBoundaries:function(n){for(var t=new Microsoft.Msagl.Routing.Visibility.VisibilityGraph.ctor,i=n.GetEnumerator(),r;i.MoveNext();)r=i.get_Current(),t.AddHole(r);return t},OrientHolesClockwise:function(n){for(var u=[],f=n.GetEnumerator(),i,t,r;f.MoveNext();)for(i=f.get_Current(),t=i.get_StartPoint();;t=t.get_Next())if(r=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(t.get_Point(),t.get_Next().get_Point(),t.get_Next().get_Next().get_Point()),r!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Collinear){u.push(r==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise?i:Cast(i.Reverse(),Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor));break}return u},AddEdge$$VisibilityVertex$$VisibilityVertex:function(n,t){var r,i;if(function(){var i={Value:r},u=n.TryGetEdge(t,i);return r=i.Value,u}())return r;if(n==t){System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"Self-edges are not allowed");throw $CreateException(new System.InvalidOperationException.ctor$$String("Self-edges are not allowed"),new Error);}return i=new Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex(n,t),n.get_OutEdges().Insert(i),t.get_InEdges().Add(i),i},AddEdge$$VisibilityEdge:function(n){System.Diagnostics.Debug.Assert$$Boolean(n.get_Source()!=n.get_Target());n.get_Source().get_OutEdges().Insert(n);n.get_Target().get_InEdges().Add(n)},FindEdge$$VisibilityEdge:function(n){return function(){var t={Value:n},i=n.get_Source().TryGetEdge(n.get_Target(),t);return n=t.Value,i}()?n:null},RemoveEdge$$VisibilityEdge:function(n){n.get_Source().get_OutEdges().Remove(n);n.get_Target().get_InEdges().Remove(n)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._prevEdgesDictionary=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor);this.visVertexToId=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,System.Int32.ctor);this.vertexFactory=$CreateAnonymousDelegate(this,function(n){return new Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor(n)});this.pointToVertexMap=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Point.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor);System.Object.ctor.call(this)},ClearPrevEdgesTable:function(){this._prevEdgesDictionary.Clear()},ShrinkLengthOfPrevEdge:function(n,t){this._prevEdgesDictionary.get_Item$$TKey(n).LengthMultiplier=t},PreviosVertex:function(n){var t;return function(){var i={Value:t},r=this._prevEdgesDictionary.TryGetValue(n,i);return t=i.Value,r}.call(this)?t.get_Source()==n?t.get_Target():t.get_Source():null},SetPreviousEdge:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(n==t.get_Source()||n==t.get_Target());this._prevEdgesDictionary.set_Item$$TKey(n,t)},VertexFactory$$:"System.Func`2[[Microsoft.Msagl.Core.Geometry.Point],[Microsoft.Msagl.Routing.Visibility.VisibilityVertex]]",get_VertexFactory:function(){return this.vertexFactory},set_VertexFactory:function(n){this.vertexFactory=n},AddHole:function(n){for(var t=n.get_StartPoint();t!=n.get_EndPoint();)this.AddEdge$$PolylinePoint$$PolylinePoint(t,t.get_Next()),t=t.get_Next();this.AddEdge$$PolylinePoint$$PolylinePoint(n.get_EndPoint(),n.get_StartPoint())},Edges$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Visibility.VisibilityEdge]]",get_Edges:function(){return System.Linq.Enumerable.SelectMany$2$$IEnumerable$1$$Func$2(Microsoft.Msagl.Routing.Visibility.VisibilityVertex.ctor,Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,this.get_PointToVertexMap().get_Values(),$CreateAnonymousDelegate(this,function(n){return n.get_OutEdges()}))},PointToVertexMap$$:"System.Collections.Generic.Dictionary`2[[Microsoft.Msagl.Core.Geometry.Point],[Microsoft.Msagl.Routing.Visibility.VisibilityVertex]]",get_PointToVertexMap:function(){return this.pointToVertexMap},VertexCount$$:"System.Int32",get_VertexCount:function(){return this.get_PointToVertexMap().get_Count()},AddVertex$$PolylinePoint:function(n){return this.AddVertex$$Point(n.get_Point())},AddVertex$$Point:function(n){var t,i;return function(){var i={Value:t},r=this.get_PointToVertexMap().TryGetValue(n,i);return t=i.Value,r}.call(this)?t:(i=this.get_VertexFactory()(n),this.get_PointToVertexMap().set_Item$$TKey(n,i),i)},AddVertex$$VisibilityVertex:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(!this.get_PointToVertexMap().ContainsKey(n.Point),"A vertex already exists at this location");this.get_PointToVertexMap().set_Item$$TKey(n.Point,n)},ContainsVertex:function(n){return this.get_PointToVertexMap().ContainsKey(n)},AddEdge$$PolylinePoint$$PolylinePoint:function(n,t){this.AddEdge$$Point$$Point(n.get_Point(),t.get_Point())},AddEdge$$Point$$Point:function(n,t){var r,u=this.FindVertex(n),i=null;return u!=null&&(i=this.FindVertex(t),i!=null&&function(){var n={Value:r},t=u.TryGetEdge(i,n);return r=n.Value,t}.call(this))?r:(u==null?(u=this.AddVertex$$Point(n),i=this.AddVertex$$Point(t)):i==null&&(i=this.AddVertex$$Point(t)),r=new Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor$$VisibilityVertex$$VisibilityVertex(u,i),u.get_OutEdges().Insert(r),i.get_InEdges().Add(r),r)},AddEdge$$Point$$Point$$Func$3$VisibilityVertex$VisibilityVertex$VisibilityEdge:function(n,t,i){var u,f=this.FindVertex(n),r=null;return f!=null&&(r=this.FindVertex(t),r!=null&&function(){var n={Value:u},t=f.TryGetEdge(r,n);return u=n.Value,t}.call(this))?u:(f==null?(f=this.AddVertex$$Point(n),r=this.AddVertex$$Point(t)):r==null&&(r=this.AddVertex$$Point(t)),u=i(f,r),f.get_OutEdges().Insert(u),r.get_InEdges().Add(u),u)},FindVertex:function(n){var t;return function(){var i={Value:t},r=this.get_PointToVertexMap().TryGetValue(n,i);return t=i.Value,r}.call(this)?t:null},GetVertex:function(n){return this.FindVertex(n.get_Point())},Vertices:function(){return this.get_PointToVertexMap().get_Values()},RemoveVertex:function(n){for(var r=n.get_OutEdges().GetEnumerator(),i,t;r.MoveNext();)t=r.get_Current(),t.get_Target().RemoveInEdge(t);for(i=n.get_InEdges().GetEnumerator();i.MoveNext();)t=i.get_Current(),t.get_Source().RemoveOutEdge(t);this.get_PointToVertexMap().Remove(n.Point)},RemoveEdge$$VisibilityVertex$$VisibilityVertex:function(n,t){var i;(function(){var r={Value:i},u=n.TryGetEdge(t,r);return i=r.Value,u}).call(this)&&(i.get_Source().RemoveOutEdge(i),i.get_Target().RemoveInEdge(i))},RemoveEdge$$Point$$Point:function(n,t){var i=this.FindEdge$$Point$$Point(n,t);i!=null&&(i.get_Source().RemoveOutEdge(i),i.get_Target().RemoveInEdge(i))},FindEdge$$Point$$Point:function(n,t){var u=this.FindVertex(n),i,r;return u==null?null:(i=this.FindVertex(t),i==null)?null:function(){var n={Value:r},t=u.TryGetEdge(i,n);return r=n.Value,t}.call(this)?r:null},ClearEdges:function(){for(var n=this.Vertices().GetEnumerator(),t;n.MoveNext();)t=n.get_Current(),t.ClearEdges()}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$VisibilityGraph);Microsoft$Msagl$Routing$Visibility$VisibilityVertex={fullname:"Microsoft.Msagl.Routing.Visibility.VisibilityVertex",baseTypeName:"System.Object",staticDefinition:{FindFirst$$RbTree$1$VisibilityEdge$$Point:function(n,t){return Microsoft.Msagl.Routing.Visibility.VisibilityVertex.FindFirst$$RBNode$1$VisibilityEdge$$RbTree$1$VisibilityEdge$$Point(n.get_Root(),n,t)},FindFirst$$RBNode$1$VisibilityEdge$$RbTree$1$VisibilityEdge$$Point:function(n,t,i){if(n==t.get_Nil())return null;for(var r=null;n!=t.get_Nil();)n=Microsoft.Msagl.Core.Geometry.Point.op_GreaterThanOrEqual(n.Item.get_TargetPoint(),i)?(r=n).left:n.right;return r}},assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.Point=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.isReal=!1;this._isTerminal=!1;this._isShortestPathTerminal=!1;this._inEdges=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor);this._outEdges=null;this._Distance=0;System.Object.ctor.call(this);this._outEdges=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Visibility.VisibilityEdge.ctor,this);this.Point=n},InEdges$$:"System.Collections.Generic.List`1[[Microsoft.Msagl.Routing.Visibility.VisibilityEdge]]",get_InEdges:function(){return this._inEdges},OutEdges$$:"Microsoft.Msagl.Core.DataStructures.RbTree`1[[Microsoft.Msagl.Routing.Visibility.VisibilityEdge]]",get_OutEdges:function(){return this._outEdges},Degree$$:"System.Int32",get_Degree:function(){return this.get_InEdges().get_Count()+this.get_OutEdges().get_Count()},Distance$$:"System.Double",get_Distance:function(){return this._Distance},set_Distance:function(n){this._Distance=n},IsTerminal$$:"System.Boolean",get_IsTerminal:function(){return this._isTerminal},set_IsTerminal:function(n){this._isTerminal=n},IsShortestPathTerminal$$:"System.Boolean",get_IsShortestPathTerminal:function(){return this._isShortestPathTerminal},set_IsShortestPathTerminal:function(n){this._isShortestPathTerminal=n},toString:function(){return this.Point.toString()},RemoveOutEdge:function(n){this.get_OutEdges().Remove(n)},RemoveInEdge:function(n){for(var t=this.get_InEdges().get_Count()-1;t>=0;--t)if(this.get_InEdges().get_Item$$Int32(t)==n){this.get_InEdges().RemoveAt(t);break}},TryGetEdge:function(n,t){var i=Microsoft.Msagl.Routing.Visibility.VisibilityVertex.FindFirst$$RbTree$1$VisibilityEdge$$Point(this.get_OutEdges(),n.Point);return i!=null&&i.Item.get_Target()==n?(t.Value=i.Item,!0):(i=Microsoft.Msagl.Routing.Visibility.VisibilityVertex.FindFirst$$RbTree$1$VisibilityEdge$$Point(n.get_OutEdges(),this.Point),i!=null&&i.Item.get_Target()==this)?(t.Value=i.Item,!0):(t.Value=null,!1)},Compare:function(n,t){return n.get_TargetPoint().CompareTo(t.get_TargetPoint())},ClearEdges:function(){this._outEdges.Clear();this._inEdges.Clear()}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$VisibilityVertex);Microsoft$Msagl$Routing$Visibility$Stem={fullname:"Microsoft.Msagl.Routing.Visibility.Stem",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.start=null;this.end=null;System.Object.ctor.call(this);System.Diagnostics.Debug.Assert$$Boolean(n.get_Polyline()==t.get_Polyline());this.start=n;this.end=t},Start$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_Start:function(){return this.start},set_Start:function(n){this.start=n},End$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_End:function(){return this.end},set_End:function(n){this.end=n},Sides$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint]]",get_Sides:function(){for(var i=[],n=this.start,t;n!=this.end;)t=n,i.push(t),n=t.get_NextOnPolyline();return i},MoveStartClockwise:function(){return this.get_Start()!=this.get_End()?(this.set_Start(this.get_Start().get_NextOnPolyline()),!0):!1},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"Stem({0},{1})",[this.get_Start(),this.get_End()])}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$Stem);Microsoft$Msagl$Routing$Visibility$Tangent={fullname:"Microsoft.Msagl.Routing.Visibility.Tangent",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.comp=null;this.lowTangent=!1;this.separatingPolygons=!1;this.diagonal=null;this.start=null;this.end=null;System.Object.ctor.call(this);this.set_Start(n);this.set_End(t)},Comp$$:"Microsoft.Msagl.Routing.Visibility.Tangent",get_Comp:function(){return this.comp},set_Comp:function(n){this.comp=n},IsHigh$$:"System.Boolean",get_IsHigh:function(){return!this.get_IsLow()},IsLow$$:"System.Boolean",get_IsLow:function(){return this.lowTangent},set_IsLow:function(n){this.lowTangent=n},SeparatingPolygons$$:"System.Boolean",get_SeparatingPolygons:function(){return this.separatingPolygons},set_SeparatingPolygons:function(n){this.separatingPolygons=n},Diagonal$$:"Microsoft.Msagl.Routing.Visibility.Diagonal",get_Diagonal:function(){return this.diagonal},set_Diagonal:function(n){this.diagonal=n},Start$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_Start:function(){return this.start},set_Start:function(n){this.start=n},End$$:"Microsoft.Msagl.Core.Geometry.Curves.PolylinePoint",get_End:function(){return this.end},set_End:function(n){this.end=n},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"{0},{1}",[this.get_Start(),this.get_End()])}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$Tangent);Microsoft$Msagl$Routing$Visibility$TangentPair={fullname:"Microsoft.Msagl.Routing.Visibility.TangentPair",baseTypeName:"System.Object",staticDefinition:{Swap$$Double$$Double:function(n,t){var i=n.Value;n.Value=t.Value;t.Value=i},Swap$$Int32$$Int32:function(n,t){var i=n.Value;n.Value=t.Value;t.Value=i},OneOfChunksContainsOnlyOneVertex:function(n,t,i,r,u,f,e,o){return t.Value==n.Value?(o>=1.5707963267949?r.Value=f:i.Value=f,!0):r.Value==i.Value?(e>=1.5707963267949?t.Value=u:n.Value=u,!0):!1}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.P=null;this.Q=null;this.leftPLeftQ=null;this.leftPRightQ=null;this.lowerBranchOnQ=!1;this.rightPLeftQ=null;this.rightPRightQ=null;this.upperBranchOnP=!1;System.Object.ctor.call(this);this.set_PPolygon(n);this.set_QPolygon(t)},PPolygon$$:"Microsoft.Msagl.Routing.Visibility.Polygon",set_PPolygon:function(n){this.P=n},QPolygon$$:"Microsoft.Msagl.Routing.Visibility.Polygon",set_QPolygon:function(n){this.Q=n},LeftFromLineOnP:function(n,t,i){var r=this.P.Pnt(n);return this.upperBranchOnP?Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(i,r,t):Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLineOrOnLine(i,r,t)},LeftFromLineOnQ:function(n,t,i){var r=this.Q.Pnt(n);return this.lowerBranchOnQ?Microsoft.Msagl.Core.Geometry.Point.PointToTheLeftOfLineOrOnLine(i,r,t):Microsoft.Msagl.Core.Geometry.Point.PointToTheRightOfLineOrOnLine(i,r,t)},PrevOnP:function(n){return this.upperBranchOnP?this.P.Prev(n):this.P.Next(n)},PrevOnQ:function(n){return this.lowerBranchOnQ?this.Q.Prev(n):this.Q.Next(n)},NextOnP:function(n){return this.upperBranchOnP?this.P.Next(n):this.P.Prev(n)},NextOnQ:function(n){return this.lowerBranchOnQ?this.Q.Next(n):this.Q.Prev(n)},MedianOnP:function(n,t){return this.upperBranchOnP?this.P.Median(n,t):this.P.Median(t,n)},MedianOnQ:function(n,t){return this.lowerBranchOnQ?this.Q.Median(n,t):this.Q.Median(t,n)},ModuleP:function(n,t){return this.upperBranchOnP?this.P.Module(t-n):this.P.Module(n-t)},ModuleQ:function(n,t){return this.lowerBranchOnQ?this.Q.Module(t-n):this.Q.Module(n-t)},TangentBetweenBranches:function(n,t,i,r){for(var s;t!=n||r!=i;){var u=t!=n?this.MedianOnP(n,t):n,f=r!=i?this.MedianOnQ(i,r):i,e=this.P.Pnt(u),o=this.Q.Pnt(f),h=!0;this.ModuleP(n,t)>1?this.LeftFromLineOnP(this.NextOnP(u),e,o)?n=u:this.LeftFromLineOnP(this.PrevOnP(u),e,o)?t=u:h=!1:t!=n?this.LeftFromLineOnP(t,this.P.Pnt(n),o)?n=t:this.LeftFromLineOnP(n,this.P.Pnt(t),o)?t=n:h=!1:h=!1;s=!0;this.ModuleQ(i,r)>1?this.LeftFromLineOnQ(this.NextOnQ(f),o,e)?i=f:this.LeftFromLineOnQ(this.PrevOnQ(f),o,e)?r=f:s=!1:r!=i?this.LeftFromLineOnQ(r,this.Q.Pnt(i),e)?i=r:this.LeftFromLineOnQ(i,this.Q.Pnt(r),e)?r=i:s=!1:s=!1;h||s||(t=n=u,r=i=f)}return new System.Tuple$2.ctor(System.Int32.ctor,System.Int32.ctor,n,r)},FindDividingBisector:function(n,t,i,r,u,f){var e,o;(function(){var n={Value:e},t={Value:o},s=this.FindClosestFeatures(i,r,u,f,n,t);return e=n.Value,o=t.Value,s}).call(this);n.Value=Microsoft.Msagl.Core.Geometry.Point.op_Division$$Point$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Addition(e,o),2);t.Value=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(e,o).Rotate(1.5707963267949)},FindClosestPoints$$Point$$Point:function(n,t){var i,r,u,f;(function(){var e={Value:i},o={Value:r},s={Value:u},h={Value:f},c=this.FindClosestFeatures(e,o,s,h,n,t);return i=e.Value,r=o.Value,u=s.Value,f=h.Value,c}).call(this)},FindClosestFeatures:function(n,t,i,r,u,f){this.P.GetTangentPoints(t,n,this.Q.get_Item$$Int32(0).get_Point());t.Value==n.Value&&(t.Value+=this.P.get_Count());this.Q.GetTangentPoints(i,r,this.P.get_Item$$Int32(0).get_Point());r.Value==i.Value&&(i.Value+=this.Q.get_Count());this.FindClosestPoints$$Int32$$Int32$$Int32$$Int32$$Point$$Point(n,t,r,i,u,f)},FindClosestPoints$$Int32$$Int32$$Int32$$Int32$$Point$$Point:function(n,t,i,r,u,f){while(this.ChunksAreLong(t.Value,n.Value,i.Value,r.Value))this.ShrinkChunks(t,n,i,r);n.Value==t.Value?(u.Value=this.P.get_Item$$Int32(t.Value).get_Point(),r.Value==i.Value?f.Value=this.Q.get_Item$$Int32(r.Value).get_Point():(f.Value=Microsoft.Msagl.Core.Geometry.Point.ClosestPointAtLineSegment(u.Value,this.Q.get_Item$$Int32(r.Value).get_Point(),this.Q.get_Item$$Int32(i.Value).get_Point()),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(f.Value,this.Q.Pnt(r.Value))?i.Value=r.Value:Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(f.Value,this.Q.Pnt(i.Value))&&(r.Value=i.Value))):(System.Diagnostics.Debug.Assert$$Boolean(r.Value==i.Value),f.Value=this.Q.get_Item$$Int32(r.Value).get_Point(),u.Value=Microsoft.Msagl.Core.Geometry.Point.ClosestPointAtLineSegment(f.Value,this.P.get_Item$$Int32(n.Value).get_Point(),this.P.get_Item$$Int32(t.Value).get_Point()),Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(u.Value,this.P.Pnt(n.Value))?t.Value=n.Value:Microsoft.Msagl.Core.Geometry.ApproximateComparer.Close$$Point$$Point(f.Value,this.P.Pnt(t.Value))&&(n.Value=t.Value))},ChunksAreLong:function(n,t,i,r){var f=this.P.Module(n-t)+1,u;return f>2?!0:(u=this.Q.Module(r-i)+1,u>2)?!0:f==2&&u==2?!0:!1},ShrinkChunks:function(n,t,i,r){var u=t.Value==n.Value?t.Value:this.P.Median(t.Value,n.Value),f=r.Value==i.Value?r.Value:this.Q.Median(i.Value,r.Value),a=this.P.get_Item$$Int32(u).get_Point(),v=this.Q.get_Item$$Int32(f).get_Point(),e,o,s,h,c,l;if((function(){var n={Value:a},t={Value:v},i={Value:e},r={Value:o},c={Value:s},l={Value:h},y=this.GetAnglesAtTheMedian(u,f,n,t,i,r,c,l);return a=n.Value,v=t.Value,e=i.Value,o=r.Value,s=c.Value,h=l.Value,y}.call(this),!this.InternalCut(t,n,r,i,u,f,e,o,s,h))&&!Microsoft.Msagl.Routing.Visibility.TangentPair.OneOfChunksContainsOnlyOneVertex(n,t,i,r,u,f,e,s)&&!this.OnlyOneChunkContainsExactlyTwoVertices(n,t,i,r,u,f,e,s,o,h)){if(n.Value==this.P.Next(t.Value)&&r.Value==this.Q.Next(i.Value)){(function(){var u={Value:c},f={Value:l},e=Microsoft.Msagl.Core.Geometry.Curves.LineSegment.MinDistBetweenLineSegments(this.P.Pnt(t.Value),this.P.Pnt(n.Value),this.Q.Pnt(r.Value),this.Q.Pnt(i.Value),u,f);return c=u.Value,l=f.Value,e}).call(this);c==0?n.Value=t.Value:c==1?t.Value=n.Value:l==0?i.Value=r.Value:l==1&&(r.Value=i.Value);System.Diagnostics.Debug.Assert$$Boolean(t.Value==n.Value||r.Value==i.Value);return}e<=3.14159265358979&&o<=3.14159265358979&&s<=3.14159265358979&&h<=3.14159265358979?e+s>3.14159265358979?e>=1.5707963267949?t.Value=u:r.Value=f:(System.Diagnostics.Debug.Assert$$Boolean(o+h>=3.14159265358979-Microsoft.Msagl.Core.Geometry.ApproximateComparer.get_Tolerance()),o>=1.5707963267949?n.Value=u:i.Value=f):e>3.14159265358979?t.Value=u:o>3.14159265358979?n.Value=u:s>3.14159265358979?r.Value=f:(System.Diagnostics.Debug.Assert$$Boolean(h>3.14159265358979),i.Value=f)}},InternalCut:function(n,t,i,r,u,f,e,o,s,h){var a=!1;if(e>=3.14159265358979&&o>=3.14159265358979){var c=this.P.get_Item$$Int32(u).get_Point(),l=this.Q.get_Item$$Int32(f).get_Point(),p=this.P.get_Item$$Int32(this.P.Next(u)).get_Point(),v=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(c,l,this.Q.get_Item$$Int32(0).get_Point()),y=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(c,l,p);v==y?n.Value=this.P.Next(u):t.Value=this.P.Prev(u);a=!0}if(s>=3.14159265358979&&h>=3.14159265358979){var c=this.P.get_Item$$Int32(u).get_Point(),l=this.Q.get_Item$$Int32(f).get_Point(),w=this.Q.get_Item$$Int32(this.Q.Next(f)).get_Point(),v=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(c,l,this.P.get_Item$$Int32(0).get_Point()),y=Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(c,l,w);v==y?r.Value=this.Q.Next(f):i.Value=this.Q.Prev(f);a=!0}return a},GetAnglesAtTheMedian:function(n,t,i,r,u,f,e,o){u.Value=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point$$Point(r.Value,i.Value,this.P.Pnt(this.P.Prev(n)));f.Value=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point$$Point(this.P.Pnt(this.P.Next(n)),i.Value,r.Value);e.Value=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point$$Point(this.Q.Pnt(this.Q.Next(t)),r.Value,i.Value);o.Value=Microsoft.Msagl.Core.Geometry.Point.Angle$$Point$$Point$$Point(i.Value,r.Value,this.Q.Pnt(this.Q.Prev(t)))},OnlyOneChunkContainsExactlyTwoVertices:function(n,t,i,r,u,f,e,o,s,h){var c=n.Value==this.P.Next(t.Value),l=r.Value==this.Q.Next(i.Value);return c&&!l?(this.ProcessShortSide(n,t,i,r,u,f,e,o,s,h),!0):l&&!c?(function(){var c={Value:u},l={Value:f},a={Value:e},v={Value:o},y={Value:s},p={Value:h},w=this.SwapEverything(n,t,i,r,c,l,a,v,y,p);return u=c.Value,f=l.Value,e=a.Value,o=v.Value,s=y.Value,h=p.Value,w}.call(this),this.ProcessShortSide(n,t,i,r,u,f,e,o,s,h),function(){var c={Value:u},l={Value:f},a={Value:e},v={Value:o},y={Value:s},p={Value:h},w=this.SwapEverything(n,t,i,r,c,l,a,v,y,p);return u=c.Value,f=l.Value,e=a.Value,o=v.Value,s=y.Value,h=p.Value,w}.call(this),!0):!1},SwapEverything:function(n,t,i,r,u,f,e,o,s,h){this.SwapPq();Microsoft.Msagl.Routing.Visibility.TangentPair.Swap$$Int32$$Int32(r,n);Microsoft.Msagl.Routing.Visibility.TangentPair.Swap$$Int32$$Int32(i,t);Microsoft.Msagl.Routing.Visibility.TangentPair.Swap$$Int32$$Int32(u,f);Microsoft.Msagl.Routing.Visibility.TangentPair.Swap$$Double$$Double(o,s);Microsoft.Msagl.Routing.Visibility.TangentPair.Swap$$Double$$Double(e,h)},ProcessShortSide:function(n,t,i,r,u,f,e,o,s,h){u==n.Value?this.ProcessSide(n,t,i,r,f,e,o,h):s<=3.14159265358979?s+h>=3.14159265358979?s>=1.5707963267949?n.Value=t.Value:i.Value=f:o>=1.5707963267949?r.Value=f:s<h&&(Microsoft.Msagl.Core.Geometry.Point.CanProject(this.Q.Pnt(f),this.P.get_Item$$Int32(t.Value).get_Point(),this.P.get_Item$$Int32(n.Value).get_Point())?r.Value=f:t.Value=n.Value):e+o<=3.14159265358979?t.Value=n.Value:n.Value=t.Value},SwapPq:function(){var n=this.P;this.P=this.Q;this.Q=n},ProcessSide:function(n,t,i,r,u,f,e,o){var s=this.Q.Pnt(u);f<=3.14159265358979?f+e>=3.14159265358979?f>=1.5707963267949?t.Value=n.Value:r.Value=u:o>=1.5707963267949?i.Value=u:f<o&&(Microsoft.Msagl.Core.Geometry.Point.CanProject(s,this.P.get_Item$$Int32(t.Value).get_Point(),this.P.get_Item$$Int32(n.Value).get_Point())?i.Value=u:n.Value=t.Value):(n.Value=t.Value,e>=3.14159265358979?r.Value=u:o>=3.14159265358979&&(i.Value=u))},CalculateLeftTangents:function(){var t,i,n,f,r,u,e,o;(function(){var e={Value:t},o={Value:i},s={Value:n},h={Value:f},c={Value:r},l={Value:u},a=this.FindDividingBisector(e,o,s,h,c,l);return t=e.Value,i=o.Value,n=s.Value,f=h.Value,r=c.Value,u=l.Value,a}).call(this);e=this.P.FindTheFurthestVertexFromBisector(n,f,t,i);o=this.Q.FindTheFurthestVertexFromBisector(u,r,t,i);this.upperBranchOnP=!1;this.lowerBranchOnQ=!0;this.leftPLeftQ=this.TangentBetweenBranches(e,n,o,r);this.lowerBranchOnQ=!1;this.leftPRightQ=this.TangentBetweenBranches(e,n,o,u)},CalculateRightTangents:function(){var t,i,f,n,r,u,e,o;(function(){var e={Value:t},o={Value:i},s={Value:f},h={Value:n},c={Value:r},l={Value:u},a=this.FindDividingBisector(e,o,s,h,c,l);return t=e.Value,i=o.Value,f=s.Value,n=h.Value,r=c.Value,u=l.Value,a}).call(this);e=this.P.FindTheFurthestVertexFromBisector(f,n,t,i);o=this.Q.FindTheFurthestVertexFromBisector(u,r,t,i);this.upperBranchOnP=!0;this.lowerBranchOnQ=!0;this.rightPLeftQ=this.TangentBetweenBranches(e,n,o,r);this.lowerBranchOnQ=!1;this.rightPRightQ=this.TangentBetweenBranches(e,n,o,u)}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$TangentPair);Microsoft$Msagl$Routing$Visibility$TangentVisibilityGraphCalculator={fullname:"Microsoft.Msagl.Routing.Visibility.TangentVisibilityGraphCalculator",baseTypeName:"System.Object",staticDefinition:{AddTangentVisibilityEdgesToGraph:function(n,t){if(n.get_Count()>1){var i=new Microsoft.Msagl.Routing.Visibility.TangentVisibilityGraphCalculator.ctor(n,t,!0);i.CalculateAndAddEdges();i=new Microsoft.Msagl.Routing.Visibility.TangentVisibilityGraphCalculator.ctor(n,t,!1);i.CalculateAndAddEdges()}},MarkDiagonalAsActiveInTangents:function(n){n.get_LeftTangent().set_Diagonal(n);n.get_RightTangent().set_Diagonal(n)},RayIntersectDiagonal:function(n,t,i){var r=i.get_Start(),u=i.get_End();return Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n,r,u)==Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n,t,r)!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Counterclockwise&&Microsoft.Msagl.Core.Geometry.Point.GetTriangleOrientation(n,t,u)!=Microsoft.Msagl.Core.Geometry.TriangleOrientation.Clockwise}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.polygons=null;this.visibilityGraph=null;this.diagonals=null;this.tangents=null;this.activeDiagonalTree=null;this.currentPolygon=null;this.activeDiagonalComparer=new Microsoft.Msagl.Routing.Visibility.ActiveDiagonalComparerWithRay.ctor;this.useLeftPTangents=!1;System.Object.ctor.call(this);this.polygons=n;this.visibilityGraph=t;this.useLeftPTangents=i},CalculateAndAddEdges:function(){for(var n=0;n<this.polygons.get_Count();n++)this.CalculateVisibleTangentsFromPolygon(n)},CalculateVisibleTangentsFromPolygon:function(n){this.AllocateDataStructures(n);this.OrganizeTangents();this.InitActiveDiagonals();this.Sweep()},AllocateDataStructures:function(n){this.tangents=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.Tangent.ctor);this.diagonals=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Routing.Visibility.Diagonal.ctor);this.activeDiagonalTree=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Routing.Visibility.Diagonal.ctor,this.activeDiagonalComparer);this.currentPolygon=this.polygons.get_Item$$Int32(n)},Sweep:function(){var t,n;if(!(this.tangents.get_Count()<2))for(t=1;t<this.tangents.get_Count();t++)n=this.tangents.get_Item$$Int32(t),n.get_Diagonal()!=null?(n.get_Diagonal().get_RbNode()==this.activeDiagonalTree.TreeMinimum()&&this.AddVisibleEdge(n),n.get_IsHigh()&&this.RemoveDiagonalFromActiveNodes(n.get_Diagonal())):n.get_IsLow()&&(this.activeDiagonalComparer.set_PointOnTangentAndInsertedDiagonal(n.get_End().get_Point()),this.InsertActiveDiagonal(new Microsoft.Msagl.Routing.Visibility.Diagonal.ctor(n,n.get_Comp())),n.get_Diagonal().get_RbNode()==this.activeDiagonalTree.TreeMinimum()&&this.AddVisibleEdge(n))},AddVisibleEdge:function(n){Microsoft.Msagl.Routing.Visibility.VisibilityGraph.AddEdge$$VisibilityVertex$$VisibilityVertex(this.visibilityGraph.GetVertex(n.get_Start()),this.visibilityGraph.GetVertex(n.get_End()))},InitActiveDiagonals:function(){for(var n=this.tangents.get_Item$$Int32(0),i=n.get_Start().get_Point(),r=n.get_End().get_Point(),u=this.diagonals.GetEnumerator(),t,f;u.MoveNext();)t=u.get_Current(),Microsoft.Msagl.Routing.Visibility.TangentVisibilityGraphCalculator.RayIntersectDiagonal(i,r,t)&&(this.activeDiagonalComparer.set_PointOnTangentAndInsertedDiagonal(Microsoft.Msagl.Routing.Visibility.ActiveDiagonalComparerWithRay.IntersectDiagonalWithRay(i,r,t)),this.InsertActiveDiagonal(t));n.get_Diagonal().get_RbNode()==this.activeDiagonalTree.TreeMinimum()&&this.AddVisibleEdge(n);n.get_IsLow()==!1&&(f=n.get_Diagonal(),this.RemoveDiagonalFromActiveNodes(f))},RemoveDiagonalFromActiveNodes:function(n){var t=this.activeDiagonalTree.DeleteSubtree(n.get_RbNode());t!=null&&t.Item!=null&&t.Item.set_RbNode(t);n.get_LeftTangent().set_Diagonal(null);n.get_RightTangent().set_Diagonal(null)},InsertActiveDiagonal:function(n){n.set_RbNode(this.activeDiagonalTree.Insert(n));Microsoft.Msagl.Routing.Visibility.TangentVisibilityGraphCalculator.MarkDiagonalAsActiveInTangents(n)},TangentComparison:function(n,t){return Microsoft.Msagl.Routing.Visibility.StemStartPointComparer.CompareVectorsByAngleToXAxis(Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.get_End().get_Point(),n.get_Start().get_Point()),Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(t.get_End().get_Point(),t.get_Start().get_Point()))},OrganizeTangents:function(){for(var t=this.polygons.GetEnumerator(),n;t.MoveNext();)n=t.get_Current(),n!=this.currentPolygon&&this.ProcessPolygonQ(n);this.tangents.Sort$$Comparison$1($CreateDelegate(this,this.TangentComparison))},ProcessPolygonQ:function(n){var r=new Microsoft.Msagl.Routing.Visibility.TangentPair.ctor(this.currentPolygon,n),u,t,i;this.useLeftPTangents?r.CalculateLeftTangents():r.CalculateRightTangents();u=this.useLeftPTangents?r.leftPLeftQ:r.rightPLeftQ;t=new Microsoft.Msagl.Routing.Visibility.Tangent.ctor(this.currentPolygon.get_Item$$Int32(u.get_Item1()),n.get_Item$$Int32(u.get_Item2()));t.set_IsLow(!0);t.set_SeparatingPolygons(!this.useLeftPTangents);u=this.useLeftPTangents?r.leftPRightQ:r.rightPRightQ;i=new Microsoft.Msagl.Routing.Visibility.Tangent.ctor(this.currentPolygon.get_Item$$Int32(u.get_Item1()),n.get_Item$$Int32(u.get_Item2()));i.set_IsLow(!1);i.set_SeparatingPolygons(this.useLeftPTangents);t.set_Comp(i);i.set_Comp(t);this.tangents.Add(t);this.tangents.Add(i);this.diagonals.Add(new Microsoft.Msagl.Routing.Visibility.Diagonal.ctor(t,i))}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$TangentVisibilityGraphCalculator);Microsoft$Msagl$Layout$Layered$XCoordsWithAlignment={fullname:"Microsoft.Msagl.Layout.Layered.XCoordsWithAlignment",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.Layered.XCoordsWithAlignment.infinity=1.79769313486232E+308},CalculateXCoordinates:function(n,t,i,r,u){var f=new Microsoft.Msagl.Layout.Layered.XCoordsWithAlignment.ctor(n,t,i,r,u);f.Calculate()},IsLeftMostAssignment:function(n){return n==0||n==2}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i,r,u){this.la=null;this.graph=null;this.nOfOriginalVertices=0;this.root=null;this.align=null;this.nOfVertices=0;this.anchors=null;this.nodeSep=0;this.lowMedians=null;this.upperMedians=null;this.markedEdges=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor);this.h=0;this.LR=!1;this.BT=!1;this.xCoords=new Array(4);this.x=null;System.Object.ctor.call(this);this.la=n;this.graph=t;this.nOfOriginalVertices=i;this.nOfVertices=this.graph.get_NodeCount();this.h=this.la.get_Layers().length;this.root=new Int32Array(this.nOfVertices);this.align=new Int32Array(this.nOfVertices);this.anchors=r;this.nodeSep=u},EnumRightUp$$:"System.Int32",get_EnumRightUp:function(){return(this.LR?0:1)+2*(this.BT?0:1)},IsVirtual:function(n){return n>=this.nOfOriginalVertices},Source:function(n){return this.BT?n.get_Source():n.get_Target()},Target:function(n){return this.BT?n.get_Target():n.get_Source()},Calculate:function(){this.SortInAndOutEdges();this.RightUpSetup();this.CalcBiasedAlignment();this.LeftUpSetup();this.CalcBiasedAlignment();this.RightDownSetup();this.CalcBiasedAlignment();this.LeftDownSetup();this.CalcBiasedAlignment();this.HorizontalBalancing()},SortInAndOutEdges:function(){this.FillLowMedians();this.FillUpperMedins()},FillUpperMedins:function(){this.upperMedians=new Array(this.graph.get_NodeCount());for(var n=0;n<this.graph.get_NodeCount();n++)this.FillUpperMediansForNode(n)},CompareByX:function(n,t){return this.la.get_X()[n]-this.la.get_X()[t]},FillUpperMediansForNode:function(n){var t=this.graph.InEdgesCount(n),i,u,f,r;if(t>0){for(i=new Int32Array(t),t=0,u=this.graph.InEdges(n).GetEnumerator();u.MoveNext();)f=u.get_Current(),i[t++]=f.get_Source();System.Array.Sort$1$$T$Array$$Comparison$1(System.Int32.ctor,i,$CreateDelegate(this,this.CompareByX));r=t/2|0;this.upperMedians[n]=r*2==t?new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(i[r-1],i[r]):i[r]}else this.upperMedians[n]=-1},FillLowMedians:function(){this.lowMedians=new Array(this.graph.get_NodeCount());for(var n=0;n<this.graph.get_NodeCount();n++)this.FillLowMediansForNode(n)},FillLowMediansForNode:function(n){var t=this.graph.OutEdgesCount(n),i,u,f,r;if(t>0){for(i=new Int32Array(t),t=0,u=this.graph.OutEdges(n).GetEnumerator();u.MoveNext();)f=u.get_Current(),i[t++]=f.get_Target();System.Array.Sort$1$$T$Array$$Comparison$1(System.Int32.ctor,i,$CreateDelegate(this,this.CompareByX));r=t/2|0;this.lowMedians[n]=r*2==t?new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(i[r-1],i[r]):i[r]}else this.lowMedians[n]=-1},HorizontalBalancing:function(){for(var o,s,f,t,i,e=-1,r=new Float64Array(4),u=new Float64Array(4),h=1.79769313486232E+308,n=0;n<4;n++)(function(){var t={Value:r[n]},i={Value:u[n]},f=this.AssignmentBounds(n,r[n],u[n]);return r[n]=t.Value,u[n]=i.Value,f}).call(this),o=u[n]-r[n],o<h&&(e=n,h=o);for(n=0;n<4;n++)if(s=Microsoft.Msagl.Layout.Layered.XCoordsWithAlignment.IsLeftMostAssignment(n)?r[e]-r[n]:u[e]-u[n],this.x=this.xCoords[n],s!=0)for(f=0;f<this.nOfVertices;f++)this.x[f]+=s;for(t=new Float64Array(4),i=0;i<this.nOfVertices;i++)t[0]=this.xCoords[0][i],t[1]=this.xCoords[1][i],t[2]=this.xCoords[2][i],t[3]=this.xCoords[3][i],System.Array.Sort$1$$T$Array(System.Double.ctor,t),this.anchors[i].set_X((t[1]+t[2])/2)},AssignmentBounds:function(n,t,i){var u,r;if(this.nOfVertices==0)t.Value=0,i.Value=0;else for(this.x=this.xCoords[n],t.Value=i.Value=this.x[0],u=1;u<this.nOfVertices;u++)r=this.x[u],r<t.Value?t.Value=r:r>i.Value&&(i.Value=r)},CalcBiasedAlignment:function(){this.ConflictElimination();this.Align()},LeftUpSetup:function(){this.LR=!1;this.BT=!0},LeftDownSetup:function(){this.LR=!1;this.BT=!1},RightDownSetup:function(){this.LR=!0;this.BT=!1},RightUpSetup:function(){this.LR=!0;this.BT=!0},ConflictElimination:function(){this.RemoveMarksFromEdges();this.MarkConflictingEdges()},UpperEdgeMedians:function(n){var t=[],u=this.BT?this.upperMedians[n]:this.lowMedians[n],i=As(u,Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor),r;return i!=null?this.LR?(t.push(i.get_First()),t.push(i.get_Second())):(t.push(i.get_Second()),t.push(i.get_First())):(r=u,r>=0&&t.push(r)),t},MarkConflictingEdges:function(){for(var n=this.LowerOf(0,this.h-1),i=n,t=this.UpperOf(0,this.h-1),r=this.NextLower(t);this.IsBelow(n,t);n=this.NextUpper(n))this.IsBelow(i,n)&&this.IsBelow(n,r)&&this.ConflictsWithAtLeastOneInnerEdgeForALayer(n)},NextUpper:function(n){return this.BT?n+1:n-1},NextLower:function(n){return this.BT?n-1:n+1},UpperOf:function(n,t){return this.BT?System.Math.Max$$Int32$$Int32(n,t):System.Math.Min$$Int32$$Int32(n,t)},LowerOf:function(n,t){return this.BT?System.Math.Min$$Int32$$Int32(n,t):System.Math.Max$$Int32$$Int32(n,t)},IsBelow:function(n,t){return this.BT?n<t:t<n},LeftMost$$Int32$$Int32:function(n,t){return this.LR?System.Math.Min$$Int32$$Int32(n,t):System.Math.Max$$Int32$$Int32(n,t)},LeftMost$$Double$$Double:function(n,t){return this.LR?System.Math.Min$$Double$$Double(n,t):System.Math.Max$$Double$$Double(n,t)},RightMost$$Int32$$Int32:function(n,t){return this.LR?System.Math.Max$$Int32$$Int32(n,t):System.Math.Min$$Int32$$Int32(n,t)},RightMost$$Double$$Double:function(n,t){return this.LR?System.Math.Max$$Double$$Double(n,t):System.Math.Min$$Double$$Double(n,t)},IsNotRightFrom:function(n,t){return this.LR?n<=t:t<=n},IsLeftFrom:function(n,t){return this.LR?n<t:t<n},NextRight:function(n){return this.LR?n+1:n-1},NextLeft:function(n){return this.LR?n-1:n+1},ConflictsWithAtLeastOneInnerEdgeForALayer:function(n){var s,f,c,l,e,a,o,v,u;if(n>=0&&n<this.la.get_Layers().length){for(var r=this.la.get_Layers()[n],t=null,i=this.LeftMost$$Int32$$Int32(0,r.length-1),h=this.RightMost$$Int32$$Int32(0,r.length-1);this.IsNotRightFrom(i,h)&&t==null;i=this.NextRight(i))t=this.InnerEdgeByTarget(r[i]);if(t!=null){for(s=this.Pos(this.Source(t)),f=this.LeftMost$$Int32$$Int32(0,r.length-1);this.IsLeftFrom(f,i);f=this.NextRight(f))for(c=this.InEdges(r[f]).GetEnumerator();c.MoveNext();)u=c.get_Current(),this.IsLeftFrom(s,this.Pos(this.Source(u)))&&this.MarkEdge(u);for(l=this.Pos(this.Source(t));this.IsNotRightFrom(i,h);)e=this.AlignmentToTheRightOfInner(r,i,s),i=this.NextRight(i),e!=null&&(a=this.Pos(this.Source(e)),this.MarkEdgesBetweenInnerAndNewInnerEdges(r,t,e,l,a),t=e,l=a);for(s=this.Pos(this.Source(t)),o=this.NextRight(this.Pos(this.Target(t)));this.IsNotRightFrom(o,h);o=this.NextRight(o))for(v=this.InEdges(r[o]).GetEnumerator();v.MoveNext();)u=v.get_Current(),this.IsLeftFrom(this.Pos(this.Source(u)),this.Pos(this.Source(t)))&&this.MarkEdge(u)}}},InEdgeOfVirtualNode:function(n){return this.BT?this.graph.InEdgeOfVirtualNode(n):this.graph.OutEdgeOfVirtualNode(n)},InEdges:function(n){return this.BT?this.graph.InEdges(n):this.graph.OutEdges(n)},MarkEdgesBetweenInnerAndNewInnerEdges:function(n,t,i,r,u){for(var f=this.NextRight(this.Pos(this.Target(t))),o,e,s;this.IsLeftFrom(f,this.Pos(this.Target(i)));f=this.NextRight(f))for(o=this.InEdges(n[f]).GetEnumerator();o.MoveNext();)e=o.get_Current(),s=this.Pos(this.Source(e)),this.IsLeftFrom(s,r)?this.MarkEdge(e):this.IsLeftFrom(u,s)&&this.MarkEdge(e)},AlignmentToTheRightOfInner:function(n,t,i){var e=this.NumberOfInEdges(n[t]),r,u,f;if(e==1){for(r=null,u=this.InEdges(n[t]).GetEnumerator();u.MoveNext();)f=u.get_Current(),r=f;return this.IsInnerEdge(r)&&this.IsLeftFrom(i,this.Pos(r.get_Source()))?r:null}return null},NumberOfInEdges:function(n){return this.BT?this.graph.InEdgesCount(n):this.graph.OutEdgesCount(n)},Pos:function(n){return this.la.get_X()[n]},InnerEdgeByTarget:function(n){if(this.IsVirtual(n)){var t=this.InEdgeOfVirtualNode(n);if(this.IsVirtual(this.Source(t)))return t}return null},IsInnerEdge:function(n){return this.IsVirtual(n.get_Source())&&this.IsVirtual(n.get_Target())},RemoveMarksFromEdges:function(){this.markedEdges.Clear()},Align:function(){this.CreateBlocks();this.AssignCoordinatesByLongestPath()},AssignCoordinatesByLongestPath:function(){var h,t,c,l,i,r,s,n;for(this.x=this.xCoords[this.get_EnumRightUp()]=new Float64Array(this.nOfVertices),h=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Layout.Layered.IntEdge.ctor),n=0;n<this.nOfVertices;n++)if(n==this.root[n]){t=n;do(function(){var n={Value:c},i=this.TryToGetRightNeighbor(t,n);return c=n.Value,i}).call(this)&&h.Add(new Microsoft.Msagl.Layout.Layered.IntEdge.ctor$$Int32$$Int32(n,this.root[c])),t=this.align[t];while(t!=n)}l=new Microsoft.Msagl.Core.GraphAlgorithms.BasicGraph$1.ctor$$IEnumerable$1$$Int32(Microsoft.Msagl.Layout.Layered.IntEdge.ctor,h,this.nOfVertices);i=Microsoft.Msagl.Layout.Layered.IntEdge.GetOrder(l);for(var f=0,v=i.length,n=i[f];f<v;f++,n=i[f])if(n==this.root[n]){var e=0,a=!0,t=n;do(function(){var n={Value:r},i=this.TryToGetLeftNeighbor(t,n);return r=n.Value,i}).call(this)&&(a?(e=this.x[this.root[r]]+this.DeltaBetweenVertices(r,t),a=!1):e=this.RightMost$$Double$$Double(e,this.x[this.root[r]]+this.DeltaBetweenVertices(r,t))),t=this.align[t];while(t!=n);this.x[n]=e}for(var o=0,y=i.length,n=i[o];o<y;o++,n=i[o])if(n==this.root[n]&&l.InEdges(n).get_Count()==0){var t=n,u=this.RightMost$$Double$$Double(-1.79769313486232E+308,1.79769313486232E+308),p=u;do(function(){var n={Value:s},i=this.TryToGetRightNeighbor(t,n);return s=n.Value,i}).call(this)&&(u=this.LeftMost$$Double$$Double(u,this.x[this.root[s]]-this.DeltaBetweenVertices(t,s))),t=this.align[t];while(t!=n);p!=u&&(this.x[n]=u)}for(n=0;n<this.nOfVertices;n++)n!=this.root[n]&&(this.x[n]=this.x[this.root[n]])},TryToGetRightNeighbor:function(n,t){var i=this.NextRight(this.Pos(n)),r=this.la.get_Layers()[this.la.Y[n]];return i>=0&&i<r.length?(t.Value=r[i],!0):(t.Value=0,!1)},TryToGetLeftNeighbor:function(n,t){var i=this.NextLeft(this.Pos(n)),r=this.la.get_Layers()[this.la.Y[n]];return i>=0&&i<r.length?(t.Value=r[i],!0):(t.Value=0,!1)},CreateBlocks:function(){for(var o,t,u,i,e,r,n=0;n<this.nOfVertices;n++)this.root[n]=this.align[n]=n;for(o=this.LowerOf(0,this.h-1),t=this.NextLower(this.UpperOf(0,this.h-1));!this.IsBelow(t,o);t=this.NextLower(t)){var f=this.la.get_Layers()[t],s=this.LeftMost$$Int32$$Int32(-1,this.la.get_Layers()[this.NextUpper(t)].length),h=this.RightMost$$Int32$$Int32(0,f.length-1);for(u=this.LeftMost$$Int32$$Int32(0,f.length-1);this.IsNotRightFrom(u,h);u=this.NextRight(u))for(i=f[u],e=this.UpperEdgeMedians(i).GetEnumerator();e.MoveNext();)if(r=e.get_Current(),!this.IsMarked(i,r)&&this.IsLeftFrom(s,this.Pos(r))){this.align[r]=i;this.align[i]=this.root[i]=this.root[r];s=this.Pos(r);break}}},IsMarked:function(n,t){return this.BT?this.markedEdges.Contains$$T(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(t,n)):this.markedEdges.Contains$$T(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n,t))},MarkEdge:function(n){this.markedEdges.Insert(new Microsoft.Msagl.Core.GraphAlgorithms.IntPair.ctor(n.get_Source(),n.get_Target()))},DeltaBetweenVertices:function(n,t){var i=1,r,u;return this.Pos(n)>this.Pos(t)&&(r=n,n=t,t=r,i=-1),u=this.anchors[n].get_RightAnchor()+this.anchors[t].get_LeftAnchor(),(u+this.nodeSep)*i}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$XCoordsWithAlignment);Microsoft$Msagl$Core$ValidateArg={fullname:"Microsoft.Msagl.Core.ValidateArg",baseTypeName:"System.Object",staticDefinition:{IsNotNull:function(n,t){if(n==null)throw $CreateException(new System.ArgumentNullException.ctor$$String(t),new Error);},IsPositive:function(n,t){if(n<0)throw $CreateException(new System.ArgumentOutOfRangeException.ctor$$String$$String(t,"The argument must be positive"),new Error);},IsNotEmpty$1:function(n,t,i){if(t==null)throw $CreateException(new System.ArgumentNullException.ctor$$String(i),new Error);if(!System.Linq.Enumerable.Any$1$$IEnumerable$1(n,t))throw $CreateException(new System.ArgumentException.ctor$$String$$String("The argument enumerable must not be empty",i),new Error);}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$ValidateArg);Microsoft$Msagl$GraphmapsWithMesh$PlanarGraphUtilities$Face={fullname:"Microsoft.Msagl.GraphmapsWithMesh.PlanarGraphUtilities.Face",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.boundary=null;System.Object.ctor.call(this);this.boundary=n}}};JsTypes.push(Microsoft$Msagl$GraphmapsWithMesh$PlanarGraphUtilities$Face);Test$Test$TestEnum={fullname:"Test.Test.TestEnum",staticDefinition:{C:0,D:1},Kind:"Enum"};JsTypes.push(Test$Test$TestEnum);Test$Test$TestInner={fullname:"Test.Test.TestInner",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)}}};JsTypes.push(Test$Test$TestInner);Test$Test$TestInner$TestInnerEnum={fullname:"Test.Test.TestInner.TestInnerEnum",staticDefinition:{A:0,B:1},Kind:"Enum"};JsTypes.push(Test$Test$TestInner$TestInnerEnum);Microsoft$Msagl$Core$Geometry$OptimalPacking$PackingFactory$1={fullname:"Microsoft.Msagl.Core.Geometry.OptimalPacking.PackingFactory$1",Kind:"Delegate",definition:{ctor:function(n,t,i){this.TData=n;System.MulticastDelegate.ctor.call(this,t,i)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OptimalPacking$PackingFactory$1);Microsoft$Msagl$Core$Layout$EdgeLabelPlacement$PointSet={fullname:"Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.PointSet",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.Center=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Inner=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.Key=0;this.Outer=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Layout$EdgeLabelPlacement$PointSet);Microsoft$Msagl$Core$Layout$EdgeLabelPlacement$PointSetList={fullname:"Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.PointSetList",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.Points=new System.Collections.Generic.LinkedList$1.ctor(Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.PointSet.ctor);this.coveredLength=0;System.Object.ctor.call(this)},AddFirst:function(n){if(this.Points.get_Count()!=0){var t=this.Points.get_First().get_Value();this.coveredLength+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Center,t.Center).get_Length()}return this.Points.AddFirst$$T(n),this.coveredLength},AddLast:function(n){if(this.Points.get_Count()!=0){var t=this.Points.get_Last().get_Value();this.coveredLength+=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.Center,t.Center).get_Length()}return this.Points.AddLast$$T(n),this.coveredLength}}};JsTypes.push(Microsoft$Msagl$Core$Layout$EdgeLabelPlacement$PointSetList);Microsoft$Msagl$Core$Layout$EdgeLabelPlacement$PointComparer={fullname:"Microsoft.Msagl.Core.Layout.EdgeLabelPlacement.PointComparer",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)},Compare:function(n,t){return n.get_Key()<t.get_Key()?-1:n.get_Key()>t.get_Key()?1:0}}};JsTypes.push(Microsoft$Msagl$Core$Layout$EdgeLabelPlacement$PointComparer);Microsoft$Msagl$Core$Layout$LgNodeInfo$LabelPlacement={fullname:"Microsoft.Msagl.Core.Layout.LgNodeInfo.LabelPlacement",staticDefinition:{Top:0,Bottom:1,Left:2,Right:3},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Layout$LgNodeInfo$LabelPlacement);Microsoft$Msagl$Layout$LargeGraphLayout$LgInteractor$RankComparer={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgInteractor.RankComparer",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this._table=null;System.Object.ctor.call(this);this._table=n},Compare:function(n,t){return this._table.get_Item$$TKey(t).get_Rank().CompareTo$$Double(this._table.get_Item$$TKey(n).get_Rank())}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgInteractor$RankComparer);Microsoft$Msagl$Layout$LargeGraphLayout$LgLayoutSettings$LgLayoutEvent={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgLayoutSettings.LgLayoutEvent",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgLayoutSettings$LgLayoutEvent);Microsoft$Msagl$Layout$LargeGraphLayout$LgLevel$TileStatistic={fullname:"Microsoft.Msagl.Layout.LargeGraphLayout.LgLevel.TileStatistic",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.vertices=0;this.rails=0;System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Layout$LargeGraphLayout$LgLevel$TileStatistic);Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst$Segment={fullname:"Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.Segment",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.segmentId=0;this.point1=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.point2=new Microsoft.Msagl.Core.Geometry.Point.ctor;System.Object.ctor.call(this);this.point1=n;this.point2=t},p1$$:"Microsoft.Msagl.Core.Geometry.Point",get_p1:function(){return this.point1},p2$$:"Microsoft.Msagl.Core.Geometry.Point",get_p2:function(){return this.point2}}};JsTypes.push(Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst$Segment);Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst$SiteType={fullname:"Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType",staticDefinition:{RectFixed:0,RectMoveable:1,AdditionalPointBoxSegmentOverlap:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst$SiteType);Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst$TreeNode={fullname:"Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode",baseTypeName:"System.Object",staticDefinition:{cctor:function(){Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.numNodes=0}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.shiftToRoot=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0);this.neighbors=new Microsoft.Msagl.Core.DataStructures.Set$1.ctor(Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.ctor);this.visited=0;this.parent=null;this.isFixed=!1;this.rect=new Microsoft.Msagl.Core.Geometry.Rectangle.ctor;this.id=0;this.rectId=0;this.label=null;this.segment=null;this.sitePoint=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.type=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.SiteType.RectFixed;System.Object.ctor.call(this);this.id=Microsoft.Msagl.Layout.OverlapRemovalFixedSegments.OverlapRemovalFixedSegmentsMst.TreeNode.numNodes++},toString:function(){return this.label!=null?this.label.toString():"null"}}};JsTypes.push(Microsoft$Msagl$Layout$OverlapRemovalFixedSegments$OverlapRemovalFixedSegmentsMst$TreeNode);Microsoft$Msagl$Prototype$LayoutEditing$ObstacleCalculator$Visitor={fullname:"Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.Visitor",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Prototype$LayoutEditing$ObstacleCalculator$Visitor);Microsoft$Msagl$Prototype$LayoutEditing$ObstacleCalculator$PolylineGraph={fullname:"Microsoft.Msagl.Prototype.LayoutEditing.ObstacleCalculator.PolylineGraph",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.sourceToTargets=new System.Collections.Generic.Dictionary$2.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor,System.Collections.Generic.List$1.ctor);System.Object.ctor.call(this)},Nodes$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Core.Geometry.Curves.Polyline]]",get_Nodes:function(){return this.sourceToTargets.get_Keys()},AddEdge:function(n,t){var i;(function(){var t={Value:i},r=this.sourceToTargets.TryGetValue(n,t);return i=t.Value,r}).call(this)||this.sourceToTargets.set_Item$$TKey(n,i=new System.Collections.Generic.List$1.ctor(Microsoft.Msagl.Core.Geometry.Curves.Polyline.ctor));i.Add(t)},Descendents:function(n){return this.sourceToTargets.get_Item$$TKey(n)}}};JsTypes.push(Microsoft$Msagl$Prototype$LayoutEditing$ObstacleCalculator$PolylineGraph);Microsoft$Msagl$Routing$Rectilinear$EnumeratorWrapper$MoveNextState$1={fullname:"Microsoft.Msagl.Routing.Rectilinear.EnumeratorWrapper.MoveNextState$1",staticDefinition:{NotCalled:0,True:1,False:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$EnumeratorWrapper$MoveNextState$1);Microsoft$Msagl$Routing$Rectilinear$VisibilityGraphGenerator$NeighborSides={fullname:"Microsoft.Msagl.Routing.Rectilinear.VisibilityGraphGenerator.NeighborSides",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this._LowNeighbor=null;this._LowOverlapEnd=null;this._GroupSideInterveningBeforeLowNeighbor=null;this._HighNeighbor=null;this._HighOverlapEnd=null;this._GroupSideInterveningBeforeHighNeighbor=null;System.Object.ctor.call(this)},LowNeighbor$$:"Microsoft.Msagl.Core.DataStructures.RBNode`1[[Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide]]",get_LowNeighbor:function(){return this._LowNeighbor},set_LowNeighbor:function(n){this._LowNeighbor=n},LowNeighborSide$$:"Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide",get_LowNeighborSide:function(){return null==this.get_LowNeighbor()?null:this.get_LowNeighbor().Item},LowOverlapEnd$$:"Microsoft.Msagl.Core.DataStructures.RBNode`1[[Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide]]",get_LowOverlapEnd:function(){return this._LowOverlapEnd},set_LowOverlapEnd:function(n){this._LowOverlapEnd=n},GroupSideInterveningBeforeLowNeighbor$$:"Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide",get_GroupSideInterveningBeforeLowNeighbor:function(){return this._GroupSideInterveningBeforeLowNeighbor},set_GroupSideInterveningBeforeLowNeighbor:function(n){this._GroupSideInterveningBeforeLowNeighbor=n},HighNeighbor$$:"Microsoft.Msagl.Core.DataStructures.RBNode`1[[Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide]]",get_HighNeighbor:function(){return this._HighNeighbor},set_HighNeighbor:function(n){this._HighNeighbor=n},HighNeighborSide$$:"Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide",get_HighNeighborSide:function(){return null==this.get_HighNeighbor()?null:this.get_HighNeighbor().Item},HighOverlapEnd$$:"Microsoft.Msagl.Core.DataStructures.RBNode`1[[Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide]]",get_HighOverlapEnd:function(){return this._HighOverlapEnd},set_HighOverlapEnd:function(n){this._HighOverlapEnd=n},GroupSideInterveningBeforeHighNeighbor$$:"Microsoft.Msagl.Routing.Rectilinear.BasicObstacleSide",get_GroupSideInterveningBeforeHighNeighbor:function(){return this._GroupSideInterveningBeforeHighNeighbor},set_GroupSideInterveningBeforeHighNeighbor:function(n){this._GroupSideInterveningBeforeHighNeighbor=n},Clear:function(){this.set_LowNeighbor(null);this.set_LowOverlapEnd(null);this.set_GroupSideInterveningBeforeLowNeighbor(null);this.set_HighNeighbor(null);this.set_HighOverlapEnd(null);this.set_GroupSideInterveningBeforeHighNeighbor(null)},SetSides:function(n,t,i,r){if(Microsoft.Msagl.Routing.Rectilinear.StaticGraphUtility.IsAscending(n)){this.set_HighNeighbor(t);this.set_HighOverlapEnd(i);this.set_GroupSideInterveningBeforeHighNeighbor(r);return}this.set_LowNeighbor(t);this.set_LowOverlapEnd(i);this.set_GroupSideInterveningBeforeLowNeighbor(r)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$VisibilityGraphGenerator$NeighborSides);Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$ScanSegmentVectorItem={fullname:"Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.ScanSegmentVectorItem",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.FirstSegment=null;this.CurrentSegment=null;this.pendingPerpCoords=null;this._Coord=0;System.Object.ctor.call(this);this.set_Coord(n)},AddPendingPerpendicularCoord:function(n){this.pendingPerpCoords==null&&(this.pendingPerpCoords=new System.Collections.Generic.List$1.ctor(System.Double.ctor));this.pendingPerpCoords.Add(n)},ResetForIntersections:function(){System.Diagnostics.Debug.Assert$$Boolean$$String(null!=this.FirstSegment,"Empty ScanSegmentVectorItem");this.CurrentSegment=this.FirstSegment},IsHorizontal$$:"System.Boolean",get_IsHorizontal:function(){return!this.FirstSegment.get_IsVertical()},Coord$$:"System.Double",get_Coord:function(){return this._Coord},set_Coord:function(n){this._Coord=n},TraverseToSegmentContainingPoint:function(n){if(this.CurrentSegment.ContainsPoint(n))return!0;var t=this.get_IsHorizontal()?n.get_Y():n.get_X();if(!Microsoft.Msagl.Routing.Rectilinear.PointComparer.Equal$$Double$$Double(this.get_Coord(),t)){for(System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Routing.Rectilinear.PointComparer.Compare$$Double$$Double(this.get_Coord(),t)==-1,"point is before current Coord");this.MoveNext(););return!1}for(;;){if((null==this.CurrentSegment.get_NextSegment()||Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(this.CurrentSegment.get_End(),n)==Microsoft.Msagl.Routing.Rectilinear.PointComparer.GetDirections(n,this.CurrentSegment.get_NextSegment().get_Start()))&&Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(this.CurrentSegment.get_End(),n))return this.CurrentSegment.Update(this.CurrentSegment.get_Start(),n),!0;if(!this.MoveNext())return!1;if(this.CurrentSegment.ContainsPoint(n))return!0;if(Microsoft.Msagl.Routing.Rectilinear.PointComparer.IsPureLower(n,this.CurrentSegment.get_Start()))return System.Diagnostics.Debug.Assert$$Boolean$$String(Microsoft.Msagl.Core.Geometry.ApproximateComparer.CloseIntersections(this.CurrentSegment.get_Start(),n),"Skipped over the point in the ScanSegment linked list"),this.CurrentSegment.Update(n,this.CurrentSegment.get_End()),!0}},MoveNext:function(){return this.CurrentSegment=this.CurrentSegment.get_NextSegment(),this.get_HasCurrent()},HasCurrent$$:"System.Boolean",get_HasCurrent:function(){return null!=this.CurrentSegment},PointIsCurrentEndAndNextStart:function(n){return Microsoft.Msagl.Core.Geometry.Point.op_Equality(n,this.CurrentSegment.get_End())&&null!=this.CurrentSegment.get_NextSegment()&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(n,this.CurrentSegment.get_NextSegment().get_Start())},AddPerpendicularCoord:function(n){var t=this.get_IsHorizontal()?new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(n,this.get_Coord()):new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(this.get_Coord(),n);this.TraverseToSegmentContainingPoint(t);this.CurrentSegment.AddSparseVertexCoord(n)},toString:function(){return null==this.FirstSegment?"-0- "+this.get_Coord():(this.get_IsHorizontal()?"(H) Y == ":"(V) X == ")+this.get_Coord()},AppendScanSegment:function(n){null==this.FirstSegment?this.FirstSegment=n:this.CurrentSegment.set_NextSegment(n);this.CurrentSegment=n},AddPendingPerpendicularCoordsToScanSegments:function(){var n,t;if(this.pendingPerpCoords!=null)for(this.ResetForIntersections(),n=this.pendingPerpCoords.GetEnumerator();n.MoveNext();)t=n.get_Current(),this.AddPerpendicularCoord(t)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$ScanSegmentVectorItem);Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$ScanSegmentVector={fullname:"Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.ScanSegmentVector",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){var i,r;for(this.vector=null,this._CurrentSlotIndex=0,this._IsHorizontal=!1,System.Object.ctor.call(this),this.vector=new Array(n.get_Count()),this.set_IsHorizontal(t),i=System.Linq.Enumerable.OrderBy$2$$IEnumerable$1$$Func$2(System.Double.ctor,System.Double.ctor,n,$CreateAnonymousDelegate(this,function(n){return n})).GetEnumerator(),i.MoveNext(),r=0;r<this.vector.length;++r)this.vector[r]=new Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.ScanSegmentVectorItem.ctor(i.get_Current()),i.MoveNext()},CurrentSlotIndex$$:"System.Int32",get_CurrentSlotIndex:function(){return this._CurrentSlotIndex},set_CurrentSlotIndex:function(n){this._CurrentSlotIndex=n},Length$$:"System.Int32",get_Length:function(){return this.vector.length},CurrentSlot$$:"Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator+ScanSegmentVectorItem",get_CurrentSlot:function(){return this.vector[this.get_CurrentSlotIndex()]},Item$$:"Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator+ScanSegmentVectorItem",get_Item$$Int32:function(n){return this.vector[n]},CreateScanSegment:function(n,t,i,r){this.get_CurrentSlot().AppendScanSegment(new Microsoft.Msagl.Routing.Rectilinear.ScanSegment.ctor$$Point$$Point$$Double$$PointAndCrossingsList(n,t,i,r))},ScanSegmentsCompleteForCurrentSlot:function(){this.set_CurrentSlotIndex(this.get_CurrentSlotIndex()+1)},ScanSegmentsComplete:function(){for(var n=0,t=this.vector,r=t.length,i=t[n];n<r;n++,i=t[n])i.AddPendingPerpendicularCoordsToScanSegments()},Items$$:"System.Collections.Generic.IEnumerable`1[[Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator+ScanSegmentVectorItem]]",get_Items:function(){return this.vector},ResetForIntersections:function(){for(var n=0,t=this.vector,r=t.length,i=t[n];n<r;n++,i=t[n])i.ResetForIntersections()},IsHorizontal$$:"System.Boolean",get_IsHorizontal:function(){return this._IsHorizontal},set_IsHorizontal:function(n){this._IsHorizontal=n},FindNearest:function(n,t){var i=0,r=this.vector.length-1,f,u;if(n<=this.vector[i].get_Coord())return i;if(n>=this.vector[r].get_Coord())return r;while(r-i>2){if(f=i+((r-i)/2|0),u=this.vector[f],n<u.get_Coord()){r=f;continue}if(n>u.get_Coord()){i=f;continue}return System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"Should not be here if coord is in the vector"),f}for(++i;i<=r;++i){if(u=this.vector[i],n<u.get_Coord())return t>0?i:i-1;if(n==u.get_Coord())break}return System.Diagnostics.Debug.Assert$$Boolean$$String(!1,"Should not be here if coord is in the vector"),i},CreateSparseVerticesAndEdges:function(n){for(var t,i=0,r=this.vector,f=r.length,u=r[i];i<f;i++,u=r[i])for(u.ResetForIntersections(),t=u.FirstSegment;t!=null;t=t.get_NextSegment())t.CreateSparseVerticesAndEdges(n)},GetParallelCoord:function(n){return this.get_IsHorizontal()?n.get_Y():n.get_X()},GetPerpendicularCoord:function(n){return this.get_IsHorizontal()?n.get_X():n.get_Y()},ConnectAdjoiningSegmentEndpoints:function(){for(var t,n,f,i=0,r=this.vector,e=r.length,u=r[i];i<e;i++,u=r[i])for(u.ResetForIntersections(),t=u.FirstSegment,n=t.get_NextSegment();n!=null;n=n.get_NextSegment())n.get_HasSparsePerpendicularCoords()&&t.get_HasSparsePerpendicularCoords()&&Microsoft.Msagl.Core.Geometry.Point.op_Equality(n.get_Start(),t.get_End())&&(f=this.GetPerpendicularCoord(n.get_Start()),t.AddSparseEndpoint(f),n.AddSparseEndpoint(f)),t=n},toString:function(){return(this.get_IsHorizontal()?"(H) count == ":"(V) count == ")+System.Linq.Enumerable.Count$1$$IEnumerable$1(Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.ScanSegmentVectorItem.ctor,this.vector)}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$ScanSegmentVector);Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$HorizontalPointComparer={fullname:"Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.HorizontalPointComparer",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)},Compare:function(n,t){var i=n.get_Y().CompareTo$$Double(t.get_Y());return 0!=i?i:n.get_X().CompareTo$$Double(t.get_X())}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$HorizontalPointComparer);Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$VerticalPointComparer={fullname:"Microsoft.Msagl.Routing.Rectilinear.SparseVisibilityGraphGenerator.VerticalPointComparer",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(){System.Object.ctor.call(this)},Compare:function(n,t){var i=n.get_X().CompareTo$$Double(t.get_X());return 0!=i?i:n.get_Y().CompareTo$$Double(t.get_Y())}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$SparseVisibilityGraphGenerator$VerticalPointComparer);Microsoft$Msagl$Routing$SingleSourceMultipleTargetsShortestPathOnVisibilityGraph$ddType={fullname:"Microsoft.Msagl.Routing.SingleSourceMultipleTargetsShortestPathOnVisibilityGraph.ddType",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$SingleSourceMultipleTargetsShortestPathOnVisibilityGraph$ddType);Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering$MetroEdge={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge",baseTypeName:"System.Object",staticDefinition:{CreateFromTwoNodes:function(n,t){var i=new Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor;return i.nodes=new System.Collections.Generic.List$1.ctor(System.Int32.ctor),i.nodes.Add(System.Math.Min$$Int32$$Int32(n,t)),i.nodes.Add(System.Math.Max$$Int32$$Int32(n,t)),i.UpdateHashKey(),i},CreateFromTwoEdges$$Int32$$MetroEdge$$MetroEdge:function(n,t,i){var r=t.Source()==n?t.Target():t.Source(),u=i.Source()==n?i.Target():i.Source();return r<u?Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.CreateFromTwoEdges$$Int32$$List$1$Int32$$List$1$Int32(n,t.nodes,i.nodes):Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.CreateFromTwoEdges$$Int32$$List$1$Int32$$List$1$Int32(n,i.nodes,t.nodes)},CreateFromTwoEdges$$Int32$$List$1$Int32$$List$1$Int32:function(n,t,i){var u=new System.Collections.Generic.List$1.ctor$$Int32(System.Int32.ctor,t.get_Count()+i.get_Count()-1),r,f;if(t.get_Item$$Int32(0)!=n)for(r=0;r<t.get_Count();r++)u.Add(t.get_Item$$Int32(r));else for(r=t.get_Count()-1;r>=0;r--)u.Add(t.get_Item$$Int32(r));if(i.get_Item$$Int32(0)==n)for(r=1;r<i.get_Count();r++)u.Add(i.get_Item$$Int32(r));else for(r=i.get_Count()-2;r>=0;r--)u.Add(i.get_Item$$Int32(r));return f=new Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor,f.nodes=u,f.UpdateHashKey(),f},op_Equality:function(n,t){return n.GetHashCode()!=t.GetHashCode()?!1:!0},op_Inequality:function(n,t){return!Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.op_Equality(n,t)}},assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.nodes=null;this.label=0;this.labelCached=!1;this._hashKey=null;System.Object.ctor.call(this)},Source:function(){return this.nodes.get_Item$$Int32(0)},Target:function(){return this.nodes.get_Item$$Int32(this.nodes.get_Count()-1)},toString:function(){for(var n="(",t=this.nodes.GetEnumerator(),i;t.MoveNext();)i=t.get_Current(),n+=i+" ";return n+")"},UpdateHashKey:function(){this._hashKey=this.GetHashCode().toString()},GetHashCode:function(){var n,t;if(!this.labelCached){for(n=this.nodes.get_Count()|0,t=0;t<this.nodes.get_Count();t++)n=n*314159+this.nodes.get_Item$$Int32(t)|0;this.label=n|0;this.labelCached=!0}return this.label},Equals$$Object:function(n){return Is(n,Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor)?Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.op_Equality(Cast(n,Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.MetroEdge.ctor),this):!1}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering$MetroEdge);Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering$PathList={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.PathList",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.edge=null;this.paths=null;this.subLists=null;System.Object.ctor.call(this)},toString:function(){return this.edge.toString()+" ("+this.paths.get_Count()+")"}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering$PathList);Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering$PathOnEdge={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.LinearMetroMapOrdering.PathOnEdge",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.index=0;this.node=null;System.Object.ctor.call(this)},toString:function(){return"(index = "+this.index+")"}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$LinearMetroMapOrdering$PathOnEdge);Microsoft$Msagl$Routing$Spline$Bundling$TimeMeasurer$Task={fullname:"Microsoft.Msagl.Routing.Spline.Bundling.TimeMeasurer.Task",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$Spline$Bundling$TimeMeasurer$Task);Microsoft$Msagl$Core$GraphAlgorithms$CycleRemoval$VertStatus$1={fullname:"Microsoft.Msagl.Core.GraphAlgorithms.CycleRemoval.VertStatus$1",staticDefinition:{NotVisited:0,InStack:1,Visited:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$GraphAlgorithms$CycleRemoval$VertStatus$1);Microsoft$Msagl$Layout$Incremental$AxisSolver$InitialCenterDelegateType={fullname:"Microsoft.Msagl.Layout.Incremental.AxisSolver.InitialCenterDelegateType",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$AxisSolver$InitialCenterDelegateType);Microsoft$Msagl$Layout$MDS$PivotMDS$PivotMDSNodeWrap={fullname:"Microsoft.Msagl.Layout.MDS.PivotMDS.PivotMDSNodeWrap",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.node=null;System.Object.ctor.call(this);this.node=n}}};JsTypes.push(Microsoft$Msagl$Layout$MDS$PivotMDS$PivotMDSNodeWrap);Microsoft$Msagl$Layout$Incremental$EdgeConstraintGenerator$AddConstraint={fullname:"Microsoft.Msagl.Layout.Incremental.EdgeConstraintGenerator.AddConstraint",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$EdgeConstraintGenerator$AddConstraint);Microsoft$Msagl$Layout$Incremental$KDTree$Particle={fullname:"Microsoft.Msagl.Layout.Incremental.KDTree.Particle",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.force=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.point=new Microsoft.Msagl.Core.Geometry.Point.ctor;this.splitLeft=!1;System.Object.ctor.call(this);this.point=n;this.force=new Microsoft.Msagl.Core.Geometry.Point.ctor$$Double$$Double(0,0)},pos:function(n){return n==Microsoft.Msagl.Layout.Incremental.KDTree.Particle.Dim.Horizontal?this.point.get_X():this.point.get_Y()}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$KDTree$Particle);Microsoft$Msagl$Layout$Incremental$KDTree$KdNode={fullname:"Microsoft.Msagl.Layout.Incremental.KDTree.KdNode",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.parent=null;this.med=null;this.multipoleCoefficients=null;System.Object.ctor.call(this)},intersects:function(n){var t=Microsoft.Msagl.Core.Geometry.Point.op_Subtraction(n.med.get_Center(),this.med.get_Center()),i=t.get_Length();return i<n.med.get_Radius()+this.med.get_Radius()}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$KDTree$KdNode);Microsoft$Msagl$Layout$Incremental$KDTree$LeafKdNode={fullname:"Microsoft.Msagl.Layout.Incremental.KDTree.LeafKdNode",baseTypeName:"Microsoft.Msagl.Layout.Incremental.KDTree.KdNode",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.particles=null;this.ps=null;Microsoft.Msagl.Layout.Incremental.KDTree.KdNode.ctor.call(this);System.Diagnostics.Debug.Assert$$Boolean(n[0].length==n[1].length);this.particles=n;this.ComputeMED()},computeMultipoleCoefficients:function(n){this.multipoleCoefficients=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.ctor$$Int32$$Point$$Point$Array(n,this.med.get_Center(),this.ps)},ComputeMED:function(){var t=this.Size(),n;for(this.ps=new Array(t),n=0;n<t;++n)this.ps[n]=this.particles[0][n].point;return this.med=Microsoft.Msagl.Core.Geometry.MinimumEnclosingDisc.LinearComputation(this.ps)},Min:function(n){return this.particles[n][0].pos(n)},Size:function(){return this.particles[0].length},Max:function(n){return this.particles[n][this.Size()-1].pos(n)},Dimension:function(n){return this.Max(n)-this.Min(n)},Split:function(n){for(var i,a,u=this.Dimension(Microsoft.Msagl.Layout.Incremental.KDTree.Particle.Dim.Horizontal)>this.Dimension(Microsoft.Msagl.Layout.Incremental.KDTree.Particle.Dim.Vertical)?Microsoft.Msagl.Layout.Incremental.KDTree.Particle.Dim.Horizontal:Microsoft.Msagl.Layout.Incremental.KDTree.Particle.Dim.Vertical,e=u==Microsoft.Msagl.Layout.Incremental.KDTree.Particle.Dim.Horizontal?Microsoft.Msagl.Layout.Incremental.KDTree.Particle.Dim.Vertical:Microsoft.Msagl.Layout.Incremental.KDTree.Particle.Dim.Horizontal,f=this.Size(),r=f/2|0,o=f-r,s=[new Array(r),new Array(r)],h=[new Array(o),new Array(o)],c=0,l=0,t=0;t<f;++t)i=this.particles[u][t],t<r?(s[u][t]=i,i.splitLeft=!0):(h[u][t-r]=i,i.splitLeft=!1);for(t=0;t<f;++t)i=this.particles[e][t],i.splitLeft?s[e][c++]=i:h[e][l++]=i;return System.Diagnostics.Debug.Assert$$Boolean(c==r),System.Diagnostics.Debug.Assert$$Boolean(l==o),a=this.med,this.particles=s,this.ComputeMED(),n.Value=new Microsoft.Msagl.Layout.Incremental.KDTree.LeafKdNode.ctor(h),new Microsoft.Msagl.Layout.Incremental.KDTree.InternalKdNode.ctor(a,this,n.Value)},ComputeForces:function(){for(var t=0,r=this.particles[0],e=r.length,n=r[t];t<e;t++,n=r[t])for(var i=0,u=this.particles[0],o=u.length,f=u[i];i<o;i++,f=u[i])n!=f&&(n.force=Microsoft.Msagl.Core.Geometry.Point.op_Addition(n.force,Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Force(n.point,f.point)))}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$KDTree$LeafKdNode);Microsoft$Msagl$Layout$Incremental$KDTree$InternalKdNode={fullname:"Microsoft.Msagl.Layout.Incremental.KDTree.InternalKdNode",baseTypeName:"Microsoft.Msagl.Layout.Incremental.KDTree.KdNode",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t,i){this.leftChild=null;this.rightChild=null;Microsoft.Msagl.Layout.Incremental.KDTree.KdNode.ctor.call(this);this.med=n;this.parent=t.parent;this.parent!=null&&(this.parent.leftChild==t?this.parent.leftChild=this:(System.Diagnostics.Debug.Assert$$Boolean(this.parent.rightChild==t),this.parent.rightChild=this));this.leftChild=t;this.rightChild=i;t.parent=this;i.parent=this},computeMultipoleCoefficients:function(n){this.leftChild.computeMultipoleCoefficients(n);this.rightChild.computeMultipoleCoefficients(n);this.multipoleCoefficients=new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.ctor$$Point$$MultipoleCoefficients$$MultipoleCoefficients(this.med.get_Center(),this.leftChild.multipoleCoefficients,this.rightChild.multipoleCoefficients)}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$KDTree$InternalKdNode);Microsoft$Msagl$Layout$Incremental$KDTree$SplitQueue={fullname:"Microsoft.Msagl.Layout.Incremental.KDTree.SplitQueue",baseTypeName:"System.Collections.Generic.Queue$1",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.B=0;System.Collections.Generic.Queue$1.ctor.call(this,Microsoft.Msagl.Layout.Incremental.KDTree.LeafKdNode.ctor);this.B=n},Enqueue$$LeafKdNode$$LeafKdNode:function(n,t){n.Size()>this.B&&this.Enqueue(n);t.Size()>this.B&&this.Enqueue(t)}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$KDTree$SplitQueue);Microsoft$Msagl$Layout$Incremental$KDTree$Particle$Dim={fullname:"Microsoft.Msagl.Layout.Incremental.KDTree.Particle.Dim",staticDefinition:{Horizontal:0,Vertical:1},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Layout$Incremental$KDTree$Particle$Dim);Microsoft$Msagl$Core$Geometry$MoveToFront$MinDisc={fullname:"Microsoft.Msagl.Core.Geometry.MoveToFront.MinDisc",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.disc=null;this.boundary=null;System.Object.ctor.call(this);this.boundary=t;System.Diagnostics.Debug.Assert$$Boolean(t.get_Count()<=3);switch(t.get_Count()){case 0:this.disc=null;break;case 1:this.disc=new Microsoft.Msagl.Core.Geometry.Disc.ctor$$Point(n[t.get_Item$$Int32(0)]);break;case 2:this.disc=new Microsoft.Msagl.Core.Geometry.Disc.ctor$$Point$$Point(n[t.get_Item$$Int32(0)],n[t.get_Item$$Int32(1)]);break;case 3:this.disc=new Microsoft.Msagl.Core.Geometry.Disc.ctor$$Point$$Point$$Point(n[t.get_Item$$Int32(0)],n[t.get_Item$$Int32(1)],n[t.get_Item$$Int32(2)])}},contains:function(n){return this.disc==null?!1:this.disc.Contains$$Point(n)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$MoveToFront$MinDisc);Microsoft$Msagl$Layout$Incremental$MultipoleCoefficients$Complex={fullname:"Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex",baseTypeName:"System.ValueType",staticDefinition:{op_Addition:function(n,t){return new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double$$Double(n.re+t.re,n.im+t.im)},op_UnaryNegation:function(n){return new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double$$Double(-n.re,-n.im)},op_Subtraction:function(n,t){return new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double$$Double(n.re-t.re,n.im-t.im)},op_Multiply$$Complex$$Complex:function(n,t){return new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double$$Double(n.re*t.re-n.im*t.im,n.re*t.im+t.re*n.im)},op_Multiply$$Complex$$Double:function(n,t){return new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double$$Double(n.re*t,t*n.im)},op_Division:function(n,t){var r,u,i;return(i=t.re*t.re+t.im*t.im,i==0)?new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double(0):(r=n.re*t.re+n.im*t.im,u=n.im*t.re-n.re*t.im,new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double$$Double(r/i,u/i))},Pow:function(n,t){System.Diagnostics.Debug.Assert$$Boolean(t>=0);switch(t){case 0:return new Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.ctor$$Double(1);case 1:return n;case 2:return Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Multiply$$Complex$$Complex(n,n);case 3:return Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Multiply$$Complex$$Complex(Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Multiply$$Complex$$Complex(n,n),n);default:return Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.op_Multiply$$Complex$$Complex(Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.Pow(n,t/2|0),Microsoft.Msagl.Layout.Incremental.MultipoleCoefficients.Complex.Pow(n,(t/2|0)+t%2))}}},assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Double$$Double:function(n,t){this.re=0;this.im=0;System.ValueType.ctor.call(this);this.re=n;this.im=t},ctor$$Double:function(n){this.re=0;this.im=0;System.ValueType.ctor.call(this);this.re=n;this.im=0},divideBy:function(n){this.re/=n;this.im/=n},ctor:function(){this.re=0;this.im=0;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Layout$Incremental$MultipoleCoefficients$Complex);Microsoft$Msagl$Core$Geometry$RectangularClusterBoundary$Margin={fullname:"Microsoft.Msagl.Core.Geometry.RectangularClusterBoundary.Margin",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.Left=0;this.Right=0;this.Top=0;this.Bottom=0;System.Object.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$RectangularClusterBoundary$Margin);Microsoft$Msagl$Core$Layout$GraphConnectedComponents$AlgorithmDataNodeWrap={fullname:"Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this.index=0;this.node=null;this.TopLevel=!1;System.Object.ctor.call(this);this.index=n;this.node=t}}};JsTypes.push(Microsoft$Msagl$Core$Layout$GraphConnectedComponents$AlgorithmDataNodeWrap);Microsoft$Msagl$Core$Layout$GraphConnectedComponents$AlgorithmDataEdgeWrap={fullname:"Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataEdgeWrap",baseTypeName:"System.Object",staticDefinition:{MakeDummyEdgeFromNodeToItsCluster:function(n,t,i){return function(){var r=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(n.node,t.node);return r.set_Length(i),r.AlgorithmData=function(){var i=new Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataEdgeWrap.ctor;return i.set_Source(n.index),i.set_Target(t.index),i}(),r}()},MakeEdge:function(n){var t=As(n.get_Source().AlgorithmData,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap.ctor),i=As(n.get_Target().AlgorithmData,Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataNodeWrap.ctor);return function(){var r=new Microsoft.Msagl.Core.Layout.Edge.ctor$$Node$$Node(t.node,i.node);return r.set_Length(n.get_Length()),r.set_UserData(n),r.AlgorithmData=function(){var n=new Microsoft.Msagl.Core.Layout.GraphConnectedComponents.AlgorithmDataEdgeWrap.ctor;return n.set_Source(t.index),n.set_Target(i.index),n}(),r}()}},assemblyName:"Microsoft.Msagl",interfaceNames:["Microsoft.Msagl.Core.GraphAlgorithms.IEdge"],Kind:"Class",definition:{ctor:function(){this._Source=0;this._Target=0;System.Object.ctor.call(this)},Source$$:"System.Int32",get_Source:function(){return this._Source},set_Source:function(n){this._Source=n},Target$$:"System.Int32",get_Target:function(){return this._Target},set_Target:function(n){this._Target=n}}};JsTypes.push(Microsoft$Msagl$Core$Layout$GraphConnectedComponents$AlgorithmDataEdgeWrap);Microsoft$Msagl$Core$Layout$Label$PlacementSide={fullname:"Microsoft.Msagl.Core.Layout.Label.PlacementSide",staticDefinition:{Any:0,Port:1,Starboard:2,Top:3,Bottom:4,Left:5,Right:6},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Layout$Label$PlacementSide);Microsoft$Msagl$Core$Layout$Label$PlacementStrategy={fullname:"Microsoft.Msagl.Core.Layout.Label.PlacementStrategy",staticDefinition:{AlongCurve:0,Horizontal:1},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Core$Layout$Label$PlacementStrategy);Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$ClusterItem={fullname:"Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ClusterItem",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.Cluster=null;this.ChildrenHaveBeenPushed=!1;System.Object.ctor.call(this);this.Cluster=n}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$ClusterItem);Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$ClusterDelegate={fullname:"Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ClusterDelegate",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$ClusterDelegate);Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$Event={fullname:"Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.Event",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.IComparable$1"],Kind:"Class",definition:{ctor:function(n,t,i){this._IsForOpen=!1;this._Position=0;this._Node=null;System.Object.ctor.call(this);this.set_IsForOpen(n);this.set_Node(t);this.set_Position(i)},IsForOpen$$:"System.Boolean",get_IsForOpen:function(){return this._IsForOpen},set_IsForOpen:function(n){this._IsForOpen=n},Position$$:"System.Double",get_Position:function(){return this._Position},set_Position:function(n){this._Position=n},Node$$:"Microsoft.Msagl.Core.Geometry.OverlapRemovalNode",get_Node:function(){return this._Node},set_Node:function(n){this._Node=n},toString:function(){return System.String.Format$$IFormatProvider$$String$$Object$Array(System.Globalization.CultureInfo.get_InvariantCulture(),"Event: pos {0:F5} {1} {2}",[this.get_Position(),this.get_IsForOpen()?"open":"close",this.get_Node()])},CompareTo:function(n){Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"other");var t=0;return System.Math.Abs$$Double(this.get_Position()-n.get_Position())>1e-6&&(t=this.get_Position().CompareTo$$Double(n.get_Position())),0==t&&(t=this.get_IsForOpen().CompareTo$$Boolean(n.get_IsForOpen()),0==t&&(t=this.get_Node().get_Id().CompareTo$$UInt32(n.get_Node().get_Id()))),t}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$Event);Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$ScanLine={fullname:"Microsoft.Msagl.Core.Geometry.OverlapRemovalCluster.ScanLine",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.nodeTree=new Microsoft.Msagl.Core.DataStructures.RbTree$1.ctor$$IComparer$1(Microsoft.Msagl.Core.Geometry.OverlapRemovalNode.ctor,new Microsoft.Msagl.Core.Geometry.NodeComparer.ctor);System.Object.ctor.call(this)},Insert:function(n){System.Diagnostics.Debug.Assert$$Boolean$$String(null==this.nodeTree.Find$$T(n),"node already exists in the rbtree");this.nodeTree.Insert(n)},Remove:function(n){this.nodeTree.Remove(n)},NextLeft:function(n){var t=this.nodeTree.Previous(this.nodeTree.Find$$T(n));return null!=t?t.Item:null},NextRight:function(n){var t=this.nodeTree.Next(this.nodeTree.Find$$T(n));return null!=t?t.Item:null}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$OverlapRemovalCluster$ScanLine);Microsoft$Msagl$Layout$Layered$NetworkSimplex$StackStruct={fullname:"Microsoft.Msagl.Layout.Layered.NetworkSimplex.StackStruct",baseTypeName:"System.ValueType",assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Int32$$IEnumerator$$IEnumerator:function(n,t,i){this.v=0;this.outEnum=null;this.inEnum=null;System.ValueType.ctor.call(this);this.v=n;this.outEnum=t;this.inEnum=i},ctor:function(){this.v=0;this.outEnum=null;this.inEnum=null;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$NetworkSimplex$StackStruct);Microsoft$Msagl$Layout$Layered$NetworkSimplex$IncEdges={fullname:"Microsoft.Msagl.Layout.Layered.NetworkSimplex.IncEdges",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerable$1"],Kind:"Class",definition:{ctor:function(n,t){this.v=0;this.nw=null;System.Object.ctor.call(this);this.v=n;this.nw=t},GetEnumerator:function(){return new Microsoft.Msagl.Layout.Layered.NetworkSimplex.IncEdgeEnumerator.ctor(this.nw.graph.OutEdges(this.v).GetEnumerator(),this.nw.graph.InEdges(this.v).GetEnumerator())}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$NetworkSimplex$IncEdges);Microsoft$Msagl$Layout$Layered$NetworkSimplex$IncEdgeEnumerator={fullname:"Microsoft.Msagl.Layout.Layered.NetworkSimplex.IncEdgeEnumerator",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IEnumerator$1"],Kind:"Class",definition:{ctor:function(n,t){this.outEdges=null;this.inEdges=null;this.outIsActive=!1;this.inIsActive=!1;System.Object.ctor.call(this);this.outEdges=n;this.inEdges=t},Dispose:function(){System.GC.SuppressFinalize(this)},MoveNext:function(){return this.outIsActive=this.outEdges.MoveNext(),this.outIsActive||(this.inIsActive=this.inEdges.MoveNext()),this.outIsActive||this.inIsActive},Current$$:"Microsoft.Msagl.Layout.Layered.NetworkEdge",get_Current:function(){if(this.outIsActive)return As(this.outEdges.get_Current(),Microsoft.Msagl.Layout.Layered.NetworkEdge.ctor);if(this.inIsActive)return As(this.inEdges.get_Current(),Microsoft.Msagl.Layout.Layered.NetworkEdge.ctor);throw $CreateException(new System.InvalidOperationException.ctor,new Error);}}};JsTypes.push(Microsoft$Msagl$Layout$Layered$NetworkSimplex$IncEdgeEnumerator);Microsoft$Msagl$Core$ProjectionSolver$Block$ConstraintDirectionPair={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Block.ConstraintDirectionPair",baseTypeName:"System.ValueType",assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Constraint$$Boolean:function(n,t){this.Constraint=null;this.IsForward=!1;System.ValueType.ctor.call(this);this.Constraint=n;this.IsForward=t},ctor:function(){this.Constraint=null;this.IsForward=!1;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Block$ConstraintDirectionPair);Microsoft$Msagl$Core$ProjectionSolver$Qpsc$MatrixCell={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Qpsc.MatrixCell",baseTypeName:"System.ValueType",assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Double$$UInt32:function(n,t){this.Value=0;this.Column=0;System.ValueType.ctor.call(this);this.Value=n;this.Column=t},ctor:function(){this.Value=0;this.Column=0;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Qpsc$MatrixCell);Microsoft$Msagl$Core$ProjectionSolver$Qpsc$QpscVar={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Qpsc.QpscVar",baseTypeName:"System.ValueType",assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Variable:function(n){this.Variable=null;this.OrigWeight=0;this.OrigScale=0;this.OrigDesiredPos=0;System.ValueType.ctor.call(this);this.Variable=n;this.OrigWeight=n.get_Weight();this.OrigScale=n.get_Scale();this.OrigDesiredPos=this.Variable.get_DesiredPos()},ctor:function(){this.Variable=null;this.OrigWeight=0;this.OrigScale=0;this.OrigDesiredPos=0;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Qpsc$QpscVar);Microsoft$Msagl$Core$ProjectionSolver$Solver$ConstraintListForVariable={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Solver.ConstraintListForVariable",baseTypeName:"System.ValueType",assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$List$1$Constraint$$Int32:function(n,t){this.Constraints=null;this.NumberOfLeftConstraints=0;System.ValueType.ctor.call(this);this.Constraints=n;this.NumberOfLeftConstraints=t},ctor:function(){this.Constraints=null;this.NumberOfLeftConstraints=0;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Solver$ConstraintListForVariable);Microsoft$Msagl$Core$ProjectionSolver$Variable$NeighborAndWeight={fullname:"Microsoft.Msagl.Core.ProjectionSolver.Variable.NeighborAndWeight",baseTypeName:"System.ValueType",assemblyName:"Microsoft.Msagl",Kind:"Struct",definition:{ctor$$Variable$$Double:function(n,t){this._Neighbor=null;this._Weight=0;Microsoft.Msagl.Core.ProjectionSolver.Variable.NeighborAndWeight.ctor.call(this);this.set_Neighbor(n);this.set_Weight(t)},Neighbor$$:"Microsoft.Msagl.Core.ProjectionSolver.Variable",get_Neighbor:function(){return this._Neighbor},set_Neighbor:function(n){this._Neighbor=n},Weight$$:"System.Double",get_Weight:function(){return this._Weight},set_Weight:function(n){this._Weight=n},ctor:function(){this._Neighbor=null;this._Weight=0;System.ValueType.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$ProjectionSolver$Variable$NeighborAndWeight);Microsoft$Msagl$Routing$Rectilinear$Nudging$FreeSpaceFinder$FreeSpaceFinderComparer={fullname:"Microsoft.Msagl.Routing.Rectilinear.Nudging.FreeSpaceFinder.FreeSpaceFinderComparer",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",interfaceNames:["System.Collections.Generic.IComparer$1"],Kind:"Class",definition:{ctor:function(n){this.m_Owner=null;System.Object.ctor.call(this);this.m_Owner=n},Compare:function(n,t){return Microsoft.Msagl.Core.ValidateArg.IsNotNull(n,"x"),Microsoft.Msagl.Core.ValidateArg.IsNotNull(t,"y"),Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(n.get_Source(),this.m_Owner.get_DirectionPerp()).CompareTo$$Double(Microsoft.Msagl.Core.Geometry.Point.op_Multiply$$Point$$Point(t.get_Source(),this.m_Owner.get_DirectionPerp()))}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$Nudging$FreeSpaceFinder$FreeSpaceFinderComparer);Microsoft$Msagl$Routing$Rectilinear$MsmtRectilinearPath$WaypointEntry={fullname:"Microsoft.Msagl.Routing.Rectilinear.MsmtRectilinearPath.WaypointEntry",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n){this.waypointVector=new Array(1);this.entryVector=new Array(4);System.Object.ctor.call(this);this.waypointVector[0]=n}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$MsmtRectilinearPath$WaypointEntry);Microsoft$Msagl$Routing$Rectilinear$SsstRectilinearPath$NextNeighbor={fullname:"Microsoft.Msagl.Routing.Rectilinear.SsstRectilinearPath.NextNeighbor",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){this.Vertex=null;this.Weight=0;System.Object.ctor.call(this);this.Clear()},Set:function(n,t){this.Vertex=n;this.Weight=t},Clear:function(){this.Vertex=null;this.Weight=NaN}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$SsstRectilinearPath$NextNeighbor);Microsoft$Msagl$Routing$Rectilinear$SegmentIntersector$SegEvent={fullname:"Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEvent",baseTypeName:"System.Object",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(n,t){this._EventType=Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.VOpen;this._Segment=null;System.Object.ctor.call(this);this.set_EventType(n);this.set_Segment(t)},EventType$$:"Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector+SegEventType",get_EventType:function(){return this._EventType},set_EventType:function(n){this._EventType=n},Segment$$:"Microsoft.Msagl.Routing.Rectilinear.ScanSegment",get_Segment:function(){return this._Segment},set_Segment:function(n){this._Segment=n},IsVertical$$:"System.Boolean",get_IsVertical:function(){return Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.HOpen!=this.get_EventType()},Site$$:"Microsoft.Msagl.Core.Geometry.Point",get_Site:function(){return Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType.VClose==this.get_EventType()?this.get_Segment().get_End():this.get_Segment().get_Start()},toString:function(){return System.String.Format$$String$$Object$Array("{0} {1} {2} {3}",[this.get_EventType(),this.get_IsVertical(),this.get_Site(),this.get_Segment()])}}};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$SegmentIntersector$SegEvent);Microsoft$Msagl$Routing$Rectilinear$SegmentIntersector$SegEventType={fullname:"Microsoft.Msagl.Routing.Rectilinear.SegmentIntersector.SegEventType",staticDefinition:{VOpen:0,VClose:1,HOpen:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Routing$Rectilinear$SegmentIntersector$SegEventType);Microsoft$Msagl$Core$Geometry$Curves$ParallelogramNodeOverICurve$B={fullname:"Microsoft.Msagl.Core.Geometry.Curves.ParallelogramNodeOverICurve.B",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Core$Geometry$Curves$ParallelogramNodeOverICurve$B);Microsoft$Msagl$Routing$Visibility$InteractiveTangentVisibilityGraphCalculator$FilterVisibleEdgesDelegate={fullname:"Microsoft.Msagl.Routing.Visibility.InteractiveTangentVisibilityGraphCalculator.FilterVisibleEdgesDelegate",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$InteractiveTangentVisibilityGraphCalculator$FilterVisibleEdgesDelegate);Microsoft$Msagl$Routing$Visibility$UnimodalSequence$Behavior={fullname:"Microsoft.Msagl.Routing.Visibility.UnimodalSequence.Behavior",staticDefinition:{Increasing:0,Decreasing:1,Extremum:2},Kind:"Enum"};JsTypes.push(Microsoft$Msagl$Routing$Visibility$UnimodalSequence$Behavior);Microsoft$Msagl$Routing$Visibility$TangentVisibilityGraphCalculator$FilterVisibleEdgesDelegate={fullname:"Microsoft.Msagl.Routing.Visibility.TangentVisibilityGraphCalculator.FilterVisibleEdgesDelegate",Kind:"Delegate",definition:{ctor:function(n,t){System.MulticastDelegate.ctor.call(this,n,t)}}};JsTypes.push(Microsoft$Msagl$Routing$Visibility$TangentVisibilityGraphCalculator$FilterVisibleEdgesDelegate);Microsoft$Msagl$Core$ValidateArg$ValidatedNotNullAttribute={fullname:"Microsoft.Msagl.Core.ValidateArg.ValidatedNotNullAttribute",baseTypeName:"System.Attribute",assemblyName:"Microsoft.Msagl",Kind:"Class",definition:{ctor:function(){System.Attribute.ctor.call(this)}}};JsTypes.push(Microsoft$Msagl$Core$ValidateArg$ValidatedNotNullAttribute);